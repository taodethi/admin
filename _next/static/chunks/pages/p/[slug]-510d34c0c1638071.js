(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[871],{5603:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/p/[slug]",function(){return n(7178)}])},6476:function(e,t,n){"use strict";var s=n(5893),l=n(7294),a=n(948),o=n(1903);let d=(0,a.ZP)(o.Z)(e=>{let{theme:t}=e;return{alignItems:"flex-start","& .MuiInputLabel-root":{transform:"none",lineHeight:1.154,position:"relative",marginBottom:t.spacing(1),fontSize:t.typography.body2.fontSize,color:"".concat(t.palette.text.primary," !important")},"& .MuiInputBase-root":{borderRadius:8,backgroundColor:"transparent !important",border:"1px solid rgba(".concat(t.palette.customColors.main,", 0.2)"),transition:t.transitions.create(["border-color","box-shadow"],{duration:t.transitions.duration.shorter}),"&:not(.Mui-focused):not(.Mui-disabled):not(.Mui-error):hover":{borderColor:"rgba(".concat(t.palette.customColors.main,", 0.28)")},"&:before, &:after":{display:"none"},"&.MuiInputBase-sizeSmall":{borderRadius:6},"&.Mui-error":{borderColor:t.palette.error.main},"&.Mui-focused":{boxShadow:t.shadows[2],"& .MuiInputBase-input:not(.MuiInputBase-readOnly):not([readonly])::placeholder":{transform:"translateX(4px)"},"&.MuiInputBase-colorPrimary":{borderColor:t.palette.primary.main},"&.MuiInputBase-colorSecondary":{borderColor:t.palette.secondary.main},"&.MuiInputBase-colorInfo":{borderColor:t.palette.info.main},"&.MuiInputBase-colorSuccess":{borderColor:t.palette.success.main},"&.MuiInputBase-colorWarning":{borderColor:t.palette.warning.main},"&.MuiInputBase-colorError":{borderColor:t.palette.error.main},"&.Mui-error":{borderColor:t.palette.error.main}},"&.Mui-disabled":{backgroundColor:"".concat(t.palette.action.selected," !important")},"& .MuiInputAdornment-root":{marginTop:"0 !important"}},"& .MuiInputBase-input":{color:t.palette.text.secondary,"&:not(textarea)":{padding:"15.5px 13px"},"&:not(textarea).MuiInputBase-inputSizeSmall":{padding:"7.5px 13px"},"&:not(.MuiInputBase-readOnly):not([readonly])::placeholder":{transition:t.transitions.create(["opacity","transform"],{duration:t.transitions.duration.shorter})},"&.MuiInputBase-inputAdornedStart:not(.MuiAutocomplete-input)":{paddingLeft:0},"&.MuiInputBase-inputAdornedEnd:not(.MuiAutocomplete-input)":{paddingRight:0}},"& .MuiFormHelperText-root":{lineHeight:1.154,margin:t.spacing(1,0,0),color:t.palette.text.secondary,fontSize:t.typography.body2.fontSize,"&.Mui-error":{color:t.palette.error.main}},"& .MuiSelect-select:focus, & .MuiNativeSelect-select:focus":{backgroundColor:"transparent"},"& .MuiSelect-filled .MuiChip-root":{height:22},"& .MuiAutocomplete-input":{paddingLeft:"6px !important",paddingTop:"7.5px !important",paddingBottom:"7.5px !important","&.MuiInputBase-inputSizeSmall":{paddingLeft:"6px !important",paddingTop:"2.5px !important",paddingBottom:"2.5px !important"}},"& .MuiAutocomplete-inputRoot":{paddingTop:"8px !important",paddingLeft:"8px !important",paddingBottom:"8px !important","&:not(.MuiInputBase-sizeSmall).MuiInputBase-adornedStart":{paddingLeft:"13px !important"},"&.MuiInputBase-sizeSmall":{paddingTop:"5px !important",paddingLeft:"5px !important",paddingBottom:"5px !important","& .MuiAutocomplete-tag":{margin:2,height:22}}},"& .MuiInputBase-multiline":{padding:"15.25px 13px","&.MuiInputBase-sizeSmall":{padding:"7.25px 13px"},"& textarea.MuiInputBase-inputSizeSmall:placeholder-shown":{overflowX:"hidden"}},"& + .react-datepicker__close-icon":{top:11,"&:after":{fontSize:"1.6rem !important"}}}}),h=(0,l.forwardRef)((e,t)=>{let{size:n="small",InputLabelProps:l,...a}=e;return(0,s.jsx)(d,{size:n,inputRef:t,...a,variant:"filled",InputLabelProps:{...l,shrink:!0}})});t.Z=h},7178:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return sm}});var s=n(5893),l=n(1163),a=n(7294),o=n(7804),d=n(6822),h=n(5861),c=n(4386),u=n(3321),x=n(3946),p=n(1649),f=n(2078),m=n(131),g=n(7052),v=n(7715),b=n.n(v),C=n(1674),j=n(9878),T=n(1117),y=n(7274);let I=async e=>{let t=new FormData;t.append("image",e);try{let{data:e}=await y.default.post("/uploads",t,{headers:{"Content-Type":"multipart/form-data"}}),{error:n,url:s}=e;if(n)return await w(t);return e}catch(e){return console.log("uploadImage",e),await w(t)}},w=async e=>{try{let n=["3dc71c29dd62dd5","d7a0e7522c8cb79","0f8d50b5b4afbcc"];var t=new Headers;t.append("Authorization","Client-ID "+n[Math.floor(Math.random()*n.length)]);let s=await fetch("https://api.imgur.com/3/upload",{method:"POST",headers:t,body:e,redirect:"follow"}),l=await s.json();return{url:l.data.link}}catch(e){return console.log("uploadImgur",e),{error:"Tải h\xecnh ảnh thất bại"}}},E=e=>{for(var t=e.toString().trim().replace(/\./g,""),n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-",s=t.length,l="",a=0;a<t.length;a++){var o=n.indexOf(t.charAt(a));-1!==o&&(l+=n.charAt((s+o)%n.length))}return l};var A=n(6455),P=n.n(A),Z=n(6501),S=n(6886),N=n(8262),L=n(948),k=n(6628),_=n(9581),M=n(1425),R=n(1903),O=n(7109),H=n(6485),B=n.n(H);let F=e=>e&&("TEXTAREA"===e.nodeName||"INPUT"===e.nodeName);var z=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=(0,a.useRef)(null),n=()=>{e.onSuccess&&e.onSuccess(),e.selectOnCopy&&F(t.current)&&t.current.select()},s=()=>{e.onError&&e.onError();let n=!1!==e.selectOnError;n&&F(t.current)&&t.current.select()},l=e=>{B()(e).then(n).catch(s)},o=(0,a.useCallback)(e=>{"string"==typeof e?l(e):t.current&&l(t.current.value)},[]);return{copy:o,target:t}};let q=(0,L.ZP)(x.Z)(e=>{let{theme:t}=e;return{top:0,right:0,color:"grey.500",position:"absolute",boxShadow:t.shadows[2],transform:"translate(10px, -10px)",borderRadius:t.shape.borderRadius,backgroundColor:"".concat(t.palette.background.paper," !important"),transition:"transform 0.25s ease-in-out, box-shadow 0.25s ease-in-out","&:hover":{transform:"translate(7px, -5px)"}}}),G=(0,a.forwardRef)(function(e,t){return(0,s.jsx)(k.Z,{ref:t,...e})}),Y=e=>{let{show:t,setShow:n,data:l}=e,a=z(),o=()=>{n(!1)},c=e=>()=>{a.copy(e),Z.ZP.success("Đ\xe3 sao ch\xe9p th\xe0nh c\xf4ng!",{duration:3e3})};return(0,s.jsxs)(N.Z,{fullWidth:!0,open:t,maxWidth:"sm",scroll:"body",onClose:o,onBackdropClick:o,TransitionComponent:G,sx:{"& .MuiDialog-paper":{overflow:"visible"}},children:[(0,s.jsxs)(_.Z,{sx:{pb:e=>"".concat(e.spacing(8)," !important"),px:e=>["".concat(e.spacing(5)," !important"),"".concat(e.spacing(15)," !important")],pt:e=>["".concat(e.spacing(8)," !important"),"".concat(e.spacing(12.5)," !important")]},children:[(0,s.jsx)(q,{onClick:o,children:(0,s.jsx)(j.Z,{icon:"tabler:x",fontSize:"1.25rem"})}),(0,s.jsxs)(d.Z,{sx:{mb:4,textAlign:"center"},children:[(0,s.jsx)(h.Z,{variant:"h3",sx:{mb:3},children:"Cập nhật th\xe0nh c\xf4ng \uD83C\uDF89"}),(0,s.jsx)(h.Z,{sx:{color:"text.secondary"},children:"Copy link b\xean dưới v\xe0 gửi cho học sinh. Học sinh truy cập link để l\xe0m b\xe0i v\xe0 nộp b\xe0i."})]}),(0,s.jsxs)(S.ZP,{container:!0,spacing:6,children:[(0,s.jsx)(S.ZP,{item:!0,xs:12,children:(0,s.jsx)(R.Z,{label:"Link đề thi",fullWidth:!0,sx:{m:1},InputProps:{endAdornment:(0,s.jsx)(O.Z,{position:"end",children:(0,s.jsx)(u.Z,{variant:"contained",endIcon:(0,s.jsx)(j.Z,{icon:"tabler:copy"}),onClick:c((null==l?void 0:l.url)||""),children:"Sao ch\xe9p"})}),readOnly:!0},InputLabelProps:{shrink:!0},variant:"outlined",value:(null==l?void 0:l.url)||""})}),(0,s.jsx)(S.ZP,{item:!0,xs:12,children:(0,s.jsx)(R.Z,{label:"M\xe3 nh\xfang Website",fullWidth:!0,sx:{m:1},InputLabelProps:{shrink:!0},InputProps:{endAdornment:(0,s.jsx)(O.Z,{position:"end",children:(0,s.jsx)(u.Z,{variant:"contained",endIcon:(0,s.jsx)(j.Z,{icon:"tabler:copy"}),color:"success",onClick:c('<iframe width="100%" height="900" src="'.concat(null==l?void 0:l.url,'"  title="').concat(null==l?void 0:l.title,'" frameborder="0" allow="accelerometer;autoplay;clipboard-write;encrypted-media; gyroscope; picture-in-picture" allowfullscreen> </iframe>')),children:"Sao ch\xe9p"})}),readOnly:!0},variant:"outlined",value:'<iframe width="100%" height="900" src="'.concat(null==l?void 0:l.url,'"  title="').concat(null==l?void 0:l.title,'" frameborder="0" allow="accelerometer;autoplay;clipboard-write;encrypted-media; gyroscope; picture-in-picture" allowfullscreen> </iframe>')})})]})]}),(0,s.jsx)(M.Z,{sx:{justifyContent:"center",px:e=>["".concat(e.spacing(5)," !important"),"".concat(e.spacing(15)," !important")],pb:e=>["".concat(e.spacing(8)," !important"),"".concat(e.spacing(12.5)," !important")]},children:(0,s.jsx)(u.Z,{variant:"contained",sx:{mr:1},onClick:o,children:"OK"})})]})},W=e=>b().gzipSync(JSON.stringify(e)).toString("base64"),U=e=>{if(e){var t=document.getElementById(e);if(t){var n=t.getBoundingClientRect().top+window.pageYOffset;window.scrollTo({top:n-100,behavior:"smooth"})}}},$=()=>{let e=(0,p.v9)(e=>e.quiz),t=(0,p.I0)(),n=(0,l.useRouter)(),[o,v]=(0,a.useState)(!1),[b,w]=(0,a.useState)({}),[E,A]=(0,a.useState)(!1),Z=(0,a.useRef)(null),S=()=>{t((0,f.z)({status:"settings",data:{}}))};(0,a.useEffect)(()=>{E&&L()},[E]);let N=e=>{let t=n.asPath.split("?")[0],s=new URLSearchParams(e).toString(),l="".concat(t,"?").concat(s);n.replace(l,void 0,{shallow:!0})},L=()=>{t((0,g.V)({status:"Đang xử l\xfd...."}));let s=e.groups.filter(t=>e.quizs.flatMap(e=>e.groups).includes(t.id)),l=e.questions.filter(e=>s.flatMap(e=>e.questions).includes(e.id)).map(e=>"TL"==e.type?{...e,options:[]}:e);new T.Image(l).start(async l=>{var a,o,d,h,c,u,x;let{error:p,success:f}=l;if(p||!f.length)return t((0,g.V)({status:""})),A(!1),P().fire({icon:"error",title:"Oppss...",html:"Vui l\xf2ng thử lại sau!"+p});let b=e=>{for(var t=e.split(","),n=t[0].match(/:(.*?);/),s=atob(t[1]),l=s.length,a=new Uint8Array(l);l--;)a[l]=s.charCodeAt(l);let o=n&&n.length>0?n[1]:"png";return new File([a],"hinhanh.".concat(o.split("/")[1]),{type:o})},C=async e=>{let t=[];for(let n=0;n<e.length;n+=3){let s=e.slice(n,n+3);t.push(s)}let n=[];for(let e=0;e<t.length;e++){let s=t[e],l=s.map(async e=>{let t;let n=[],s=e.content||"",l=/<img.*?src="(data:image\/[^;]+;base64,.*?)".*?>/g;for(;t=l.exec(s);){let e=t[1],s=await I(b(e));n.push((null==s?void 0:s.url)||e)}let a=s.replace(l,(e,t)=>{let s=n.shift();return'<img src="'.concat(s,'" >')});return{...e,content:a}}),a=await Promise.all(l);n.push(...a)}return n},j=e=>{let t=document.createElement("div");t.innerHTML=e||"";let n=t.getElementsByClassName("ql-formula");for(let e=n.length-1;e>=0;e--){let t=n[e];t.innerHTML=""}let s=t.getElementsByTagName("img");for(let e=0;e<s.length;e++){let t=s[e];t.src.startsWith("data:image/")&&(t.src="")}return t.innerHTML},E=async e=>{let t;if(!e)return"";let n=/<img.*?src="(data:image\/[^;]+;base64,.*?)".*?>/g,s=[];for(;t=n.exec(e);){let e=t[1],n=await I(b(e));s.push((null==n?void 0:n.url)||e)}let l=e.replace(n,(e,t)=>{let n=s.shift();return'<img src="'.concat(n,'" >')});return l},Z=await E((null===(a=e.settings)||void 0===a?void 0:a.subtitle)||""),S=e=>new Promise(t=>{var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="blob",n.onload=function(){if(200===n.status){var e=n.response,s=e.type;t(new File([e],"audio_file.mp3",{type:s}))}},n.send()}),L=async e=>{let t=[];for(var n=0;n<e.length;n++){var s=e[n];if(null==s?void 0:null===(l=s.audios)||void 0===l?void 0:l.length){for(var l,a,o=[],d=0;d<(null==s?void 0:null===(a=s.audios)||void 0===a?void 0:a.length);d++){var h=null==s?void 0:s.audios[d];if((null==h?void 0:h.type)=="audio"&&/^blob\:/i.test(null==h?void 0:h.src)){var{url:c}=await I(await S(null==h?void 0:h.src));o.push({...h,src:c})}else o.push(h)}t.push({...s,audios:o})}else t.push(s)}return t},k=await L(await C(s));f=await L(f),t((0,m.Be)({groups:k})),t((0,m.QV)({questions:f})),t((0,m.kQ)({subtitle:Z})),t((0,m.kQ)({subtitle:Z}));let _=f.map(e=>({...e,content:j(e.content||""),explain:j(e.explain||""),options:(e.options||[]).map(e=>({...e,text:j(e.text)}))})),M={...e.settings,subtitle:Z,parent:(null==n?void 0:null===(o=n.query)||void 0===o?void 0:o.parent)||"",id:(null==e?void 0:null===(d=e.settings)||void 0===d?void 0:d.id)||(null==n?void 0:null===(h=n.query)||void 0===h?void 0:h.id)||"",cover:null!==(x=null===(c=e.settings)||void 0===c?void 0:c.cover)&&void 0!==x?x:"https://i.imgur.com/dKZNJGk.png"},R={questions:[...null==e?void 0:null===(u=e.quizs)||void 0===u?void 0:u.map(e=>({quizs:W(e),id:e.id,v:T.Version})),...null==k?void 0:k.map(e=>({groups:W(e),id:e.id,quizId:e.quizId,v:T.Version})),...null==_?void 0:_.map(e=>({questions:W(e),id:e.id,quizId:e.quizId,groupId:e.groupId,level:e.level,shuffle:e.shuffle,v:T.Version}))],settings:[{settings:W({...M,collects:void 0,students:void 0}),v:T.Version},...((null==M?void 0:M.collects)||[]).map(e=>({collects:W(e),v:T.Version})),...((null==M?void 0:M.students)||[]).map(e=>({students:W(e),v:T.Version,username:(null==e?void 0:e.username)||e}))],results:{...M,students:void 0,quizType:(null==_?void 0:_.filter(e=>"TL"==e.type).length)?"Hỗn hợp":"Trắc nghiệm",numberQuestions:Math.max(...null==k?void 0:k.map(e=>e.questions.length))}};t((0,g.V)({status:"Đang lưu"}));let O=(await y.default.post("/quizs",R)).data;if(O.error)return t((0,g.V)({status:""})),A(!1),P().fire({icon:"error",title:"Oops...",text:O.error,footer:'<a href="#">Why do I have this issue?</a>'});t((0,m.kQ)({id:O.id})),t((0,m.kQ)({url:O.url})),t((0,g.V)({status:""})),v(!0),w(O),A(!1),N({parent:O.parent,id:O.id})})},k=()=>{Z.current.postMessage({action:"checkErrorCreate",payload:e})},_=async()=>{try{var e,s;let{id:l="",parent:a=""}=n.query;if(!l){t((0,m._e)({quizs:[],groups:[],questions:[],settings:{collects:[{label:"Họ v\xe0 t\xean"},{label:"Lớp"}],students:[],title:""}})),t((0,m.BT)()),t((0,g.V)({status:""}));return}let o=(await (0,y.default)("/quizs/".concat(l,"/details?parent=").concat(a))).data;if(null==o?void 0:o.error){P().fire({icon:"error",title:"Oops...",text:o.error,footer:'<a href="#">Why do I have this issue?</a>'}),t((0,g.V)({status:""})),n.push("/p/create.html");return}if(!((null==o?void 0:o.questions.length)&&(null==o?void 0:o.settings.length)&&(null==o?void 0:null===(e=o.results)||void 0===e?void 0:e.sheetId))){t((0,g.V)({status:"Đang đồng bộ dữ liệu đề thi..."}));let{data:e}=await y.default.post("/quizs/".concat(l,"/sync?parent=").concat(a));if(e.error)return n.push("/"),P().fire({icon:"error",title:"Oops...",text:e.error,footer:'<a href="#">Why do I have this issue?</a>'});t((0,g.V)({status:"Đang đồng bộ dữ liệu b\xe0i l\xe0m..."}));let{data:s}=await y.default.post("/leaderboard/".concat(l,"/sync?parent=").concat(a));if(s.error)return P().fire({icon:"error",title:"Oops...",text:s.error,footer:'<a href="#">Why do I have this issue?</a>'});return _()}return null==Z?void 0:null===(s=Z.current)||void 0===s?void 0:s.postMessage({action:"fetchCreate",payload:o})}catch(e){return console.log("fetchData",e),P().fire({icon:"error",title:"Oops...",text:"Vui l\xf2ng li\xean hệ Admin để được hỗ trợ",footer:'<a href="#">Why do I have this issue?</a>'})}};(0,a.useEffect)(()=>(t((0,g.V)({status:"Đang tải..."})),n.isReady&&(Z.current&&Z.current.terminate(),fetch("".concat(C.default.assetPrefix,"/scripts/worker.").concat(C.default.version,".js")).then(e=>e.blob()).then(e=>{Z.current=new Worker(URL.createObjectURL(e)),Z.current.onmessage=async e=>{let{action:n="",payload:s=null}=e.data;switch(n){case"fetchCreate":t((0,m._e)(s)),setTimeout(()=>{t((0,g.V)({status:""}))},500);break;case"checkErrorCreate":let{errors:l,warnings:a}=s;if(l.length)return U(l[0].id),P().fire({icon:"error",title:"Oops...",text:l[0].text,footer:'<a href="#">Why do I have this issue?</a>'});a.length?P().fire({title:"Ch\xfa \xfd",html:'<p>Hệ thống ph\xe1t hiện một số vấn đề sau, bạn h\xe3y kiểm tra lại n\xf3 trước khi lưu đề thi.</p><ul style=" text-align: left; ">'.concat(a.map(e=>"<li>".concat(e,"</li>")).join(""),"</ul>"),icon:"warning",showCancelButton:!0,confirmButtonText:"Vẫn lưu",cancelButtonText:"Huỷ"}).then(e=>{e.isConfirmed&&A(!0)}):A(!0)}},_()})),()=>{Z.current&&Z.current.terminate(),t((0,g.V)({status:""}))}),[n]),(0,a.useEffect)(()=>()=>{t((0,g.V)({status:""}))},[]);let M=()=>{P().fire({icon:"warning",title:"NHẬP ĐỀ THI TỪ M\xc3 CHIA SẺ",text:"Bạn c\xf3 thể nhập nhanh đề thi với c\xe1c đề thi đ\xe3 bật chức năng m\xe3 chia sẻ. Ch\xfang t\xf4i sẽ nhập dữ liệu c\xe2u hỏi v\xe0 cấu h\xecnh trong c\xe0i đặt của đề thi. Kh\xf4ng bao gồm dữ liệu b\xe0i l\xe0m.",input:"text",inputAttributes:{autocapitalize:"off",placeholder:"Vui l\xf2ng nhập M\xc3 ĐỀ THI v\xe0o đ\xe2y."},cancelButtonText:"Hủy",showCancelButton:!0,confirmButtonText:"Nhập ngay",showLoaderOnConfirm:!0,preConfirm:async t=>{var n,s,l,a,o="Th\xf4ng tin kh\xf4ng ch\xednh x\xe1c.";try{if(!t||(null==t?void 0:t.toString().length)!==14)return P().showValidationMessage(o);let{data:d}=await y.default.post("/quizs/import/".concat(t));if(null==d?void 0:d.error)return P().showValidationMessage(null!==(l=null==d?void 0:d.error)&&void 0!==l?l:o);null==Z||null===(n=Z.current)||void 0===n||n.postMessage({action:"fetchCreate",payload:{...d,share:null!==(a=null===(s=e.settings)||void 0===s?void 0:s.id)&&void 0!==a?a:""}})}catch(e){P().showValidationMessage(e)}},allowOutsideClick:()=>!P().isLoading()}).then(e=>{e.isConfirmed})};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(d.Z,{sx:{width:"100%",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,s.jsx)(d.Z,{className:"actions-left",sx:{mr:2,display:"flex",alignItems:"center"},children:(0,s.jsx)(h.Z,{variant:"h5",sx:{cursor:"text",overflow:"hidden",textOverflow:"ellipsis",lineHeight:1.5,maxHeight:"3rem"},onClick:S,children:e.settings.title})}),(0,s.jsxs)(d.Z,{className:"actions-right",sx:{display:"flex",alignItems:"center"},children:[(0,s.jsx)(c.Z,{title:"Chỉnh sửa c\xe0i đặt",children:(0,s.jsx)(x.Z,{color:"inherit",sx:{mr:1},onClick:S,children:(0,s.jsx)(j.Z,{fontSize:"1.5rem",icon:"tabler:settings-filled"})})}),(0,s.jsx)(u.Z,{variant:"contained",color:"success",startIcon:(0,s.jsx)(j.Z,{icon:"tabler:device-floppy"}),onClick:k,children:(0,s.jsx)(h.Z,{variant:"body",children:"LƯU"})})]}),(0,s.jsx)(Y,{show:o,setShow:v,data:b})]}),(0,s.jsxs)(d.Z,{sx:{position:"fixed",bottom:15,right:"3.85rem",zIndex:1031},children:[(0,s.jsx)(u.Z,{variant:"contained",startIcon:(0,s.jsx)(j.Z,{icon:"tabler:world-upload"}),onClick:M,color:"warning",sx:{boxShadow:"0 1px 20px 1px #FF9F43!important",":hover":{boxShadow:"none!important"},mr:2},children:"NHẬP ĐỀ THI"}),(0,s.jsx)(u.Z,{variant:"contained",startIcon:(0,s.jsx)(j.Z,{icon:"tabler:device-floppy"}),onClick:k,color:"error",sx:{boxShadow:"0 1px 20px 1px #EA5455!important",":hover":{boxShadow:"none!important"}},children:"LƯU ĐỀ THI"})]})]})};var V=n(9770),Q=n(4267),K=n(8445),X=n(8232);let J=e=>{let{parent:t="",goBack:n,onSearch:l,onChange:a}=e,o=()=>{a({title:"Th\xeam Nh\xf3m/Khối mới",parent:t,text:"",type:"classes"})},c=()=>{a({title:"Th\xeam Lớp mới",parent:t,text:"",type:"class",year:new Date().getFullYear()})};return(0,s.jsxs)("div",{children:[(0,s.jsx)(K.Z,{title:(0,s.jsx)(h.Z,{variant:"h4",children:"QUẢN L\xdd NH\xd3M/LỚP HỌC"})}),(0,s.jsx)(Q.Z,{children:(0,s.jsxs)(d.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap"},children:[(0,s.jsx)(d.Z,{children:(0,s.jsx)(u.Z,{variant:"text",startIcon:(0,s.jsx)(j.Z,{icon:"tabler:chevron-left"}),color:"success",onClick:n,children:"Quay lại"})}),(0,s.jsxs)(d.Z,{children:[(0,s.jsx)(X.Z,{size:"small",sx:{mr:1},placeholder:"Nhập t\xean lớp...",InputProps:{startAdornment:(0,s.jsx)(O.Z,{position:"start",children:(0,s.jsx)(j.Z,{icon:"tabler:search"})})},onChange:l}),(0,s.jsx)(u.Z,{variant:"tonal",endIcon:(0,s.jsx)(j.Z,{icon:"tabler:folder-plus"}),sx:{mr:1},onClick:o,children:"TẠO NH\xd3M/KHỐI MỚI"}),(0,s.jsx)(u.Z,{variant:"contained",endIcon:(0,s.jsx)(j.Z,{icon:"tabler:clipboard-plus"}),onClick:c,children:"TẠO LỚP MỚI"})]})]})})]})};var ee=a.memo(J),et=n(2275),en=n(410),es=n(8885),ei=n(9334),er=n(8333),el=n(8972),ea=n(5591),eo=n(7484),ed=n.n(eo);let eh=[{flex:.25,minWidth:290,field:"title",headerName:"KHỐI/LỚP",renderCell:e=>{let{row:t}=e;return(0,s.jsxs)(d.Z,{sx:{display:"flex",alignItems:"center"},children:["class"==t.type?(0,s.jsx)(en.Z,{sx:{mr:3,fontSize:".8rem",width:"2rem",height:"2rem"},src:t.cover,children:(0,s.jsx)(j.Z,{icon:"tabler:list-check"})}):(0,s.jsx)(en.Z,{skin:"light",sx:{mr:3,fontSize:".8rem",width:"2rem",height:"2rem"},src:t.cover,children:(0,s.jsx)(j.Z,{icon:"tabler:users-group"})}),(0,s.jsx)(h.Z,{noWrap:!0,variant:"body1",sx:{color:"text.primary",fontWeight:600},children:t.title})]})}},{flex:.25,minWidth:290,field:"total",headerName:"SỐ HỌC SINH",renderCell:e=>{let{row:t}=e;return(0,s.jsx)(h.Z,{noWrap:!0,variant:"body2",sx:{color:"text.primary"},children:"class"==t.type?t.total:""})}},{flex:.25,minWidth:290,field:"updateAt",headerName:"CẬP NHẬT L\xdaC",renderCell:e=>{let{row:t}=e;return(0,s.jsx)(h.Z,{noWrap:!0,variant:"body2",sx:{color:"text.primary"},children:ed()(t.updateAt||t.createAt).format("HH:mm:ss DD/MM/YYYY")})}}],ec=e=>{let{rows:t,onChange:n,onLoading:o}=e,d=(0,l.useRouter)(),[h,c]=(0,a.useState)({}),[u,x]=(0,a.useState)(null),p=e=>{"classes"==e.type?d.push("/p/classes.html?parent="+e.id):d.push("/p/view-classes.html?classes="+e.id)},f=e=>()=>{switch(x(null),e){case"rename":n({...h,title:"Chỉnh sửa th\xf4ng tin",text:h.title});break;case"remove":P().fire({title:"X\xf3a Nh\xf3m/Khối ".concat(h.title,"?"),text:"Sau khi x\xf3a nh\xf3m/khối n\xe0y c\xe1c nh\xf3m/khối/lớp b\xean trong nh\xf3m/khối sẽ được di chuyển th\xe0nh nh\xf3m/khối c\xf9ng cấp với nh\xf3m/khối hiện tại.",icon:"warning",showCancelButton:!0,confirmButtonText:"Đ\xfang. X\xf3a đi.",cancelButtonText:"Hủy"}).then(async e=>{if(e.isConfirmed){o(!0);let e=(await y.default.delete("/classes/"+h.id)).data;o(!1);let{error:t,message:n}=e||{};if(t)return P().fire({position:"top-end",icon:"error",title:t,showConfirmButton:!1,timer:1500});n&&((0,ea.JG)(h.parent?"/classes/".concat(h.parent):"/classes",h,{revalidate:!1,populateCache:(e,t)=>{let n=t.filter(t=>t.id!==e.id);return[...n]}}),P().fire({position:"top-end",icon:"success",title:n,showConfirmButton:!1,timer:1500}))}})}},m={classes:[{text:"Chia sẻ",icon:"tabler:user-plus",onClick:f("share"),divider:!0},{text:"Đổi t\xean",icon:"tabler:pencil",onClick:f("rename")},{text:"X\xf3a",icon:"tabler:trash-filled",onClick:f("remove")}],class:[{text:"Đổi t\xean",icon:"tabler:pencil",onClick:f("rename")},{text:"X\xf3a",icon:"tabler:trash-filled",onClick:f("remove")}]},g=e=>{e.preventDefault();var[n]=t.filter(t=>t.id==e.currentTarget.getAttribute("data-id"));c(n),x(null===u?{mouseX:e.clientX-2,mouseY:e.clientY-4}:null)};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(et._,{autoHeight:!0,rows:t,columns:eh,initialState:{pagination:{paginationModel:{pageSize:15}}},pageSizeOptions:[15,25,50],slotProps:{row:{onContextMenu:g,style:{cursor:"context-menu"}}},disableRowSelectionOnClick:!0,onRowClick:e=>p(e.row)}),(0,s.jsx)(er.Z,{open:null!==u,onClose:e=>x(null),anchorReference:"anchorPosition",anchorPosition:null!==u?{top:u.mouseY,left:u.mouseX}:void 0,slotProps:{root:{onContextMenu:e=>{e.preventDefault(),x(null)}}},children:(m[h.type]||[]).map((e,t)=>(0,s.jsxs)(el.Z,{onClick:e.onClick,divider:e.divider,children:[(0,s.jsx)(es.Z,{children:(0,s.jsx)(j.Z,{icon:e.icon,fontSize:16})}),(0,s.jsx)(ei.Z,{primary:e.text})]},t))})]})},eu=(0,L.ZP)(x.Z)(e=>{let{theme:t}=e;return{top:0,right:0,color:"grey.500",position:"absolute",boxShadow:t.shadows[2],transform:"translate(10px, -10px)",borderRadius:t.shape.borderRadius,backgroundColor:"".concat(t.palette.background.paper," !important"),transition:"transform 0.25s ease-in-out, box-shadow 0.25s ease-in-out","&:hover":{transform:"translate(7px, -5px)"}}}),ex=()=>{let e=new Date().getFullYear();return Array(10).fill(0).map((t,n)=>n+e-3)},ep=(0,a.forwardRef)(function(e,t){return(0,s.jsx)(k.Z,{ref:t,...e})}),ef=e=>{let{popup:t,onChange:n,onLoading:l}=e,[o,c]=(0,a.useState)(t||{}),x=()=>{n(null)},p=async()=>{let{title:e,...n}=o;if(!n.text.trim()||n.text.trim()===t.text.trim())return;l(!0);let s=(await y.default.post("/classes",n)).data;if(l(!1),s.error)return P().fire({icon:"error",title:"Oops...",text:s.error});(0,ea.JG)(s.parent?"/classes/".concat(s.parent):"/classes",s,{revalidate:!1,populateCache:(e,t)=>{let n=[...t],s=t.findIndex(t=>t.id===e.id);return s>=0?n[s]=e:n.push(e),[...n]}}),x()};return(0,a.useEffect)(()=>{c(t||{})},[t]),(0,s.jsxs)(N.Z,{fullWidth:!0,open:!!t,maxWidth:"sm",scroll:"body",TransitionComponent:ep,sx:{"& .MuiDialog-paper":{overflow:"visible"}},children:[(0,s.jsxs)(_.Z,{sx:{pb:e=>"".concat(e.spacing(2)," !important"),px:e=>["".concat(e.spacing(5)," !important"),"".concat(e.spacing(5)," !important")]},children:[(0,s.jsx)(eu,{onClick:x,children:(0,s.jsx)(j.Z,{icon:"tabler:x",fontSize:"1.25rem"})}),(0,s.jsxs)(d.Z,{sx:{mb:2,textAlign:"left"},children:[(0,s.jsx)(h.Z,{variant:"h4",sx:{mb:3},children:o.title}),(0,s.jsx)(h.Z,{variant:"body",sx:{mb:3},children:"Bạn c\xf3 thể dễ d\xe0ng quản l\xfd c\xe1c lớp học của m\xecnh theo từng khối hoặc nh\xf3m một c\xe1ch dễ d\xe0ng hơn."})]}),(0,s.jsxs)(_.Z,{sx:{paddingX:"0!important"},children:["classes"===o.type?(0,s.jsx)(X.Z,{value:o.text,onChange:e=>c({...o,text:e}),fullWidth:!0,placeholder:"Vui l\xf2ng nhập t\xean Nh\xf3m/Kh\xf4i",label:"T\xean Nh\xf3m/Khối"}):null,"class"===o.type?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(X.Z,{value:o.text,onChange:e=>c({...o,text:e}),fullWidth:!0,placeholder:"Vui l\xf2ng nhập t\xean lớp",label:"T\xean lớp"}),(0,s.jsx)(X.Z,{select:!0,fullWidth:!0,label:"Năm học",sx:{mt:5},value:o.year||new Date().getFullYear(),onChange:e=>c({...o,year:e}),children:ex().map(e=>(0,s.jsxs)(el.Z,{value:e,children:[e," - ",e+1]},e))})]}):null]})]}),(0,s.jsxs)(M.Z,{sx:{justifyContent:"center",px:e=>["".concat(e.spacing(5)," !important"),"".concat(e.spacing(5)," !important")],pb:e=>["".concat(e.spacing(5)," !important"),"".concat(e.spacing(5)," !important")]},children:[(0,s.jsx)(u.Z,{variant:"tonal",color:"secondary",onClick:x,children:"Hủy"}),(0,s.jsx)(u.Z,{variant:"contained",sx:{mr:1},onClick:p,children:"Lưu"})]})]})};var em=n(4808),eg=n(8456);let ev=e=>{let{open:t=""}=e;return(0,s.jsxs)(em.Z,{sx:{color:"#fff",zIndex:1301,display:"flex",flexDirection:"column"},open:!!t,children:[(0,s.jsx)(eg.Z,{color:"inherit"}),(0,s.jsx)(h.Z,{variant:"h5",sx:{color:"#fff",zIndex:e=>e.zIndex.drawer+1,mt:3},children:null!=t?t:""})]})},eb=async e=>{try{return(await y.default.get(e)).data}catch(e){throw e}},eC=()=>{var e;let t=(0,l.useRouter)(),[n,o]=(0,a.useState)(""),[h,c]=(0,a.useState)(""),[u,x]=(0,a.useState)(null),{parent:p}=t.query,{data:f,isLoading:m}=(0,V.Z)(t.isReady?p?"/classes/".concat(p):"/classes":null,eb);return(0,s.jsxs)(d.Z,{children:[(0,s.jsx)(ee,{parent:p||"",goBack:()=>t.back(),onSearch:e=>o(e),onChange:e=>x(e)}),(0,s.jsx)(ec,{rows:null===(e=f||[])||void 0===e?void 0:e.filter(e=>null==e?void 0:e.title.includes(n)),onLoading:e=>c(e),onChange:e=>x(e)}),(0,s.jsx)(ef,{popup:u,onChange:e=>x(e),onLoading:e=>c(e)})]})};var ej=n(9464);let eT=e=>{let{selectionModel:t}=e,n=(0,p.I0)();return t.length?(0,s.jsxs)(d.Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",p:2},children:[(0,s.jsxs)(h.Z,{variant:"h6",children:["Đ\xe3 chọn ",(0,s.jsx)("b",{style:{color:"red"},children:t.length})]}),(0,s.jsx)(d.Z,{children:(0,s.jsx)(c.Z,{title:"Đồng bộ",children:(0,s.jsx)(u.Z,{variant:"contained",startIcon:(0,s.jsx)(j.Z,{icon:"tabler:rotate-clockwise-2"}),sx:{span:{mx:{xs:0,sm:1}},px:{xs:1,sm:3}},size:"small",color:"info",onClick:()=>{P().fire({icon:"warning",title:"Ch\xfa \xfd",html:"Hệ  thống sẽ tiến h\xe0nh đồng bộ dữ liệu đề thi v\xe0 dữ liệu b\xe0i l\xe0m ở phi\xean bản trước sang phi\xean bản mới nhất. Qu\xe1 tr\xecnh đồng bộ c\xf3 thể sẽ mất nhiều thời \n          gian. Bạn vui l\xf2ng kh\xf4ng tắt tr\xecnh duyệt n\xe0y đi. Bạn c\xf3 muốn tiếp tục kh\xf4ng?",confirmButtonText:"Tiếp tục",cancelButtonText:"Hủy",showCancelButton:!0}).then(async e=>{e.isConfirmed&&n((0,ej.UQ)(t))})},children:(0,s.jsx)(h.Z,{variant:"body2",sx:{display:{sm:"block",xs:"none"},color:"white"},children:"Đồng bộ"})})})})]}):null};var ey=(0,a.memo)(eT);let eI=()=>{let{lists:e,textSearch:t}=(0,p.v9)(e=>e.exams),n=(0,l.useRouter)(),o=z(),u=(0,p.I0)(),[f,m]=(0,a.useState)([]),[g,v]=(0,a.useState)({}),[b,C]=(0,a.useState)(null),T=(e,t)=>()=>{C(null);let s=null!=t?t:g;switch(e){case"rename":u((0,ej.J)(s));break;case"remove":P().fire({title:"X\xf3a thư mục ".concat(s.title,"?"),text:"Sau khi x\xf3a thư mục n\xe0y c\xe1c thư mục, đề thi b\xean trong thư mục sẽ được di chuyển th\xe0nh thư mục c\xf9ng cấp với thư mục hiện tại.",icon:"warning",showCancelButton:!0,confirmButtonText:"Đ\xfang. X\xf3a đi.",cancelButtonText:"Hủy"}).then(async e=>{e.isConfirmed&&u((0,ej.Ih)(s))});break;case"copy":o.copy(s.url),Z.ZP.success("Đ\xe3 sao ch\xe9p th\xe0nh c\xf4ng!",{duration:2e3});break;case"delete":P().fire({title:"X\xf3a đề thi ".concat(s.title,"?"),text:"Sau khi xo\xe1 đề thi n\xe0y. Bạn sẽ kh\xf4ng thể kh\xf4i phục n\xf3. H\xe3y c\xe2n nhắc lựa chọn n\xe0y.",icon:"warning",showCancelButton:!0,confirmButtonText:"Đ\xfang. X\xf3a đi.",cancelButtonText:"Hủy"}).then(async e=>{e.isConfirmed&&u((0,ej.P$)(s))});break;case"leaderboard":case"statistic":case"realtime":case"create":case"chatbot":n.push("/p/".concat(e,".html?parent=").concat(s.parent,"&id=").concat(s.id));break;case"view":let l=window.open(s.url,"_blank");l.focus()}},y={folder:[{text:"Đổi t\xean",icon:"tabler:pencil",onClick:T("rename")},{text:"X\xf3a",icon:"tabler:trash-filled",onClick:T("remove")}],quiz:[{text:"Xem đề thi",icon:"tabler:eye",onClick:T("view")},{text:"Sao ch\xe9p link",icon:"tabler:link",onClick:T("copy")},{text:"Chỉnh sửa",icon:"tabler:pencil-minus",onClick:T("create"),divider:!0},{text:"Bảng điểm",icon:"tabler:report-analytics",onClick:T("leaderboard")},{text:"Thống k\xea",icon:"tabler:chart-histogram",onClick:T("statistic")},{text:"Gi\xe1m s\xe1t thi",icon:"tabler:user-scan",onClick:T("realtime"),divider:!0},{text:"X\xf3a",icon:"tabler:trash-filled",onClick:T("delete")}],chatbot:[{text:"Xem đề thi",icon:"tabler:eye",onClick:T("view")},{text:"Sao ch\xe9p link",icon:"tabler:link",onClick:T("copy")},{text:"Chỉnh sửa",icon:"tabler:pencil-minus",onClick:T("chatbot"),divider:!0},{text:"Bảng điểm",icon:"tabler:report-analytics",onClick:T("leaderboard")},{text:"Thống k\xea",icon:"tabler:chart-histogram",onClick:T("statistic")},{text:"Gi\xe1m s\xe1t thi",icon:"tabler:user-scan",onClick:T("realtime"),divider:!0},{text:"X\xf3a",icon:"tabler:trash-filled",onClick:T("delete")}]},I=(t,n)=>{if(t.preventDefault(),n)v(n);else{var[s]=e.filter(e=>e.id==t.currentTarget.getAttribute("data-id"));v(s)}C(null===b?{mouseX:t.clientX-2,mouseY:t.clientY-4}:null)},w=e=>{switch(e.type){case"folder":return n.push({pathname:"/p/exams.html",query:{parent:e.id}});case"chatbot":return n.push("/p/chatbot.html?parent=".concat(e.parent,"&id=").concat(e.id));case"quiz":return n.push("/p/create.html?parent=".concat(e.parent,"&id=").concat(e.id))}e.type};return(0,s.jsxs)(a.Fragment,{children:[(0,s.jsx)(ey,{selectionModel:e.filter(e=>f.includes(e.id))}),(0,s.jsx)(et._,{autoHeight:!0,rows:e.filter(e=>{var n;return null==e?void 0:null===(n=e.title)||void 0===n?void 0:n.toLocaleLowerCase().includes(null==t?void 0:t.toLocaleLowerCase())}),columns:[{flex:.25,minWidth:290,field:"title",headerName:"T\xcaN ĐỀ THI/THƯ MỤC",renderCell:e=>{let{row:t}=e;return(0,s.jsxs)(d.Z,{sx:{display:"flex",alignItems:"center",cursor:"pointer"},onClick:()=>w(t),children:["folder"==t.type?(0,s.jsx)(en.Z,{sx:{mr:3,fontSize:".8rem",width:"2rem",height:"2rem"},src:t.cover,children:(0,s.jsx)(j.Z,{icon:"tabler:folder-filled"})}):(0,s.jsx)(en.Z,{skin:"light",sx:{mr:3,fontSize:".8rem",width:"2rem",height:"2rem"},src:t.cover,children:(0,s.jsx)(j.Z,{icon:"tabler:clipboard"})}),(0,s.jsx)(h.Z,{noWrap:!0,variant:"body1",sx:{color:"text.primary",fontWeight:600},children:t.title})]})}},{flex:.25,minWidth:290,field:"updateAt",headerName:"CẬP NHẬT L\xdaC",renderCell:e=>{let{row:t}=e;return(0,s.jsx)(h.Z,{noWrap:!0,variant:"body2",sx:{color:"text.primary"},children:ed()(t.updateAt||t.createAt).format("HH:mm DD/MM/YYYY")})}},{flex:.25,minWidth:200,field:"actions",headerName:"",renderCell:e=>{let{row:t}=e;return(0,s.jsxs)(d.Z,{children:[["quiz","chatbot"].includes(t.type)?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(c.Z,{title:"Sao ch\xe9p link",color:"primary",children:(0,s.jsx)(x.Z,{onClick:()=>{v(t),T("copy",t)()},children:(0,s.jsx)(j.Z,{icon:"tabler:link",fontSize:16})})}),(0,s.jsx)(c.Z,{title:"Chỉnh sửa",color:"info",children:(0,s.jsx)(x.Z,{onClick:()=>{v(t),T("chatbot"==t.type?"chatbot":"create",t)()},children:(0,s.jsx)(j.Z,{icon:"tabler:pencil-minus",fontSize:16})})}),(0,s.jsx)(c.Z,{title:"Bảng điểm",color:"success",children:(0,s.jsx)(x.Z,{onClick:()=>{v(t),T("leaderboard",t)()},children:(0,s.jsx)(j.Z,{icon:"tabler:report-analytics",fontSize:16})})}),(0,s.jsx)(c.Z,{title:"Gi\xe1m s\xe1t thi",children:(0,s.jsx)(x.Z,{color:"error",onClick:()=>{v(t),T("realtime",t)()},children:(0,s.jsx)(j.Z,{icon:"tabler:user-scan",fontSize:16})})})]}):null,"folder"==t.type?(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(c.Z,{title:"Đổi t\xean",color:"info",children:(0,s.jsx)(x.Z,{children:(0,s.jsx)(j.Z,{icon:"tabler:pencil-minus",fontSize:16})})})}):null,(0,s.jsx)(x.Z,{onClick:e=>I(e,t),children:(0,s.jsx)(j.Z,{icon:"tabler:dots-vertical",fontSize:16})})]})}}],initialState:{pagination:{paginationModel:{pageSize:15}}},pageSizeOptions:[15,25,50],slotProps:{row:{onContextMenu:I,style:{cursor:"context-menu"}}},disableRowSelectionOnClick:!0,checkboxSelection:!0,rowSelectionModel:f,onRowSelectionModelChange:e=>m(e)}),(0,s.jsx)(er.Z,{open:null!==b,onClose:e=>C(null),anchorReference:"anchorPosition",anchorPosition:null!==b?{top:b.mouseY,left:b.mouseX}:void 0,slotProps:{root:{onContextMenu:e=>{e.preventDefault(),C(null)}}},children:(y[g.type]||[]).map((e,t)=>(0,s.jsxs)(el.Z,{onClick:e.onClick,divider:e.divider,children:[(0,s.jsx)(es.Z,{children:(0,s.jsx)(j.Z,{icon:e.icon,fontSize:16})}),(0,s.jsx)(ei.Z,{primary:e.text})]},t))})]})};var ew=(0,a.memo)(eI),eE=n(7533),eA=n(6901),eP=n(1664),eZ=n.n(eP);let eS=e=>{var t;let{parent:n=""}=e,{textSearch:o,isPopup:f}=(0,p.v9)(e=>e.exams),m=(0,l.useRouter)(),g=(0,p.I0)(),v=()=>{m.back()},b=e=>{g((0,ej.rG)(e))},C=()=>{P().fire({title:"Đồng bộ dữ liệu",text:"Chức năng n\xe0y sẽ đồng bộ lại dữ liệu đề thi m\xe0 bạn đ\xe3 tạo ở phi\xean bản trước. Bạn c\xf3 muốn đồng bộ kh\xf4ng?",icon:"warning",showCancelButton:!0,confirmButtonText:"Đồng bộ ngay",cancelButtonText:"Hủy"}).then(async e=>{e.isConfirmed&&g((0,ej.MQ)({}))})},T=()=>{g((0,ej.J)({title:"",parent:n}))},y=()=>{var e,t,n,s,l;f&&(null===(e=f.input)||void 0===e?void 0:e.toString().trim())&&(null==f?void 0:null===(t=f.input)||void 0===t?void 0:t.toString().trim())!==(null===(n=null==f?void 0:null===(s=f.title)||void 0===s?void 0:s.toString())||void 0===n?void 0:n.trim())&&g((0,ej.Tb)({...f,title:null===(l=f.input)||void 0===l?void 0:l.toString().trim(),input:void 0}))};return(0,s.jsxs)(a.Fragment,{children:[(0,s.jsx)(K.Z,{title:(0,s.jsx)(h.Z,{variant:"h4",children:"QUẢN L\xdd ĐỀ THI"})}),(0,s.jsx)(Q.Z,{sx:{px:{xs:2,md:4}},children:(0,s.jsxs)(d.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"no-wrap"},children:[(0,s.jsx)(d.Z,{children:(0,s.jsx)(c.Z,{title:"Quay lại",children:(0,s.jsx)(u.Z,{variant:"text",startIcon:(0,s.jsx)(j.Z,{icon:"tabler:chevron-left"}),color:"success",onClick:v,children:(0,s.jsx)(h.Z,{variant:"body2",sx:{display:{sm:"block",xs:"none"}},children:"Quay lại"})})})}),(0,s.jsxs)(d.Z,{sx:{display:"flex",alignItems:"center"},children:[(0,s.jsx)(X.Z,{size:"small",sx:{mr:1},placeholder:"Nhập t\xean đề thi...",InputProps:{startAdornment:(0,s.jsx)(O.Z,{position:"start",children:(0,s.jsx)(j.Z,{icon:"tabler:search"})})},value:o,onChange:b}),(0,s.jsx)(c.Z,{title:"Thư mục mới",children:(0,s.jsx)(u.Z,{variant:"tonal",endIcon:(0,s.jsx)(j.Z,{icon:"tabler:folder-plus"}),sx:{span:{mx:{xs:0,sm:1}},px:{xs:1,sm:3},mr:1,flexGrow:1},onClick:T,children:(0,s.jsx)(h.Z,{variant:"body2",sx:{display:{sm:"block",xs:"none"}},children:"Thư mục mới"})})}),(0,s.jsx)(c.Z,{title:" TẠO ĐỀ MỚI",children:(0,s.jsx)(u.Z,{variant:"contained",endIcon:(0,s.jsx)(j.Z,{icon:"tabler:clipboard-plus"}),component:eZ(),href:"/p/create.html?parent="+n,sx:{span:{mx:{xs:0,sm:1}},px:{xs:1,sm:3}},children:(0,s.jsx)(h.Z,{variant:"body2",sx:{display:{sm:"block",xs:"none"},color:"white"},children:"TẠO ĐỀ MỚI"})})}),n?null:(0,s.jsx)(c.Z,{title:"Đồng bộ đề thi",children:(0,s.jsx)(x.Z,{sx:{ml:1},color:"primary",onClick:C,children:(0,s.jsx)(j.Z,{icon:"tabler:refresh"})})})]})]})}),(0,s.jsx)(d.Z,{sx:{position:"fixed",bottom:15,right:"3.75rem",zIndex:1031},children:(0,s.jsx)(u.Z,{variant:"contained",startIcon:(0,s.jsx)(j.Z,{icon:"tabler:plus"}),component:eZ(),href:"/p/create.html?parent="+n,color:"error",sx:{boxShadow:"0 1px 20px 1px #EA5455!important",":hover":{boxShadow:"none!important"}},children:"TẠO ĐỀ MỚI"})}),(0,s.jsx)(eE.ZP,{open:!!f,anchor:"right",children:(0,s.jsxs)(d.Z,{sx:{p:2,minWidth:300},children:[(0,s.jsx)(eA.Z,{severity:"success",sx:{mb:5},icon:!1,children:"Bạn c\xf3 thể dễ d\xe0ng quản l\xfd đề thi, b\xe0i tập của m\xecnh theo từng thư mục, chuy\xean đề một c\xe1ch dễ d\xe0ng hơn."}),(0,s.jsx)(X.Z,{fullWidth:!0,placeholder:"Vui l\xf2ng nhập t\xean thư mục",label:"T\xean thư mục",value:null!==(t=null==f?void 0:f.input)&&void 0!==t?t:null==f?void 0:f.title,onChange:e=>g((0,ej.J)({...f,input:e}))}),(0,s.jsxs)(d.Z,{sx:{mt:3,textAlign:"center"},children:[(0,s.jsx)(u.Z,{sx:{mr:2},variant:"tonal",color:"error",onClick:()=>g((0,ej.J)(null)),children:"Hủy"}),(0,s.jsx)(u.Z,{variant:"contained",onClick:y,children:"Lưu"})]})]})})]})};var eN=n(8963);let eL=()=>{var e;(0,a.useContext)(eN.v);let t=(0,l.useRouter)(),n=(0,p.I0)(),{isError:o,isLoading:h}=(0,p.v9)(e=>e.exams);return(0,a.useEffect)(()=>{if(t.isReady){var e;n((0,ej.rQ)({parent:null!==(e=t.query.parent)&&void 0!==e?e:""}))}},[t]),(0,a.useEffect)(()=>{o&&P().fire({icon:"error",title:"Xảy ra lỗi",text:o}).then(()=>{n((0,ej.Uw)(""))})},[o]),(0,s.jsxs)(d.Z,{children:[(0,s.jsx)(eS,{parent:null!==(e=t.query.parent)&&void 0!==e?e:""}),(0,s.jsx)(ew,{}),(0,s.jsx)(ev,{open:h})]})};eL.acl={action:"read",subject:"teacher"};var ek=n(6242),e_=n(5152),eM=n.n(e_);let eR=eM()(()=>Promise.all([n.e(814),n.e(229)]).then(n.bind(n,7229)),{loadableGenerated:{webpack:()=>[7229]},ssr:!1}),eO=(e,t)=>{let n={};return e.forEach(e=>{n[e.number]||(n[e.number]=Array(21).fill(0)),n.total||(n.total=Array(21).fill(0));var s=Math.floor(e.point/t*20);n[e.number][s]++,n.total[s]++}),Object.keys(n).map((e,t)=>({name:"total"==e?"Tất cả":"Đề số ".concat(t+1),data:n[e]}))},eH=e=>{let{results:t,maxPoint:n=10}=e,l=eO(t,n),a={chart:{height:300,type:"area"},dataLabels:{enabled:!1},stroke:{curve:"smooth"},xaxis:{categories:Array.from({length:21},(e,t)=>">="+parseFloat(t*(n/20)).toFixed(2))},yaxis:{title:{text:"Số b\xe0i l\xe0m"}},scales:{x:{beginAtZero:!0}}};return(0,s.jsxs)(ek.Z,{sx:{mb:5},children:[(0,s.jsx)(K.Z,{title:"Phổ điểm",sx:{flexDirection:["column","row"],alignItems:["flex-start","center"],"& .MuiCardHeader-action":{mb:0},"& .MuiCardHeader-content":{mb:[2,0]}},action:(0,s.jsx)(d.Z,{sx:{display:"flex",alignItems:"center"}})}),(0,s.jsx)(Q.Z,{children:(0,s.jsx)(eR,{height:450,options:a,series:l})})]})};var eB=a.memo(eH),eD=n(8409),eF=n(178),ez=n.n(eF),eq=n(9387),eG=n.n(eq);ed().extend(ez()),ed().extend(eG()),ed().tz.setDefault("Asia/Ho_Chi_Minh");var eY=ed();let eW=e=>{let{exportTable:t,realtime:n=!1,filter:l,setFilter:a}=e;return(0,s.jsxs)(d.Z,{children:[(0,s.jsx)(X.Z,{size:"small",sx:{mr:1},label:"Nhập t\xean học sinh",value:l.text,onChange:e=>a(t=>({...t,text:e})),InputProps:{startAdornment:(0,s.jsx)(O.Z,{position:"start",children:(0,s.jsx)(j.Z,{icon:"tabler:search"})})}}),n?(0,s.jsxs)(X.Z,{select:!0,size:"small",sx:{mr:1},label:"Trạng th\xe1i",value:l.status,onChange:e=>a(t=>({...t,status:e})),children:[(0,s.jsx)(el.Z,{value:"all",children:"Tất cả"}),(0,s.jsx)(el.Z,{value:"doing",children:"Đang l\xe0m"}),(0,s.jsx)(el.Z,{value:"done",children:"Đ\xe3 xong"})]}):null,(0,s.jsx)(u.Z,{variant:"tonal",startIcon:(0,s.jsx)(j.Z,{fontSize:"1.25rem",icon:"tabler:cloud-download"}),onClick:t,children:"XUẤT EXCEL"})]})};var eU=n(1876).Buffer;let e$=e=>{let t=eU.from(e,"base64"),n=b().gunzipSync(t);return JSON.parse(n.toString())},eV=e=>{let{settings:t=[],questions:n=[]}=e;try{let e={quizs:[],groups:[],questions:[],settings:{collects:[],students:[]}};return n.forEach(t=>{t.quizs&&e.quizs.push(e$(t.quizs)),t.groups&&e.groups.push(e$(t.groups)),t.questions&&e.questions.push(e$(t.questions))}),t.forEach(t=>{t.settings&&(e.settings={...e.settings,...e$(t.settings),url:t.url,postId:t.postId}),t.collects&&e.settings.collects.push(e$(t.collects)),t.students&&e.settings.students.push(e$(t.students))}),e}catch(e){return console.log("parseRespone",e.message),{}}},eQ=e=>{let{exams:t,results:n}=e;try{let{questions:e}=t,{results:s}=n,l={};e.forEach(e=>{l[e.id]=e});let a={},o=[];return s.forEach(e=>{if(!a[null==e?void 0:null===(n=e.details)||void 0===n?void 0:n.ResultId]){a[null==e?void 0:null===(s=e.details)||void 0===s?void 0:s.ResultId]=1;let y=e$(null==e?void 0:null===(d=e.details)||void 0===d?void 0:d.details),I=e$(null==e?void 0:null===(h=e.securitys)||void 0===h?void 0:h.securitys),w=e$(null==e?void 0:null===(c=e.logs)||void 0===c?void 0:c.logs),E={rank:0,point:0,right:0,number:y.quizs[0].number,retake:null==e?void 0:null===(u=e.details)||void 0===u?void 0:u.Retake,time:(I.submitAt||ed()().valueOf())-I.startAt,startAt:I.startAt,submitAt:I.submitAt,total:0,link:(null==t?void 0:null===(x=t.settings)||void 0===x?void 0:x.url)+"?id="+(null==e?void 0:null===(p=e.details)||void 0===p?void 0:p.ResultId),points:0,student:e9({...null==e?void 0:e.details,details:y}),hidden:(null==I?void 0:null===(f=I.hidden)||void 0===f?void 0:f.length)||0,left:(null==I?void 0:null===(m=I.left)||void 0===m?void 0:m.length)||0,menu:(null==I?void 0:null===(g=I.right)||void 0===g?void 0:g.length)||0,offline:(null==w?void 0:w.filter(e=>(null==e?void 0:e.a)=="offline").length)||0,devices:(null==I?void 0:null===(v=I.devices)||void 0===v?void 0:v.map(e=>e.n))||[],ip:(null==I?void 0:null===(b=I.ips)||void 0===b?void 0:b.map(e=>e.n))||[],taked:0};if(E.label=e5(E.student),null==e?void 0:null===(C=e.details)||void 0===C?void 0:C.Username){var n,s,d,h,c,u,x,p,f,m,g,v,b,C,j,T={fullname:" Họ v\xe0 t\xean",classes:" Lớp",school:" Trường",username:" T\xean đăng nhập"};Object.keys(T).forEach(t=>{var n;E[T[t]]=null==e?void 0:null===(n=e.details)||void 0===n?void 0:n.Username[t]})}null==y||null===(j=y.collects)||void 0===j||j.forEach(e=>{E[e.label]=e.value}),y.questions.forEach((e,t)=>{let n=l[e.id];if(n){var s,a;let{isTrue:t,point:l}=e3(e,n);t&&E.right++,E.point+=["TL"].includes(n.type)?parseFloat(((null==y?void 0:y.points)||{})[n.id]||l):parseFloat(l),E.points+=parseFloat(n.point),E.total++,(null==e?void 0:null===(s=e.answers)||void 0===s?void 0:s.length)&&!(null==e?void 0:null===(a=e.answers)||void 0===a?void 0:a.includes(-1))&&E.taked++}}),o.push({...null==e?void 0:e.details,details:y,logs:w,securitys:I,overview:E})}}),o}catch(e){return console.log("parseResults",e.message),[]}},eK=e=>{let{results:t}=e;try{let e={};return t.forEach(t=>{var n,s;if(null==t?void 0:t.Username){var l={fullname:" Họ v\xe0 t\xean",classes:" Lớp",school:" Trường",username:" T\xean đăng nhập"};Object.keys(l).forEach(t=>{e[l[t]]=""})}null==t||null===(n=t.details)||void 0===n||null===(s=n.collects)||void 0===s||s.forEach(t=>{e[t.label]=""})}),e}catch(e){return console.log("parseLabels",e.message),{}}},eX=e=>{let{results:t}=e,n={total:t.length,students:0,points:0,times:0};try{let e={};return t.forEach(t=>{var s,l;e[t.UserToken]||(e[t.UserToken]=1),n.points+=parseFloat(null!==(l=null==t?void 0:null===(s=t.overview)||void 0===s?void 0:s.point)&&void 0!==l?l:0),n.times+=isNaN(null==t?void 0:t.overview.time)?0:null==t?void 0:t.overview.time}),n.students=Object.keys(e).length,{...n,points:parseFloat(n.points/n.total).toFixed(2),times:e4(parseInt(n.times/n.total))}}catch(e){return console.log("parseStatistic",e.message),n}},eJ=e=>{let{results:t,exams:n,filter:s=["start","submit"],all:l=!1}=e;try{let e=[],{questions:a}=n,o={};return a.forEach(e=>{o[e.id]=e}),t.forEach(t=>{e=e.concat([...t.logs,...Object.keys(t.securitys).reduce((e,n)=>e=n.includes("At")?e.concat([]):e.concat(t.securitys[n].map(e=>({...e,a:n}))),[])].map(e=>{var n=null;if("answers"===e.a){var s,l,a,{type:d}=null==o?void 0:o[null==e?void 0:null===(a=e.p)||void 0===a?void 0:a.id];n=d?{type:d}:null}return{...e,id:t.ResultId,student:null==t?void 0:null===(s=t.overview)||void 0===s?void 0:s.student,label:e5(null==t?void 0:null===(l=t.overview)||void 0===l?void 0:l.student),question:n}}))}),e.filter(e=>s.includes(e.a)||l).sort((e,t)=>e.t-t.t).map(e=>({label:e.label,t:e.t,id:e.id,item:e,text:e2(e)}))}catch(e){return console.log("parseLogs",e.message),[]}},e0=e=>{let{results:t,exams:n}=e;try{let{questions:e}=n,s={};return e.forEach(e=>{s[e.id]=e}),t.map(e=>{var t,l,a,o,d,h,c;let{details:u,logs:x,securitys:p}=e,f={rank:0,point:0,right:0,number:u.quizs[0].number,retake:null==e?void 0:e.Retake,time:(p.submitAt||ed()().valueOf())-p.startAt,startAt:p.startAt,submitAt:p.submitAt,total:0,link:(null==n?void 0:null===(t=n.settings)||void 0===t?void 0:t.url)+"?id="+(null==e?void 0:e.ResultId),points:0,student:e9(e),hidden:(null==p?void 0:null===(l=p.hidden)||void 0===l?void 0:l.length)||0,left:(null==p?void 0:null===(a=p.left)||void 0===a?void 0:a.length)||0,menu:(null==p?void 0:null===(o=p.right)||void 0===o?void 0:o.length)||0,offline:(null==x?void 0:x.filter(e=>(null==e?void 0:e.a)=="offline").length)||0,devices:(null==p?void 0:null===(d=p.devices)||void 0===d?void 0:d.map(e=>e.n))||[],ip:(null==p?void 0:null===(h=p.ips)||void 0===h?void 0:h.map(e=>e.n))||[],taked:0};if(f.label=e5(f.student),null==e?void 0:e.Username){var m={fullname:" Họ v\xe0 t\xean",classes:" Lớp",school:" Trường",username:" T\xean đăng nhập"};Object.keys(m).forEach(t=>{f[m[t]]=null==e?void 0:e.Username[t]})}return null==u||null===(c=u.collects)||void 0===c||c.forEach(e=>{f[e.label]=e.value}),u.questions.forEach((e,t)=>{let n=s[e.id];if(n){var l,a;let{isTrue:t,point:s}=e3(e,n);t&&f.right++,f.point+=["TL"].includes(n.type)?parseFloat(((null==u?void 0:u.points)||{})[n.id]||s):parseFloat(s),f.points+=parseFloat(n.point),f.total++,(null==e?void 0:null===(l=e.answers)||void 0===l?void 0:l.length)&&!(null==e?void 0:null===(a=e.answers)||void 0===a?void 0:a.includes(-1))&&f.taked++}}),{...e,overview:f}})}catch(e){return console.log("handleUpdateResultsRealtime",e.message),[]}},e1=e=>{let{results:t,exams:n,message:s}=e;try{let{action:e,ResultId:x,time:p,payload:f}=s,m=t.find(e=>e.ResultId==x);if(!m)return null;var l=null!==(d=null==m?void 0:null===(o=m.overview)||void 0===o?void 0:o.student)&&void 0!==d?d:"",a=null;if("answers"==e){var o,d,h,{type:c}=null==n?void 0:null===(h=n.questions)||void 0===h?void 0:h.find(e=>e.id==f.id);a=c?{type:c}:null}var u=e2({a:e,student:l,p:f,question:a});if(!u)return null;return{label:e5(l),t:p,id:x,text:u}}catch(e){return console.log("handleUpdateLogs",e.message),null}},e2=e=>{let{a:t,student:n,n:s,p:l,question:a}=e;switch(t){case"devices":return'Bạn <b style="color:red">'.concat(n,'</b> đ\xe3 truy cập bằng <b style="color:green">').concat(s,"</b>.");case"ips":return'Bạn <b style="color:red">'.concat(n,'</b> đ\xe3 truy cập địa chỉ IP <b style="color:green">').concat(s,"</b>.");case"left":return'Bạn <b style="color:red">'.concat(n,"</b> đ\xe3 nhấn chuột tr\xe1i.");case"right":return'Bạn <b style="color:red">'.concat(n,"</b> đ\xe3 nhấn chuột phải.");case"shortcut":return'Bạn <b style="color:red">'.concat(n,"</b> đ\xe3 sử dụng ph\xedm tắt.");case"hidden":return'Bạn <b style="color:red">'.concat(n,"</b> đ\xe3 tho\xe1t khỏi m\xe0n h\xecnh l\xe0m b\xe0i.");case"visible":return'Bạn <b style="color:red">'.concat(n,"</b> đ\xe3 quay trở lại m\xe0n h\xecnh l\xe0m b\xe0i.");case"start":return'Bạn <b style="color:red">'.concat(n,"</b> đ\xe3 bắt đầu l\xe0m b\xe0i thi.");case"online":return'Bạn <b style="color:red">'.concat(n,"</b> đ\xe3 kết nối mạng trở lại (online).");case"offline":return'Bạn <b style="color:red">'.concat(n,"</b> đ\xe3 ngắt kết nối mạng (offline)");case"submit":return'Bạn <b style="color:red">'.concat(n,'</b> đ\xe3 nộp b\xe0i thi <b style="color:green">(').concat((e=>{switch(e){case"teacher":return"GV buộc dừng";case"user":return"HS tự nộp";case"autotimeout":case"timeout":return"Hết giờ";case"tabs":return"Chuyển tabs"}return"Chưa x\xe1c định"})(null==l?void 0:l.s),")</b>.");case"answers":if(!a)return'Bạn <b style="color:red">'.concat(n,"</b> đ\xe3 trả lời c\xe2u hỏi");switch(null==a?void 0:a.type){case"TN":return'Bạn <b style="color:red">'.concat(n,'</b> đ\xe3 trả lời <b style="color:#7367F0">C\xc2U ').concat(null==l?void 0:l.n," PHẦN ").concat((null==l?void 0:l.g)+1,'</b> chọn <b style="color:green">"').concat(String.fromCharCode(65+(null==l?void 0:l.v)*1),'"</b>');case"DT":case"TL":return'Bạn <b style="color:red">'.concat(n,'</b> đ\xe3 trả lời <b style="color:#7367F0">C\xc2U ').concat(null==l?void 0:l.n," PHẦN ").concat((null==l?void 0:l.g)+1,'</b> với nội dung <b style="color:green">"').concat(null==l?void 0:l.v,'"</b>');case"HK":return'Bạn <b style="color:red">'.concat(n,'</b> đ\xe3 trả lời <b style="color:#7367F0">C\xc2U ').concat(null==l?void 0:l.n," PHẦN ").concat((null==l?void 0:l.g)+1,"</b> ").concat((null==l?void 0:l.t)=="r"?"bỏ":"",' chọn <b style="color:green">"').concat(String.fromCharCode(65+(null==l?void 0:l.v)*1),'"</b>');case"TF":return'Bạn <b style="color:red">'.concat(n,'</b> đ\xe3 trả lời <b style="color:#7367F0">C\xc2U ').concat(null==l?void 0:l.n," PHẦN ").concat((null==l?void 0:l.g)+1,"</b> \xfd ").concat(String.fromCharCode(97+(null==l?void 0:l.p)*1),' chọn <b style="color:green">"').concat((null==l?void 0:l.v)=="T"?"Đ\xfang":"Sai",'"</b>')}return'Bạn <b style="color:red">'.concat(n,'</b> đ\xe3 trả lời <b style="color:#7367F0">C\xc2U ').concat(null==l?void 0:l.n," PHẦN ").concat((null==l?void 0:l.g)+1,"</b> chọn ")}return""},e5=e=>{try{return e.split(" ").map(e=>e.substr(0,1)).filter(e=>e).map(e=>e.toLocaleUpperCase()).join("").substr(-3)}catch(e){return""}},e4=e=>Math.floor(e/36e5).toString().padStart(2,"0")+":"+Math.floor((e%=36e5)/6e4).toString().padStart(2,"0")+":"+Math.floor((e%=6e4)/1e3).toString().padStart(2,"0"),e3=(e,t)=>{let n=!1,s=t.point,l=[];switch(t.type){case"TN":n=(null==e?void 0:e.sorts.filter((n,s)=>t.options[n].keys&&((null==e?void 0:e.answers)||[]).includes(s)).length)===1;break;case"HK":n=(null==e?void 0:e.sorts.filter(e=>{var n;return null===(n=null==t?void 0:t.options[e])||void 0===n?void 0:n.keys}).length)===(null==e?void 0:e.sorts.filter((n,s)=>{var l;return(null===(l=null==t?void 0:t.options[n])||void 0===l?void 0:l.keys)&&((null==e?void 0:e.answers)||[]).includes(s)}).length);break;case"DT":n=(null==t?void 0:t.options.filter(n=>{var s,l,a,o=n.text,[d=""]=(null==e?void 0:e.answers)||[];return(null==t?void 0:null===(s=t.settings)||void 0===s?void 0:s.sign)&&(o=removeAccents(o),d=removeAccents(d)),(null==t?void 0:null===(l=t.settings)||void 0===l?void 0:l.upper)&&(o=o.toLowerCase(),d=d.toLowerCase()),(null==t?void 0:null===(a=t.settings)||void 0===a?void 0:a.space)&&(o=o.replace(/\s/g,""),d=d.replace(/\s/g,"")),o==d}).length)>0;break;case"TF":var a=null==e?void 0:e.sorts.filter((n,s)=>t.options[n].keys===((null==e?void 0:e.answers)||[])[s]).length;s=[0,.1,.25,.5,1][a]*t.point,n=a===t.options.length}return n||"TF"===t.type||(s=0),l=null==e?void 0:e.sorts.map((n,s)=>{let l="",a=t.options[n],o=(null==e?void 0:e.answers)||[];switch(t.type){case"TN":o[0]===s&&(l="error"),a.keys&&(l="right",o.length||(l="none"));break;case"HK":o.includes(s)&&(l="error"),a.keys&&(l="right",o.length||(l="none"));break;case"DT":break;case"TF":if(l=["",""],o[s]){if(o[s]==a.keys)switch(a.keys){case"T":l[0]="right";break;case"F":l[1]="right"}else switch(a.keys){case"T":l=["right","error"];break;case"F":l=["error","right"]}}else switch(a.keys){case"T":l[0]="none";break;case"F":l[1]="none"}}return{...a,user:l,postion:n}}),"DT"==t.type&&(l=t.options),{isTrue:n,point:s,options:l}},e9=e=>{try{var t,n,s,l,a;if(null==e?void 0:null===(t=e.details)||void 0===t?void 0:null===(n=t.collects)||void 0===n?void 0:n.length)return null==e?void 0:null===(s=e.details)||void 0===s?void 0:s.collects.find(e=>/tên|name/i.test(e.label)).value;if(null==e?void 0:e.Username)return(null==e?void 0:null===(l=e.Username)||void 0===l?void 0:l.fullname)||(null==e?void 0:null===(a=e.Username)||void 0===a?void 0:a.username);return e.ResultId}catch(e){return console.log("getNameStudent",e.message),""}},e6=e=>{let{result:t,exams:n}=e,{questions:s,groups:l}=n,a={};s.forEach(e=>{a[e.id]=e});let{details:o}=t;return o.questions=o.questions.map((e,n)=>{var s,o=a[null==e?void 0:e.id]||{};let{isTrue:d,point:h,options:c}=e3(e,o);var u=l.find(e=>e.id==o.groupId);return{...e,...o,point:h,isTrue:d,options:c,numberUser:(null==u?void 0:u.order)?u.questions.findIndex(t=>t==e.id)+1:n+1,teacher:["TL"].includes(o.type)?parseFloat(((null===(s=t.details)||void 0===s?void 0:s.points)||{})[e.id]||h):void 0,maxPoint:["TL"].includes(o.type)?o.point:void 0}}),{...t,details:o}},e8=e=>{let{results:t,labelColumn:n,handleClick:l,realtime:o=!1}=e,[p,f]=(0,a.useState)([]),[m,g]=(0,a.useState)({page:0,pageSize:25}),[v,b]=(0,a.useState)([]),[T,y]=(0,a.useState)({status:"all",text:""}),I=(0,a.useRef)(),w=(0,eD.A)();(0,a.useEffect)(()=>{f(t)},[t]),(0,a.useEffect)(()=>{b(Object.keys(n))},[n]),(0,a.useEffect)(()=>(I.current&&I.current.terminate(),fetch("".concat(C.default.assetPrefix,"/scripts/worker.export.").concat(C.default.version,".js")).then(e=>e.blob()).then(e=>{I.current=new Worker(URL.createObjectURL(e)),I.current.onmessage=async e=>{let{action:t="",payload:n=null}=e.data;if("excel"===t){let e=new Blob([n],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),t=window.URL.createObjectURL(e),s=document.createElement("a");s.href=t,s.download="".concat(document.title,".xlsx"),document.body.appendChild(s),s.click(),window.URL.revokeObjectURL(t)}}}),()=>{I.current&&I.current.terminate()}),[]);let E=[{flex:.1,minWidth:160,sortable:!1,field:"actions",headerName:"",renderCell:e=>{let{row:t}=e;return(0,s.jsxs)(d.Z,{sx:{display:"flex",alignItems:"center"},children:[(0,s.jsx)(c.Z,{title:"Xem b\xe0i l\xe0m",children:(0,s.jsx)(x.Z,{size:"small",sx:{color:"primary.main"},onClick:l(t.id,"view"),children:(0,s.jsx)(j.Z,{icon:"tabler:eye"})})}),(0,s.jsx)(c.Z,{title:"Lịch sử b\xe0i l\xe0m",children:(0,s.jsx)(x.Z,{size:"small",sx:{color:"success.main"},onClick:l(t.id,"history"),children:(0,s.jsx)(j.Z,{icon:"tabler:mist"})})}),(0,s.jsx)(c.Z,{title:"X\xf3a b\xe0i l\xe0m",children:(0,s.jsx)(x.Z,{size:"small",sx:{color:"error.main"},onClick:l(t,"remove"),children:(0,s.jsx)(j.Z,{icon:"tabler:circle-x"})})})]})}},{flex:.175,minWidth:110,field:"rank",headerName:"Xếp hạng",renderCell:e=>(0,s.jsx)(h.Z,{variant:"body2",sx:{color:"text.primary"},children:e.row.rank})},{flex:.175,minWidth:110,field:"point",headerName:"Điểm",renderCell:e=>(0,s.jsx)(h.Z,{variant:"body2",sx:{color:"text.primary"},children:parseFloat(e.row.point).toFixed(2)})},...v.map(e=>({flex:1,minWidth:250,field:e,headerName:e,renderCell:t=>(0,s.jsx)(h.Z,{variant:"body2",sx:{color:"text.primary"},children:t.row[e]})})),{flex:.175,minWidth:110,field:"right",headerName:"Số c\xe2u đ\xfang",renderCell:e=>(0,s.jsx)(h.Z,{variant:"body2",sx:{color:"text.primary"},children:e.row.right})},{flex:.175,minWidth:110,field:"number",headerName:"Đề số",renderCell:e=>(0,s.jsx)(h.Z,{variant:"body2",sx:{color:"text.primary"},children:e.row.number})},{flex:.175,minWidth:110,field:"retake",headerName:"Lần l\xe0m",renderCell:e=>(0,s.jsx)(h.Z,{variant:"body2",sx:{color:"text.primary"},children:e.row.retake})},{flex:.175,minWidth:110,field:"time",headerName:"Thời gian l\xe0m b\xe0i",renderCell:e=>(0,s.jsx)(h.Z,{variant:"body",sx:{color:"text.primary"},children:e4(e.row.time)})},{flex:.175,minWidth:180,field:"startAt",headerName:"Bắt đầu l\xfac",renderCell:e=>(0,s.jsx)(h.Z,{variant:"body2",sx:{color:"text.primary"},children:eY(e.row.startAt).format("HH:mm:ss DD/MM/YYYY")})},{flex:.175,minWidth:180,field:"submitAt",headerName:"Nộp b\xe0i l\xfac",renderCell:e=>(0,s.jsx)(h.Z,{variant:"body2",sx:{color:"text.primary"},children:e.row.submitAt&&eY(e.row.submitAt).format("HH:mm:ss DD/MM/YYYY")})},{flex:.175,minWidth:350,field:"link",headerName:"Link b\xe0i l\xe0m",renderCell:e=>(0,s.jsx)(h.Z,{variant:"body2",sx:{color:"text.primary"},children:(0,s.jsx)("a",{href:e.row.link,target:"_blank",style:{textDecoration:"none"},children:e.row.link})})},{flex:.175,minWidth:150,field:"hidden",headerName:"Số lần chuyển tabs",renderCell:e=>(0,s.jsx)(h.Z,{variant:"body2",sx:{color:"text.primary"},children:e.row.hidden})},{flex:.175,minWidth:150,field:"offline",headerName:"Số lần Offline",renderCell:e=>(0,s.jsx)(h.Z,{variant:"body2",sx:{color:"text.primary"},children:e.row.offline})},{flex:.175,minWidth:150,field:"devices",headerName:"Thiết bị",renderCell:e=>(0,s.jsx)(h.Z,{variant:"body2",sx:{color:"text.primary"},children:e.row.devices.join(", ")})},{flex:.175,minWidth:150,field:"ip",headerName:"Địa chỉ IP",renderCell:e=>(0,s.jsx)(h.Z,{variant:"body2",sx:{color:"text.primary"},children:e.row.ip.join(", ")})}];o&&E.push({flex:.175,minWidth:110,field:"status",headerName:"Trạng th\xe1i",renderCell:e=>{var t;return(null===(t=e.row)||void 0===t?void 0:t.submitAt)?(0,s.jsx)(u.Z,{variant:"tonal",color:"success",children:"Đ\xe3 xong"}):(0,s.jsx)(u.Z,{variant:"tonal",color:"error",children:"Đang l\xe0m"})}});let A=()=>{if(I.current){let e=(e,t)=>{if(!t)return"";switch(e){case"ip":case"devices":return t.join(", ");case"startAt":case"submitAt":return eY(t).format("HH:mm:ss DD/MM/YYYY");case"time":return e4(t)}return t};I.current.postMessage({action:"excel",payload:{results:t.map(t=>{let n={};return E.forEach(s=>{n[null==s?void 0:s.headerName]=e(null==s?void 0:s.field,t[null==s?void 0:s.field])}),n})}})}else P().fire({icon:"error",title:"Xảy ra lỗi",text:"Li\xean hệ quản trị vi\xean để được hỗ trợ."})};return(0,s.jsxs)(ek.Z,{children:[(0,s.jsx)(K.Z,{title:"Bảng điểm",action:(0,s.jsx)(eW,{exportTable:A,realtime:o,filter:T,setFilter:y})}),(0,s.jsx)(et._,{autoHeight:!0,pagination:!0,rows:p.filter(e=>{var t,n,s;return null!==(t=null==e?void 0:null===(n=e.student)||void 0===n?void 0:n.toString())&&void 0!==t&&!!t.toLocaleLowerCase().includes(null===(s=T.text.toString())||void 0===s?void 0:s.toLocaleLowerCase())&&("doing"==T.status?!e.submitAt:"done"!=T.status||e.submitAt)}),disableColumnFilter:!0,disableColumnMenu:!0,columns:E,pageSizeOptions:[25,50,100],paginationModel:m,onPaginationModelChange:g,apiRef:w})]})};var e7=a.memo(e8),te=n(7494),tt=n(7413),tn=n(2162),ts=n(9601),ti=n(1221),tr=n(6599);let tl=(0,L.ZP)(tr.Z)({"& .MuiTimelineItem-root":{width:"100%","&:before":{display:"none"}}}),ta=(0,L.ZP)(d.Z)(e=>{let{theme:t}=e;return{display:"flex",alignItems:"center",padding:t.spacing(3),justifyContent:"space-between",backgroundColor:"#F8F8F8"}}),to=e=>{var t,n,l,a;let{details:o,handleClose:c,handleClick:p}=e;return(0,s.jsxs)(eE.ZP,{open:!0,anchor:"right",variant:"temporary",onClose:c,ModalProps:{keepMounted:!0},sx:{"& .MuiDrawer-paper":{width:{md:"50%",xs:"95%"}}},children:[(0,s.jsxs)(ta,{children:[(0,s.jsxs)(h.Z,{variant:"h5",children:["Lịch sử l\xe0m b\xe0i của: ",null==o?void 0:null===(t=o.payload)||void 0===t?void 0:t.student]}),(0,s.jsx)(x.Z,{size:"small",onClick:c,sx:{p:"0.438rem",borderRadius:1,color:"text.primary",backgroundColor:"action.selected","&:hover":{backgroundColor:e=>"rgba(".concat(e.palette.customColors.main,", 0.16)")}},children:(0,s.jsx)(j.Z,{icon:"tabler:x",fontSize:"1.125rem"})})]}),(0,s.jsx)(d.Z,{sx:{mt:3,px:3},children:(0,s.jsx)(tl,{children:null==o?void 0:null===(n=o.payload)||void 0===n?void 0:null===(l=n.logs)||void 0===l?void 0:l.map((e,t)=>(0,s.jsxs)(tt.Z,{children:[(0,s.jsxs)(ts.Z,{children:[(0,s.jsx)(te.Z,{color:"error"}),(0,s.jsx)(ti.Z,{})]}),(0,s.jsxs)(tn.Z,{sx:{"& svg":{verticalAlign:"bottom",mx:4}},children:[(0,s.jsx)(d.Z,{sx:{mb:2,display:"flex",flexWrap:"wrap",alignItems:"center",justifyContent:"space-between"},children:(0,s.jsx)(h.Z,{sx:{mr:2},variant:"h5",dangerouslySetInnerHTML:{__html:e.text}})}),(0,s.jsx)(d.Z,{children:(0,s.jsx)(h.Z,{variant:"body",sx:{color:"text.disabled"},children:ed()(e.t).format("HH:mm:ss DD/MM/YYYY")})})]})]},t))})}),(0,s.jsx)(ta,{sx:{justifyContent:"flex-end"},children:(0,s.jsx)(u.Z,{onClick:p(null==o?void 0:null===(a=o.payload)||void 0===a?void 0:a.id,"view"),variant:"contained",startIcon:(0,s.jsx)(j.Z,{icon:"tabler:eye"}),children:"Chi tiết b\xe0i l\xe0m"})})]})};var td=a.memo(to),th=n(7720),tc=n(8462),tu=n(9294),tx=n(1008);n(8594);var tp=n(5600);let tf=e=>{let t=(e,t)=>{for(var n;null!==(n=t.exec(e));){var s=n[1],l=document.createElement("span");l.setAttribute("class","ql-formula"),l.setAttribute("data-value",s),e=e.replace(n[0],l.outerHTML)}return e};return e=t(e,/\$([^$]+)\$/g),e=t(e,/\\\((.*?)\\\)/g),(e=t(e,/\\\[(.*?)\\\]/g)).replace(/′/g,"'").replace(/\u2009/g," ").replace(/\u2004/g," ").replace(/\u00AF/g,"-")},tm=()=>{let e=document.querySelectorAll(".ql-formula");e.forEach(e=>{try{let t=e.getAttribute("data-value");t&&(e.innerHTML=tx.Z.renderToString(t,{throwOnError:!1}))}catch(e){console.log(e.message)}})},tg=e=>{var t,n,l;let{details:o,updatePoint:c}=e;return(0,a.useEffect)(()=>{if(o){let e=e=>{let{link:t,data:n}=e;return new Promise(e=>{fetch(t).then(e=>e.blob()).then(t=>{let s=new Image;s.src=URL.createObjectURL(t),s.onload=function(){var t=document.createElement("canvas"),l=t.getContext("2d");t.width=n.width,t.height=n.height,l.drawImage(s,n.x,n.y,n.width,n.height,0,0,n.width,n.height),t.toBlob(t=>{e(URL.createObjectURL(t))},"image/png")}}).catch(t=>{console.error("Error fetching image:",t),e("")})})},t=async()=>{try{let s=document.querySelectorAll(".quill-image");for(var t=0;t<s.length;t++){var n=s[t];if(!n.getAttribute("src")){let{link:t,data:s}=JSON.parse(n.getAttribute("data-value")),l=await e({link:t,data:s});n.setAttribute("src",l)}}}catch(e){console.log("renderImage",e.message)}};t(),tm()}},[o]),null==o?void 0:null===(t=o.payload)||void 0===t?void 0:null===(n=t.details)||void 0===n?void 0:null===(l=n.groups)||void 0===l?void 0:l.map(e=>{var t,n,l,a;return(0,s.jsxs)(ek.Z,{sx:{mt:10,background:"unset"},children:[e.content&&(null==o?void 0:null===(t=o.payload)||void 0===t?void 0:null===(n=t.details)||void 0===n?void 0:n.groups.length)>1?(0,s.jsx)(Q.Z,{dangerouslySetInnerHTML:{__html:tf(e.content)},sx:{px:{xs:1,md:3}}}):null,(0,s.jsx)(Q.Z,{sx:{padding:0,":last-of-type":{pb:0}},children:null==o?void 0:null===(l=o.payload)||void 0===l?void 0:null===(a=l.details)||void 0===a?void 0:a.questions.filter(t=>t.groupId==e.id).map((e,t)=>{var n,l;return(0,s.jsxs)(ek.Z,{sx:{mb:5,":last-of-type":{mb:0}},id:e.id,children:[(0,s.jsx)(K.Z,{title:(0,s.jsxs)(h.Z,{variant:"body",sx:{fontWeight:700,color:"primary.main",whiteSpace:"nowrap"},component:"span",children:[e.label||"C\xe2u"," ",e.numberUser," (",e.number,")."]}),action:(0,s.jsxs)(d.Z,{sx:{display:"flex",alignItems:"center"},children:[["TN","HK"].includes(e.type)?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(tp.Z,{rounded:!0,label:"Đ\xe1p \xe1n đ\xfang: "+(null==e?void 0:null===(n=e.options)||void 0===n?void 0:n.map((e,t)=>(null==e?void 0:e.keys)?"".concat(String.fromCharCode(65+t)," (").concat(String.fromCharCode(65+e.postion),")"):"").filter(e=>e).join(", ")),skin:"light",color:"success"}),(0,s.jsx)(tp.Z,{rounded:!0,label:"Đ\xe3 chọn: "+((null==e?void 0:e.answers)?null==e?void 0:null===(l=e.answers)||void 0===l?void 0:l.map(t=>{var n=null==e?void 0:e.options[t];return"".concat(String.fromCharCode(65+t)," (").concat(String.fromCharCode(65+n.postion),")")}).join(", "):""),skin:"light",color:e.isTrue?"success":"error",sx:{mx:1}})]}):null,["TL"].includes(e.type)?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(tp.Z,{rounded:!0,label:"GV chấm:",skin:"light",color:"info"}),(0,s.jsx)(X.Z,{type:"number",size:"small",sx:{width:"auto",maxWidth:"8rem",mx:2},value:e.teacher||0,InputProps:{inputProps:{min:0,max:parseFloat(e.maxPoint),step:.01},endAdornment:(0,s.jsx)(O.Z,{position:"end",children:"điểm"})},onChange:t=>c(e.id,{teacher:t}),timeout:300}),(0,s.jsx)(tp.Z,{rounded:!0,label:"Tối đa: ".concat(parseFloat(e.maxPoint).toFixed(2)," điểm"),skin:"light",color:"success"})]}):(0,s.jsx)(h.Z,{variant:"body",sx:{fontWeight:700,color:e.isTrue?"success.main":"error.main"},children:-1==e.point?"":parseFloat(e.point).toFixed(2)+" điểm"})]}),sx:{paddingY:3,px:{xs:1,sm:2,md:3},overflowX:"auto"}}),(0,s.jsx)(Q.Z,{dangerouslySetInnerHTML:{__html:tf(e.content)},sx:{" p":{m:0},p:{xs:1,md:2}}}),(0,s.jsx)(Q.Z,{sx:{px:{xs:1,md:2},mt:3},children:(0,s.jsxs)(tc.Z,{disablePadding:!0,children:[["TN","HK"].includes(e.type)?e.options.map((e,t)=>(0,s.jsxs)(tu.ZP,{sx:{borderRadius:1,mb:1,border:"1px solid #b2b2b299",px:{xs:1,md:2}},user:e.user||"",children:[(0,s.jsx)(es.Z,{children:(0,s.jsxs)(en.Z,{skin:(null==e?void 0:e.user)?"static":"light",sx:{fontWeight:600},children:[String.fromCharCode(65+t)," (",String.fromCharCode(65+e.postion),")"]})}),(0,s.jsx)(d.Z,{dangerouslySetInnerHTML:{__html:tf(e.text)},sx:{" p":{m:0},flexGrow:1}})]},t)):null,"TF"==e.type?e.options.map((e,t)=>(0,s.jsxs)(tu.ZP,{divider:!0,sx:{gap:1,cursor:"default",paddingX:2},children:[(0,s.jsx)(en.Z,{skin:"light",user:(null==e?void 0:e.user[0])||"",children:"Đ"}),(0,s.jsx)(en.Z,{skin:"light",user:(null==e?void 0:e.user[1])||"",children:"S"}),(0,s.jsxs)(en.Z,{skin:"light",color:"secondary",sx:{fontWeight:600},children:[String.fromCharCode(97+t)," (",String.fromCharCode(97+(null==e?void 0:e.postion)),")"]}),(0,s.jsx)(d.Z,{dangerouslySetInnerHTML:{__html:tf(e.text)},sx:{" p":{m:0},flexGrow:1}})]},t)):null]})}),"TL"==e.type?(0,s.jsxs)(Q.Z,{sx:{px:2},children:[(0,s.jsx)(th.Z,{sx:{fontWeight:600},children:"B\xe0i l\xe0m của học sinh"}),(0,s.jsx)(d.Z,{dangerouslySetInnerHTML:{__html:tf(((null==e?void 0:e.answers)||[])[0]||"")},sx:{" p":{m:0}}})]}):null,"DT"==e.type?(0,s.jsx)(Q.Z,{sx:{px:2},children:(0,s.jsxs)(S.ZP,{container:!0,spacing:3,children:[(0,s.jsxs)(S.ZP,{item:!0,xs:12,md:6,children:[(0,s.jsx)(th.Z,{sx:{fontWeight:600},children:"Đ\xe1p \xe1n của học sinh"}),(0,s.jsx)(d.Z,{dangerouslySetInnerHTML:{__html:tf(((null==e?void 0:e.answers)||[])[0]||"")},sx:{" p":{m:0}}})]}),(0,s.jsx)(S.ZP,{item:!0,xs:12,md:6,sx:{color:"success.main"},children:e.options.length?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(th.Z,{sx:{fontWeight:600},children:"Đ\xe1p \xe1n đ\xfang"}),e.options.map((e,t)=>(0,s.jsxs)(h.Z,{variant:"body",children:[e.text," |"," "]},t))]}):null})]})}):null]},e.id)})})]},e.id)})};var tv=a.memo(tg),tb=n(3395);let tC=e=>{var t,n,l;let{details:o}=e,{points:d}=null==o?void 0:null===(t=o.payload)||void 0===t?void 0:t.overview,{overview:h}=null==o?void 0:o.payload,{collects:c=[]}=null==o?void 0:null===(n=o.payload)||void 0===n?void 0:n.details,u=null==o?void 0:null===(l=o.payload)||void 0===l?void 0:l.Username,[x,p]=(0,a.useState)(0);return(0,a.useEffect)(()=>{var e,t,n;let s=null==o?void 0:null===(e=o.payload)||void 0===e?void 0:null===(t=e.details)||void 0===t?void 0:null===(n=t.questions)||void 0===n?void 0:n.reduce((e,t)=>e+=parseFloat(t.teacher||t.point),0);p(s||0)},[o]),(0,s.jsxs)(S.ZP,{container:!0,spacing:3,sx:{px:3},children:[(0,s.jsxs)(S.ZP,{item:!0,xs:12,md:4,children:[(0,s.jsx)(th.Z,{children:"ĐIỂM"}),(0,s.jsx)(eR,{series:[parseFloat(100*x/d||0).toFixed(2)],options:{chart:{height:300,type:"radialBar",sparkline:{enabled:!0}},colors:["#51e5a8"],plotOptions:{radialBar:{offsetY:-10,startAngle:-150,endAngle:150,hollow:{margin:0,size:"75%"},track:{background:"#ebe9f1",strokeWidth:"50%",margin:0},dataLabels:{show:!0,name:{show:!1,color:"#5e5873",fontSize:"2.86rem"},value:{formatter:e=>parseFloat(e*d/100||0).toFixed(2),color:"#5e5873",fontSize:"2.86rem",show:!0}}}},fill:{type:"gradient",gradient:{shade:"dark",type:"horizontal",shadeIntensity:.5,gradientToColors:["#51e5a8"],inverseColors:!0,opacityFrom:1,opacityTo:1,stops:[0,100]}},stroke:{lineCap:"round"},labels:[""],grid:{padding:{bottom:30}}},type:"radialBar",height:300})]}),(0,s.jsxs)(S.ZP,{item:!0,xs:12,md:4,children:[u?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(th.Z,{sx:{mt:2},children:"TH\xd4NG TIN TH\xcd SINH"}),(0,s.jsxs)(tc.Z,{children:[(0,s.jsx)(tu.ZP,{disablePadding:!0,children:(0,s.jsxs)(es.Z,{sx:{alignItems:"center",color:"primary.main"},children:[(0,s.jsx)(j.Z,{icon:"tabler:user-bolt",fontSize:20}),(0,s.jsxs)(ei.Z,{sx:{fontWeight:600,ml:1},disableTypography:!0,children:["Họ v\xe0 t\xean: ",null==u?void 0:u.fullname]})]})}),(0,s.jsx)(tu.ZP,{disablePadding:!0,children:(0,s.jsxs)(es.Z,{sx:{alignItems:"center",color:"primary.main"},children:[(0,s.jsx)(j.Z,{icon:"tabler:cash-banknote",fontSize:20}),(0,s.jsxs)(ei.Z,{sx:{fontWeight:600,ml:1},disableTypography:!0,children:["Lớp: ",null==u?void 0:u.classes]})]})}),(0,s.jsx)(tu.ZP,{disablePadding:!0,children:(0,s.jsxs)(es.Z,{sx:{alignItems:"center",color:"primary.main"},children:[(0,s.jsx)(j.Z,{icon:"tabler:school",fontSize:20}),(0,s.jsxs)(ei.Z,{sx:{fontWeight:600,ml:1},disableTypography:!0,children:["Trường: ",null==u?void 0:u.school]})]})})]})]}):null,c.length?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(th.Z,{children:"TH\xd4NG TIN THU THẬP"}),(0,s.jsx)(tc.Z,{children:c.map((e,t)=>(0,s.jsx)(tu.ZP,{disablePadding:!0,children:(0,s.jsxs)(es.Z,{sx:{alignItems:"center",color:"primary.main"},children:[(0,s.jsx)(j.Z,{icon:"tabler:point",fontSize:20}),(0,s.jsxs)(ei.Z,{sx:{fontWeight:600,ml:1},disableTypography:!0,children:[null==e?void 0:e.label,": ",null==e?void 0:e.value]})]})},t))})]}):null]}),(0,s.jsxs)(S.ZP,{item:!0,xs:12,md:4,children:[(0,s.jsx)(th.Z,{children:"TH\xd4NG TIN B\xc0I THI"}),(0,s.jsxs)(tc.Z,{children:[(0,s.jsx)(tu.ZP,{disablePadding:!0,children:(0,s.jsxs)(es.Z,{sx:{alignItems:"center",color:"warning.main"},children:[(0,s.jsx)(j.Z,{icon:"tabler:clock",fontSize:20}),(0,s.jsx)(ei.Z,{sx:{fontWeight:600,ml:1},disableTypography:!0,children:"Thời gian l\xe0m b\xe0i:"}),(0,s.jsx)(tb.Z,{sx:{fontWeight:600,fontSize:"1.2rem"},children:e4(h.time)})]})}),(0,s.jsx)(tu.ZP,{disablePadding:!0,children:(0,s.jsxs)(es.Z,{sx:{alignItems:"center"},children:[(0,s.jsx)(j.Z,{icon:"tabler:clock",fontSize:20}),(0,s.jsxs)(ei.Z,{sx:{fontWeight:600,ml:1},disableTypography:!0,children:["Bắt đầu l\xfac: ",ed()(h.startAt).format("HH:mm:ss DD/MM/YYYY")]})]})}),(0,s.jsx)(tu.ZP,{disablePadding:!0,children:(0,s.jsxs)(es.Z,{sx:{alignItems:"center"},children:[(0,s.jsx)(j.Z,{icon:"tabler:clock",fontSize:20}),(0,s.jsxs)(ei.Z,{sx:{fontWeight:600,ml:1},disableTypography:!0,children:["Nộp b\xe0i l\xfac: ",ed()(h.submitAt).format("HH:mm:ss DD/MM/YYYY")]})]})}),(0,s.jsx)(tu.ZP,{disablePadding:!0,children:(0,s.jsxs)(es.Z,{sx:{alignItems:"center",color:"success.main"},children:[(0,s.jsx)(j.Z,{icon:"tabler:circle-check",fontSize:20}),(0,s.jsx)(ei.Z,{sx:{fontWeight:600,ml:1},disableTypography:!0,children:"Số c\xe2u trắc nghiệm đ\xfang"}),(0,s.jsx)(tb.Z,{sx:{fontWeight:600,fontSize:"1.2rem"},children:h.right})]})}),(0,s.jsx)(tu.ZP,{disablePadding:!0,children:(0,s.jsxs)(es.Z,{sx:{alignItems:"center",color:"error.main"},children:[(0,s.jsx)(j.Z,{icon:"tabler:circle-x",fontSize:20}),(0,s.jsx)(ei.Z,{sx:{fontWeight:600,ml:1},disableTypography:!0,children:"Số c\xe2u trắc nghiệm sai"}),(0,s.jsx)(tb.Z,{sx:{fontWeight:600,fontSize:"1.2rem"},children:h.error})]})}),(0,s.jsx)(tu.ZP,{disablePadding:!0,children:(0,s.jsxs)(es.Z,{sx:{alignItems:"center"},children:[(0,s.jsx)(j.Z,{icon:"tabler:sum",fontSize:20}),(0,s.jsx)(ei.Z,{sx:{fontWeight:600,ml:1},disableTypography:!0,children:"Tổng số c\xe2u hỏi trong đề"}),(0,s.jsx)(tb.Z,{sx:{fontWeight:600,fontSize:"1.2rem"},children:h.total})]})}),(0,s.jsx)(tu.ZP,{disablePadding:!0,children:(0,s.jsxs)(es.Z,{sx:{alignItems:"center"},children:[(0,s.jsx)(j.Z,{icon:"tabler:sum",fontSize:20}),(0,s.jsx)(ei.Z,{sx:{fontWeight:600,ml:1},disableTypography:!0,children:"Đề số"}),(0,s.jsx)(tb.Z,{sx:{fontWeight:600,fontSize:"1.2rem"},children:h.number})]})}),(0,s.jsx)(tu.ZP,{disablePadding:!0,children:(0,s.jsxs)(es.Z,{sx:{alignItems:"center"},children:[(0,s.jsx)(j.Z,{icon:"tabler:sum",fontSize:20}),(0,s.jsx)(ei.Z,{sx:{fontWeight:600,ml:1,a:{textDecoration:"none"}},disableTypography:!0,children:"Link b\xe0i l\xe0m:"}),(0,s.jsx)(tb.Z,{sx:{fontWeight:600,fontSize:"1.2rem",a:{textDecoration:"none"}},children:(0,s.jsx)("a",{href:h.link,target:"_blank",children:"Click để xem"})})]})})]})]})]})},tj=(0,L.ZP)(d.Z)(e=>{let{theme:t}=e;return{display:"flex",alignItems:"center",padding:t.spacing(3),justifyContent:"space-between",backgroundColor:"#F8F8F8"}}),tT=e=>{var t,n,l,o;let{details:c,handleClose:p,handleClick:f,saveResults:m,realtime:g}=e,[v,b]=(0,a.useState)(c);(0,a.useEffect)(()=>{var e;b(c),sessionStorage.removeItem("results_"+(null==c?void 0:null===(e=c.payload)||void 0===e?void 0:e.id))},[c]);let C=(e,t)=>{var n,s;if(g)return!1;let l=JSON.parse(sessionStorage.getItem("results_"+(null==v?void 0:null===(n=v.payload)||void 0===n?void 0:n.id))||"{}");sessionStorage.setItem("results_"+(null==v?void 0:null===(s=v.payload)||void 0===s?void 0:s.id),JSON.stringify({...l,comments:{...(null==l?void 0:l.comments)||{},[e]:t}})),b(n=>{var s,l,a;return{...n,payload:{...n.payload,details:{...null==n?void 0:null===(s=n.payload)||void 0===s?void 0:s.details,comments:{...null==n?void 0:null===(l=n.payload)||void 0===l?void 0:null===(a=l.details)||void 0===a?void 0:a.comments,[e]:t}}}}})},T=(e,t)=>{var n;if(g)return!1;let{teacher:s}=t,l=JSON.parse(sessionStorage.getItem("results_"+(null==v?void 0:null===(n=v.payload)||void 0===n?void 0:n.id))||"{}");b(t=>{var n,a,o,d;return{...t,payload:{...t.payload,details:{...null==t?void 0:null===(n=t.payload)||void 0===n?void 0:n.details,questions:null==t?void 0:null===(a=t.payload)||void 0===a?void 0:null===(o=a.details)||void 0===o?void 0:null===(d=o.questions)||void 0===d?void 0:d.map(t=>{if(t.id==e){var n;return sessionStorage.setItem("results_"+(null==v?void 0:null===(n=v.payload)||void 0===n?void 0:n.id),JSON.stringify({...l,points:{...(null==l?void 0:l.points)||{},[e]:Math.min(s,t.maxPoint)}})),{...t,teacher:Math.min(s,t.maxPoint)}}return t})}}}})},y=()=>{if(g)return!1;try{var e,t;let{comments:n={},points:s={}}=JSON.parse(sessionStorage.getItem("results_"+(null==v?void 0:null===(e=v.payload)||void 0===e?void 0:e.id))||"{}");Object.keys(n).length||Object.keys(s).length?m(null==v?void 0:null===(t=v.payload)||void 0===t?void 0:t.id):P().fire("Bạn chưa chỉnh sửa g\xec","","info")}catch(e){}},I=()=>{var e;if(g)return p(),!1;let{comments:t={},points:n={}}=JSON.parse(sessionStorage.getItem("results_"+(null==v?void 0:null===(e=v.payload)||void 0===e?void 0:e.id))||"{}");Object.keys(t).length||Object.keys(n).length?P().fire({icon:"warning",title:"Ch\xfa \xfd",html:'Bạn chưa lưu kết quả chấm điểm của b\xe0i l\xe0m n\xe0y. Vui l\xf2ng nhấn <b style="color:red">Lưu b\xe0i l\xe0m</b> trước khi tho\xe1t.',showCancelButton:!0,cancelButtonText:"Đ\xe3 hiểu",cancelButtonColor:"#d33",confirmButtonText:"Kh\xf4ng lưu"}).then(e=>{if(e.isConfirmed){var t;sessionStorage.removeItem("results_"+(null==v?void 0:null===(t=v.payload)||void 0===t?void 0:t.id)),p()}}):p()},w=()=>{var e,t;let{comments:n={},points:s={}}=JSON.parse(sessionStorage.getItem("results_"+(null==v?void 0:null===(e=v.payload)||void 0===e?void 0:e.id))||"{}");Object.keys(n).length||Object.keys(s).length?P().fire({icon:"warning",title:"Ch\xfa \xfd",html:'Bạn chưa lưu kết quả chấm điểm của b\xe0i l\xe0m n\xe0y. Vui l\xf2ng nhấn <b style="color:red">Lưu b\xe0i l\xe0m</b> trước khi tho\xe1t.',showCancelButton:!0,cancelButtonText:"Đ\xe3 hiểu",cancelButtonColor:"#d33",confirmButtonText:"Kh\xf4ng lưu"}).then(e=>{if(e.isConfirmed){var t,n;sessionStorage.removeItem("results_"+(null==v?void 0:null===(t=v.payload)||void 0===t?void 0:t.id)),f(null==v?void 0:null===(n=v.payload)||void 0===n?void 0:n.id,"history")}}):f(null==v?void 0:null===(t=v.payload)||void 0===t?void 0:t.id,"history")()};return(0,s.jsx)(eE.ZP,{open:!0,anchor:"right",variant:"temporary",onClose:I,ModalProps:{keepMounted:!0},sx:{"& .MuiDrawer-paper":{width:{md:"75%",xs:"95%"}}},children:(0,s.jsxs)(d.Z,{sx:{p:2,minWidth:350},children:[(0,s.jsxs)(tj,{children:[(0,s.jsxs)(h.Z,{variant:"h5",children:["B\xe0i l\xe0m của: ",null==v?void 0:null===(t=v.payload)||void 0===t?void 0:t.student]}),(0,s.jsx)(x.Z,{size:"small",onClick:I,sx:{p:"0.438rem",borderRadius:1,color:"text.primary",backgroundColor:"action.selected","&:hover":{backgroundColor:e=>"rgba(".concat(e.palette.customColors.main,", 0.16)")}},children:(0,s.jsx)(j.Z,{icon:"tabler:x",fontSize:"1.125rem"})})]}),(0,s.jsxs)(d.Z,{sx:{mt:3,px:0},children:[(0,s.jsx)(tC,{details:v}),g?null:(0,s.jsxs)(d.Z,{sx:{px:3},children:[(0,s.jsx)(th.Z,{children:"NHẬN X\xc9T CỦA GI\xc1O VI\xcaN"}),(0,s.jsx)(X.Z,{fullWidth:!0,multiline:!0,minRows:3,value:((null==v?void 0:null===(n=v.payload)||void 0===n?void 0:null===(l=n.details)||void 0===l?void 0:l.comments)||{})[null==v?void 0:null===(o=v.payload)||void 0===o?void 0:o.id]||"",onChange:e=>{var t;return C(null==v?void 0:null===(t=v.payload)||void 0===t?void 0:t.id,e)}})]}),(0,s.jsxs)(d.Z,{sx:{px:{xs:0,md:3}},children:[(0,s.jsx)(th.Z,{children:"CHI TIẾT B\xc0I L\xc0M"}),(0,s.jsx)(tv,{details:v,updatePoint:T})]})]}),(0,s.jsxs)(tj,{sx:{justifyContent:"flex-end"},children:[(0,s.jsx)(u.Z,{onClick:w,variant:"contained",color:"success",startIcon:(0,s.jsx)(j.Z,{icon:"tabler:mist"}),children:"Lịch sử b\xe0i l\xe0m"}),g?null:(0,s.jsx)(u.Z,{onClick:y,variant:"contained",startIcon:(0,s.jsx)(j.Z,{icon:"tabler:device-floppy"}),sx:{ml:2},children:"Lưu b\xe0i l\xe0m"})]})]})})};var ty=(0,a.memo)(tT);let tI=e=>{let{details:t,handleClose:n,handleClick:l,saveResults:a,realtime:o=!1}=e;return"history"==t.open?(0,s.jsx)(td,{details:t,handleClose:n,handleClick:l}):"view"==t.open?(0,s.jsx)(ty,{details:t,handleClose:n,handleClick:l,saveResults:a,realtime:o}):null};var tw=a.memo(tI),tE=n(9008),tA=n.n(tE);let tP=()=>{var e,t,n,o,u,f,m;let v=(0,l.useRouter)(),b=(0,p.I0)(),[T,I]=(0,a.useState)({exams:null,results:[],labels:[],time:null}),[w,E]=(0,a.useState)({open:!1,payload:{}}),A=(0,a.useRef)(null);(0,a.useEffect)(()=>{b((0,g.V)({status:"Đang tải..."})),A.current&&A.current.terminate(),fetch("".concat(C.default.assetPrefix,"/scripts/worker.").concat(C.default.version,".js")).then(e=>e.blob()).then(e=>{A.current=new Worker(URL.createObjectURL(e)),A.current.onmessage=async e=>{let{action:t="",payload:n=null}=e.data;switch(t){case"fetchLeaderboard":I(n),b((0,g.V)({status:""}));break;case"viewDetails":E({open:"view",payload:n});break;case"historyDetails":E({open:"history",payload:n});break;case"updateRealtime":I(e=>({...e,...n}))}}});let e=async()=>{try{let{parent:e="",id:t=""}=v.query;if(!t)return v.push("/");await y.default.get("/leaderboard/".concat(t,"/timeout"));let{data:n}=await y.default.get("/quizs/".concat(t,"/details?parent=").concat(e)),{data:s}=await y.default.post("/leaderboard/".concat(t,"/sync?parent=").concat(e));if((null==n?void 0:n.error)||(null==s?void 0:s.error))return P().fire({icon:"error",title:"Oops...",text:(null==n?void 0:n.error)||(null==s?void 0:s.error),footer:'<a href="#">Tại sao t\xf4i gặp th\xf4ng b\xe1o n\xe0y?</a>'}),v.push("/");A.current.postMessage({action:"fetchLeaderboard",payload:{response:n,results:s}})}catch(e){console.log("fetchData",e.message)}};return v.isReady&&e(),()=>{A.current&&A.current.terminate(),b((0,g.V)({status:""}))}},[v,b]);let Z=(e,t)=>()=>{switch(t){case"remove":P().fire({title:"Bạn chắc chứ?",html:'<p>Bạn đang muốn xo\xe1 b\xe0i l\xe0m của th\xed sinh: <b style="color:red">'.concat((null==e?void 0:e.student)||(null==e?void 0:e.id),"</b>?</p>"),icon:"warning",showCancelButton:!0,confirmButtonText:"V\xe2ng. X\xf3a đi!",cancelButtonText:"Hủy"}).then(async t=>{if(t.isConfirmed){var n;b((0,g.V)({status:"Vui l\xf2ng đợi..."}));let{data:{error:t,text:s,time:l}}=await y.default.delete("/leaderboard/".concat(null===(n=v.query)||void 0===n?void 0:n.id,"?resultId=").concat(null==e?void 0:e.id));if(b((0,g.V)({status:""})),t)return P().fire(t,"","error");P().fire(s,"","success"),A.current.postMessage({action:"currentRealtime",payload:{...T,results:T.results.filter(t=>t.ResultId!=(null==e?void 0:e.id)),time:l}})}});break;case"view":A.current.postMessage({action:"viewDetails",payload:{id:e,leaderboard:T}});break;case"download":break;case"history":A.current.postMessage({action:"historyDetails",payload:{id:e,leaderboard:T}})}},S=async e=>{try{let{comments:t={},points:n={}}=JSON.parse(sessionStorage.getItem("results_"+e)||"{}");if(Object.keys(t).length||Object.keys(n).length){let{id:s=""}=v.query;b((0,g.V)({status:"Đang lưu"}));let{data:l}=await y.default.post("/leaderboard/".concat(s,"?resultId=").concat(e),{comments:t,points:n});if(b((0,g.V)({status:""})),l.error)return P().fire("Xảy ra lỗi!",l.error,"error");P().fire({icon:"success",title:"Đ\xe3 lưu",timer:1500}),sessionStorage.removeItem("results_"+e),A.current.postMessage({action:"updateResult",payload:{results:{...l,id:e},leaderboard:T}}),E({open:!1})}}catch(e){console.log("saveResults",e.message)}};return(0,s.jsxs)(d.Z,{children:[(0,s.jsx)(tA(),{children:(0,s.jsxs)("title",{children:["Bảng điểm - ",(null==T?void 0:null===(e=T.exams)||void 0===e?void 0:null===(t=e.settings)||void 0===t?void 0:t.title)||"..."]})}),(0,s.jsx)(ek.Z,{className:"header-leaderboard",sx:{mb:5,color:"white"},children:(0,s.jsx)(K.Z,{title:(0,s.jsxs)(h.Z,{variant:"h5",component:eZ(),href:"/p/create.html?parent=".concat(v.query.parent,"&id=").concat(v.query.id),sx:{color:"white",textDecoration:"none"},children:["BẢNG ĐIỂM - ",(null==T?void 0:null===(n=T.exams)||void 0===n?void 0:null===(o=n.settings)||void 0===o?void 0:o.title)||"..."]}),avatar:(0,s.jsx)(j.Z,{icon:"tabler:checkup-list",fontSize:"1.125rem"}),action:(0,s.jsxs)(d.Z,{sx:{display:"flex",alignItems:"center",color:"white"},children:[(0,s.jsx)(c.Z,{title:"Chỉnh sửa",children:(0,s.jsx)(x.Z,{sx:{color:"white"},component:eZ(),href:"/p/create.html?parent=".concat(v.query.parent,"&id=").concat(v.query.id),children:(0,s.jsx)(j.Z,{icon:"tabler:edit",fontSize:20})})}),(0,s.jsx)(c.Z,{title:"Gi\xe1m s\xe1t",children:(0,s.jsx)(x.Z,{sx:{color:"white"},component:eZ(),href:"/p/realtime.html?parent=".concat(v.query.parent,"&id=").concat(v.query.id),children:(0,s.jsx)(j.Z,{icon:"tabler:camera-bolt",fontSize:20})})}),(0,s.jsx)(c.Z,{title:"Xem đề thi",children:(0,s.jsx)(x.Z,{sx:{color:"white"},component:eZ(),href:null!==(m=null==T?void 0:null===(u=T.exams)||void 0===u?void 0:null===(f=u.settings)||void 0===f?void 0:f.url)&&void 0!==m?m:"#",target:"_blank",children:(0,s.jsx)(j.Z,{icon:"tabler:eye",fontSize:20})})})]}),subheader:(0,s.jsxs)("div",{children:[(0,s.jsxs)(h.Z,{sx:{color:"white",display:{xs:"none",sm:"inline"}},variant:"body",children:["Cập nhật l\xfac"," "]}),(0,s.jsx)(h.Z,{sx:{color:"white"},variant:"body",children:eY(null==T?void 0:T.time).format("HH:mm:ss DD/MM/YYYY")})]}),sx:{p:{xs:2,md:5}}})}),(0,s.jsx)(eB,{results:T.results.map(e=>{var t,n;return{point:null==e?void 0:null===(t=e.overview)||void 0===t?void 0:t.point,number:null==e?void 0:null===(n=e.overview)||void 0===n?void 0:n.number}}),maxPoint:10}),(0,s.jsx)(e7,{results:T.results.map(e=>({...e.overview,id:e.ResultId})).sort((e,t)=>t.point!==e.point?t.point-e.point:t.time!==e.time?e.time-t.time:e.startAt-t.startAt).map((e,t)=>({...e,rank:t+1})),labelColumn:T.labels,handleClick:Z}),(0,s.jsx)(tw,{details:w,handleClose:()=>{E({open:!1})},handleClick:Z,saveResults:S})]})},tZ=e=>{let{sx:t,icon:n,stats:l,title:a,avatarSize:o=42,iconSize:c="1.625rem",avatarColor:u="primary"}=e;return(0,s.jsx)(ek.Z,{sx:{...t},children:(0,s.jsxs)(Q.Z,{sx:{gap:3,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,s.jsxs)(d.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-start"},children:[(0,s.jsx)(h.Z,{variant:"h5",sx:{mb:.5},children:l}),(0,s.jsx)(h.Z,{variant:"body2",children:a})]}),(0,s.jsx)(en.Z,{skin:"light",color:u,sx:{width:o,height:o},children:(0,s.jsx)(j.Z,{icon:n,fontSize:c})})]})})},tS=e=>{let{statistic:t}=e,n=[{stats:null==t?void 0:t.total,icon:"tabler:list-check",title:"Số b\xe0i l\xe0m"},{stats:null==t?void 0:t.students,icon:"tabler:users",title:"Số học sinh",avatarColor:"success"},{stats:null==t?void 0:t.points,avatarColor:"error",title:"Điểm trung b\xecnh",icon:"tabler:circle-check"},{stats:null==t?void 0:t.times,title:"Thời gian trung b\xecnh",avatarColor:"warning",icon:"tabler:clock"}];return(0,s.jsx)(S.ZP,{container:!0,spacing:6,sx:{mb:5},children:n.map((e,t)=>(0,s.jsx)(S.ZP,{item:!0,xs:12,md:3,children:(0,s.jsx)(tZ,{...e})},t))})};var tN=(0,a.memo)(tS);let tL=()=>{let[e,t]=(0,a.useState)(null);return(0,a.useEffect)(()=>{let e=setInterval(()=>{t(eY().format("HH:mm:ss DD/MM/YYYY"))},1e3);return()=>{clearInterval(e)}},[]),(0,s.jsxs)("div",{children:[(0,s.jsxs)(h.Z,{sx:{color:"white",display:{xs:"none",sm:"inline"}},variant:"body",children:["Cập nhật l\xfac"," "]}),(0,s.jsx)(h.Z,{sx:{color:"white"},variant:"body",children:e})]})};var tk=a.memo(tL),t_=n(2848),tM=n(6476);let tR=(0,L.ZP)(d.Z)(e=>{let{theme:t}=e;return{display:"flex",alignItems:"center",padding:t.spacing(2.5),boxShadow:t.shadows[1],justifyContent:"space-between",borderRadius:t.shape.borderRadius,backgroundColor:t.palette.background.paper}}),tO=(0,L.ZP)(d.Z)(e=>{let{theme:t}=e;return{padding:t.spacing(0,5,5),marginTop:5}}),tH=e=>{let{messages:t,sendMessage:n}=e,[l,o]=(0,a.useState)(""),c=()=>{(null==l?void 0:l.toString().trim())&&(n(null==l?void 0:l.toString().trim()),o(""))},x=(0,a.useRef)(null);return(0,a.useEffect)(()=>{if(x.current){let{scrollTop:e,scrollHeight:n,clientHeight:s}=x.current._outerRef;(e+s+150>=n||!e)&&x.current.scrollToItem(t.length-1,"end")}},[t]),(0,s.jsxs)(ek.Z,{children:[(0,s.jsx)(K.Z,{title:(0,s.jsx)(h.Z,{variant:"h4",children:"Nhật k\xfd hoạt động"})}),(0,s.jsxs)(d.Z,{sx:{flexGrow:1,height:"100%",backgroundColor:"action.hover"},children:[(0,s.jsx)(t_.t7,{ref:x,height:450,width:"100%",itemCount:t.length,itemSize:75,children:e=>{let{index:n,style:l}=e;return(0,s.jsx)("div",{style:l,children:(0,s.jsxs)(d.Z,{sx:{display:"flex",flexDirection:t[n].admin?"row-reverse":"row",alignItems:"center",mb:2},children:[(0,s.jsx)(en.Z,{children:t[n].admin?"GV":t[n].label}),(0,s.jsxs)(eA.Z,{severity:"success",icon:!1,sx:{mr:t[n].admin?2:void 0,ml:t[n].admin?void 0:2},children:[(0,s.jsx)(h.Z,{variant:"h6",sx:{fontWeight:600},dangerouslySetInnerHTML:{__html:t[n].text}}),(0,s.jsx)("div",{style:{textAlign:t[n].admin?"right":"left"},children:(0,s.jsx)(h.Z,{variant:"body",sx:{fontSize:"0.75rem"},children:ed()(t[n].t).format("HH:mm:ss DD/MM/YYYY")})})]})]},t[n].id+n)})}}),(0,s.jsx)(tO,{children:(0,s.jsxs)(tR,{children:[(0,s.jsx)(d.Z,{sx:{flexGrow:1,display:"flex",alignItems:"center"},children:(0,s.jsx)(tM.Z,{fullWidth:!0,placeholder:"Nhập lời nhắn để gửi...",sx:{"& .Mui-focused":{boxShadow:"none !important"},"& .MuiInputBase-input:not(textarea).MuiInputBase-inputSizeSmall":{p:e=>e.spacing(1.875,2.5)},"& .MuiInputBase-root":{border:"0 !important"}},value:l,onChange:e=>o(e.target.value)})}),(0,s.jsx)(d.Z,{sx:{display:"flex",alignItems:"center"},children:(0,s.jsx)(u.Z,{type:"submit",variant:"contained",startIcon:(0,s.jsx)(j.Z,{icon:"tabler:send"}),onClick:c,children:"Gửi"})})]})})]})]})};var tB=a.memo(tH),tD=n(7918),tF=n(8987),tz=n(8619);let tq=e=>{let{students:t,handleClick:n}=e,[l,o]=(0,a.useState)(ed()().valueOf()),[c,u]=(0,a.useState)(null),[x,p]=(0,a.useState)(null),[f,m]=(0,a.useState)({left:0,top:0});(0,a.useEffect)(()=>{let e=setInterval(()=>{o(ed()().valueOf())},1e3);return()=>{e&&clearInterval(e)}},[]);let g=()=>{u(null)},v=(e,t)=>{u(t.currentTarget),p(e),m({left:t.clientX,top:t.clientY})},b=e=>t=>{u(null),p(null),n(x,e)},C={online:"success",offline:"error",hidden:"warning"},T={online:"Đang online",offline:"Đang offline",hidden:"Đang tho\xe1t khỏi b\xe0i l\xe0m"};return(0,s.jsxs)(ek.Z,{children:[(0,s.jsx)(K.Z,{title:(0,s.jsxs)(h.Z,{variant:"h4",children:["Học sinh đang l\xe0m ",(0,s.jsx)(tD.Z,{label:t.length,color:"success"})]})}),(0,s.jsxs)(d.Z,{sx:{flexGrow:1,height:"100%",backgroundColor:"action.hover"},children:[(0,s.jsx)(t_.t7,{height:520,width:"100%",itemCount:t.length,itemSize:62,itemData:t,children:e=>{var t,n,a,o;let{style:d,data:c,index:u}=e;return(0,s.jsx)("div",{style:d,index:u,children:(0,s.jsxs)(tz.Z,{divider:!0,onClick:e=>v(c[u],e),children:[(0,s.jsx)(tF.Z,{children:(0,s.jsx)(en.Z,{color:C[null===(t=c[u])||void 0===t?void 0:t.status],children:c[u].label})}),(0,s.jsxs)(ei.Z,{children:[(0,s.jsx)(h.Z,{variant:"h6",color:C[null===(n=c[u])||void 0===n?void 0:n.status],children:c[u].student}),(0,s.jsx)(h.Z,{variant:"body2",color:C[null===(a=c[u])||void 0===a?void 0:a.status],children:T[null===(o=c[u])||void 0===o?void 0:o.status]})]}),(0,s.jsxs)(tb.Z,{sx:{textAlign:"center"},children:[(0,s.jsxs)(h.Z,{children:["Đ\xe3 l\xe0m ",c[u].taked,"/",c[u].total]}),(0,s.jsx)(h.Z,{color:"error",fontWeight:600,children:e4(l-c[u].startAt)})]})]})})}}),(null==t?void 0:t.length)&&x?(0,s.jsx)(er.Z,{anchorReference:"anchorPosition",anchorPosition:f,keepMounted:!0,open:!!c,onClose:g,children:[{action:"alert",title:"Nhắc nhở quay lại b\xe0i thi",icon:"tabler:bell-plus",show:!1},{action:"message",title:"Gửi lời nhắn ri\xeang",icon:"tabler:message-chatbot",show:!1},{action:"cancel",title:"Buộc dừng b\xe0i thi",icon:"tabler:user-cancel",show:!0}].map(e=>!e.show&&(null==x?void 0:x.status)!="offline"||e.show?(0,s.jsxs)(el.Z,{onClick:b(e.action),children:[(0,s.jsx)(es.Z,{children:(0,s.jsx)(j.Z,{icon:e.icon,fontSize:20})}),(0,s.jsx)(ei.Z,{children:e.title})]},e.action):null)}):null]})]})};var tG=a.memo(tq);let tY=e=>{let{result:t}=e,{Username:n="",details:{collects:l=[]},overview:o}=t,[d,h]=(0,a.useState)(0),{points:c}=o;return(0,a.useEffect)(()=>{var e,n;let s=null==t?void 0:null===(e=t.details)||void 0===e?void 0:null===(n=e.questions)||void 0===n?void 0:n.reduce((e,t)=>e+=parseFloat(t.teacher||t.point),0);h(s||0)},[t]),(0,s.jsxs)(S.ZP,{container:!0,spacing:3,sx:{px:3},children:[(0,s.jsxs)(S.ZP,{item:!0,xs:12,md:4,children:[(0,s.jsx)(th.Z,{children:"ĐIỂM"}),(0,s.jsx)(eR,{series:[parseFloat(100*d/c||0).toFixed(2)],options:{chart:{height:300,type:"radialBar",sparkline:{enabled:!0}},colors:["#51e5a8"],plotOptions:{radialBar:{offsetY:-10,startAngle:-150,endAngle:150,hollow:{margin:0,size:"75%"},track:{background:"#ebe9f1",strokeWidth:"50%",margin:0},dataLabels:{show:!0,name:{show:!1,color:"#5e5873",fontSize:"2.86rem"},value:{formatter:e=>parseFloat(e*c/100||0).toFixed(2),color:"#5e5873",fontSize:"2.86rem",show:!0}}}},fill:{type:"gradient",gradient:{shade:"dark",type:"horizontal",shadeIntensity:.5,gradientToColors:["#51e5a8"],inverseColors:!0,opacityFrom:1,opacityTo:1,stops:[0,100]}},stroke:{lineCap:"round"},labels:[""],grid:{padding:{bottom:30}}},type:"radialBar",height:300})]}),(0,s.jsxs)(S.ZP,{item:!0,xs:12,md:4,children:[n?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(th.Z,{sx:{mt:2},children:"TH\xd4NG TIN TH\xcd SINH"}),(0,s.jsxs)(tc.Z,{children:[(0,s.jsx)(tu.ZP,{disablePadding:!0,children:(0,s.jsxs)(es.Z,{sx:{alignItems:"center",color:"primary.main"},children:[(0,s.jsx)(j.Z,{icon:"tabler:user-bolt",fontSize:20}),(0,s.jsxs)(ei.Z,{sx:{fontWeight:600,ml:1},disableTypography:!0,children:["Họ v\xe0 t\xean: ",null==n?void 0:n.fullname]})]})}),(0,s.jsx)(tu.ZP,{disablePadding:!0,children:(0,s.jsxs)(es.Z,{sx:{alignItems:"center",color:"primary.main"},children:[(0,s.jsx)(j.Z,{icon:"tabler:cash-banknote",fontSize:20}),(0,s.jsxs)(ei.Z,{sx:{fontWeight:600,ml:1},disableTypography:!0,children:["Lớp: ",null==n?void 0:n.classes]})]})}),(0,s.jsx)(tu.ZP,{disablePadding:!0,children:(0,s.jsxs)(es.Z,{sx:{alignItems:"center",color:"primary.main"},children:[(0,s.jsx)(j.Z,{icon:"tabler:school",fontSize:20}),(0,s.jsxs)(ei.Z,{sx:{fontWeight:600,ml:1},disableTypography:!0,children:["Trường: ",null==n?void 0:n.school]})]})})]})]}):null,l.length?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(th.Z,{children:"TH\xd4NG TIN THU THẬP"}),(0,s.jsx)(tc.Z,{children:l.map((e,t)=>(0,s.jsx)(tu.ZP,{disablePadding:!0,children:(0,s.jsxs)(es.Z,{sx:{alignItems:"center",color:"primary.main"},children:[(0,s.jsx)(j.Z,{icon:"tabler:point",fontSize:20}),(0,s.jsxs)(ei.Z,{sx:{fontWeight:600,ml:1},disableTypography:!0,children:[null==e?void 0:e.label,": ",null==e?void 0:e.value]})]})},t))})]}):null]}),(0,s.jsxs)(S.ZP,{item:!0,xs:12,md:4,children:[(0,s.jsx)(th.Z,{children:"TH\xd4NG TIN B\xc0I THI"}),(0,s.jsxs)(tc.Z,{children:[(0,s.jsx)(tu.ZP,{disablePadding:!0,children:(0,s.jsxs)(es.Z,{sx:{alignItems:"center",color:"warning.main"},children:[(0,s.jsx)(j.Z,{icon:"tabler:clock",fontSize:20}),(0,s.jsx)(ei.Z,{sx:{fontWeight:600,ml:1},disableTypography:!0,children:"Thời gian l\xe0m b\xe0i:"}),(0,s.jsx)(tb.Z,{sx:{fontWeight:600,fontSize:"1.2rem"},children:e4(o.time)})]})}),(0,s.jsx)(tu.ZP,{disablePadding:!0,children:(0,s.jsxs)(es.Z,{sx:{alignItems:"center"},children:[(0,s.jsx)(j.Z,{icon:"tabler:clock",fontSize:20}),(0,s.jsxs)(ei.Z,{sx:{fontWeight:600,ml:1},disableTypography:!0,children:["Bắt đầu l\xfac: ",ed()(o.startAt).format("HH:mm:ss DD/MM/YYYY")]})]})}),(0,s.jsx)(tu.ZP,{disablePadding:!0,children:(0,s.jsxs)(es.Z,{sx:{alignItems:"center"},children:[(0,s.jsx)(j.Z,{icon:"tabler:clock",fontSize:20}),(0,s.jsxs)(ei.Z,{sx:{fontWeight:600,ml:1},disableTypography:!0,children:["Nộp b\xe0i l\xfac: ",ed()(o.submitAt).format("HH:mm:ss DD/MM/YYYY")]})]})}),(0,s.jsx)(tu.ZP,{disablePadding:!0,children:(0,s.jsxs)(es.Z,{sx:{alignItems:"center",color:"success.main"},children:[(0,s.jsx)(j.Z,{icon:"tabler:circle-check",fontSize:20}),(0,s.jsx)(ei.Z,{sx:{fontWeight:600,ml:1},disableTypography:!0,children:"Số c\xe2u trắc nghiệm đ\xfang"}),(0,s.jsx)(tb.Z,{sx:{fontWeight:600,fontSize:"1.2rem"},children:o.right})]})}),(0,s.jsx)(tu.ZP,{disablePadding:!0,children:(0,s.jsxs)(es.Z,{sx:{alignItems:"center",color:"error.main"},children:[(0,s.jsx)(j.Z,{icon:"tabler:circle-x",fontSize:20}),(0,s.jsx)(ei.Z,{sx:{fontWeight:600,ml:1},disableTypography:!0,children:"Số c\xe2u trắc nghiệm sai"}),(0,s.jsx)(tb.Z,{sx:{fontWeight:600,fontSize:"1.2rem"},children:o.error})]})}),(0,s.jsx)(tu.ZP,{disablePadding:!0,children:(0,s.jsxs)(es.Z,{sx:{alignItems:"center"},children:[(0,s.jsx)(j.Z,{icon:"tabler:sum",fontSize:20}),(0,s.jsx)(ei.Z,{sx:{fontWeight:600,ml:1},disableTypography:!0,children:"Tổng số c\xe2u hỏi trong đề"}),(0,s.jsx)(tb.Z,{sx:{fontWeight:600,fontSize:"1.2rem"},children:o.total})]})}),(0,s.jsx)(tu.ZP,{disablePadding:!0,children:(0,s.jsxs)(es.Z,{sx:{alignItems:"center"},children:[(0,s.jsx)(j.Z,{icon:"tabler:sum",fontSize:20}),(0,s.jsx)(ei.Z,{sx:{fontWeight:600,ml:1},disableTypography:!0,children:"Đề số"}),(0,s.jsx)(tb.Z,{sx:{fontWeight:600,fontSize:"1.2rem"},children:o.number})]})}),(0,s.jsx)(tu.ZP,{disablePadding:!0,children:(0,s.jsxs)(es.Z,{sx:{alignItems:"center"},children:[(0,s.jsx)(j.Z,{icon:"tabler:sum",fontSize:20}),(0,s.jsx)(ei.Z,{sx:{fontWeight:600,ml:1,a:{textDecoration:"none"}},disableTypography:!0,children:"Link b\xe0i l\xe0m:"}),(0,s.jsx)(tb.Z,{sx:{fontWeight:600,fontSize:"1.2rem",a:{textDecoration:"none"}},children:(0,s.jsx)("a",{href:o.link,target:"_blank",children:"Click để xem"})})]})})]})]})]})},tW=(0,L.ZP)(tr.Z)({"& .MuiTimelineItem-root":{width:"100%","&:before":{display:"none"}}}),tU=(0,L.ZP)(d.Z)(e=>{let{theme:t}=e;return{display:"flex",alignItems:"center",padding:t.spacing(3),justifyContent:"space-between",backgroundColor:"#F8F8F8"}}),t$=e=>{let{exams:t,result:n,onClick:l}=e,{overview:o}=n,c=(0,a.useMemo)(()=>eJ({results:[n],exams:t,all:!0}),[n]),p=()=>{l({action:""})};return(0,s.jsxs)(eE.ZP,{open:!0,anchor:"right",variant:"temporary",onClose:p,ModalProps:{keepMounted:!0},sx:{"& .MuiDrawer-paper":{width:{md:"50%",xs:"95%"}}},children:[(0,s.jsxs)(tU,{children:[(0,s.jsxs)(h.Z,{variant:"h5",children:["Lịch sử l\xe0m b\xe0i của: ",null==o?void 0:o.student]}),(0,s.jsx)(x.Z,{size:"small",onClick:p,sx:{p:"0.438rem",borderRadius:1,color:"text.primary",backgroundColor:"action.selected","&:hover":{backgroundColor:e=>"rgba(".concat(e.palette.customColors.main,", 0.16)")}},children:(0,s.jsx)(j.Z,{icon:"tabler:x",fontSize:"1.125rem"})})]}),(0,s.jsx)(d.Z,{sx:{mt:3,px:3},children:(0,s.jsx)(tW,{children:null==c?void 0:c.map((e,t)=>(0,s.jsxs)(tt.Z,{children:[(0,s.jsxs)(ts.Z,{children:[(0,s.jsx)(te.Z,{color:"error"}),(0,s.jsx)(ti.Z,{})]}),(0,s.jsxs)(tn.Z,{sx:{"& svg":{verticalAlign:"bottom",mx:4}},children:[(0,s.jsx)(d.Z,{sx:{mb:2,display:"flex",flexWrap:"wrap",alignItems:"center",justifyContent:"space-between"},children:(0,s.jsx)(h.Z,{sx:{mr:2},variant:"h5",dangerouslySetInnerHTML:{__html:e.text}})}),(0,s.jsx)(d.Z,{children:(0,s.jsx)(h.Z,{variant:"body",sx:{color:"text.disabled"},children:ed()(e.t).format("HH:mm:ss DD/MM/YYYY")})})]})]},t))})}),(0,s.jsx)(tU,{sx:{justifyContent:"flex-end"},children:(0,s.jsx)(u.Z,{onClick:()=>l({action:"view",payload:n.ResultId}),variant:"contained",startIcon:(0,s.jsx)(j.Z,{icon:"tabler:eye"}),children:"Chi tiết b\xe0i l\xe0m"})})]})},tV=(0,L.ZP)(d.Z)(e=>{let{theme:t}=e;return{display:"flex",alignItems:"center",padding:t.spacing(3),justifyContent:"space-between",backgroundColor:"#F8F8F8"}}),tQ=e=>{var t;let{exams:n,data:{action:l="",payload:o},handleClick:c}=e,p=(0,a.useCallback)(()=>{c({action:"history",payload:o.ResultId})},[o]),f=(0,a.useCallback)(e=>{c(e)},[o]);return l?"history"==l?(0,s.jsx)(t$,{exams:n,result:o,onClick:f}):(0,s.jsx)(eE.ZP,{open:!0,anchor:"right",variant:"temporary",onClose:()=>c({action:""}),ModalProps:{keepMounted:!0},sx:{"& .MuiDrawer-paper":{width:{md:"75%",xs:"95%"}}},children:(0,s.jsxs)(d.Z,{sx:{p:2,minWidth:350},children:[(0,s.jsxs)(tV,{children:[(0,s.jsxs)(h.Z,{variant:"h5",children:["B\xe0i l\xe0m của: ",(null==o?void 0:null===(t=o.overview)||void 0===t?void 0:t.student)||(null==o?void 0:o.ResultId)]}),(0,s.jsx)(x.Z,{size:"small",onClick:()=>c({action:""}),sx:{p:"0.438rem",borderRadius:1,color:"text.primary",backgroundColor:"action.selected","&:hover":{backgroundColor:e=>"rgba(".concat(e.palette.customColors.main,", 0.16)")}},children:(0,s.jsx)(j.Z,{icon:"tabler:x",fontSize:"1.125rem"})})]}),(0,s.jsxs)(d.Z,{sx:{mt:3,px:0},children:[(0,s.jsx)(tY,{result:o}),(0,s.jsxs)(d.Z,{sx:{px:{xs:0,md:3}},children:[(0,s.jsx)(th.Z,{children:"CHI TIẾT B\xc0I L\xc0M"}),(0,s.jsx)(tv,{details:{payload:o},updatePoint:()=>{}})]})]}),(0,s.jsx)(tV,{sx:{justifyContent:"flex-end"},children:(0,s.jsx)(u.Z,{onClick:p,variant:"contained",color:"success",startIcon:(0,s.jsx)(j.Z,{icon:"tabler:mist"}),children:"Lịch sử b\xe0i l\xe0m"})})]})}):null};var tK=(0,a.memo)(tQ);let tX=new class{addTask(e){this.queue.push(e),this.processQueue()}processQueue(){if(this.running<this.limit&&this.queue.length>0){let e=this.queue.shift();this.running++,e(()=>{this.running--,this.processQueue()})}}constructor(e=1){this.queue=[],this.running=0,this.limit=e}}(1),tJ=()=>{var e,t,n,o,u,f,m;let v=(0,l.useRouter)(),b=(0,p.I0)(),[C,T]=(0,a.useState)({exams:{},results:[],statistic:{},logs:[],labels:{},students:[]}),[I,w]=(0,a.useState)({action:"",payload:null}),E=(0,a.useRef)(),A=(0,a.useRef)(),Z=(0,a.useCallback)(e=>{tX.addTask(async t=>{T(n=>{let{action:s,ResultId:l,time:a}=e,{results:o,exams:d,logs:h,students:c}=n;var u=o.findIndex(e=>e.ResultId==l);switch(s){case"current":var x=e0({results:(null==e?void 0:e.payload)||[],exams:d});o=[...o,...x],c=x.map(e=>({id:e.ResultId,student:e.overview.student,startAt:e.overview.startAt,label:e.overview.label,taked:e.overview.taked,total:e.overview.total,status:e.status,clientId:e.ClientId,userToken:e.UserToken}));break;case"start":var x=e0({results:[null==e?void 0:e.payload],exams:d});o=[...o,...x],c=[...c,...x.map(e=>({id:e.ResultId,student:e.overview.student,startAt:e.overview.startAt,label:e.overview.label,taked:e.overview.taked,total:e.overview.total,status:e.status,clientId:e.ClientId,userToken:e.UserToken}))];break;case"answers":if(u>=0){var p,f,m=o[u],[x]=e0({results:[{...m,details:{...null==m?void 0:m.details,questions:null==m?void 0:null===(p=m.details)||void 0===p?void 0:null===(f=p.questions)||void 0===f?void 0:f.map(t=>{var n,s;return(null==t?void 0:t.id)==(null==e?void 0:null===(n=e.payload)||void 0===n?void 0:n.id)?{...t,answers:null==e?void 0:null===(s=e.payload)||void 0===s?void 0:s.answers}:t})},logs:[...(null==m?void 0:m.logs)||[],{a:s,p:null==e?void 0:e.payload,t:e.time}],status:"online"}],exams:d});o[u]=x}break;case"visible":case"hidden":case"devices":case"ips":case"left":case"right":case"shortcut":if(u>=0){var m=o[u],[x]=e0({results:[{...m,securitys:{...m.securitys,[s]:[...m.securitys[s]||[],{a:s,t:e.time}]},status:["hidden"].includes(s)?"hidden":"online"}],exams:d});o[u]=x}break;case"submit":case"online":case"offline":if(u>=0){var m=o[u],[x]=e0({results:[{...m,logs:[...(null==m?void 0:m.logs)||[],{a:s,p:null==e?void 0:e.payload,t:e.time}],status:s}],exams:d});o[u]=x}}switch(s){case"start":e.ResultId=e.payload.ResultId;case"visible":case"hidden":case"online":case"offline":case"devices":case"ips":case"left":case"right":case"shortcut":case"submit":case"answers":var g=e1({results:o,exams:d,message:e});g&&(h=[...h,g])}var v=c.findIndex(e=>e.id==l);switch(s){case"visible":v>=0&&(c[v]={...c[v],status:"online"});break;case"hidden":case"online":case"offline":v>=0&&(c[v]={...c[v],status:s});break;case"submit":c=c.filter(e=>e.id!=l);break;case"answers":if(v>=0){var m=o[u];c[v]={...c[v],status:"online",taked:m.overview.taked}}}return setTimeout(()=>{t()},5),{...n,results:o,logs:h,students:c,labels:eK({results:o}),statistic:eX({results:o})}})})},[]),N=(0,a.useCallback)(async e=>{let{exams:t}=e,{parent:n="",id:s=""}=v.query,{data:l}=await y.default.post("/leaderboard/".concat(s,"/sync?parent=").concat(n));if(!(null==l?void 0:l.error)){let e=eQ({results:l,exams:t});T(n=>{let s=[...e,...n.results],l=eJ({results:s,exams:t}),a=eX({results:s}),o=eK({results:s});return{...n,results:s,logs:[...l,...n.logs],statistic:{...n.statistic,...a},labels:{...n.labels,...o}}})}},[]),L=(0,a.useCallback)(async()=>{tX.addTask(async e=>{let{parent:t="",id:n=""}=v.query;if(!n)return v.push("/");await y.default.get("/leaderboard/".concat(n,"/timeout"));let{data:s}=await y.default.get("/quizs/".concat(n,"/details?parent=").concat(t));if(null==s?void 0:s.error)return P().fire({icon:"error",title:"Oops...",text:null==s?void 0:s.error,footer:'<a href="#">Tại sao t\xf4i gặp th\xf4ng b\xe1o n\xe0y?</a>'}),v.push("/");let l=eV(s);N({exams:l}),T(e=>({...e,exams:l})),e()})},[]),k=(0,a.useCallback)(()=>{tX.addTask(e=>{(null==E?void 0:E.current)&&E.current.close(),A.current&&clearInterval(A.current);let{id:t=""}=v.query,n="".concat("wss://cloud.taodethi.xyz","/socket?id=").concat(t,"&accessToken=").concat(localStorage.getItem("accessToken")||"");E.current=new WebSocket(n),E.current.onopen=()=>{b((0,g.V)({status:""})),e(),A.current=setInterval(()=>{E.current.send(JSON.stringify({action:"ping"}))},3e4)},E.current.onclose=e=>{console.log("Disconnected from server",e),b((0,g.V)({status:"Vui l\xf2ng tải lại trang"}))},E.current.onerror=e=>{b((0,g.V)({status:"Vui l\xf2ng tải lại trang"}))},E.current.onmessage=e=>{try{Z(JSON.parse(e.data))}catch(e){}}})},[]);(0,a.useEffect)(()=>(b((0,g.V)({status:"Vui l\xf2ng đợi..."})),v.isReady&&(L(),k()),()=>{(null==E?void 0:E.current)&&E.current.close(),A.current&&clearInterval(A.current),b((0,g.V)({status:""}))}),[v]);let _=(0,a.useCallback)((e,t)=>()=>{switch(t){case"remove":if(!(null==e?void 0:e.submitAt))return P().fire({icon:"error",title:"Xảy ra lỗi",text:"Vui l\xf2ng kết th\xfac b\xe0i thi n\xe0y trước khi x\xf3a n\xf3."});P().fire({title:"Bạn chắc chứ?",html:'<p>Bạn đang muốn xo\xe1 b\xe0i l\xe0m của th\xed sinh: <b style="color:red">'.concat((null==e?void 0:e.student)||(null==e?void 0:e.id),"</b>?</p>"),icon:"warning",showCancelButton:!0,confirmButtonText:"V\xe2ng. X\xf3a đi!",cancelButtonText:"Hủy"}).then(async t=>{if(t.isConfirmed){var n;b((0,g.V)({status:"Vui l\xf2ng đợi..."}));let{data:{error:t,text:s,time:l}}=await y.default.delete("/leaderboard/".concat(null===(n=v.query)||void 0===n?void 0:n.id,"?resultId=").concat(null==e?void 0:e.id));if(b((0,g.V)({status:""})),t)return P().fire(t,"","error");P().fire(s,"","success"),T(t=>{var n=t.results.filter(t=>t.ResultId!==(null==e?void 0:e.id));return{...t,results:n,statistic:{...t.statistic,...eX({results:n})}}})}});break;case"view":case"history":w({action:t,payload:e6({result:C.results.find(t=>t.ResultId===e),exams:C.exams})})}},[C.results]),M=(0,a.useCallback)((e,t)=>{switch(t){case"alert":P().fire({icon:"warning",title:"Ch\xfa \xfd",html:'Bạn muốn nhắc nhở bạn <b style="color:red">'.concat((null==e?void 0:e.student)||e.id,"</b> quay lại l\xe0m b\xe0i thi ngay?"),showCancelButton:!0,cancelButtonText:"Hủy",cancelButtonColor:"#d33",confirmButtonText:"Đ\xfang vậy"}).then(t=>{if(t.isConfirmed){var n,s;(null==E?void 0:null===(n=E.current)||void 0===n?void 0:n.readyState)===WebSocket.OPEN?(null==E||null===(s=E.current)||void 0===s||s.send(JSON.stringify({action:"alert",payload:{clientId:e.clientId,resultId:e.id}})),P().fire("Đ\xe3 gửi!","","success")):P().fire("Vui l\xf2ng kết nối mạng","","error")}});break;case"message":P().fire({html:'Gửi lời nhắn đến bạn <b style="color:red">'.concat(e.student,"</b>"),input:"text",inputAttributes:{autocapitalize:"off"},showCancelButton:!0,confirmButtonText:"Gửi ngay",showLoaderOnConfirm:!0,preConfirm:async e=>{if(!e.toString().trim())return P().showValidationMessage("Vui l\xf2ng nhập nội dung")},allowOutsideClick:()=>!P().isLoading()}).then(t=>{if(t.isConfirmed){var n,s;(null==E?void 0:null===(n=E.current)||void 0===n?void 0:n.readyState)===WebSocket.OPEN?(null==E||null===(s=E.current)||void 0===s||s.send(JSON.stringify({action:"message",payload:{clientId:e.clientId,resultId:e.id,message:t.value}})),P().fire("Đ\xe3 gửi!","","success")):P().fire("Vui l\xf2ng kết nối mạng","","error")}});break;case"cancel":P().fire({icon:"warning",title:"Kết th\xfac b\xe0i thi",html:'Bạn muốn Kết th\xfac b\xe0i thi của th\xed sinh <b style="color:red">'.concat(e.student,"</b>?"),showCancelButton:!0,cancelButtonText:"Hủy",cancelButtonColor:"#d33",confirmButtonText:"Đ\xfang vậy"}).then(t=>{if(t.isConfirmed){var n,s;(null==E?void 0:null===(n=E.current)||void 0===n?void 0:n.readyState)===WebSocket.OPEN?(null==E||null===(s=E.current)||void 0===s||s.send(JSON.stringify({action:"cancel",payload:{clientId:e.clientId,resultId:e.id,userToken:e.userToken}})),P().fire("Đ\xe3 gửi!","","success")):P().fire("Vui l\xf2ng kết nối mạng","","error")}})}},[]),R=(0,a.useCallback)(e=>{var t,n;if((null==E?void 0:null===(t=E.current)||void 0===t?void 0:t.readyState)===WebSocket.OPEN){if(!C.students.length)return P().fire("Lỗi!","Hiện tại kh\xf4ng c\xf3 học sinh n\xe0o đang l\xe0m b\xe0i thi","error");null==E||null===(n=E.current)||void 0===n||n.send(JSON.stringify({action:"sendall",payload:{message:e,lists:C.students}})),P().fire("Đ\xe3 gửi!","","success")}else P().fire("Vui l\xf2ng kết nối mạng","","error")},[C.students]),O=(0,a.useCallback)(e=>{let{action:t,payload:n}=e;switch(t){case"history":case"view":w({action:t,payload:e6({result:C.results.find(e=>e.ResultId===n),exams:C.exams})});break;default:w({action:t,payload:null})}},[I]);return(0,s.jsxs)(d.Z,{children:[(0,s.jsx)(tA(),{children:(0,s.jsxs)("title",{children:["Gi\xe1m s\xe1t - ",(null==C?void 0:null===(e=C.exams)||void 0===e?void 0:null===(t=e.settings)||void 0===t?void 0:t.title)||"..."]})}),(0,s.jsx)(ek.Z,{className:"header-realtime",sx:{mb:5,color:"white"},children:(0,s.jsx)(K.Z,{title:(0,s.jsxs)(h.Z,{variant:"h5",component:eZ(),href:"/p/create.html?parent=".concat(v.query.parent,"&id=").concat(v.query.id),sx:{color:"white",textDecoration:"none"},children:["GI\xc1M S\xc1T - ",(null==C?void 0:null===(n=C.exams)||void 0===n?void 0:null===(o=n.settings)||void 0===o?void 0:o.title)||"..."]}),avatar:(0,s.jsx)(j.Z,{icon:"tabler:camera-bolt",fontSize:"1.125rem"}),action:(0,s.jsxs)(d.Z,{sx:{display:"flex",alignItems:"center",color:"white"},children:[(0,s.jsx)(c.Z,{title:"Chỉnh sửa",children:(0,s.jsx)(x.Z,{sx:{color:"white"},component:eZ(),href:"/p/create.html?parent=".concat(v.query.parent,"&id=").concat(v.query.id),children:(0,s.jsx)(j.Z,{icon:"tabler:edit",fontSize:20})})}),(0,s.jsx)(c.Z,{title:"Bảng điểm",children:(0,s.jsx)(x.Z,{sx:{color:"white"},component:eZ(),href:"/p/leaderboard.html?parent=".concat(v.query.parent,"&id=").concat(v.query.id),children:(0,s.jsx)(j.Z,{icon:"tabler:checkup-list",fontSize:20})})}),(0,s.jsx)(c.Z,{title:"Xem đề thi",children:(0,s.jsx)(x.Z,{sx:{color:"white"},component:eZ(),href:null!==(m=null==C?void 0:null===(u=C.exams)||void 0===u?void 0:null===(f=u.settings)||void 0===f?void 0:f.url)&&void 0!==m?m:"#",target:"_blank",children:(0,s.jsx)(j.Z,{icon:"tabler:eye",fontSize:20})})})]}),subheader:(0,s.jsx)(tk,{}),sx:{p:{xs:2,md:5}}})}),(0,s.jsx)(tN,{statistic:C.statistic}),(0,s.jsx)(eB,{results:C.results.map(e=>{var t,n;return{point:null==e?void 0:null===(t=e.overview)||void 0===t?void 0:t.point,number:null==e?void 0:null===(n=e.overview)||void 0===n?void 0:n.number}}),maxPoint:10}),(0,s.jsx)(e7,{results:C.results.map(e=>({...e.overview,id:e.ResultId})).sort((e,t)=>t.point!==e.point?t.point-e.point:t.time!==e.time?e.time-t.time:e.startAt-t.startAt).map((e,t)=>({...e,rank:t+1})),labelColumn:C.labels,handleClick:_,realtime:!0}),(0,s.jsxs)(S.ZP,{container:!0,spacing:3,sx:{mt:3},children:[(0,s.jsx)(S.ZP,{item:!0,xs:12,md:6,children:(0,s.jsx)(tB,{messages:C.logs,sendMessage:R})}),(0,s.jsx)(S.ZP,{item:!0,xs:12,md:6,children:(0,s.jsx)(tG,{students:C.students,handleClick:M})})]}),(0,s.jsx)(tK,{exams:C.exams,data:I,handleClick:O})]})},t0=(0,L.ZP)(d.Z)(e=>{let{theme:t}=e;return{display:"flex",alignItems:"center",padding:t.spacing(6),justifyContent:"space-between"}}),t1=e=>{let{data:t,open:n,onChange:l}=e,[o,c]=(0,a.useState)({fullname:"",number:"",birthday:"",chatId:"",phone:"",email:"",sex:""}),p=e=>{c(t=>({...t,...e}))},f=()=>{var e,n,s;return(null===(e=o.fullname)||void 0===e?void 0:e.toString().trim())?(null==o?void 0:o.phone)&&!/^(03|05|07|08|09|01[2|6|8|9])+([0-9]{8})\b$/.test(null!==(n=null==o?void 0:o.phone)&&void 0!==n?n:"")?P().fire({icon:"error",title:"Xảy ra lỗi",text:"Số điện thoại kh\xf4ng hợp lệ"}):(null==o?void 0:o.email)&&!/^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$/g.test(null!==(s=null==o?void 0:o.email)&&void 0!==s?s:"")?P().fire({icon:"error",title:"Xảy ra lỗi",text:"Địa chỉ Email kh\xf4ng hợp lệ"}):JSON.stringify(t)==JSON.stringify(o)?void 0:void l(o):P().fire({icon:"error",title:"Xảy ra lỗi",text:"T\xean học sinh kh\xf4ng được để trống."})};return(0,a.useEffect)(()=>{n&&c(t)},[n,t]),(0,s.jsxs)(eE.ZP,{open:n,anchor:"right",variant:"temporary",ModalProps:{keepMounted:!0},sx:{"& .MuiDrawer-paper":{width:{xs:300,sm:400}}},children:[(0,s.jsxs)(t0,{children:[(0,s.jsx)(h.Z,{variant:"h5",children:"Th\xeam/Sửa học sinh"}),(0,s.jsx)(x.Z,{size:"small",sx:{p:"0.438rem",borderRadius:1,color:"text.primary",backgroundColor:"action.selected","&:hover":{backgroundColor:e=>"rgba(".concat(e.palette.customColors.main,", 0.16)")}},onClick:()=>l(null),children:(0,s.jsx)(j.Z,{icon:"tabler:x",fontSize:"1.125rem"})})]}),(0,s.jsxs)(d.Z,{sx:{p:e=>e.spacing(0,6,6)},children:[(0,s.jsx)(X.Z,{fullWidth:!0,sx:{mb:2},label:"Họ v\xe0 t\xean",helperText:"Th\xf4ng tin bắt buộc",required:!0,value:o.fullname||"",onChange:e=>p({fullname:e.trim()})}),(0,s.jsx)(X.Z,{fullWidth:!0,sx:{mb:2},label:"Số b\xe1o danh",type:"number",value:o.number||"",onChange:e=>p({number:e})}),(0,s.jsx)(X.Z,{fullWidth:!0,sx:{mb:2},type:"date",label:"Ng\xe0y sinh",InputLabelProps:{shrink:!0},value:o.birthday||"",onChange:e=>p({birthday:e})}),(0,s.jsxs)(X.Z,{fullWidth:!0,select:!0,sx:{mb:2},label:"Giới t\xednh",value:o.sex||"",onChange:e=>p({sex:e}),children:[(0,s.jsx)(el.Z,{value:"",children:"Chưa x\xe1c định"}),(0,s.jsx)(el.Z,{value:"Nam",children:"Nam"}),(0,s.jsx)(el.Z,{value:"Nữ",children:"Nữ"})]}),(0,s.jsx)(X.Z,{fullWidth:!0,sx:{mb:2},label:"Số điện thoại",value:o.phone||"",onChange:e=>p({phone:e})}),(0,s.jsx)(X.Z,{fullWidth:!0,sx:{mb:2},label:"Địa chỉ Email",value:o.email||"",onChange:e=>p({email:e})}),(0,s.jsx)(X.Z,{fullWidth:!0,sx:{mb:2},label:"ChatId",value:o.chatId||"",onChange:e=>p({chatId:e})})]}),(0,s.jsxs)(d.Z,{sx:{mt:3,textAlign:"center"},children:[(0,s.jsx)(u.Z,{sx:{mr:2},variant:"tonal",color:"error",onClick:()=>l(null),children:"Hủy"}),(0,s.jsx)(u.Z,{variant:"contained",onClick:f,children:"Lưu"})]})]})},t2=e=>{let{handleFilter:t,toggle:n,value:l}=e;return(0,s.jsxs)(d.Z,{sx:{py:4,px:6,rowGap:2,columnGap:4,display:"flex",flexWrap:"wrap",alignItems:"center",justifyContent:"space-between"},children:[(0,s.jsx)(d.Z,{}),(0,s.jsxs)(d.Z,{sx:{rowGap:2,display:"flex",flexWrap:"wrap",alignItems:"center"},children:[(0,s.jsx)(tM.Z,{value:l,sx:{mr:4},placeholder:"T\xean học sinh... ",onChange:e=>t(e.target.value)}),(0,s.jsxs)(u.Z,{onClick:n,variant:"contained",sx:{"& svg":{mr:2}},children:[(0,s.jsx)(j.Z,{fontSize:"1.125rem",icon:"tabler:plus"}),"Th\xeam học sinh"]})]})]})};var t5=n(2470);let t4=e=>{var t;return e.avatar?(0,s.jsx)(en.Z,{src:e.avatar,sx:{mr:2.5,width:38,height:38}}):(0,s.jsx)(en.Z,{skin:"light",color:e.avatarColor,sx:{mr:2.5,width:38,height:38,fontWeight:500,fontSize:e=>e.typography.body1.fontSize},children:(0,t5.Q)(null!==(t=e.fullname)&&void 0!==t?t:"Chưa c\xf3 th\xf4ng tin").substr(-3)})},t3=()=>{let e=(0,l.useRouter)(),t=(0,p.I0)(),[n,o]=(0,a.useState)([]),{classes:u}=e.query,[f,m]=(0,a.useState)(!1),[v,b]=(0,a.useState)(""),[C,T]=(0,a.useState)({}),I=()=>m(!f),w=(0,a.useCallback)(async()=>{try{if(!u)return e.push("/p/classes.html");m(!1),T({}),t((0,g.V)({status:"Vui l\xf2ng đợi..."}));let{data:n}=await y.default.get("/classes/class/".concat(u,"/view"));if(t((0,g.V)({status:""})),null==n?void 0:n.error)return P().fire({icon:"error",title:"Xảy ra lỗi",text:null==n?void 0:n.error});o(n.students)}catch(e){console.log("fetchData",e.message)}},[]);(0,a.useEffect)(()=>{e.isReady&&w()},[e]),(0,a.useEffect)(()=>(t((0,g.V)({status:"Vui l\xf2ng đợi..."})),()=>{t((0,g.V)({status:""}))}),[]);let E=(0,a.useCallback)(async e=>{if(!e)return T({}),m(!1);t((0,g.V)({status:"Vui l\xf2ng đợi..."}));let{data:n}=await y.default.post("/classes/class/".concat(u,"/add"),e);if(null==n?void 0:n.error)return t((0,g.V)({status:""})),P().fire({icon:"error",title:"Xảy ra lỗi",text:null==n?void 0:n.error});P().fire({icon:"success",text:"Đ\xe3 th\xeam mới học sinh "+e.fullname,timer:2e3}),await w()},[]),A=(0,a.useCallback)(e=>{b(e)},[]),Z=(0,a.useCallback)(e=>{console.log(e),T(e),m(!0)},[]),N=(0,a.useCallback)(e=>{let{id:n,fullname:s}=e;P().fire({icon:"warning",title:"Ch\xfa \xfd",html:'Bạn đang muốn x\xf3a học sinh <b style="color:red">'.concat(s,"</b> ra khỏi lớp học n\xe0y?"),showCancelButton:!0,cancelButtonText:"Hủy",confirmButtonText:"X\xf3a đi"}).then(async e=>{if(e.isConfirmed){t((0,g.V)({status:"Vui l\xf2ng đợi..."}));let{data:e}=await y.default.delete("/classes/class/".concat(u,"?studentId=").concat(n));if(null==e?void 0:e.error)return t((0,g.V)({status:""})),P().fire({icon:"error",title:"Xảy ra lỗi",text:null==e?void 0:e.error});P().fire({icon:"success",text:"Đ\xe3 x\xf3a học sinh "+s,timer:2e3}),await w()}})},[]);return(0,s.jsxs)(S.ZP,{container:!0,spacing:6.5,children:[(0,s.jsxs)(S.ZP,{item:!0,xs:12,children:[(0,s.jsx)(t2,{value:v,handleFilter:A,toggle:I}),(0,s.jsx)(et._,{autoHeight:!0,rows:(null!=n?n:[]).filter(e=>e.fullname.toLocaleLowerCase().includes(v.toLocaleLowerCase())),columns:[{flex:.25,minWidth:280,field:"fullname",headerName:"Họ v\xe0 t\xean",renderCell:e=>{let{row:t}=e,{fullname:n,phone:l}=t;return(0,s.jsxs)(d.Z,{sx:{display:"flex",alignItems:"center"},children:[t4(t),(0,s.jsxs)(d.Z,{sx:{display:"flex",alignItems:"flex-start",flexDirection:"column"},children:[(0,s.jsx)(h.Z,{noWrap:!0,component:eZ(),href:"#",sx:{fontWeight:500,textDecoration:"none",color:"text.secondary","&:hover":{color:"primary.main"}},children:n}),(0,s.jsx)(h.Z,{noWrap:!0,variant:"body2",sx:{color:"text.disabled"},children:l})]})]})}},{flex:.15,minWidth:120,headerName:"Số b\xe1o danh",field:"number",renderCell:e=>{let{row:t}=e;return(0,s.jsx)(h.Z,{noWrap:!0,sx:{fontWeight:500,color:"text.secondary",textTransform:"capitalize"},children:t.number})}},{flex:.15,minWidth:120,headerName:"Giới t\xednh",field:"sex",renderCell:e=>{let{row:t}=e;return(0,s.jsx)(h.Z,{noWrap:!0,sx:{fontWeight:500,color:"text.secondary",textTransform:"capitalize"},children:t.sex})}},{flex:.15,minWidth:120,headerName:"Ng\xe0y sinh",field:"birthday",renderCell:e=>{let{row:t}=e;return(0,s.jsx)(h.Z,{noWrap:!0,sx:{fontWeight:500,color:"text.secondary",textTransform:"capitalize"},children:t.birthday})}},{flex:.1,minWidth:100,sortable:!1,field:"id",headerName:"",renderCell:e=>{let{row:t}=e;return(0,s.jsxs)(d.Z,{children:[(0,s.jsx)(c.Z,{title:"Sửa",children:(0,s.jsx)(x.Z,{onClick:()=>Z(t),children:(0,s.jsx)(j.Z,{icon:"tabler:pencil-minus"})})}),(0,s.jsx)(c.Z,{title:"Xo\xe1",children:(0,s.jsx)(x.Z,{color:"error",onClick:()=>N(t),children:(0,s.jsx)(j.Z,{icon:"tabler:trash-filled"})})})]})}}],initialState:{pagination:{paginationModel:{pageSize:15}}},pageSizeOptions:[15,25,50],disableRowSelectionOnClick:!0})]}),(0,s.jsx)(t1,{open:f,onChange:E,data:C})]})};var t9=n(7922),t6=n(8756);let t8=e=>{let{children:t,option:n}=e;return n.href?(0,s.jsx)(d.Z,{component:eZ(),href:n.href,...n.linkProps,sx:{px:4,py:1.5,width:"100%",display:"flex",color:"inherit",alignItems:"center",textDecoration:"none"},children:t}):(0,s.jsx)(s.Fragment,{children:t})},t7=e=>{let{icon:t,options:n,menuProps:l,iconProps:o,leftAlignMenu:d,iconButtonProps:h}=e,[c,u]=(0,a.useState)(null),{settings:p}=(0,t6.r)(),{direction:f}=p,m=e=>{u(e.currentTarget)},g=()=>{u(null)};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(x.Z,{"aria-haspopup":"true",onClick:m,...h,children:t||(0,s.jsx)(j.Z,{icon:"tabler:dots-vertical",...o})}),(0,s.jsx)(er.Z,{keepMounted:!0,anchorEl:c,onClose:g,open:!!c,...!d&&{anchorOrigin:{vertical:"bottom",horizontal:"ltr"===f?"right":"left"},transformOrigin:{vertical:"top",horizontal:"ltr"===f?"right":"left"}},...l,children:n.map((e,t)=>"string"==typeof e?(0,s.jsx)(el.Z,{onClick:g,children:e},t):"divider"in e?e.divider&&(0,s.jsx)(th.Z,{...e.dividerProps},t):(0,s.jsx)(el.Z,{...e.menuItemProps,...e.href&&{sx:{p:0}},onClick:t=>{g(),e.menuItemProps&&e.menuItemProps.onClick&&e.menuItemProps.onClick(t)},children:(0,s.jsxs)(t8,{option:e,children:[e.icon?e.icon:null,e.text]})},t))})]})},ne=e=>isNaN(parseFloat(e))?0:parseFloat(e).toFixed(2);var nt=e=>{let{questionId:t}=e,n=(0,p.v9)(e=>e.quiz.questions.find(e=>e.id==t)),l=(0,p.I0)(),o=e=>{l((0,m.Ds)({id:t,...e}))},[d,h]=(0,a.useState)(!1),[u,x]=(0,a.useState)(!1),f=e=>()=>{l((0,m.Zw)({questionId:t,type:"point",value:n.point||0,list:e})),x(!1)},g=()=>{h(!0),x(!1)};return d?(0,s.jsx)(X.Z,{type:"number",size:"small",sx:{width:"auto",maxWidth:"8rem"},value:n.point||0,InputProps:{inputProps:{min:0,max:10,step:.01},endAdornment:(0,s.jsx)(O.Z,{position:"end",children:"điểm"})},onMouseLeave:()=>h(!1),onChange:e=>o({point:e}),timeout:300}):(0,s.jsx)(c.Z,{open:u,onOpen:()=>x(!0),onClose:()=>x(!1),title:(0,s.jsxs)(tc.Z,{component:"div",children:[(0,s.jsx)(tu.ZP,{disablePadding:!0,children:(0,s.jsx)(tz.Z,{sx:{paddingX:1},onClick:g,children:(0,s.jsx)(ei.Z,{disableTypography:!0,sx:{fontSize:".75rem",textAlign:"center"},children:"Click để sửa điểm"})})}),(0,s.jsx)(tu.ZP,{disablePadding:!0,children:(0,s.jsx)(tz.Z,{sx:{paddingX:1},onClick:f("group"),children:(0,s.jsx)(ei.Z,{disableTypography:!0,sx:{fontSize:".75rem"},children:"\xc1p dụng cho c\xe2u c\xf2n lại trong nh\xf3m"})})}),(0,s.jsx)(tu.ZP,{disablePadding:!0,children:(0,s.jsx)(tz.Z,{sx:{paddingX:1},onClick:f("exam"),children:(0,s.jsx)(ei.Z,{disableTypography:!0,sx:{fontSize:".75rem"},children:"\xc1p dụng cho c\xe2u c\xf2n lại trong đề thi"})})})]}),arrow:!0,children:(0,s.jsx)(tD.Z,{variant:"outlined",label:ne(n.point)+" điểm",skin:"light",color:"primary",sx:{cursor:"pointer"},onClick:g})})},nn=n(7435),ns=e=>{let{questionId:t}=e,n=(0,p.v9)(e=>e.quiz.questions.find(e=>e.id==t)),l=(0,p.I0)(),o=e=>{l((0,m.Ds)({id:t,...e}))},[d,h]=(0,a.useState)(!1);return d?(0,s.jsxs)(nn.Z,{spacing:2,onMouseLeave:()=>{h(!1)},children:[(0,s.jsx)(X.Z,{label:"Nh\xe3n",size:"small",value:n.label,onChange:e=>o({label:e.trim()}),sx:{maxWidth:"15rem"},timeout:100}),(0,s.jsx)(X.Z,{label:"STT",type:"number",size:"small",value:n.number,InputProps:{inputProps:{min:1}},sx:{maxWidth:"15rem"},onChange:e=>o({number:e}),timeout:300})]}):(0,s.jsx)(c.Z,{title:"Click để sửa số thứ tự c\xe2u",children:(0,s.jsx)(tD.Z,{label:"".concat(n.label||"C\xe2u"," ").concat(n.number),color:"primary",onClick:()=>h(!0)})})};let ni=eM()(()=>Promise.all([n.e(446),n.e(937),n.e(828),n.e(931)]).then(n.bind(n,4931)).then(e=>e.default),{loadableGenerated:{webpack:()=>[4931]},ssr:!1,loading:()=>(0,s.jsx)(d.Z,{sx:{textAlign:"center"},children:(0,s.jsx)(eg.Z,{})})}),nr=e=>(0,s.jsx)("div",{children:(0,s.jsx)(ni,{...e})});var nl=a.memo(nr);let na={mouseX:null,mouseY:null},no=e=>{let{children:t,onClick:n}=e,[l,o]=(0,a.useState)(na),d=e=>{e.preventDefault(),o({mouseX:e.clientX-2,mouseY:e.clientY-4})},h=()=>{n({index:t.key,type:"remove"}),c()},c=()=>{o(na)};return(0,s.jsxs)("div",{onContextMenu:d,style:{cursor:"context-menu"},children:[t,(0,s.jsx)(er.Z,{keepMounted:!0,onClose:c,open:null!==l.mouseY,anchorReference:"anchorPosition",anchorPosition:null!==l.mouseY&&null!==l.mouseX?{top:l.mouseY,left:l.mouseX}:void 0,children:(0,s.jsxs)(el.Z,{onClick:h,children:[(0,s.jsx)(es.Z,{children:(0,s.jsx)(j.Z,{icon:"tabler:circle-x",fontSize:20})}),(0,s.jsx)(ei.Z,{primary:"X\xf3a đ\xe1p \xe1n n\xe0y"})]})})]})},nd=e=>{let{question:t,onChange:n}=e,{type:l,options:o=[],settings:h={},id:m}=t,[g,v]=(0,a.useState)(!1),[b,C]=(0,a.useState)(""),[T,y]=(0,a.useState)(o),I=(0,p.I0)(),w=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return()=>{switch(l){case"TN":y(t=>t.map((t,n)=>({...t,keys:n===e})));break;case"HK":y(t=>t.map((t,n)=>({...t,keys:n===e?!t.keys:t.keys})));break;case"TF":y(n=>n.map((n,s)=>({...n,keys:s===e?t:n.keys})))}}},E=()=>{let e={text:"",keys:""};y(t=>[...t,e])},A=()=>{y(e=>[...e,...b.split("\n").map(e=>({text:e.trim(),keys:""})).filter(e=>e.text)]),C(""),v(!1)},P=e=>{let{index:t,type:n}=e;"remove"===n&&y(e=>{var n=[...e];return n.splice(parseInt(t),1),n})},Z=()=>{I((0,f.z)({status:"options",data:{questionId:m,title:"CẤU H\xccNH NHẬN DIỆN Đ\xc1P \xc1N ĐIỀN TỪ",...h}}))},S=(0,a.useMemo)(()=>T.map((e,t)=>{let n=e=>{y(n=>n.map((n,s)=>({...n,text:s===t?e:n.text})))};return(0,s.jsx)(no,{onClick:P,children:(0,s.jsx)(tu.ZP,{disablePadding:!0,sx:{borderRadius:1,mb:1,border:"1px solid #b2b2b299"},children:(0,s.jsxs)(tz.Z,{sx:{paddingX:1.25,borderRadius:1},user:"TF"!==l&e.keys?"right":"",children:["TF"==l?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(en.Z,{skin:"light",color:"success",sx:{mr:1},user:"T"==e.keys?"right":"",onClick:w(t,"T"),children:"Đ"}),(0,s.jsx)(en.Z,{skin:"light",user:"F"==e.keys?"right":"",color:"success",sx:{mr:1},onClick:w(t,"F"),children:"S"}),(0,s.jsx)(en.Z,{skin:"light",sx:{mr:1},children:String.fromCharCode(97+t)})]}):(0,s.jsx)(tF.Z,{sx:{mr:1.25},onClick:w(t),children:(0,s.jsx)(en.Z,{skin:e.keys?"light-static":"light",sx:{fontWeight:600},children:"MN|DT".includes(l)?t+1:String.fromCharCode(65+t)})}),(0,s.jsx)(ei.Z,{disableTypography:!0,sx:{justifyItems:"center"},children:"DT"==l?(0,s.jsx)(X.Z,{placeholder:"Vui l\xf2ng nhập danh s\xe1ch đ\xe1p \xe1n cần th\xeam",fullWidth:!0,value:e.text||"",onChange:n}):(0,s.jsx)(nl,{content:e.text||"",onChange:n})})]})},t)},t)}),[T,l]);return((0,a.useEffect)(()=>{JSON.stringify(o)!==JSON.stringify(T)&&n({options:T})},[T,o]),(0,a.useEffect)(()=>{JSON.stringify(o)!==JSON.stringify(T)&&y(o)},[]),"TN|HK|MN|DT|TF".includes(l))?(0,s.jsxs)(d.Z,{sx:{mb:2},children:[(0,s.jsxs)(d.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,s.jsx)(th.Z,{sx:{flexGrow:"1"},children:"DANH S\xc1CH Đ\xc1P \xc1N"}),"DT".includes(l)?(0,s.jsx)(c.Z,{title:"C\xe0i đặt nhận diện đ\xe1p \xe1n",children:(0,s.jsx)(x.Z,{size:"small",sx:{ml:1},onClick:Z,children:(0,s.jsx)(j.Z,{icon:"tabler:settings-check",fontSize:20})})}):null]}),(0,s.jsx)(tc.Z,{children:S}),(0,s.jsxs)(d.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[(0,s.jsx)(u.Z,{variant:"contained",size:"small",color:"success",onClick:E,children:"Th\xeam đ\xe1p \xe1n"}),(0,s.jsx)(u.Z,{variant:"tonal",size:"small",onClick:()=>v(!0),children:"Th\xeam nhanh"})]}),g?(0,s.jsxs)(d.Z,{children:[(0,s.jsx)(X.Z,{placeholder:"Vui l\xf2ng nhập danh s\xe1ch đ\xe1p \xe1n cần th\xeam",helperText:"* Lưu \xfd mỗi đ\xe1p \xe1n chỉ tr\xean một d\xf2ng",fullWidth:!0,minRows:3,multiline:!0,value:b,onChange:e=>C(e)}),(0,s.jsxs)(d.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"flex-end",mb:2},children:[(0,s.jsx)(u.Z,{variant:"tonal",size:"small",onClick:()=>{v(!1),C("")},sx:{mr:1},children:"Hủy"}),(0,s.jsx)(u.Z,{variant:"contained",size:"small",onClick:A,children:"X\xe1c nhận"})]})]}):null]}):null};var nh=a.memo(nd),nc=n(5438),nu=n(2852),nx=a.memo(function(e){let{videoId:t}=e;return(0,s.jsx)("div",{style:{position:"relative",paddingBottom:"56.25%",height:0,overflow:"hidden"},children:(0,s.jsx)("iframe",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%"},src:"https://www.youtube.com/embed/".concat((e=>{let t=e.match(/^(?:https?:\/\/)?(?:www\.)?youtu\.?be(?:\.com)?\/(?:watch\?v=|embed\/|v\/|youtu\.be\/|youtube\.com\/(?:c\/|v\/|u\/\w+\/|embed\/|watch\?v=|shorts\/))([\w-]{11})(?:[?&].*|$)/);return t?t[1]:null})(t)),title:"YouTube video player",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",frameBorder:"0",allowFullScreen:!0})})}),np=a.memo(e=>{let{audio:t,onChange:n}=e,[l,o]=(0,a.useState)(""),{type:h,src:p}=t||{},f=e=>{let s=e.target.files[0];if(s){if("audio/mp3"===s.type||"audio/wav"===s.type||"audio/mpeg"===s.type||"audio/ogg"===s.type){let e=URL.createObjectURL(s);n({...t,src:e,type:"audio"})}else P().fire({icon:"error",title:"Oops...",text:"Chọn một file \xe2m thanh MP3 hoặc WAV."})}},m=e=>{let t=e.match(/^(?:https?:\/\/)?(?:www\.)?youtu\.?be(?:\.com)?\/(?:watch\?v=|embed\/|v\/|youtu\.be\/|youtube\.com\/(?:c\/|v\/|u\/\w+\/|embed\/|watch\?v=|shorts\/))([\w-]{11})(?:[?&].*|$)/);return t?t[1]:null},g=()=>{let e=m(l);e?(v({...t,src:l,type:"youtube"}),o("")):console.log("URL kh\xf4ng hợp lệ hoặc kh\xf4ng phải l\xe0 URL của video YouTube.")},v=e=>{n({...t,...e})};return(0,s.jsxs)(d.Z,{sx:{mb:2},children:[(0,s.jsxs)(d.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,s.jsxs)(u.Z,{variant:"tonal",fullWidth:!0,component:"label",sx:{mr:2},endIcon:(0,s.jsx)(j.Z,{icon:"tabler:headphones-filled"}),children:["Đ\xednh k\xe8m file \xe2m thanh",(0,s.jsx)("input",{type:"file",accept:".mp3, .wav,.mpeg, .ogg",hidden:!0,onChange:f})]}),(0,s.jsx)(u.Z,{variant:"tonal",fullWidth:!0,color:"success",endIcon:(0,s.jsx)(j.Z,{icon:"tabler:brand-youtube-filled"}),onClick:()=>{n({...t,type:"youtube",src:""})},children:"Đ\xednh k\xe8m video youtube"})]}),"youtube"!=h||p?null:(0,s.jsxs)(d.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",marginY:3},children:[(0,s.jsx)(R.Z,{size:"small",fullWidth:!0,variant:"outlined",label:"Link youtube",placeholder:"https://www.youtube.com/watch?v=TAODETHI",sx:{mr:2},color:"success",value:l,onChange:e=>o(e.target.value)}),(0,s.jsx)(u.Z,{variant:"outlined",color:"success",endIcon:(0,s.jsx)(j.Z,{icon:"tabler:square-rounded-plus-filled"}),onClick:g,children:"Th\xeam"})]}),"youtube"==h&&p?(0,s.jsx)(d.Z,{sx:{marginY:3},children:(0,s.jsx)(nx,{videoId:p})}):null,"audio"==h&&p?(0,s.jsx)(d.Z,{sx:{marginY:3},children:(0,s.jsx)("audio",{controls:!0,controlsList:"nodownload",preload:"metadata",src:p,style:{width:"100%"}})}):null,p?(0,s.jsxs)(tc.Z,{subheader:(0,s.jsx)(nc.Z,{children:"C\xe0i đặt Tệp đ\xednh k\xe8m"}),children:[(0,s.jsxs)(tz.Z,{divider:!0,onClick:()=>v({download:!t.download}),children:[(0,s.jsx)(tF.Z,{children:(0,s.jsx)(j.Z,{icon:"tabler:download",fontSize:20})}),(0,s.jsxs)(ei.Z,{children:["Cho ph\xe9p tải file xuống",(0,s.jsx)(c.Z,{title:"Người nghe c\xf3 thể tải tập tin n\xe0y xuống m\xe1y t\xednh, điện thoại",children:(0,s.jsx)(x.Z,{size:"small",children:(0,s.jsx)(j.Z,{icon:"tabler:info-square-rounded",fontSize:20})})})]}),(0,s.jsx)(tb.Z,{children:(0,s.jsx)(nu.Z,{edge:"end",checked:t.download||!1})})]}),(0,s.jsxs)(tz.Z,{divider:!0,onClick:()=>v({next:!t.next}),children:[(0,s.jsx)(tF.Z,{children:(0,s.jsx)(j.Z,{icon:"tabler:player-track-next",fontSize:20})}),(0,s.jsxs)(ei.Z,{children:["Cho ph\xe9p tua file nghe, video",(0,s.jsx)(c.Z,{title:"Người nghe c\xf3 thể tua để nghe trước tập tin \xe2m thanh hoặc video",children:(0,s.jsx)(x.Z,{size:"small",children:(0,s.jsx)(j.Z,{icon:"tabler:info-square-rounded",fontSize:20})})})]}),(0,s.jsx)(tb.Z,{children:(0,s.jsx)(nu.Z,{edge:"end",checked:t.next||!1})})]}),(0,s.jsxs)(tz.Z,{divider:!0,onClick:()=>v({speed:!t.speed}),children:[(0,s.jsx)(tF.Z,{children:(0,s.jsx)(j.Z,{icon:"tabler:brand-speedtest",fontSize:20})}),(0,s.jsxs)(ei.Z,{children:["Cho ph\xe9p tăng, giảm tốc độ nghe",(0,s.jsx)(c.Z,{title:"Người nghe c\xf3 thể tăng tốc độ l\xean 2x hoặc x\xf3a 0.5x khi nghhe",children:(0,s.jsx)(x.Z,{size:"small",children:(0,s.jsx)(j.Z,{icon:"tabler:info-square-rounded",fontSize:20})})})]}),(0,s.jsx)(tb.Z,{children:(0,s.jsx)(nu.Z,{edge:"end",checked:t.speed||!1})})]})]}):null]})});let nf=e=>{let{options:t=[],label:n="",questionId:l,onChange:o,value:d="",type:h="level"}=e,[u,x]=(0,a.useState)(!1),f=(0,p.I0)(),g=e=>()=>{f((0,m.Zw)({questionId:l,type:h,value:d,list:e})),x(!1)};return(0,s.jsx)(c.Z,{open:u,title:(0,s.jsxs)(tc.Z,{component:"div",children:[(0,s.jsx)(tu.ZP,{disablePadding:!0,children:(0,s.jsx)(tz.Z,{sx:{paddingX:1},onClick:g("group"),children:(0,s.jsx)(ei.Z,{disableTypography:!0,sx:{fontSize:".75rem"},children:"\xc1p dụng cho c\xe2u c\xf2n lại trong nh\xf3m"})})}),(0,s.jsx)(tu.ZP,{disablePadding:!0,children:(0,s.jsx)(tz.Z,{sx:{paddingX:1},onClick:g("exam"),children:(0,s.jsx)(ei.Z,{disableTypography:!0,sx:{fontSize:".75rem"},children:"\xc1p dụng cho c\xe2u c\xf2n lại trong đề thi"})})})]}),placement:"top",arrow:!0,onOpen:()=>x(!0),onClose:()=>x(!1),children:(0,s.jsx)(R.Z,{select:!0,label:n,size:"small",sx:{mr:1},value:d||"",onChange:e=>o(e.target.value),children:t.map(e=>(0,s.jsx)(el.Z,{value:e.key,children:e.title},e.key))})})};var nm=a.memo(nf);let ng=[{key:"TN",title:"Trắc nghiệm"},{key:"TF",title:"Trắc nghiệm đ\xfang sai"},{key:"HK",title:"Nhiều lựa chọn"},{key:"DT",title:"Điền từ"},{key:"TL",title:"Tự luận"}],nv=[{key:"NB",title:"Nhận biết"},{key:"TH",title:"Th\xf4ng hiểu"},{key:"VD",title:"Vận dụng"},{key:"VDC",title:"Vận dụng cao"}],nb=e=>{let{questionId:t}=e,n=(0,p.v9)(e=>e.quiz.questions.find(e=>e.id==t)),[l,o]=(0,a.useState)(n),[f,g]=(0,a.useState)(!1),v=(0,p.I0)(),b=e=>{o(t=>({...t,...e}))},C=()=>{v((0,m.cN)({questionId:t}))},T=()=>{P().fire({title:"X\xf3a ".concat(l.label," ").concat(l.number),text:"Bạn đang thực hiện lệnh x\xf3a c\xe2u hỏi. Bạn c\xf3 muốn tiếp tục kh\xf4ng?",icon:"warning",showCancelButton:!0,confirmButtonText:"Đ\xfang. X\xf3a đi.",cancelButtonText:"Hủy"}).then(e=>{e.isConfirmed&&(v((0,m.dA)(t)),P().fire({position:"top-end",icon:"success",title:"Đ\xe3 x\xf3a c\xe2u hỏi",showConfirmButton:!1,timer:1500}))})},y=e=>t=>{let n=!l.audios&&Array.isArray(l.audios)?[...l.audios]:[{}];n[e]=t,b({audios:n})};(0,a.useEffect)(()=>{JSON.stringify(l)!==JSON.stringify(n)&&o(n)},[n]);let I=[{icon:(0,s.jsx)(j.Z,{icon:"tabler:circle-x"}),text:"X\xf3a c\xe2u hỏi n\xe0y",menuItemProps:{sx:{"& svg":{mr:2},color:"error.main"},onClick:T}}],w=(0,a.useCallback)(()=>{g(!0)},[]),E=(0,a.useCallback)(()=>{g(!1)},[]);return((0,a.useEffect)(()=>{JSON.stringify(l)!==JSON.stringify(n)&&v((0,m.Ds)(l))},[l]),l)?(0,s.jsxs)("div",{onMouseEnter:w,onMouseLeave:E,id:t,children:[(0,s.jsxs)(ek.Z,{sx:{mb:2},children:[(0,s.jsx)(K.Z,{title:(0,s.jsx)(ns,{questionId:t}),sx:{paddingY:2,overflowX:"auto",px:{xs:2,md:4}},action:(0,s.jsxs)(d.Z,{sx:{display:"flex",alignItems:"center"},children:[(0,s.jsx)(nt,{questionId:t}),(0,s.jsx)(c.Z,{title:"Th\xeam file nghe",children:(0,s.jsx)(x.Z,{size:"small",sx:{mr:1,ml:1,background:(l.audios||"").length?"#7367f0":"",color:(l.audios||"").length?"#fff":""},onClick:()=>{(l.audios||"").length?b({audios:[]}):b({audios:[{}]})},children:(0,s.jsx)(j.Z,{icon:(l.audios||"").length?"tabler:headphones-filled":"tabler:headphones-off",fontSize:20})})}),(0,s.jsx)(c.Z,{title:"Cố định đ\xe1p \xe1n",children:(0,s.jsx)(x.Z,{size:"small",sx:{mr:1,background:l.shuffle?"#7367f0":"",color:l.shuffle?"#fff":""},onClick:()=>b({shuffle:!l.shuffle}),children:(0,s.jsx)(j.Z,{icon:l.shuffle?"tabler:pin-filled":"tabler:pinned-off",fontSize:20})})}),(0,s.jsx)(nm,{label:"Loại c\xe2u hỏi",type:"type",questionId:t,value:l.type||"TN",options:ng,onChange:e=>b({type:e})}),(0,s.jsx)(nm,{label:"Mức độ",type:"level",questionId:t,value:l.level||"",options:nv,onChange:e=>b({level:e})}),(0,s.jsx)(t7,{options:I,iconButtonProps:{size:"small",sx:{color:"text.disabled"}}})]})}),(0,s.jsx)(th.Z,{}),(0,s.jsxs)(Q.Z,{sx:{px:{xs:2,md:4}},children:[l.audios&&l.audios.length?(0,s.jsx)(eA.Z,{severity:"warning",icon:!1,sx:{".MuiAlert-message":{width:"100%",overflow:"unset"},mt:3,".MuiListSubheader-root":{backgroundColor:"inherit"}},children:Array.isArray(l.audios)?l.audios.map((e,t)=>(0,s.jsx)(np,{audio:e,onChange:y(t)},t)):null}):null,(0,s.jsx)(d.Z,{sx:{paddingY:3},children:(0,s.jsx)(nl,{content:l.content,onChange:e=>b({content:e})})}),(0,s.jsx)(nh,{question:l,onChange:b}),(0,s.jsxs)(eA.Z,{severity:"info",icon:!1,sx:{".MuiAlert-message":{width:"100%",overflow:"unset"}},children:[(0,s.jsx)(th.Z,{children:"HƯỚNG DẪN GIẢI"}),(0,s.jsx)(d.Z,{children:(0,s.jsx)(nl,{content:l.explain||"",onChange:e=>b({explain:e})})})]})]})]}),(0,s.jsx)(d.Z,{sx:{mb:3,textAlign:"-webkit-center",height:"1.5rem"},children:f?(0,s.jsx)(th.Z,{sx:{width:"75%"},children:(0,s.jsx)(u.Z,{variant:"tonal",size:"small",startIcon:(0,s.jsx)(j.Z,{icon:"tabler:plus"}),onClick:C,children:"Th\xeam c\xe2u hỏi"})}):null})]}):(0,s.jsx)(ek.Z,{sx:{mb:2,background:"#e91e1ec9"},children:(0,s.jsx)(K.Z,{title:(0,s.jsx)(h.Z,{sx:{textAlign:"center",color:"#fff"},variant:"h5",children:"C\xe2u hỏi kh\xf4ng tồn tại"})})})};var nC=a.memo(nb);let nj=e=>e.reduce((e,t)=>{let n=parseFloat(t.point);return isNaN(n)?e:e+n},0);var nT=e=>{let{groupId:t}=e,n=(0,p.v9)(e=>e.quiz.questions.filter(e=>e.groupId==t));return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(tp.Z,{rounded:!0,label:"".concat(n.length," c\xe2u"),skin:"light",color:"primary",size:"small",sx:{mr:1,width:"100%"}}),(0,s.jsx)(tp.Z,{rounded:!0,label:"".concat(nj(n).toFixed(2)," điểm"),skin:"light",color:"error",size:"small",sx:{width:"100%"}})]})};let ny=e=>{var t,n;let{groupId:l,isOne:o}=e,{questions:h,random:g,content:v,...b}=(0,p.v9)(e=>e.quiz.groups.find(e=>e.id==l)),C=(0,p.I0)(),[T,y]=(0,a.useState)(!0),I=(0,a.useMemo)(()=>h.map(e=>(0,s.jsx)(nC,{questionId:e},e)),[h]),w=()=>{C((0,m.xL)({groupId:l}))},E=()=>{C((0,m.mD)({id:l,random:!g}))},A=()=>{C((0,f.z)({status:"group",data:{...b,random:g,title:"CẤU H\xccNH NH\xd3M C\xc2U HỎI"}}))},Z=e=>{C((0,m.mD)({id:l,content:e}))},S=()=>{P().fire({title:"X\xf3a nh\xf3m c\xe2u hỏi?",text:"Bạn đang thực hiện lệnh x\xf3a nh\xf3m c\xe2u hỏi n\xe0y. Bạn c\xf3 muốn tiếp tục kh\xf4ng?",icon:"warning",showCancelButton:!0,confirmButtonText:"Đ\xfang. X\xf3a đi.",cancelButtonText:"Hủy"}).then(e=>{e.isConfirmed&&(C((0,m.BN)({groupId:l})),P().fire({position:"top-end",icon:"success",title:"Đ\xe3 x\xf3a th\xe0nh c\xf4ng",showConfirmButton:!1,timer:1500}))})},N=[{icon:(0,s.jsx)(j.Z,{icon:"tabler:circle-x"}),text:"X\xf3a nh\xf3m c\xe2u hỏi n\xe0y",menuItemProps:{sx:{"& svg":{mr:2},color:"error.main"},onClick:S}}];return o?(0,s.jsxs)(Q.Z,{sx:{paddingX:0,mt:3},id:l,children:[I,(null==I?void 0:I.length)?null:(0,s.jsx)(u.Z,{variant:"outlined",endIcon:(0,s.jsx)(j.Z,{icon:"tabler:help-octagon"}),fullWidth:!0,sx:{mb:2},onClick:w,children:"TH\xcaM C\xc2U HỎI"})]}):(0,s.jsxs)(d.Z,{children:[(0,s.jsxs)(ek.Z,{className:"header-group",sx:{border:0,boxShadow:0,mb:2.5},id:l,children:[(0,s.jsx)(K.Z,{sx:{paddingY:1,alignItems:"center"},avatar:(0,s.jsx)(j.Z,{icon:"tabler:clipboard-list"}),action:(0,s.jsxs)(d.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,s.jsx)(c.Z,{title:"Th\xeam file nghe cho nh\xf3m c\xe2u hỏi",children:(0,s.jsx)(x.Z,{size:"small",sx:{color:"text.secondary",background:(null==b?void 0:null===(t=b.audios)||void 0===t?void 0:t.length)?"#7367f0":"",color:(null==b?void 0:null===(n=b.audios)||void 0===n?void 0:n.length)?"#fff":""},onClick:A,children:(0,s.jsx)(j.Z,{icon:"tabler:headphones-filled",fontSize:20})})}),(0,s.jsx)(c.Z,{title:"Cố định c\xe2u hỏi trong nh\xf3m",children:(0,s.jsx)(x.Z,{size:"small",sx:{mx:1,background:g?"#7367f0":"",color:g?"#fff":""},onClick:E,children:(0,s.jsx)(j.Z,{icon:g?"tabler:pinned-filled":"tabler:pinned",fontSize:20})})}),(0,s.jsx)(nT,{groupId:l}),(0,s.jsx)(c.Z,{title:"Cấu h\xecnh nh\xf3m c\xe2u hỏi",children:(0,s.jsx)(x.Z,{size:"small",sx:{color:"text.secondary"},onClick:A,children:(0,s.jsx)(j.Z,{icon:"tabler:settings-share",fontSize:20})})}),(0,s.jsx)(t7,{options:N,iconButtonProps:{size:"small",sx:{color:"text.disabled"}}}),(0,s.jsx)(c.Z,{title:"Ẩn/Hiện chi tiết",children:(0,s.jsx)(x.Z,{size:"small","aria-label":"collapse",sx:{mr:2,color:"text.secondary"},onClick:()=>y(!T),children:(0,s.jsx)(j.Z,{fontSize:20,icon:T?"tabler:chevron-up":"tabler:chevron-down"})})})]})}),(0,s.jsx)(Q.Z,{sx:{p:e=>"".concat(e.spacing(4,3,4)," !important")},children:(0,s.jsx)(nl,{content:v||"",sx:{marginY:5},onChange:Z})})]}),(0,s.jsx)(t9.Z,{in:T,children:(0,s.jsxs)(Q.Z,{sx:{paddingX:0,mt:3},children:[I,(null==I?void 0:I.length)?null:(0,s.jsx)(u.Z,{variant:"outlined",endIcon:(0,s.jsx)(j.Z,{icon:"tabler:help-octagon"}),fullWidth:!0,sx:{mb:2},onClick:w,children:"TH\xcaM C\xc2U HỎI"})]})})]})},nI=e=>e.reduce((e,t)=>{let n=parseFloat(t.point);return isNaN(n)?e:e+n},0);var nw=e=>{let{quizId:t}=e,n=(0,p.v9)(e=>e.quiz.questions.filter(e=>e.quizId==t));return(0,s.jsxs)(d.Z,{sx:{display:"flex",alignItems:"center",flexFlow:"column",mr:1},children:[(0,s.jsx)(tp.Z,{rounded:!0,label:"".concat(n.length," c\xe2u"),skin:"light",color:"primary",size:"small",sx:{mb:1,width:"100%"}}),(0,s.jsx)(tp.Z,{rounded:!0,label:"".concat(nI(n).toFixed(2)," điểm"),skin:"light",color:"success",size:"small",sx:{width:"100%"}})]})},nE=n(6591);let nA=e=>{let{quizId:t}=e;return(0,s.jsx)(eE.ZP,{open:!!t,sx:{zIndex:1301},anchor:"right",children:"hihi"})},nP=e=>{let{quizId:t}=e,[n,l]=(0,a.useState)(!0),[o,h]=(0,a.useState)(!1),[f,v]=(0,a.useState)(""),b=(0,p.v9)(e=>e.quiz.quizs.find(e=>e.id==t)),C=(0,p.v9)(e=>e.quiz.questions.filter(e=>e.quizId==t)).length,T=(0,p.I0)(),y=()=>{T((0,m.Rp)({quizId:t}))},I=(0,a.useMemo)(()=>b.groups.map(e=>(0,s.jsx)(ny,{groupId:e,isOne:1==b.groups.length},e)),[b.groups]),w=()=>{(0,nE.ImportFile)(t,e=>{let{status:t,data:n,error:s}=e;if(s)return T((0,g.V)({status:""})),P().fire({icon:"error",title:"Oops...",text:s});switch(t){case"done":T((0,m.l$)(n)),T((0,g.V)({status:""}));break;case"loading":T((0,g.V)(n))}})},E=()=>{C?P().fire({title:"Thay đổi c\xe2u hỏi Đề số ".concat(b.number),html:"Khi bạn thay đổi dữ liệu c\xe2u hỏi của đề thi số ".concat(b.number,", nếu đ\xe3 c\xf3 học sinh l\xe0m b\xe0i th\xec dữ liệu b\xe0i l\xe0m của học sinh đ\xf3 sẽ kh\xf4ng được lưu v\xe0 t\xednh l\xe0 0 điểm. Để đảm bảo kh\xf4ng ảnh hưởng để kết quả của học sinh, chỉ chỉ c\xf3 thể chỉnh sửa ngay tại c\xe2u hỏi đ\xf3. Bạn c\xf3 muốn tiếp tục kh\xf4ng?"),icon:"warning",showCancelButton:!0,confirmButtonText:"Tiếp tục",cancelButtonText:"Hủy"}).then(e=>{e.isConfirmed&&w()}):w()},A=()=>{P().fire({title:"X\xf3a Đề số ".concat(b.number),text:"Bạn đang thực hiện lệnh x\xf3a đề thi. Bạn c\xf3 muốn tiếp tục kh\xf4ng?",icon:"warning",showCancelButton:!0,confirmButtonText:"Đ\xfang. X\xf3a đi.",cancelButtonText:"Hủy"}).then(e=>{e.isConfirmed&&(T((0,m.GE)({quizId:t})),P().fire({position:"top-end",icon:"success",title:"Đ\xe3 x\xf3a th\xe0nh c\xf4ng",showConfirmButton:!1,timer:1500}))})},Z=()=>{T((0,m.QT)({quizId:t}))},S=[{icon:(0,s.jsx)(j.Z,{icon:"tabler:list-numbers"}),text:"Đ\xe1nh lại số thứ tự c\xe2u hỏi",menuItemProps:{sx:{"& svg":{mr:2}},onClick:Z}},{icon:(0,s.jsx)(j.Z,{icon:"tabler:file-type-docx"}),text:"Nhập c\xe2u hỏi từ tập tin .pdf, .docx",menuItemProps:{sx:{"& svg":{mr:2}},onClick:E}},{icon:(0,s.jsx)(j.Z,{icon:"tabler:circle-x"}),text:"X\xf3a đề thi n\xe0y",menuItemProps:{sx:{"& svg":{mr:2},color:"error.main"},onClick:A}}];return(0,s.jsxs)("div",{style:{marginBottom:10},className:o?"card-fullscreen":"",id:b.id,children:[(0,s.jsx)(K.Z,{className:"header-exam",sx:{paddingY:3,borderRadius:"0.5rem","span, svg":{color:"#fff"}},title:"Đề số "+b.number,action:(0,s.jsxs)(d.Z,{sx:{display:"flex",alignItems:"center"},children:[(0,s.jsx)(c.Z,{title:"Nhập c\xe2u hỏi từ tập tin .pdf, .docx",children:(0,s.jsx)(x.Z,{size:"small",sx:{color:"text.secondary"},onClick:E,children:(0,s.jsx)(j.Z,{icon:"tabler:upload",fontSize:20})})}),(0,s.jsx)(nw,{quizId:t}),(0,s.jsx)(c.Z,{title:o?"Thu nhỏ m\xe0n h\xecnh đề thi số "+b.number:"Mở rộng m\xe0n h\xecnh đề thi số "+b.number,children:(0,s.jsx)(x.Z,{size:"small",sx:{color:"text.secondary"},onClick:()=>h(!o),children:(0,s.jsx)(j.Z,{icon:o?"tabler:arrows-minimize":"tabler:arrows-maximize",fontSize:20})})}),(0,s.jsx)(t7,{options:S,iconButtonProps:{size:"small",sx:{color:"text.disabled"}}}),(0,s.jsx)(c.Z,{title:n?"Ẩn chi tiết đề thi số "+b.number:"Hiển thị chi tiết đề thi số "+b.number,children:(0,s.jsx)(x.Z,{size:"small","aria-label":"collapse",sx:{mr:2,color:"text.secondary"},onClick:()=>l(!n),children:(0,s.jsx)(j.Z,{fontSize:20,icon:n?"tabler:chevron-up":"tabler:chevron-down"})})})]})}),(0,s.jsx)(t9.Z,{in:n,children:(0,s.jsxs)(Q.Z,{sx:{paddingX:0,mt:3},children:[I,(0,s.jsx)(u.Z,{variant:"tonal",endIcon:(0,s.jsx)(j.Z,{icon:"tabler:square-rounded-plus"}),fullWidth:!0,sx:{mb:2},color:"success",onClick:y,children:"TH\xcaM NH\xd3M C\xc2U HỎI"})]})}),(0,s.jsx)(nA,{quizId:f})]})},nZ=()=>{let e=(0,p.v9)(e=>e.quiz.quizs),t=(0,p.I0)(),n=()=>{t((0,m.BT)())};return(0,s.jsxs)(s.Fragment,{children:[e.map(e=>(0,s.jsx)(nP,{quizId:e.id},e.id)),(0,s.jsx)(u.Z,{variant:"contained",endIcon:(0,s.jsx)(j.Z,{icon:"tabler:clipboard-plus"}),fullWidth:!0,sx:{mt:3},onClick:n,children:"TH\xcaM ĐỀ THI"})]})};var nS=n(4054),nN=n(3841),nL=n(7709);let nk=()=>{var e,t;let n=(0,p.v9)(e=>e.quiz.settings),[o,c]=(0,a.useState)(!1),u=(0,p.I0)(),g=(0,l.useRouter)(),v=z(),b=()=>{if(o)return;let e=document.createElement("input");e.setAttribute("type","file"),e.setAttribute("accept","image/*"),e.click(),e.onchange=async()=>{let[t]=e.files;if(t){c(!0);let e=n.cover||"https://i.imgur.com/dKZNJGk.png",s=URL.createObjectURL(t);C({cover:s});let{error:l,url:a}=await I(t);c(!1),l&&(C({cover:e}),P().fire({icon:"error",title:"C\xf3 lỗi khi thay đổi ảnh b\xeca"})),a&&C({cover:a})}}},C=e=>{u((0,m.kQ)(e))},T=e=>()=>{e&&g.push({pathname:e,query:g.query})},y=()=>{u((0,f.z)({status:"settings",data:{}}))},w=e=>{v.copy(e),Z.ZP.success("Đ\xe3 sao ch\xe9p",{duration:2e3})};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(ek.Z,{sx:{background:"#b1b1b11f",mb:3},children:(0,s.jsx)(Q.Z,{sx:{padding:".5rem!important"},children:(0,s.jsxs)(tc.Z,{component:"div",sx:{p:0},children:[(0,s.jsx)(tu.ZP,{disablePadding:!0,children:(0,s.jsxs)(tz.Z,{sx:{display:"flex",flexDirection:"column"},onClick:b,children:[o?(0,s.jsxs)(d.Z,{style:{position:"relative"},children:[(0,s.jsx)("img",{src:null!==(e=null==n?void 0:n.cover)&&void 0!==e?e:"https://i.imgur.com/dKZNJGk.png",style:{maxWidth:"100%",filter:"blur(5px)"}}),(0,s.jsx)(eg.Z,{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}})]}):(0,s.jsx)("img",{src:null!==(t=null==n?void 0:n.cover)&&void 0!==t?t:"https://i.imgur.com/dKZNJGk.png",style:{maxWidth:"100%"}}),(0,s.jsx)(ei.Z,{primary:"Click để thay đổi ảnh b\xeca"})]})}),(0,s.jsx)(tu.ZP,{disablePadding:!0,children:(0,s.jsx)(X.Z,{fullWidth:!0,label:"T\xean đề thi",value:n.title,onChange:e=>C({title:e})})}),(0,s.jsx)(tu.ZP,{disablePadding:!0,children:(0,s.jsxs)(d.Z,{sx:{width:"100%"},children:[(0,s.jsx)(h.Z,{variant:"h6",sx:{marginY:2},children:"Giới thiệu về đề thi"}),(0,s.jsx)(nl,{content:n.subtitle,sx:{minHeight:"5rem"},theme:"snow",inline:!0,onChange:e=>C({subtitle:e})})]})})]})})}),(null==n?void 0:n.url)?(0,s.jsx)(ek.Z,{sx:{mb:3},children:(0,s.jsx)(Q.Z,{sx:{p:"0.75rem!important"},children:(0,s.jsxs)(nS.Z,{fullWidth:!0,variant:"outlined",children:[(0,s.jsx)(nN.Z,{children:"Link đề thi"}),(0,s.jsx)(nL.Z,{value:(null==n?void 0:n.url)||"",disabled:!0,endAdornment:(0,s.jsx)(O.Z,{position:"end",children:(0,s.jsx)(x.Z,{edge:"end",onClick:()=>w(null==n?void 0:n.url),sx:{color:"success.main"},children:(0,s.jsx)(j.Z,{icon:"tabler:copy",fontSize:20})})}),label:"Link đề thi"})]})})}):null,(null==n?void 0:n.share)=="T"&&(null==n?void 0:n.id)?(0,s.jsx)(ek.Z,{sx:{mb:3},children:(0,s.jsx)(Q.Z,{sx:{p:"0.75rem!important"},children:(0,s.jsxs)(nS.Z,{fullWidth:!0,variant:"outlined",children:[(0,s.jsx)(nN.Z,{children:"M\xe3 chia sẻ"}),(0,s.jsx)(nL.Z,{value:E(null==n?void 0:n.id),disabled:!0,endAdornment:(0,s.jsx)(O.Z,{position:"end",children:(0,s.jsx)(x.Z,{edge:"end",onClick:()=>w(E(null==n?void 0:n.id)),sx:{color:"success.main"},children:(0,s.jsx)(j.Z,{icon:"tabler:copy",fontSize:20})})}),label:"M\xe3 chia sẻ"})]})})}):null,(0,s.jsx)(ek.Z,{className:"menu-settings",children:(0,s.jsx)(Q.Z,{sx:{padding:".5rem!important"},children:(0,s.jsxs)(tc.Z,{component:"div",sx:{p:0,color:"#fff"},children:[(0,s.jsx)(tu.ZP,{disablePadding:!0,onClick:y,children:(0,s.jsxs)(tz.Z,{children:[(0,s.jsx)(es.Z,{sx:{color:"#fff"},children:(0,s.jsx)(j.Z,{icon:"tabler:settings",fontSize:20})}),(0,s.jsx)(ei.Z,{primary:"C\xe0i đặt b\xe0i l\xe0m online",disableTypography:!0})]})}),(null==n?void 0:n.url)?(0,s.jsx)(tu.ZP,{disablePadding:!0,onClick:T("/p/leaderboard.html"),children:(0,s.jsxs)(tz.Z,{children:[(0,s.jsx)(es.Z,{sx:{color:"#fff"},children:(0,s.jsx)(j.Z,{icon:"tabler:checkup-list",fontSize:20})}),(0,s.jsx)(ei.Z,{primary:"Bảng điểm",disableTypography:!0})]})}):null,(null==n?void 0:n.url)?(0,s.jsx)(tu.ZP,{disablePadding:!0,onClick:T("/p/realtime.html"),children:(0,s.jsxs)(tz.Z,{children:[(0,s.jsx)(es.Z,{sx:{color:"#fff"},children:(0,s.jsx)(j.Z,{icon:"tabler:camera-bolt",fontSize:20})}),(0,s.jsx)(ei.Z,{primary:"Gi\xe1m s\xe1t thời gian thực",disableTypography:!0})]})}):null]})})})]})};var n_=function(e){let{videoId:t}=e;return(0,s.jsx)("div",{style:{position:"relative",paddingBottom:"56.25%",height:0,overflow:"hidden"},children:(0,s.jsx)("iframe",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%"},src:"https://www.youtube.com/embed/".concat((e=>{let t=e.match(/^(?:https?:\/\/)?(?:www\.)?youtu\.?be(?:\.com)?\/(?:watch\?v=|embed\/|v\/|youtu\.be\/|youtube\.com\/(?:c\/|v\/|u\/\w+\/|embed\/|watch\?v=|shorts\/))([\w-]{11})(?:[?&].*|$)/);return t?t[1]:null})(t)),title:"YouTube video player",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",frameBorder:"0",allowFullScreen:!0})})},nM=e=>{let{audio:t,onChange:n}=e,[l,o]=(0,a.useState)(""),{type:h,src:p}=t||{},f=e=>{let s=e.target.files[0];if(s){if("audio/mp3"===s.type||"audio/wav"===s.type||"audio/mpeg"===s.type||"audio/ogg"===s.type){let e=URL.createObjectURL(s);n({...t,src:e,type:"audio"})}else P().fire({icon:"error",title:"Oops...",text:"Chọn một file \xe2m thanh MP3 hoặc WAV."})}},m=e=>{let t=e.match(/^(?:https?:\/\/)?(?:www\.)?youtu\.?be(?:\.com)?\/(?:watch\?v=|embed\/|v\/|youtu\.be\/|youtube\.com\/(?:c\/|v\/|u\/\w+\/|embed\/|watch\?v=|shorts\/))([\w-]{11})(?:[?&].*|$)/);return t?t[1]:null},g=()=>{let e=m(l);e?(v({...t,src:l,type:"youtube"}),o("")):console.log("URL kh\xf4ng hợp lệ hoặc kh\xf4ng phải l\xe0 URL của video YouTube.")},v=e=>{n({...t,...e})};return(0,s.jsxs)(d.Z,{sx:{mb:2},children:[(0,s.jsxs)(d.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,s.jsxs)(u.Z,{variant:"tonal",fullWidth:!0,component:"label",sx:{mr:2},endIcon:(0,s.jsx)(j.Z,{icon:"tabler:headphones-filled"}),children:["Đ\xednh k\xe8m file \xe2m thanh",(0,s.jsx)("input",{type:"file",accept:".mp3, .wav,.mpeg, .ogg",hidden:!0,onChange:f})]}),(0,s.jsx)(u.Z,{variant:"tonal",fullWidth:!0,color:"success",endIcon:(0,s.jsx)(j.Z,{icon:"tabler:brand-youtube-filled"}),onClick:()=>{n({...t,type:"youtube",src:""})},children:"Đ\xednh k\xe8m video youtube"})]}),"youtube"!=h||p?null:(0,s.jsxs)(d.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",marginY:3},children:[(0,s.jsx)(R.Z,{size:"small",fullWidth:!0,variant:"outlined",label:"Link youtube",placeholder:"https://www.youtube.com/watch?v=TAODETHI",sx:{mr:2},color:"success",value:l,onChange:e=>o(e.target.value)}),(0,s.jsx)(u.Z,{variant:"outlined",color:"success",endIcon:(0,s.jsx)(j.Z,{icon:"tabler:square-rounded-plus-filled"}),onClick:g,children:"Th\xeam"})]}),"youtube"==h&&p?(0,s.jsx)(d.Z,{sx:{marginY:3},children:(0,s.jsx)(n_,{videoId:p})}):null,"audio"==h&&p?(0,s.jsx)(d.Z,{sx:{marginY:3},children:(0,s.jsx)("audio",{controls:!0,controlsList:"nodownload",preload:"metadata",src:p,style:{width:"100%"}})}):null,p?(0,s.jsxs)(tc.Z,{subheader:(0,s.jsx)(nc.Z,{children:"C\xe0i đặt Tệp đ\xednh k\xe8m"}),children:[(0,s.jsxs)(tz.Z,{divider:!0,onClick:()=>v({download:!t.download}),children:[(0,s.jsx)(tF.Z,{children:(0,s.jsx)(j.Z,{icon:"tabler:download",fontSize:20})}),(0,s.jsxs)(ei.Z,{children:["Cho ph\xe9p tải file xuống",(0,s.jsx)(c.Z,{title:"Người nghe c\xf3 thể tải tập tin n\xe0y xuống m\xe1y t\xednh, điện thoại",children:(0,s.jsx)(x.Z,{size:"small",children:(0,s.jsx)(j.Z,{icon:"tabler:info-square-rounded",fontSize:20})})})]}),(0,s.jsx)(tb.Z,{children:(0,s.jsx)(nu.Z,{edge:"end",checked:t.download||!1})})]}),(0,s.jsxs)(tz.Z,{divider:!0,onClick:()=>v({next:!t.next}),children:[(0,s.jsx)(tF.Z,{children:(0,s.jsx)(j.Z,{icon:"tabler:player-track-next",fontSize:20})}),(0,s.jsxs)(ei.Z,{children:["Cho ph\xe9p tua file nghe, video",(0,s.jsx)(c.Z,{title:"Người nghe c\xf3 thể tua để nghe trước tập tin \xe2m thanh hoặc video",children:(0,s.jsx)(x.Z,{size:"small",children:(0,s.jsx)(j.Z,{icon:"tabler:info-square-rounded",fontSize:20})})})]}),(0,s.jsx)(tb.Z,{children:(0,s.jsx)(nu.Z,{edge:"end",checked:t.next||!1})})]}),(0,s.jsxs)(tz.Z,{divider:!0,onClick:()=>v({speed:!t.speed}),children:[(0,s.jsx)(tF.Z,{children:(0,s.jsx)(j.Z,{icon:"tabler:brand-speedtest",fontSize:20})}),(0,s.jsxs)(ei.Z,{children:["Cho ph\xe9p tăng, giảm tốc độ nghe",(0,s.jsx)(c.Z,{title:"Người nghe c\xf3 thể tăng tốc độ l\xean 2x hoặc x\xf3a 0.5x khi nghhe",children:(0,s.jsx)(x.Z,{size:"small",children:(0,s.jsx)(j.Z,{icon:"tabler:info-square-rounded",fontSize:20})})})]}),(0,s.jsx)(tb.Z,{children:(0,s.jsx)(nu.Z,{edge:"end",checked:t.speed||!1})})]})]}):null]})};let nR=(0,L.ZP)(x.Z)(e=>{let{theme:t}=e;return{top:0,right:0,color:"grey.500",position:"absolute",boxShadow:t.shadows[2],transform:"translate(10px, -10px)",borderRadius:t.shape.borderRadius,backgroundColor:"".concat(t.palette.background.paper," !important"),transition:"transform 0.25s ease-in-out, box-shadow 0.25s ease-in-out","&:hover":{transform:"translate(7px, -5px)"}}}),nO=[{key:"random",title:"Cố định c\xe2u hỏi trong nh\xf3m",icon:"tabler:arrows-shuffle",subtitle:"Thứ tự c\xe2u hỏi trong nh\xf3m sẽ được cố định. Kh\xf4ng thay đổi d\xf9 c\xf3 bật chế độ trộn c\xe2u hỏi."},{key:"order",title:"Đ\xe1nh lại thứ tự c\xe2u",icon:"tabler:list-numbers",subtitle:"Thứ tự c\xe2u hỏi sẽ đ\xe1nh lại từ c\xe2u 1"}];var nH=()=>{let e=(0,p.v9)(e=>e.popup.data),t=(0,p.I0)(),[n,l]=(0,a.useState)(e),o=()=>{t((0,f.z)({status:""}))},g=e=>()=>{l({...n,...e})},v=()=>{let{title:e,...s}=n;t((0,m.mD)(s)),o()},b=e=>t=>{let s=!n.audios&&Array.isArray(n.audios)?[...n.audios]:[{}];s[e]=t,g({audios:s})()};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(_.Z,{sx:{pb:e=>"".concat(e.spacing(8)," !important"),px:e=>["".concat(e.spacing(5)," !important"),"".concat(e.spacing(15)," !important")],pt:e=>["".concat(e.spacing(8)," !important"),"".concat(e.spacing(12.5)," !important")]},children:[(0,s.jsx)(nR,{onClick:o,children:(0,s.jsx)(j.Z,{icon:"tabler:x",fontSize:"1.25rem"})}),(0,s.jsx)(d.Z,{sx:{mb:5,textAlign:"center"},children:(0,s.jsx)(h.Z,{variant:"h5",sx:{mb:3},children:n.title})}),n.audios&&0!=n.audios.length?null:(0,s.jsx)(nM,{audio:{},onChange:b(0)}),Array.isArray(n.audios)?n.audios.map((e,t)=>(0,s.jsx)(nM,{audio:e,onChange:b(t)},t)):null,(0,s.jsx)(tc.Z,{subheader:(0,s.jsx)(nc.Z,{children:"C\xe0i đặt kh\xe1c"}),children:nO.map(e=>(0,s.jsxs)(tz.Z,{onClick:g({[e.key]:!n[e.key]}),divider:!0,children:[(0,s.jsx)(tF.Z,{children:(0,s.jsx)(j.Z,{icon:e.icon,fontSize:20})}),(0,s.jsxs)(ei.Z,{children:[e.title,(0,s.jsx)(c.Z,{title:e.subtitle,children:(0,s.jsx)(x.Z,{size:"small",children:(0,s.jsx)(j.Z,{icon:"tabler:info-square-rounded",fontSize:20})})})]}),(0,s.jsx)(tb.Z,{children:(0,s.jsx)(nu.Z,{edge:"end",checked:n[e.key]||!1})})]},e.key))})]}),(0,s.jsxs)(M.Z,{sx:{justifyContent:"center",px:e=>["".concat(e.spacing(5)," !important"),"".concat(e.spacing(15)," !important")],pb:e=>["".concat(e.spacing(8)," !important"),"".concat(e.spacing(12.5)," !important")]},children:[(0,s.jsx)(u.Z,{variant:"tonal",color:"secondary",onClick:o,children:"Hủy"}),(0,s.jsx)(u.Z,{variant:"contained",sx:{mr:1},onClick:v,children:"Lưu"})]})]})},nB=n(3401),nD=()=>"hi",nF=n(9033);let nz=e=>{let{data:t,icon:n,name:l,selected:a,gridProps:o,iconProps:c,handleChange:u,color:x="primary"}=e,{title:p,value:f,content:m}=t;return t?(0,s.jsx)(S.ZP,{item:!0,...o,children:(0,s.jsxs)(d.Z,{onClick:()=>u(f),sx:{p:4,height:"100%",display:"flex",borderRadius:1,cursor:"pointer",position:"relative",alignItems:"center",flexDirection:"column",border:e=>"1px solid ".concat(e.palette.divider),...a===f?{borderColor:"".concat(x,".main"),"& svg":{color:e=>"".concat(e.palette.primary.main," !important")}}:{"&:hover":{borderColor:e=>"rgba(".concat(e.palette.customColors.main,", 0.25)")}}},children:[n?(0,s.jsx)(j.Z,{icon:n,...c}):null,p?"string"==typeof p?(0,s.jsx)(h.Z,{variant:"h6",sx:{...m?{mb:2}:{my:"auto"}},children:p}):p:null,m?"string"==typeof m?(0,s.jsx)(h.Z,{variant:"body2",sx:{my:"auto",textAlign:"center"},children:m}):m:null,(0,s.jsx)(nF.Z,{name:l,size:"small",color:x,value:f,onChange:u,checked:a===f,sx:{mb:-2,...!n&&!p&&!m&&{mt:-2}}})]})}):null};var nq=n(3416);let nG=(0,nq.kP)("ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz-",8),nY={fullname:"",classes:"",school:"",username:"",password:""},nW=e=>{let{students:t=[],onChange:n}=e,[l,o]=(0,a.useState)(!1),[c,p]=(0,a.useState)(nY),[f,m]=(0,a.useState)(t),g=(0,a.useRef)(),v=()=>{let{fullname:e,username:t,password:n,id:s}=c;if(!e.trim())return P().fire({icon:"error",title:"Oops...",text:"Vui l\xf2ng nhập th\xf4ng tin Họ v\xe0 t\xean"});if(!t.trim())return P().fire({icon:"error",title:"Oops...",text:"Vui l\xf2ng nhập th\xf4ng tin T\xean đăng nhập"});if(!n.trim())return P().fire({icon:"error",title:"Oops...",text:"Vui l\xf2ng nhập th\xf4ng tin Mật khẩu"});if(f.find(e=>e.id!==s&&e.username.trim()===t.trim()&&e.password.trim()===n.trim()))return P().fire({icon:"error",title:"Oops...",text:"Th\xf4ng tin đăng nhập đ\xe3 tồn tại. Vui l\xf2ng kiểm tra lại!"});if(s){if(0===f.length)return;m(e=>e.map(e=>e.id===s?{...e,...c}:e))}else m(e=>[{...c,id:nG()},...e]);o(!1)},b=e=>()=>{0!==f.length&&m(t=>{let n=t.findIndex(t=>t.id===e.id);return[...f.slice(0,n),...f.slice(n+1)]})},T=()=>{let e=document.createElement("input");e.setAttribute("type","file"),e.setAttribute("accept",".xlsx"),e.click(),e.onchange=async()=>{var t;let[n]=e.files;if(n&&(null==n?void 0:null===(t=n.name)||void 0===t?void 0:t.endsWith(".xlsx"))){let e=new FileReader;e.onload=function(e){let t=e.target.result;g.current?g.current.postMessage({action:"students",payload:t}):P().fire({icon:"error",title:"Xảy ra lỗi",text:"Li\xean hệ quản trị vi\xean để được hỗ trợ."})},e.readAsBinaryString(n)}else P().fire({icon:"error",title:"Xảy ra lỗi",text:"Định dạng chưa được hỗ trợ. Vui l\xf2ng tải l\xean file .xlsx theo mẫu."})}},y=[{field:"num",headerName:"STT",maxWidth:50},{field:"fullname",headerName:"Họ v\xe0 t\xean",flex:.8,minWidth:200},{field:"classes",headerName:"Lớp",minWidth:80},{field:"school",headerName:"Trường",minWidth:130},{field:"username",headerName:"T\xean đăng nhập",minWidth:150},{field:"password",headerName:"Mật khẩu",minWidth:120},{field:"id",headerName:"H\xe0nh động",renderCell:e=>(0,s.jsxs)("div",{children:[(0,s.jsx)(x.Z,{size:"small",onClick:()=>{o(!0),p(e.row)},children:(0,s.jsx)(j.Z,{icon:"tabler:pencil-minus"})}),(0,s.jsx)(x.Z,{size:"small",color:"error",onClick:b(e.row),children:(0,s.jsx)(j.Z,{icon:"tabler:trash"})})]})}],I=()=>{if(g.current){let e=f.length?f:[{fullname:"Nguyễn Văn An",classes:"12A1",school:"Trường THPT Lương Thế Vinh",username:"annv",password:"luongthevinh"}];g.current.postMessage({action:"excel",payload:{results:e.map(e=>{let t={};return y.forEach(n=>{var s,l,a,o;["id","num"].includes(null==n?void 0:null===(s=n.field)||void 0===s?void 0:s.toLocaleLowerCase())||(t[null===(l=null==n?void 0:null===(a=n.headerName)||void 0===a?void 0:a.trim())||void 0===l?void 0:l.toLocaleUpperCase()]=null===(o=e[null==n?void 0:n.field])||void 0===o?void 0:o.trim())}),t})}})}else P().fire({icon:"error",title:"Xảy ra lỗi",text:"Li\xean hệ quản trị vi\xean để được hỗ trợ."})};return(0,a.useEffect)(()=>{n&&n(f)},[f]),(0,a.useEffect)(()=>{g.current&&g.current.terminate();let e=e=>{let t=e=>{m(e.map((e,t)=>({...e,num:t+1,id:nG()}))),P().fire({title:"Th\xe0nh c\xf4ng!",text:"Đ\xe3 th\xeam ".concat(e.length," học sinh!"),icon:"success",timer:3e3,showConfirmButton:!1})};f.length?P().fire({title:"Ch\xfa \xfd",html:'Bạn muốn bổ sung th\xeam <b style="color:green">'.concat(e.length,"</b> học sinh v\xe0o hay muốn thay thế to\xe0n bộ học sinh đ\xe3 c\xf3?"),icon:"warning",confirmButtonText:"Bổ sung",showDenyButton:!0,denyButtonText:"Thay thế"}).then(n=>{if(n.isConfirmed){let n=e.filter(e=>!f.find(t=>t.username==e.username));n.length!==e.length?P().fire({title:"Ch\xfa \xfd",html:"Ph\xe1t hiện ".concat(e.length-n.length," học sinh tr\xf9ng th\xf4ng tin đăng nhập. Bạn c\xf3 muốn tiếp tục kh\xf4ng?"),icon:"warning",confirmButtonText:"Bổ sung",showDenyButton:!0,denyButtonText:"Thay thế"}).then(e=>{e.isConfirmed&&t([...f,...n])}):t([...f,...e])}n.isDenied&&t(e)}):t(e)};return fetch("".concat(C.default.assetPrefix,"/scripts/worker.export.").concat(C.default.version,".js")).then(e=>e.blob()).then(t=>{g.current=new Worker(URL.createObjectURL(t)),g.current.onmessage=async t=>{let{action:n="",payload:s=null}=t.data;switch(n){case"students":let{results:l,status:a}=s;(null==a?void 0:a.empty)||(null==a?void 0:a.double)?P().fire({title:"Ch\xfa \xfd",html:'<div>Hệ thống ph\xe1t hiện c\xf3 <b style="color:red">'.concat(null==a?void 0:a.empty,'</b> dữ liệu bị trống v\xe0 <b style="color:red">').concat(null==a?void 0:a.double,"</b> dữ liệu tr\xf9ng t\xean đăng nhập. Bạn c\xf3 muốn tiếp tục cập nhật danh s\xe1ch kh\xf4ng?</div>"),icon:"warning",showCancelButton:!0,cancelButtonText:"Hủy",confirmButtonText:"Tiếp tục"}).then(t=>{t.isConfirmed&&e(l)}):e(l);break;case"excel":let o=new Blob([s],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),d=window.URL.createObjectURL(o),h=document.createElement("a");h.href=d,h.download="[Mẫu] Nhập danh s\xe1ch học sinh.xlsx",document.body.appendChild(h),h.click(),window.URL.revokeObjectURL(d)}}}),()=>{g.current&&g.current.terminate()}},[f]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(eA.Z,{severity:"info",color:"info",sx:{mt:3},icon:!1,children:"Gi\xe1o vi\xean sẽ tạo t\xean đăng nhập v\xe0 mật khẩu để học sinh điền th\xf4ng tin v\xe0o mới l\xe0m b\xe0i thi. Học sinh kh\xf4ng cần phải c\xf3 t\xe0i khoản tr\xean hệ thống."}),(0,s.jsxs)(d.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",my:3},children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(u.Z,{variant:"contained",sx:{mr:1,".MuiButton-startIcon":{mx:0},px:{xs:1,sm:4}},startIcon:(0,s.jsx)(j.Z,{icon:"tabler:cloud-upload"}),color:"success",onClick:T,children:(0,s.jsx)(h.Z,{variant:"body",sx:{display:{xs:"none",sm:"inline"},ml:2},children:"Nhập từ Excel"})}),(0,s.jsx)(u.Z,{variant:"tonal",sx:{".MuiButton-startIcon":{mx:0},px:{xs:1,sm:4}},startIcon:(0,s.jsx)(j.Z,{icon:"tabler:cloud-download"}),color:"success",onClick:I,children:(0,s.jsx)(h.Z,{variant:"body",sx:{display:{xs:"none",sm:"inline"},ml:2},children:"Tải file mẫu"})})]}),(0,s.jsx)(u.Z,{variant:"contained",startIcon:(0,s.jsx)(j.Z,{icon:"tabler:plus"}),onClick:()=>{o(!0),p(nY)},children:"Th\xeam học sinh"})]}),(0,s.jsx)(et._,{rows:f.map((e,t)=>({...e,num:t+1})),columns:y,autoHeight:!0,initialState:{pagination:{paginationModel:{pageSize:5}}},pageSizeOptions:[5,10,30,50]}),(0,s.jsx)(eE.ZP,{open:l,sx:{zIndex:1301},anchor:"right",children:(0,s.jsxs)(d.Z,{sx:{p:2,minWidth:350},children:[(0,s.jsx)(eA.Z,{severity:"success",children:"Th\xf4ng tin học sinh"}),(0,s.jsx)(X.Z,{fullWidth:!0,sx:{mt:3},label:"Họ v\xe0 t\xean",helperText:"Th\xf4ng tin bắt buộc",required:!0,value:c.fullname||"",onChange:e=>p({...c,fullname:e.trim()})}),(0,s.jsx)(X.Z,{fullWidth:!0,sx:{mt:3},label:"Lớp",value:c.classes||"",onChange:e=>p({...c,classes:e.trim()})}),(0,s.jsx)(X.Z,{fullWidth:!0,sx:{mt:3},label:"Trường",value:c.school||"",onChange:e=>p({...c,school:e.trim()})}),(0,s.jsx)(X.Z,{fullWidth:!0,sx:{mt:3},label:"T\xean đăng nhập",helperText:"Th\xf4ng tin bắt buộc",required:!0,value:c.username||"",onChange:e=>p({...c,username:e.trim()})}),(0,s.jsx)(X.Z,{fullWidth:!0,sx:{mt:3},label:"Mật khẩu",helperText:"Th\xf4ng tin bắt buộc",required:!0,value:c.password||"",onChange:e=>p({...c,password:e.trim()})}),(0,s.jsxs)(d.Z,{sx:{mt:3,textAlign:"center"},children:[(0,s.jsx)(u.Z,{sx:{mr:2},variant:"tonal",color:"error",onClick:()=>o(!1),children:"Hủy"}),(0,s.jsx)(u.Z,{variant:"contained",onClick:v,children:"Lưu"})]})]})})]})},nU=()=>(0,s.jsx)(eA.Z,{sx:{mt:3},icon:!1,children:"Ai cũng c\xf3 thể xem v\xe0 l\xe0m đề thi n\xe0y. Phần thu thập th\xf4ng tin y\xeau cầu tối thiểu phải c\xf3 1 trường th\xf4ng tin."}),n$=async e=>{try{return(await y.default.get(e)).data}catch(e){throw e}},nV=e=>{let{students:t=[],onChange:n}=e,{data:l,error:o,isLoading:h}=(0,V.Z)("/classes/class",n$),[c,u]=(0,a.useState)(t);return((0,a.useEffect)(()=>{n&&n(c)},[c]),o)?(0,s.jsx)(eA.Z,{sx:{mt:3},severity:"error",icon:!1,children:o.response.data.error}):h?(0,s.jsx)(d.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"center",marginY:10},children:(0,s.jsx)(eg.Z,{})}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(eA.Z,{sx:{my:3},severity:"warning",icon:!1,children:"Chỉ những t\xe0i khoản của học sinh trong lớp học mới được quyền l\xe0m đề thi n\xe0y"}),(0,s.jsx)(et._,{rows:l.map((e,t)=>({...e,num:t+1})),columns:[{field:"num",headerName:"STT",maxWidth:80},{field:"title",headerName:"Lớp học",width:250},{field:"total",headerName:"Số học sinh",width:150}],autoHeight:!0,checkboxSelection:!0,initialState:{pagination:{paginationModel:{pageSize:10}}},pageSizeOptions:[10,30,50],onRowSelectionModelChange:e=>{u(e)},rowSelectionModel:c})]})},nQ=[{field:"num",headerName:"STT",maxWidth:80},{field:"number",headerName:"Số b\xe1o danh",width:100},{field:"fullname",headerName:"Họ v\xe0 t\xean",width:300}],nK={lists:[],title:"",id:"",open:!1},nX=e=>{var t,n;let{students:l=[],onChange:o}=e,[p,f]=(0,a.useState)([]),[m,g]=(0,a.useState)(nK),[v,b]=(0,a.useState)([]),[C,T]=(0,a.useState)(""),I=async e=>{let{id:t}=e,{data:n}=await y.default.get("/classes/".concat(t));Array.isArray(n)&&(g({lists:n,title:e.title,id:t,open:!0}),b(l.filter(e=>e.parent==t).map(e=>e.id)))};(0,a.useEffect)(()=>{let e=async()=>{let{data:e}=await y.default.get("/classes/class");Array.isArray(e)&&f(e.map(e=>({...e,select:l.filter(t=>t.parent==e.id).length})))};e()},[]),(0,a.useEffect)(()=>{f(e=>e.map(e=>({...e,select:l.filter(t=>t.parent==e.id).length})))},[l]);let w=()=>{o&&o([...l.filter(e=>e.parent!==m.id),...v.map(e=>({id:e,parent:m.id}))]),E()},E=(0,a.useCallback)(()=>{g(nK)},[]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(eA.Z,{sx:{my:3},severity:"error",icon:!1,children:"Chỉ những t\xe0i khoản của học sinh được chọn mới được quyền l\xe0m đề thi n\xe0y"}),(0,s.jsx)(et._,{rows:p.filter(e=>e.title.toLowerCase().includes(C.toLowerCase())).map((e,t)=>({...e,num:t+1})),columns:[{field:"actions",headerName:"",renderCell:e=>{let{row:t}=e;return(0,s.jsx)(c.Z,{title:"Chọn học sinh",arrow:!0,children:(0,s.jsx)(x.Z,{size:"small",onClick:()=>I(t),children:(0,s.jsx)(j.Z,{icon:"tabler:user-plus"})})})}},{field:"num",headerName:"STT",maxWidth:80},{field:"title",headerName:"Lớp học",width:250},{field:"total",headerName:"Số học sinh",width:150},{field:"select",headerName:"Đ\xe3 chọn",width:100}],autoHeight:!0,initialState:{pagination:{paginationModel:{pageSize:10}}},pageSizeOptions:[10,30,50]}),(0,s.jsx)(eE.ZP,{open:m.open,sx:{zIndex:1301},anchor:"right",children:(0,s.jsxs)(d.Z,{children:[(0,s.jsx)(h.Z,{variant:"h4",sx:{m:2},children:m.title}),(0,s.jsx)(et._,{rows:null===(t=null===(n=m.lists)||void 0===n?void 0:n.filter(e=>{var t;return null===(t=e.fullname)||void 0===t?void 0:t.toLowerCase().includes(C.toLowerCase())}))||void 0===t?void 0:t.map((e,t)=>({...e,num:t+1})),columns:nQ,autoHeight:!0,initialState:{pagination:{paginationModel:{pageSize:10}}},pageSizeOptions:[10,30,50],checkboxSelection:!0,onRowSelectionModelChange:e=>{b(e)},rowSelectionModel:v}),(0,s.jsxs)(d.Z,{sx:{mt:3,textAlign:"center"},children:[(0,s.jsx)(u.Z,{sx:{mr:2},variant:"tonal",color:"error",onClick:E,children:"Hủy"}),(0,s.jsx)(u.Z,{variant:"contained",onClick:w,children:"Lưu"})]})]})})]})};var nJ=n(5715);let n0=e=>{let{accept:t,onChange:n,students:l=[]}=e,a=e=>{n(e)};console.log(l);let{user:o}=(0,nJ.a)(),d=[{value:"all",title:"Tất cả mọi người",isSelected:!0,icon:"tabler:world"},{value:"list",title:"Giao theo danh s\xe1ch",icon:"tabler:list-check"}];return(null==o?void 0:o.role)=="admin"&&(d=[{value:"all",title:"Tất cả mọi người",isSelected:!0,icon:"tabler:world"},{value:"list",title:"Giao theo danh s\xe1ch",icon:"tabler:list-check"},{value:"classes",title:"Giao theo lớp học",icon:"tabler:school"},{value:"student",title:"Giao theo học sinh",icon:"tabler:user"}]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(S.ZP,{container:!0,spacing:4,children:d.map((e,n)=>(0,s.jsx)(nz,{data:e,selected:t||"all",icon:e.icon,handleChange:e=>a({accept:"string"==typeof e?e:e.target.value,students:[]}),gridProps:{sm:Math.floor(12/d.length),xs:12},iconProps:{fontSize:"1.75rem",style:{marginBottom:8}}},n))}),"all"==t?(0,s.jsx)(nU,{onChange:e=>a({students:e}),students:l}):null,"classes"==t?(0,s.jsx)(nV,{onChange:e=>a({students:e}),students:l}):null,"student"==t?(0,s.jsx)(nX,{onChange:e=>a({students:e}),students:l}):null,"list"==t?(0,s.jsx)(nW,{onChange:e=>a({students:e}),students:l}):null]})};var n1=n(3457),n2=n(480);let n5=e=>{let{label:t="",title:n="",value:l=!1,onChange:a}=e;return(0,s.jsx)(n1.Z,{children:(0,s.jsx)(c.Z,{title:n,arrow:!0,children:(0,s.jsx)(n2.Z,{control:(0,s.jsx)(nu.Z,{checked:l,onChange:e=>a(e.target.checked)}),label:t})})})};var n4=()=>{let e=(0,p.v9)(e=>e.quiz.settings),t=(0,p.I0)(),[n,l]=(0,a.useState)(e),[o,c]=(0,a.useState)(!1),{user:g}=(0,nJ.a)(),v=()=>{t((0,f.z)({status:""}))},b=()=>{let{accept:e="all",collects:s=[],students:l=[]}=n;switch(e){case"all":if(!s.length)return P().fire({icon:"error",title:"Oops...",text:"Phần TH\xd4NG TIN CẦN THU THẬP phải c\xf3 tối thiểu 01 trường th\xf4ng tin"});break;case"classes":if(!l.length)return P().fire({icon:"error",title:"Oops...",text:"Vui l\xf2ng chọn tối thiểu 1 lớp học để giao b\xe0i"});break;case"student":if(!l.length)return P().fire({icon:"error",title:"Oops...",text:"Vui l\xf2ng chọn tối thiểu 1 học sinh để giao b\xe0i"});break;case"list":if(!l.length)return P().fire({icon:"error",title:"Oops...",text:"Vui l\xf2ng th\xeam tối thiểu 1 học sinh để giao b\xe0i"})}if(s.filter(e=>!e.label.trim()).length)return P().fire({icon:"error",title:"Oops...",text:"Phần TH\xd4NG TIN THU THẬP chưa nhập đầy đủ c\xe1c trường th\xf4ng tin"});t((0,m.kQ)(n)),v()},C=e=>{l(t=>({...t,...e}))},T=()=>{if(o)return;let e=document.createElement("input");e.setAttribute("type","file"),e.setAttribute("accept","image/*"),e.click(),e.onchange=async()=>{let[t]=e.files;if(t){c(!0);let e=n.cover||"https://i.imgur.com/dKZNJGk.png",s=URL.createObjectURL(t);C({cover:s});let{error:l,url:a}=await I(t);c(!1),l&&(C({cover:e}),P().fire({icon:"error",title:"C\xf3 lỗi khi thay đổi ảnh b\xeca"})),a&&C({cover:a})}}};return(0,s.jsxs)(_.Z,{sx:{paddingX:"0!important"},children:[(0,s.jsx)(th.Z,{sx:{marginY:3},children:(0,s.jsx)(tp.Z,{label:"CHẾ ĐỘ \xd4N LUYỆN",skin:"light",color:"error"})}),"admin"==g.role?(0,s.jsxs)(S.ZP,{container:!0,spacing:3,children:[(0,s.jsx)(S.ZP,{item:!0,xs:12,md:6,children:(0,s.jsx)(n5,{label:"Chế độ Luyện tập",value:(null==n?void 0:n.practice)||!1,onChange:e=>C({practice:e}),title:"Học sinh sẽ l\xe0m c\xe2u n\xe0o th\xec sẽ kiểm tra đ\xe1p \xe1n v\xe0 xem hướng dẫn giải c\xe2u đ\xf3. Kết quả sẽ kh\xf4ng được lưu v\xe0o bảng điểm"})}),(0,s.jsx)(S.ZP,{item:!0,xs:12,md:6,children:(0,s.jsx)(n5,{label:"L\xe0m b\xe0i tr\xean Chatbot",value:(null==n?void 0:n.chatbot)||!1,onChange:e=>C({chatbot:e}),title:"Khi bật chức năng n\xe0y, đề thi sẽ được hiển thị tr\xean Chatbot Telegram m\xe0 bạn đ\xe3 kết nối"})})]}):null,(0,s.jsx)(th.Z,{sx:{marginY:3},children:(0,s.jsx)(tp.Z,{label:"TH\xd4NG TIN CƠ BẢN",skin:"light",color:"primary"})}),(0,s.jsxs)(S.ZP,{container:!0,spacing:3,children:[(0,s.jsxs)(S.ZP,{item:!0,xs:12,md:8,children:[(0,s.jsx)(d.Z,{children:(0,s.jsx)(X.Z,{label:"T\xean đề thi",fullWidth:!0,value:n.title||"",onChange:e=>C({title:e})})}),(0,s.jsxs)(d.Z,{sx:{mt:2},children:[(0,s.jsx)(h.Z,{variant:"h6",sx:{marginY:2},children:"Giới thiệu về đề thi"}),(0,s.jsx)(nl,{content:n.subtitle,sx:{minHeight:"5rem"},theme:"snow",inline:!0,onChange:e=>C({subtitle:e})})]})]}),(0,s.jsx)(S.ZP,{item:!0,xs:12,md:4,children:(0,s.jsxs)(d.Z,{onClick:T,sx:{display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",cursor:"pointer"},children:[o?(0,s.jsxs)(d.Z,{style:{position:"relative"},children:[(0,s.jsx)("img",{src:n.cover||"https://i.imgur.com/dKZNJGk.png",style:{maxWidth:"100%",filter:"blur(5px)"}}),(0,s.jsx)(eg.Z,{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}})]}):(0,s.jsx)("img",{src:n.cover||"https://i.imgur.com/dKZNJGk.png",style:{maxWidth:"100%"}}),(0,s.jsx)("span",{children:"Click để thay đổi ảnh b\xeca "})]})})]}),(0,s.jsx)(th.Z,{sx:{marginY:3},children:(0,s.jsx)(tp.Z,{label:"CHUNG",skin:"light",color:"primary"})}),(0,s.jsxs)(S.ZP,{container:!0,spacing:3,children:[(0,s.jsx)(S.ZP,{item:!0,xs:12,md:6,children:(0,s.jsx)(X.Z,{label:"Thời gian l\xe0m b\xe0i",fullWidth:!0,type:"number",placeholder:"90",InputProps:{endAdornment:(0,s.jsx)(O.Z,{position:"end",children:"ph\xfat"}),inputProps:{min:0,step:1}},value:n.timeout||"90",onChange:e=>C({timeout:e})})}),(0,s.jsx)(S.ZP,{item:!0,xs:12,md:6,children:(0,s.jsx)(X.Z,{label:"Số lần l\xe0m",type:"number",placeholder:"0",fullWidth:!0,helperText:"Số lần mỗi học sinh c\xf3 thể l\xe0m b\xe0i. 0 để kh\xf4ng giới hạn.",InputProps:{inputProps:{min:0,step:1}},value:n.retake||"0",onChange:e=>C({retake:e})})}),(0,s.jsx)(S.ZP,{item:!0,xs:12,md:6,children:(0,s.jsx)(X.Z,{label:"Thời gian bắt đầu",fullWidth:!0,InputLabelProps:{shrink:!0},type:"datetime-local",helperText:"Học sinh chỉ c\xf3 thể l\xe0m b\xe0i kể từ thời điểm bắt đầu",value:n.startTime||"",onChange:e=>C({startTime:e})})}),(0,s.jsx)(S.ZP,{item:!0,xs:12,md:6,children:(0,s.jsx)(X.Z,{label:"Thời gian hết hạn",fullWidth:!0,InputLabelProps:{shrink:!0},type:"datetime-local",helperText:"Qu\xe1 thời gian n\xe0y học sinh sẽ kh\xf4ng thể bắt đ\xe2u l\xe0m b\xe0i",value:n.endTime||"",onChange:e=>C({endTime:e})})})]}),(0,s.jsx)(th.Z,{sx:{marginY:3},children:(0,s.jsx)(tp.Z,{label:"BẢO MẬT",skin:"light",color:"warning"})}),(0,s.jsxs)(S.ZP,{container:!0,spacing:3,children:[(0,s.jsx)(S.ZP,{item:!0,xs:12,md:6,children:(0,s.jsx)(X.Z,{label:"Mật khẩu đề thi",fullWidth:!0,helperText:"Y\xeau cầu học sinh nhập đ\xfang mật khẩu mới c\xf3 thể bắt đầu l\xe0m b\xe0i",value:n.password||"",onChange:e=>C({password:e})})}),(0,s.jsx)(S.ZP,{item:!0,xs:12,md:6,children:(0,s.jsxs)(X.Z,{select:!0,label:"Tự động nộp b\xe0i khi chuyển tabs",fullWidth:!0,helperText:"Hệ thống sẽ tự động nộp b\xe0i l\xe0m khi học sinh chuyển tab kh\xe1c",value:n.tabs||"0",onChange:e=>C({tabs:e}),children:[(0,s.jsx)(el.Z,{value:"0",children:"Kh\xf4ng"}),(0,s.jsx)(el.Z,{value:"3",children:"Sau 3 gi\xe2y"}),(0,s.jsx)(el.Z,{value:"5",children:"Sau 5 gi\xe2y"}),(0,s.jsx)(el.Z,{value:"7",children:"Sau 7 gi\xe2y"}),(0,s.jsx)(el.Z,{value:"10",children:"Sau 10 gi\xe2y"}),(0,s.jsx)(el.Z,{value:"15",children:"Sau 15 gi\xe2y"}),(0,s.jsx)(el.Z,{value:"30",children:"Sau 30 gi\xe2y"}),(0,s.jsx)(el.Z,{value:"60",children:"Sau 60 gi\xe2y"})]})}),(0,s.jsx)(S.ZP,{item:!0,xs:12,md:6,children:(0,s.jsxs)(X.Z,{select:!0,label:"Chức năng m\xe3 chia sẻ",fullWidth:!0,helperText:"Gi\xe1o vi\xean kh\xe1c c\xf3 thể dễ d\xe0ng nhập nội dung đề thi n\xe0y cho đề thi của họ.",value:n.share||"F",onChange:e=>C({share:e}),children:[(0,s.jsx)(el.Z,{value:"F",children:"Kh\xf4ng"}),(0,s.jsx)(el.Z,{value:"T",children:"C\xf3"})]})})]}),(0,s.jsx)(th.Z,{sx:{marginY:3},children:(0,s.jsx)(tp.Z,{label:"C\xc2U HỎI V\xc0 TRẢ LỜI",skin:"light",color:"info"})}),(0,s.jsxs)(S.ZP,{container:!0,spacing:3,children:[(0,s.jsx)(S.ZP,{item:!0,xs:12,md:6,children:(0,s.jsxs)(X.Z,{select:!0,label:"Chế độ hiển thị c\xe2u hỏi",fullWidth:!0,value:n.showQuestions||"A",onChange:e=>C({showQuestions:e}),children:[(0,s.jsx)(el.Z,{value:"A",children:"Hiện to\xe0n bộ c\xe2u hỏi"}),(0,s.jsx)(el.Z,{value:"Q",children:"Hiện theo từng c\xe2u hỏi"})]})}),(0,s.jsx)(S.ZP,{item:!0,xs:12,md:6,children:(0,s.jsxs)(X.Z,{select:!0,label:"Bắt buộc l\xe0m tất cả c\xe1c c\xe2u hỏi",fullWidth:!0,value:n.require||"T",onChange:e=>C({require:e}),children:[(0,s.jsx)(el.Z,{value:"T",children:"Phải l\xe0m hết mới cho nộp b\xe0i"}),(0,s.jsx)(el.Z,{value:"F",children:"Kh\xf4ng cần phải l\xe0m hết"})]})}),(0,s.jsx)(S.ZP,{item:!0,xs:12,md:6,children:(0,s.jsxs)(X.Z,{select:!0,label:"Chế độ đảo c\xe2u hỏi",fullWidth:!0,helperText:"C\xe1c nh\xf3m c\xe2u hỏi đ\xe3 cố định th\xec hệ thống sẽ kh\xf4ng đảo c\xe2u hỏi nh\xf3m đ\xf3",value:n.randomQuestion||"N",onChange:e=>C({randomQuestion:e}),children:[(0,s.jsx)(el.Z,{value:"N",children:"Kh\xf4ng đảo c\xe2u hỏi"}),(0,s.jsx)(el.Z,{value:"E",children:"Đảo to\xe0n bộ đề thi"})]})}),(0,s.jsx)(S.ZP,{item:!0,xs:12,md:6,children:(0,s.jsxs)(X.Z,{select:!0,label:"Chế độ đảo đ\xe1p \xe1n",fullWidth:!0,helperText:"C\xe1c c\xe2u hỏi đ\xe3 cố định đ\xe1p \xe1n th\xec hệ thống sẽ kh\xf4ng đảo đ\xe1p \xe1n c\xe2u hỏi đ\xf3",value:n.randomAnswer||"F",onChange:e=>C({randomAnswer:e}),children:[(0,s.jsx)(el.Z,{value:"F",children:"Kh\xf4ng đảo đ\xe1p \xe1n"}),(0,s.jsx)(el.Z,{value:"T",children:"C\xf3 đảo đ\xe1p \xe1n"})]})}),(0,s.jsx)(S.ZP,{item:!0,xs:12,md:6,children:(0,s.jsxs)(X.Z,{select:!0,label:"Chế độ hiển thị b\xe0i l\xe0m",fullWidth:!0,value:n.showResult||"F",onChange:e=>C({showResult:e}),children:[(0,s.jsx)(el.Z,{value:"N",children:"Kh\xf4ng hiển thị"}),(0,s.jsx)(el.Z,{value:"F",children:"Ngay sau khi nộp b\xe0i"})]})}),(0,s.jsx)(S.ZP,{item:!0,xs:12,md:6,children:(0,s.jsxs)(X.Z,{select:!0,label:"Chế độ hiển thị điểm",fullWidth:!0,value:n.showPoint||"F",onChange:e=>C({showPoint:e}),children:[(0,s.jsx)(el.Z,{value:"N",children:"Kh\xf4ng hiển thị"}),(0,s.jsx)(el.Z,{value:"F",children:"Ngay sau khi nộp b\xe0i"})]})}),(0,s.jsx)(S.ZP,{item:!0,xs:12,md:6,children:(0,s.jsxs)(X.Z,{select:!0,label:"Chế độ hiển thị đ\xe1p \xe1n đ\xfang",fullWidth:!0,value:n.showKey||"A",onChange:e=>C({showKey:e}),children:[(0,s.jsx)(el.Z,{value:"A",children:"Lu\xf4n hiển thị"}),(0,s.jsx)(el.Z,{value:"T",children:"Chỉ c\xe2u đ\xfang"}),(0,s.jsx)(el.Z,{value:"F",children:"Chỉ c\xe2u sai"}),(0,s.jsx)(el.Z,{value:"H",children:"Lu\xf4n ẩn"})]})}),(0,s.jsx)(S.ZP,{item:!0,xs:12,md:6,children:(0,s.jsxs)(X.Z,{select:!0,label:"Chế độ hiển thị hướng dẫn giải",fullWidth:!0,value:n.showExplain||"A",onChange:e=>C({showExplain:e}),children:[(0,s.jsx)(el.Z,{value:"A",children:"Lu\xf4n hiển thị"}),(0,s.jsx)(el.Z,{value:"T",children:"Chỉ c\xe2u đ\xfang"}),(0,s.jsx)(el.Z,{value:"F",children:"Chỉ c\xe2u sai"}),(0,s.jsx)(el.Z,{value:"H",children:"Lu\xf4n ẩn"})]})})]}),(0,s.jsx)(th.Z,{sx:{marginY:3},children:(0,s.jsx)(tp.Z,{label:"AI C\xd3 THỂ L\xc0M?",skin:"light",color:"success"})}),(0,s.jsx)(n0,{accept:n.accept,onChange:C,students:n.students}),(0,s.jsx)(th.Z,{sx:{marginY:3},children:(0,s.jsx)(tp.Z,{label:"TH\xd4NG TIN CẦN THU THẬP",skin:"light",color:"success"})}),(0,s.jsxs)(d.Z,{children:[(0,s.jsx)(tc.Z,{children:(n.collects||[]).map((e,t)=>(0,s.jsxs)(tu.ZP,{disablePadding:!0,sx:{paddingY:1},children:[(0,s.jsx)(X.Z,{fullWidth:!0,size:"small",sx:{mr:2},InputProps:{startAdornment:(0,s.jsxs)(O.Z,{position:"start",children:["Th\xf4ng tin ",t+1]})},value:e.label,placeholder:"Nhập th\xf4ng tin cần thu thập",onChange:e=>C({collects:n.collects.map((n,s)=>s==t?{...n,label:e}:n)})}),(0,s.jsx)(tb.Z,{children:(0,s.jsx)(x.Z,{color:"error",onClick:()=>C({collects:n.collects.filter((e,n)=>n!=t)}),children:(0,s.jsx)(j.Z,{icon:"tabler:trash"})})})]},t))}),(0,s.jsx)(u.Z,{variant:"contained",startIcon:(0,s.jsx)(j.Z,{icon:"tabler:plus"}),onClick:()=>C({collects:n.collects?[...n.collects,{label:""}]:[{label:""}]}),children:"Th\xeam th\xf4ng tin"})]}),(0,s.jsxs)(d.Z,{sx:{mt:5,textAlign:"center"},children:[(0,s.jsx)(u.Z,{sx:{mr:2},variant:"tonal",color:"error",onClick:v,children:"Hủy"}),(0,s.jsx)(u.Z,{variant:"contained",onClick:b,children:"Lưu"})]})]})};let n3=(0,L.ZP)(x.Z)(e=>{let{theme:t}=e;return{top:0,right:0,color:"grey.500",position:"absolute",boxShadow:t.shadows[2],transform:"translate(10px, -10px)",borderRadius:t.shape.borderRadius,backgroundColor:"".concat(t.palette.background.paper," !important"),transition:"transform 0.25s ease-in-out, box-shadow 0.25s ease-in-out","&:hover":{transform:"translate(7px, -5px)"}}});var n9=()=>{let e=(0,p.I0)(),t=()=>{e((0,f.z)({status:""}))};return(0,s.jsxs)(_.Z,{sx:{pb:e=>"".concat(e.spacing(8)," !important"),px:e=>["".concat(e.spacing(5)," !important"),"".concat(e.spacing(15)," !important")],pt:e=>["".concat(e.spacing(8)," !important"),"".concat(e.spacing(12.5)," !important")]},children:[(0,s.jsx)(n3,{onClick:t,children:(0,s.jsx)(j.Z,{icon:"tabler:x",fontSize:"1.25rem"})}),(0,s.jsx)(n4,{})]})};let n6=(0,a.forwardRef)(function(e,t){return(0,s.jsx)(k.Z,{ref:t,...e})}),n8=eM()(()=>Promise.all([n.e(117),n.e(141)]).then(n.bind(n,5141)),{loadableGenerated:{webpack:()=>[5141]},ssr:!1}),n7=e=>{let{type:t}=e;switch(t){case"quiz":return(0,s.jsx)(nD,{});case"group":return(0,s.jsx)(nH,{});case"options":return(0,s.jsx)(nB.default,{});case"math":return(0,s.jsx)(n8,{});case"settings":return(0,s.jsx)(n9,{})}return null},se=()=>{let{status:e,data:t}=(0,p.v9)(e=>e.popup);return(0,s.jsx)(N.Z,{fullWidth:!0,open:!!e,maxWidth:"md",scroll:"body",TransitionComponent:n6,sx:{"& .MuiDialog-paper":{overflow:"visible"}},children:(0,s.jsx)(n7,{type:e})})},st=()=>(0,s.jsxs)(S.ZP,{container:!0,spacing:3,children:[(0,s.jsx)(S.ZP,{item:!0,xs:12,md:4,children:(0,s.jsx)(nk,{})}),(0,s.jsx)(S.ZP,{item:!0,xs:12,md:8,children:(0,s.jsx)(nZ,{})}),(0,s.jsx)(se,{})]});st.layout="hi";var sn=n(4521),ss=n.n(sn);let si=(e,t)=>{var n=document.createElement("script");n.type="text/javascript",n.src=e,n.onload=t,n.onerror=e=>{console.log(e)},document.head.appendChild(n)},sr=(e,t)=>{var n=0;!function s(){if(n<e.length){var l=e[n];si(C.default.assetPrefix+l,function(){n++,s()})}else"function"==typeof t&&t()}()},sl=(e,t)=>{let n=document.createElement("input");n.setAttribute("type","file"),n.setAttribute("accept",".pdf,.docx"),n.click(),n.onchange=async()=>{let[s]=n.files;s&&s.name.endsWith(".pdf")&&(console.log(s),sr(["/scripts/pdf.js","/scripts/pdf.worker.js"],function(){let n=new(ss())(e,t);n.parsePdf(s)}))}},sa=e=>{let{questionId:t}=e,n=(0,p.v9)(e=>e.quiz.questions.find(e=>e.id==t)),l=(0,p.I0)(),[o,h]=(0,a.useState)(n);(0,a.useEffect)(()=>{JSON.stringify(o)!==JSON.stringify(n)&&h(n)},[n]),(0,a.useEffect)(()=>{JSON.stringify(o)!==JSON.stringify(n)&&l((0,m.Ds)(o))},[o]);let c=e=>{h(t=>({...t,...e}))};return(0,s.jsxs)(ek.Z,{sx:{mb:2},children:[(0,s.jsx)(K.Z,{title:(0,s.jsx)(tD.Z,{label:"C\xe2u ".concat(o.number),color:"primary"}),sx:{paddingY:2,overflowX:"auto",px:{xs:2,md:4}}}),(0,s.jsx)(th.Z,{}),(0,s.jsxs)(Q.Z,{sx:{px:{xs:2,md:4}},children:[(0,s.jsx)(d.Z,{sx:{paddingY:1},children:(0,s.jsx)(nl,{content:o.content,onChange:e=>c({content:e})})}),(0,s.jsx)(nh,{question:o,onChange:c}),(0,s.jsxs)(eA.Z,{severity:"info",icon:!1,sx:{".MuiAlert-message":{width:"100%",overflow:"unset"}},children:[(0,s.jsx)(th.Z,{children:"HƯỚNG DẪN GIẢI"}),(0,s.jsx)(d.Z,{children:(0,s.jsx)(nl,{content:o.explain||"",onChange:e=>c({explain:e})})})]})]})]})},so=e=>{let{groupId:t,isOne:n}=e,{questions:l,random:o,content:h,...c}=(0,p.v9)(e=>e.quiz.groups.find(e=>e.id==t)),u=(0,a.useMemo)(()=>l.map(e=>(0,s.jsx)(sa,{questionId:e},e)),[l]);return(0,s.jsxs)(d.Z,{children:[(0,s.jsx)(ek.Z,{className:"header-group",sx:{border:0,boxShadow:0,mb:2.5},children:(0,s.jsx)(K.Z,{sx:{paddingY:3,alignItems:"center"},avatar:(0,s.jsx)(j.Z,{icon:"tabler:clipboard-list"}),action:(0,s.jsx)(d.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:(0,s.jsx)(tD.Z,{label:"".concat(l.length," c\xe2u")})})})}),u]})},sd=e=>{let{quizId:t}=e,n=(0,p.v9)(e=>e.quiz.quizs.find(e=>e.id==t)),l=(0,p.v9)(e=>e.quiz.questions.filter(e=>e.quizId==t)).length,o=(0,p.I0)(),h=()=>{sl(t,e=>{let{data:t}=e;console.log("handleImportFile",t),o((0,m.l$)(t))})},u=(0,a.useMemo)(()=>n.groups.map(e=>(0,s.jsx)(so,{groupId:e,isOne:1==n.groups.length},e)),[n.groups]);return(0,s.jsxs)("div",{style:{marginBottom:10},children:[(0,s.jsx)(K.Z,{title:"CHI TIẾT ĐỀ THI",className:"header-exam",sx:{paddingY:3,borderRadius:"0.5rem","span, svg":{color:"#fff"}},action:(0,s.jsxs)(d.Z,{sx:{display:"flex",alignItems:"center"},children:[(0,s.jsx)(c.Z,{title:"Nhập c\xe2u hỏi từ tập tin .pdf",children:(0,s.jsx)(x.Z,{color:"success",sx:{mr:1},onClick:h,children:(0,s.jsx)(j.Z,{icon:"tabler:upload",fontSize:20})})}),(0,s.jsx)(c.Z,{title:"Bảng đ\xe1p \xe1n",children:(0,s.jsx)(x.Z,{color:"error",sx:{mr:1},children:(0,s.jsx)(j.Z,{icon:"tabler:clipboard-list",fontSize:20})})}),(0,s.jsx)(tD.Z,{label:"".concat(null!=l?l:0," c\xe2u")})]})}),(0,s.jsx)(Q.Z,{sx:{paddingX:0,mt:3},children:u})]})},sh=e=>b().gzipSync(JSON.stringify(e)).toString("base64"),sc=e=>{if(e){var t=document.getElementById(e);if(t){var n=t.getBoundingClientRect().top+window.pageYOffset;window.scrollTo({top:n-100,behavior:"smooth"})}}},su=()=>{let e=(0,p.v9)(e=>e.quiz),t=(0,p.I0)(),n=(0,l.useRouter)(),o=(0,a.useRef)(),[h,c]=(0,a.useState)(!1),[x,f]=(0,a.useState)(!1),[v,b]=(0,a.useState)({}),w=()=>{o.current.postMessage({action:"checkErrorCreate",payload:e})},E=async()=>{var s,l,a,o,d,h;t((0,g.V)({status:"Đang xử l\xfd...."}));let u=e.groups.filter(t=>e.quizs.flatMap(e=>e.groups).includes(t.id)),x=e.questions.filter(e=>u.flatMap(e=>e.questions).includes(e.id)).map(e=>"TL"==e.type?{...e,options:[]}:e),p=e=>{for(var t=e.split(","),n=t[0].match(/:(.*?);/),s=atob(t[1]),l=s.length,a=new Uint8Array(l);l--;)a[l]=s.charCodeAt(l);let o=n&&n.length>0?n[1]:"png";return new File([a],"hinhanh.".concat(o.split("/")[1]),{type:o})},v=e=>{let t=document.createElement("div");t.innerHTML=e||"";let n=t.getElementsByClassName("ql-formula");for(let e=n.length-1;e>=0;e--){let t=n[e];t.innerHTML=""}let s=t.getElementsByTagName("img");for(let e=0;e<s.length;e++){let t=s[e];t.src.startsWith("data:image/")&&(t.src="")}return t.innerHTML},C=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"content",n=[];for(let t=0;t<e.length;t+=3){let s=e.slice(t,t+3);n.push(s)}let s=[];for(let e=0;e<n.length;e++){let l=n[e],a=l.map(async e=>{let n;let s=[],l=e[t]||"",a=/<img.*?src="(data:image\/[^;]+;base64,.*?)".*?>/g;for(;n=a.exec(l);){let e=n[1],t=await I(p(e));s.push((null==t?void 0:t.url)||e)}let o=l.replace(a,(e,t)=>{let n=s.shift();return'<img src="'.concat(n,'" >')});return{...e,[t]:o}}),o=await Promise.all(a);s.push(...o)}return s},j=await C(x),w=await C(j,"explain"),E=await C(u);t((0,m.Be)({groups:E})),t((0,m.QV)({questions:w}));let Z=w.map(e=>({...e,content:v(e.content||""),explain:v(e.explain||""),options:(e.options||[]).map(e=>({...e,text:v(e.text)}))})),S={...e.settings,parent:(null==n?void 0:null===(s=n.query)||void 0===s?void 0:s.parent)||"",id:(null==e?void 0:null===(l=e.settings)||void 0===l?void 0:l.id)||(null==n?void 0:null===(a=n.query)||void 0===a?void 0:a.id)||"",cover:null!==(h=null===(o=e.settings)||void 0===o?void 0:o.cover)&&void 0!==h?h:"https://i.imgur.com/dKZNJGk.png"},N={questions:[...null==e?void 0:null===(d=e.quizs)||void 0===d?void 0:d.map(e=>({quizs:sh(e),id:e.id,v:T.Version})),...null==E?void 0:E.map(e=>({groups:sh(e),id:e.id,quizId:e.quizId,v:T.Version})),...null==Z?void 0:Z.map(e=>({questions:sh(e),id:e.id,quizId:e.quizId,groupId:e.groupId,level:e.level,shuffle:e.shuffle,v:T.Version}))],settings:[{settings:sh({...S,collects:void 0,students:void 0}),v:T.Version},...((null==S?void 0:S.collects)||[]).map(e=>({collects:sh(e),v:T.Version})),...((null==S?void 0:S.students)||[]).map(e=>({students:sh(e),v:T.Version,username:(null==e?void 0:e.username)||e}))],results:{...S,students:void 0,quizType:(null==Z?void 0:Z.filter(e=>"TL"==e.type).length)?"Hỗn hợp":"Trắc nghiệm",numberQuestions:Math.max(...null==E?void 0:E.map(e=>e.questions.length))}};t((0,g.V)({status:"Đang lưu"}));try{let e=(await y.default.post("/chatbot",N)).data;if(e.error)return t((0,g.V)({status:""})),c(!1),P().fire({icon:"error",title:"Oops...",text:e.error,footer:'<a href="#">Why do I have this issue?</a>'});t((0,m.kQ)({id:e.id})),t((0,m.kQ)({url:e.url})),t((0,g.V)({status:""})),f(!0),b(e),c(!1),A({parent:e.parent,id:e.id})}catch(e){return t((0,g.V)({status:""})),P().fire({icon:"error",title:"Oops...",text:"Vui l\xf2ng thử lại sau",footer:'<a href="#">Why do I have this issue?</a>'})}},A=e=>{let t=n.asPath.split("?")[0],s=new URLSearchParams(e).toString(),l="".concat(t,"?").concat(s);n.replace(l,void 0,{shallow:!0})},Z=async()=>{try{var e;let{id:s="",parent:l=""}=n.query;if(!s){t((0,m._e)({quizs:[],groups:[],questions:[],settings:{collects:[{label:"Họ v\xe0 t\xean"},{label:"Lớp"}],students:[],title:""}})),t((0,m.BT)()),t((0,g.V)({status:""}));return}let a=(await (0,y.default)("/chatbot/".concat(s,"/details?parent=").concat(l))).data;if(null==a?void 0:a.error){P().fire({icon:"error",title:"Oops...",text:a.error,footer:'<a href="#">Why do I have this issue?</a>'}),t((0,g.V)({status:""})),n.push("/p/chatbot.html");return}return null==o?void 0:null===(e=o.current)||void 0===e?void 0:e.postMessage({action:"fetchCreate",payload:a})}catch(e){return console.log("fetchData",e),P().fire({icon:"error",title:"Oops...",text:"Vui l\xf2ng li\xean hệ Admin để được hỗ trợ",footer:'<a href="#">Why do I have this issue?</a>'})}};return(0,a.useEffect)(()=>{h&&E()},[h]),(0,a.useEffect)(()=>()=>{t((0,g.V)({status:""}))},[]),(0,a.useEffect)(()=>(t((0,g.V)({status:"Vui l\xf2ng đợi..."})),n.isReady&&(o.current&&o.current.terminate(),fetch("".concat(C.default.assetPrefix,"/scripts/worker.").concat(C.default.version,".js")).then(e=>e.blob()).then(e=>{o.current=new Worker(URL.createObjectURL(e)),o.current.onmessage=async e=>{let{action:n="",payload:s=null}=e.data;switch(n){case"fetchCreate":t((0,m._e)(s)),setTimeout(()=>{t((0,g.V)({status:""}))},500);break;case"checkErrorCreate":let{errors:l,warnings:a}=s;if(l.length)return sc(l[0].id),P().fire({icon:"error",title:"Oops...",text:l[0].text,footer:'<a href="#">Why do I have this issue?</a>'});a.length?P().fire({title:"Ch\xfa \xfd",html:'<p>Hệ thống ph\xe1t hiện một số vấn đề sau, bạn h\xe3y kiểm tra lại n\xf3 trước khi lưu đề thi.</p><ul style=" text-align: left; ">'.concat(a.map(e=>"<li>".concat(e,"</li>")).join(""),"</ul>"),icon:"warning",showCancelButton:!0,confirmButtonText:"Vẫn lưu",cancelButtonText:"Huỷ"}).then(e=>{e.isConfirmed&&c(!0)}):c(!0)}},Z()})),()=>{o.current&&o.current.terminate(),t((0,g.V)({status:""}))}),[n]),(0,s.jsxs)(d.Z,{sx:{position:"fixed",bottom:15,right:"3.85rem",zIndex:1031},children:[(0,s.jsx)(u.Z,{variant:"contained",startIcon:(0,s.jsx)(j.Z,{icon:"tabler:device-floppy"}),onClick:w,color:"error",sx:{boxShadow:"0 1px 20px 1px #EA5455!important",":hover":{boxShadow:"none!important"}},children:"LƯU ĐỀ THI"}),(0,s.jsx)(Y,{show:x,setShow:f,data:v})]})},sx=()=>{var e,t;let n=(0,p.v9)(e=>e.quiz.settings),[o,c]=(0,a.useState)(!1),u=(0,p.I0)(),g=(0,l.useRouter)(),v=z(),b=()=>{if(o)return;let e=document.createElement("input");e.setAttribute("type","file"),e.setAttribute("accept","image/*"),e.click(),e.onchange=async()=>{let[t]=e.files;if(t){c(!0);let e=n.cover||"https://i.imgur.com/dKZNJGk.png",s=URL.createObjectURL(t);C({cover:s});let{error:l,url:a}=await I(t);c(!1),l&&(C({cover:e}),P().fire({icon:"error",title:"C\xf3 lỗi khi thay đổi ảnh b\xeca"})),a&&C({cover:a})}}},C=e=>{u((0,m.kQ)(e))},T=e=>()=>{e&&g.push({pathname:e,query:g.query})},y=()=>{u((0,f.z)({status:"settings",data:{}}))},w=e=>{v.copy(e),Z.ZP.success("Đ\xe3 sao ch\xe9p",{duration:2e3})};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(ek.Z,{sx:{background:"#b1b1b11f",mb:3},children:(0,s.jsx)(Q.Z,{sx:{padding:".5rem!important"},children:(0,s.jsxs)(tc.Z,{component:"div",sx:{p:0},children:[(0,s.jsx)(tu.ZP,{disablePadding:!0,children:(0,s.jsxs)(tz.Z,{sx:{display:"flex",flexDirection:"column"},onClick:b,children:[o?(0,s.jsxs)(d.Z,{style:{position:"relative"},children:[(0,s.jsx)("img",{src:null!==(e=null==n?void 0:n.cover)&&void 0!==e?e:"https://i.imgur.com/dKZNJGk.png",style:{maxWidth:"100%",filter:"blur(5px)"}}),(0,s.jsx)(eg.Z,{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}})]}):(0,s.jsx)("img",{src:null!==(t=null==n?void 0:n.cover)&&void 0!==t?t:"https://i.imgur.com/dKZNJGk.png",style:{maxWidth:"100%"}}),(0,s.jsx)(ei.Z,{primary:"Click để thay đổi ảnh b\xeca"})]})}),(0,s.jsx)(tu.ZP,{disablePadding:!0,children:(0,s.jsx)(X.Z,{fullWidth:!0,label:"T\xean đề thi",value:n.title,onChange:e=>C({title:e})})}),(0,s.jsx)(tu.ZP,{disablePadding:!0,children:(0,s.jsxs)(d.Z,{sx:{width:"100%"},children:[(0,s.jsx)(h.Z,{variant:"h6",sx:{marginY:2},children:"Giới thiệu về đề thi"}),(0,s.jsx)(nl,{content:n.subtitle,sx:{minHeight:"5rem"},theme:"snow",inline:!0,onChange:e=>C({subtitle:e})})]})})]})})}),(null==n?void 0:n.url)?(0,s.jsx)(ek.Z,{sx:{mb:3},children:(0,s.jsx)(Q.Z,{sx:{p:"0.75rem!important"},children:(0,s.jsxs)(nS.Z,{fullWidth:!0,variant:"outlined",children:[(0,s.jsx)(nN.Z,{children:"Link đề thi"}),(0,s.jsx)(nL.Z,{value:(null==n?void 0:n.url)||"",disabled:!0,endAdornment:(0,s.jsx)(O.Z,{position:"end",children:(0,s.jsx)(x.Z,{edge:"end",onClick:()=>w(null==n?void 0:n.url),sx:{color:"success.main"},children:(0,s.jsx)(j.Z,{icon:"tabler:copy",fontSize:20})})}),label:"Link đề thi"})]})})}):null,(null==n?void 0:n.share)=="T"&&(null==n?void 0:n.id)?(0,s.jsx)(ek.Z,{sx:{mb:3},children:(0,s.jsx)(Q.Z,{sx:{p:"0.75rem!important"},children:(0,s.jsxs)(nS.Z,{fullWidth:!0,variant:"outlined",children:[(0,s.jsx)(nN.Z,{children:"M\xe3 chia sẻ"}),(0,s.jsx)(nL.Z,{value:E(null==n?void 0:n.id),disabled:!0,endAdornment:(0,s.jsx)(O.Z,{position:"end",children:(0,s.jsx)(x.Z,{edge:"end",onClick:()=>w(E(null==n?void 0:n.id)),sx:{color:"success.main"},children:(0,s.jsx)(j.Z,{icon:"tabler:copy",fontSize:20})})}),label:"M\xe3 chia sẻ"})]})})}):null,(0,s.jsx)(ek.Z,{className:"menu-settings",children:(0,s.jsx)(Q.Z,{sx:{padding:".5rem!important"},children:(0,s.jsxs)(tc.Z,{component:"div",sx:{p:0,color:"#fff"},children:[(0,s.jsx)(tu.ZP,{disablePadding:!0,onClick:y,children:(0,s.jsxs)(tz.Z,{children:[(0,s.jsx)(es.Z,{sx:{color:"#fff"},children:(0,s.jsx)(j.Z,{icon:"tabler:settings",fontSize:20})}),(0,s.jsx)(ei.Z,{primary:"C\xe0i đặt b\xe0i l\xe0m online",disableTypography:!0})]})}),(null==n?void 0:n.url)?(0,s.jsx)(tu.ZP,{disablePadding:!0,onClick:T("/p/leaderboard.html"),children:(0,s.jsxs)(tz.Z,{children:[(0,s.jsx)(es.Z,{sx:{color:"#fff"},children:(0,s.jsx)(j.Z,{icon:"tabler:checkup-list",fontSize:20})}),(0,s.jsx)(ei.Z,{primary:"Bảng điểm",disableTypography:!0})]})}):null,(null==n?void 0:n.url)?(0,s.jsx)(tu.ZP,{disablePadding:!0,onClick:T("/p/realtime.html"),children:(0,s.jsxs)(tz.Z,{children:[(0,s.jsx)(es.Z,{sx:{color:"#fff"},children:(0,s.jsx)(j.Z,{icon:"tabler:camera-bolt",fontSize:20})}),(0,s.jsx)(ei.Z,{primary:"Gi\xe1m s\xe1t thời gian thực",disableTypography:!0})]})}):null]})})})]})},sp=()=>{let e=(0,p.v9)(e=>e.quiz.quizs);return(0,s.jsxs)(S.ZP,{container:!0,spacing:3,children:[(0,s.jsx)(S.ZP,{item:!0,xs:12,md:4,children:(0,s.jsx)(sx,{})}),(0,s.jsxs)(S.ZP,{item:!0,xs:12,md:8,children:[e.map(e=>(0,s.jsx)(sd,{quizId:e.id},e.id)),(0,s.jsx)(su,{}),(0,s.jsx)(se,{})]})]})},sf=()=>{let e=(0,l.useRouter)(),[t,n]=(0,a.useState)("");switch((0,a.useEffect)(()=>{n(e.query.slug)},[e.query]),t){case"classes.html":return(0,s.jsx)(eC,{});case"exams.html":return(0,s.jsx)(eL,{});case"leaderboard.html":return(0,s.jsx)(tP,{});case"realtime.html":return(0,s.jsx)(tJ,{});case"view-classes.html":return(0,s.jsx)(t3,{});case"create.html":return(0,s.jsx)(st,{});case"chatbot.html":return(0,s.jsx)(sp,{})}return(0,s.jsx)(s.Fragment,{})};sf.getLayout=e=>(0,s.jsx)(o.Z,{customAppBar:(0,s.jsx)($,{}),children:e});var sm=sf},1117:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});let s=n(8754),l=s._(n(7274));class a{static load(e){Object.assign(this,e)}}a.RENDER_SCALE=2,a.LINE_SMALL_HEIGHT=7*a.RENDER_SCALE,a.SPLIT_MARGIN=3*a.RENDER_SCALE,a.INTERSEC_MARGIN=20*a.RENDER_SCALE,a.LINE_MARGIN=2*a.RENDER_SCALE,a.MARGIN_LEFT=2*a.RENDER_SCALE,a.ENABLE_IMAGE_PROCESS=!0,a.STEP_SIZE=2,a.CROP_FULL_WIDTH=!0,a.OVERLAP=.5,a.QUESTION_PATTERN=[],a.QUESTION_PATTERN2=[],a.BREAK_LINE_PATTERN=[],a.SECTION_PATTERN_LOWER=[],a.SECTION_PATTERN_NORMAL=[],a.KICK_PATTERN=[],a.TVCN_CHAR=[],a.HET_PATTERN=[],a.DAPAN_PATTERN=[],a.HUONGDAN_PATTERN=[],a.MULTIPLE_ANS_PATTERN=[],a.DRAW_RESULT="",a.SKIP_CHAR=[],a.FOOTER_PATTERN=[],a.HELP_ANS_PATTERN=[],a.RES_ANS_PATTERN=[],a.FIX_NO_END_PATTERN=[],a.GROUP_TF_PATTERN=[];class o{}o.RENDER_SCALE=2,o.LINE_SMALL_HEIGHT=7*o.RENDER_SCALE,o.SPLIT_MARGIN=3*o.RENDER_SCALE,o.INTERSEC_MARGIN=20*o.RENDER_SCALE,o.LINE_MAGIN=2*o.RENDER_SCALE,o.MARGIN_LEFT=2*o.RENDER_SCALE,o.ENABLE_IMAGE_PROCESS=!0,o.STEP_SIZE=2,o.CROP_FULL_WIDTH=!0,o.OVERLAP=.5,o.QUESTION_PATTERN=[],o.QUESTION_PATTERN2=[],o.BREAK_LINE_PATTERN=[],o.SECTION_PATTERN_LOWER=[],o.SECTION_PATTERN_NORMAL=[],o.KICK_PATTERN=[],o.TVCN_CHAR=[],o.HET_PATTERN=[],o.DAPAN_PATTERN=[],o.HUONGDAN_PATTERN=[],o.MULTIPLE_ANS_PATTERN=[],o.DRAW_RESULT="",o.SKIP_CHAR=[],o.FOOTER_PATTERN=[],o.HELP_ANS_PATTERN=[],o.ANS_PATTERN=[];class d{addTask(e,t,n,s){if(this.is_running)return;var l=n||[];let a=this.queues.length;this.all_tasks++,this.queues.push({task:()=>new Promise(n=>{this.wrap_counter++,t.call(e,...l).then(e=>{this.wrap_counter_done++,this.callLog(s),n({status:!0,value:e,index:a})}).catch(e=>{this.wrap_counter_done++,this.callLog(s),n({status:!1,error:e,index:a})})}),name:s})}callLog(e){this.action_log_item&&this.all_tasks>0&&this.action_log_item.function.call({},this.wrap_counter_done,this.all_tasks,...this.action_log_item.params?this.action_log_item.params:[],e)}start(){return new Promise(e=>{0===this.queues.length&&e({datas:[],errs:[]}),this.result_common_temp={datas:[],errs:[]};for(let e=0;e<this.limit_one_process;e++){let e=this.queues.shift();if(!e)break;this.tasks.push(e)}this.count_task_root_done=0,this.is_running=!0,this.runner(e)})}checker(e,t){this.count_task_root_done++,e.status&&e.value?this.result_common_temp.datas.push({index:e.index,value:e.value}):e.error&&this.result_common_temp.errs.push({index:e.index,value:e.error}),this.result_common_temp.errs.length>0&&this.end_with_error&&(this.is_running=!1,t(this.makeResultObj())),this.count_task_root_done===this.all_tasks&&(this.is_running=!1,t(this.makeResultObj())),this.nextItem(t)}makeResultObj(){return{datas:this.result_common_temp.datas.sort(function(e,t){return e.index-t.index}).map(e=>e.value),errs:this.result_common_temp.errs.sort(function(e,t){return e.index-t.index}).map(e=>e.value)}}nextItem(e){let t=this.queues.shift();t&&t.task.call(this).then(t=>{this.checker(t,e)})}runner(e){this.tasks.length>0?this.tasks.forEach(t=>{t.task.call(this).then(t=>{this.checker(t,e)})}):(this.is_running=!1,e(this.makeResultObj()))}constructor(e,t,n,s){this.tasks=[],this.queues=[],this.is_running=!1,this.all_tasks=0,this.wrap_counter=0,this.wrap_counter_done=0,this.count_task_root_done=0,this.limit_one_process=e,this.result_common_temp={datas:[],errs:[]},this.action_log_item=t,this.delay_time=n||1e3,this.end_with_error=null!=s&&s}}e.exports={Constants:a,Utils:class{static capitalizeFirstLetter(e){return e.charAt(0).toUpperCase()+e.slice(1)}static tagLang(e){let t=new Map([["EASY","NB"],["MEDIUM","TH"],["HARD","VD"],["HARDEST","VDC"],["MC","TN"],["FB","ĐT"],["ES","TL"],["TF","ĐS"],["GR","NH"]]);return t.has(e)?t.get(e):e}static parseInclude(e){var t;let n=e.split("=>"),s=n.length>1?n[1]:-1,l=n[0],a,o=(l=l.replaceAll(/\[@([CTQGK][-\d]+):(:(user[_0-9]*)-)?[^\]]*\]/g,"$1:$3").replaceAll(/\[@(F:[^\]]*)\]/g,"$1").replaceAll(/\[[^\]\d]+(\d+)[^\]\d]+\]/g,"$1").replaceAll(/\[[^\]]+\]/g,"")).split("."),d=[],h=[],c=[],u=[],x=[],p=[],f=[],m=[],g=[],v=new Map([["EASY","NB"],["MEDIUM","TH"],["HARD","VD"],["HARDEST","VDC"],["MC","TN"],["FB","ĐT"],["ES","TL"],["TF","ĐS"],["GR","NH"]]),b=[];for(let e=o.length-1;e>=0;e--){let n=o[e].trim();if(/^\d*$/.test(n)){a=+n;continue}for(let e of n.split(",")){let n=e.split(":"),s=n[0],l=null!==(t=n[1])&&void 0!==t?t:"";if(/^G[-\d]+$/.test(s.trim()))d.push(+s.trim().substring(1));else if(/^Q[-\d]+$/.test(s.trim()))c.push(+s.trim().substring(1)),m.push(l),b.push({type:"QUEST",id:+s.trim().substring(1)});else if(/^C[-\d]+$/.test(s.trim())){let e=+s.trim().substring(1);u.push(e),p.push(l),b.push({type:""!=l?"SHARE":"CATEGORY",id:e})}else if(/^K[-\d]+$/.test(s.trim())){let e=+s.trim().substring(1);u.push(e),p.push(l),b.push({type:""!=l?"SHARE":"KNOWLEDGE",id:e})}else if(/^T[-\d]+$/.test(s.trim()))h.push(+s.trim().substring(1)),f.push(l),b.push({type:"EXAM",id:+s.trim().substring(1),groupIds:d});else if(e.trim().startsWith("F:")){let t=e.trim().substring(2);g.push(v.has(t)?v.get(t):t)}}if(b.length>0){if(g.length>0){let e=["TL","TN","ĐT","ES","MC","FB","TF","GR","ĐS","NH"];for(let t of b)t.tags=g.filter(t=>0>e.indexOf(t)),t.answerTypes=g.filter(t=>e.indexOf(t)>=0).map(e=>"TL"==e||"ES"==e?3:"TN"==e||"MC"==e?1:"ĐS"==e?5:"NH"==e?0:4)}break}}return c.length>0&&(a=c.length),x.push(...p),x.push(...f),x.push(...m),{paths:b,shareTypes:x,catId:u,examId:h,tag:g,groupId:d,questId:c,getNum:a,idx:s}}static getNumberFromStr(e){let t=e.match(/(\d+)/);return t?t[0]:""}static removeAccents(e){for(let t of["a\xe0ả\xe3\xe1ạăằẳẵắặ\xe2ầẩẫấậ","A\xc0Ả\xc3\xc1ẠĂẰẲẴẮẶ\xc2ẦẨẪẤẬ","dđ","DĐ","e\xe8ẻẽ\xe9ẹ\xeaềểễếệ","E\xc8ẺẼ\xc9Ẹ\xcaỀỂỄẾỆ","i\xecỉĩ\xedị","I\xccỈĨ\xcdỊ","o\xf2ỏ\xf5\xf3ọ\xf4ồổỗốộơờởỡớợ","O\xd2Ỏ\xd5\xd3Ọ\xd4ỒỔỖỐỘƠỜỞỠỚỢ","u\xf9ủũ\xfaụưừửữứự","U\xd9ỦŨ\xdaỤƯỪỬỮỨỰ","yỳỷỹ\xfdỵ","YỲỶỸ\xddỴ"]){let n=RegExp("["+t.substring(1)+"]","g");e=e.replace(n,t[0])}return e}static zeroPad(e,t){return(Array(e=e||2).join("0")+t).slice(-1*e)}},PdfConst:new o,Task:d,Image:class{cssStringToJSON(e){for(var t={},n=e.split(";"),s=0;s<n.length;s++){var l=n[s].split(":");if(2===l.length){var a=l[0].trim(),o=l[1].trim();t[a]=o}}return t}getStyle(e){let t=e.match(/style="([^"]*)"/);return t?t[1]:""}cropImage(){}start(e){this.callback=e,this.questions.forEach(e=>{var t,n,s;(null===(t=e.content)||void 0===t?void 0:t.includes("<img "))&&this.replaceImage(e,"content"),(null===(n=e.explain)||void 0===n?void 0:n.includes("<img "))&&this.replaceImage(e,"explain"),(null===(s=e.options)||void 0===s?void 0:s.find(e=>e.text.includes("<img ")))&&this.replaceImage(e,"options")}),this.imageMaps.forEach(e=>{this.taskConvertBase64ToCanvas.addTask(this,this.startConvertCanvas,[e])}),this.taskConvertBase64ToCanvas.start().then(e=>{if(e.errs.length>0)this.callback({error:e.errs});else{let t=0,n=[],s=()=>{let e=document.createElement("canvas");e.width=this.sizeDefaultCanvas,e.height=this.sizeDefaultCanvas;let t=e.getContext("2d");t&&(t.fillStyle="white",t.fillRect(0,0,this.sizeDefaultCanvas,this.sizeDefaultCanvas)),n.push({cdn:"",cX:0,cY:0,canvas:e,imgs:[]})};s(),e.datas.forEach((e,l)=>{var a=n[n.length-1];a.cX+e.canvas.width+4>this.sizeDefaultCanvas?(a.cX=4,a.cY+=t+4,t=0):a.cX+=4,a.cY+e.canvas.height>this.sizeDefaultCanvas&&(s(),a=n[n.length-1]);var o=a.canvas.getContext("2d");a.imgs.push({x:a.cX,y:a.cY,width:e.canvas.width,height:e.canvas.height,index:l,style:this.getStyle(e.base),url:e.canvas.toDataURL("image/png",1)}),null==o||o.drawImage(e.canvas,0,0,e.canvas.width,e.canvas.height,a.cX,a.cY,e.canvas.width,e.canvas.height),a.cX+=e.canvas.width,t=t<e.canvas.height?e.canvas.height:t}),n[0].imgs.length>0?(n.forEach(e=>{this.taskUploadImage.addTask(this,this.startUploadFile,[e])}),this.taskUploadImage.start().then(t=>{t.errs.length>0?this.callback({error:t.errs}):(t.datas.forEach(t=>{t.imgs.forEach(n=>{let s=e.datas[n.index];if(s){let e={link:t.cdn,data:{x:n.x,y:n.y,width:n.width,height:n.height,style:n.style}};s.objs.forEach(t=>{let l='<img class="quill-image"  data-value=\''.concat(JSON.stringify(e),"' style=\"").concat(n.style,'"/>');"options"===s.path?t[s.path]=t[s.path].map(e=>({...e,text:e.text.replace(s.base,l)})):t[s.path]=t[s.path].replace(s.base,l)})}})}),this.callback({success:this.questions}))})):this.callback({success:this.questions})}})}replaceImage(e,t){var n=e[t];"options"==t&&(n=e[t].map(e=>e.text).join(""));let s=n.matchAll(this.pattern_image);for(;;){let n=s.next();if(n.done)break;let[l]=n.value,[,a,o]=l.match(/data-value=(?:"([^"]*)"|'([^']*)')/)||[];a||o||this.imageMaps.push({base:l,data:null,objs:[e],path:t,canvas:document.createElement("canvas")})}}startConvertCanvas(e){return new Promise((t,n)=>{let s=new Image;s.crossOrigin="anonymous",s.onload=()=>{var n;let l=1;if(s.width>this.sizeDefaultCanvas&&(l=this.sizeDefaultCanvas/s.width),s.height>this.sizeDefaultCanvas){let e=this.sizeDefaultCanvas/s.height;e<l&&(l=e)}e.canvas.width=s.width*l,e.canvas.height=s.height*l,null===(n=e.canvas.getContext("2d"))||void 0===n||n.drawImage(s,0,0,s.width,s.height,0,0,e.canvas.width,e.canvas.height),t(e)},s.onerror=()=>{e.canvas.width=1,e.canvas.height=1;let n=e.canvas.getContext("2d");n&&(n.fillStyle="white",n.fillRect(0,0,1,1)),t(e)};let l=this.pattern_base64.exec(e.base);null!=l?s.src=l[0]:n(Error("lỗi regex"))})}startUploadFile(e){return new Promise(async(t,n)=>{let s=new FormData;s.append("image",this.dataURLtoFile(e.canvas.toDataURL("image/png",1)));let{data:a}=await l.default.post("/uploads",s,{headers:{"Content-Type":"multipart/form-data"}}),{error:o,url:d}=a;if(o)return t({...e,cdn:await this.canvasToBlobURL(e.canvas,"image/png",1)||""});t({...e,cdn:d})})}canvasToBlobURL(e,t,n){return new Promise(function(s,l){e.toBlob(function(e){e?s(URL.createObjectURL(e)):l("Kh\xf4ng thể chuyển đổi canvas th\xe0nh blob.")},t,n)})}dataURLtoFile(e){let t=this.getFileName(e);for(var n=e.split(","),s=n[0].match(/:(.*?);/),l=atob(n[1]),a=l.length,o=new Uint8Array(a);a--;)o[a]=l.charCodeAt(a);return new File([o],t,{type:s&&s.length>0?s[1]:"png"})}getFileName(e){var t=e.split("").reverse().join(""),n=t.indexOf(";"),s=t.indexOf("/",n);return t.substring(n,s).split("").reverse().join("")}constructor(e){this.questions=JSON.parse(JSON.stringify(e)),this.callback=()=>{},this.sizeDefaultCanvas=1100,this.actionRunAfterConvert=[],this.imageMaps=[],this.pattern_base64=/data:image[^"'\\]+/i,this.pattern_image=/<img[^>]+data:image[^>]+>/g,this.taskConvertBase64ToCanvas=new d(50,{function:(e,t)=>{this.callbackBase64ToCanvas&&this.callbackBase64ToCanvas(e,t)}}),this.taskUploadImage=new d(3,{function:(e,t)=>{this.callbackUploadImage&&this.callbackUploadImage(e,t)}})}},Version:"test"}},6781:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});let s=n(1117);class l{constructor(e,t){this.baseUnits=0,this.thousands=0,this.num=e,this.str=t}}let a={SectionSugg:()=>{},toArabic:e=>{var t;let n=e.toUpperCase();if(t=n,!/^M{0,4}(CM|CD|D?C{0,3})(XC|XL|L?X{0,3})(IX|IV|V?I{0,3})$/.test(t))return null;let s=[new l(1e3,"M"),new l(900,"CM"),new l(500,"D"),new l(400,"CD"),new l(100,"C"),new l(90,"XC"),new l(50,"L"),new l(40,"XL"),new l(10,"X"),new l(9,"IX"),new l(5,"V"),new l(4,"IV"),new l(1,"I")],a=0,o=0;for(;n.length>0&&o<s.length;){let e=s[o];n.startsWith(e.str)?(a+=e.num,n=n.substring(e.str.length)):o++}return n.length>0?null:a},isRoman:()=>{},toRoman:()=>{},RomanNumber:()=>{}},o=e=>{let t="z",n="abcdefghijklmnopqrstuvwxyz0123456789",s=n.length;for(let l=0;l<e;l++)t+=n.charAt(Math.floor(Math.random()*s));return t};class d{process(e){let t=/^\s*#(\d)\s*\[[A-Z0-9\-\[\]\$!:b]+\]/g,n=["NB","TH","VD","VDC"],s=0,l=!1,a=1;for(let o of e){let d=o.matchAll(t).next();if(!d.done){let t=+d.value[1]-1;t<n.length&&(e[s]=o.replace(d.value[0],"C\xe2u ".concat(a++,". (").concat(n[t],")"))),l=!0}l&&"GY"==o.trim()&&(e[s]="Lời giải"),s++}}}class h{process(e){let t=["(^c\xe2u\\s*\\d{1,4}[^0-9])","(^câu\\s*\\d{1,4}[^0-9])","(^c\xa9u\\s*\\d{1,4}[^0-9])","(^ca‚u\\s*\\d{1,4}[^0-9])","(^b\xe0i\\s*\\d{1,4}[^0-9])","(^bài\\s*\\d{1,4}[^0-9])","(^cau\\s*\\d{1,4}[^0-9])","(^bai\\s*\\d{1,4}[^0-9])","(^question\\s*\\d{1,4}[^0-9])","(^questions\\s*\\d{1,4}[^0-9])","(^\\[\\d{1,4}\\][^0-9])","(^\\d+\\s*\\(nb\\))","(^\\d+\\s*\\(th\\))","(^\\d+\\s*\\(vd\\))","(^\\d+\\s*\\(vdc\\))","(^c\xe2u\\s*\\d{1,4}[\\s\\.:]*$)","(^câu\\s*\\d{1,4}[\\s\\.:]*$)","(^c\xa9u\\s*\\d{1,4}[\\s\\.:]*$)","(^ca‚u\\s*\\d{1,4}[\\s\\.:]*$)","(^b\xe0i\\s*\\d{1,4}[\\s\\.:]*$)","(^bài\\s*\\d{1,4}[\\s\\.:]*$)","(^cau\\s*\\d{1,4}[\\s\\.:]*$)","(^bai\\s*\\d{1,4}[\\s\\.:]*$)","(^questions\\s*\\d{1,4}[\\s\\.:]*$)","(^question\\s*\\d{1,4}[\\s\\.:]*$)"],n=["(^(\\d+\\s*\\.)\\s*[\\.0-9])","(^(\\d+\\s*\\.)\\s*\\(\\s*\\d+\\s*\\))","(^(\\d+\\s*\\.)\\s*[^\\s]\\s*[^\\s0-9])","(^\\d+\\s*\\.\\s*$)"],l=["(HƯỚNG\\s*DẪN)","(ƯỚNG\\s*DẪN\\s*GIẢI\\s*CHI)","(GIẢI\\s*TH\xcdCH\\s*CHI\\s*TIẾT)","(Hướng\\s*dẫn\\s*giải)","(Lời\\s*giải)","(LỜI\\s*GIẢI)","(GIẢI\\s*CHI\\s*TIẾT)","(HD:)","(GLOSSARY)"],a=0,o=[],d=[];for(let h of e){let e=this.do(h,t,n);null!=e?(o.push({idx:a,val:s.Utils.capitalizeFirstLetter(e.olabel)}),d.push("q")):null!=(e=this.match(h,l))&&d.push("h"),a++}if(d.join("-").startsWith("q-h-q-h")){let t=1;for(let n of o)e[n.idx]=e[n.idx].replace(n.val,n.val.replace(/\d+/g,t+"")),t++}}do(e,t,n){let s=this.matchPos(e,t,n);if(s.value){let t=null;for(let e=s.value.length-1;e>=0;e--)if(s.value[e]){t=s.value[e];break}if(null==t)return null;let n=e.replace(/\|/g,"").toLowerCase().indexOf(t),l=n,a="",o=e.toLowerCase();for((t.endsWith("(")||t.endsWith("["))&&(t=t.substring(0,t.length-1));l<o.length&&("|"!=o[l]&&(a+=o[l]),l++,a!=t););return{pos:[n,l],olabel:t}}return null}matchPos(e,t,n){let s=e.replace(/\|/g,"").toLowerCase().trim(),l=t.join("|"),a=s.matchAll(l).next();return a.value||(l=n.join("|"),a=s.matchAll(l).next()),a}match(e,t){let n=e.replace(/\|/g,"").trim().match(t.join("|"));return null!=n&&n.length>0?{pos:[0,0],olabel:""}:null}}class c{readFileInputEventAsArrayBuffer(e,t){var n=new FileReader;n.onload=function(e){t(e.target.result)},n.readAsArrayBuffer(e)}handleFileSelect(e,t,n,l){let a=this,o=(e,t)=>{n&&n(e,t,"lang_auto_cong_thuc")},d=new s.Task(30,{function:n?(e,t)=>{n&&n(e,t,"lang_auto_image")}:()=>{}});this.readFileInputEventAsArrayBuffer(e,function(e){taodethiDocx.readDocx(e,o).then(function(e){for(let t of e.data)"img"==t.type&&("image/x-wmf"==t.contentType||"image/x-emf"==t.contentType?d.addTask(a,a.convert,[t]):t.value="data:"+t.contentType+";base64, "+t.value,!t.cssStyle&&t.height&&t.width&&"EMU"==t.measureUnit)&&(t.cssStyle="width:".concat(+t.width/12700,"pt;height:").concat(+t.height/12700,"pt;margin-top:0px;"));d.start().then(()=>{let n=new Map,s=0;for(let t of e.data)"img"==t.type&&t.cropInfo&&n.set(s,1),s++;if(t&&0==n.size)t(e);else for(let l of(s=0,e.data)){if("img"==l.type&&l.cropInfo){let o=s,d=document.createElement("img");d.src=l.value,d.onload=()=>{a.cropImage(l,d),n.delete(o),0==n.size&&t&&t(e)},d.onerror=()=>{n.delete(o),0==n.size&&t&&t(e)}}s++}})}).catch(e=>{l&&l(e.message)})})}convert(e){return new Promise(t=>{if("image/x-wmf"==e.contentType)e.value=this.wmf.toPNG("data:"+e.contentType+";base64, "+e.value),t();else{let s=new ToContext2D(0,1),l=this.decodeBase64(e.value);try{FromEMF.Parse(l,s)}catch(e){}var n=this.scaleCanvas(s.canvas,200,200);e.value=n.toDataURL(),t()}})}decodeBase64(e){return Uint8Array.from(atob(e),function(e){return e.charCodeAt(0)})}scaleCanvas(e,t,n){var s;let l=document.createElement("canvas");return l.width=t,l.height=n,null===(s=l.getContext("2d"))||void 0===s||s.drawImage(e,0,0,e.width,e.height,0,0,t,n),l}cropImage(e,t){var n;if(!e.cropInfo)return;let s=e.cropInfo.left?+e.cropInfo.left:0,l=e.cropInfo.top?+e.cropInfo.top:0,a=e.cropInfo.right?+e.cropInfo.right:0,o=e.cropInfo.bottom?+e.cropInfo.bottom:0;if(s+l+a+o==0)return;let d=t.width,h=t.height,c=s*d/1e5,u=l*h/1e5,x=d-a*d/1e5-c,p=h-o*h/1e5-u,f=document.createElement("canvas");f.width=x,f.height=p,null===(n=f.getContext("2d"))||void 0===n||n.drawImage(t,c,u,x,p,0,0,x,p),e.value=f.toDataURL()}constructor(e){this.commonService=e,this.wmf=new WMFConverter}}class u{setLines(e){this._lines=e}parse(e){return this._lstQuest=this.exParser.parse(this._lines,e,!1),this._lstQuest}constructor(e){this.conf=e,this._lstQuest=[],this._lines=[],this.singleMode=!1,this.exParser=new x(e)}}class x{setLang(e){this.lang=e,this.DEF_QUEST_NAME="vi"==e?"c\xe2u ":"question "}fixItems(e){let t=["(^b\xe0i\\s+\\d+)"],n=[],s=0,l=!1;for(let a of e)a.type==I.TYPE_NAME&&a.olabel&&(a.olabel.trim().match(t.join("|"))?n.push(s):l=!0),s++;if(l)for(let t of n)t+1<e.length&&e[t+1].type==I.TYPE_NAME&&(e[t].type=y.TYPE_NAME,e[t].pos=[0,0]);return e}parse(e,t,n){var l,o,d,h,c,u,x,p,v,b,C,j,T,P,Z,S,N,L,k,_,M,R,O;let H="__NO-SEC__";new f().fixNoEnd(e);let F=this.findItems(e,n);this.fixItems(F);let z=new Map,q=[],G=null,Y=0,W=H,U="main",$=0,V=0,Q=new Map,K=new Map,X=H;for(let t=0;t<F.length;t++){let n=F[t],a=t==F.length-1?void 0:F[t+1],P=this.getPartInfo(e,n,a);if(this.loadText(e,P),n.type==y.TYPE_NAME&&"main"==U&&(Y++,W=null!==(l=n.extInfo)&&void 0!==l?l:Y+"",q.push({label:Y,parts:P,answers:[],isGroup:!0})),n.type==I.TYPE_NAME){if(a&&a.type==w.TYPE_NAME&&a.pos[2]>0){let s;for(let e=t+1;e<F.length;e++)if(F[e].type!=w.TYPE_NAME){s=F[e];break}P=this.getPartInfo(e,n,s),this.loadText(e,P)}let s=n.label?+n.label:0,l=z.get(W+"--"+s);if(l&&"main"!=U){let e=P.map(e=>e.text).join("\n").trim();l.help&&1==e.split("\n").length&&0==l.answers.length?l.strAns=e.replaceAll(/\[![hcluib]+:\$([^\]]*)\$\]/g,"$1").trim():l.help=P,G=l}else"main"==U&&(l={label:s,olabel:n.olabel,answers:[],parts:P},Y>0&&(l.group=Y,l.extInfo=W),z.set(W+"--"+s,l),q.push(l),G=l)}if(n.type==w.TYPE_NAME&&G&&"main"==U){let t=!1;if(P.length>0){let n=e[P[0].lineIdx].replace(/\|/g,"").trim().match(s.Constants.MULTIPLE_ANS_PATTERN.join("|"));null!=n&&n.length>0&&(t=!0)}let l=""==n.olabel;n.pos[2]>0&&((P=[P[0]])[0].e=n.pos[2],this.loadText(e,P),l=!0);let a={label:null!==(o=n.label)&&void 0!==o?o:"",isCorrect:"*"==n.extInfo,parts:l?[P[0]]:P,isInline:l,olabel:n.olabel};G.answers.push(a),G.isFixAns=l||t}if(n.type==A.TYPE_NAME){if(n.label&&/\.\d*$/.test(n.label)){let e=n.label.split("."),t=+e[e.length-1],s=null!==(d=P[0].text)&&void 0!==d?d:"",l=null!==(h=K.get(s))&&void 0!==h?h:-1;if(l++,K.set(s,l),0==t){Y++,W=null!==(c=n.label)&&void 0!==c?c:"";let e=s+"=>"+l+"-0",t=[];t.push(...P),t[0]={lineIdx:P[0].lineIdx,s:0,b:0,text:e},q.push({label:Y,parts:t,answers:[],isGroup:!0});continue}let a=G?G.label:0,o=0;for(let e=0;e<t;e++){o++;let t=s+"=>"+l+"-"+e,n=[];n.push(...P),n[0]={lineIdx:P[0].lineIdx,s:0,b:0,text:t};let d={label:a+o,olabel:G?null===(u=G.olabel)||void 0===u?void 0:u.replace(/\d+/,a+o+""):this.DEF_QUEST_NAME+(a+o)+".",answers:[],parts:n};Y>0&&(d.group=Y,d.extInfo=W),z.set(W+"--"+d.label,d),q.push(d),G=d}}else if(n.label&&/\.Q\d+(,Q\d+)*$/.test(n.label)){let e=n.label.split(".").pop(),t=null!==(x=null==e?void 0:e.split(",").length)&&void 0!==x?x:0;for(let e=0;e<t;e++){let t={lineIdx:P[0].lineIdx,s:0,b:0,text:P[0].text+"=>0-"+e},n=G?G.label:0,s={label:n+1,olabel:G?null===(p=G.olabel)||void 0===p?void 0:p.replace(/\d+/,n+1+""):this.DEF_QUEST_NAME+(n+1)+".",answers:[],parts:[t]};Y>0&&(s.group=Y,s.extInfo=W),z.set(W+"--"+s.label,s),q.push(s),G=s}}}n.type==E.TYPE_NAME&&G&&(P.splice(0,1),a&&a.type==I.TYPE_NAME&&a.label&&!z.has(W+"--"+a.label)||!a||a.type==y.TYPE_NAME||a.type==m.TYPE_NAME?"main"==U&&(G.help=P):"main"==U&&(U="info",$=null!==(v=n.lineIdx)&&void 0!==v?v:0),$>0&&0==V&&(V=null!==(b=n.lineIdx)&&void 0!==b?b:0)),(n.type==m.TYPE_NAME||n.type==g.TYPE_NAME)&&(U="info",$=null!==(C=n.lineIdx)&&void 0!==C?C:0,Y=0),n.type==y.TYPE_NAME&&"info"==U&&W!=H&&(Y++,W=X=null!==(j=n.extInfo)&&void 0!==j?j:Y+""),n.type==f.TYPE_NAME&&(n.extInfo=X,Q.has(X)||Q.set(X,[]),null===(T=Q.get(X))||void 0===T||T.push(n))}let J=new f,ee=new Map;for(let t of Q){let n=J.getAnsMC(e,t[1]),s=null!==(P=(0,a.toArabic)(t[0]))&&void 0!==P?P:t[0];for(let e of n)ee.set(s+"--"+e[0],e[1])}let et=new Map;if($>0){let t=V>0?e.slice($,V):e.slice($);for(let e of J.getAnsStr(t)){let t=!1,n=+e[0].split("-")[1],s=H,l=0;for(let e=0;e<F.length;e++){let a=F[e];a.type!=m.TYPE_NAME&&a.type!=g.TYPE_NAME?a.type==y.TYPE_NAME&&t&&(null!==(Z=a.lineIdx)&&void 0!==Z?Z:0)<$+n&&(l++,s=null!==(S=a.extInfo)&&void 0!==S?S:l+""):t=!0}let o=(0,a.toArabic)(s);o&&(s=o+""),et.set(s+"--"+e[0].split("-")[0],e[1])}}let en=[];for(let t of q){if(t.isGroup){en.push(t);continue}let n=null!==(N=t.extInfo)&&void 0!==N?N:H,l=(null!==(L=(0,a.toArabic)(n))&&void 0!==L?L:n)+"--"+t.label,o=H+"--"+t.label,d=null!==(_=null!==(k=ee.get(l))&&void 0!==k?k:ee.get(o))&&void 0!==_?_:"",h=null!==(R=null!==(M=et.get(l))&&void 0!==M?M:et.get(o))&&void 0!==R?R:"",c="";t.help&&(c=null!==(O=J.getAnsFromHelp(t.help,e))&&void 0!==O?O:""),d.startsWith("!")&&(t.typeCode="TF");let u=d;if(""==u.trim()&&(u=c),""==u.trim()&&(u=h),t.answers.length>0){if(0==t.answers.filter(e=>e.isCorrect).length)for(let e of t.answers)/^!?[A-H,\s]+$/.test(u)&&u.indexOf(e.label.toUpperCase())>=0&&(e.isCorrect=!0);let n=t.answers.filter(e=>e.isCorrect).length;if(t.typeCode||(t.typeCode=n>1?"MC":"SC"),0==n&&""!=u&&"!"!=u){for(let n of(t.typeCode="FI",t.strAns=u,t.answers))for(let s of n.parts)s.s=s.b,this.loadText(e,[s]),t.parts.push(s);t.answers=[]}}else t.strAns=""==u&&t.strAns?t.strAns:u,t.typeCode||""==t.strAns||(t.typeCode="FI");if(t.typeCode||(t.typeCode="ES"),t.answers.length>0){if(")"==t.answers[0].olabel&&"a"==t.answers[0].label)t.typeCode="TF";else if(t.group){let e=en.filter(e=>e.label==t.group)[0];if(e){let n=e.parts.map(e=>e.text).join(" ").toLowerCase().match(s.Constants.GROUP_TF_PATTERN.join("|"));n&&n.length>0&&(t.typeCode="TF")}}}}this.metadata={res1:ee,res2:et};try{new B().run(q)}catch(e){}return q}static fixNoEnd(e){new f().fixNoEnd(e)}getPartInfo(e,t,n){var s,l;let a=null!==(s=t.lineIdx)&&void 0!==s?s:0,o=null!==(l=null==n?void 0:n.lineIdx)&&void 0!==l?l:e.length-1;if(a==o)return n?[{lineIdx:a,b:t.pos[0],s:t.pos[1],e:null==n?void 0:n.pos[0]}]:[{lineIdx:a,b:t.pos[0],s:t.pos[1]}];{let s=[];s.push({lineIdx:a,b:t.pos[0],s:t.pos[1]});for(let e=a+1;e<o;e++)s.push({lineIdx:e,b:0,s:0});if(n){let t=null==n?void 0:n.pos[0];""!=e[o].substring(0,t).replace(/\|/g,"").trim()&&s.push({lineIdx:o,b:0,s:0,e:t})}else s.push({lineIdx:o,b:0,s:0});return s}}loadText(e,t){for(let n of t)n.text=e[n.lineIdx].substring(n.s,n.e)}findItems(e,t){let n=["remove:q-s-a => 1","remove:s-s => 0","remove:h-h => 0","remove:h-a => 0","rmdup:a-a => void","remove:q-a:\\d+\\-[^A] => 0","remove:s-a:.+\\-[^A] => 0","remove:a-a:A\\-[^BC] => 0","remove:a-a:B\\-[^CD] => 0","remove:a-a:C\\-[^DB] => 0","remove:a-a:D\\-[^E] => 0","remove:a-a:E\\-[^F] => 0","remove:a-a-a:A-B\\-[^C] => 0","remove:a-a-a:A-C\\-[^B] => 0"];t&&(n=["remove:q-s-a => 1","remove:s-s => 0","remove:h-h => 0","remove:h-a => 0","remove:q-a:\\d+\\-[^A] => 0","remove:s-a:.+\\-[^A] => 0","remove:a-a:A\\-[^ABC] => 0","remove:a-a:B\\-[^ABCD] => 0","remove:a-a:C\\-[^ABCDE] => 0","remove:a-a:D\\-[^ADEF] => 0","remove:a-a:E\\-[^AEF] => 0"]);let s=[new C,new j,new b,new T],l=[{parser:new f,also:[2]},{parser:new y,from:[0],to:[1],also:[3]},{parser:new I,from:[0],to:[1],also:[3]},{parser:new w},{parser:new m,to:[2]},{parser:new g,to:[2],also:[6]},{parser:new E},{parser:new A,from:[0],to:[1]}],a=[{name:"start",expect:[1,2,7]},{name:"main",expect:[1,2,3,4,5,6,7]},{name:"info",expect:[0,1,2,6]}],o=a[0],d=[],h=0;for(let t of e)if(""!=t){for(let e of o.expect){let n=l[e],s=n.parser.parse(t);if(s.length>0){if(s.forEach(e=>e.lineIdx=h),d.push(...s),n.parser.TYPE==E.TYPE_NAME){let e=d.filter(e=>e.type==I.TYPE_NAME).length,t=d.filter(e=>e.type==E.TYPE_NAME).length,n=d.filter(e=>e.type==g.TYPE_NAME).length;if(o.name==a[1].name&&e>1&&0==t){o=a[2];let e=a[2].expect.indexOf(6);e>=0&&a[2].expect.splice(e,1)}else if(o.name==a[2].name){n>0&&l[0].parser.off();let e=a[2].expect.indexOf(6);e>=0&&a[2].expect.splice(e,1)}}if(n.to){let e=0;for(let t of n.to)(n.from&&a[n.from[e]]==o||!n.from)&&(o=a[t]),e++}if(n.also)for(let e of n.also){let n=d[d.length-1].pos[1],s=l[e].parser.parse(t.substring(n));s.length>0&&(s.forEach(e=>{e.lineIdx=h;for(let t=0;t<e.pos.length;t++)e.pos[t]=e.pos[t]+n}),d.push(...s))}break}}h++}else h++;let c=[];for(let e of n)for(let t of s){let n=t.load(e);if(n){c.push(n);break}}let u=0;for(;u<d.length;){for(let e of c){let t=d.length;if(e.run(d,u)){let e=t-d.length;e>0&&(u-=e+1);break}}u++}return d}constructor(e){this.DEF_QUEST_NAME="c\xe2u ",this.lang="vi",s.Constants.load(e)}}class p{on(){this.isOn=!0}off(){this.isOn=!1}parse(e){return this.isOn?this.do(e):[]}match(e,t){let n=e.replace(/\|/g,"").trim().match(t.join("|"));return null!=n&&n.length>0?[{type:this.TYPE,pos:[0,0]}]:[]}constructor(){this.isOn=!0,this.TYPE="default"}}class f extends p{do(e){let t=/^[0-9ABCDEFGH\u0110Sabcdefgh\u0111s]+$/i,n=this.cleanDS(e),l=this.cleanLine(n);if(this.cleanStyle(n).trim().match(s.Constants.HELP_ANS_PATTERN.join("|")),t.test(l)&&l.length>=2)return[{type:f.TYPE_NAME,pos:[0,0]}];t=/^\[\*(!!\d+!!:)?(\s*\d+[^\]|]+\|?)+\*\]$/i;let a=this.cleanLineKeepTable(n.trim());return a=a.replaceAll("\\|",""),t.test(a)&&l.length>=2?[{type:f.TYPE_NAME,pos:[0,0]}]:[]}fixNoEnd(e){let t=[new m,new g],n=[],l=0,a=-1;for(let o of e){if(""==o.trim()){l++;continue}for(let e of t){let t=e.parse(o);t.length>0&&n.push(...t)}let e=this.cleanDS(o);(e=this.cleanLineKeepTable(e)).trim().match(s.Constants.FIX_NO_END_PATTERN.join("|"))&&-1==a&&(a=l),l++}if(0==n.length&&a>=0){for(let t=a-1;t>=0;t--)if(!e[t].trim().startsWith("[*"))return e.splice(t+1,0,"Hết"),e}}cleanLine(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e;for(let e of(n=this.cleanStyle(n),[/\|/g,t?/[\s:;![\]@*$()]+/g:/[\s.\-:,;![\]@*$()]+/g,/C\xe2u/g,/C\xc2U/g,/\u0110\xe1p\xe1n/g,/\u0110\/A/g,/Question/g,/Questions/g,/question/g,/questions/g,/ch\u1ecdn/g,/Ch\u1ecdn/g,"–","−"]))n=n.replaceAll(e,"");return n.replaceAll("\\n","")}cleanLineKeepTable(e){let t=e;for(let e of(t=(t=t.replaceAll(/\[![!iucsbp]+:\$(([^$]|\$[^\]])+)\$\]/g,"$1")).replaceAll(/\[![!iucsbp]+:!!\]/g,""),[/C\xe2u/g,/C\xc2U/g,/\u0110\xe1p\xe1n/g,/\u0110\/A/g,/Question/g,/Questions/g,/question/g,/questions/g,/ch\u1ecdn/g,/Ch\u1ecdn/g,"–","−"]))t=t.replaceAll(e,"");return t.replaceAll("\\n","")}cleanDS(e){return e.replaceAll(/([a-d])[.),]\s*[\u0110\u0111]\xfang/g,"$1) Đ").replaceAll(/([a-d])[.),]\s*[Ss]ai/g,"$1) S")}pivotTable(e){let t=e.length,n=e[0].length,s=[];for(let l=0;l<n;l++){let n=[];for(let s=0;s<t;s++)n.push(e[s][l]);s.push(n)}return s}getAnsMC(e,t){var n;let l=[],a=[],o=[],d=new Map;for(let h of t){let t=e[null!==(n=h.lineIdx)&&void 0!==n?n:0];t=this.cleanDS(t);let c=this.cleanLine(t);if(/^\d+([a-dA-D][D\u0110S\u0111sd])+$/.test(c)){let e=s.Utils.getNumberFromStr(c),t=c.replace(e,"").replaceAll(/[a-dA-D][Ss]/g,"").replaceAll(/([a-dA-D])[\u0111\u0110Dd]/g,"$1").toUpperCase();d.set(+e,t)}if(a.push(t),t.trim().startsWith("[*")){let e=t.replace(/\[\*(!!\d+!!:)?/g,"").replace("*]","").replace(/\s\|\s/g,"|").trim();e=e.replaceAll("\\|","__//__").replaceAll("|","_##_").replaceAll("__//__","|"),o.push(e.split("_##_"))}else l.push(t)}let h=new Map;if(o.length>0){let e=0,t=0,n=/^([a-dA-D][D\u0110S\u0111sd])*$/,s=-1,l=!0,a=0;for(let e=0;e<o.length;e++){let t=o[e];for(let e=0;e<t.length;e++){let s=t[e],o=this.cleanLineKeepTable(s.trim()).match(/^(\d+)([.:,)])/i);if(!o){l=!1,h.clear();break}a=+o[1];let d=s.substring(s.indexOf(o[2])+1).trim();n.test(d)&&""!=d&&(d="!"+(d=d.replaceAll(/[a-dA-D][Ss]/g,"").replaceAll(/([a-dA-D])[\u0111\u0110Dd]/g,"$1").toUpperCase())),h.set(a,d)}if(!l)break}for(l&&d.size>0&&(e=o.length+1);e<o.length;){let l=!0;for(let n=0;n<o[e].length;n++){let s=+this.cleanLine(o[e][n]);if(0!=s){if(s-t!=1&&0!=t){l=!1;break}t=s}}if(l){if(s=e,++e>=o.length)break;for(let t=0;t<o[s].length;t++){let l=+this.cleanLine(o[s][t]),a=this.cleanLine(o[e][t]);n.test(a)&&""!=a&&(a="!"+(a=a.replaceAll(/[a-dA-D][Ss]/g,"").replaceAll(/([a-dA-D])[\u0111\u0110Dd]/g,"$1").toUpperCase())),h.set(l,a.startsWith("!")?a:o[e][t].trim())}e++}else{if(0==e){let n=!0;t=0;for(let e=0;e<o.length;e++){let s=+this.cleanLine(o[e][0]);if(0!=s){if(s-t!=1&&0!=t){n=!1;break}t=s}}if(n){o=this.pivotTable(o),e=0,t=0,s=-1;continue}break}{let t=!0;for(let l=0;l<o[e].length;l++){let a=this.cleanLine(o[e][l]);if(!n.test(a)){t=!1;break}{let e=+this.cleanLine(o[s][l]);""!=a&&(a=a.replaceAll(/[a-dA-D][Ss]/g,"").replaceAll(/([a-dA-D])[\u0111\u0110Dd]/g,"$1").toUpperCase()),h.set(e,h.get(e)+a)}}if(e++,!t){h.clear();break}}}}}for(let e of(0==h.size&&(l=a),h))d.set(e[0],e[1]);let c=[];for(let e of l){let t=this.cleanLine(e).trim();/(\d+[A-H])+/i.test(t)&&c.push(t)}let u=c.join(""),x=this.cleanLine(u);for(let e of this.getResultMC(x.toUpperCase()))d.set(e.num,e.str);return d}cleanStyle(e){let t=e;return(t=(t=t.replaceAll(/\[![!iucsbp]+:\$(([^$]|\$[^\]])+)\$\]/g,"$1")).replaceAll(/\[![!iucsbp]+:!!\]/g,"")).replaceAll(/\[\*(!!\d+!!:)?/g,"").replaceAll("*]","")}getAnsStr(e){let t=e.join("\n");t=this.cleanStyle(t),t=this.cleanDS(t);let n=this.getResultStr(t),s=new Map,l=/^([a-dA-D][\u0110S\u0111sDd])*$/;for(let e of n){let t=this.cleanLine(e.str);l.test(t)&&(e.str="!"+t.replaceAll(/[a-dA-D][Ss]/g,"").replaceAll(/([a-dA-D])[\u0111\u0110Dd]/g,"$1").toUpperCase()),s.set(e.num+"-"+e.lineIdx,e.str)}return s}getAnsFromHelp(e,t){var n,l;let a=[],o=/^([a-dA-D][\u0110S\u0111sDd])*$/;for(let n of e){let e=t[n.lineIdx];e=this.cleanStyle(e),""!=(e=this.cleanDS(e).trim())&&a.push(e)}a.length>1&&(a=[a[0],a[a.length-1]]);let d=0;for(let t of a){let a=t.trim().match(s.Constants.HELP_ANS_PATTERN.join("|")),h=2*s.Constants.HELP_ANS_PATTERN.length+1;if(null!=a)for(let t=0;t<h;t++){if(0==t||t%2>0)continue;let s=null===(n=a[t])||void 0===n?void 0:n.trim();if(null!=s){let t=0==d?0:e.length-1;e[t].text=null===(l=e[t].text)||void 0===l?void 0:l.replace(a[0],"");let n=this.cleanLine(s);return o.test(n)&&(s="!"+n.replaceAll(/[a-dA-D][Ss]/g,"").replaceAll(/([a-dA-D])[\u0111\u0110Dd]/g,"$1").toUpperCase()),s}}d++}return""}getResultStr(e){let t=[],n=e.replace(/\n/g,"\n"),l=s.Constants.QUESTION_PATTERN.join("|").replace(/\(\^/g,"("),a=n.matchAll(RegExp(l,"ig"));for(;;){let e=a.next();if(e.done)break;let t=e.value[0],l=s.Utils.getNumberFromStr(t);n=n.replace(t,l+".")}let o,d=s.Constants.RES_ANS_PATTERN.length>0?RegExp(s.Constants.RES_ANS_PATTERN.join("|"),"g"):/\d+[.-][^|0-9]/g,h=n.matchAll(d),c=-1;for(;;){let e=h.next();if(e.done)break;if(-1==c)c=e.value.index,o=e;else{let s=n.substr(c,e.value.index-c);t.push(this.toAns(s,o,this.getLineIdx(n,c))),c=e.value.index,o=e}}if(c>=0&&o){let e=n.substr(c);t.push(this.toAns(e,o,this.getLineIdx(n,c)))}return t}getLineIdx(e,t){return e.substring(0,t).split("\n").length-1}toAns(e,t,n){let s=t.value[0].length-1;return{num:+t.value[0].substr(0,s-1),str:e.substring(s).replace(/\s+/g," ").trim(),lineIdx:n}}getResultMC(e){let t=[],n="",s=[],l=!1;for(let t=0;t<e.length;t++){let a=e.charCodeAt(t),o=a>=65&&a<=72;if(o&&""==n)return[];o!=l&&(s.push(n),n=""),l=o,n+=e[t]}""!=n&&s.push(n);for(let e=1;e<s.length;e+=2){let n=0,l=Math.floor(s[e-1].length/s[e].length),a=+s[e-1].substring(n,l),o=a,d=!1;for(let h=0;h<s[e].length;h++){if(h>=s[e-1].length||(a=+s[e-1].substring(n,n+l))!=o){d=!0;break}t.push({num:a,str:s[e][h]}),n+=l,l=(o=a+1).toString().length}if(d){t=[];break}}if(0==t.length)for(let e=1;e<s.length;e+=2){let n=+s[e-1];if(e>1&&n!=t[t.length-1].num+1)return[];t.push({num:n,str:s[e]})}return t}constructor(e){super(),this.TYPE=f.TYPE_NAME,null!=e&&(this.isOn=e)}}f.TYPE_NAME="chitietdapan";class m extends p{do(e){return this.match(e,s.Constants.HET_PATTERN)}constructor(e){super(),null!=e&&(this.isOn=e),this.TYPE=m.TYPE_NAME}}m.TYPE_NAME="end";class g extends p{do(e){return this.match(e,s.Constants.DAPAN_PATTERN)}static getAnsFromHelp(e){for(let t of e){let e=t.replace(/\|/g,"").trim().match(s.Constants.HELP_ANS_PATTERN.join("|"));if(null!=e){for(let t of e)if(null!=t&&1==t.length)return t}}return""}constructor(e){super(),null!=e&&(this.isOn=e),this.TYPE=g.TYPE_NAME}}g.TYPE_NAME="dapan";class v{checkVal(e,t){var n;if(""==this.valPattern)return!0;let s=[];for(let l=Math.ceil(this.pattern.length/2);l>0;l--)s.push(null===(n=e[t-l+1].label)||void 0===n?void 0:n.trim());let l=s.join("-");return new RegExp(this.valPattern).test(l.toLocaleUpperCase())}getStack(e,t){let n="",s=t-10>=0?t-10:0;for(;s<=t;s++)n+="-"+e[s].type[0];return n}constructor(e,t){if(this.TYPE="",this.pattern="",this.valPattern="",this.data=[],this.TYPE=t,!e.startsWith(this.TYPE))return;let n=e.substring(this.TYPE.length).split("=>"),s=n[0].split(":");this.pattern=s[0].trim(),this.valPattern=s.length>1?s[1].trim():"",this.data=n[1].split(",").map(e=>e.trim())}}class b extends v{load(e){let t=new b(e);return""!=t.pattern?t:null}run(e,t){var n,l,a;if(""==this.pattern)return!1;let o=e[t];if(o.type[0]!=this.pattern)return!1;let d=[],h=[],c="";for(let n=0;n<t;n++){let t=e[n];(t.type==m.TYPE_NAME||t.type==g.TYPE_NAME)&&(c="da"),t.type==E.TYPE_NAME&&"da"==c&&(c="hd")}if("da"==c)return!1;for(let n=t-1;n>=0;n--){let t=e[n];if(t.type==m.TYPE_NAME||t.type==g.TYPE_NAME||"hd"==c&&t.type==E.TYPE_NAME||(t.type[0]==this.pattern&&t.olabel&&(d.push(t.olabel),h.push(t.label)),2==d.length))break}if(d.length>=1){let c=d[0],u=2==d.length?d[1]:c,x=null!==(n=o.olabel)&&void 0!==n?n:"";if("a"==this.pattern&&(""==c&&(c="."),""==u&&(u="."),""==x&&(x=".")),""==this.valPattern){if(c==u&&x!=c)return e.splice(t,1),!0}else for(let n of this.valPattern.split(",")){let d=n.trim(),p=new RegExp(s.Constants[d].join("|"));if(p.test(c)&&p.test(u)&&!p.test(x)&&+(null!==(l=h[0])&&void 0!==l?l:"0")+1!=+(null!==(a=o.label)&&void 0!==a?a:"0"))return e.splice(t,1),!0}}return!1}constructor(e){super(null!=e?e:"","same:")}}class C extends v{load(e){let t=new C(e);return""!=t.pattern?t:null}run(e,t){if(""==this.pattern)return!1;if(this.getStack(e,t).endsWith(this.pattern)&&this.checkVal(e,t)){for(let n of this.data)e.splice(t-+n,1);return!0}return!1}constructor(e){super(null!=e?e:"","remove:")}}class j extends v{load(e){let t=new j(e);return""!=t.pattern?t:null}run(e,t){if(""==this.pattern)return!1;if(this.getStack(e,t).endsWith(this.pattern)&&this.checkVal(e,t)){for(let n of this.data){let s=n.split(":"),l=t-+s[0],a=e[l].label;e[l].label=s[1],e[l].err=a+" -> "+s[1]}return!0}return!1}constructor(e){super(null!=e?e:"","modify:")}}class T extends v{load(e){let t=new T(e);return""!=t.pattern?t:null}run(e,t){var n,s;if(""==this.pattern)return!1;if(this.getStack(e,t).endsWith(this.pattern)){let l=null!==(n=e[t].score)&&void 0!==n?n:0,a=null!==(s=e[t-1].score)&&void 0!==s?s:0;if(e[t].label==e[t-1].label)return e.splice(l>a?t-1:t,1),!0}return!1}constructor(e){super(null!=e?e:"","rmdup:")}}class y extends p{do(e){let t=e.replace(/\|/g,""),n=(t=t.replaceAll(/\[![!ibuc]+:\$(([^$]|\$[^\]])+)\$\]/g,"$1")).toLowerCase().trim().match(s.Constants.SECTION_PATTERN_LOWER.join("|")),l=null!=n&&n.length>0;if(l||(l=null!=(n=t.trim().match(s.Constants.SECTION_PATTERN_NORMAL.join("|")))&&n.length>0),l&&n){let e,n=/\s+([0-9ABCDEFIVX]+)\s*[.:]/g,s=t.matchAll(n).next();return s.done&&(n=/\s+([0-9ABCDEFIVX]+)\s*$/g,s=t.matchAll(n).next()),s.done||(e=s.value[1]),[{type:this.TYPE,pos:[0,0],label:t,extInfo:e}]}return[]}constructor(e){super(),null!=e&&(this.isOn=e),this.TYPE=y.TYPE_NAME}}y.TYPE_NAME="section";class I extends p{do(e){let t=this.matchPos(e);if(t.value){let n=null;for(let e=t.value.length-1;e>=0;e--)if(t.value[e]){n=t.value[e];break}if(null==n)return[];let s=e.replace(/\|/g,"").toLowerCase().indexOf(n),l=s,a="",o=e.toLowerCase();for((n.endsWith("(")||n.endsWith("["))&&(n=n.substring(0,n.length-1));l<o.length&&("|"!=o[l]&&(a+=o[l]),l++,a!=n););let d={type:this.TYPE,pos:[s,l]};return d.label=this.getNumberFromStr(e.substring(d.pos[0],d.pos[1])),d.olabel=n,[d]}return[]}matchPos(e){let t=e.replace(/\|/g,"").toLowerCase().trim(),n=s.Constants.QUESTION_PATTERN.join("|"),l=t.matchAll(n).next();return l.value||(n=s.Constants.QUESTION_PATTERN2.join("|"),l=t.matchAll(n).next()),l}getNumberFromStr(e){let t=e.match(/(\d+)/);return t?t[0]:""}constructor(e){super(),null!=e&&(this.isOn=e),this.TYPE=I.TYPE_NAME}}I.TYPE_NAME="question";class w extends p{do(e){var t;let n=[],s="|"+e,l=/([\s|.\]]+\*?[A-Ha-h][\s|]*[.)])/g,a=this.matchPos(s,l,!1);0==a.length&&(a=this.matchPos(s,l,!0));let o=!1;0==a.length&&/^\|?\s*\*?[A-H\s|]+$/g.test(s)&&(o=!0,a=this.matchPos(s,/\*?[A-H]/g,!1));let d=!1;if(0==a.length&&(o=!0,d=!0,a=this.matchPos(s,/\[\*?[A-H]:[^\]]+\]/g,!1)),a.length>0)for(let l of a){let a=l.index+l.value.length-1,h=-9999,c=l.value.replace(/\*?[\sA-Ha-h|]/g,"");d&&(h=l.index+l.value.length-2,l.index=l.index+1,a=l.index+1+(l.value.startsWith("[*")?1:0),c=".");let u={type:this.TYPE,pos:[l.index-1,a,h]},x=e.substring(u.pos[0]);if(!o&&!/^\|?\s*[*A-Himg\s|.]+$/g.test(s)&&x.trim()==l.value.trim())continue;u.label=e.substring(u.pos[0],u.pos[0]+1),"*"==u.label&&(u.label=e.substring(u.pos[0]+1,u.pos[0]+2),u.extInfo="*"),u.olabel=c,u.score=1,""==e.substring(0,u.pos[0]).replace(/[\s|]/g,"")&&(u.score=2);let p=e.replace(/\[![a-z0-9_]+:[a-z0-9_]+\]/g,"").trim().toUpperCase().replace("*",""),f=RegExp("^A\\s*"+(null===(t=u.olabel)||void 0===t?void 0:t.replace(/([.)])/,"\\$1")));(d||"A"!=u.label.toUpperCase()||f.test(p))&&n.push(u)}return n}matchPos(e,t,n){let s=n?e.toUpperCase():e,l=/[\s|.\]]/,a=s.matchAll(t),o=[];for(;;){let e=a.next();if(e.done)break;let t=0;for(let n=e.value.index;n<s.length&&l.test(s[n]);n++)t++;let n=e.value[0].substr(t,1),d=/[[(]\s*(VD|TH|NB|VDC|EASY|MEDIUM|HARD|HARDEST)\s*[\d.]*\s*[)\]]\s*[:.]?/g,h=/\[![a-z]+:\$\s*\$\]/g;("A"!=n||s.replace(/\|/g,"").replace(/\[!info:\d+\]/g,"").replace(d,"").replace(h,"").trim().startsWith("A"))&&("*A"!=n||s.replace(/\|/g,"").replace(/\[!info:\d+\]/g,"").replace(d,"").replace(h,"").trim().startsWith("*A"))&&o.push({value:e.value[0].substr(t),index:e.value.index+t})}return o}constructor(e){super(),null!=e&&(this.isOn=e),this.TYPE=w.TYPE_NAME}}w.TYPE_NAME="answer";class E extends p{do(e){return this.match(e,s.Constants.HUONGDAN_PATTERN)}constructor(e){super(),null!=e&&(this.isOn=e),this.TYPE=E.TYPE_NAME}}E.TYPE_NAME="huongdan";class A extends p{do(e){let t=e.replace(/\|/g,"").trim();if(/^\[@[^!\]]+\]([\.,]\[[^\]!]+\])*$/.test(t)){let e=t;return e=e.replaceAll(/\[@([CTQG]\d+):[^\]]*\]/g,"$1").replaceAll(/\[@(F:[^\]]*)\]/g,"$1").replaceAll(/\[[^\]\d]+(\d+)[^\]\d]+\]/g,"$1").replaceAll(/\[[^\]]+\]/g,""),[{type:this.TYPE,pos:[0,0],label:"@@."+e}]}return[]}constructor(e){super(),null!=e&&(this.isOn=e),this.TYPE=A.TYPE_NAME}}A.TYPE_NAME="include";class P{setLoadingManager(e){this.loadingManager=e}loadImage(e,t){return new Promise((n,s)=>{let l=o(10);this.loadingManager.set(l,e),(0,r.dr)(e,t).then(e=>{n(e),this.loadingManager.delete(l)}).catch(()=>{this.loadingManager.delete(l),s(Error())})})}loadImageToBase64(e,t){return new Promise((n,s)=>{let l=new Image;l.crossOrigin="anonymous",l.setAttribute("count","1");let a=o(10);this.loadingManager.set(a,e),l.onload=()=>{var e;let t=document.createElement("canvas");t.width=l.width,t.height=l.height,null===(e=t.getContext("2d"))||void 0===e||e.drawImage(l,0,0,l.width,l.height,0,0,t.width,t.height);let s=this.isCropImage?i.rj.cropCanvas(t):t;n("<img id='".concat(a,"' class='img-docx' alt='error...' src='").concat(s.toDataURL(),"' style='width: ").concat(s.width*this.ratioImage,"px;height: auto'>")),this.loadingManager.delete(a)},l.onerror=()=>{this.loadingManager.delete(a);let n=l.getAttribute("count");n&&1==Number(n)?(l.src=null!=e?e:t.getMyCdn(e),l.setAttribute("count","2")):n&&5>Number(n)?(l.setAttribute("count",n+1),l.src=null!=e?e:t.getMyCdn(e)+"?t="+new Date().getTime()):s(Error())},l.src=null!=e?e:t.getMyCdn(e)})}constructor(){this.isCropImage=!0,this.loadingManager=new Map,this.ratioImage=.65}}class Z extends P{findAttributes(e){let t={content:"",attr:[]};return t.content=e.replace(/(\w+)=["']?((?:.(?!["']?\s+=|\s*\/?[>"']))+.)["']?/g,e=>{let n=o(8);return t.attr.push({key:n,value:e}),n}),t}processMapException(e,t){return t.forEach(t=>{e=e.replace(t.key,t.value)}),e}render(e,t,n){if(e.trim().startsWith("[@"))return e;let s=this.findAttributes(e),l=e=s.content,a=this.chemBase.join("|"),o=RegExp("(?:[\\s,.:;\"'=–\\-\\/\\+\\?<>]|^)\\(?\\d*(".concat(a,")+\\d*(").concat(a,"|\\d+|\\(|\\))*(?:(?=[\\s,.:;\"'=–\\-\\/\\+\\?<>])|\\(\\w+\\)|$)"),"g"),d=l.matchAll(o),h=[];for(;;){let e=d.next();if(e.done)break;let t=0==e.value.index?e.value[0]:e.value[0].substring(1);t.replace("(","").replace(")","").length<=1||h.push({s:0==e.value.index?0:e.value.index+1,len:t.length,val:this.autoFormat(t)})}if(h.sort((e,t)=>e.s>t.s?-1:1),h.filter(e=>/\d+/.test(e.val)).length>0)for(let e of h)l=l.substring(0,e.s)+"\\("+e.val+"\\)"+l.substring(e.s+e.len);return this.processMapException(l,s.attr)}autoFormat(e){return e.replaceAll(/([^\(])(\d+)/g,"$1_{$2}")}constructor(){super(...arguments),this.chemBase=["H","He","Li","Be","B","C","N","O","F","Ne","Na","Mg","Al","Si","P","S","Cl","Ar","K","Ca","Sc","Ti","V","Cr","Mn","Fe","Co","Ni","Cu","Zn","Ga","Ge","As","Se","Br","Kr","Rb","Sr","Y","Zr","Nb","Mo","Tc","Ru","Rh","Pd","Ag","Cd","In","Sn","Sb","Te","I","Xe","Cs","Ba","La","Ce","Pr","Nd","Pm","Sm","Eu","Gd","Tb","Dy","Ho","Er","Tm","Yb","Lu","Hf","Ta","W","Re","Os","Ir","Pt","Au","Hg","Tl","Pb","Bi","Po","At","Rn","Fr","Ra","Ac","Th","Pa","U","Np","Pu","Am","Cm","Bk","Cf","Es","Fm","Md","No","Lr","Rf","Db","Sg","Bh","Hs","Mt","Ds","Rg","Cn","Nh","Fl","Mc","Lv","Ts","Og"]}}class S extends P{render(e,t,n){if(0>e.indexOf("[img:"))return e;let s=e,l=s.matchAll(/\[img:\$[a-zA-Z0-9_]+\$\]/g);for(;;){let e=l.next();if(e.done)break;let n=e.value[0],d=n.replace("[img:$","").replace("$]","");if(t){let e=t.find(e=>e.id===d);if(e){var a;let t=document.createElement("img");t.id=d,t.classList.add(0===d.indexOf("af")?"qv_full_a_img":0===d.indexOf("f")?"qv_full_img":"qv_img"),t.crossOrigin="anonymous",t.style.cssText=(null!==(a=e.cssStyle)&&void 0!==a?a:"").replace(/position:[^;]+;?/gi,"");let l=o(10),h=e.link;this.loadingManager.set(l,h),t.onload=()=>{this.loadingManager.delete(l)},t.onerror=()=>{this.loadingManager.delete(l)},t.src=h,s=s.replace(n,t.outerHTML)}}}return s}constructor(e){super(),this.cdnService=e}}class N extends P{render(e,t,n){let s=e,l=s.matchAll(/\[\*?[A-H]:[^\]]+\]/g);for(;;){let e=l.next();if(e.done)break;let t=e.value[0],n=t.substring(1,t.length-1).split(":");2==n[0].length&&(n[0]=n[0].substring(1)),s=s.replace(t,"<span class=\"qv_string_eng_ans\" style='cursor: pointer;padding: 0 5px;font-weight: bold;text-decoration: underline;position: relative;height: 40px;display: inline-block;'>".concat(n[1]," <span style='position: absolute;top: 20px;left: 45%;'>").concat(n[0],"</span></span>"))}return s}revert(e,t){let n=e;return(n=n.replaceAll(/<span class="qv_string_eng_ans"[^>]+>([^><]+)<span[^>]+>([^><]+)<\/span><\/span>/g,"[$2:$1]")).replace("["+t+":","[*"+t+":")}}class L extends P{trimWithBr(e){for(e=e.trim();/^<br>|<br>$/.test(e);)e=e.replace(/^<br>|<br>$/,"").trim();return e}render(e){let t=e,n=t.split("<br>"),s=0,l=/\[![!aibucsbphl]+:!!\]/;for(let e of n){if(l.test(e)){let t=e.split(":!!]")[0].split("["),a=t[t.length-1].split(":")[0];n[s]=e.startsWith("[*")?"[* ["+a+":$"+e.replace(l,"$]").substring(2):"["+a+":$"+e.replace(l,"$]")}s++}let a=(t=(t=n.join("<br>")).replaceAll(/\[![!aibucsbphl]+:\$\$\]/g,"")).matchAll(/\[![!aibucsbphl]+:\$(([^\$]|\$[^\]])+)\$\]/g);for(;;){let e=a.next();if(e.done)break;let n=e.value[0],s=e.value[1],l=n.split(":")[0].split("!");l.shift(),l.filter(e=>"a"==e).length>0&&(s=s.toUpperCase());for(let e=l.length-1;e>=0;e--){let t=l[e];s="hl"==t||"cl"==t?s:"<".concat(t,">").concat(s,"</").concat(t,">")}t=t.replace(n,s)}return this.trimWithBr(t)}}class k extends P{render(e,t,n){let s=e;for(let e of[[/([^<])-+([^\-><]+)-+>/g,"$1\\( \\xrightarrow[]{$2} \\)"],[/<-+([^\-><]+)-+([^>])/g,"\\( \\xleftarrow[]{$1} \\)$2"],[/([^<])--+>/g,"$1\\( \\longrightarrow \\)"],[/<--+([^>])/g,"\\( \\longleftarrow \\)$1"],[/<-+>/g,"\\( \\longleftrightarrow \\)"],[/([^<])->/g,"$1\\( \\rightarrow \\)"],[/<-([^>])/g,"\\( \\leftarrow \\)$1"]])s=s.replaceAll(e[0],e[1]);return s}}class _ extends P{render(e,t,n){let s=e.split("<br>"),l=[],a=[];for(let e of s){let t=e.replaceAll("\\|","__//__");if(t.trim().startsWith("[*")&&t.trim().endsWith("*]")){let e=t.replaceAll("\\n","<br>").replaceAll("[*","<tr><td>").replaceAll("*]","</td></tr>");e=e.replaceAll("|","</td><td>"),a.push(e)}else a.length>0&&(l.push('<table class="q-table">'+a.join("")+"</table>"),a=[]),l.push(t)}return a.length>0&&l.push('<table class="q-table">'+a.join("")+"</table>"),l.join("<br>").replaceAll("__//__","|")}static revert(e){let t=new DOMParser().parseFromString(e,"text/html").documentElement.querySelectorAll(".q-table"),n=e;for(let e=0;e<t.length;e++){let s=t[e],l=s.outerHTML,a=s.querySelectorAll("tr"),o=[];for(let e=0;e<a.length;e++){let t=[],n=a[e].querySelectorAll("td");for(let e=0;e<n.length;e++)t.push(n[e].innerHTML.trim());o.push(t)}let d=[];for(let e of o)d.push("[* "+e.join(" | ")+" *]");let h=d.join("\n");n=n.replace(l,h)}return n}}class M extends P{convertMath(e){var t=e.replace(/\>(log|tan)\</g,">\\$1<").replace(//g,"");return MathML2LaTeX.convert(t)}render(e,t,n){let s=e,l=s.matchAll(/\[!m:\$(([^\]]|[^\$]\])+)\$\]/g);for(;;){let e=l.next();if(e.done)break;let t=e.value[0],n=e.value[1],a=this.mathMap.get(n),o="",d=document.createElement("span");d.classList.add("ql-formula"),d.setAttribute("data-value",this.convertMath(a.str)),o=d.outerHTML,s=s.replace(t,o)}return s}constructor(e,t){super(),this.mathMap=e,this.commonService=t}}class R extends P{render(e,t,n){return this.bypassChild(e).replaceAll(/\\\)\s*\\\(/g,"")}bypassChild(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"\\(",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"\\)";if(t.length!==n.length)return"";let s=[],l=0;for(;;){let n=e.indexOf(t,l);if(-1===n)break;s.push("s_"+n),l=n+1}for(l=0;;){let t=e.indexOf(n,l);if(-1===t)break;s.push("e_"+t),l=t+1}s.sort(function(e,t){return parseInt(e.substr(2))-parseInt(t.substring(2))});let a=[],o=[];return s.forEach(e=>{if("s"===e.substring(0,1))a.push(parseInt(e.substring(2)));else if(1==a.length)a=[];else{let t=a.pop();if(t){let n=parseInt(e.substring(2));o.push(t),o.push(n)}}}),o.sort(function(e,t){return e-t}).reverse().forEach(n=>{e=e.substring(0,n)+e.substring(n+t.length)}),e}}class O extends P{render(e,t,n){var l,a,d,h;let c=e.split("<br>")[0].trim(),u=c.split("=>"),x=u.length>1?+u[1].split("-")[1]:0,p=u.length>1?+u[1].split("-")[0]:0;if(!this.callBack||!/^\[@[CTGK][\-\d]+:[^\]]+\]([\.,]\[[^\]]+\])+$/.test(u[0].trim())&&!/^\[@Q[\-\d]+:[^\]]+\](\s*,\s*\[@Q[\-\d]+:[^\]]+\])*$/.test(u[0].trim()))return e;let f=u[0]+"=>"+p,m=s.Utils.parseInclude(c);if(this.apiDataCache){let e=this.apiDataCache.get(c);if(e&&this.callBack)return setTimeout(()=>{e&&this.callBack&&this.callBack(e)},50),"Loading...|"+m.questId.join(",")}if(this.apiCallbackCache){let e={i:x,call:this.callBack,err:this.onError},t=this.apiCallbackCache.get(f);if(t)return t.push(e),"Loading...|"+m.questId.join(",");this.apiCallbackCache.set(f,[e])}let g=this.loadedQuestIds&&0==m.questId.length?this.loadedQuestIds:[];0==m.getNum&&m.groupId.length>0&&(m.getNum=1,g=m.questId.length>0?g:[]),this.getOne&&m.getNum&&m.getNum>1&&(m.getNum=1);let v=o(10);if(null===(l=this.matrixData)||void 0===l?void 0:l.filter(e=>e.key==f)[0])setTimeout(()=>{},400);else{this.loadingManager.set(v,c);let e={exceptQuestionIds:g,matrix:[]};null===(a=e.matrix)||void 0===a||a.push({number:m.getNum,key:f,paths:m.paths.map(e=>({type:e.type,id:e.id,groupIds:e.groupIds,tags:e.tags,answerTypes:e.answerTypes}))});let t=(null===(d=e.matrix)||void 0===d?void 0:d.filter(e=>{var t;return null!==(h=null===(t=e.paths)||void 0===t?void 0:t.filter(e=>"KNOWLEDGE"==e.type).length)&&void 0!==h&&h}).length)?null==n?void 0:n.apiQuestionsMatrixGlobalPost(e):null==n?void 0:n.apiQuestionsMatrixPost(e);t&&t.subscribe(e=>{1===e.success&&e.data&&e.data[0]&&e.data[0].questions&&e.data[0].questions.length>0&&e.data[0].questions,setTimeout(()=>{},400),this.loadingManager.delete(v)})}return"Loading...|"+m.questId}processImageQuestion(e,t,n){let s=t[0].metaData;if(s){let t={x:0,y:0,w:s.question.width,h:s.question.height},l=s.question.height;s.answers&&s.answers.forEach((s,a)=>{let o="";if(1!==s.width||1!==s.height){let n=this.cropImageWithPos({x:s.x,y:s.y,w:s.width,h:s.height},{x:s.remove.x,y:s.remove.y,w:s.remove.width,h:s.remove.height},e);n.classList.add("qv_ats_image"),l>s.y&&(t.h=s.y,l=s.y),o=n.outerHTML}n.answers.push({renderedStr:o,ans:n.quest.answers[a]})}),t.h<5&&(t.h=1,t.h=1);let a=this.cropImageWithPos(t,{x:s.question.remove.x,y:s.question.remove.y,w:s.question.remove.width,h:s.question.remove.height},e,!0);a.classList.add("qv_qts_image"),n.renderedStr=a.outerHTML,n.meta&&(n.meta.heightLabel=this.calculateHeightLabel(e,s.question.remove))}else n.renderedStr=e.outerHTML}cropImageWithPos(e,t,n,s,l){let a=document.createElement("canvas");a.width=e.w,a.height=e.h;let o=a.getContext("2d"),d=document.createElement("img");null==o||o.drawImage(n,e.x,e.y,e.w,e.h,0,0,e.w,e.h),o&&(o.fillStyle="#fff"),null==o||o.fillRect(t.x-e.x,t.y-e.y,t.w,t.h);let h=jr.rj.cropCanvas(a,void 0);return l?h:(d.src=h.toDataURL(),d.style.width=h.width*this.ratioImage+"px",d)}calculateHeightLabel(e,t){return this.cropImageWithPos({x:t.x,y:t.y,w:t.width,h:t.height},{x:0,y:0,w:0,h:0},e,!1,!0).height}constructor(e,t,n,s,l,a,o,d,h,c){var u;super(),this.cdnService=e,this.commonService=t,this.callBack=n,this.apiCallbackCache=s,this.editor=l,this.onError=a,this.loadedQuestIds=o,this.apiDataCache=d,this.matrixData=h,this.discoveryService=c,this.getOne=!1,this.trans={err_empty_quest:""},u="lang_auto_khong_tai_duoc_cau_hoi_tu_ngan_hang",this.trans.err_empty_quest=void 0!==u?u:""}}class H extends P{render(e,t,n,s){if(0>e.indexOf("@[]"))return s&&s(),e;let l,a=/@\[\]\{[^@]+\}@\[\]/g,d=e,h=new Map;for(;null!==(l=a.exec(e));){var c;let e=l[0],t=e.split("@[]")[1],n=this.commonService.willDeleteParseJson(t),s=n.link,a=o(10);d=d.replace(e,"<div id='".concat(a,"' class='img-docx skeleton-box-loading' style='width: ").concat(n.data.width*this.ratioImage,"px;height: ").concat(n.data.height*this.ratioImage,"px'></div>")),h.has(s)?null===(c=h.get(s))||void 0===c||c.push({id:a,data:n.data}):h.set(s,[{id:a,data:n.data}])}return this.startLoadImage(h).then(()=>{s&&s()}).catch(e=>{this.callbackFall&&this.callbackFall(e)}),d}startLoadImage(e){return new Promise((t,n)=>{var s=0;e.size>0?e.forEach((l,a)=>{this.loadImage(a,this.cdnService).then(a=>{if(this.processImageQuestion(a,l,n),this.loadingManager.delete(a.id),this.callBack)for(let e of l)this.callBack(e.id,e.renderStr);++s===e.size&&t()}).catch(()=>{let e=a.split("/");n(new r.l("LOAD_IMAGE",[e[e.length-1]],"lang_testbank_render_cant_download_the_image"))})}):t()})}processImageQuestion(e,t,n){t.forEach(t=>{try{var s;let n=document.createElement("canvas");t.data.width=-1===t.data.width?e.width:t.data.width,t.data.height=-1===t.data.height?e.height:t.data.height,n.width=t.data.width,n.height=t.data.height,null===(s=n.getContext("2d"))||void 0===s||s.drawImage(e,t.data.x,t.data.y,t.data.width,t.data.height,0,0,n.width,n.height);let l=this.isCropImage?i.rj.cropCanvas(n):n;l=this.isCanvasEmpty(l)?n:l,t.renderStr="<img id='".concat(t.id,"' class='img-docx' alt='error...' src='").concat(l.toDataURL(),"' style='width: ").concat(l.width*this.ratioImage,"px;height: auto'>")}catch(s){let t=e.src;return void n(new r.l("CROP_IMAGE",[t[t.length-1]],"Kh\xf4ng cắt được nội dung trong h\xecnh ảnh"))}})}isCanvasEmpty(e){let t=document.createElement("canvas");return t.width=e.width,t.height=e.height,e.toDataURL()===t.toDataURL()}constructor(e,t,n,s,l){super(),this.cdnService=e,this.commonService=t,this.configRenderService=n,this.callBack=s,this.callbackFall=l}}class B{run(e){for(let t of e)for(let e of(t.error=[],this.lstChecker)){let n=e.check(t);t.error.push(...n)}}constructor(){this.lstChecker=[new z]}}class F{}class z extends F{check(e){return"SC"!=e.typeCode&&"MC"!=e.typeCode||0!=e.answers.filter(e=>e.isCorrect).length?[]:[{type:"NO_ANS",msg:"ERR_NO_CORRECT_ANS",quickFix:["Bấm v\xe0o A, B, C hoặc D để chọn l\xe0m đ\xe1p \xe1n đ\xfang"]}]}}e.exports=class{parseDocx(e){this.getLstQuestWithFile(e,[]).then(e=>{this.convertDocx(e)})}convertDocx(e){let{lstQuest:t}=e,n=[],s=[];t.forEach((e,t)=>{let{quest:l}=e;if(l.isGroup)n.push({id:o(7),quizId:this.quizId,questions:[],content:e.renderedStr,title:"",audios:[]});else{var a,d,h,c,u,x,p,f,m,g;n.length||l.group||n.push({id:o(7),quizId:this.quizId,questions:[],content:"",title:"",audios:[]});let t=n[l.group-1||0],v={id:o(7),content:null!==(c=e.renderedStr)&&void 0!==c?c:"",quizId:this.quizId,groupId:t.id,label:"C\xe2u",number:l.label,type:(e=>{switch(e){case"MC":return"HK";case"SC":return"TN";case"FI":return"DT";case"ES":break;case"TF":return"TF"}return"TL"})(null!==(u=null==l?void 0:l.typeCode)&&void 0!==u?u:""),options:e.answers.map(e=>{var t;return{text:null!==(t=e.renderedStr)&&void 0!==t?t:"",keys:e.ans.isCorrect}}),explain:null!==(x=e.helpRenderedStr)&&void 0!==x?x:"",level:e.tag,shuffle:!!l.isFixAns};"DT"==v.type&&(v.options=(null!==(p=null==e?void 0:e.strAns)&&void 0!==p?p:[]).map(e=>({text:null==e?void 0:e.toString().trim()}))),"TF"==v.type&&(v.options=null===(f=e.answers)||void 0===f?void 0:f.map(e=>{var t;return{text:null!==(t=e.renderedStr)&&void 0!==t?t:"",keys:e.ans.isCorrect?"T":"F"}})),(null===(a=null===(d=null==e?void 0:null===(h=e.helpRenderedStr)||void 0===h?void 0:h.toString())||void 0===d?void 0:d.trim())||void 0===a?void 0:a.length)<5&&"TL"==v.type&&(v.type="DT",v.options.push({text:null===(m=null==e?void 0:null===(g=e.helpRenderedStr)||void 0===g?void 0:g.toString())||void 0===m?void 0:m.trim()})),t.questions.push(v.id),s.push(v)}}),s=s.map((e,t,n)=>{var l=0;return"TF"==e.type&&(l=1),"TN"==e.type&&(l=.25),"DT"==e.type&&(18==n.filter(e=>"TN"==e.type).length&&(l=.25),12==n.filter(e=>"TN"==e.type).length&&(l=.5)),s.length===n.filter(e=>"TN"==e.type).length&&(l=(10/s.length).toFixed(2)),{...e,point:l}}),this.callback({status:"done",data:{groups:n,questions:s,quizId:this.quizId}})}getLstQuestWithFile(e,t,n){return new Promise((l,a)=>{let o=new c(this.commonService),x=[],p=new Map,f=[],m=[],g=1;o.handleFileSelect(e,e=>{for(let t of e.data)if("img"==t.type)x.push({id:t.key,link:t.value,cssStyle:t.cssStyle}),t.cssStyle&&t.cssStyle.split(";").length>2&&f.push(["^\\[img:\\$".concat(t.key,"\\$\\]"),"[img:$".concat(t.key,"$]\n")]);else if("mathml"==t.type){let e=+t.key.split("_")[1];p.set(t.key,{id:e,str:t.value,raw:t.docx,lineIdx:0,startCol:0,endCol:0}),e>g&&(g=e)}for(let t of(g++,e.lines)){if(0==t.length)continue;let e="";for(let n of(e=Array.isArray(t[0])&&Array.isArray(t[t.length-1])&&Array.isArray(t[Math.floor(t.length/2)])?"[* "+t.map(e=>e.map(e=>e.join("").replaceAll("\n","\\n")).join("\\n")).join(" | ")+" *]":t.join(""),f))e=e.replaceAll(RegExp(n[0],"g"),n[1]);for(let t of e.split("\n"))m.push(t)}new d().process(m);let a=this.processStyle(m);this.processMath(a,p),new h().process(a);let o=new u(this.cropPdfParams);o.setLines(a);let c=o.parse(),v=new s.Task(2);for(let e=0;e<c.length;e++)v.addTask(this,this.renderQuest,[t,p,x,c[e],e,n]);v.start().then(e=>{setTimeout(()=>{l({lstQuest:t,mathMap:p,images:x})},10*x.length)})})})}fillImg(e,t,n,s){let l=RegExp("<div id='"+n+"'[^>]+></div>","g"),a=e[t];for(let e of(a.renderedStr=a.renderedStr.replace(l,null!=s?s:""),a.answers))e.renderedStr=e.renderedStr.replace(l,null!=s?s:"");a.helpRenderedStr&&(a.helpRenderedStr=a.helpRenderedStr.replace(l,null!=s?s:""))}fillError(e,t,n){e[t].err="<span style='color:red'>".concat(n,"</span>")}parseExtra(e){if(e.startsWith("[@"))return{val:"",idx:0,id:e};let t=e.matchAll(/\[!info:\d+\]/g),n="",s=0;for(;;){let e=t.next();if(e.done)break;n=e.value[0],s=e.value.index;break}if(""==n)return{val:"",idx:0,id:"0"};let l=n.replace("[!info:","").replace("]","").trim();return{val:n,idx:s,id:l}}upperFirst(e){return e?e.charAt(0).toUpperCase()+e.slice(1):""}getIncludeIds(e,t){return[]}renderStr(e,t,n,s,l,a,o,d){let h=!(arguments.length>8)||void 0===arguments[8]||arguments[8],c=h?s.replaceAll(/<([\/!a-zA-Z])/g,"&lt;$1").replaceAll(/&lt;([ubi])>/g,"<$1>").replaceAll(/&lt;[\/]([ubi])>/g,"</$1>").replaceAll("&lt;br>","<br>").replaceAll("<&lt;","&lt;&lt;").replaceAll("<&lt;","&lt;&lt;").replaceAll("<&lt;","&lt;&lt;"):s,u=[new Z,new S(this.cdnService),new N,new L,new k,new _,new M(t,this.commonService),new R,new H(this.cdnService,this.commonService,this.configRenderService,a),new O(this.cdnService,this.commonService,o,this.apiCallbackCache,this.aztEditor,d,this.getIncludeIds(e),this.apiDataCache,this.matrixLoadedData)];for(let e of("link"==l&&(u=[new H(this.cdnService,this.commonService,this.configRenderService,a)]),"help"==l&&u.pop(),u))e.setLoadingManager(this.loadingManager),c=e.render(c,n,this.questionService);return c}renderQuest(e,t,n,s,l,a){return new Promise(o=>{var d,h,c,u,x,p;let f=3;s.answers.length>0&&(f=1),0==s.answers.length&&s.strAns&&(f=4),"TF"==s.typeCode&&(f=5,s.answers.forEach(e=>{e.label=e.label.toLowerCase(),e.olabel=")"}));let m=(t,n)=>{this.fillImg(e,l,t,n)},g=e=>{},v=t=>{this.fillError(e,l,t)},b=s.parts.map(e=>null!==(d=e.text)&&void 0!==d?d:"").join("<br>").trim(),C=this.parseTag(b);""!=C[0]?o=b[1]:s.help&&s.help.length>0&&(C=this.parseTag(null!==(h=s.help[0].text)&&void 0!==h?h:""));let j=this.parseExtra(b);if("0"!=j.id){let e=this.extraMap.get(j.id);if(e&&e.replaceIdx>=0)return this.lstQuestReplace[e.replaceIdx]}""!=j.val&&(b=b.substring(0,j.idx)+b.substring(j.idx+j.val.length));let T=s.help?s.help.map(e=>null!==(c=e.text)&&void 0!==c?c:"").join("<br>").trim():void 0,y=this.findAnsSplit(null!==(u=s.strAns)&&void 0!==u?u:"",this.cropPdfParams.STRANS_SPLIT),I={renderedStr:this.renderStr(e,t,n,b,"full",m,g,v),quest:s,type:f,tag:""==C[0]?"NB":null!==(x=C[0])&&void 0!==x?x:"NB",strAns:s.strAns?s.strAns.split(y).map(e=>e.trim()):void 0,label:this.upperFirst(null!==(p=s.olabel)&&void 0!==p?p:""),helpRenderedStr:T?this.renderStr(e,t,n,T,"full",m,g,v):void 0,answers:s.answers.map(s=>{var l;let a=s.parts.map(e=>null!==(l=e.text)&&void 0!==l?l:"").join("<br>").trim();return{renderedStr:this.renderStr(e,t,n,a,"full",m,g,v),ans:s}})};if(I.renderedStr.startsWith("Loading...|")){let e=I.renderedStr.split("|");if(0>e[1].indexOf(",")){let t=+e[1];t>0&&(I.id=t)}I.renderedStr=e[0]}e[l]=I,a&&a(I),o(I)})}findAnsSplit(e,t){if(!t)return"|";for(let n=0;n<t.length;n++)if(e.indexOf(t[n])>=0)return t[n];return"|"}parseTag(e){let t=e.trim(),n=t.matchAll(/^(\[!info:\d+\]\s*)?(\[[iubchl!]+:\$\s*)?[\[\(]\s*(VD|TH|NB|VDC|EASY|MEDIUM|HARD|HARDEST)\s*[\d\.]*\s*[\)\]]/g).next();return n.done?["",t]:(t=t.replace(/[\[\(]\s*(VD|TH|NB|VDC|EASY|MEDIUM|HARD|HARDEST)\s*[\d\.]*\s*[\)\]]\s*[:.]?/g," "),[n.value[3],t])}processStyle(e){var t;let n=/\[![!ibuchl]+:\$(([^\$]|\$[^\]])+)\$\]/g,s=/^\s*\[\*\s*[AC]\.[^\|]+\|\s*[BD]\..*\*\]\s*$/g,l=[],a=0;for(let t of e){if(s.test(e[a].replaceAll(n,"$1"))&&(e[a]=e[a].replaceAll("[*","").replaceAll("*]","").replaceAll("|"," ").trim(),t=e[a]),t){let s,o=t.matchAll(n),d=0;for(;;){let e=o.next();if(e.done)break;let t=e.value[0],n=t.indexOf(":"),h=t.substring(1,n),c=e.value.index-d,u=c+e.value[1].length;s&&c==s.e&&s.style==h?s.e=u:(s={lineIdx:a,s:c,e:u,style:h},l.push(s)),d+=n+4}e[a]=t.replaceAll(n,"$1")}a++}let o=new u(this.cropPdfParams);o.setLines(e);let d=o.parse(),h=[],c=new Map,x=0;for(let t of d){for(let e of(x++,t.parts))h.push(e);for(let n of t.answers){let s=this.hasStyleAns(e,n.parts[0],l);for(let e of(""!=s&&c.set("".concat(t.label,"-").concat(t.group,"-").concat(n.label,"-").concat(x),s),n.parts))h.push(e)}}for(let e of d)if(e.help)for(let t of e.help)h.push(t);this.applyStyle(e,h,l),o.setLines(e);let p=[];for(let e of(x=0,d=null!==(t=o.parse())&&void 0!==t?t:[])){x++;let t=new Map;if(!(e.answers.filter(e=>e.isCorrect).length>0)){for(let n of e.answers){let s=c.get("".concat(e.label,"-").concat(e.group,"-").concat(n.label,"-").concat(x));s&&""!=s&&t.set(s,t.has(s)?void 0:n.parts[0])}for(let e of t)if(e[1]){p.push(e[1]);break}}}for(let t=p.length-1;t>=0;t--){let n=p[t];e[n.lineIdx]=e[n.lineIdx].substring(0,n.b)+"*"+e[n.lineIdx].substring(n.b)}return e=this.processUnderlineAns(e),d.length>0?e.slice(d[0].parts[0].lineIdx):e}processUnderlineAns(e){let t=/\[[!bihl]*[!u]+[!bihl]*:\$(([^\$]|\$[^\]])+)\$\]/g,n=0,s=[];for(let l of e){if(/^[ABCD\.\s\t\*]+$/.test(l)&&""!=l.trim()&&n>0){let a=l,o=(a=a.replaceAll(/[\s\t\.]+/g,"")).indexOf("*"),d=0;if(a=a.replaceAll(/[\*]+/g,""),"ABCDEFGH".indexOf(a)>=0){let l=e[n-1].match(t);if(l&&a.length==l.length){for(let t of l)e[n-1]=e[n-1].replace(t,t.replace(/\[[!bihl]*[!u]+[!bihl]*:\$/g,"[".concat(o==d?"*":"").concat(a.substring(0,1),":")).replace("$]","]")),s[s.length-1]=e[n-1],a=a.substring(1),d++;n++;continue}}}s.push(l),n++}return s}hasStyleAns(e,t,n){if(!t)return"";for(let e of n.filter(e=>e.lineIdx==t.lineIdx&&e.s<=t.b&&e.e>=t.b))if(e.style.indexOf("!u")>=0||e.style.indexOf("!b")>=0||e.style.indexOf("!hl")>=0)return e.style;return""}applyStyle(e,t,n){for(let l=t.length-1;l>=0;l--){let a=t[l],o=n.filter(e=>e.lineIdx==a.lineIdx&&e.e>=a.s);for(let t=o.length-1;t>=0;t--){var s;let n=o[t].s>=a.s?o[t].s:a.s,l=o[t].e<=(null!==(s=a.e)&&void 0!==s?s:9999999)?o[t].e:a.e,d=o[t].style.replaceAll("!hl","");if(n<l&&""!=d){let t=e[a.lineIdx],s=t.substring(n,l);""!=s.trim()&&(e[a.lineIdx]=t.substring(0,n)+"["+d+":$"+s+"$]"+t.substring(l))}}}}processMath(e,t){let n=0;for(let s of e){let e=s.matchAll(this.MATH_PAT);for(;;){let s=e.next();if(s.done)break;let l=s.value[0],a=t.get(s.value[1]);a&&(a.lineIdx=n+1,a.startCol=s.value.index+1,a.endCol=a.startCol+l.length)}n++}}constructor(e,t){this.quizId=e,this.callback=t,this.loadingManager=new Map,this.MATH_PAT=/\[!m:\$([^\$\]]+)\$\]/g,this.lstQuestReplace=[],this.extraMap=new Map,this.cropPdfParams={RENDER_SCALE:2,LINE_SMALL_HEIGHT:8,SPLIT_MARGIN:3,INTERSEC_MARGIN:10,LINE_MAGIN:2,MARGIN_LEFT:2,ENABLE_IMAGE_PROCESS:!0,STEP_SIZE:3,CROP_FULL_WIDTH:!0,OVERLAP:.5,QUESTION_PATTERN:["(^c\xe2u\\s*\\d{1,4}[^0-9])","(^câu\\s*\\d{1,4}[^0-9])","(^c\xe2u\\|*\\s*\\d{1,4}[^0-9])","(^câu\\|*\\s*\\d{1,4}[^0-9])","(^c\xa9u\\s*\\d{1,4}[^0-9])","(^ca‚u\\s*\\d{1,4}[^0-9])","(^b\xe0i\\s*\\d{1,4}[^0-9])","(^bài\\s*\\d{1,4}[^0-9])","(^cau\\s*\\d{1,4}[^0-9])","(^bai\\s*\\d{1,4}[^0-9])","(^question\\s*\\d{1,4}[^0-9])","(^questions\\s*\\d{1,4}[^0-9])","(^\\[\\d{1,4}\\][^0-9])","(^\\d+\\s*\\(nb\\))","(^\\d+\\s*\\(th\\))","(^\\d+\\s*\\(vd\\))","(^\\d+\\s*\\(vdc\\))","(^c\xe2u\\s*\\d{1,4}[\\s\\.:]*$)","(^câu\\s*\\d{1,4}[\\s\\.:]*$)","(^c\xa9u\\s*\\d{1,4}[\\s\\.:]*$)","(^ca‚u\\s*\\d{1,4}[\\s\\.:]*$)","(^b\xe0i\\s*\\d{1,4}[\\s\\.:]*$)","(^bài\\s*\\d{1,4}[\\s\\.:]*$)","(^cau\\s*\\d{1,4}[\\s\\.:]*$)","(^bai\\s*\\d{1,4}[\\s\\.:]*$)","(^questions\\s*\\d{1,4}[\\s\\.:]*$)","(^question\\s*\\d{1,4}[\\s\\.:]*$)"],QUESTION_PATTERN2:["(^(\\d+\\s*\\.)\\s*[\\.0-9])","(^(\\d+\\s*\\.)\\s*\\(\\s*\\d+\\s*\\))","(^(\\d+\\s*\\.)\\s*[^\\s])","(^\\d+\\s*\\.\\s*$)"],BREAK_LINE_PATTERN:["(^C\xe2u\\s*\\d+\\s*[:\\.]\\s*[Aa]\\s*\\.)","(^C\xa9u\\s*\\d+\\s*[:\\.]\\s*[Aa]\\s*\\.)","(^B\xe0i\\s*\\d+\\s*[:\\.]\\s*[Aa]\\s*\\.)","(^Cau\\s*\\d+\\s*[:\\.]\\s*[Aa]\\s*\\.)","(^Bai\\s*\\d+\\s*[:\\.]\\s*[Aa]\\s*\\.)","(^Question\\s*\\d+\\s*[:\\.]\\s*[Aa]\\s*\\.)","(^\\d+\\s*[:\\.]\\s*[Aa]\\s*\\.)"],SECTION_PATTERN_LOWER:["(^mark\\s*the\\s*letter)","(^read\\s*the\\s*follow)","(^reading\\s*the\\s*follow)","(^read\\s*the\\s*text)","(^read\\s*the\\s*passage)","(^read\\s*the\\s*paragraph)","(^read\\s*and\\s*choose)","(^put\\s*these\\s*word)","(^supply\\s*the\\s*correct)","(^make\\s*questions?\\s*for)","(^fill\\s*in\\s*the\\s*blank)","(^fill\\s*in\\s*each\\s*numbered)","(write\\s*the\\s*months\\s*in\\s*english)","(write\\s*the\\s*telephone\\s*numbers\\s*in\\s*english)","(^which\\s*of\\s*the\\s*following)","(^choose\\s*the\\s*suitable\\s*word)","(^choose\\s*the\\s*word)","(^choose\\s*the\\s*option)","(^choose\\s*the\\s*item\\s*among)","(^choose\\s*the\\s*underlined\\s*word)","(^combine\\s*two\\s*sentences)","(^each\\s*of\\s*the\\s*following)","(^finish\\s*the\\s*second\\s*sentence)","(^identify\\s*the\\s*underlined)","(^identify\\s*a\\s*mistake)","(^indicate\\s*the\\s*word)","(^indicate\\s*the\\s*correct)","(^indicate\\s*the\\s*sentence)","(^indicate\\s*the\\s*underlined)","(^circle\\s*the\\s*underlined)","(^circle\\s*the\\s*word\\s*whose\\s*underlined)","(^choose\\s*the\\s*underlined)","(^\\*?find\\s*the\\s*word)","(^find\\s*a\\s*mistake)","(^fill\\s*the\\s*circle)","(^listen\\s*to.*conversation)","(^there\\s*are.*blanks\\s*in\\s*the\\s*passage\\s*below)","(^listen\\s*to\\s*the\\s*recording)","(^listen\\s*to\\s*three\\s*people)","(^listen\\s*and\\s*circle)","(^listen\\s*again\\s*and\\s*choose)","(^\\*?listen\\s*and\\s*complete)","(^\\*?choose\\s*the\\s*best)","(^choose\\s*the\\s*correct)","(^put\\s*in\\s*the\\s*correct)","(^complete\\s*the\\s*second\\s*sentence)","(^complete\\s*the\\s*sentences)","(^give\\s*the\\s*correct\\s*form)","(^mark\\s*a,\\s*b,)","(^circle\\s*the\\s*letter)","(^you\\s*will\\s*hear)","(^blacken\\s*the\\s*letter)","(^đọc\\s*đoạn\\s*tr\xedch)","(^đọc\\s*đoạn\\s*văn\\s*sau\\s*v\xe0\\s*trả\\s*lời)","(^dựa\\s*v\xe0o\\s*th\xf4ng\\s*tin\\s*dưới\\s*đ\xe2y)","(^dựa\\s*v\xe0o\\s*c\xe1c\\s*th\xf4ng\\s*tin\\s*được\\s*cung\\s*cấp\\s*dưới\\s*đ\xe2y)","(^đọc\\s*th\xf4ng\\s*tin\\s*v\xe0\\s*trả\\s*lời)","(^section\\s*[0-9abcdefghivx]+)","(^part[^a-z]+[0-9abcdefghivx]+\\s*[\\.:\\-])","(^phần\\s*[0-9abcdefivx]+[\\.:])","(^phần\\s*[0-9abcdefivx]+\\s*$)","(^nh\xf3m\\s*[0-9abcdefivx]+[\\.:])","(^chương\\s*[0-9abcdefivx]+[\\.:])","(^questions?\\s*\\d+\\s*[\\–\\-to]+\\s*\\d+)","(^passage\\s*[0-9abcdefghivx]+)","(^use\\s*the\\s*word\\s*given\\s*in\\s*capitals)","(^tự\\s*luận)","(^[\\d]+[.]\\s*nhận\\s*biết)","(^[\\d]+[.]\\s*th\xf4ng\\s*hiểu)","(^[\\d]+[.]\\s*vận\\s*dụng)","(^[\\d]+[.]\\s*vận\\s*dụng\\s*cao)","(^chủ\\s*đề\\s*\\d*:)"],SECTION_PATTERN_NORMAL:["(^[IVX]+\\s*[\\.\\-\\–]\\s*[A-Z\xc0Ả\xc3\xc1ẠĂẰẲẴẮẶ\xc2ẦẨẪẤẬĐ\xc8ẺẼ\xc9Ẹ\xcaỀỂỄẾỆ\xccỈĨ\xcdỊ\xd2Ỏ\xd5\xd3Ọ\xd4ỒỔỖỐỘƠỜỞỠỚỢ\xd9ỦŨ\xdaỤƯỪỬỮỨỰỲỶỸ\xddỴ]+)","(^[\\d]+\\.[\\d]+\\.[\\d]*\\.*\\s*[A-Z\xc0Ả\xc3\xc1ẠĂẰẲẴẮẶ\xc2ẦẨẪẤẬĐ\xc8ẺẼ\xc9Ẹ\xcaỀỂỄẾỆ\xccỈĨ\xcdỊ\xd2Ỏ\xd5\xd3Ọ\xd4ỒỔỖỐỘƠỜỞỠỚỢ\xd9ỦŨ\xdaỤƯỪỬỮỨỰỲỶỸ\xddỴ]+)","(^[IVX]+\\s*[\\.:]\\s*$)"],KICK_PATTERN:["(^Chọn\\s*[ABВCDEFGHIJK]+)","(^Chon\\s*[ABВCDEFGHIJK]+)"],TVCN_CHAR:[["Α","A"],["В","B"]],HET_PATTERN:["(HẾT)","(H\xcáT)","(HET)","(\\-\\-HT\\-\\-)","(THE\\s*END)","(The\\s*end[^a-z0-9]*$)","(^[^A-Za-z]*Hết[^A-Za-z]*)$"],DAPAN_PATTERN:["(\xc1P \xc1N)","(\xc1P \xc1)","(\xc1P\xc1N)","(ÁP ÁN)","(BẢNG\xc1\xc1)","(KHO\xc1\\s*C\xc2U\\s*TRẮC\\s*NGHIỆM)","(ÁPÁN)","(ANSWER KEYS)","(^KEYS$)","(Bảng\\s*đ\xe1p\\s*\xe1n)","(Đ\xe1p\\s*\xe1n\\s*v\xe0\\s*hướng)","(Dap\\s*an\\s*va\\s*huong)","(Đ\xe1p\\s*\xe1n\\s*[.:]\\s*$)","(Đ\xe1p\\s*\xe1n\\s*$)"],HUONGDAN_PATTERN:["(HƯỚNG\\s*DẪN)","(ƯỚNG\\s*DẪN\\s*GIẢI\\s*CHI)","(GIẢI\\s*TH\xcdCH\\s*CHI\\s*TIẾT)","(Hướng\\s*dẫn\\s*giải)","(Lời\\s*giải)","(Trả\\s*lời)","(LỜI\\s*GIẢI)","(GIẢI\\s*CHI\\s*TIẾT)","(HD:)","(GLOSSARY)"],MULTIPLE_ANS_PATTERN:["([ABCDEFGH]\\s*v\xe0\\s*[ABCDEFGH]\\s*đều)","(Cả\\s*[ABCDEFGH]\\s*v\xe0\\s*[ABCDEFGH])","(Cả\\s*[ABCDEFGH]\\s*,\\s*[ABCDEFGH])","(Cả\\s*3\\s*đ\xe1p\\s*\xe1n)","(Cả\\s*đ\xe1p\\s*\xe1n)","(Tất\\s*cả\\s*đ\xe1p\\s*\xe1n)","(Kết\\s*quả\\s*kh\xe1c)","(Đ\xe1p\\s*\xe1n\\s*kh\xe1c)","(Đ\xe1p\\s*\xe1n\\s*[ABCDEFGH]\\s*v\xe0\\s*[ABCDEFGH])","(Tất\\s*cả\\s*đều)"],DRAW_RESULT:"",SKIP_CHAR:["","√","p","(",")","[","]","{","}",""],FOOTER_PATTERN:["(trang\\s*\\d+)","(Page\\s*\\d+)","(Trang\\s*\\d+)","(TRANG\\s*\\d+)","(^\\d{1,4}$)","(^[\\-\\s]*\\d{1,4}[\\-\\s]*$)"],HELP_ANS_PATTERN:["([\\s\\.]*Chọn\\s*:?\\s*([A-K])[^A-Za-z0-9]*$)","([\\d\\s\\.:]*Đ\xe1p\\s*\xe1n\\s*l\xe0\\s*:?\\s*([A-K])[^A-Za-z0-9]*$)","([\\d\\s\\.:]*Chọn\\s*đ\xe1p\\s*\xe1n\\s*:?\\s*([A-K])[^A-Za-z0-9]*$)","([\\d\\s\\.:]*Đ\xe1p\\s*\xe1n\\s*đ\xfang\\s*:?\\s*([A-K])[^A-Za-z0-9]*$)","([\\d\\s\\.:]*Đ\xe1p\\s*\xe1n\\s*:?\\s*([A-K])[^A-Za-z0-9]*$)","([\\d\\s\\.:]*Đ\xe1p\\s*\xe1n\\s*l\xe0\\s*:?\\s*(.+)\\.\\s*$)","([\\d\\s\\.:]*Đ\xe1p\\s*\xe1n\\s*đ\xfang\\s*:?\\s*(.+)\\.\\s*$)","([\\d\\s\\.:]*Đ\xe1p\\s*\xe1n\\s*:?\\s*(.+)\\.\\s*$)","([\\d\\s\\.:]*Đ\xe1p\\s*\xe1n\\s*l\xe0\\s*:?\\s*(.+)$)","([\\d\\s\\.:]*Đ\xe1p\\s*\xe1n\\s*đ\xfang\\s*:?\\s*(.+)$)","([\\d\\s\\.:]*Đ\xe1p\\s*\xe1n\\s*:?\\s*(.+)$)","(([aA][.,\\)]\\s*[ĐSđsdD][\\s|]*[bB][.,\\)]\\s*[ĐSđsdD][\\s|]*[cC][.,\\)]\\s*[ĐSđsdD][\\s|]*[dD][.,\\)]\\s*[ĐSđsdD]))"],GROUP_TF_PATTERN:["(trắc nghiệm đ\xfang[\\s\\\\\\/]*sai)"],FIX_NO_END_PATTERN:["(^\\[\\*\\s*\\d+[.-]?\\s*[A-D]\\s*\\|(\\s*\\d+[.-]?\\s*[A-D]\\s*\\|?)+\\*\\]$)"],RES_ANS_PATTERN:["(\\d+[.-][^|0-9])"],STRANS_SPLIT:"|/\\"}}}},4521:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n(8754),n(3401);let s=n(1117);class l{on(){this.isOn=!0}off(){this.isOn=!1}process(e,t,n,s,l,a){return this.isOn?this.parse(e,t,n,s,l,a):[]}constructor(){this.isOn=!0,this.TYPE="default"}}class a extends l{parse(e,t,n,s,l,a){var o=this.matchPos(t.strLine);if(o.value){let e=null;for(let t=o.value.length-1;t>=0;t--)if(o.value[t]){e=o.value[t];break}if(null==e)return[];let s=e.matchAll(/\d+/g).next(),d=e.length;s.done||e.trim().endsWith(".")||e.trim().endsWith(":")||(d=s.value.index+s.value[0].length);let h=t.strLine.replace(/\|/g,"").toLowerCase().indexOf(e)+d-1;return[{str:this.getNumberFromStr(e),pageIndex:t.pageIndex,lineIndex:n,transform:t.transform,startLeft:g.calIndexPos2(t.textObjs,l,a,h,!0),type:this.TYPE}]}return[]}matchPos(e){let t=e.replace(/\|/g,"").toLowerCase().trim();if(0==this.questType){let e=s.PdfConst.QUESTION_PATTERN.join("|");return t.matchAll(e).next()}{let e=s.PdfConst.QUESTION_PATTERN2.join("|");return t.matchAll(e).next()}}getNumberFromStr(e){var t=e.match(/(\d+)/);return t?t[0]:""}static getRemoveBox(e,t){let n=e.startLeft?e.startLeft[5]:t[e.lineIndex].top,l=e.transform[4]-s.PdfConst.MARGIN_LEFT,a=e.startLeft?e.startLeft[5]+e.startLeft[3]:t[e.lineIndex].bottom;return{pageIndex:e.pageIndex,top:n||20,left:l,heigh:a&&n?a-n:0,width:(e.startLeft?e.startLeft[4]:0)-l}}static getBoxes(e,t,n,l){let a=l;for(let n=e.lineIndex;n<t.length;n++)if(g.isLastLineOfPage(n,t)){let e=t[n].isFooter?t[n-1]:t[n];a=e.transform[5]+e.height+20;break}let o=[],d=e.pageIndex,h=n?n.lineIndex:t.length-1,c=t[e.lineIndex].transform[4]-s.PdfConst.MARGIN_LEFT,u=t[e.lineIndex].top;if(!u)return[];let x=s.PdfConst.CROP_FULL_WIDTH?g.getMaxLineRight(-1,t)+2*s.PdfConst.MARGIN_LEFT:t[e.lineIndex].transform[4]+t[e.lineIndex].width+2*s.PdfConst.MARGIN_LEFT,p=a,f=d,m=e.lineIndex+1;for(;m<=h;m++){let e=t[m].top;if(m!=t.length-1||n||(e=t[m].bottom),!s.PdfConst.CROP_FULL_WIDTH){let e=t[m-1].transform[4]+t[m-1].width+2*s.PdfConst.MARGIN_LEFT;e>x&&(x=e)}let l=t[m-1].transform[4]-s.PdfConst.MARGIN_LEFT;l<c&&(c=l),t[m].isFooter&&e?p=e:(t[m].pageIndex>f&&(t[m-1].isFooter||(p=a),o.push({pageIndex:f,top:u,left:c,width:x-c,heigh:p-u}),u=20,c=g.getMinLineLeft(t[m].pageIndex,t)-s.PdfConst.MARGIN_LEFT),f=t[m].pageIndex,e&&(p=e))}if(m-=1,!n&&g.isLastLineOfPage(m,t)){let e=t[m].isFooter?t[m-1]:t[m];p=e.transform[5]+e.height+20}return g.isFirstLineOfPage(m,t)||o.push({pageIndex:f,top:u,left:c,width:x-c,heigh:p-u}),o}constructor(e){super(),this.TYPE=a.TYPE_NAME,this.questType=e}}a.TYPE_NAME="question";class o extends l{parse(e,t,n,l,o,d){let h=t.strLine.replace(/\|/g,"").toLowerCase().trim().match(s.PdfConst.SECTION_PATTERN_LOWER.join("|")),c=null!=h&&h.length>0;if(c||(c=null!=(h=t.strLine.replace(/\|/g,"").trim().match(s.PdfConst.SECTION_PATTERN_NORMAL.join("|")))&&h.length>0),c&&h){let s=t.strLine.indexOf(h[0])+h[0].length+1,l=[h[0][0]];for(let t=e.length-1;t>=0;t--){if(e[t].type==a.TYPE_NAME){l.push(".Q");break}l.push(e[t].str[0])}return"HGFEDCBA.Q".endsWith(l.join(""))?[]:[{str:h[0],pageIndex:t.pageIndex,lineIndex:n,transform:t.transform,startLeft:g.calIndexPos(t.textObjs,o,d,s,!0),type:this.TYPE}]}return[]}static getRemoveBox(e,t){let n=t[e.lineIndex].top,l=e.transform[4]-s.PdfConst.MARGIN_LEFT,a=t[e.lineIndex].bottom;return{pageIndex:e.pageIndex,top:n||20,left:l,heigh:a&&n?a-n:0,width:l-l}}static getBoxes(e,t,n,l){let a=[],o=e.pageIndex,d=n?n.lineIndex:t.length-1,h=g.getMinLineLeft(-1,t)-s.PdfConst.MARGIN_LEFT,c=t[e.lineIndex].top;if(!c)return[];let u=g.getMaxLineRight(-1,t)+2*s.PdfConst.MARGIN_LEFT,x=l,p=o,f=e.lineIndex+1;for(;f<=d;f++){let e=t[f].top;if(t[f].isFooter&&e)x=e;else if(t[f].pageIndex>p&&(a.push({pageIndex:p,top:c,left:h,width:u-h,heigh:x-c}),c=20),p=t[f].pageIndex,e){x=e;break}}return f>=t.length&&(f=t.length-1),g.isFirstLineOfPage(f,t)||a.push({pageIndex:p,top:c,left:h,width:u-h,heigh:x-c}),a}constructor(){super(),this.TYPE=o.TYPE_NAME}}o.TYPE_NAME="section";class d extends l{parse(e,t,n,s,l,a){var o=[],d=this.matchPos(t.strLine,!1);if(0==d.length&&(d=this.matchPos(t.strLine,!0)),d.length>0)for(let e of d)o.push({str:e.value,pageIndex:t.pageIndex,lineIndex:n,transform:g.calIndexPos(t.textObjs,l,a,e.index),startLeft:g.calIndexPos2(t.textObjs,l,a,e.index+1),type:this.TYPE});return o}static getRemoveBox(e,t){let n=e.startLeft?e.startLeft[5]-2:t[e.lineIndex].top,l=e.transform[4]-s.PdfConst.MARGIN_LEFT,a=e.startLeft?e.startLeft[5]+e.startLeft[3]:t[e.lineIndex].bottom;return{pageIndex:e.pageIndex,top:n||20,left:l,heigh:a&&n?a-n:0,width:(e.startLeft?e.startLeft[4]:0)-l}}static getBoxes(e,t,n,l){let a=s.PdfConst.MARGIN_LEFT,o=[],h=t[e.lineIndex].top,c=t[e.lineIndex].bottom;if(!h||!c)return[];let u=c,x=e.transform[4]-a,p=n&&e.lineIndex==n.lineIndex?n.transform[4]-a:t[e.lineIndex].transform[4]+t[e.lineIndex].width+a;if(o.push({pageIndex:e.pageIndex,top:h,left:x,width:p-x,heigh:c-h}),n&&n.lineIndex==e.lineIndex)return o;h=c,c=l,p=0;let f=e.pageIndex,m=0;for(m=e.lineIndex+1;m<t.length;m++){if(c==l&&g.isLastLineOfPage(m,t)){let e=t[m].isFooter?t[m-1]:t[m];c=e.transform[5]+e.height+20}let n=t[m].top;if(m>e.lineIndex+1&&!t[m-1].isFooter){let e=t[m-1].transform[4]+t[m-1].width+a;e>p&&(p=e);let n=t[m-1].transform[4]-a;n<x&&(x=n)}if(t[m].isFooter&&n)m-e.lineIndex>1?(c=t[m-1].transform[5]+t[m-1].height+s.PdfConst.LINE_MAGIN,x=t[e.lineIndex+1].transform[4]-a):c=t[e.lineIndex].bottom;else if(t[m].pageIndex>f&&(c&&c-h>s.PdfConst.LINE_SMALL_HEIGHT&&m-e.lineIndex>1&&o.push({pageIndex:f,top:h,left:x,width:p-x,heigh:c-h}),u=h=20),f=t[m].pageIndex,n){c=n;break}}if(m>=t.length&&(m=t.length-1),m-e.lineIndex>1&&t[m-1].transform[5]>u&&!g.isFirstLineOfPage(m,t)){let n=20==h?t[m].transform[4]:t[e.lineIndex+1].transform[4];c&&c-h>s.PdfConst.LINE_SMALL_HEIGHT&&o.push({pageIndex:f,top:h,left:n,width:p-n,heigh:c-h})}n&&n.type==d.TYPE_NAME&&n.transform[4]>t[n.lineIndex].transform[4]+25*s.PdfConst.RENDER_SCALE&&(p=n.transform[4]-a,h=t[n.lineIndex].top,x=t[n.lineIndex].transform[4]-a,c=t[n.lineIndex].bottom,h&&c&&c-h>s.PdfConst.LINE_SMALL_HEIGHT&&o.push({pageIndex:f,top:h,left:x,width:p-x,heigh:c-h}));for(let e=o.length-1;e>=1;e--)o[e].left-(o[e-1].left+o[e-1].width)>=20*s.PdfConst.RENDER_SCALE&&o.splice(e,1);return o}matchPos(e,t){for(var n=t?e.toUpperCase():e,l=s.PdfConst.ANS_PATTERN,a=RegExp("[\\s\\|\\.]"),o=n.matchAll(l),d=[];;){var h=o.next();if(h.done)break;for(var c=0,u=h.value.index;u<n.length&&a.test(n[u]);u++)c++;let e=h.value[0].substr(c,1);("A"!=e||n.replace(/\|/g,"").trim().startsWith("A"))&&d.push({value:e,index:h.value.index+c})}return d}constructor(){super(),this.TYPE=d.TYPE_NAME}}d.TYPE_NAME="answer";class h extends l{parse(e,t,n,l,a,o){let d=t.strLine.replace(/\|/g,"").trim().match(s.PdfConst.HET_PATTERN.join("|"));return null!=d&&d.length>0?[{str:t.strLine,pageIndex:t.pageIndex,lineIndex:n,transform:t.transform,type:this.TYPE}]:[]}static getBoxes(e,t,n,s){return[]}strContains(e,t){for(let n of t)if(e.indexOf(n)>=0)return!0;return!1}constructor(e){super(),null!=e&&(this.isOn=e),this.TYPE=h.TYPE_NAME}}h.TYPE_NAME="het";class c extends l{parse(e,t,n,l,a,o){let d=t.strLine.replace(/\|/g,"").trim().match(s.PdfConst.DAPAN_PATTERN.join("|"));return null!=d&&d.length>0?[{str:t.strLine,pageIndex:t.pageIndex,lineIndex:n,transform:t.transform,type:this.TYPE}]:[]}static getBoxes(e,t,n,s){return[]}static getAnsFromHelp(e){for(let t of e){let e=t.strLine.replace(/\|/g,"").trim().match(s.PdfConst.HELP_ANS_PATTERN.join("|"));if(null!=e){for(let t=0;t<e.length;t++)if(null!=e[t]&&1==e[t].length)return e[t]}}return""}strContains(e,t){for(let n of t)if(e.indexOf(n)>=0)return!0;return!1}constructor(e){super(),null!=e&&(this.isOn=e),this.TYPE=c.TYPE_NAME}}c.TYPE_NAME="dapan";class u extends l{parse(e,t,n,l,a,o){let d=t.strLine.replace(/\|/g,"").trim().match(s.PdfConst.HUONGDAN_PATTERN.join("|"));return null!=d&&d.length>0?[{str:t.strLine,pageIndex:t.pageIndex,lineIndex:n,transform:t.transform,type:this.TYPE}]:[]}static getBoxes(e,t,n,s){return a.getBoxes(e,t,n,s)}strContains(e,t){for(let n of t)if(e.indexOf(n)>=0)return!0;return!1}constructor(){super(),this.TYPE=u.TYPE_NAME}}u.TYPE_NAME="huongdan";class x extends l{parse(e,t,n,s,l,a){var o=t.strLine.replace(/\|/g,"").replace(/\s*\.*\-*:*,*;*/g,"");return o=(o=(o=(o=(o=o.replace(/C\xe2u/g,"")).replace(/\u0110\xe1p\xe1n/g,"")).replace(/\u0110\xe1p/g,"")).replace(/\xe1n/g,"")).replace(/\u0110\/A/g,""),/^[0-9ABCDEFGHabcdefgh]+$/g.test(o)&&o.length>=2&&(null==this.firstLine&&(this.firstLine=t,this.lineIdx=n),this.str+=o),[]}static getBoxes(e,t,n,s){return[]}getResult(e){let t=[],n="",s=[],l=!1;for(let t=0;t<e.length;t++){let a=e.charCodeAt(t),o=a>=65&&a<=72;if(o&&""==n)return[];o!=l&&(s.push(n),n=""),l=o,n+=e[t]}""!=n&&s.push(n);for(let e=1;e<s.length;e+=2){let n=0,l=Math.floor(s[e-1].length/s[e].length),a=+s[e-1].substr(n,l),o=a;for(let d=0;d<s[e].length;d++){if(d>=s[e-1].length||(a=+s[e-1].substr(n,l))!=o)return[];t.push({num:a,str:s[e][d]}),n+=l,l=(o=a+1).toString().length}}return t}on(){super.on(),this.firstLine=null,this.lineIdx=0,this.str=""}off(){if(super.off(),this.offCalback&&this.firstLine){var e=this.getResult(this.str.toUpperCase());if(e.length>0){let t=JSON.stringify({main:e,sub:[]});this.offCalback([{str:t,pageIndex:this.firstLine.pageIndex,lineIndex:this.lineIdx,transform:this.firstLine.transform,type:this.TYPE}])}}this.firstLine=null,this.str=""}constructor(e,t){super(),this.firstLine=null,this.lineIdx=0,this.str="",this.TYPE=x.TYPE_NAME,null!=e&&(this.isOn=e),this.offCalback=t}}x.TYPE_NAME="dapanchitiet";class p extends l{parse(e,t,n,l,a,o){if(!t.isLastLine||l&&t.transform[5]<l.transform[5]+l.height)return[];var d=t.strLine.replace(/\|/g,"").trim().match(s.PdfConst.FOOTER_PATTERN.join("|"));return null!=d&&d.length>0?[{str:d[0],pageIndex:t.pageIndex,lineIndex:n,transform:t.transform,type:this.TYPE}]:[]}static getBoxes(e,t,n,s){return[]}constructor(){super(),this.TYPE=p.TYPE_NAME}}p.TYPE_NAME="footer";class f extends l{parse(e,t,n,s,l,a){for(let o of[new p,new u])if(o.parse(e,t,n,s,l,a).length>0)return[];var o=t.strLine;return null==this.firstLine&&(this.firstLine=t,this.lineIdx=n),this.str+=o+"\n",[]}static getBoxes(e,t,n,s){return[]}getResult(e){let t=[],n=e.replace(/\n/g,"\n|"),l=s.PdfConst.QUESTION_PATTERN.join("|").replace(/\(\^/g,"(\\|"),a=n.matchAll(RegExp(l,"ig"));for(;;){let e=a.next();if(e.done)break;let t=e.value[0],s=this.getNumberFromStr(t);n=n.replace(t,s+".")}let o,d=n.matchAll(/\d+[\.\-]/g),h=-1;for(;;){let e=d.next();if(e.done)break;if(-1==h)h=e.value.index,o=e;else{let s=n.substr(h,e.value.index-h);t.push(this.toAns(s,o)),h=e.value.index,o=e}}if(h>=0&&o){let e=n.substr(h);t.push(this.toAns(e,o))}return t}toAns(e,t){let n=t.value[0].length;return{num:+t.value[0].substr(0,n-1),str:e.substr(n).replace(/\|/g," ").replace(/ +/g," ").trim()}}getNumberFromStr(e){var t=e.match(/(\d+)/);return t?t[0]:""}on(){super.on(),this.firstLine=null,this.lineIdx=0,this.str=""}off(){if(super.off(),this.offCalback&&this.firstLine){var e=this.getResult(this.str);if(e.length>0){let t=JSON.stringify({main:[],sub:e});this.offCalback([{str:t,pageIndex:this.firstLine.pageIndex,lineIndex:this.lineIdx,transform:this.firstLine.transform,type:this.TYPE}])}}this.firstLine=null,this.str=""}constructor(e,t){super(),this.firstLine=null,this.lineIdx=0,this.str="",this.TYPE=f.TYPE_NAME,null!=e&&(this.isOn=e),this.offCalback=t}}f.TYPE_NAME="dapandientu";class m{getErrorQtns(e){var t=[];for(let n=0;n<e.length;n++)!e[n].isGroup&&0==e[n].answers.length&&(e[n].strAns&&void 0!==e[n].strAns||t.push(e[n].num));return t}sumHighTo(e,t){let n=0,s=t.filter(e=>!e.inactive);for(let t=0;t<e;t++)n+=Math.round(s[t].heigh);return n}maxWidthTo(e,t){let n=[],s=t.filter(e=>!e.inactive);for(let t=0;t<e;t++)n.push(s[t].width);return Math.round(Math.max(...n))}constructor(e){this.commonService=e,this.fillColor=(e,t,n,s,l,a)=>{t.fillStyle=e,t.fillRect(Math.round(n),Math.round(s),Math.round(l),Math.round(a))},this.drawRect=(e,t,n,s,l,a)=>{t.beginPath(),t.lineWidth=1,t.strokeStyle=e,t.rect(Math.round(n),Math.round(s),Math.round(l),Math.round(a)),t.stroke()},this.getSingleImgData=(e,t)=>{var n,s;if(e.inactive){let e=null!==(n=this.commonService.myTranslateInstant("lang_auto_khong_xac_dinh_duoc_vung_thong_tin"))&&void 0!==n?n:"";throw this.commonService.snackError(e),Error(e)}try{let n=document.createElement("canvas");return n.width=0==e.width?2:Math.round(e.width),n.height=0==e.heigh?2:Math.round(e.heigh),null===(s=n.getContext("2d"))||void 0===s||s.drawImage(t[e.pageIndex].canvas,Math.round(e.left),Math.round(e.top),n.width,n.height,0,0,n.width,n.height),n.toDataURL("image/png")}catch(e){return console.log(e),"https://via.placeholder.com/300"}},this.getScatteredImgData=(e,t)=>{let n=e.filter(e=>!e.inactive);if(e.filter(e=>e.inactive).length==e.length){var s;let e=null!==(s=this.commonService.myTranslateInstant("lang_auto_khong_xac_dinh_duoc_vung_thong_tin"))&&void 0!==s?s:"";throw this.commonService.snackError(e),Error(e)}try{let e=document.createElement("canvas"),s=n.map(e=>e.width);e.width=Math.round(Math.max(...s));let l=0;for(let e=0;e<n.length;e++)l+=n[e].heigh;e.height=Math.round(l);let a=e.getContext("2d");for(let e=0;e<n.length;e++)null==a||a.drawImage(t[n[e].pageIndex].canvas,Math.round(n[e].left),Math.round(n[e].top),Math.round(n[e].width),Math.round(n[e].heigh),0,0==e?0:this.sumHighTo(e,n),Math.round(n[e].width),Math.round(n[e].heigh));return e.toDataURL("image/png")}catch(e){return console.log(e),"https://via.placeholder.com/300"}}}}class g{static drawPoint(e,t,n){null!=e&&(e.fillStyle=t,e.beginPath(),e.arc(n.left,n.top,5,0,2*Math.PI),e.fill())}static drawBox(e,t,n,s){null!=e&&(s?(e.fillStyle=t,e.beginPath(),e.rect(n.left,n.top,n.width,n.heigh),e.fill()):(e.strokeStyle=t,e.beginPath(),e.rect(n.left,n.top,n.width,n.heigh),e.stroke()))}static drawBox2(e,t,n,s,l){null!=e&&(e.strokeStyle=t,e.beginPath(),e.rect(l[4],l[5],n,s),e.stroke())}static drawLine(e,t,n,s){null!=e&&(e.strokeStyle=t,e.beginPath(),e.moveTo(n,s),e.lineTo(e.canvas.width-10,s),e.stroke())}static drawText(e,t,n,s){null!=e&&(e.font="11px Arial",e.fillStyle=t,e.fillText(s,n[4],n[5]))}static isLineIntersec(e,t){let n=e.transform[5]<=t.transform[5]&&t.transform[5]<=e.transform[5]+e.height,l=t.transform[5]<=e.transform[5]&&e.transform[5]<=t.transform[5]+t.height,a=e.transform[4]<=t.transform[4]&&t.transform[4]<=e.transform[4]+e.width+s.PdfConst.INTERSEC_MARGIN,o=t.transform[4]<=e.transform[4]&&e.transform[4]<=t.transform[4]+t.width+s.PdfConst.INTERSEC_MARGIN,d=this.isSameLine(e,t);return(n||l)&&(a||o)&&!d}static isLineVIntersec(e,t){return(e.transform[5]<=t.transform[5]&&t.transform[5]<=e.transform[5]+e.height||t.transform[5]<=e.transform[5]&&e.transform[5]<=t.transform[5]+t.height)&&(e.transform[4]<=t.transform[4]&&t.transform[4]<=e.transform[4]+e.width+s.PdfConst.INTERSEC_MARGIN||t.transform[4]<=e.transform[4]&&e.transform[4]<=t.transform[4]+t.width+s.PdfConst.INTERSEC_MARGIN)&&Math.abs(t.transform[4]-e.transform[4])>s.PdfConst.INTERSEC_MARGIN/2}static isSameLine(e,t){return Math.abs(e.transform[5]+e.height-(t.transform[5]+t.height))<=s.PdfConst.LINE_MAGIN}static isObjIntersec(e,t){return e.transform[5]<=t.transform[5]&&t.transform[5]<=e.transform[5]+e.height||t.transform[5]<=e.transform[5]&&e.transform[5]<=t.transform[5]+t.height}static isObjFullIntersec(e,t){return(e.transform[5]<=t.transform[5]&&t.transform[5]<=e.transform[5]+e.height||t.transform[5]<=e.transform[5]&&e.transform[5]<=t.transform[5]+t.height)&&(e.transform[4]<=t.transform[4]&&t.transform[4]<=e.transform[4]+e.width||t.transform[4]<=e.transform[4]&&e.transform[4]<=t.transform[4]+t.width)}static isFirstLineOfPage(e,t){return!(e<0||e>=t.length||0!=e&&t[e-1].pageIndex==t[e].pageIndex)}static isLastLineOfPage(e,t){return!(e<0||e>=t.length||e!=t.length-1&&t[e+1].pageIndex==t[e].pageIndex)}static getTopLine(e,t,n){let l=n[t];for(let a of[[s.PdfConst.STEP_SIZE,s.PdfConst.OVERLAP],[1,s.PdfConst.OVERLAP],[1,.3]]){let o=a[0],d=a[1],h=l.transform[5],c=0,u=3*o;if(!g.isFirstLineOfPage(t,n)){let e=g.isSameLine(n[t-1],l);g.isLineIntersec(n[t-1],l)?(h=n[t-1].transform[5]+n[t-1].height,c=n[t-1].transform[5],n[t-1].transform[4]>n[t].transform[4]+2*s.PdfConst.MARGIN_LEFT?c-=2*s.PdfConst.MARGIN_LEFT:c+=n[t-1].height*d,o=1,u=n[t].transform[5]+n[t].height/2-h):(c=e&&t-2>=0?n[t-2].transform[5]+n[t-2].height*d:n[t-1].transform[5]+n[t-1].height*d,e&&g.isFirstLineOfPage(t-1,n)&&(c=0))}if(!s.PdfConst.ENABLE_IMAGE_PROCESS)return[h,0];let x=!1;for(;h>c;){if(!g.hasColor(e,l.transform[4],h,l.width,o))return[h,0];x||(x=!0,h+=u),h-=o}}return[l.transform[5],1]}static arrContains(e,t){for(let n of t)if(n==e)return!0;return!1}static getBottomLine(e,t,n){let l=n[t];for(let a of[[s.PdfConst.STEP_SIZE,s.PdfConst.OVERLAP],[1,s.PdfConst.OVERLAP],[1,.3]]){let o=a[0],d=a[1],h=l.transform[5]+l.height,c=9999,u=3*o;if(!g.isLastLineOfPage(t,n)){let e=g.isSameLine(n[t+1],l);g.isLineIntersec(n[t+1],l)?(h=n[t+1].transform[5],c=n[t+1].transform[5]+n[t+1].height,n[t+1].transform[4]>n[t].transform[4]+2*s.PdfConst.MARGIN_LEFT?c+=2*s.PdfConst.MARGIN_LEFT:c-=n[t+1].height*d,u=n[t].transform[5]+n[t].height/2-h):(c=e&&t+2<n.length?n[t+2].transform[5]+n[t+2].height-n[t+2].height*d:n[t+1].transform[5]+n[t+1].height-n[t+1].height*d,e&&g.isLastLineOfPage(t+1,n)&&(c=9999));let a=n[t+1].top;if(a&&h>=a&&!e)return[a,0]}if(!s.PdfConst.ENABLE_IMAGE_PROCESS)return[h,0];let x=!1;for(;h<c;){if(!g.hasColor(e,l.transform[4],h,l.width,o))return[h,0];x||(x=!0,h-=u),h+=o}}return[l.transform[5]+l.height,1]}static hasColor(e,t,n,s,l){let a=Math.round(t),o=Math.round(a+s),d=Math.round(n),h=Math.round(d+l);for(let t=d;t<h;t++)for(let n=a;n<o;n++){let s=4*(t*e.width+n);if((e.data[s]+e.data[s+1]+e.data[s+2])/3<150)return!0}return!1}static calIndexPos2(e,t,n,l,a){let o=[],d=0,h=0,c=0,u=0,x=0,p=0,f=!0,m=!0;for(let b of e){m=this.isObjIntersec(e[0],b),u=b.transform[4],a||(d+=u-c>s.PdfConst.SPLIT_MARGIN&&""!=b.str.trim()||x!=b.transform[5]?1:0),f=u+2*s.PdfConst.MARGIN_LEFT>=c;let C=b.transform[4]+b.width;if(m&&(c=C),C>h&&m&&(h=C),(d+=b.str.length)>l&&f&&m){b.transform.forEach(e=>{o.push(e)}),o[3]=b.height,o[2]=p,o[1]=b.str.length-d+l;let e=b.str.substr(0,b.str.length-d+l+1);if(e.length==b.str.length){o[4]=o[4]+b.width;break}var g=t[b.fontName].fontFamily,v=Math.hypot(b.transform[2],b.transform[3]);n.font="".concat(v,"px ").concat(g);let s=n.measureText(e).width,a=n.measureText(b.str).width;o[4]=o[4]+b.width*s/a;break}m&&(x=b.transform[5]),p++}return 0==o.length&&(o=[0,e[e.length-1].length-1,e.length-1,e[0].height,h,e[0].transform[5]]),o}static calIndexPos(e,t,n,l,a){let o=[],d=0,h=0,c=0,u=0,x=0,p=0,f=!0,m=!0;for(let b of e){m=this.isObjIntersec(e[0],b),u=b.transform[4],a||(d+=u-c>s.PdfConst.SPLIT_MARGIN&&""!=b.str.trim()||x!=b.transform[5]?1:0,u-c>s.PdfConst.SPLIT_MARGIN&&""!=b.str.trim()||b.transform[5],b.str),f=u+2*s.PdfConst.MARGIN_LEFT>=c;let C=b.transform[4]+b.width;if(m&&(c=C),C>h&&m&&(h=C),(d+=b.str.length)>l&&f&&m){let e=b.str.substr(0,b.str.length-d+l);var g=t[b.fontName].fontFamily,v=Math.hypot(b.transform[2],b.transform[3]);n.font="".concat(v,"px ").concat(g);let s=n.measureText(e).width,a=n.measureText(b.str).width;b.transform.forEach(e=>{o.push(e)}),o[4]=o[4]+b.width*s/a,o[3]=b.height,o[2]=p,o[1]=b.str.length-d+l;break}m&&(x=b.transform[5]),p++}return 0==o.length&&(o=[0,e[e.length-1].length-1,e.length-1,e[0].height,h,e[0].transform[5]]),o}static getTextBottom(e,t,n,s){let l=Math.atan2(e[1],e[0]);t.vertical&&(l+=Math.PI/2);let a=Math.hypot(e[2],e[3]),o=a*g.getAscent(t.fontFamily,n,s);e[5];let d=0,h=0*(d=0===l?o:o*Math.cos(l));return[e[5]-d-h,a+h]}static getAscent(e,t,n){let s=n.get(e);if(s)return s;t.save(),t.font="30px ".concat(e);let l=t.measureText(""),a=l.fontBoundingBoxAscent,o=Math.abs(l.fontBoundingBoxDescent);if(a){t.restore();let s=a/(a+o);return n.set(e,s),s}t.strokeStyle="red",t.clearRect(0,0,30,30),t.strokeText("g",0,0);let d=t.getImageData(0,0,30,30).data;o=0;for(let e=d.length-1-3;e>=0;e-=4)if(d[e]>0){o=Math.ceil(e/4/30);break}t.clearRect(0,0,30,30),t.strokeText("A",0,30),d=t.getImageData(0,0,30,30).data,a=0;for(let e=0,t=d.length;e<t;e+=4)if(d[e]>0){a=30-Math.floor(e/4/30);break}if(t.restore(),a){let t=a/(a+o);return n.set(e,t),t}return n.set(e,.8),.8}static getMaxLineRight(e,t){let n=0;for(let s of t)if(s.pageIndex==e||-1==e){let e=s.transform[4]+s.width;e>n&&(n=e)}return n}static getMinLineLeft(e,t){let n=99999;for(let s of t)if(s.pageIndex==e||-1==e){let e=s.transform[4];e<n&&(n=e)}return n}}class v{loadPdf(e,t){var n=URL.createObjectURL(e);let s=pdfjsLib.getDocument({url:n,cMapPacked:!0,cMapUrl:"/assets/js/pdf-js-v2/cmaps/",disableAutoFetch:!1,disableFontFace:!1,disableRange:!1,disableStream:!1,docBaseUrl:"",enableXfa:!0,fontExtraProperties:!1,isEvalSupported:!0,maxImageSize:-1,pdfBug:!1,standardFontDataUrl:"/assets/js/pdf-js-v2/standard_fonts/",verbosity:1});var l=[];let a=this;s.promise.then(function(e){a.optionalContentConfigPromise=e.getOptionalContentConfig();for(var n=e._pdfInfo.numPages,s=1;s<=n;s++)e.getPage(s).then(e=>{l.push(e),l.length==n&&t(l=l.sort((e,t)=>e._pageIndex>t._pageIndex?1:-1))})},function(e){console.error(e)})}getImages(e,t){let n=[];if("function"!=typeof e.objs.getAll)return console.log("Unable to read img"),n;let s=e.objs.getAll();for(let e of Object.keys(s))s[e].data.pageIndex=t,n.push(s[e].data);return n}isImageObj(e){return -999==e.transform[0]&&"img"==e.str}getLines(e,t,n,l){let a=l.scale,o=e.items.length;for(let t=0;t<o;t++){let s=e.items[t];this.isImageObj(s)||(s.transform=v.transform(l.transform,s.transform),s.width=s.width*a),s.transform[4]+s.width>n.canvas.width&&(s.width=n.canvas.width-s.transform[4]-20);let o=this.isImageObj(s)?[s.transform[5],s.height]:g.getTextBottom(s.transform,e.styles[s.fontName],this.tempCanvas,this.ascentCache);s.height=o[1];let d=Math.ceil(o[0]);s.transform[5]=d}e.items.sort((e,t)=>1e6*Math.floor(e.transform[5])-e.transform[4]<1e6*Math.floor(t.transform[5])-t.transform[4]?-1:1);let d,h=[],c=0;this.imageCache[t]?d=this.imageCache[t]:(d=n.getImageData(0,0,n.canvas.width,n.canvas.height),this.imageCache[t]=d);var u={strLine:"",transform:[],textObjs:[],pageIndex:t,width:0,height:0,txtLength:0};for(let n=0;n<o;n++){let l=e.items[n];if(this.isImageObj(l)){for(let t=0;t<o;t++)if(n!=t&&g.isObjIntersec(l,e.items[t])){l.str="";break}}if(g.arrContains(l.str.trim(),s.PdfConst.SKIP_CHAR))continue;let a=Math.floor(l.transform[5]+l.height);0!=c?c-a>=-s.PdfConst.LINE_MAGIN?this.addTxtToLine(u,l):0!=u.textObjs.length&&(h.push(u),c=Math.floor((u=this.newLine(l,t)).transform[5]+u.height)):c=Math.floor((u=this.newLine(l,t)).transform[5]+u.height)}for(let e of(h.push(u),h))this.calculateSize(e);for(let e of(this.findAndMergeAnsQuestBlock(h,"ans"),this.findAndMergeAnsQuestBlock(h,"quest"),this.findAndMergeBlock(h),this.mergeIntersecLine(h),this.mergeSmallLine(h,d),h))this.calculateSize(e);return h}mergeIntersecLine(e){let t=0;for(;t<e.length;){let n=e[t];++t<e.length&&g.isLineVIntersec(n,e[t])&&(this.mergeLine(n,e[t]),e.splice(t,1),t--)}}findAndSplitQuestAnsLine(e,t,n){let l=0,a=[],o=s.PdfConst.BREAK_LINE_PATTERN.join("|");for(let t of e){t.top=void 0,t.bottom=void 0;var d=t.strLine.replace(/\|/g,"").trim().match(o);if(null!=d&&d.length>0){let e=/[\s\|\.]+[B\u0412][\s\|]*\./g,n=t.strLine.trim().toUpperCase().match(e);if(null!=n&&n.length>0){let e=d[0].toUpperCase().indexOf("A");a.push({lineIndex:l,strIndex:e})}}l++}for(let s=a.length-1;s>=0;s--){let l=a[s].lineIndex;this.splitLine(l,t[e[l].pageIndex],n[e[l].pageIndex],a[s].strIndex,e)}}mergeSmallLine(e,t){let n=0,l=1.2*s.PdfConst.LINE_SMALL_HEIGHT;for(;n<e.length;){let s=e[n];if(!s||!this.isSmallLine(s)){n++;continue}n-1>=0&&!e[n-1].bottom&&(e[n-1].bottom=g.getBottomLine(t,n-1,e)[0]),n+1<e.length&&!e[n+1].top&&(e[n+1].top=g.getTopLine(t,n+1,e)[0]);let a=n-1<0?-9999:this.getLineTop(s)-this.getLineBot(e[n-1]),o=n+1>=e.length?-9999:this.getLineTop(e[n+1])-this.getLineBot(s),d=n-1>=0&&e[n-1].transform[4]<=s.transform[4]&&s.transform[4]<=e[n-1].transform[4]+e[n-1].width,h=n+1<e.length&&e[n+1].transform[4]<=s.transform[4]&&s.transform[4]<=e[n+1].transform[4]+e[n+1].width;if(0==n&&o<=l&&h){this.mergeLine(e[n+1],s),e.splice(n,1),n--;continue}if(n==e.length-1&&a<=l&&d){this.mergeLine(e[n-1],s),e.splice(n,1),n--;continue}let c=-1;a>o&&h&&o<=l?c=n+1:a<=o&&d&&a<=l?c=n-1:a<=o&&h&&o<=l?c=n+1:a>o&&d&&a<=l&&(c=n-1),c>=0?(this.mergeLine(e[c],s),e.splice(n,1),n--):n++}}isSmallLine(e){return e.height<s.PdfConst.LINE_SMALL_HEIGHT}mergeLine(e,t){for(let n of t.textObjs)this.addTxtToLine(e,n)}findAndMergeAnsQuestBlock(e,t){let n=0;for(;n<e.length;){if("ans"==t&&this.isAnsLine(e[n])||"quest"==t&&this.isQuestLine(e[n])){let s=n,l=-1,a=1,o=[];for(;a<=10;){if((s=n+l*a)<0){l=1,a=1;continue}if(s>=e.length)break;let d=this.isAnsLine(e[s]),h=d||this.isQuestLine(e[s]),c="ans"==t&&d&&g.isSameLine(e[n],e[s]),u=!h&&g.isLineIntersec(e[n],e[s])&&e[s].transform[4]>e[n].transform[4];if((c||u)&&o.push(s),a++,h&&1==l)break;(a>10||h)&&-1==l&&(l=1,a=1)}for(let t of(o.sort((e,t)=>e<t?1:-1),o))for(let s of e[t].textObjs)this.addTxtToLine(e[n],s);for(let t of o)e.splice(t,1),t<n&&n--}n++}}findAndMergeBlock(e){let t=0;for(;t<e.length;){if(this.isAnsLine(e[t])||this.isQuestLine(e[t])){t++;continue}let n=t+1;for(;n<e.length&&e[t].pageIndex==e[n].pageIndex;){let s=this.isAnsLine(e[n])||this.isQuestLine(e[n]);if(g.isLineIntersec(e[t],e[n])&&!s||g.isSameLine(e[t],e[n])){for(let s of e[n].textObjs)this.addTxtToLine(e[t],s);e.splice(n,1),n=t}n++}t++}}isAnsLine(e){let t=e.strLine.trim().match(/[\s\|\.]+[AB\u0412CDEFGHIJK]\s*\./g);return null!=t&&t.length>0}isQuestLine(e){let t=s.PdfConst.QUESTION_PATTERN.join("|"),n=e.strLine.replace(/\|/g,"").toLowerCase().trim().match(t);return null!=n&&n.length>0}encodeLines(e,t){let n="",l=0;for(let a of t){if(a.height<s.PdfConst.LINE_SMALL_HEIGHT){l-1>=0&&!t[l-1].bottom&&(t[l-1].bottom=g.getBottomLine(e,l-1,t)[0]),l+1<t.length&&!t[l+1].top&&(t[l+1].top=g.getTopLine(e,l+1,t)[0]);let o=l-1<0?-9999:this.getLineTop(a)-this.getLineBot(t[l-1]),d=l+1>=t.length?-9999:this.getLineTop(t[l+1])-this.getLineBot(a),h=l-1>=0&&t[l-1].transform[4]<=a.transform[4]&&a.transform[4]+a.width<=t[l-1].transform[4]+t[l-1].width,c=l+1<t.length&&t[l+1].transform[4]<=a.transform[4]&&a.transform[4]+a.width<=t[l+1].transform[4]+t[l+1].width,u=1.2*s.PdfConst.LINE_SMALL_HEIGHT;Math.abs(o)>=u&&Math.abs(d)>=u?n+="L":n+=-9999==o?"3":-9999==d?"4":o>d&&c?"2":o<=d&&h?"1":o<=d&&c?"2":o>d&&h?"1":"L"}else n+="L";l++}return n}getLineTop(e){return e.top?e.top:e.transform[5]}getLineBot(e){return e.bottom?e.bottom:e.transform[5]+e.height}splitLine(e,t,n,s,l){let a=l[e],o=g.calIndexPos(a.textObjs,t,n,s,!0),d=this.newLine(a.textObjs[0],a.pageIndex),h=o[2],c=o[1],u=a.textObjs[h],x=u.transform,p={str:u.str.substr(0,c),width:o[4]-x[4],height:u.height,fontName:u.fontName,transform:[x[0],x[1],x[2],x[3],x[4],x[5]]},f={str:u.str.substr(c),width:u.width-p.width,height:u.height,fontName:u.fontName,transform:[x[0],x[1],x[2],x[3],o[4],x[5]]},m=a.textObjs;a.textObjs=[],d.textObjs=[];for(let e=0;e<m.length;e++)e<h?this.addTxtToLine(a,m[e]):e>h?this.addTxtToLine(d,m[e]):(this.addTxtToLine(a,p),this.addTxtToLine(d,f));return this.calculateSize(a),this.calculateSize(d),e==l.length-1?l.push(d):l.splice(e+1,0,d),d}findAndMergeSmallLine(e,t,n){let s=0,l=e.matchAll(n),a=[];for(;;){let e=l.next();if(e.done)break;let n=e.value[0],o=e.value.index,d=0,h=[];for(let e=0;e<n.length;e++)"L"==n[e]?d=o+e:h.push(o+e);for(let e of h){for(let n of t[e].textObjs)this.addTxtToLine(t[d],n);t[d].top=void 0,t[d].bottom=void 0,a.push(e)}s++}for(let e of(a.sort((e,t)=>e<t?1:-1),a))t.splice(e,1);return s}newLine(e,t){let n={strLine:"",transform:[],textObjs:[],pageIndex:t,width:0,height:0,txtLength:0};return n.transform[4]=e.transform[4],n.transform[5]=e.transform[5],n.height=e.height,n.width=e.width,n.txtLength=e.str.length,n.textObjs.push(e),n}addTxtToLine(e,t){t.transform[4]<e.transform[4]&&(e.transform[4]=t.transform[4]),t.transform[5]<e.transform[5]&&(e.transform[5]=t.transform[5]),t.transform[5]+t.height>e.transform[5]+e.height&&(e.height=t.transform[5]+t.height-e.transform[5]),t.transform[4]+t.width>e.transform[4]+e.width&&(e.width=t.transform[4]+t.width-e.transform[4]),e.txtLength+=t.str.length,e.textObjs.push(t);let n=e.transform[4]+e.width,s=e.height;for(let t of e.textObjs)t.transform[4]+t.width>n&&(n=t.transform[4]+t.width),t.transform[5]+t.height>e.transform[5]+s&&(s=t.transform[5]+t.height-e.transform[5]);e.width=n-e.transform[4],e.height=s}static transform(e,t){return pdfjsLib.Util.transform(e,t)}render(e,t,n,s){for(var l,a=e.length,o=0;o<a;o++){var d=document.createElement("div");d.className="pdf-page",d.id="page-"+o,null===(l=document.getElementById(t))||void 0===l||l.appendChild(d),this.renderPage(e[o],n,s)}}calculateSize(e){if(0==e.textObjs.length)return;e.textObjs.sort((e,t)=>1e6*Math.floor(e.transform[4])+e.transform[5]>1e6*Math.floor(t.transform[4])+t.transform[5]?1:-1),e.strLine="";let t=0,n=0,l=0,a=0,o=9999,d=0,h=9999;for(let c of e.textObjs){let u=g.isObjIntersec(e.textObjs[0],c),x=(l=c.transform[4])-n>s.PdfConst.SPLIT_MARGIN&&""!=c.str.trim()||a!=c.transform[5]?"|":"";e.strLine+=x+c.str,l<h&&(h=l);let p=c.transform[4]+c.width;u&&(n=p),p>t&&u&&(t=p),u&&(a=c.transform[5]),c.transform[5]<o&&(o=c.transform[5]),c.transform[5]+c.height>d&&(d=c.transform[5]+c.height)}e.transform[4]=h,e.transform[5]=o,e.width=t-h,e.height=d-o,e.transform[0]=o,e.transform[1]=d;let c=s.PdfConst.TVCN_CHAR,u=e.strLine;for(let e of c)u=u.replace(RegExp(e[0],"g"),e[1]);e.strLine=u}renderPage(e,t,n){var s=e._pageIndex,l=e.getViewport({scale:t});let a=.8*l.width;var o=document.createElement("canvas"),d=document.getElementById("page-"+s);null==d||d.appendChild(o),o.id="canvas"+s;var h=o.getContext("2d",{alpha:!1});o.height=l.height,o.width=l.width,o.style.height=l.height*a/l.width+"px",o.style.width=a+"px",d&&(d.style.width=o.style.width,d.style.height=o.style.height);let c={canvasContext:h,transform:[1,0,0,1,0,0],viewport:l,annotationMode:pdfjsLib.AnnotationMode.ENABLE_FORMS,optionalContentConfigPromise:this.optionalContentConfigPromise,annotationCanvasMap:new Map,pageColors:{background:"Canvas",foreground:"CanvasText"}};e.render(c).promise.then(function(){n&&n(h,e._pageIndex,l)})}constructor(){let e=document.createElement("canvas");this.tempCanvas=e.getContext("2d"),this.ascentCache=new Map,this.imageCache=[]}}e.exports=class{get totalNumberQuestion(){return this.questionList.filter(e=>e.tempData.isSelect&&e.answers.length).length}updateStatusCallback(e){}onCompleteCallback(e,t){e.length>0?(this.startQuestion=e[0].num,this.labelHolderSize.width=2*t[0].canvas.width,this.rootQuestionInfo=e,this.rootCanvases=t.map(e=>e.canvas),this.rootHeaderPosition={pageIndex:0,top:1,left:e[0].positions[0].left,width:e[0].positions[0].left+e[0].positions[0].width<t[0].canvas.width?e[0].positions[0].width:t[0].canvas.width-e[0].positions[0].left,heigh:e[0].positions[0].top-1},this.processData()):(this.errAnalyzingPdf=!0,this.isShowLoadingFileExam=!1)}cloneCanvas(){let e=this.rootCanvases;for(let t=0;t<e.length;t++){let n=e[t],s=document.createElement("canvas");s.width=n.width,s.height=n.height;let l=document.createElement("canvas");l.width=n.width,l.height=n.height;let a=s.getContext("2d");null==a||a.drawImage(n,0,0,n.width,n.height,0,0,n.width,n.height);let o=l.getContext("2d");null==o||o.drawImage(n,0,0,n.width,n.height,0,0,n.width,n.height),a&&o&&this.clonedCtxForCreate.push(o)}}processData(){this.questionList=[],this.abcdLabelPos={},this.groupImages={},this.totalInGroupTracking=0,this.questionLabelMap=[],this.groupLengths=[],this.countGroup=0,this.labelsUrls=[],this.labelsBase64s=[],this.firstInGroupIndexes=[],this.clonedCtxForCreate=[],this.cloneCanvas();let e=this.clonedCtxForCreate[0].canvas.width;this.rootQuestionInfo.forEach(t=>{t.positions.forEach(t=>{t.width+t.left>e&&(t.width=e-t.left)})});let t=this.rootQuestionInfo,n=this.clonedCtxForCreate;t.forEach(e=>{e.remove.heigh=Math.round(e.remove.heigh),e.remove.width=Math.round(e.remove.width),e.remove.top=Math.round(e.remove.top),e.remove.left=Math.round(e.remove.left),e.positions.forEach(e=>{e.heigh=Math.round(e.heigh),e.width=Math.round(e.width),e.top=Math.round(e.top),e.left=Math.round(e.left)}),e.help&&(e.help.remove&&(e.help.remove.heigh=Math.round(e.help.remove.heigh),e.help.remove.width=Math.round(e.help.remove.width),e.help.remove.left=Math.round(e.help.remove.left),e.help.remove.top=Math.round(e.help.remove.top)),e.help.positions.forEach(e=>{e.heigh=Math.round(e.heigh),e.width=Math.round(e.width),e.top=Math.round(e.top),e.left=Math.round(e.left)})),e.answers.length>0&&e.answers.forEach(e=>{e.remove.heigh=Math.round(e.remove.heigh),e.remove.width=Math.round(e.remove.width),e.remove.top=Math.round(e.remove.top),e.remove.left=Math.round(e.remove.left),e.positions.forEach(e=>{e.heigh=Math.round(e.heigh),e.width=Math.round(e.width),e.top=Math.round(e.top),e.left=Math.round(e.left)})})});let s=document.createElement("canvas");s.width=this.labelHolderSize.width,s.height=this.labelHolderSize.height;let l=s.getContext("2d"),a=0,o=()=>{l&&(this.labelsBase64s[a]=l.canvas.toDataURL("image/png"),a++,l.clearRect(0,0,l.canvas.width,l.canvas.height)),h.left=0,h.top=0},d=0,h={left:0,top:0,locate:0},c=[],u=e=>{let t=!0;for(let n=0;n<e.length;n++)if(1==e[n].remove.width||1==e[n].remove.heigh){t=!1;break}return t};t.forEach(e=>{c.push(e.answers.length)});for(let e=0;e<t.length;e++)if(u(t[e].answers)&&t[e].answers.length==Math.max(...c)){t[e].answers.forEach(e=>{null==l||l.drawImage(n[e.remove.pageIndex].canvas,e.remove.left,e.remove.top,e.remove.width,e.remove.heigh,h.left,h.top,e.remove.width,e.remove.heigh),this.abcdLabelPos[e.label]={left:h.left,top:h.top},h.left=h.left+e.remove.width+5});break}this.examHeader=this.cropperService.getSingleImgData(this.rootHeaderPosition,n);for(let e=0;e<t.length;e++){let s={isFixAns:t[e].isFixAns?1:0,forcedFixAns:!!t[e].isFixAns,groupType:0,original:"",debugView:"",group:t[e].group,groupUrl:this.groupImages["image_group_".concat(t[e].group)]?this.groupImages["image_group_".concat(t[e].group)]:"",question:{label:t[e].num,posit:{top:0,left:0,locate:0},url:"",urlExcludeLabelOnly:"",width:1,height:1,remove:{x:1,y:1,width:1,height:1,url:this.cropperService.getSingleImgData(t[e].remove,n),left:0,top:0}},answers:[],help:{num:t[e].num,url:""},tempData:{sort:e,point:0,answerType:1,answerConfig:{},answerResult:[],isShowAttach:!1,questionMedia:[],isSelect:!0,isShowHelp:!1},rootIndex:e},c=t[e].positions;if(s.original=this.cropperService.getScatteredImgData(c,n),t[e].isGroup){this.groupLengths.push(this.totalInGroupTracking),this.totalInGroupTracking=0,this.countGroup++,s.isGroup=!0;var x=this.cropperService.getScatteredImgData(t[e].positions,n);this.groupImages["image_group_".concat(t[e].num)]=x}else{d++,this.totalInGroupTracking++,l&&0!=d&&h.left+t[e].remove.width>l.canvas.width?(h.left=0,h.top=h.top+this.maxQuestionLabelHeight+5,this.maxQuestionLabelHeight=0,l&&h.top+t[e].remove.heigh>l.canvas.height&&o(),null==l||l.drawImage(n[t[e].remove.pageIndex].canvas,t[e].remove.left,t[e].remove.top,t[e].remove.width,t[e].remove.heigh,h.left,h.top,t[e].remove.width,t[e].remove.heigh),s.question.remove.left=h.left,s.question.remove.top=h.top,this.questionLabelMap.push({locate:a,left:h.left,top:h.top,width:t[e].remove.width,height:t[e].remove.heigh}),h.left=h.left+t[e].remove.width+5):(l&&h.top+t[e].remove.heigh>l.canvas.height&&o(),null==l||l.drawImage(n[t[e].remove.pageIndex].canvas,t[e].remove.left,t[e].remove.top,t[e].remove.width,t[e].remove.heigh,h.left,h.top,t[e].remove.width,t[e].remove.heigh),s.question.remove.left=h.left,s.question.remove.top=h.top,this.questionLabelMap.push({locate:a,left:h.left,top:h.top,width:t[e].remove.width,height:t[e].remove.heigh}),h.left=h.left+t[e].remove.width+5,t[e].remove.heigh>this.maxQuestionLabelHeight&&(this.maxQuestionLabelHeight=t[e].remove.heigh)),this.cropperService.fillColor("#ffffff",n[t[e].remove.pageIndex],t[e].remove.left,t[e].remove.top,t[e].remove.width,t[e].remove.heigh),s.question.urlExcludeLabelOnly=1==c.length?this.cropperService.getSingleImgData(c[0],n):this.cropperService.getScatteredImgData(c,n),s.question.remove.x=t[e].remove.left-c[0].left,s.question.remove.y=t[e].remove.top-c[0].top,s.question.remove.width=t[e].remove.width,s.question.remove.height=t[e].remove.heigh,t[e].answers.length>0?t[e].answers.forEach(e=>{let t={label:e.label,posit:{left:0,top:0,locate:0},url:"",x:e.positions[0].left-c[0].left,y:e.positions[0].top-c[0].top,width:1,height:1,remove:{x:e.remove.left-c[0].left,y:e.remove.top-c[0].top,xAns:e.remove.left-e.positions[0].left,yAns:e.remove.top-e.positions[0].top,width:e.remove.width,height:e.remove.heigh,url:this.cropperService.getSingleImgData(e.remove,n),left:0,top:0}};if(c.length>1&&c[0].pageIndex!==e.remove.pageIndex&&(t.remove.y=e.remove.top-c[1].top+c[0].heigh),this.cropperService.fillColor("#ffffff",n[e.remove.pageIndex],e.remove.left,e.remove.top,e.remove.width,e.remove.heigh),c.length>1){for(let n=0;n<c.length;n++)if(c[n].pageIndex==e.positions[0].pageIndex){t.y=0==n?e.positions[0].top-c[n].top:e.positions[0].top-c[n].top+c[0].heigh;break}}if(e.isCorrect&&(s.tempData.answerResult=[e.label]),1==e.positions.length)t.url=this.cropperService.getSingleImgData(e.positions[0],n),t.width=e.positions[0].width,t.height=e.positions[0].heigh;else{t.url=this.cropperService.getScatteredImgData(e.positions,n);let s=e.positions.filter(e=>!e.inactive);t.width=this.cropperService.maxWidthTo(s.length,e.positions),t.height=this.cropperService.sumHighTo(s.length,e.positions)}s.answers.push(t),e.positions.forEach(e=>{this.cropperService.fillColor("#ffffff",n[e.pageIndex],e.left,e.top,e.width,e.heigh)})}):t[e].strAns&&void 0!==t[e].strAns?(s.tempData.answerType=4,s.tempData.answerResult.push(t[e].strAns||"")):s.tempData.answerType=3;let u=t[e].help;if(u&&(u.remove&&this.cropperService.fillColor("#ffffff",n[u.remove.pageIndex],u.remove.left,u.remove.top,u.remove.width,u.remove.heigh),u.positions&&u.positions.length>0&&(s.help.url=this.cropperService.getScatteredImgData(u.positions,n))),1==c.length){var p=c[0];if(s.answers.length){var[f]=s.answers;p.heigh=f.y}s.question.url=this.cropperService.getSingleImgData(p,n),s.question.width=p.width,s.question.height=p.heigh}else{s.question.url=this.cropperService.getScatteredImgData(c,n);let e=c.filter(e=>!e.inactive);s.question.width=this.cropperService.maxWidthTo(e.length,c),s.question.height=this.cropperService.sumHighTo(e.length,c)}this.questionList.push(s)}}for(let e=0;e<this.questionList.length;e++)this.questionList[e].tempData.point=this.totalNumberQuestion?Number(this.totalPoint/this.totalNumberQuestion):0,this.questionList[e].index=e;let m=0;for(let e=0;e<this.groupLengths.length;e++)this.firstInGroupIndexes.push(m+this.groupLengths[e]),m+=this.groupLengths[e];this.completeCropper()}generateIdRequired(e){let t="z",n="abcdefghijklmnopqrstuvwxyz0123456789",s=n.length;for(let l=0;l<e;l++)t+=n.charAt(Math.floor(Math.random()*s));return t}createElementImage(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;var n="";return t&&(n=' style="width:'.concat((100*t[1].width/t[0].width).toFixed(2),'%"')),e?'<p><img class="quill-image" src="'.concat(e,'"').concat(n,"/></p>"):""}completeCropper(){let e=[],t=[],n=this.quizId,s=(10/this.questionList.filter(e=>e.tempData.isSelect&&e.answers.length).length).toFixed(2);t=this.questionList.map(t=>{(!t.group||e.length+1!=t.group)&&(e.length||t.group)||e.push({id:this.generateIdRequired(7),quizId:n,questions:[],content:this.createElementImage(t.groupUrl),title:"",audios:[]});let l=e[e.length-1],a={id:this.generateIdRequired(7),content:this.createElementImage(t.question.urlExcludeLabelOnly),quizId:n,groupId:l.id,point:t.tempData.isSelect&&t.answers.length?s:0,label:"C\xe2u",number:t.question.label,type:"TN",options:t.answers.map(e=>({text:e.label,keys:(t.tempData.answerResult||[]).includes(e.label)})),explain:this.createElementImage(t.help.url),level:"",shuffle:!!t.isFixAns};return l.questions.push(a.id),a}),this.callback({status:"done",data:{groups:e,questions:t,quizId:this.quizId}})}parsePdf(e){let t=new v;t.loadPdf(e,e=>{let n=e.length,l=[],a=[],o=document.createElement("div");o.id="hiddenWrapper",o.style.width="1px",o.style.height="1px",o.style.overflow="hidden",o.style.opacity="0",o.style.zIndex="-9999",o.style.position="fixed",o.style.top="0",o.style.left="0",document.body.appendChild(o);let d=document.createElement("div"),h="canvasWrapper";d.id=h,o.appendChild(d);let c=new Date().getTime(),u=[];t.render(e,h,s.PdfConst.RENDER_SCALE,(t,s,o)=>{if(null!=t&&(l[s]=t,a[s]=o),u.push(1),this.updateStatusCallback&&this.updateStatusCallback("Rendering: ".concat(u.length,"/").concat(n)),u.length==n){let t=new Date().getTime();this.updateStatusCallback&&this.updateStatusCallback("Render done: "+(t-c)/1e3+" secs"),this.startAnalyze(l,a,e)}})})}startAnalyze(e,t,n){let l=n.length,o=[],d=[],h=[],u=[],p=new v,f=new Date().getTime();for(let m=0;m<l;m++){let g=m,v=p.getImages(n[m],g);for(let e of v)u.push(e);n[m].getTextContent().then(n=>{for(let e of v)n.items.push(this.imgToTextObj(e,n.items.length>0?n.items[0].fontName:""));var m,b=p.getLines(n,g,e[g],t[g]);if(d=d.concat(b),h[g]=n.styles,o.push(1),o.length==l){d.sort((e,t)=>1e7*e.pageIndex+(e.transform.length>0?e.transform[5]:0)-(1e7*t.pageIndex+(t.transform.length>0?t.transform[5]:0))),p.findAndSplitQuestAnsLine(d,h,e),""!=s.PdfConst.DRAW_RESULT&&console.log(d);let t=this.findEntityPos(d,h,e,p.imageCache,0),n=!1;for(let e of t)if(e.type==a.TYPE_NAME){n=!0;break}if(n||(t=this.findEntityPos(d,h,e,p.imageCache,1)),0==t.length)return void(this.onCompleteCallback&&this.onCompleteCallback([],e));let l=t[0].type==x.TYPE_NAME,o=l?JSON.parse(t[0].str):null,g=new Map,v=new Map;if(l){for(let e of o.main)g.set(e.num,e.str);for(let e of o.sub)v.set(e.num,e.str)}let b=this.getQuestionInfo(t,d,e,g);for(let e of(b.forEach(e=>{if(!g.has(e.num)&&!v.has(e.num)&&e.help&&e.help.text){let t=c.getAnsFromHelp(e.help.text);""!=t&&v.set(e.num,t)}}),b)){if(!e.isGroup&&0==e.answers.length&&g.has(e.num)){let t={pageIndex:e.remove.pageIndex,top:e.remove.top-1,left:e.remove.left-1,width:1,heigh:1};for(let n of["A","B","C","D"]){let s={label:n,remove:t,positions:[t]};g.get(e.num)==n&&(s.isCorrect=!0),e.answers.push(s)}e.isFixAns=!0}if(!e.isGroup&&0==e.answers.length&&!g.has(e.num)&&v.has(e.num)&&(e.strAns=v.get(e.num)),!e.isGroup&&e.answers.length>0&&!g.has(e.num)&&v.has(e.num))for(let t of e.answers)t.label==(null===(m=v.get(e.num))||void 0===m?void 0:m.toUpperCase().substring(0,1))&&(t.isCorrect=!0)}let C=new Date().getTime();this.updateStatusCallback&&this.updateStatusCallback("Analyze done: "+(C-f)/1e3+" secs"),this.showOnCanvas(b,t,d,e,u,s.PdfConst.DRAW_RESULT),this.onCompleteCallback&&this.onCompleteCallback(b,e)}})}}imgToTextObj(e,t){return{str:"img",fontName:t,width:e.paintWidth,height:e.paintHeight,transform:[-999,0,0,0,-e.left,-e.top-e.paintHeight]}}findEntityPos(e,t,n,s,l){let m=[],v=!1;var b=[{parser:new o,on:[],off:[]},{parser:new a(l),on:[3,4],off:[6]},{parser:new d,on:[3,6],off:[]},{parser:new h(!1),on:[6,8],off:[0,2]},{parser:new c(!1),on:[6,8],off:[0,2,4]},{parser:new u,on:[],off:[8]},{parser:new x(!1,e=>{for(let t of e)m.unshift(t)}),on:[],off:[2]},{parser:new p,on:[],off:[]},{parser:new f(!1,e=>{if(0!=e.length){if(m.length>0&&m[0].type==x.TYPE_NAME){let t=JSON.parse(e[0].str),n=JSON.parse(m[0].str);n.sub=t.sub,m[0].str=JSON.stringify(n)}else e[0].type=x.TYPE_NAME,m.unshift(e[0])}}),on:[],off:[2]}],C=[8,0,1,2,3,4,5,6,7],j=null;let T=0,y="";for(let s of e){for(let l of((T==e.length-1||s.pageIndex<e[T+1].pageIndex)&&(s.isLastLine=!0),C)){let e=b[l];var I=e.parser.process(m,s,T,j,t[s.pageIndex],n[s.pageIndex]);if(I.length>0){for(let e of I){if(e.type!=d.TYPE_NAME&&e.type!=p.TYPE_NAME&&(y=""),e.type==d.TYPE_NAME){if(!"ABCDEFGH".startsWith(y+e.str))continue;y+=e.str;for(let e=m.length-1;e>=0&&m[e].type==o.TYPE_NAME;e--)m.splice(e,1)}e.type==p.TYPE_NAME&&(s.isFooter=!0),e.type==c.TYPE_NAME&&(v=!0),e.type==u.TYPE_NAME&&v&&b[5].parser.off(),m.push(e)}for(let t of e.on)b[t].parser.on();for(let t of e.off)b[t].parser.off();break}}j=s,T++}for(let e of b)e.parser.off();return m.forEach(t=>{if(!e[t.lineIndex].top){let n=g.getTopLine(s[t.pageIndex],t.lineIndex,e);e[t.lineIndex].top=n[0],1!=t.isIntersec&&(t.isIntersec=n[1])}}),m.forEach(t=>{if(!e[t.lineIndex].bottom){let n=g.getBottomLine(s[t.pageIndex],t.lineIndex,e);e[t.lineIndex].bottom=n[0],1!=t.isIntersec&&(t.isIntersec=n[0])}}),m}showOnCanvas(e,t,n,l,f,m){let v=new Date().getTime(),b=new Map([["A","rgba(18, 0, 255, 0.4)"],["B","rgba(0, 158, 34, 0.4)"],["C","rgba(50, 50, 50, 0.4)"],["D","rgba(132, 0, 137, 0.4)"],["E","rgba(132, 0, 137, 0.4)"],["F","rgba(132, 0, 137, 0.4)"],["G","rgba(132, 0, 137, 0.4)"],["H","rgba(132, 0, 137, 0.4)"]]),C=new Map([[a.TYPE_NAME,"red"],[d.TYPE_NAME,"blue"],[h.TYPE_NAME,"gray"],[x.TYPE_NAME,"green"],[c.TYPE_NAME,"orange"],[u.TYPE_NAME,"pink"],[p.TYPE_NAME,"yellow"],[o.TYPE_NAME,"black"]]);if(m.indexOf("quest")>=0)for(let t of e){for(let e of t.positions)g.drawBox(l[e.pageIndex],t.isGroup?"black":"red",e);for(let e of(g.drawBox(l[t.remove.pageIndex],"yellow",t.remove),t.answers)){for(let t of e.positions)g.drawBox(l[t.pageIndex],b.get(e.label)+"",t,!0);g.drawBox(l[e.remove.pageIndex],"yellow",e.remove),e.isCorrect&&g.drawPoint(l[e.positions[0].pageIndex],"green",e.positions[0])}if(t.help){for(let e of t.help.positions)g.drawBox(l[e.pageIndex],"orange",e);t.help.remove&&g.drawBox(l[t.help.remove.pageIndex],"yellow",t.help.remove)}}if(m.indexOf("line")>=0)for(let e of n)g.drawBox2(l[e.pageIndex],e.height<s.PdfConst.LINE_SMALL_HEIGHT?"red":"rgba(50, 58, 168, 0.4)",e.width,e.height,e.transform);if(m.indexOf("txt")>=0)for(let e of n)for(let t of e.textObjs)""!=t.str.trim()&&g.drawBox2(l[e.pageIndex],e.height<s.PdfConst.LINE_SMALL_HEIGHT?"red":"rgba(132, 0, 137, 0.2)",t.width,t.height,t.transform);if(m.indexOf("img")>=0)for(let e of f)g.drawBox2(l[e.pageIndex],"green",e.paintWidth,e.paintHeight,[0,0,0,0,-e.left,-e.top-e.paintHeight]);if(m.indexOf("pos")>=0)for(let e of t){let t={top:e.transform[5],left:e.transform[4],width:0,heigh:0,pageIndex:e.pageIndex};g.drawPoint(l[e.pageIndex],C.get(e.type)+"",t)}let j=new Date().getTime();this.updateStatusCallback&&this.updateStatusCallback("Draw done: "+(j-v)/1e3+" secs")}getQuestionInfo(e,t,n,l){if(0==e.length)return[];let x=0,f=[],m=new Map,g="",v=!1,b=!1,C=0;for(let j of(e.forEach((n,s)=>{s>0&&null==e[s-1].text&&(e[s-1].text=t.slice(e[s-1].lineIndex,n.lineIndex)),s==e.length-1&&(e[s].text=t.slice(e[s].lineIndex,t.length))}),e.forEach(j=>{let T=":"+j.type;v||j.type!=h.TYPE_NAME&&j.type!=c.TYPE_NAME||(v=!0);let y=null;for(let t=x+1;t<e.length;t++)if((j.type!=a.TYPE_NAME||e[t].type!=d.TYPE_NAME)&&e[t].type!=p.TYPE_NAME){y=e[t];break}let I=n[j.pageIndex].canvas.height-20;if(v||j.type!=o.TYPE_NAME||(C++,f.push({num:C,answers:[],remove:o.getRemoveBox(j,t),positions:o.getBoxes(j,t,y,I),isGroup:!0,text:j.text})),v||j.type!=a.TYPE_NAME||f.push({num:+j.str,answers:[],remove:a.getRemoveBox(j,t),positions:a.getBoxes(j,t,y,I),group:C,text:j.text}),!v&&j.type==d.TYPE_NAME&&f.length>0){let e=f[f.length-1].num,n={label:j.str,remove:d.getRemoveBox(j,t),positions:d.getBoxes(j,t,y,I)};l.size>0&&l.get(e)==n.label&&(n.isCorrect=!0),f[f.length-1].answers.push(n);let a=t[j.lineIndex].strLine.replace(/\|/g,"").trim().match(s.PdfConst.MULTIPLE_ANS_PATTERN.join("|"));null!=a&&a.length>0&&(f[f.length-1].isFixAns=!0),1==j.isIntersec&&(f[f.length-1].isFixAns=!0)}if(!b&&j.type==u.TYPE_NAME&&1==f.length&&g.endsWith(":".concat(a.TYPE_NAME,":").concat(d.TYPE_NAME))&&(b=!0),j.type==u.TYPE_NAME&&b){let e=f[f.length-1].num;m.set(e,{num:e,positions:u.getBoxes(j,t,y,I),text:j.text})}if(j.type!=u.TYPE_NAME||b||(m.clear(),v=!0),v&&j.type==a.TYPE_NAME){let e=+j.str;m.get(e)||m.set(e,{num:e,positions:a.getBoxes(j,t,y,I),remove:a.getRemoveBox(j,t),text:j.text})}g.endsWith(T)||j.type==p.TYPE_NAME||(g+=T),x++}),f))j.isGroup||(j.help=m.get(j.num),1==j.answers.length&&(j.answers=[]));return f}constructor(e,t){var n,l,a;console.log(this),this.cropperService=new m,this.labelHolderSize={width:3500,height:3500},this.totalPoint=10,this.quizId=e,this.callback=t;let o={RENDER_SCALE:2,LINE_SMALL_HEIGHT:8,SPLIT_MARGIN:3,INTERSEC_MARGIN:10,LINE_MAGIN:2,MARGIN_LEFT:2,ENABLE_IMAGE_PROCESS:!0,STEP_SIZE:3,CROP_FULL_WIDTH:!0,OVERLAP:.5,QUESTION_PATTERN:["(^c\xe2u\\s*\\d{1,4}[^0-9])","(^câu\\s*\\d{1,4}[^0-9])","(^c\xa9u\\s*\\d{1,4}[^0-9])","(^ca‚u\\s*\\d{1,4}[^0-9])","(^b\xe0i\\s*\\d{1,4}[^0-9])","(^bài\\s*\\d{1,4}[^0-9])","(^cau\\s*\\d{1,4}[^0-9])","(^bai\\s*\\d{1,4}[^0-9])","(^question\\s*\\d{1,4}[^0-9])","(^questions\\s*\\d{1,4}[^0-9])","(^\\[\\d{1,4}\\][^0-9])","(^\\d+\\s*\\(nb\\))","(^\\d+\\s*\\(th\\))","(^\\d+\\s*\\(vd\\))","(^\\d+\\s*\\(vdc\\))","(^c\xe2u\\s*\\d{1,4}[\\s\\.:]*$)","(^câu\\s*\\d{1,4}[\\s\\.:]*$)","(^c\xa9u\\s*\\d{1,4}[\\s\\.:]*$)","(^ca‚u\\s*\\d{1,4}[\\s\\.:]*$)","(^b\xe0i\\s*\\d{1,4}[\\s\\.:]*$)","(^bài\\s*\\d{1,4}[\\s\\.:]*$)","(^cau\\s*\\d{1,4}[\\s\\.:]*$)","(^bai\\s*\\d{1,4}[\\s\\.:]*$)","(^questions\\s*\\d{1,4}[\\s\\.:]*$)","(^question\\s*\\d{1,4}[\\s\\.:]*$)"],QUESTION_PATTERN2:["(^(\\d+\\s*\\.)\\s*[\\.0-9])","(^(\\d+\\s*\\.)\\s*\\(\\s*\\d+\\s*\\))","(^(\\d+\\s*\\.)\\s*[^\\s]\\s*[^\\s0-9])","(^\\d+\\s*\\.\\s*$)"],BREAK_LINE_PATTERN:["(^C\xe2u\\s*\\d+\\s*[:\\.]\\s*[Aa]\\s*\\.)","(^C\xa9u\\s*\\d+\\s*[:\\.]\\s*[Aa]\\s*\\.)","(^B\xe0i\\s*\\d+\\s*[:\\.]\\s*[Aa]\\s*\\.)","(^Cau\\s*\\d+\\s*[:\\.]\\s*[Aa]\\s*\\.)","(^Bai\\s*\\d+\\s*[:\\.]\\s*[Aa]\\s*\\.)","(^Question\\s*\\d+\\s*[:\\.]\\s*[Aa]\\s*\\.)","(^\\d+\\s*[:\\.]\\s*[Aa]\\s*\\.)"],SECTION_PATTERN_LOWER:["(^mark\\s*the\\s*letter)","(^read\\s*the\\s*follow)","(^reading\\s*the\\s*follow)","(^read\\s*the\\s*text)","(^read\\s*the\\s*passage)","(^read\\s*the\\s*paragraph)","(^read\\s*and\\s*choose)","(^put\\s*these\\s*word)","(^supply\\s*the\\s*correct)","(^make\\s*questions?\\s*for)","(^fill\\s*in\\s*the\\s*blank)","(^fill\\s*in\\s*each\\s*numbered)","(write\\s*the\\s*months\\s*in\\s*english)","(write\\s*the\\s*telephone\\s*numbers\\s*in\\s*english)","(^which\\s*of\\s*the\\s*following)","(^choose\\s*the\\s*suitable\\s*word)","(^choose\\s*the\\s*word)","(^choose\\s*the\\s*option)","(^choose\\s*the\\s*item\\s*among)","(^choose\\s*the\\s*underlined\\s*word)","(^combine\\s*two\\s*sentences)","(^each\\s*of\\s*the\\s*following)","(^finish\\s*the\\s*second\\s*sentence)","(^identify\\s*the\\s*underlined)","(^identify\\s*a\\s*mistake)","(^indicate\\s*the\\s*word)","(^indicate\\s*the\\s*correct)","(^indicate\\s*the\\s*sentence)","(^indicate\\s*the\\s*underlined)","(^circle\\s*the\\s*underlined)","(^circle\\s*the\\s*word\\s*whose\\s*underlined)","(^choose\\s*the\\s*underlined)","(^\\*?find\\s*the\\s*word)","(^find\\s*a\\s*mistake)","(^fill\\s*the\\s*circle)","(^listen\\s*to.*conversation)","(^there\\s*are.*blanks\\s*in\\s*the\\s*passage\\s*below)","(^listen\\s*to\\s*the\\s*recording)","(^listen\\s*and\\s*circle)","(^listen\\s*again\\s*and\\s*choose)","(^\\*?listen\\s*and\\s*complete)","(^\\*?choose\\s*the\\s*best)","(^choose\\s*the\\s*correct)","(^put\\s*in\\s*the\\s*correct)","(^complete\\s*the\\s*second\\s*sentence)","(^complete\\s*the\\s*sentences)","(^give\\s*the\\s*correct\\s*form)","(^mark\\s*a,\\s*b,)","(^circle\\s*the\\s*letter)","(^you\\s*will\\s*hear)","(^blacken\\s*the\\s*letter)","(^đọc\\s*đoạn\\s*tr\xedch)","(^dựa\\s*v\xe0o\\s*th\xf4ng\\s*tin\\s*dưới\\s*đ\xe2y)","(^dựa\\s*v\xe0o\\s*c\xe1c\\s*th\xf4ng\\s*tin\\s*được\\s*cung\\s*cấp\\s*dưới\\s*đ\xe2y)","(^section\\s*[0-9abcdefghivx]+)","(^part[^a-z]+[0-9abcdefghivx]+\\s*[\\.:\\-])","(^phần\\s*[0-9abcdefivx]+[\\.:])","(^nh\xf3m\\s*[0-9abcdefivx]+[\\.:])","(^chương\\s*[0-9abcdefivx]+[\\.:])","(^questions?\\s*\\d+\\s*[\\–\\-to]+\\s*\\d+)","(^passage\\s*[0-9abcdefghivx]+)","(^use\\s*the\\s*word\\s*given\\s*in\\s*capitals)","(^tự\\s*luận)"],SECTION_PATTERN_NORMAL:["(^[IVX]+\\s*[\\.\\-\\–]\\s*[A-Z\xc0Ả\xc3\xc1ẠĂẰẲẴẮẶ\xc2ẦẨẪẤẬĐ\xc8ẺẼ\xc9Ẹ\xcaỀỂỄẾỆ\xccỈĨ\xcdỊ\xd2Ỏ\xd5\xd3Ọ\xd4ỒỔỖỐỘƠỜỞỠỚỢ\xd9ỦŨ\xdaỤƯỪỬỮỨỰỲỶỸ\xddỴ]+)","(^[\\d]+\\.[\\d]+\\.[\\d]*\\.*\\s*[A-Z\xc0Ả\xc3\xc1ẠĂẰẲẴẮẶ\xc2ẦẨẪẤẬĐ\xc8ẺẼ\xc9Ẹ\xcaỀỂỄẾỆ\xccỈĨ\xcdỊ\xd2Ỏ\xd5\xd3Ọ\xd4ỒỔỖỐỘƠỜỞỠỚỢ\xd9ỦŨ\xdaỤƯỪỬỮỨỰỲỶỸ\xddỴ]+)","(^[IVX]+\\s*[\\.:]\\s*$)"],KICK_PATTERN:["(^Chọn\\s*[ABВCDEFGHIJK]+)","(^Chon\\s*[ABВCDEFGHIJK]+)"],TVCN_CHAR:[["Α","A"],["В","B"]],HET_PATTERN:["(HẾT)","(H\xcáT)","(HET)","(\\-\\-HT\\-\\-)","(THE\\s*END)","(The\\s*end[^a-z0-9]*$)","(^[^A-Za-z]*Hết[^A-Za-z]*)$"],DAPAN_PATTERN:["(\xc1P \xc1N)","(\xc1P \xc1)","(\xc1P\xc1N)","(ÁP ÁN)","(BẢNG\xc1\xc1)","(KHO\xc1\\s*C\xc2U\\s*TRẮC\\s*NGHIỆM)","(ÁPÁN)","(ANSWER KEYS)","(^KEYS$)","(Bảng\\s*đ\xe1p\\s*\xe1n)","(Đ\xe1p\\s*\xe1n\\s*v\xe0\\s*hướng)","(Dap\\s*an\\s*va\\s*huong)","(Đ\xe1p\\s*\xe1n\\s*[.:]\\s*$)","(Đ\xe1p\\s*\xe1n\\s*$)"],HUONGDAN_PATTERN:["(HƯỚNG\\s*DẪN)","(ƯỚNG\\s*DẪN\\s*GIẢI\\s*CHI)","(GIẢI\\s*TH\xcdCH\\s*CHI\\s*TIẾT)","(Hướng\\s*dẫn\\s*giải)","(Lời\\s*giải)","(LỜI\\s*GIẢI)","(GIẢI\\s*CHI\\s*TIẾT)","(HD:)","(GLOSSARY)"],MULTIPLE_ANS_PATTERN:["([ABCDEFGH]\\s*v\xe0\\s*[ABCDEFGH]\\s*đều)","(Cả\\s*[ABCDEFGH]\\s*v\xe0\\s*[ABCDEFGH])","(Cả\\s*[ABCDEFGH]\\s*,\\s*[ABCDEFGH])","(Cả\\s*3\\s*đ\xe1p\\s*\xe1n)","(Cả\\s*đ\xe1p\\s*\xe1n)","(Tất\\s*cả\\s*đ\xe1p\\s*\xe1n)","(Kết\\s*quả\\s*kh\xe1c)","(Đ\xe1p\\s*\xe1n\\s*kh\xe1c)","(Đ\xe1p\\s*\xe1n\\s*[ABCDEFGH]\\s*v\xe0\\s*[ABCDEFGH])","(Tất\\s*cả\\s*đều)"],DRAW_RESULT:"",SKIP_CHAR:["","√","p","(",")","[","]","{","}",""],FOOTER_PATTERN:["(trang\\s*\\d+)","(Page\\s*\\d+)","(Trang\\s*\\d+)","(TRANG\\s*\\d+)","(^\\d{1,4}$)","(^[\\-\\s]*\\d{1,4}[\\-\\s]*$)"],HELP_ANS_PATTERN:["([\\s\\.]*Chọn\\s*([A-K]))","([\\d\\s\\.:]*Đ\xe1p\\s*\xe1n\\s*([A-K]))","([\\d\\s\\.:]*Đ\xe1p\\s*\xe1n\\s*l\xe0\\s*([A-K]))","([\\d\\s\\.:]*Chọn\\s*đ\xe1p\\s*\xe1n\\s*([A-K]))"],RES_ANS_PATTERN:["(\\d+[.-][^|0-9])"],STRANS_SPLIT:"|/\\"};s.PdfConst.RENDER_SCALE=o.RENDER_SCALE,s.PdfConst.LINE_SMALL_HEIGHT=o.LINE_SMALL_HEIGHT*s.PdfConst.RENDER_SCALE,s.PdfConst.SPLIT_MARGIN=o.SPLIT_MARGIN*s.PdfConst.RENDER_SCALE,s.PdfConst.INTERSEC_MARGIN=o.INTERSEC_MARGIN*s.PdfConst.RENDER_SCALE,s.PdfConst.LINE_MAGIN=o.LINE_MAGIN*s.PdfConst.RENDER_SCALE,s.PdfConst.MARGIN_LEFT=o.MARGIN_LEFT*s.PdfConst.RENDER_SCALE,s.PdfConst.ENABLE_IMAGE_PROCESS=o.ENABLE_IMAGE_PROCESS,s.PdfConst.STEP_SIZE=o.STEP_SIZE,s.PdfConst.CROP_FULL_WIDTH=o.CROP_FULL_WIDTH,s.PdfConst.OVERLAP=o.OVERLAP,s.PdfConst.QUESTION_PATTERN=o.QUESTION_PATTERN,s.PdfConst.QUESTION_PATTERN2=o.QUESTION_PATTERN2,s.PdfConst.BREAK_LINE_PATTERN=o.BREAK_LINE_PATTERN,s.PdfConst.SECTION_PATTERN_LOWER=o.SECTION_PATTERN_LOWER,s.PdfConst.SECTION_PATTERN_NORMAL=o.SECTION_PATTERN_NORMAL,s.PdfConst.KICK_PATTERN=o.KICK_PATTERN,s.PdfConst.TVCN_CHAR=o.TVCN_CHAR,s.PdfConst.HET_PATTERN=o.HET_PATTERN,s.PdfConst.DAPAN_PATTERN=o.DAPAN_PATTERN,s.PdfConst.HUONGDAN_PATTERN=o.HUONGDAN_PATTERN,s.PdfConst.MULTIPLE_ANS_PATTERN=o.MULTIPLE_ANS_PATTERN,s.PdfConst.DRAW_RESULT=o.DRAW_RESULT,s.PdfConst.SKIP_CHAR=o.SKIP_CHAR,s.PdfConst.FOOTER_PATTERN=null!==(n=o.FOOTER_PATTERN)&&void 0!==n?n:["(trang\\s*\\d+)","(Page\\s*\\d+)","(Trang\\s*\\d+)","(TRANG\\s*\\d+)","(^\\d{1,4}$)"],s.PdfConst.HELP_ANS_PATTERN=null!==(l=o.HELP_ANS_PATTERN)&&void 0!==l?l:["([\\s\\.]*Chọn\\s*([ABCDEFGH]))"],s.PdfConst.ANS_PATTERN=null!==(a=o.ANS_PATTERN)&&void 0!==a?a:["([\\s\\|\\.]+[ABCDEFGHIJK][\\s\\|]*[\\.\\)])"]}}},9716:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});let s=n(1117);class l{on(){this.isOn=!0}off(){this.isOn=!1}process(e,t,n,s,l,a){return this.isOn?this.parse(e,t,n,s,l,a):[]}constructor(){this.isOn=!0,this.TYPE="default"}}class a extends l{parse(e,t,n,s,l,a){var o=this.matchPos(t.strLine);if(o.value){let e=null;for(let t=o.value.length-1;t>=0;t--)if(o.value[t]){e=o.value[t];break}if(null==e)return[];let s=e.matchAll(/\d+/g).next(),d=e.length;s.done||e.trim().endsWith(".")||e.trim().endsWith(":")||(d=s.value.index+s.value[0].length);let h=t.strLine.replace(/\|/g,"").toLowerCase().indexOf(e)+d-1;return[{str:this.getNumberFromStr(e),pageIndex:t.pageIndex,lineIndex:n,transform:t.transform,startLeft:g.calIndexPos2(t.textObjs,l,a,h,!0),type:this.TYPE}]}return[]}matchPos(e){let t=e.replace(/\|/g,"").toLowerCase().trim();if(0==this.questType){let e=s.PdfConst.QUESTION_PATTERN.join("|");return t.matchAll(e).next()}{let e=s.PdfConst.QUESTION_PATTERN2.join("|");return t.matchAll(e).next()}}getNumberFromStr(e){var t=e.match(/(\d+)/);return t?t[0]:""}static getRemoveBox(e,t){let n=e.startLeft?e.startLeft[5]:t[e.lineIndex].top,l=e.transform[4]-s.PdfConst.MARGIN_LEFT,a=e.startLeft?e.startLeft[5]+e.startLeft[3]:t[e.lineIndex].bottom;return{pageIndex:e.pageIndex,top:n||20,left:l,heigh:a&&n?a-n:0,width:(e.startLeft?e.startLeft[4]:0)-l}}static getBoxes(e,t,n,l){let a=l;for(let n=e.lineIndex;n<t.length;n++)if(g.isLastLineOfPage(n,t)){let e=t[n].isFooter?t[n-1]:t[n];a=e.transform[5]+e.height+20;break}let o=[],d=e.pageIndex,h=n?n.lineIndex:t.length-1,c=t[e.lineIndex].transform[4]-s.PdfConst.MARGIN_LEFT,u=t[e.lineIndex].top;if(!u)return[];let x=s.PdfConst.CROP_FULL_WIDTH?g.getMaxLineRight(-1,t)+2*s.PdfConst.MARGIN_LEFT:t[e.lineIndex].transform[4]+t[e.lineIndex].width+2*s.PdfConst.MARGIN_LEFT,p=a,f=d,m=e.lineIndex+1;for(;m<=h;m++){let e=t[m].top;if(m!=t.length-1||n||(e=t[m].bottom),!s.PdfConst.CROP_FULL_WIDTH){let e=t[m-1].transform[4]+t[m-1].width+2*s.PdfConst.MARGIN_LEFT;e>x&&(x=e)}let l=t[m-1].transform[4]-s.PdfConst.MARGIN_LEFT;l<c&&(c=l),t[m].isFooter&&e?p=e:(t[m].pageIndex>f&&(t[m-1].isFooter||(p=a),o.push({pageIndex:f,top:u,left:c,width:x-c,heigh:p-u}),u=20,c=g.getMinLineLeft(t[m].pageIndex,t)-s.PdfConst.MARGIN_LEFT),f=t[m].pageIndex,e&&(p=e))}if(m-=1,!n&&g.isLastLineOfPage(m,t)){let e=t[m].isFooter?t[m-1]:t[m];p=e.transform[5]+e.height+20}return g.isFirstLineOfPage(m,t)||o.push({pageIndex:f,top:u,left:c,width:x-c,heigh:p-u}),o}constructor(e){super(),this.TYPE=a.TYPE_NAME,this.questType=e}}a.TYPE_NAME="question";class o extends l{parse(e,t,n,l,o,d){let h=t.strLine.replace(/\|/g,"").toLowerCase().trim().match(s.PdfConst.SECTION_PATTERN_LOWER.join("|")),c=null!=h&&h.length>0;if(c||(c=null!=(h=t.strLine.replace(/\|/g,"").trim().match(s.PdfConst.SECTION_PATTERN_NORMAL.join("|")))&&h.length>0),c&&h){let s=t.strLine.indexOf(h[0])+h[0].length+1,l=[h[0][0]];for(let t=e.length-1;t>=0;t--){if(e[t].type==a.TYPE_NAME){l.push(".Q");break}l.push(e[t].str[0])}return"HGFEDCBA.Q".endsWith(l.join(""))?[]:[{str:h[0],pageIndex:t.pageIndex,lineIndex:n,transform:t.transform,startLeft:g.calIndexPos(t.textObjs,o,d,s,!0),type:this.TYPE}]}return[]}static getRemoveBox(e,t){let n=t[e.lineIndex].top,l=e.transform[4]-s.PdfConst.MARGIN_LEFT,a=t[e.lineIndex].bottom;return{pageIndex:e.pageIndex,top:n||20,left:l,heigh:a&&n?a-n:0,width:l-l}}static getBoxes(e,t,n,l){let a=[],o=e.pageIndex,d=n?n.lineIndex:t.length-1,h=g.getMinLineLeft(-1,t)-s.PdfConst.MARGIN_LEFT,c=t[e.lineIndex].top;if(!c)return[];let u=g.getMaxLineRight(-1,t)+2*s.PdfConst.MARGIN_LEFT,x=l,p=o,f=e.lineIndex+1;for(;f<=d;f++){let e=t[f].top;if(t[f].isFooter&&e)x=e;else if(t[f].pageIndex>p&&(a.push({pageIndex:p,top:c,left:h,width:u-h,heigh:x-c}),c=20),p=t[f].pageIndex,e){x=e;break}}return f>=t.length&&(f=t.length-1),g.isFirstLineOfPage(f,t)||a.push({pageIndex:p,top:c,left:h,width:u-h,heigh:x-c}),a}constructor(){super(),this.TYPE=o.TYPE_NAME}}o.TYPE_NAME="section";class d extends l{parse(e,t,n,s,l,a){var o=[],d=this.matchPos(t.strLine,!1);if(0==d.length&&(d=this.matchPos(t.strLine,!0)),d.length>0)for(let e of d)o.push({str:e.value,pageIndex:t.pageIndex,lineIndex:n,transform:g.calIndexPos(t.textObjs,l,a,e.index),startLeft:g.calIndexPos2(t.textObjs,l,a,e.index+1),type:this.TYPE});return o}static getRemoveBox(e,t){let n=e.startLeft?e.startLeft[5]-2:t[e.lineIndex].top,l=e.transform[4]-s.PdfConst.MARGIN_LEFT,a=e.startLeft?e.startLeft[5]+e.startLeft[3]:t[e.lineIndex].bottom;return{pageIndex:e.pageIndex,top:n||20,left:l,heigh:a&&n?a-n:0,width:(e.startLeft?e.startLeft[4]:0)-l}}static getBoxes(e,t,n,l){let a=s.PdfConst.MARGIN_LEFT,o=[],h=t[e.lineIndex].top,c=t[e.lineIndex].bottom;if(!h||!c)return[];let u=c,x=e.transform[4]-a,p=n&&e.lineIndex==n.lineIndex?n.transform[4]-a:t[e.lineIndex].transform[4]+t[e.lineIndex].width+a;if(o.push({pageIndex:e.pageIndex,top:h,left:x,width:p-x,heigh:c-h}),n&&n.lineIndex==e.lineIndex)return o;h=c,c=l,p=0;let f=e.pageIndex,m=0;for(m=e.lineIndex+1;m<t.length;m++){if(c==l&&g.isLastLineOfPage(m,t)){let e=t[m].isFooter?t[m-1]:t[m];c=e.transform[5]+e.height+20}let n=t[m].top;if(m>e.lineIndex+1&&!t[m-1].isFooter){let e=t[m-1].transform[4]+t[m-1].width+a;e>p&&(p=e);let n=t[m-1].transform[4]-a;n<x&&(x=n)}if(t[m].isFooter&&n)m-e.lineIndex>1?(c=t[m-1].transform[5]+t[m-1].height+s.PdfConst.LINE_MAGIN,x=t[e.lineIndex+1].transform[4]-a):c=t[e.lineIndex].bottom;else if(t[m].pageIndex>f&&(c&&c-h>s.PdfConst.LINE_SMALL_HEIGHT&&m-e.lineIndex>1&&o.push({pageIndex:f,top:h,left:x,width:p-x,heigh:c-h}),u=h=20),f=t[m].pageIndex,n){c=n;break}}if(m>=t.length&&(m=t.length-1),m-e.lineIndex>1&&t[m-1].transform[5]>u&&!g.isFirstLineOfPage(m,t)){let n=20==h?t[m].transform[4]:t[e.lineIndex+1].transform[4];c&&c-h>s.PdfConst.LINE_SMALL_HEIGHT&&o.push({pageIndex:f,top:h,left:n,width:p-n,heigh:c-h})}n&&n.type==d.TYPE_NAME&&n.transform[4]>t[n.lineIndex].transform[4]+25*s.PdfConst.RENDER_SCALE&&(p=n.transform[4]-a,h=t[n.lineIndex].top,x=t[n.lineIndex].transform[4]-a,c=t[n.lineIndex].bottom,h&&c&&c-h>s.PdfConst.LINE_SMALL_HEIGHT&&o.push({pageIndex:f,top:h,left:x,width:p-x,heigh:c-h}));for(let e=o.length-1;e>=1;e--)o[e].left-(o[e-1].left+o[e-1].width)>=20*s.PdfConst.RENDER_SCALE&&o.splice(e,1);return o}matchPos(e,t){for(var n=t?e.toUpperCase():e,l=s.PdfConst.ANS_PATTERN,a=RegExp("[\\s\\|\\.]"),o=n.matchAll(l),d=[];;){var h=o.next();if(h.done)break;for(var c=0,u=h.value.index;u<n.length&&a.test(n[u]);u++)c++;let e=h.value[0].substr(c,1);("A"!=e||n.replace(/\|/g,"").trim().startsWith("A"))&&d.push({value:e,index:h.value.index+c})}return d}constructor(){super(),this.TYPE=d.TYPE_NAME}}d.TYPE_NAME="answer";class h extends l{parse(e,t,n,l,a,o){let d=t.strLine.replace(/\|/g,"").trim().match(s.PdfConst.HET_PATTERN.join("|"));return null!=d&&d.length>0?[{str:t.strLine,pageIndex:t.pageIndex,lineIndex:n,transform:t.transform,type:this.TYPE}]:[]}static getBoxes(e,t,n,s){return[]}strContains(e,t){for(let n of t)if(e.indexOf(n)>=0)return!0;return!1}constructor(e){super(),null!=e&&(this.isOn=e),this.TYPE=h.TYPE_NAME}}h.TYPE_NAME="het";class c extends l{parse(e,t,n,l,a,o){let d=t.strLine.replace(/\|/g,"").trim().match(s.PdfConst.DAPAN_PATTERN.join("|"));return null!=d&&d.length>0?[{str:t.strLine,pageIndex:t.pageIndex,lineIndex:n,transform:t.transform,type:this.TYPE}]:[]}static getBoxes(e,t,n,s){return[]}static getAnsFromHelp(e){for(let t of e){let e=t.strLine.replace(/\|/g,"").trim().match(s.PdfConst.HELP_ANS_PATTERN.join("|"));if(null!=e){for(let t=0;t<e.length;t++)if(null!=e[t]&&1==e[t].length)return e[t]}}return""}strContains(e,t){for(let n of t)if(e.indexOf(n)>=0)return!0;return!1}constructor(e){super(),null!=e&&(this.isOn=e),this.TYPE=c.TYPE_NAME}}c.TYPE_NAME="dapan";class u extends l{parse(e,t,n,l,a,o){let d=t.strLine.replace(/\|/g,"").trim().match(s.PdfConst.HUONGDAN_PATTERN.join("|"));return null!=d&&d.length>0?[{str:t.strLine,pageIndex:t.pageIndex,lineIndex:n,transform:t.transform,type:this.TYPE}]:[]}static getBoxes(e,t,n,s){return D.QuestionParser.getBoxes(e,t,n,s)}strContains(e,t){for(let n of t)if(e.indexOf(n)>=0)return!0;return!1}constructor(){super(),this.TYPE=u.TYPE_NAME}}u.TYPE_NAME="huongdan";class x extends l{parse(e,t,n,s,l,a){var o=t.strLine.replace(/\|/g,"").replace(/\s*\.*\-*:*,*;*/g,"");return o=(o=(o=(o=(o=o.replace(/C\xe2u/g,"")).replace(/\u0110\xe1p\xe1n/g,"")).replace(/\u0110\xe1p/g,"")).replace(/\xe1n/g,"")).replace(/\u0110\/A/g,""),/^[0-9ABCDEFGHabcdefgh]+$/g.test(o)&&o.length>=2&&(null==this.firstLine&&(this.firstLine=t,this.lineIdx=n),this.str+=o),[]}static getBoxes(e,t,n,s){return[]}getResult(e){let t=[],n="",s=[],l=!1;for(let t=0;t<e.length;t++){let a=e.charCodeAt(t),o=a>=65&&a<=72;if(o&&""==n)return[];o!=l&&(s.push(n),n=""),l=o,n+=e[t]}""!=n&&s.push(n);for(let e=1;e<s.length;e+=2){let n=0,l=Math.floor(s[e-1].length/s[e].length),a=+s[e-1].substr(n,l),o=a;for(let d=0;d<s[e].length;d++){if(d>=s[e-1].length||(a=+s[e-1].substr(n,l))!=o)return[];t.push({num:a,str:s[e][d]}),n+=l,l=(o=a+1).toString().length}}return t}on(){super.on(),this.firstLine=null,this.lineIdx=0,this.str=""}off(){if(super.off(),this.offCalback&&this.firstLine){var e=this.getResult(this.str.toUpperCase());if(e.length>0){let t=JSON.stringify({main:e,sub:[]});this.offCalback([{str:t,pageIndex:this.firstLine.pageIndex,lineIndex:this.lineIdx,transform:this.firstLine.transform,type:this.TYPE}])}}this.firstLine=null,this.str=""}constructor(e,t){super(),this.firstLine=null,this.lineIdx=0,this.str="",this.TYPE=x.TYPE_NAME,null!=e&&(this.isOn=e),this.offCalback=t}}x.TYPE_NAME="dapanchitiet";class p extends l{parse(e,t,n,l,a,o){if(!t.isLastLine||l&&t.transform[5]<l.transform[5]+l.height)return[];var d=t.strLine.replace(/\|/g,"").trim().match(s.PdfConst.FOOTER_PATTERN.join("|"));return null!=d&&d.length>0?[{str:d[0],pageIndex:t.pageIndex,lineIndex:n,transform:t.transform,type:this.TYPE}]:[]}static getBoxes(e,t,n,s){return[]}constructor(){super(),this.TYPE=p.TYPE_NAME}}p.TYPE_NAME="footer";class f extends l{parse(e,t,n,s,l,a){for(let o of[new p,new u])if(o.parse(e,t,n,s,l,a).length>0)return[];var o=t.strLine;return null==this.firstLine&&(this.firstLine=t,this.lineIdx=n),this.str+=o+"\n",[]}static getBoxes(e,t,n,s){return[]}getResult(e){let t=[],n=e.replace(/\n/g,"\n|"),l=s.PdfConst.QUESTION_PATTERN.join("|").replace(/\(\^/g,"(\\|"),a=n.matchAll(RegExp(l,"ig"));for(;;){let e=a.next();if(e.done)break;let t=e.value[0],s=this.getNumberFromStr(t);n=n.replace(t,s+".")}let o,d=n.matchAll(/\d+[\.\-]/g),h=-1;for(;;){let e=d.next();if(e.done)break;if(-1==h)h=e.value.index,o=e;else{let s=n.substr(h,e.value.index-h);t.push(this.toAns(s,o)),h=e.value.index,o=e}}if(h>=0&&o){let e=n.substr(h);t.push(this.toAns(e,o))}return t}toAns(e,t){let n=t.value[0].length;return{num:+t.value[0].substr(0,n-1),str:e.substr(n).replace(/\|/g," ").replace(/ +/g," ").trim()}}getNumberFromStr(e){var t=e.match(/(\d+)/);return t?t[0]:""}on(){super.on(),this.firstLine=null,this.lineIdx=0,this.str=""}off(){if(super.off(),this.offCalback&&this.firstLine){var e=this.getResult(this.str);if(e.length>0){let t=JSON.stringify({main:[],sub:e});this.offCalback([{str:t,pageIndex:this.firstLine.pageIndex,lineIndex:this.lineIdx,transform:this.firstLine.transform,type:this.TYPE}])}}this.firstLine=null,this.str=""}constructor(e,t){super(),this.firstLine=null,this.lineIdx=0,this.str="",this.TYPE=f.TYPE_NAME,null!=e&&(this.isOn=e),this.offCalback=t}}f.TYPE_NAME="dapandientu";class m{getErrorQtns(e){var t=[];for(let n=0;n<e.length;n++)!e[n].isGroup&&0==e[n].answers.length&&(e[n].strAns&&void 0!==e[n].strAns||t.push(e[n].num));return t}sumHighTo(e,t){let n=0,s=t.filter(e=>!e.inactive);for(let t=0;t<e;t++)n+=Math.round(s[t].heigh);return n}maxWidthTo(e,t){let n=[],s=t.filter(e=>!e.inactive);for(let t=0;t<e;t++)n.push(s[t].width);return Math.round(Math.max(...n))}constructor(e){this.commonService=e,this.fillColor=(e,t,n,s,l,a)=>{t.fillStyle=e,t.fillRect(Math.round(n),Math.round(s),Math.round(l),Math.round(a))},this.drawRect=(e,t,n,s,l,a)=>{t.beginPath(),t.lineWidth=1,t.strokeStyle=e,t.rect(Math.round(n),Math.round(s),Math.round(l),Math.round(a)),t.stroke()},this.getSingleImgData=(e,t)=>{var n,s;if(e.inactive){let e=null!==(n=this.commonService.myTranslateInstant("lang_auto_khong_xac_dinh_duoc_vung_thong_tin"))&&void 0!==n?n:"";throw this.commonService.snackError(e),Error(e)}try{let n=document.createElement("canvas");return n.width=0==e.width?2:Math.round(e.width),n.height=0==e.heigh?2:Math.round(e.heigh),null===(s=n.getContext("2d"))||void 0===s||s.drawImage(t[e.pageIndex].canvas,Math.round(e.left),Math.round(e.top),n.width,n.height,0,0,n.width,n.height),n.toDataURL("image/png")}catch(e){return console.log(e),"https://via.placeholder.com/300"}},this.getScatteredImgData=(e,t)=>{let n=e.filter(e=>!e.inactive);if(e.filter(e=>e.inactive).length==e.length){var s;let e=null!==(s=this.commonService.myTranslateInstant("lang_auto_khong_xac_dinh_duoc_vung_thong_tin"))&&void 0!==s?s:"";throw this.commonService.snackError(e),Error(e)}try{let e=document.createElement("canvas"),s=n.map(e=>e.width);e.width=Math.round(Math.max(...s));let l=0;for(let e=0;e<n.length;e++)l+=n[e].heigh;e.height=Math.round(l);let a=e.getContext("2d");for(let e=0;e<n.length;e++)null==a||a.drawImage(t[n[e].pageIndex].canvas,Math.round(n[e].left),Math.round(n[e].top),Math.round(n[e].width),Math.round(n[e].heigh),0,0==e?0:this.sumHighTo(e,n),Math.round(n[e].width),Math.round(n[e].heigh));return e.toDataURL("image/png")}catch(e){return console.log(e),"https://via.placeholder.com/300"}}}}class g{static drawPoint(e,t,n){null!=e&&(e.fillStyle=t,e.beginPath(),e.arc(n.left,n.top,5,0,2*Math.PI),e.fill())}static drawBox(e,t,n,s){null!=e&&(s?(e.fillStyle=t,e.beginPath(),e.rect(n.left,n.top,n.width,n.heigh),e.fill()):(e.strokeStyle=t,e.beginPath(),e.rect(n.left,n.top,n.width,n.heigh),e.stroke()))}static drawBox2(e,t,n,s,l){null!=e&&(e.strokeStyle=t,e.beginPath(),e.rect(l[4],l[5],n,s),e.stroke())}static drawLine(e,t,n,s){null!=e&&(e.strokeStyle=t,e.beginPath(),e.moveTo(n,s),e.lineTo(e.canvas.width-10,s),e.stroke())}static drawText(e,t,n,s){null!=e&&(e.font="11px Arial",e.fillStyle=t,e.fillText(s,n[4],n[5]))}static isLineIntersec(e,t){let n=e.transform[5]<=t.transform[5]&&t.transform[5]<=e.transform[5]+e.height,l=t.transform[5]<=e.transform[5]&&e.transform[5]<=t.transform[5]+t.height,a=e.transform[4]<=t.transform[4]&&t.transform[4]<=e.transform[4]+e.width+s.PdfConst.INTERSEC_MARGIN,o=t.transform[4]<=e.transform[4]&&e.transform[4]<=t.transform[4]+t.width+s.PdfConst.INTERSEC_MARGIN,d=this.isSameLine(e,t);return(n||l)&&(a||o)&&!d}static isLineVIntersec(e,t){return(e.transform[5]<=t.transform[5]&&t.transform[5]<=e.transform[5]+e.height||t.transform[5]<=e.transform[5]&&e.transform[5]<=t.transform[5]+t.height)&&(e.transform[4]<=t.transform[4]&&t.transform[4]<=e.transform[4]+e.width+s.PdfConst.INTERSEC_MARGIN||t.transform[4]<=e.transform[4]&&e.transform[4]<=t.transform[4]+t.width+s.PdfConst.INTERSEC_MARGIN)&&Math.abs(t.transform[4]-e.transform[4])>s.PdfConst.INTERSEC_MARGIN/2}static isSameLine(e,t){return Math.abs(e.transform[5]+e.height-(t.transform[5]+t.height))<=s.PdfConst.LINE_MAGIN}static isObjIntersec(e,t){return e.transform[5]<=t.transform[5]&&t.transform[5]<=e.transform[5]+e.height||t.transform[5]<=e.transform[5]&&e.transform[5]<=t.transform[5]+t.height}static isObjFullIntersec(e,t){return(e.transform[5]<=t.transform[5]&&t.transform[5]<=e.transform[5]+e.height||t.transform[5]<=e.transform[5]&&e.transform[5]<=t.transform[5]+t.height)&&(e.transform[4]<=t.transform[4]&&t.transform[4]<=e.transform[4]+e.width||t.transform[4]<=e.transform[4]&&e.transform[4]<=t.transform[4]+t.width)}static isFirstLineOfPage(e,t){return!(e<0||e>=t.length||0!=e&&t[e-1].pageIndex==t[e].pageIndex)}static isLastLineOfPage(e,t){return!(e<0||e>=t.length||e!=t.length-1&&t[e+1].pageIndex==t[e].pageIndex)}static getTopLine(e,t,n){let l=n[t];for(let a of[[s.PdfConst.STEP_SIZE,s.PdfConst.OVERLAP],[1,s.PdfConst.OVERLAP],[1,.3]]){let o=a[0],d=a[1],h=l.transform[5],c=0,u=3*o;if(!g.isFirstLineOfPage(t,n)){let e=g.isSameLine(n[t-1],l);g.isLineIntersec(n[t-1],l)?(h=n[t-1].transform[5]+n[t-1].height,c=n[t-1].transform[5],n[t-1].transform[4]>n[t].transform[4]+2*s.PdfConst.MARGIN_LEFT?c-=2*s.PdfConst.MARGIN_LEFT:c+=n[t-1].height*d,o=1,u=n[t].transform[5]+n[t].height/2-h):(c=e&&t-2>=0?n[t-2].transform[5]+n[t-2].height*d:n[t-1].transform[5]+n[t-1].height*d,e&&g.isFirstLineOfPage(t-1,n)&&(c=0))}if(!s.PdfConst.ENABLE_IMAGE_PROCESS)return[h,0];let x=!1;for(;h>c;){if(!g.hasColor(e,l.transform[4],h,l.width,o))return[h,0];x||(x=!0,h+=u),h-=o}}return[l.transform[5],1]}static arrContains(e,t){for(let n of t)if(n==e)return!0;return!1}static getBottomLine(e,t,n){let l=n[t];for(let a of[[s.PdfConst.STEP_SIZE,s.PdfConst.OVERLAP],[1,s.PdfConst.OVERLAP],[1,.3]]){let o=a[0],d=a[1],h=l.transform[5]+l.height,c=9999,u=3*o;if(!g.isLastLineOfPage(t,n)){let e=g.isSameLine(n[t+1],l);g.isLineIntersec(n[t+1],l)?(h=n[t+1].transform[5],c=n[t+1].transform[5]+n[t+1].height,n[t+1].transform[4]>n[t].transform[4]+2*s.PdfConst.MARGIN_LEFT?c+=2*s.PdfConst.MARGIN_LEFT:c-=n[t+1].height*d,u=n[t].transform[5]+n[t].height/2-h):(c=e&&t+2<n.length?n[t+2].transform[5]+n[t+2].height-n[t+2].height*d:n[t+1].transform[5]+n[t+1].height-n[t+1].height*d,e&&g.isLastLineOfPage(t+1,n)&&(c=9999));let a=n[t+1].top;if(a&&h>=a&&!e)return[a,0]}if(!s.PdfConst.ENABLE_IMAGE_PROCESS)return[h,0];let x=!1;for(;h<c;){if(!g.hasColor(e,l.transform[4],h,l.width,o))return[h,0];x||(x=!0,h-=u),h+=o}}return[l.transform[5]+l.height,1]}static hasColor(e,t,n,s,l){let a=Math.round(t),o=Math.round(a+s),d=Math.round(n),h=Math.round(d+l);for(let t=d;t<h;t++)for(let n=a;n<o;n++){let s=4*(t*e.width+n);if((e.data[s]+e.data[s+1]+e.data[s+2])/3<150)return!0}return!1}static calIndexPos2(e,t,n,l,a){let o=[],d=0,h=0,c=0,u=0,x=0,p=0,f=!0,m=!0;for(let b of e){m=this.isObjIntersec(e[0],b),u=b.transform[4],a||(d+=u-c>s.PdfConst.SPLIT_MARGIN&&""!=b.str.trim()||x!=b.transform[5]?1:0),f=u+2*s.PdfConst.MARGIN_LEFT>=c;let C=b.transform[4]+b.width;if(m&&(c=C),C>h&&m&&(h=C),(d+=b.str.length)>l&&f&&m){b.transform.forEach(e=>{o.push(e)}),o[3]=b.height,o[2]=p,o[1]=b.str.length-d+l;let e=b.str.substr(0,b.str.length-d+l+1);if(e.length==b.str.length){o[4]=o[4]+b.width;break}var g=t[b.fontName].fontFamily,v=Math.hypot(b.transform[2],b.transform[3]);n.font="".concat(v,"px ").concat(g);let s=n.measureText(e).width,a=n.measureText(b.str).width;o[4]=o[4]+b.width*s/a;break}m&&(x=b.transform[5]),p++}return 0==o.length&&(o=[0,e[e.length-1].length-1,e.length-1,e[0].height,h,e[0].transform[5]]),o}static calIndexPos(e,t,n,l,a){let o=[],d=0,h=0,c=0,u=0,x=0,p=0,f=!0,m=!0;for(let b of e){m=this.isObjIntersec(e[0],b),u=b.transform[4],a||(d+=u-c>s.PdfConst.SPLIT_MARGIN&&""!=b.str.trim()||x!=b.transform[5]?1:0,u-c>s.PdfConst.SPLIT_MARGIN&&""!=b.str.trim()||b.transform[5],b.str),f=u+2*s.PdfConst.MARGIN_LEFT>=c;let C=b.transform[4]+b.width;if(m&&(c=C),C>h&&m&&(h=C),(d+=b.str.length)>l&&f&&m){let e=b.str.substr(0,b.str.length-d+l);var g=t[b.fontName].fontFamily,v=Math.hypot(b.transform[2],b.transform[3]);n.font="".concat(v,"px ").concat(g);let s=n.measureText(e).width,a=n.measureText(b.str).width;b.transform.forEach(e=>{o.push(e)}),o[4]=o[4]+b.width*s/a,o[3]=b.height,o[2]=p,o[1]=b.str.length-d+l;break}m&&(x=b.transform[5]),p++}return 0==o.length&&(o=[0,e[e.length-1].length-1,e.length-1,e[0].height,h,e[0].transform[5]]),o}static getTextBottom(e,t,n,s){let l=Math.atan2(e[1],e[0]);t.vertical&&(l+=Math.PI/2);let a=Math.hypot(e[2],e[3]),o=a*g.getAscent(t.fontFamily,n,s);e[5];let d=0,h=0*(d=0===l?o:o*Math.cos(l));return[e[5]-d-h,a+h]}static getAscent(e,t,n){let s=n.get(e);if(s)return s;t.save(),t.font="30px ".concat(e);let l=t.measureText(""),a=l.fontBoundingBoxAscent,o=Math.abs(l.fontBoundingBoxDescent);if(a){t.restore();let s=a/(a+o);return n.set(e,s),s}t.strokeStyle="red",t.clearRect(0,0,30,30),t.strokeText("g",0,0);let d=t.getImageData(0,0,30,30).data;o=0;for(let e=d.length-1-3;e>=0;e-=4)if(d[e]>0){o=Math.ceil(e/4/30);break}t.clearRect(0,0,30,30),t.strokeText("A",0,30),d=t.getImageData(0,0,30,30).data,a=0;for(let e=0,t=d.length;e<t;e+=4)if(d[e]>0){a=30-Math.floor(e/4/30);break}if(t.restore(),a){let t=a/(a+o);return n.set(e,t),t}return n.set(e,.8),.8}static getMaxLineRight(e,t){let n=0;for(let s of t)if(s.pageIndex==e||-1==e){let e=s.transform[4]+s.width;e>n&&(n=e)}return n}static getMinLineLeft(e,t){let n=99999;for(let s of t)if(s.pageIndex==e||-1==e){let e=s.transform[4];e<n&&(n=e)}return n}}class v{loadPdf(e,t){var n=URL.createObjectURL(e);let s=pdfjsLib.getDocument({url:n,cMapPacked:!0,cMapUrl:"/assets/js/pdf-js-v2/cmaps/",disableAutoFetch:!1,disableFontFace:!1,disableRange:!1,disableStream:!1,docBaseUrl:"",enableXfa:!0,fontExtraProperties:!1,isEvalSupported:!0,maxImageSize:-1,pdfBug:!1,standardFontDataUrl:"/assets/js/pdf-js-v2/standard_fonts/",verbosity:1});var l=[];let a=this;s.promise.then(function(e){a.optionalContentConfigPromise=e.getOptionalContentConfig();for(var n=e._pdfInfo.numPages,s=1;s<=n;s++)e.getPage(s).then(e=>{l.push(e),l.length==n&&t(l=l.sort((e,t)=>e._pageIndex>t._pageIndex?1:-1))})},function(e){console.error(e)})}getImages(e,t){let n=[];if("function"!=typeof e.objs.getAll)return console.log("Unable to read img"),n;let s=e.objs.getAll();for(let e of Object.keys(s))s[e].data.pageIndex=t,n.push(s[e].data);return n}isImageObj(e){return -999==e.transform[0]&&"img"==e.str}getLines(e,t,n,l){let a=l.scale,o=e.items.length;for(let t=0;t<o;t++){let s=e.items[t];this.isImageObj(s)||(s.transform=v.transform(l.transform,s.transform),s.width=s.width*a),s.transform[4]+s.width>n.canvas.width&&(s.width=n.canvas.width-s.transform[4]-20);let o=this.isImageObj(s)?[s.transform[5],s.height]:g.getTextBottom(s.transform,e.styles[s.fontName],this.tempCanvas,this.ascentCache);s.height=o[1];let d=Math.ceil(o[0]);s.transform[5]=d}e.items.sort((e,t)=>1e6*Math.floor(e.transform[5])-e.transform[4]<1e6*Math.floor(t.transform[5])-t.transform[4]?-1:1);let d,h=[],c=0;this.imageCache[t]?d=this.imageCache[t]:(d=n.getImageData(0,0,n.canvas.width,n.canvas.height),this.imageCache[t]=d);var u={strLine:"",transform:[],textObjs:[],pageIndex:t,width:0,height:0,txtLength:0};for(let n=0;n<o;n++){let l=e.items[n];if(this.isImageObj(l)){for(let t=0;t<o;t++)if(n!=t&&g.isObjIntersec(l,e.items[t])){l.str="";break}}if(g.arrContains(l.str.trim(),s.PdfConst.SKIP_CHAR))continue;let a=Math.floor(l.transform[5]+l.height);0!=c?c-a>=-s.PdfConst.LINE_MAGIN?this.addTxtToLine(u,l):0!=u.textObjs.length&&(h.push(u),c=Math.floor((u=this.newLine(l,t)).transform[5]+u.height)):c=Math.floor((u=this.newLine(l,t)).transform[5]+u.height)}for(let e of(h.push(u),h))this.calculateSize(e);for(let e of(this.findAndMergeAnsQuestBlock(h,"ans"),this.findAndMergeAnsQuestBlock(h,"quest"),this.findAndMergeBlock(h),this.mergeIntersecLine(h),this.mergeSmallLine(h,d),h))this.calculateSize(e);return h}mergeIntersecLine(e){let t=0;for(;t<e.length;){let n=e[t];++t<e.length&&g.isLineVIntersec(n,e[t])&&(this.mergeLine(n,e[t]),e.splice(t,1),t--)}}findAndSplitQuestAnsLine(e,t,n){let l=0,a=[],o=s.PdfConst.BREAK_LINE_PATTERN.join("|");for(let t of e){t.top=void 0,t.bottom=void 0;var d=t.strLine.replace(/\|/g,"").trim().match(o);if(null!=d&&d.length>0){let e=/[\s\|\.]+[B\u0412][\s\|]*\./g,n=t.strLine.trim().toUpperCase().match(e);if(null!=n&&n.length>0){let e=d[0].toUpperCase().indexOf("A");a.push({lineIndex:l,strIndex:e})}}l++}for(let s=a.length-1;s>=0;s--){let l=a[s].lineIndex;this.splitLine(l,t[e[l].pageIndex],n[e[l].pageIndex],a[s].strIndex,e)}}mergeSmallLine(e,t){let n=0,l=1.2*s.PdfConst.LINE_SMALL_HEIGHT;for(;n<e.length;){let s=e[n];if(!s||!this.isSmallLine(s)){n++;continue}n-1>=0&&!e[n-1].bottom&&(e[n-1].bottom=g.getBottomLine(t,n-1,e)[0]),n+1<e.length&&!e[n+1].top&&(e[n+1].top=g.getTopLine(t,n+1,e)[0]);let a=n-1<0?-9999:this.getLineTop(s)-this.getLineBot(e[n-1]),o=n+1>=e.length?-9999:this.getLineTop(e[n+1])-this.getLineBot(s),d=n-1>=0&&e[n-1].transform[4]<=s.transform[4]&&s.transform[4]<=e[n-1].transform[4]+e[n-1].width,h=n+1<e.length&&e[n+1].transform[4]<=s.transform[4]&&s.transform[4]<=e[n+1].transform[4]+e[n+1].width;if(0==n&&o<=l&&h){this.mergeLine(e[n+1],s),e.splice(n,1),n--;continue}if(n==e.length-1&&a<=l&&d){this.mergeLine(e[n-1],s),e.splice(n,1),n--;continue}let c=-1;a>o&&h&&o<=l?c=n+1:a<=o&&d&&a<=l?c=n-1:a<=o&&h&&o<=l?c=n+1:a>o&&d&&a<=l&&(c=n-1),c>=0?(this.mergeLine(e[c],s),e.splice(n,1),n--):n++}}isSmallLine(e){return e.height<s.PdfConst.LINE_SMALL_HEIGHT}mergeLine(e,t){for(let n of t.textObjs)this.addTxtToLine(e,n)}findAndMergeAnsQuestBlock(e,t){let n=0;for(;n<e.length;){if("ans"==t&&this.isAnsLine(e[n])||"quest"==t&&this.isQuestLine(e[n])){let s=n,l=-1,a=1,o=[];for(;a<=10;){if((s=n+l*a)<0){l=1,a=1;continue}if(s>=e.length)break;let d=this.isAnsLine(e[s]),h=d||this.isQuestLine(e[s]),c="ans"==t&&d&&g.isSameLine(e[n],e[s]),u=!h&&g.isLineIntersec(e[n],e[s])&&e[s].transform[4]>e[n].transform[4];if((c||u)&&o.push(s),a++,h&&1==l)break;(a>10||h)&&-1==l&&(l=1,a=1)}for(let t of(o.sort((e,t)=>e<t?1:-1),o))for(let s of e[t].textObjs)this.addTxtToLine(e[n],s);for(let t of o)e.splice(t,1),t<n&&n--}n++}}findAndMergeBlock(e){let t=0;for(;t<e.length;){if(this.isAnsLine(e[t])||this.isQuestLine(e[t])){t++;continue}let n=t+1;for(;n<e.length&&e[t].pageIndex==e[n].pageIndex;){let s=this.isAnsLine(e[n])||this.isQuestLine(e[n]);if(g.isLineIntersec(e[t],e[n])&&!s||g.isSameLine(e[t],e[n])){for(let s of e[n].textObjs)this.addTxtToLine(e[t],s);e.splice(n,1),n=t}n++}t++}}isAnsLine(e){let t=e.strLine.trim().match(/[\s\|\.]+[AB\u0412CDEFGHIJK]\s*\./g);return null!=t&&t.length>0}isQuestLine(e){let t=s.PdfConst.QUESTION_PATTERN.join("|"),n=e.strLine.replace(/\|/g,"").toLowerCase().trim().match(t);return null!=n&&n.length>0}encodeLines(e,t){let n="",l=0;for(let a of t){if(a.height<s.PdfConst.LINE_SMALL_HEIGHT){l-1>=0&&!t[l-1].bottom&&(t[l-1].bottom=g.getBottomLine(e,l-1,t)[0]),l+1<t.length&&!t[l+1].top&&(t[l+1].top=g.getTopLine(e,l+1,t)[0]);let o=l-1<0?-9999:this.getLineTop(a)-this.getLineBot(t[l-1]),d=l+1>=t.length?-9999:this.getLineTop(t[l+1])-this.getLineBot(a),h=l-1>=0&&t[l-1].transform[4]<=a.transform[4]&&a.transform[4]+a.width<=t[l-1].transform[4]+t[l-1].width,c=l+1<t.length&&t[l+1].transform[4]<=a.transform[4]&&a.transform[4]+a.width<=t[l+1].transform[4]+t[l+1].width,u=1.2*s.PdfConst.LINE_SMALL_HEIGHT;Math.abs(o)>=u&&Math.abs(d)>=u?n+="L":n+=-9999==o?"3":-9999==d?"4":o>d&&c?"2":o<=d&&h?"1":o<=d&&c?"2":o>d&&h?"1":"L"}else n+="L";l++}return n}getLineTop(e){return e.top?e.top:e.transform[5]}getLineBot(e){return e.bottom?e.bottom:e.transform[5]+e.height}splitLine(e,t,n,s,l){let a=l[e],o=g.calIndexPos(a.textObjs,t,n,s,!0),d=this.newLine(a.textObjs[0],a.pageIndex),h=o[2],c=o[1],u=a.textObjs[h],x=u.transform,p={str:u.str.substr(0,c),width:o[4]-x[4],height:u.height,fontName:u.fontName,transform:[x[0],x[1],x[2],x[3],x[4],x[5]]},f={str:u.str.substr(c),width:u.width-p.width,height:u.height,fontName:u.fontName,transform:[x[0],x[1],x[2],x[3],o[4],x[5]]},m=a.textObjs;a.textObjs=[],d.textObjs=[];for(let e=0;e<m.length;e++)e<h?this.addTxtToLine(a,m[e]):e>h?this.addTxtToLine(d,m[e]):(this.addTxtToLine(a,p),this.addTxtToLine(d,f));return this.calculateSize(a),this.calculateSize(d),e==l.length-1?l.push(d):l.splice(e+1,0,d),d}findAndMergeSmallLine(e,t,n){let s=0,l=e.matchAll(n),a=[];for(;;){let e=l.next();if(e.done)break;let n=e.value[0],o=e.value.index,d=0,h=[];for(let e=0;e<n.length;e++)"L"==n[e]?d=o+e:h.push(o+e);for(let e of h){for(let n of t[e].textObjs)this.addTxtToLine(t[d],n);t[d].top=void 0,t[d].bottom=void 0,a.push(e)}s++}for(let e of(a.sort((e,t)=>e<t?1:-1),a))t.splice(e,1);return s}newLine(e,t){let n={strLine:"",transform:[],textObjs:[],pageIndex:t,width:0,height:0,txtLength:0};return n.transform[4]=e.transform[4],n.transform[5]=e.transform[5],n.height=e.height,n.width=e.width,n.txtLength=e.str.length,n.textObjs.push(e),n}addTxtToLine(e,t){t.transform[4]<e.transform[4]&&(e.transform[4]=t.transform[4]),t.transform[5]<e.transform[5]&&(e.transform[5]=t.transform[5]),t.transform[5]+t.height>e.transform[5]+e.height&&(e.height=t.transform[5]+t.height-e.transform[5]),t.transform[4]+t.width>e.transform[4]+e.width&&(e.width=t.transform[4]+t.width-e.transform[4]),e.txtLength+=t.str.length,e.textObjs.push(t);let n=e.transform[4]+e.width,s=e.height;for(let t of e.textObjs)t.transform[4]+t.width>n&&(n=t.transform[4]+t.width),t.transform[5]+t.height>e.transform[5]+s&&(s=t.transform[5]+t.height-e.transform[5]);e.width=n-e.transform[4],e.height=s}static transform(e,t){return pdfjsLib.Util.transform(e,t)}render(e,t,n,s){for(var l,a=e.length,o=0;o<a;o++){var d=document.createElement("div");d.className="pdf-page",d.id="page-"+o,null===(l=document.getElementById(t))||void 0===l||l.appendChild(d),this.renderPage(e[o],n,s)}}calculateSize(e){if(0==e.textObjs.length)return;e.textObjs.sort((e,t)=>1e6*Math.floor(e.transform[4])+e.transform[5]>1e6*Math.floor(t.transform[4])+t.transform[5]?1:-1),e.strLine="";let t=0,n=0,l=0,a=0,o=9999,d=0,h=9999;for(let c of e.textObjs){let u=g.isObjIntersec(e.textObjs[0],c),x=(l=c.transform[4])-n>s.PdfConst.SPLIT_MARGIN&&""!=c.str.trim()||a!=c.transform[5]?"|":"";e.strLine+=x+c.str,l<h&&(h=l);let p=c.transform[4]+c.width;u&&(n=p),p>t&&u&&(t=p),u&&(a=c.transform[5]),c.transform[5]<o&&(o=c.transform[5]),c.transform[5]+c.height>d&&(d=c.transform[5]+c.height)}e.transform[4]=h,e.transform[5]=o,e.width=t-h,e.height=d-o,e.transform[0]=o,e.transform[1]=d;let c=s.PdfConst.TVCN_CHAR,u=e.strLine;for(let e of c)u=u.replace(RegExp(e[0],"g"),e[1]);e.strLine=u}renderPage(e,t,n){var s=e._pageIndex,l=e.getViewport({scale:t});let a=.8*l.width;var o=document.createElement("canvas"),d=document.getElementById("page-"+s);null==d||d.appendChild(o),o.id="canvas"+s;var h=o.getContext("2d",{alpha:!1});o.height=l.height,o.width=l.width,o.style.height=l.height*a/l.width+"px",o.style.width=a+"px",d&&(d.style.width=o.style.width,d.style.height=o.style.height);let c={canvasContext:h,transform:[1,0,0,1,0,0],viewport:l,annotationMode:pdfjsLib.AnnotationMode.ENABLE_FORMS,optionalContentConfigPromise:this.optionalContentConfigPromise,annotationCanvasMap:new Map,pageColors:{background:"Canvas",foreground:"CanvasText"}};e.render(c).promise.then(function(){n&&n(h,e._pageIndex,l)})}constructor(){let e=document.createElement("canvas");this.tempCanvas=e.getContext("2d"),this.ascentCache=new Map,this.imageCache=[]}}e.exports=class{get totalNumberQuestion(){return this.questionList.filter(e=>e.tempData.isSelect&&e.answers.length).length}updateStatusCallback(e){}onCompleteCallback(e,t){e.length>0?(this.startQuestion=e[0].num,this.labelHolderSize.width=2*t[0].canvas.width,this.rootQuestionInfo=e,this.rootCanvases=t.map(e=>e.canvas),this.rootHeaderPosition={pageIndex:0,top:1,left:e[0].positions[0].left,width:e[0].positions[0].left+e[0].positions[0].width<t[0].canvas.width?e[0].positions[0].width:t[0].canvas.width-e[0].positions[0].left,heigh:e[0].positions[0].top-1},this.processData()):(this.errAnalyzingPdf=!0,this.isShowLoadingFileExam=!1)}cloneCanvas(){let e=this.rootCanvases;for(let t=0;t<e.length;t++){let n=e[t],s=document.createElement("canvas");s.width=n.width,s.height=n.height;let l=document.createElement("canvas");l.width=n.width,l.height=n.height;let a=s.getContext("2d");null==a||a.drawImage(n,0,0,n.width,n.height,0,0,n.width,n.height);let o=l.getContext("2d");null==o||o.drawImage(n,0,0,n.width,n.height,0,0,n.width,n.height),a&&o&&this.clonedCtxForCreate.push(o)}}processData(){this.questionList=[],this.abcdLabelPos={},this.groupImages={},this.totalInGroupTracking=0,this.questionLabelMap=[],this.groupLengths=[],this.countGroup=0,this.labelsUrls=[],this.labelsBase64s=[],this.firstInGroupIndexes=[],this.clonedCtxForCreate=[],this.cloneCanvas();let e=this.clonedCtxForCreate[0].canvas.width;this.rootQuestionInfo.forEach(t=>{t.positions.forEach(t=>{t.width+t.left>e&&(t.width=e-t.left)})});let t=this.rootQuestionInfo,n=this.clonedCtxForCreate;t.forEach(e=>{e.remove.heigh=Math.round(e.remove.heigh),e.remove.width=Math.round(e.remove.width),e.remove.top=Math.round(e.remove.top),e.remove.left=Math.round(e.remove.left),e.positions.forEach(e=>{e.heigh=Math.round(e.heigh),e.width=Math.round(e.width),e.top=Math.round(e.top),e.left=Math.round(e.left)}),e.help&&(e.help.remove&&(e.help.remove.heigh=Math.round(e.help.remove.heigh),e.help.remove.width=Math.round(e.help.remove.width),e.help.remove.left=Math.round(e.help.remove.left),e.help.remove.top=Math.round(e.help.remove.top)),e.help.positions.forEach(e=>{e.heigh=Math.round(e.heigh),e.width=Math.round(e.width),e.top=Math.round(e.top),e.left=Math.round(e.left)})),e.answers.length>0&&e.answers.forEach(e=>{e.remove.heigh=Math.round(e.remove.heigh),e.remove.width=Math.round(e.remove.width),e.remove.top=Math.round(e.remove.top),e.remove.left=Math.round(e.remove.left),e.positions.forEach(e=>{e.heigh=Math.round(e.heigh),e.width=Math.round(e.width),e.top=Math.round(e.top),e.left=Math.round(e.left)})})});let s=document.createElement("canvas");s.width=this.labelHolderSize.width,s.height=this.labelHolderSize.height;let l=s.getContext("2d"),a=0,o=()=>{l&&(this.labelsBase64s[a]=l.canvas.toDataURL("image/png"),a++,l.clearRect(0,0,l.canvas.width,l.canvas.height)),h.left=0,h.top=0},d=0,h={left:0,top:0,locate:0},c=[],u=e=>{let t=!0;for(let n=0;n<e.length;n++)if(1==e[n].remove.width||1==e[n].remove.heigh){t=!1;break}return t};t.forEach(e=>{c.push(e.answers.length)});for(let e=0;e<t.length;e++)if(u(t[e].answers)&&t[e].answers.length==Math.max(...c)){t[e].answers.forEach(e=>{null==l||l.drawImage(n[e.remove.pageIndex].canvas,e.remove.left,e.remove.top,e.remove.width,e.remove.heigh,h.left,h.top,e.remove.width,e.remove.heigh),this.abcdLabelPos[e.label]={left:h.left,top:h.top},h.left=h.left+e.remove.width+5});break}this.examHeader=this.cropperService.getSingleImgData(this.rootHeaderPosition,n);for(let e=0;e<t.length;e++){let s={isFixAns:t[e].isFixAns?1:0,forcedFixAns:!!t[e].isFixAns,groupType:0,original:"",debugView:"",group:t[e].group,groupUrl:this.groupImages["image_group_".concat(t[e].group)]?this.groupImages["image_group_".concat(t[e].group)]:"",question:{label:t[e].num,posit:{top:0,left:0,locate:0},url:"",urlExcludeLabelOnly:"",width:1,height:1,remove:{x:1,y:1,width:1,height:1,url:this.cropperService.getSingleImgData(t[e].remove,n),left:0,top:0}},answers:[],help:{num:t[e].num,url:""},tempData:{sort:e,point:0,answerType:1,answerConfig:{},answerResult:[],isShowAttach:!1,questionMedia:[],isSelect:!0,isShowHelp:!1},rootIndex:e},c=t[e].positions;if(s.original=this.cropperService.getScatteredImgData(c,n),t[e].isGroup){this.groupLengths.push(this.totalInGroupTracking),this.totalInGroupTracking=0,this.countGroup++,s.isGroup=!0;var x=this.cropperService.getScatteredImgData(t[e].positions,n);this.groupImages["image_group_".concat(t[e].num)]=x}else{d++,this.totalInGroupTracking++,l&&0!=d&&h.left+t[e].remove.width>l.canvas.width?(h.left=0,h.top=h.top+this.maxQuestionLabelHeight+5,this.maxQuestionLabelHeight=0,l&&h.top+t[e].remove.heigh>l.canvas.height&&o(),null==l||l.drawImage(n[t[e].remove.pageIndex].canvas,t[e].remove.left,t[e].remove.top,t[e].remove.width,t[e].remove.heigh,h.left,h.top,t[e].remove.width,t[e].remove.heigh),s.question.remove.left=h.left,s.question.remove.top=h.top,this.questionLabelMap.push({locate:a,left:h.left,top:h.top,width:t[e].remove.width,height:t[e].remove.heigh}),h.left=h.left+t[e].remove.width+5):(l&&h.top+t[e].remove.heigh>l.canvas.height&&o(),null==l||l.drawImage(n[t[e].remove.pageIndex].canvas,t[e].remove.left,t[e].remove.top,t[e].remove.width,t[e].remove.heigh,h.left,h.top,t[e].remove.width,t[e].remove.heigh),s.question.remove.left=h.left,s.question.remove.top=h.top,this.questionLabelMap.push({locate:a,left:h.left,top:h.top,width:t[e].remove.width,height:t[e].remove.heigh}),h.left=h.left+t[e].remove.width+5,t[e].remove.heigh>this.maxQuestionLabelHeight&&(this.maxQuestionLabelHeight=t[e].remove.heigh)),this.cropperService.fillColor("#ffffff",n[t[e].remove.pageIndex],t[e].remove.left,t[e].remove.top,t[e].remove.width,t[e].remove.heigh),s.question.urlExcludeLabelOnly=1==c.length?this.cropperService.getSingleImgData(c[0],n):this.cropperService.getScatteredImgData(c,n),s.question.remove.x=t[e].remove.left-c[0].left,s.question.remove.y=t[e].remove.top-c[0].top,s.question.remove.width=t[e].remove.width,s.question.remove.height=t[e].remove.heigh,t[e].answers.length>0?t[e].answers.forEach(e=>{let t={label:e.label,posit:{left:0,top:0,locate:0},url:"",x:e.positions[0].left-c[0].left,y:e.positions[0].top-c[0].top,width:1,height:1,remove:{x:e.remove.left-c[0].left,y:e.remove.top-c[0].top,xAns:e.remove.left-e.positions[0].left,yAns:e.remove.top-e.positions[0].top,width:e.remove.width,height:e.remove.heigh,url:this.cropperService.getSingleImgData(e.remove,n),left:0,top:0}};if(c.length>1&&c[0].pageIndex!==e.remove.pageIndex&&(t.remove.y=e.remove.top-c[1].top+c[0].heigh),this.cropperService.fillColor("#ffffff",n[e.remove.pageIndex],e.remove.left,e.remove.top,e.remove.width,e.remove.heigh),c.length>1){for(let n=0;n<c.length;n++)if(c[n].pageIndex==e.positions[0].pageIndex){t.y=0==n?e.positions[0].top-c[n].top:e.positions[0].top-c[n].top+c[0].heigh;break}}if(e.isCorrect&&(s.tempData.answerResult=[e.label]),1==e.positions.length)t.url=this.cropperService.getSingleImgData(e.positions[0],n),t.width=e.positions[0].width,t.height=e.positions[0].heigh;else{t.url=this.cropperService.getScatteredImgData(e.positions,n);let s=e.positions.filter(e=>!e.inactive);t.width=this.cropperService.maxWidthTo(s.length,e.positions),t.height=this.cropperService.sumHighTo(s.length,e.positions)}s.answers.push(t),e.positions.forEach(e=>{this.cropperService.fillColor("#ffffff",n[e.pageIndex],e.left,e.top,e.width,e.heigh)})}):t[e].strAns&&void 0!==t[e].strAns?(s.tempData.answerType=4,s.tempData.answerResult.push(t[e].strAns||"")):s.tempData.answerType=3;let u=t[e].help;if(u&&(u.remove&&this.cropperService.fillColor("#ffffff",n[u.remove.pageIndex],u.remove.left,u.remove.top,u.remove.width,u.remove.heigh),u.positions&&u.positions.length>0&&(s.help.url=this.cropperService.getScatteredImgData(u.positions,n))),1==c.length){var p=c[0];if(s.answers.length){var[f]=s.answers;p.heigh=f.y}s.question.url=this.cropperService.getSingleImgData(p,n),s.question.width=p.width,s.question.height=p.heigh}else{s.question.url=this.cropperService.getScatteredImgData(c,n);let e=c.filter(e=>!e.inactive);s.question.width=this.cropperService.maxWidthTo(e.length,c),s.question.height=this.cropperService.sumHighTo(e.length,c)}this.questionList.push(s)}}for(let e=0;e<this.questionList.length;e++)this.questionList[e].tempData.point=this.totalNumberQuestion?Number(this.totalPoint/this.totalNumberQuestion):0,this.questionList[e].index=e;let m=0;for(let e=0;e<this.groupLengths.length;e++)this.firstInGroupIndexes.push(m+this.groupLengths[e]),m+=this.groupLengths[e];this.completeCropper()}generateIdRequired(e){let t="z",n="abcdefghijklmnopqrstuvwxyz0123456789",s=n.length;for(let l=0;l<e;l++)t+=n.charAt(Math.floor(Math.random()*s));return t}createElementImage(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;var n="";return t&&(n=' style="width:'.concat((100*t[1].width/t[0].width).toFixed(2),'%"')),e?'<p><img class="quill-image" src="'.concat(e,'"').concat(n,"/></p>"):""}completeCropper(){let e=[],t=[],n=this.quizId,s=(10/this.questionList.filter(e=>e.tempData.isSelect&&e.answers.length).length).toFixed(2);t=this.questionList.map(t=>{(!t.group||e.length+1!=t.group)&&(e.length||t.group)||e.push({id:this.generateIdRequired(7),quizId:n,questions:[],content:this.createElementImage(t.groupUrl),title:"",audios:[]});let l=e[e.length-1],a={id:this.generateIdRequired(7),content:this.createElementImage(t.question.url),quizId:n,groupId:l.id,point:t.tempData.isSelect&&t.answers.length?s:0,label:"C\xe2u",number:t.question.label,type:t.answers.length?"TN":"TL",options:t.answers.map(e=>({text:this.createElementImage(e.url,[t.question,e]),label:e.label})),explain:"",keys:t.tempData.answerResult||[],level:"",shuffle:!!t.isFixAns};return l.questions.push(a.id),a}),this.callback({status:"done",data:{groups:e,questions:t,quizId:this.quizId}})}parsePdf(e){let t=new v;t.loadPdf(e,e=>{let n=e.length,l=[],a=[],o=document.createElement("div");o.id="hiddenWrapper",o.style.width="1px",o.style.height="1px",o.style.overflow="hidden",o.style.opacity="0",o.style.zIndex="-9999",o.style.position="fixed",o.style.top="0",o.style.left="0",document.body.appendChild(o);let d=document.createElement("div"),h="canvasWrapper";d.id=h,o.appendChild(d);let c=new Date().getTime(),u=[];t.render(e,h,s.PdfConst.RENDER_SCALE,(t,s,o)=>{if(null!=t&&(l[s]=t,a[s]=o),u.push(1),this.updateStatusCallback&&this.updateStatusCallback("Rendering: ".concat(u.length,"/").concat(n)),u.length==n){let t=new Date().getTime();this.updateStatusCallback&&this.updateStatusCallback("Render done: "+(t-c)/1e3+" secs"),this.startAnalyze(l,a,e)}})})}startAnalyze(e,t,n){let l=n.length,o=[],d=[],h=[],u=[],p=new v,f=new Date().getTime();for(let m=0;m<l;m++){let g=m,v=p.getImages(n[m],g);for(let e of v)u.push(e);n[m].getTextContent().then(n=>{for(let e of v)n.items.push(this.imgToTextObj(e,n.items.length>0?n.items[0].fontName:""));var m,b=p.getLines(n,g,e[g],t[g]);if(d=d.concat(b),h[g]=n.styles,o.push(1),o.length==l){d.sort((e,t)=>1e7*e.pageIndex+(e.transform.length>0?e.transform[5]:0)-(1e7*t.pageIndex+(t.transform.length>0?t.transform[5]:0))),p.findAndSplitQuestAnsLine(d,h,e),""!=s.PdfConst.DRAW_RESULT&&console.log(d);let t=this.findEntityPos(d,h,e,p.imageCache,0),n=!1;for(let e of t)if(e.type==a.TYPE_NAME){n=!0;break}if(n||(t=this.findEntityPos(d,h,e,p.imageCache,1)),0==t.length)return void(this.onCompleteCallback&&this.onCompleteCallback([],e));let l=t[0].type==x.TYPE_NAME,o=l?JSON.parse(t[0].str):null,g=new Map,v=new Map;if(l){for(let e of o.main)g.set(e.num,e.str);for(let e of o.sub)v.set(e.num,e.str)}let b=this.getQuestionInfo(t,d,e,g);for(let e of(b.forEach(e=>{if(!g.has(e.num)&&!v.has(e.num)&&e.help&&e.help.text){let t=c.getAnsFromHelp(e.help.text);""!=t&&v.set(e.num,t)}}),b)){if(!e.isGroup&&0==e.answers.length&&g.has(e.num)){let t={pageIndex:e.remove.pageIndex,top:e.remove.top-1,left:e.remove.left-1,width:1,heigh:1};for(let n of["A","B","C","D"]){let s={label:n,remove:t,positions:[t]};g.get(e.num)==n&&(s.isCorrect=!0),e.answers.push(s)}e.isFixAns=!0}if(!e.isGroup&&0==e.answers.length&&!g.has(e.num)&&v.has(e.num)&&(e.strAns=v.get(e.num)),!e.isGroup&&e.answers.length>0&&!g.has(e.num)&&v.has(e.num))for(let t of e.answers)t.label==(null===(m=v.get(e.num))||void 0===m?void 0:m.toUpperCase().substring(0,1))&&(t.isCorrect=!0)}let C=new Date().getTime();this.updateStatusCallback&&this.updateStatusCallback("Analyze done: "+(C-f)/1e3+" secs"),this.showOnCanvas(b,t,d,e,u,s.PdfConst.DRAW_RESULT),this.onCompleteCallback&&this.onCompleteCallback(b,e)}})}}imgToTextObj(e,t){return{str:"img",fontName:t,width:e.paintWidth,height:e.paintHeight,transform:[-999,0,0,0,-e.left,-e.top-e.paintHeight]}}findEntityPos(e,t,n,s,l){let m=[],v=!1;var b=[{parser:new o,on:[],off:[]},{parser:new a(l),on:[3,4],off:[6]},{parser:new d,on:[3,6],off:[]},{parser:new h(!1),on:[6,8],off:[0,2]},{parser:new c(!1),on:[6,8],off:[0,2,4]},{parser:new u,on:[],off:[8]},{parser:new x(!1,e=>{for(let t of e)m.unshift(t)}),on:[],off:[2]},{parser:new p,on:[],off:[]},{parser:new f(!1,e=>{if(0!=e.length){if(m.length>0&&m[0].type==x.TYPE_NAME){let t=JSON.parse(e[0].str),n=JSON.parse(m[0].str);n.sub=t.sub,m[0].str=JSON.stringify(n)}else e[0].type=x.TYPE_NAME,m.unshift(e[0])}}),on:[],off:[2]}],C=[8,0,1,2,3,4,5,6,7],j=null;let T=0,y="";for(let s of e){for(let l of((T==e.length-1||s.pageIndex<e[T+1].pageIndex)&&(s.isLastLine=!0),C)){let e=b[l];var I=e.parser.process(m,s,T,j,t[s.pageIndex],n[s.pageIndex]);if(I.length>0){for(let e of I){if(e.type!=d.TYPE_NAME&&e.type!=p.TYPE_NAME&&(y=""),e.type==d.TYPE_NAME){if(!"ABCDEFGH".startsWith(y+e.str))continue;y+=e.str;for(let e=m.length-1;e>=0&&m[e].type==o.TYPE_NAME;e--)m.splice(e,1)}e.type==p.TYPE_NAME&&(s.isFooter=!0),e.type==c.TYPE_NAME&&(v=!0),e.type==u.TYPE_NAME&&v&&b[5].parser.off(),m.push(e)}for(let t of e.on)b[t].parser.on();for(let t of e.off)b[t].parser.off();break}}j=s,T++}for(let e of b)e.parser.off();return m.forEach(t=>{if(!e[t.lineIndex].top){let n=g.getTopLine(s[t.pageIndex],t.lineIndex,e);e[t.lineIndex].top=n[0],1!=t.isIntersec&&(t.isIntersec=n[1])}}),m.forEach(t=>{if(!e[t.lineIndex].bottom){let n=g.getBottomLine(s[t.pageIndex],t.lineIndex,e);e[t.lineIndex].bottom=n[0],1!=t.isIntersec&&(t.isIntersec=n[0])}}),m}showOnCanvas(e,t,n,l,f,m){let v=new Date().getTime(),b=new Map([["A","rgba(18, 0, 255, 0.4)"],["B","rgba(0, 158, 34, 0.4)"],["C","rgba(50, 50, 50, 0.4)"],["D","rgba(132, 0, 137, 0.4)"],["E","rgba(132, 0, 137, 0.4)"],["F","rgba(132, 0, 137, 0.4)"],["G","rgba(132, 0, 137, 0.4)"],["H","rgba(132, 0, 137, 0.4)"]]),C=new Map([[a.TYPE_NAME,"red"],[d.TYPE_NAME,"blue"],[h.TYPE_NAME,"gray"],[x.TYPE_NAME,"green"],[c.TYPE_NAME,"orange"],[u.TYPE_NAME,"pink"],[p.TYPE_NAME,"yellow"],[o.TYPE_NAME,"black"]]);if(m.indexOf("quest")>=0)for(let t of e){for(let e of t.positions)g.drawBox(l[e.pageIndex],t.isGroup?"black":"red",e);for(let e of(g.drawBox(l[t.remove.pageIndex],"yellow",t.remove),t.answers)){for(let t of e.positions)g.drawBox(l[t.pageIndex],b.get(e.label)+"",t,!0);g.drawBox(l[e.remove.pageIndex],"yellow",e.remove),e.isCorrect&&g.drawPoint(l[e.positions[0].pageIndex],"green",e.positions[0])}if(t.help){for(let e of t.help.positions)g.drawBox(l[e.pageIndex],"orange",e);t.help.remove&&g.drawBox(l[t.help.remove.pageIndex],"yellow",t.help.remove)}}if(m.indexOf("line")>=0)for(let e of n)g.drawBox2(l[e.pageIndex],e.height<s.PdfConst.LINE_SMALL_HEIGHT?"red":"rgba(50, 58, 168, 0.4)",e.width,e.height,e.transform);if(m.indexOf("txt")>=0)for(let e of n)for(let t of e.textObjs)""!=t.str.trim()&&g.drawBox2(l[e.pageIndex],e.height<s.PdfConst.LINE_SMALL_HEIGHT?"red":"rgba(132, 0, 137, 0.2)",t.width,t.height,t.transform);if(m.indexOf("img")>=0)for(let e of f)g.drawBox2(l[e.pageIndex],"green",e.paintWidth,e.paintHeight,[0,0,0,0,-e.left,-e.top-e.paintHeight]);if(m.indexOf("pos")>=0)for(let e of t){let t={top:e.transform[5],left:e.transform[4],width:0,heigh:0,pageIndex:e.pageIndex};g.drawPoint(l[e.pageIndex],C.get(e.type)+"",t)}let j=new Date().getTime();this.updateStatusCallback&&this.updateStatusCallback("Draw done: "+(j-v)/1e3+" secs")}getQuestionInfo(e,t,n,l){if(0==e.length)return[];let x=0,f=[],m=new Map,g="",v=!1,b=!1,C=0;for(let j of(e.forEach((n,s)=>{s>0&&null==e[s-1].text&&(e[s-1].text=t.slice(e[s-1].lineIndex,n.lineIndex)),s==e.length-1&&(e[s].text=t.slice(e[s].lineIndex,t.length))}),e.forEach(j=>{let T=":"+j.type;v||j.type!=h.TYPE_NAME&&j.type!=c.TYPE_NAME||(v=!0);let y=null;for(let t=x+1;t<e.length;t++)if((j.type!=a.TYPE_NAME||e[t].type!=d.TYPE_NAME)&&e[t].type!=p.TYPE_NAME){y=e[t];break}let I=n[j.pageIndex].canvas.height-20;if(v||j.type!=o.TYPE_NAME||(C++,f.push({num:C,answers:[],remove:o.getRemoveBox(j,t),positions:o.getBoxes(j,t,y,I),isGroup:!0,text:j.text})),v||j.type!=a.TYPE_NAME||f.push({num:+j.str,answers:[],remove:a.getRemoveBox(j,t),positions:a.getBoxes(j,t,y,I),group:C,text:j.text}),!v&&j.type==d.TYPE_NAME&&f.length>0){let e=f[f.length-1].num,n={label:j.str,remove:d.getRemoveBox(j,t),positions:d.getBoxes(j,t,y,I)};l.size>0&&l.get(e)==n.label&&(n.isCorrect=!0),f[f.length-1].answers.push(n);let a=t[j.lineIndex].strLine.replace(/\|/g,"").trim().match(s.PdfConst.MULTIPLE_ANS_PATTERN.join("|"));null!=a&&a.length>0&&(f[f.length-1].isFixAns=!0),1==j.isIntersec&&(f[f.length-1].isFixAns=!0)}if(!b&&j.type==u.TYPE_NAME&&1==f.length&&g.endsWith(":".concat(a.TYPE_NAME,":").concat(d.TYPE_NAME))&&(b=!0),j.type==u.TYPE_NAME&&b){let e=f[f.length-1].num;m.set(e,{num:e,positions:u.getBoxes(j,t,y,I),text:j.text})}if(j.type!=u.TYPE_NAME||b||(m.clear(),v=!0),v&&j.type==a.TYPE_NAME){let e=+j.str;m.get(e)||m.set(e,{num:e,positions:a.getBoxes(j,t,y,I),remove:a.getRemoveBox(j,t),text:j.text})}g.endsWith(T)||j.type==p.TYPE_NAME||(g+=T),x++}),f))j.isGroup||(j.help=m.get(j.num),1==j.answers.length&&(j.answers=[]));return f}constructor(e,t){var n,l,a;this.cropperService=new m,this.labelHolderSize={width:3500,height:3500},this.totalPoint=10,this.quizId=e,this.callback=t;let o={RENDER_SCALE:2,LINE_SMALL_HEIGHT:8,SPLIT_MARGIN:3,INTERSEC_MARGIN:10,LINE_MAGIN:2,MARGIN_LEFT:2,ENABLE_IMAGE_PROCESS:!0,STEP_SIZE:3,CROP_FULL_WIDTH:!0,OVERLAP:.5,QUESTION_PATTERN:["(^c\xe2u\\s*\\d{1,4}[^0-9])","(^câu\\s*\\d{1,4}[^0-9])","(^c\xa9u\\s*\\d{1,4}[^0-9])","(^ca‚u\\s*\\d{1,4}[^0-9])","(^b\xe0i\\s*\\d{1,4}[^0-9])","(^bài\\s*\\d{1,4}[^0-9])","(^cau\\s*\\d{1,4}[^0-9])","(^bai\\s*\\d{1,4}[^0-9])","(^question\\s*\\d{1,4}[^0-9])","(^questions\\s*\\d{1,4}[^0-9])","(^\\[\\d{1,4}\\][^0-9])","(^\\d+\\s*\\(nb\\))","(^\\d+\\s*\\(th\\))","(^\\d+\\s*\\(vd\\))","(^\\d+\\s*\\(vdc\\))","(^c\xe2u\\s*\\d{1,4}[\\s\\.:]*$)","(^câu\\s*\\d{1,4}[\\s\\.:]*$)","(^c\xa9u\\s*\\d{1,4}[\\s\\.:]*$)","(^ca‚u\\s*\\d{1,4}[\\s\\.:]*$)","(^b\xe0i\\s*\\d{1,4}[\\s\\.:]*$)","(^bài\\s*\\d{1,4}[\\s\\.:]*$)","(^cau\\s*\\d{1,4}[\\s\\.:]*$)","(^bai\\s*\\d{1,4}[\\s\\.:]*$)","(^questions\\s*\\d{1,4}[\\s\\.:]*$)","(^question\\s*\\d{1,4}[\\s\\.:]*$)"],QUESTION_PATTERN2:["(^(\\d+\\s*\\.)\\s*[\\.0-9])","(^(\\d+\\s*\\.)\\s*\\(\\s*\\d+\\s*\\))","(^(\\d+\\s*\\.)\\s*[^\\s]\\s*[^\\s0-9])","(^\\d+\\s*\\.\\s*$)"],BREAK_LINE_PATTERN:["(^C\xe2u\\s*\\d+\\s*[:\\.]\\s*[Aa]\\s*\\.)","(^C\xa9u\\s*\\d+\\s*[:\\.]\\s*[Aa]\\s*\\.)","(^B\xe0i\\s*\\d+\\s*[:\\.]\\s*[Aa]\\s*\\.)","(^Cau\\s*\\d+\\s*[:\\.]\\s*[Aa]\\s*\\.)","(^Bai\\s*\\d+\\s*[:\\.]\\s*[Aa]\\s*\\.)","(^Question\\s*\\d+\\s*[:\\.]\\s*[Aa]\\s*\\.)","(^\\d+\\s*[:\\.]\\s*[Aa]\\s*\\.)"],SECTION_PATTERN_LOWER:["(^mark\\s*the\\s*letter)","(^read\\s*the\\s*follow)","(^reading\\s*the\\s*follow)","(^read\\s*the\\s*text)","(^read\\s*the\\s*passage)","(^read\\s*the\\s*paragraph)","(^read\\s*and\\s*choose)","(^put\\s*these\\s*word)","(^supply\\s*the\\s*correct)","(^make\\s*questions?\\s*for)","(^fill\\s*in\\s*the\\s*blank)","(^fill\\s*in\\s*each\\s*numbered)","(write\\s*the\\s*months\\s*in\\s*english)","(write\\s*the\\s*telephone\\s*numbers\\s*in\\s*english)","(^which\\s*of\\s*the\\s*following)","(^choose\\s*the\\s*suitable\\s*word)","(^choose\\s*the\\s*word)","(^choose\\s*the\\s*option)","(^choose\\s*the\\s*item\\s*among)","(^choose\\s*the\\s*underlined\\s*word)","(^combine\\s*two\\s*sentences)","(^each\\s*of\\s*the\\s*following)","(^finish\\s*the\\s*second\\s*sentence)","(^identify\\s*the\\s*underlined)","(^identify\\s*a\\s*mistake)","(^indicate\\s*the\\s*word)","(^indicate\\s*the\\s*correct)","(^indicate\\s*the\\s*sentence)","(^indicate\\s*the\\s*underlined)","(^circle\\s*the\\s*underlined)","(^circle\\s*the\\s*word\\s*whose\\s*underlined)","(^choose\\s*the\\s*underlined)","(^\\*?find\\s*the\\s*word)","(^find\\s*a\\s*mistake)","(^fill\\s*the\\s*circle)","(^listen\\s*to.*conversation)","(^there\\s*are.*blanks\\s*in\\s*the\\s*passage\\s*below)","(^listen\\s*to\\s*the\\s*recording)","(^listen\\s*and\\s*circle)","(^listen\\s*again\\s*and\\s*choose)","(^\\*?listen\\s*and\\s*complete)","(^\\*?choose\\s*the\\s*best)","(^choose\\s*the\\s*correct)","(^put\\s*in\\s*the\\s*correct)","(^complete\\s*the\\s*second\\s*sentence)","(^complete\\s*the\\s*sentences)","(^give\\s*the\\s*correct\\s*form)","(^mark\\s*a,\\s*b,)","(^circle\\s*the\\s*letter)","(^you\\s*will\\s*hear)","(^blacken\\s*the\\s*letter)","(^đọc\\s*đoạn\\s*tr\xedch)","(^dựa\\s*v\xe0o\\s*th\xf4ng\\s*tin\\s*dưới\\s*đ\xe2y)","(^dựa\\s*v\xe0o\\s*c\xe1c\\s*th\xf4ng\\s*tin\\s*được\\s*cung\\s*cấp\\s*dưới\\s*đ\xe2y)","(^section\\s*[0-9abcdefghivx]+)","(^part[^a-z]+[0-9abcdefghivx]+\\s*[\\.:\\-])","(^phần\\s*[0-9abcdefivx]+[\\.:])","(^nh\xf3m\\s*[0-9abcdefivx]+[\\.:])","(^chương\\s*[0-9abcdefivx]+[\\.:])","(^questions?\\s*\\d+\\s*[\\–\\-to]+\\s*\\d+)","(^passage\\s*[0-9abcdefghivx]+)","(^use\\s*the\\s*word\\s*given\\s*in\\s*capitals)","(^tự\\s*luận)"],SECTION_PATTERN_NORMAL:["(^[IVX]+\\s*[\\.\\-\\–]\\s*[A-Z\xc0Ả\xc3\xc1ẠĂẰẲẴẮẶ\xc2ẦẨẪẤẬĐ\xc8ẺẼ\xc9Ẹ\xcaỀỂỄẾỆ\xccỈĨ\xcdỊ\xd2Ỏ\xd5\xd3Ọ\xd4ỒỔỖỐỘƠỜỞỠỚỢ\xd9ỦŨ\xdaỤƯỪỬỮỨỰỲỶỸ\xddỴ]+)","(^[\\d]+\\.[\\d]+\\.[\\d]*\\.*\\s*[A-Z\xc0Ả\xc3\xc1ẠĂẰẲẴẮẶ\xc2ẦẨẪẤẬĐ\xc8ẺẼ\xc9Ẹ\xcaỀỂỄẾỆ\xccỈĨ\xcdỊ\xd2Ỏ\xd5\xd3Ọ\xd4ỒỔỖỐỘƠỜỞỠỚỢ\xd9ỦŨ\xdaỤƯỪỬỮỨỰỲỶỸ\xddỴ]+)","(^[IVX]+\\s*[\\.:]\\s*$)"],KICK_PATTERN:["(^Chọn\\s*[ABВCDEFGHIJK]+)","(^Chon\\s*[ABВCDEFGHIJK]+)"],TVCN_CHAR:[["Α","A"],["В","B"]],HET_PATTERN:["(HẾT)","(H\xcáT)","(HET)","(\\-\\-HT\\-\\-)","(THE\\s*END)","(The\\s*end[^a-z0-9]*$)","(^[^A-Za-z]*Hết[^A-Za-z]*)$"],DAPAN_PATTERN:["(\xc1P \xc1N)","(\xc1P \xc1)","(\xc1P\xc1N)","(ÁP ÁN)","(BẢNG\xc1\xc1)","(KHO\xc1\\s*C\xc2U\\s*TRẮC\\s*NGHIỆM)","(ÁPÁN)","(ANSWER KEYS)","(^KEYS$)","(Bảng\\s*đ\xe1p\\s*\xe1n)","(Đ\xe1p\\s*\xe1n\\s*v\xe0\\s*hướng)","(Dap\\s*an\\s*va\\s*huong)","(Đ\xe1p\\s*\xe1n\\s*[.:]\\s*$)","(Đ\xe1p\\s*\xe1n\\s*$)"],HUONGDAN_PATTERN:["(HƯỚNG\\s*DẪN)","(ƯỚNG\\s*DẪN\\s*GIẢI\\s*CHI)","(GIẢI\\s*TH\xcdCH\\s*CHI\\s*TIẾT)","(Hướng\\s*dẫn\\s*giải)","(Lời\\s*giải)","(LỜI\\s*GIẢI)","(GIẢI\\s*CHI\\s*TIẾT)","(HD:)","(GLOSSARY)"],MULTIPLE_ANS_PATTERN:["([ABCDEFGH]\\s*v\xe0\\s*[ABCDEFGH]\\s*đều)","(Cả\\s*[ABCDEFGH]\\s*v\xe0\\s*[ABCDEFGH])","(Cả\\s*[ABCDEFGH]\\s*,\\s*[ABCDEFGH])","(Cả\\s*3\\s*đ\xe1p\\s*\xe1n)","(Cả\\s*đ\xe1p\\s*\xe1n)","(Tất\\s*cả\\s*đ\xe1p\\s*\xe1n)","(Kết\\s*quả\\s*kh\xe1c)","(Đ\xe1p\\s*\xe1n\\s*kh\xe1c)","(Đ\xe1p\\s*\xe1n\\s*[ABCDEFGH]\\s*v\xe0\\s*[ABCDEFGH])","(Tất\\s*cả\\s*đều)"],DRAW_RESULT:"",SKIP_CHAR:["","√","p","(",")","[","]","{","}",""],FOOTER_PATTERN:["(trang\\s*\\d+)","(Page\\s*\\d+)","(Trang\\s*\\d+)","(TRANG\\s*\\d+)","(^\\d{1,4}$)","(^[\\-\\s]*\\d{1,4}[\\-\\s]*$)"],HELP_ANS_PATTERN:["([\\s\\.]*Chọn\\s*([A-K]))","([\\d\\s\\.:]*Đ\xe1p\\s*\xe1n\\s*([A-K]))","([\\d\\s\\.:]*Đ\xe1p\\s*\xe1n\\s*l\xe0\\s*([A-K]))","([\\d\\s\\.:]*Chọn\\s*đ\xe1p\\s*\xe1n\\s*([A-K]))"],RES_ANS_PATTERN:["(\\d+[.-][^|0-9])"],STRANS_SPLIT:"|/\\"};s.PdfConst.RENDER_SCALE=o.RENDER_SCALE,s.PdfConst.LINE_SMALL_HEIGHT=o.LINE_SMALL_HEIGHT*s.PdfConst.RENDER_SCALE,s.PdfConst.SPLIT_MARGIN=o.SPLIT_MARGIN*s.PdfConst.RENDER_SCALE,s.PdfConst.INTERSEC_MARGIN=o.INTERSEC_MARGIN*s.PdfConst.RENDER_SCALE,s.PdfConst.LINE_MAGIN=o.LINE_MAGIN*s.PdfConst.RENDER_SCALE,s.PdfConst.MARGIN_LEFT=o.MARGIN_LEFT*s.PdfConst.RENDER_SCALE,s.PdfConst.ENABLE_IMAGE_PROCESS=o.ENABLE_IMAGE_PROCESS,s.PdfConst.STEP_SIZE=o.STEP_SIZE,s.PdfConst.CROP_FULL_WIDTH=o.CROP_FULL_WIDTH,s.PdfConst.OVERLAP=o.OVERLAP,s.PdfConst.QUESTION_PATTERN=o.QUESTION_PATTERN,s.PdfConst.QUESTION_PATTERN2=o.QUESTION_PATTERN2,s.PdfConst.BREAK_LINE_PATTERN=o.BREAK_LINE_PATTERN,s.PdfConst.SECTION_PATTERN_LOWER=o.SECTION_PATTERN_LOWER,s.PdfConst.SECTION_PATTERN_NORMAL=o.SECTION_PATTERN_NORMAL,s.PdfConst.KICK_PATTERN=o.KICK_PATTERN,s.PdfConst.TVCN_CHAR=o.TVCN_CHAR,s.PdfConst.HET_PATTERN=o.HET_PATTERN,s.PdfConst.DAPAN_PATTERN=o.DAPAN_PATTERN,s.PdfConst.HUONGDAN_PATTERN=o.HUONGDAN_PATTERN,s.PdfConst.MULTIPLE_ANS_PATTERN=o.MULTIPLE_ANS_PATTERN,s.PdfConst.DRAW_RESULT=o.DRAW_RESULT,s.PdfConst.SKIP_CHAR=o.SKIP_CHAR,s.PdfConst.FOOTER_PATTERN=null!==(n=o.FOOTER_PATTERN)&&void 0!==n?n:["(trang\\s*\\d+)","(Page\\s*\\d+)","(Trang\\s*\\d+)","(TRANG\\s*\\d+)","(^\\d{1,4}$)"],s.PdfConst.HELP_ANS_PATTERN=null!==(l=o.HELP_ANS_PATTERN)&&void 0!==l?l:["([\\s\\.]*Chọn\\s*([ABCDEFGH]))"],s.PdfConst.ANS_PATTERN=null!==(a=o.ANS_PATTERN)&&void 0!==a?a:["([\\s\\|\\.]+[ABCDEFGHIJK][\\s\\|]*[\\.\\)])"]}}},6591:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});let s=n(8754),l=s._(n(6781)),a=s._(n(9716)),o=s._(n(1674)),d=(e,t)=>{var n=document.createElement("script");n.type="text/javascript",n.src=e,n.onload=t,n.onerror=e=>{console.log(e)},document.head.appendChild(n)},h=(e,t)=>{var n=0;!function s(){if(n<e.length){var l=e[n];d(o.default.assetPrefix+l,function(){n++,s()})}else"function"==typeof t&&t()}()},c=(e,t)=>{let n=document.createElement("input");n.setAttribute("type","file"),n.setAttribute("accept",".pdf,.docx"),n.click(),n.onchange=async()=>{let[s]=n.files;if(s){t({status:"loading",data:{status:"Đang xử l\xfd tệp tin"}});try{s.name.endsWith(".docx")?h(["/scripts/docx_v3.js","/scripts/SaxonJS2_v2.js","/scripts/sprintf.min.js","/scripts/bundle.js","/scripts/wmf.v1.js","/scripts/FromEMF.f1.js","/scripts/ToContext2D.f1.js","/scripts/UDOC.f1.js","/scripts/mathml2latex.js"],function(){let n=new l.default(e,t);n.parseDocx(s)}):s.name.endsWith(".pdf")?h(["/scripts/pdf.js","/scripts/pdf.worker.js"],function(){let n=new a.default(e,t);n.parsePdf(s)}):t({error:"Định dạng kh\xf4ng hỗ trợ. Vui l\xf2ng sử dụng tập tin định dạng .pdf hoặc .docx"})}catch(e){console.error("Error uploading image:",e),t({error:"Error uploading image:"})}}}};e.exports={ImportFile:c}},3401:function(e,t,n){"use strict";n.r(t);var s=n(5893),l=n(7294),a=n(1649),o=n(2078),d=n(131),h=n(6822),c=n(3321),u=n(948),x=n(5861),p=n(9581),f=n(1425),m=n(3946),g=n(8462),v=n(2852),b=n(9334),C=n(8987),j=n(5438),T=n(3395),y=n(8619),I=n(4386),w=n(9878);let E=(0,u.ZP)(m.Z)(e=>{let{theme:t}=e;return{top:0,right:0,color:"grey.500",position:"absolute",boxShadow:t.shadows[2],transform:"translate(10px, -10px)",borderRadius:t.shape.borderRadius,backgroundColor:"".concat(t.palette.background.paper," !important"),transition:"transform 0.25s ease-in-out, box-shadow 0.25s ease-in-out","&:hover":{transform:"translate(7px, -5px)"}}}),A=[{key:"upper",title:"Bỏ qua chữ hoa",icon:"tabler:letter-case-lower",subtitle:'"Đ\xe1p \xe1n" th\xe0nh "đ\xe1p \xe1n"'},{key:"sign",title:"Bỏ qua dấu c\xe2u",icon:"tabler:bolt",subtitle:'"Đ\xe1p \xe1n" th\xe0nh "dap an"'},{key:"space",title:"Bỏ qua dấu c\xe1ch",icon:"tabler:separator-vertical",subtitle:'"Đ\xe1p \xe1n" th\xe0nh "Đ\xe1p\xe1n"'}];t.default=()=>{let e=(0,a.v9)(e=>e.popup.data),t=(0,a.I0)(),[n,u]=(0,l.useState)(e),P=()=>{t((0,o.z)({status:""}))},Z=e=>()=>{u({...n,...e})},S=()=>{let{questionId:e,title:s,...l}=n;t((0,d.Ds)({id:e,settings:l})),P()},N=()=>{let{questionId:e,title:s,...l}=n;t((0,d.Zw)({questionId:e,type:"settings",value:l,list:"exam"})),P()};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(p.Z,{sx:{pb:e=>"".concat(e.spacing(8)," !important"),px:e=>["".concat(e.spacing(5)," !important"),"".concat(e.spacing(15)," !important")],pt:e=>["".concat(e.spacing(8)," !important"),"".concat(e.spacing(12.5)," !important")]},children:[(0,s.jsx)(E,{onClick:P,children:(0,s.jsx)(w.Z,{icon:"tabler:x",fontSize:"1.25rem"})}),(0,s.jsx)(h.Z,{sx:{mb:5,textAlign:"center"},children:(0,s.jsx)(x.Z,{variant:"h5",sx:{mb:3},children:n.title})}),(0,s.jsx)(g.Z,{subheader:(0,s.jsx)(j.Z,{children:"C\xe0i đặt"}),children:A.map(e=>(0,s.jsxs)(y.Z,{onClick:Z({[e.key]:!n[e.key]}),divider:!0,children:[(0,s.jsx)(C.Z,{children:(0,s.jsx)(w.Z,{icon:e.icon,fontSize:20})}),(0,s.jsxs)(b.Z,{children:[e.title,(0,s.jsx)(I.Z,{title:e.subtitle,children:(0,s.jsx)(m.Z,{size:"small",children:(0,s.jsx)(w.Z,{icon:"tabler:info-square-rounded",fontSize:20})})})]}),(0,s.jsx)(T.Z,{children:(0,s.jsx)(v.Z,{edge:"end",checked:n[e.key]||!1})})]},e.key))})]}),(0,s.jsxs)(f.Z,{sx:{justifyContent:"center",px:e=>["".concat(e.spacing(5)," !important"),"".concat(e.spacing(15)," !important")],pb:e=>["".concat(e.spacing(8)," !important"),"".concat(e.spacing(12.5)," !important")]},children:[(0,s.jsx)(c.Z,{variant:"tonal",color:"secondary",onClick:P,children:"Hủy"}),(0,s.jsx)(c.Z,{variant:"contained",sx:{mr:1},onClick:S,children:"Lưu"}),(0,s.jsx)(c.Z,{variant:"contained",sx:{mr:1},onClick:N,color:"success",children:"\xc1p dụng cho c\xe1c c\xe2u c\xf2n lại"})]})]})}}},function(e){e.O(0,[265,500,774,888,179],function(){return e(e.s=5603)}),_N_E=e.O()}]);