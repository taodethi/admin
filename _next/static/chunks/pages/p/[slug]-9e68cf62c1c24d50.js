(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[871],{5603:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/p/[slug]",function(){return n(2075)}])},6476:function(e,t,n){"use strict";var s=n(5893),l=n(7294),o=n(948),a=n(1903);let c=(0,o.ZP)(a.Z)(e=>{let{theme:t}=e;return{alignItems:"flex-start","& .MuiInputLabel-root":{transform:"none",lineHeight:1.154,position:"relative",marginBottom:t.spacing(1),fontSize:t.typography.body2.fontSize,color:"".concat(t.palette.text.primary," !important")},"& .MuiInputBase-root":{borderRadius:8,backgroundColor:"transparent !important",border:"1px solid rgba(".concat(t.palette.customColors.main,", 0.2)"),transition:t.transitions.create(["border-color","box-shadow"],{duration:t.transitions.duration.shorter}),"&:not(.Mui-focused):not(.Mui-disabled):not(.Mui-error):hover":{borderColor:"rgba(".concat(t.palette.customColors.main,", 0.28)")},"&:before, &:after":{display:"none"},"&.MuiInputBase-sizeSmall":{borderRadius:6},"&.Mui-error":{borderColor:t.palette.error.main},"&.Mui-focused":{boxShadow:t.shadows[2],"& .MuiInputBase-input:not(.MuiInputBase-readOnly):not([readonly])::placeholder":{transform:"translateX(4px)"},"&.MuiInputBase-colorPrimary":{borderColor:t.palette.primary.main},"&.MuiInputBase-colorSecondary":{borderColor:t.palette.secondary.main},"&.MuiInputBase-colorInfo":{borderColor:t.palette.info.main},"&.MuiInputBase-colorSuccess":{borderColor:t.palette.success.main},"&.MuiInputBase-colorWarning":{borderColor:t.palette.warning.main},"&.MuiInputBase-colorError":{borderColor:t.palette.error.main},"&.Mui-error":{borderColor:t.palette.error.main}},"&.Mui-disabled":{backgroundColor:"".concat(t.palette.action.selected," !important")},"& .MuiInputAdornment-root":{marginTop:"0 !important"}},"& .MuiInputBase-input":{color:t.palette.text.secondary,"&:not(textarea)":{padding:"15.5px 13px"},"&:not(textarea).MuiInputBase-inputSizeSmall":{padding:"7.5px 13px"},"&:not(.MuiInputBase-readOnly):not([readonly])::placeholder":{transition:t.transitions.create(["opacity","transform"],{duration:t.transitions.duration.shorter})},"&.MuiInputBase-inputAdornedStart:not(.MuiAutocomplete-input)":{paddingLeft:0},"&.MuiInputBase-inputAdornedEnd:not(.MuiAutocomplete-input)":{paddingRight:0}},"& .MuiFormHelperText-root":{lineHeight:1.154,margin:t.spacing(1,0,0),color:t.palette.text.secondary,fontSize:t.typography.body2.fontSize,"&.Mui-error":{color:t.palette.error.main}},"& .MuiSelect-select:focus, & .MuiNativeSelect-select:focus":{backgroundColor:"transparent"},"& .MuiSelect-filled .MuiChip-root":{height:22},"& .MuiAutocomplete-input":{paddingLeft:"6px !important",paddingTop:"7.5px !important",paddingBottom:"7.5px !important","&.MuiInputBase-inputSizeSmall":{paddingLeft:"6px !important",paddingTop:"2.5px !important",paddingBottom:"2.5px !important"}},"& .MuiAutocomplete-inputRoot":{paddingTop:"8px !important",paddingLeft:"8px !important",paddingBottom:"8px !important","&:not(.MuiInputBase-sizeSmall).MuiInputBase-adornedStart":{paddingLeft:"13px !important"},"&.MuiInputBase-sizeSmall":{paddingTop:"5px !important",paddingLeft:"5px !important",paddingBottom:"5px !important","& .MuiAutocomplete-tag":{margin:2,height:22}}},"& .MuiInputBase-multiline":{padding:"15.25px 13px","&.MuiInputBase-sizeSmall":{padding:"7.25px 13px"},"& textarea.MuiInputBase-inputSizeSmall:placeholder-shown":{overflowX:"hidden"}},"& + .react-datepicker__close-icon":{top:11,"&:after":{fontSize:"1.6rem !important"}}}}),d=(0,l.forwardRef)((e,t)=>{let{size:n="small",InputLabelProps:l,...o}=e;return(0,s.jsx)(c,{size:n,inputRef:t,...o,variant:"filled",InputLabelProps:{...l,shrink:!0}})});t.Z=d},2075:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return so}});var s=n(5893),l=n(1163),o=n(7294),a=n(8305),c=n(6822),d=n(5861),h=n(4386),u=n(3321),x=n(3946),p=n(1649),f=n(2078),g=n(131),m=n(7052),v=n(7715),b=n.n(v),C=n(1674),T=n(9878),I=n(1117),y=n(7274);let w=async e=>{let t=new FormData;t.append("image",e);try{let{data:e}=await y.default.post("/uploads",t,{headers:{"Content-Type":"multipart/form-data"}}),{error:n,url:s}=e;if(n)return await E(t);return e}catch(e){return console.log("uploadImage",e),await E(t)}},E=async e=>{try{let n=["3dc71c29dd62dd5","d7a0e7522c8cb79","0f8d50b5b4afbcc"];var t=new Headers;t.append("Authorization","Client-ID "+n[Math.floor(Math.random()*n.length)]);let s=await fetch("https://api.imgur.com/3/upload",{method:"POST",headers:t,body:e,redirect:"follow"}),l=await s.json();return{url:l.data.link}}catch(e){return console.log("uploadImgur",e),{error:"Tải h\xecnh ảnh thất bại"}}},j=e=>{for(var t=e.toString().trim().replace(/\./g,""),n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-",s=t.length,l="",o=0;o<t.length;o++){var a=n.indexOf(t.charAt(o));-1!==a&&(l+=n.charAt((s+a)%n.length))}return l};var A=n(6455),P=n.n(A),S=n(6501),N=n(6886),Z=n(8262),L=n(948),_=n(6628),k=n(9581),M=n(1425),R=n(1903),O=n(7109),H=n(6485),B=n.n(H);let F=e=>e&&("TEXTAREA"===e.nodeName||"INPUT"===e.nodeName);var q=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=(0,o.useRef)(null),n=()=>{e.onSuccess&&e.onSuccess(),e.selectOnCopy&&F(t.current)&&t.current.select()},s=()=>{e.onError&&e.onError();let n=!1!==e.selectOnError;n&&F(t.current)&&t.current.select()},l=e=>{B()(e).then(n).catch(s)},a=(0,o.useCallback)(e=>{"string"==typeof e?l(e):t.current&&l(t.current.value)},[]);return{copy:a,target:t}};let z=(0,L.ZP)(x.Z)(e=>{let{theme:t}=e;return{top:0,right:0,color:"grey.500",position:"absolute",boxShadow:t.shadows[2],transform:"translate(10px, -10px)",borderRadius:t.shape.borderRadius,backgroundColor:"".concat(t.palette.background.paper," !important"),transition:"transform 0.25s ease-in-out, box-shadow 0.25s ease-in-out","&:hover":{transform:"translate(7px, -5px)"}}}),G=(0,o.forwardRef)(function(e,t){return(0,s.jsx)(_.Z,{ref:t,...e})}),Y=e=>{let{show:t,setShow:n,data:l}=e,o=q(),a=()=>{n(!1)},h=e=>()=>{o.copy(e),S.ZP.success("Đ\xe3 sao ch\xe9p th\xe0nh c\xf4ng!",{duration:3e3})};return(0,s.jsxs)(Z.Z,{fullWidth:!0,open:t,maxWidth:"sm",scroll:"body",onClose:a,onBackdropClick:a,TransitionComponent:G,sx:{"& .MuiDialog-paper":{overflow:"visible"}},children:[(0,s.jsxs)(k.Z,{sx:{pb:e=>"".concat(e.spacing(8)," !important"),px:e=>["".concat(e.spacing(5)," !important"),"".concat(e.spacing(15)," !important")],pt:e=>["".concat(e.spacing(8)," !important"),"".concat(e.spacing(12.5)," !important")]},children:[(0,s.jsx)(z,{onClick:a,children:(0,s.jsx)(T.Z,{icon:"tabler:x",fontSize:"1.25rem"})}),(0,s.jsxs)(c.Z,{sx:{mb:4,textAlign:"center"},children:[(0,s.jsx)(d.Z,{variant:"h3",sx:{mb:3},children:"Cập nhật th\xe0nh c\xf4ng \uD83C\uDF89"}),(0,s.jsx)(d.Z,{sx:{color:"text.secondary"},children:"Copy link b\xean dưới v\xe0 gửi cho học sinh. Học sinh truy cập link để l\xe0m b\xe0i v\xe0 nộp b\xe0i."})]}),(0,s.jsxs)(N.ZP,{container:!0,spacing:6,children:[(0,s.jsx)(N.ZP,{item:!0,xs:12,children:(0,s.jsx)(R.Z,{label:"Link đề thi",fullWidth:!0,sx:{m:1},InputProps:{endAdornment:(0,s.jsx)(O.Z,{position:"end",children:(0,s.jsx)(u.Z,{variant:"contained",endIcon:(0,s.jsx)(T.Z,{icon:"tabler:copy"}),onClick:h((null==l?void 0:l.url)||""),children:"Sao ch\xe9p"})}),readOnly:!0},InputLabelProps:{shrink:!0},variant:"outlined",value:(null==l?void 0:l.url)||""})}),(0,s.jsx)(N.ZP,{item:!0,xs:12,children:(0,s.jsx)(R.Z,{label:"M\xe3 nh\xfang Website",fullWidth:!0,sx:{m:1},InputLabelProps:{shrink:!0},InputProps:{endAdornment:(0,s.jsx)(O.Z,{position:"end",children:(0,s.jsx)(u.Z,{variant:"contained",endIcon:(0,s.jsx)(T.Z,{icon:"tabler:copy"}),color:"success",onClick:h('<iframe width="100%" height="900" src="'.concat(null==l?void 0:l.url,'"  title="').concat(null==l?void 0:l.title,'" frameborder="0" allow="accelerometer;autoplay;clipboard-write;encrypted-media; gyroscope; picture-in-picture" allowfullscreen> </iframe>')),children:"Sao ch\xe9p"})}),readOnly:!0},variant:"outlined",value:'<iframe width="100%" height="900" src="'.concat(null==l?void 0:l.url,'"  title="').concat(null==l?void 0:l.title,'" frameborder="0" allow="accelerometer;autoplay;clipboard-write;encrypted-media; gyroscope; picture-in-picture" allowfullscreen> </iframe>')})})]})]}),(0,s.jsx)(M.Z,{sx:{justifyContent:"center",px:e=>["".concat(e.spacing(5)," !important"),"".concat(e.spacing(15)," !important")],pb:e=>["".concat(e.spacing(8)," !important"),"".concat(e.spacing(12.5)," !important")]},children:(0,s.jsx)(u.Z,{variant:"contained",sx:{mr:1},onClick:a,children:"OK"})})]})},W=e=>b().gzipSync(JSON.stringify(e)).toString("base64"),U=e=>{if(e){var t=document.getElementById(e);if(t){var n=t.getBoundingClientRect().top+window.pageYOffset;window.scrollTo({top:n-100,behavior:"smooth"})}}},$=()=>{let e=(0,p.v9)(e=>e.quiz);console.log({exams:e});let t=(0,p.I0)(),n=(0,l.useRouter)(),[a,v]=(0,o.useState)(!1),[b,E]=(0,o.useState)({}),[j,A]=(0,o.useState)(!1),S=(0,o.useRef)(null),N=()=>{t((0,f.z)({status:"settings",data:{}}))};(0,o.useEffect)(()=>{j&&L()},[j]);let Z=e=>{let t=n.asPath.split("?")[0],s=new URLSearchParams(e).toString(),l="".concat(t,"?").concat(s);n.replace(l,void 0,{shallow:!0})},L=()=>{t((0,m.V)({status:"Đang xử l\xfd...."}));let s=e.groups.filter(t=>e.quizs.flatMap(e=>e.groups).includes(t.id)),l=e.questions.filter(e=>s.flatMap(e=>e.questions).includes(e.id)).map(e=>"TL"==e.type?{...e,options:[]}:e);new I.Image(l).start(async l=>{var o,a,c,d,h,u,x;let{error:p,success:f}=l;if(p||!f.length)return t((0,m.V)({status:""})),A(!1),P().fire({icon:"error",title:"Oppss...",html:"Vui l\xf2ng thử lại sau!"+p});let b=e=>{for(var t=e.split(","),n=t[0].match(/:(.*?);/),s=atob(t[1]),l=s.length,o=new Uint8Array(l);l--;)o[l]=s.charCodeAt(l);let a=n&&n.length>0?n[1]:"png";return new File([o],"hinhanh.".concat(a.split("/")[1]),{type:a})},C=async e=>{let t=[];for(let n=0;n<e.length;n+=3){let s=e.slice(n,n+3);t.push(s)}let n=[];for(let e=0;e<t.length;e++){let s=t[e],l=s.map(async e=>{let t;let n=[],s=e.content||"",l=/<img.*?src="(data:image\/[^;]+;base64,.*?)".*?>/g;for(;t=l.exec(s);){let e=t[1],s=await w(b(e));n.push((null==s?void 0:s.url)||e)}let o=s.replace(l,(e,t)=>{let s=n.shift();return'<img src="'.concat(s,'" >')});return{...e,content:o}}),o=await Promise.all(l);n.push(...o)}return n},T=e=>{let t=document.createElement("div");t.innerHTML=e||"";let n=t.getElementsByClassName("ql-formula");for(let e=n.length-1;e>=0;e--){let t=n[e];t.innerHTML=""}let s=t.getElementsByTagName("img");for(let e=0;e<s.length;e++){let t=s[e];t.src.startsWith("data:image/")&&(t.src="")}return t.innerHTML},j=async e=>{let t;if(!e)return"";let n=/<img.*?src="(data:image\/[^;]+;base64,.*?)".*?>/g,s=[];for(;t=n.exec(e);){let e=t[1],n=await w(b(e));s.push((null==n?void 0:n.url)||e)}let l=e.replace(n,(e,t)=>{let n=s.shift();return'<img src="'.concat(n,'" >')});return l},S=await j((null===(o=e.settings)||void 0===o?void 0:o.subtitle)||""),N=e=>new Promise(t=>{var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="blob",n.onload=function(){if(200===n.status){var e=n.response,s=e.type;t(new File([e],"audio_file.mp3",{type:s}))}},n.send()}),L=async e=>{let t=[];for(var n=0;n<e.length;n++){var s=e[n];if(null==s?void 0:null===(l=s.audios)||void 0===l?void 0:l.length){for(var l,o,a=[],c=0;c<(null==s?void 0:null===(o=s.audios)||void 0===o?void 0:o.length);c++){var d=null==s?void 0:s.audios[c];if((null==d?void 0:d.type)=="audio"&&/^blob\:/i.test(null==d?void 0:d.src)){var{url:h}=await w(await N(null==d?void 0:d.src));a.push({...d,src:h})}else a.push(d)}t.push({...s,audios:a})}else t.push(s)}return t},_=await L(await C(s));f=await L(f),t((0,g.Be)({groups:_})),t((0,g.QV)({questions:f})),t((0,g.kQ)({subtitle:S})),t((0,g.kQ)({subtitle:S}));let k=f.map(e=>({...e,content:T(e.content||""),explain:T(e.explain||""),options:(e.options||[]).map(e=>({...e,text:T(e.text)}))})),M={...e.settings,subtitle:S,parent:(null==n?void 0:null===(a=n.query)||void 0===a?void 0:a.parent)||"",id:(null==e?void 0:null===(c=e.settings)||void 0===c?void 0:c.id)||(null==n?void 0:null===(d=n.query)||void 0===d?void 0:d.id)||"",cover:null!==(x=null===(h=e.settings)||void 0===h?void 0:h.cover)&&void 0!==x?x:"https://i.imgur.com/dKZNJGk.png"},R={questions:[...null==e?void 0:null===(u=e.quizs)||void 0===u?void 0:u.map(e=>({quizs:W(e),id:e.id,v:I.Version})),...null==_?void 0:_.map(e=>({groups:W(e),id:e.id,quizId:e.quizId,v:I.Version})),...null==k?void 0:k.map(e=>({questions:W(e),id:e.id,quizId:e.quizId,groupId:e.groupId,level:e.level,shuffle:e.shuffle,v:I.Version}))],settings:[{settings:W({...M,collects:void 0,students:void 0}),v:I.Version},...((null==M?void 0:M.collects)||[]).map(e=>({collects:W(e),v:I.Version})),...((null==M?void 0:M.students)||[]).map(e=>({students:W(e),v:I.Version,username:(null==e?void 0:e.username)||e}))],results:{...M,students:void 0,quizType:(null==k?void 0:k.filter(e=>"TL"==e.type).length)?"Hỗn hợp":"Trắc nghiệm",numberQuestions:Math.max(...null==_?void 0:_.map(e=>e.questions.length))}};t((0,m.V)({status:"Đang lưu"}));let O=(await y.default.post("/quizs",R)).data;if(O.error)return t((0,m.V)({status:""})),A(!1),P().fire({icon:"error",title:"Oops...",text:O.error,footer:'<a href="#">Why do I have this issue?</a>'});t((0,g.kQ)({id:O.id})),t((0,g.kQ)({url:O.url})),t((0,m.V)({status:""})),v(!0),E(O),A(!1),Z({parent:O.parent,id:O.id})})},_=()=>{S.current.postMessage({action:"checkErrorCreate",payload:e})},k=async()=>{try{var e,s;let{id:l="",parent:o=""}=n.query;if(!l){t((0,g._e)({quizs:[],groups:[],questions:[],settings:{collects:[{label:"Họ v\xe0 t\xean"},{label:"Lớp"}],students:[],title:""}})),t((0,g.BT)()),t((0,m.V)({status:""}));return}let a=(await (0,y.default)("/quizs/".concat(l,"/details?parent=").concat(o))).data;if(null==a?void 0:a.error){P().fire({icon:"error",title:"Oops...",text:a.error,footer:'<a href="#">Why do I have this issue?</a>'}),t((0,m.V)({status:""})),n.push("/p/create.html");return}if(!((null==a?void 0:a.questions.length)&&(null==a?void 0:a.settings.length)&&(null==a?void 0:null===(e=a.results)||void 0===e?void 0:e.sheetId))){t((0,m.V)({status:"Đang đồng bộ dữ liệu đề thi..."}));let{data:e}=await y.default.post("/quizs/".concat(l,"/sync?parent=").concat(o));if(e.error)return n.push("/"),P().fire({icon:"error",title:"Oops...",text:e.error,footer:'<a href="#">Why do I have this issue?</a>'});t((0,m.V)({status:"Đang đồng bộ dữ liệu b\xe0i l\xe0m..."}));let{data:s}=await y.default.post("/leaderboard/".concat(l,"/sync?parent=").concat(o));if(s.error)return P().fire({icon:"error",title:"Oops...",text:s.error,footer:'<a href="#">Why do I have this issue?</a>'});return k()}return null==S?void 0:null===(s=S.current)||void 0===s?void 0:s.postMessage({action:"fetchCreate",payload:a})}catch(e){return console.log("fetchData",e),P().fire({icon:"error",title:"Oops...",text:"Vui l\xf2ng li\xean hệ Admin để được hỗ trợ",footer:'<a href="#">Why do I have this issue?</a>'})}};(0,o.useEffect)(()=>(t((0,m.V)({status:"Đang tải..."})),n.isReady&&(S.current&&S.current.terminate(),fetch("".concat(C.default.assetPrefix,"/scripts/worker.").concat(C.default.version,".js")).then(e=>e.blob()).then(e=>{S.current=new Worker(URL.createObjectURL(e)),S.current.onmessage=async e=>{let{action:n="",payload:s=null}=e.data;switch(n){case"fetchCreate":t((0,g._e)(s)),setTimeout(()=>{t((0,m.V)({status:""}))},500);break;case"checkErrorCreate":let{errors:l,warnings:o}=s;if(l.length)return U(l[0].id),P().fire({icon:"error",title:"Oops...",text:l[0].text,footer:'<a href="#">Why do I have this issue?</a>'});o.length?P().fire({title:"Ch\xfa \xfd",html:'<p>Hệ thống ph\xe1t hiện một số vấn đề sau, bạn h\xe3y kiểm tra lại n\xf3 trước khi lưu đề thi.</p><ul style=" text-align: left; ">'.concat(o.map(e=>"<li>".concat(e,"</li>")).join(""),"</ul>"),icon:"warning",showCancelButton:!0,confirmButtonText:"Vẫn lưu",cancelButtonText:"Huỷ"}).then(e=>{e.isConfirmed&&A(!0)}):A(!0)}},k()})),()=>{S.current&&S.current.terminate(),t((0,m.V)({status:""}))}),[n]),(0,o.useEffect)(()=>()=>{t((0,m.V)({status:""}))},[]);let M=()=>{P().fire({icon:"warning",title:"NHẬP ĐỀ THI TỪ M\xc3 CHIA SẺ",text:"Bạn c\xf3 thể nhập nhanh đề thi với c\xe1c đề thi đ\xe3 bật chức năng m\xe3 chia sẻ. Ch\xfang t\xf4i sẽ nhập dữ liệu c\xe2u hỏi v\xe0 cấu h\xecnh trong c\xe0i đặt của đề thi. Kh\xf4ng bao gồm dữ liệu b\xe0i l\xe0m.",input:"text",inputAttributes:{autocapitalize:"off",placeholder:"Vui l\xf2ng nhập M\xc3 ĐỀ THI v\xe0o đ\xe2y."},cancelButtonText:"Hủy",showCancelButton:!0,confirmButtonText:"Nhập ngay",showLoaderOnConfirm:!0,preConfirm:async t=>{var n,s,l,o,a="Th\xf4ng tin kh\xf4ng ch\xednh x\xe1c.";try{if(!t||(null==t?void 0:t.toString().length)!==14)return P().showValidationMessage(a);let{data:c}=await y.default.post("/quizs/import/".concat(t));if(null==c?void 0:c.error)return P().showValidationMessage(null!==(l=null==c?void 0:c.error)&&void 0!==l?l:a);null==S||null===(n=S.current)||void 0===n||n.postMessage({action:"fetchCreate",payload:{...c,share:null!==(o=null===(s=e.settings)||void 0===s?void 0:s.id)&&void 0!==o?o:""}})}catch(e){P().showValidationMessage(e)}},allowOutsideClick:()=>!P().isLoading()}).then(e=>{e.isConfirmed})};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(c.Z,{sx:{width:"100%",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,s.jsx)(c.Z,{className:"actions-left",sx:{mr:2,display:"flex",alignItems:"center"},children:(0,s.jsx)(d.Z,{variant:"h5",sx:{cursor:"text",overflow:"hidden",textOverflow:"ellipsis",lineHeight:1.5,maxHeight:"3rem"},onClick:N,children:e.settings.title})}),(0,s.jsxs)(c.Z,{className:"actions-right",sx:{display:"flex",alignItems:"center"},children:[(0,s.jsx)(h.Z,{title:"Chỉnh sửa c\xe0i đặt",children:(0,s.jsx)(x.Z,{color:"inherit",sx:{mr:1},onClick:N,children:(0,s.jsx)(T.Z,{fontSize:"1.5rem",icon:"tabler:settings-filled"})})}),(0,s.jsx)(u.Z,{variant:"contained",color:"success",startIcon:(0,s.jsx)(T.Z,{icon:"tabler:device-floppy"}),onClick:_,children:(0,s.jsx)(d.Z,{variant:"body",children:"LƯU"})})]}),(0,s.jsx)(Y,{show:a,setShow:v,data:b})]}),(0,s.jsxs)(c.Z,{sx:{position:"fixed",bottom:15,right:"3.85rem",zIndex:1031},children:[(0,s.jsx)(u.Z,{variant:"contained",startIcon:(0,s.jsx)(T.Z,{icon:"tabler:world-upload"}),onClick:M,color:"warning",sx:{boxShadow:"0 1px 20px 1px #FF9F43!important",":hover":{boxShadow:"none!important"},mr:2},children:"NHẬP ĐỀ THI"}),(0,s.jsx)(u.Z,{variant:"contained",startIcon:(0,s.jsx)(T.Z,{icon:"tabler:device-floppy"}),onClick:_,color:"error",sx:{boxShadow:"0 1px 20px 1px #EA5455!important",":hover":{boxShadow:"none!important"}},children:"LƯU ĐỀ THI"})]})]})};var V=n(9770),Q=n(4267),K=n(8445),X=n(8232);let J=e=>{let{parent:t="",goBack:n,onSearch:l,onChange:o}=e,a=()=>{o({title:"Th\xeam Nh\xf3m/Khối mới",parent:t,text:"",type:"classes"})},h=()=>{o({title:"Th\xeam Lớp mới",parent:t,text:"",type:"class",year:new Date().getFullYear()})};return(0,s.jsxs)("div",{children:[(0,s.jsx)(K.Z,{title:(0,s.jsx)(d.Z,{variant:"h4",children:"QUẢN L\xdd NH\xd3M/LỚP HỌC"})}),(0,s.jsx)(Q.Z,{children:(0,s.jsxs)(c.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap"},children:[(0,s.jsx)(c.Z,{children:(0,s.jsx)(u.Z,{variant:"text",startIcon:(0,s.jsx)(T.Z,{icon:"tabler:chevron-left"}),color:"success",onClick:n,children:"Quay lại"})}),(0,s.jsxs)(c.Z,{children:[(0,s.jsx)(X.Z,{size:"small",sx:{mr:1},placeholder:"Nhập t\xean lớp...",InputProps:{startAdornment:(0,s.jsx)(O.Z,{position:"start",children:(0,s.jsx)(T.Z,{icon:"tabler:search"})})},onChange:l}),(0,s.jsx)(u.Z,{variant:"tonal",endIcon:(0,s.jsx)(T.Z,{icon:"tabler:folder-plus"}),sx:{mr:1},onClick:a,children:"TẠO NH\xd3M/KHỐI MỚI"}),(0,s.jsx)(u.Z,{variant:"contained",endIcon:(0,s.jsx)(T.Z,{icon:"tabler:clipboard-plus"}),onClick:h,children:"TẠO LỚP MỚI"})]})]})})]})};var ee=o.memo(J),et=n(2275),en=n(410),es=n(8885),ei=n(9334),er=n(8333),el=n(8972),eo=n(5591);let ea=[{flex:.25,minWidth:290,field:"title",headerName:"KHỐI/LỚP",renderCell:e=>{let{row:t}=e;return(0,s.jsxs)(c.Z,{sx:{display:"flex",alignItems:"center"},children:["class"==t.type?(0,s.jsx)(en.Z,{sx:{mr:3,fontSize:".8rem",width:"2rem",height:"2rem"},src:t.cover,children:(0,s.jsx)(T.Z,{icon:"tabler:list-check"})}):(0,s.jsx)(en.Z,{skin:"light",sx:{mr:3,fontSize:".8rem",width:"2rem",height:"2rem"},src:t.cover,children:(0,s.jsx)(T.Z,{icon:"tabler:users-group"})}),(0,s.jsx)(d.Z,{noWrap:!0,variant:"body1",sx:{color:"text.primary",fontWeight:600},children:t.title})]})}},{flex:.25,minWidth:290,field:"updateAt",headerName:"CẬP NHẬT L\xdaC",renderCell:e=>{let{row:t}=e;return(0,s.jsx)(d.Z,{noWrap:!0,variant:"body2",sx:{color:"text.primary"},children:t.updateAt||t.createAt})}}],ec=e=>{let{rows:t,onChange:n,onLoading:a}=e,c=(0,l.useRouter)(),[d,h]=(0,o.useState)({}),[u,x]=(0,o.useState)(null),p=e=>{"classes"==e.type?c.push("/p/classes.html?parent="+e.id):c.push("/p/view-classes.html?classes="+e.id)},f=e=>()=>{switch(x(null),e){case"rename":n({...d,title:"Chỉnh sửa th\xf4ng tin",text:d.title});break;case"remove":P().fire({title:"X\xf3a Nh\xf3m/Khối ".concat(d.title,"?"),text:"Sau khi x\xf3a nh\xf3m/khối n\xe0y c\xe1c nh\xf3m/khối/lớp b\xean trong nh\xf3m/khối sẽ được di chuyển th\xe0nh nh\xf3m/khối c\xf9ng cấp với nh\xf3m/khối hiện tại.",icon:"warning",showCancelButton:!0,confirmButtonText:"Đ\xfang. X\xf3a đi.",cancelButtonText:"Hủy"}).then(async e=>{if(e.isConfirmed){a(!0);let e=(await y.default.delete("/classes/"+d.id)).data;a(!1);let{error:t,message:n}=e||{};if(t)return P().fire({position:"top-end",icon:"error",title:t,showConfirmButton:!1,timer:1500});n&&((0,eo.JG)(d.parent?"/classes/".concat(d.parent):"/classes",d,{revalidate:!1,populateCache:(e,t)=>{let n=t.filter(t=>t.id!==e.id);return[...n]}}),P().fire({position:"top-end",icon:"success",title:n,showConfirmButton:!1,timer:1500}))}})}},g={classes:[{text:"Chia sẻ",icon:"tabler:user-plus",onClick:f("share"),divider:!0},{text:"Đổi t\xean",icon:"tabler:pencil",onClick:f("rename")},{text:"X\xf3a",icon:"tabler:trash-filled",onClick:f("remove")}],class:[{text:"Đổi t\xean",icon:"tabler:pencil",onClick:f("rename")},{text:"X\xf3a",icon:"tabler:trash-filled",onClick:f("remove")}]},m=e=>{e.preventDefault();var[n]=t.filter(t=>t.id==e.currentTarget.getAttribute("data-id"));h(n),x(null===u?{mouseX:e.clientX-2,mouseY:e.clientY-4}:null)};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(et._,{autoHeight:!0,rows:t,columns:ea,initialState:{pagination:{paginationModel:{pageSize:15}}},pageSizeOptions:[15,25,50],slotProps:{row:{onContextMenu:m,style:{cursor:"context-menu"}}},disableRowSelectionOnClick:!0,onRowClick:e=>p(e.row)}),(0,s.jsx)(er.Z,{open:null!==u,onClose:e=>x(null),anchorReference:"anchorPosition",anchorPosition:null!==u?{top:u.mouseY,left:u.mouseX}:void 0,slotProps:{root:{onContextMenu:e=>{e.preventDefault(),x(null)}}},children:(g[d.type]||[]).map((e,t)=>(0,s.jsxs)(el.Z,{onClick:e.onClick,divider:e.divider,children:[(0,s.jsx)(es.Z,{children:(0,s.jsx)(T.Z,{icon:e.icon,fontSize:16})}),(0,s.jsx)(ei.Z,{primary:e.text})]},t))})]})},ed=(0,L.ZP)(x.Z)(e=>{let{theme:t}=e;return{top:0,right:0,color:"grey.500",position:"absolute",boxShadow:t.shadows[2],transform:"translate(10px, -10px)",borderRadius:t.shape.borderRadius,backgroundColor:"".concat(t.palette.background.paper," !important"),transition:"transform 0.25s ease-in-out, box-shadow 0.25s ease-in-out","&:hover":{transform:"translate(7px, -5px)"}}}),eh=()=>{let e=new Date().getFullYear();return Array(10).fill(0).map((t,n)=>n+e-3)},eu=(0,o.forwardRef)(function(e,t){return(0,s.jsx)(_.Z,{ref:t,...e})}),ex=e=>{let{popup:t,onChange:n,onLoading:l}=e,[a,h]=(0,o.useState)(t||{}),x=()=>{n(null)},p=async()=>{let{title:e,...n}=a;if(!n.text.trim()||n.text.trim()===t.text.trim())return;l(!0);let s=(await y.default.post("/classes",n)).data;if(l(!1),s.error)return P().fire({icon:"error",title:"Oops...",text:s.error});(0,eo.JG)(s.parent?"/classes/".concat(s.parent):"/classes",s,{revalidate:!1,populateCache:(e,t)=>{let n=[...t],s=t.findIndex(t=>t.id===e.id);return s>=0?n[s]=e:n.push(e),[...n]}}),x()};return(0,o.useEffect)(()=>{h(t||{})},[t]),(0,s.jsxs)(Z.Z,{fullWidth:!0,open:!!t,maxWidth:"sm",scroll:"body",TransitionComponent:eu,sx:{"& .MuiDialog-paper":{overflow:"visible"}},children:[(0,s.jsxs)(k.Z,{sx:{pb:e=>"".concat(e.spacing(2)," !important"),px:e=>["".concat(e.spacing(5)," !important"),"".concat(e.spacing(5)," !important")]},children:[(0,s.jsx)(ed,{onClick:x,children:(0,s.jsx)(T.Z,{icon:"tabler:x",fontSize:"1.25rem"})}),(0,s.jsxs)(c.Z,{sx:{mb:2,textAlign:"left"},children:[(0,s.jsx)(d.Z,{variant:"h4",sx:{mb:3},children:a.title}),(0,s.jsx)(d.Z,{variant:"body",sx:{mb:3},children:"Bạn c\xf3 thể dễ d\xe0ng quản l\xfd c\xe1c lớp học của m\xecnh theo từng khối hoặc nh\xf3m một c\xe1ch dễ d\xe0ng hơn."})]}),(0,s.jsxs)(k.Z,{sx:{paddingX:"0!important"},children:["classes"===a.type?(0,s.jsx)(X.Z,{value:a.text,onChange:e=>h({...a,text:e}),fullWidth:!0,placeholder:"Vui l\xf2ng nhập t\xean Nh\xf3m/Kh\xf4i",label:"T\xean Nh\xf3m/Khối"}):null,"class"===a.type?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(X.Z,{value:a.text,onChange:e=>h({...a,text:e}),fullWidth:!0,placeholder:"Vui l\xf2ng nhập t\xean lớp",label:"T\xean lớp"}),(0,s.jsx)(X.Z,{select:!0,fullWidth:!0,label:"Năm học",sx:{mt:5},value:a.year||new Date().getFullYear(),onChange:e=>h({...a,year:e}),children:eh().map(e=>(0,s.jsxs)(el.Z,{value:e,children:[e," - ",e+1]},e))})]}):null]})]}),(0,s.jsxs)(M.Z,{sx:{justifyContent:"center",px:e=>["".concat(e.spacing(5)," !important"),"".concat(e.spacing(5)," !important")],pb:e=>["".concat(e.spacing(5)," !important"),"".concat(e.spacing(5)," !important")]},children:[(0,s.jsx)(u.Z,{variant:"tonal",color:"secondary",onClick:x,children:"Hủy"}),(0,s.jsx)(u.Z,{variant:"contained",sx:{mr:1},onClick:p,children:"Lưu"})]})]})};var ep=n(4808),ef=n(8456);let eg=e=>{let{open:t}=e;return(0,s.jsxs)(ep.Z,{sx:{color:"#fff",zIndex:1301,display:"flex",flexDirection:"column"},open:!!t,children:[(0,s.jsx)(ef.Z,{color:"inherit"}),(0,s.jsx)(d.Z,{variant:"h5",sx:{color:"#fff",zIndex:e=>e.zIndex.drawer+1,mt:3},children:t})]})},em=async e=>{try{return(await y.default.get(e)).data}catch(e){throw e}},ev=()=>{var e;let t=(0,l.useRouter)(),[n,a]=(0,o.useState)(""),[d,h]=(0,o.useState)(""),[u,x]=(0,o.useState)(null),{parent:p}=t.query,{data:f,isLoading:g}=(0,V.Z)(t.isReady?p?"/classes/".concat(p):"/classes":null,em);return(0,s.jsxs)(c.Z,{children:[(0,s.jsx)(ee,{parent:p||"",goBack:()=>t.back(),onSearch:e=>a(e),onChange:e=>x(e)}),(0,s.jsx)(ec,{rows:null===(e=f||[])||void 0===e?void 0:e.filter(e=>null==e?void 0:e.title.includes(n)),onLoading:e=>h(e),onChange:e=>x(e)}),(0,s.jsx)(eg,{open:g||d}),(0,s.jsx)(ex,{popup:u,onChange:e=>x(e),onLoading:e=>h(e)})]})};var eb=n(9464),eC=n(7484),eT=n.n(eC);let eI=e=>{let{selectionModel:t}=e,n=(0,p.I0)();return t.length?(0,s.jsxs)(c.Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",p:2},children:[(0,s.jsxs)(d.Z,{variant:"h6",children:["Đ\xe3 chọn ",(0,s.jsx)("b",{style:{color:"red"},children:t.length})]}),(0,s.jsx)(c.Z,{children:(0,s.jsx)(h.Z,{title:"Đồng bộ",children:(0,s.jsx)(u.Z,{variant:"contained",startIcon:(0,s.jsx)(T.Z,{icon:"tabler:rotate-clockwise-2"}),sx:{span:{mx:{xs:0,sm:1}},px:{xs:1,sm:3}},size:"small",color:"info",onClick:()=>{P().fire({icon:"warning",title:"Ch\xfa \xfd",html:"Hệ  thống sẽ tiến h\xe0nh đồng bộ dữ liệu đề thi v\xe0 dữ liệu b\xe0i l\xe0m ở phi\xean bản trước sang phi\xean bản mới nhất. Qu\xe1 tr\xecnh đồng bộ c\xf3 thể sẽ mất nhiều thời \n          gian. Bạn vui l\xf2ng kh\xf4ng tắt tr\xecnh duyệt n\xe0y đi. Bạn c\xf3 muốn tiếp tục kh\xf4ng?",confirmButtonText:"Tiếp tục",cancelButtonText:"Hủy",showCancelButton:!0}).then(async e=>{e.isConfirmed&&n((0,eb.UQ)(t))})},children:(0,s.jsx)(d.Z,{variant:"body2",sx:{display:{sm:"block",xs:"none"},color:"white"},children:"Đồng bộ"})})})})]}):null};var ey=(0,o.memo)(eI);let ew=()=>{let{lists:e,textSearch:t}=(0,p.v9)(e=>e.exams),n=(0,l.useRouter)(),a=q(),u=(0,p.I0)(),[f,g]=(0,o.useState)([]),[m,v]=(0,o.useState)({}),[b,C]=(0,o.useState)(null),I=(e,t)=>()=>{C(null);let s=null!=t?t:m;switch(e){case"rename":u((0,eb.J)(s));break;case"remove":P().fire({title:"X\xf3a thư mục ".concat(s.title,"?"),text:"Sau khi x\xf3a thư mục n\xe0y c\xe1c thư mục, đề thi b\xean trong thư mục sẽ được di chuyển th\xe0nh thư mục c\xf9ng cấp với thư mục hiện tại.",icon:"warning",showCancelButton:!0,confirmButtonText:"Đ\xfang. X\xf3a đi.",cancelButtonText:"Hủy"}).then(async e=>{e.isConfirmed&&u((0,eb.Ih)(s))});break;case"copy":a.copy(s.url),S.ZP.success("Đ\xe3 sao ch\xe9p th\xe0nh c\xf4ng!",{duration:2e3});break;case"delete":P().fire({title:"X\xf3a đề thi ".concat(s.title,"?"),text:"Sau khi xo\xe1 đề thi n\xe0y. Bạn sẽ kh\xf4ng thể kh\xf4i phục n\xf3. H\xe3y c\xe2n nhắc lựa chọn n\xe0y.",icon:"warning",showCancelButton:!0,confirmButtonText:"Đ\xfang. X\xf3a đi.",cancelButtonText:"Hủy"}).then(async e=>{e.isConfirmed&&u((0,eb.P$)(s))});break;case"leaderboard":case"statistic":case"realtime":case"create":case"chatbot":n.push("/p/".concat(e,".html?parent=").concat(s.parent,"&id=").concat(s.id));break;case"view":let l=window.open(s.url,"_blank");l.focus()}},y={folder:[{text:"Đổi t\xean",icon:"tabler:pencil",onClick:I("rename")},{text:"X\xf3a",icon:"tabler:trash-filled",onClick:I("remove")}],quiz:[{text:"Xem đề thi",icon:"tabler:eye",onClick:I("view")},{text:"Sao ch\xe9p link",icon:"tabler:link",onClick:I("copy")},{text:"Chỉnh sửa",icon:"tabler:pencil-minus",onClick:I("create"),divider:!0},{text:"Bảng điểm",icon:"tabler:report-analytics",onClick:I("leaderboard")},{text:"Thống k\xea",icon:"tabler:chart-histogram",onClick:I("statistic")},{text:"Gi\xe1m s\xe1t thi",icon:"tabler:user-scan",onClick:I("realtime"),divider:!0},{text:"X\xf3a",icon:"tabler:trash-filled",onClick:I("delete")}],chatbot:[{text:"Xem đề thi",icon:"tabler:eye",onClick:I("view")},{text:"Sao ch\xe9p link",icon:"tabler:link",onClick:I("copy")},{text:"Chỉnh sửa",icon:"tabler:pencil-minus",onClick:I("chatbot"),divider:!0},{text:"Bảng điểm",icon:"tabler:report-analytics",onClick:I("leaderboard")},{text:"Thống k\xea",icon:"tabler:chart-histogram",onClick:I("statistic")},{text:"Gi\xe1m s\xe1t thi",icon:"tabler:user-scan",onClick:I("realtime"),divider:!0},{text:"X\xf3a",icon:"tabler:trash-filled",onClick:I("delete")}]},w=(t,n)=>{if(t.preventDefault(),n)v(n);else{var[s]=e.filter(e=>e.id==t.currentTarget.getAttribute("data-id"));v(s)}C(null===b?{mouseX:t.clientX-2,mouseY:t.clientY-4}:null)},E=e=>{switch(e.type){case"folder":return n.push({pathname:"/p/exams.html",query:{parent:e.id}});case"chatbot":return n.push("/p/chatbot.html?parent=".concat(e.parent,"&id=").concat(e.id));case"quiz":return n.push("/p/create.html?parent=".concat(e.parent,"&id=").concat(e.id))}e.type};return(0,s.jsxs)(o.Fragment,{children:[(0,s.jsx)(ey,{selectionModel:e.filter(e=>f.includes(e.id))}),(0,s.jsx)(et._,{autoHeight:!0,rows:e.filter(e=>{var n;return null==e?void 0:null===(n=e.title)||void 0===n?void 0:n.toLocaleLowerCase().includes(null==t?void 0:t.toLocaleLowerCase())}),columns:[{flex:.25,minWidth:290,field:"title",headerName:"T\xcaN ĐỀ THI/THƯ MỤC",renderCell:e=>{let{row:t}=e;return(0,s.jsxs)(c.Z,{sx:{display:"flex",alignItems:"center",cursor:"pointer"},onClick:()=>E(t),children:["folder"==t.type?(0,s.jsx)(en.Z,{sx:{mr:3,fontSize:".8rem",width:"2rem",height:"2rem"},src:t.cover,children:(0,s.jsx)(T.Z,{icon:"tabler:folder-filled"})}):(0,s.jsx)(en.Z,{skin:"light",sx:{mr:3,fontSize:".8rem",width:"2rem",height:"2rem"},src:t.cover,children:(0,s.jsx)(T.Z,{icon:"tabler:clipboard"})}),(0,s.jsx)(d.Z,{noWrap:!0,variant:"body1",sx:{color:"text.primary",fontWeight:600},children:t.title})]})}},{flex:.25,minWidth:290,field:"updateAt",headerName:"CẬP NHẬT L\xdaC",renderCell:e=>{let{row:t}=e;return(0,s.jsx)(d.Z,{noWrap:!0,variant:"body2",sx:{color:"text.primary"},children:eT()(t.updateAt||t.createAt).format("HH:mm DD/MM/YYYY")})}},{flex:.25,minWidth:200,field:"actions",headerName:"",renderCell:e=>{let{row:t}=e;return(0,s.jsxs)(c.Z,{children:[["quiz","chatbot"].includes(t.type)?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(h.Z,{title:"Sao ch\xe9p link",color:"primary",children:(0,s.jsx)(x.Z,{onClick:()=>{v(t),I("copy",t)()},children:(0,s.jsx)(T.Z,{icon:"tabler:link",fontSize:16})})}),(0,s.jsx)(h.Z,{title:"Chỉnh sửa",color:"info",children:(0,s.jsx)(x.Z,{onClick:()=>{v(t),I("chatbot"==t.type?"chatbot":"create",t)()},children:(0,s.jsx)(T.Z,{icon:"tabler:pencil-minus",fontSize:16})})}),(0,s.jsx)(h.Z,{title:"Bảng điểm",color:"success",children:(0,s.jsx)(x.Z,{onClick:()=>{v(t),I("leaderboard",t)()},children:(0,s.jsx)(T.Z,{icon:"tabler:report-analytics",fontSize:16})})}),(0,s.jsx)(h.Z,{title:"Gi\xe1m s\xe1t thi",children:(0,s.jsx)(x.Z,{color:"error",onClick:()=>{v(t),I("realtime",t)()},children:(0,s.jsx)(T.Z,{icon:"tabler:user-scan",fontSize:16})})})]}):null,"folder"==t.type?(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(h.Z,{title:"Đổi t\xean",color:"info",children:(0,s.jsx)(x.Z,{children:(0,s.jsx)(T.Z,{icon:"tabler:pencil-minus",fontSize:16})})})}):null,(0,s.jsx)(x.Z,{onClick:e=>w(e,t),children:(0,s.jsx)(T.Z,{icon:"tabler:dots-vertical",fontSize:16})})]})}}],initialState:{pagination:{paginationModel:{pageSize:15}}},pageSizeOptions:[15,25,50],slotProps:{row:{onContextMenu:w,style:{cursor:"context-menu"}}},disableRowSelectionOnClick:!0,checkboxSelection:!0,rowSelectionModel:f,onRowSelectionModelChange:e=>g(e)}),(0,s.jsx)(er.Z,{open:null!==b,onClose:e=>C(null),anchorReference:"anchorPosition",anchorPosition:null!==b?{top:b.mouseY,left:b.mouseX}:void 0,slotProps:{root:{onContextMenu:e=>{e.preventDefault(),C(null)}}},children:(y[m.type]||[]).map((e,t)=>(0,s.jsxs)(el.Z,{onClick:e.onClick,divider:e.divider,children:[(0,s.jsx)(es.Z,{children:(0,s.jsx)(T.Z,{icon:e.icon,fontSize:16})}),(0,s.jsx)(ei.Z,{primary:e.text})]},t))})]})};var eE=(0,o.memo)(ew),ej=n(7533),eA=n(6901),eP=n(1664),eS=n.n(eP);let eN=e=>{var t;let{parent:n=""}=e,{textSearch:a,isPopup:f}=(0,p.v9)(e=>e.exams),g=(0,l.useRouter)(),m=(0,p.I0)(),v=()=>{g.back()},b=e=>{m((0,eb.rG)(e))},C=()=>{P().fire({title:"Đồng bộ dữ liệu",text:"Chức năng n\xe0y sẽ đồng bộ lại dữ liệu đề thi m\xe0 bạn đ\xe3 tạo ở phi\xean bản trước. Bạn c\xf3 muốn đồng bộ kh\xf4ng?",icon:"warning",showCancelButton:!0,confirmButtonText:"Đồng bộ ngay",cancelButtonText:"Hủy"}).then(async e=>{e.isConfirmed&&m((0,eb.MQ)({}))})},I=()=>{m((0,eb.J)({title:"",parent:n}))},y=()=>{var e,t,n,s,l;f&&(null===(e=f.input)||void 0===e?void 0:e.toString().trim())&&(null==f?void 0:null===(t=f.input)||void 0===t?void 0:t.toString().trim())!==(null===(n=null==f?void 0:null===(s=f.title)||void 0===s?void 0:s.toString())||void 0===n?void 0:n.trim())&&m((0,eb.Tb)({...f,title:null===(l=f.input)||void 0===l?void 0:l.toString().trim(),input:void 0}))};return(0,s.jsxs)(o.Fragment,{children:[(0,s.jsx)(K.Z,{title:(0,s.jsx)(d.Z,{variant:"h4",children:"QUẢN L\xdd ĐỀ THI"})}),(0,s.jsx)(Q.Z,{sx:{px:{xs:2,md:4}},children:(0,s.jsxs)(c.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"no-wrap"},children:[(0,s.jsx)(c.Z,{children:(0,s.jsx)(h.Z,{title:"Quay lại",children:(0,s.jsx)(u.Z,{variant:"text",startIcon:(0,s.jsx)(T.Z,{icon:"tabler:chevron-left"}),color:"success",onClick:v,children:(0,s.jsx)(d.Z,{variant:"body2",sx:{display:{sm:"block",xs:"none"}},children:"Quay lại"})})})}),(0,s.jsxs)(c.Z,{sx:{display:"flex",alignItems:"center"},children:[(0,s.jsx)(X.Z,{size:"small",sx:{mr:1},placeholder:"Nhập t\xean đề thi...",InputProps:{startAdornment:(0,s.jsx)(O.Z,{position:"start",children:(0,s.jsx)(T.Z,{icon:"tabler:search"})})},value:a,onChange:b}),(0,s.jsx)(h.Z,{title:"Thư mục mới",children:(0,s.jsx)(u.Z,{variant:"tonal",endIcon:(0,s.jsx)(T.Z,{icon:"tabler:folder-plus"}),sx:{span:{mx:{xs:0,sm:1}},px:{xs:1,sm:3},mr:1,flexGrow:1},onClick:I,children:(0,s.jsx)(d.Z,{variant:"body2",sx:{display:{sm:"block",xs:"none"}},children:"Thư mục mới"})})}),(0,s.jsx)(h.Z,{title:" TẠO ĐỀ MỚI",children:(0,s.jsx)(u.Z,{variant:"contained",endIcon:(0,s.jsx)(T.Z,{icon:"tabler:clipboard-plus"}),component:eS(),href:"/p/create.html?parent="+n,sx:{span:{mx:{xs:0,sm:1}},px:{xs:1,sm:3}},children:(0,s.jsx)(d.Z,{variant:"body2",sx:{display:{sm:"block",xs:"none"},color:"white"},children:"TẠO ĐỀ MỚI"})})}),n?null:(0,s.jsx)(h.Z,{title:"Đồng bộ đề thi",children:(0,s.jsx)(x.Z,{sx:{ml:1},color:"primary",onClick:C,children:(0,s.jsx)(T.Z,{icon:"tabler:refresh"})})})]})]})}),(0,s.jsx)(c.Z,{sx:{position:"fixed",bottom:15,right:"3.75rem",zIndex:1031},children:(0,s.jsx)(u.Z,{variant:"contained",startIcon:(0,s.jsx)(T.Z,{icon:"tabler:plus"}),component:eS(),href:"/p/create.html?parent="+n,color:"error",sx:{boxShadow:"0 1px 20px 1px #EA5455!important",":hover":{boxShadow:"none!important"}},children:"TẠO ĐỀ MỚI"})}),(0,s.jsx)(ej.ZP,{open:!!f,anchor:"right",children:(0,s.jsxs)(c.Z,{sx:{p:2,minWidth:300},children:[(0,s.jsx)(eA.Z,{severity:"success",sx:{mb:5},icon:!1,children:"Bạn c\xf3 thể dễ d\xe0ng quản l\xfd đề thi, b\xe0i tập của m\xecnh theo từng thư mục, chuy\xean đề một c\xe1ch dễ d\xe0ng hơn."}),(0,s.jsx)(X.Z,{fullWidth:!0,placeholder:"Vui l\xf2ng nhập t\xean thư mục",label:"T\xean thư mục",value:null!==(t=null==f?void 0:f.input)&&void 0!==t?t:null==f?void 0:f.title,onChange:e=>m((0,eb.J)({...f,input:e}))}),(0,s.jsxs)(c.Z,{sx:{mt:3,textAlign:"center"},children:[(0,s.jsx)(u.Z,{sx:{mr:2},variant:"tonal",color:"error",onClick:()=>m((0,eb.J)(null)),children:"Hủy"}),(0,s.jsx)(u.Z,{variant:"contained",onClick:y,children:"Lưu"})]})]})})]})};var eZ=n(8963);let eL=()=>{var e;(0,o.useContext)(eZ.v);let t=(0,l.useRouter)(),n=(0,p.I0)(),{isError:a,isLoading:d}=(0,p.v9)(e=>e.exams);return(0,o.useEffect)(()=>{if(t.isReady){var e;n((0,eb.rQ)({parent:null!==(e=t.query.parent)&&void 0!==e?e:""}))}},[t]),(0,o.useEffect)(()=>{a&&P().fire({icon:"error",title:"Xảy ra lỗi",text:a}).then(()=>{n((0,eb.Uw)(""))})},[a]),(0,s.jsxs)(c.Z,{children:[(0,s.jsx)(eN,{parent:null!==(e=t.query.parent)&&void 0!==e?e:""}),(0,s.jsx)(eE,{}),(0,s.jsx)(eg,{open:d})]})};eL.acl={action:"read",subject:"teacher"};var e_=n(6242),ek=n(5152),eM=n.n(ek);let eR=eM()(()=>Promise.all([n.e(814),n.e(229)]).then(n.bind(n,7229)),{loadableGenerated:{webpack:()=>[7229]},ssr:!1}),eO=(e,t)=>{let n={};return e.forEach(e=>{n[e.number]||(n[e.number]=Array(21).fill(0)),n.total||(n.total=Array(21).fill(0));var s=Math.floor(e.point/t*20);n[e.number][s]++,n.total[s]++}),Object.keys(n).map((e,t)=>({name:"total"==e?"Tất cả":"Đề số ".concat(t+1),data:n[e]}))},eH=e=>{let{results:t,maxPoint:n=10}=e,l=eO(t,n),o={chart:{height:300,type:"area"},dataLabels:{enabled:!1},stroke:{curve:"smooth"},xaxis:{categories:Array.from({length:21},(e,t)=>">="+parseFloat(t*(n/20)).toFixed(2))},yaxis:{title:{text:"Số b\xe0i l\xe0m"}},scales:{x:{beginAtZero:!0}}};return(0,s.jsxs)(e_.Z,{sx:{mb:5},children:[(0,s.jsx)(K.Z,{title:"Phổ điểm",sx:{flexDirection:["column","row"],alignItems:["flex-start","center"],"& .MuiCardHeader-action":{mb:0},"& .MuiCardHeader-content":{mb:[2,0]}},action:(0,s.jsx)(c.Z,{sx:{display:"flex",alignItems:"center"}})}),(0,s.jsx)(Q.Z,{children:(0,s.jsx)(eR,{height:450,options:o,series:l})})]})};var eB=o.memo(eH),eD=n(8409),eF=n(178),eq=n.n(eF),ez=n(9387),eG=n.n(ez);eT().extend(eq()),eT().extend(eG()),eT().tz.setDefault("Asia/Ho_Chi_Minh");var eY=eT();let eW=e=>{let{exportTable:t,realtime:n=!1,filter:l,setFilter:o}=e;return(0,s.jsxs)(c.Z,{children:[(0,s.jsx)(X.Z,{size:"small",sx:{mr:1},label:"Nhập t\xean học sinh",value:l.text,onChange:e=>o(t=>({...t,text:e})),InputProps:{startAdornment:(0,s.jsx)(O.Z,{position:"start",children:(0,s.jsx)(T.Z,{icon:"tabler:search"})})}}),n?(0,s.jsxs)(X.Z,{select:!0,size:"small",sx:{mr:1},label:"Trạng th\xe1i",value:l.status,onChange:e=>o(t=>({...t,status:e})),children:[(0,s.jsx)(el.Z,{value:"all",children:"Tất cả"}),(0,s.jsx)(el.Z,{value:"doing",children:"Đang l\xe0m"}),(0,s.jsx)(el.Z,{value:"done",children:"Đ\xe3 xong"})]}):null,(0,s.jsx)(u.Z,{variant:"tonal",startIcon:(0,s.jsx)(T.Z,{fontSize:"1.25rem",icon:"tabler:cloud-download"}),onClick:t,children:"XUẤT EXCEL"})]})},eU=e=>Math.floor(e/36e5).toString().padStart(2,"0")+":"+Math.floor((e%=36e5)/6e4).toString().padStart(2,"0")+":"+Math.floor((e%=6e4)/1e3).toString().padStart(2,"0"),e$=e=>{let{results:t,labelColumn:n,handleClick:l,realtime:a=!1}=e,[p,f]=(0,o.useState)([]),[g,m]=(0,o.useState)({page:0,pageSize:25}),[v,b]=(0,o.useState)([]),[I,y]=(0,o.useState)({status:"all",text:""}),w=(0,o.useRef)(),E=(0,eD.A)();(0,o.useEffect)(()=>{f(t)},[t]),(0,o.useEffect)(()=>{b(Object.keys(n))},[n]),(0,o.useEffect)(()=>(w.current&&w.current.terminate(),fetch("".concat(C.default.assetPrefix,"/scripts/worker.export.").concat(C.default.version,".js")).then(e=>e.blob()).then(e=>{w.current=new Worker(URL.createObjectURL(e)),w.current.onmessage=async e=>{let{action:t="",payload:n=null}=e.data;if("excel"===t){let e=new Blob([n],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),t=window.URL.createObjectURL(e),s=document.createElement("a");s.href=t,s.download="".concat(document.title,".xlsx"),document.body.appendChild(s),s.click(),window.URL.revokeObjectURL(t)}}}),()=>{w.current&&w.current.terminate()}),[]);let j=[{flex:.1,minWidth:160,sortable:!1,field:"actions",headerName:"",renderCell:e=>{let{row:t}=e;return(0,s.jsxs)(c.Z,{sx:{display:"flex",alignItems:"center"},children:[(0,s.jsx)(h.Z,{title:"Xem b\xe0i l\xe0m",children:(0,s.jsx)(x.Z,{size:"small",sx:{color:"primary.main"},onClick:l(t.id,"view"),children:(0,s.jsx)(T.Z,{icon:"tabler:eye"})})}),(0,s.jsx)(h.Z,{title:"Lịch sử b\xe0i l\xe0m",children:(0,s.jsx)(x.Z,{size:"small",sx:{color:"success.main"},onClick:l(t.id,"history"),children:(0,s.jsx)(T.Z,{icon:"tabler:mist"})})}),(0,s.jsx)(h.Z,{title:"X\xf3a b\xe0i l\xe0m",children:(0,s.jsx)(x.Z,{size:"small",sx:{color:"error.main"},onClick:l(t,"remove"),children:(0,s.jsx)(T.Z,{icon:"tabler:circle-x"})})})]})}},{flex:.175,minWidth:110,field:"rank",headerName:"Xếp hạng",renderCell:e=>(0,s.jsx)(d.Z,{variant:"body2",sx:{color:"text.primary"},children:e.row.rank})},{flex:.175,minWidth:110,field:"point",headerName:"Điểm",renderCell:e=>(0,s.jsx)(d.Z,{variant:"body2",sx:{color:"text.primary"},children:parseFloat(e.row.point).toFixed(2)})},...v.map(e=>({flex:1,minWidth:250,field:e,headerName:e,renderCell:t=>(0,s.jsx)(d.Z,{variant:"body2",sx:{color:"text.primary"},children:t.row[e]})})),{flex:.175,minWidth:110,field:"right",headerName:"Số c\xe2u đ\xfang",renderCell:e=>(0,s.jsx)(d.Z,{variant:"body2",sx:{color:"text.primary"},children:e.row.right})},{flex:.175,minWidth:110,field:"number",headerName:"Đề số",renderCell:e=>(0,s.jsx)(d.Z,{variant:"body2",sx:{color:"text.primary"},children:e.row.number})},{flex:.175,minWidth:110,field:"retake",headerName:"Lần l\xe0m",renderCell:e=>(0,s.jsx)(d.Z,{variant:"body2",sx:{color:"text.primary"},children:e.row.retake})},{flex:.175,minWidth:110,field:"time",headerName:"Thời gian l\xe0m b\xe0i",renderCell:e=>(0,s.jsx)(d.Z,{variant:"body",sx:{color:"text.primary"},children:eU(e.row.time)})},{flex:.175,minWidth:180,field:"startAt",headerName:"Bắt đầu l\xfac",renderCell:e=>(0,s.jsx)(d.Z,{variant:"body2",sx:{color:"text.primary"},children:eY(e.row.startAt).format("HH:mm:ss DD/MM/YYYY")})},{flex:.175,minWidth:180,field:"submitAt",headerName:"Nộp b\xe0i l\xfac",renderCell:e=>(0,s.jsx)(d.Z,{variant:"body2",sx:{color:"text.primary"},children:e.row.submitAt&&eY(e.row.submitAt).format("HH:mm:ss DD/MM/YYYY")})},{flex:.175,minWidth:350,field:"link",headerName:"Link b\xe0i l\xe0m",renderCell:e=>(0,s.jsx)(d.Z,{variant:"body2",sx:{color:"text.primary"},children:(0,s.jsx)("a",{href:e.row.link,target:"_blank",style:{textDecoration:"none"},children:e.row.link})})},{flex:.175,minWidth:150,field:"hidden",headerName:"Số lần chuyển tabs",renderCell:e=>(0,s.jsx)(d.Z,{variant:"body2",sx:{color:"text.primary"},children:e.row.hidden})},{flex:.175,minWidth:150,field:"offline",headerName:"Số lần Offline",renderCell:e=>(0,s.jsx)(d.Z,{variant:"body2",sx:{color:"text.primary"},children:e.row.offline})},{flex:.175,minWidth:150,field:"devices",headerName:"Thiết bị",renderCell:e=>(0,s.jsx)(d.Z,{variant:"body2",sx:{color:"text.primary"},children:e.row.devices.join(", ")})},{flex:.175,minWidth:150,field:"ip",headerName:"Địa chỉ IP",renderCell:e=>(0,s.jsx)(d.Z,{variant:"body2",sx:{color:"text.primary"},children:e.row.ip.join(", ")})}];a&&j.push({flex:.175,minWidth:110,field:"status",headerName:"Trạng th\xe1i",renderCell:e=>{var t;return(null===(t=e.row)||void 0===t?void 0:t.submitAt)?(0,s.jsx)(u.Z,{variant:"tonal",color:"success",children:"Đ\xe3 xong"}):(0,s.jsx)(u.Z,{variant:"tonal",color:"error",children:"Đang l\xe0m"})}});let A=()=>{if(w.current){let e=(e,t)=>{if(!t)return"";switch(e){case"ip":case"devices":return t.join(", ");case"startAt":case"submitAt":return eY(t).format("HH:mm:ss DD/MM/YYYY");case"time":return eU(t)}return t};w.current.postMessage({action:"excel",payload:{results:t.map(t=>{let n={};return j.forEach(s=>{n[null==s?void 0:s.headerName]=e(null==s?void 0:s.field,t[null==s?void 0:s.field])}),n})}})}else P().fire({icon:"error",title:"Xảy ra lỗi",text:"Li\xean hệ quản trị vi\xean để được hỗ trợ."})};return(0,s.jsxs)(e_.Z,{children:[(0,s.jsx)(K.Z,{title:"Bảng điểm",action:(0,s.jsx)(eW,{exportTable:A,realtime:a,filter:I,setFilter:y})}),(0,s.jsx)(et._,{autoHeight:!0,pagination:!0,rows:p.filter(e=>{var t,n,s;return null!==(t=null==e?void 0:null===(n=e.student)||void 0===n?void 0:n.toString())&&void 0!==t&&!!t.toLocaleLowerCase().includes(null===(s=I.text.toString())||void 0===s?void 0:s.toLocaleLowerCase())&&("doing"==I.status?!e.submitAt:"done"!=I.status||e.submitAt)}),disableColumnFilter:!0,disableColumnMenu:!0,columns:j,pageSizeOptions:[25,50,100],paginationModel:g,onPaginationModelChange:m,apiRef:E})]})};var eV=o.memo(e$),eQ=n(7494),eK=n(7413),eX=n(2162),eJ=n(9601),e0=n(1221),e1=n(6599);let e2=(0,L.ZP)(e1.Z)({"& .MuiTimelineItem-root":{width:"100%","&:before":{display:"none"}}}),e5=(0,L.ZP)(c.Z)(e=>{let{theme:t}=e;return{display:"flex",alignItems:"center",padding:t.spacing(3),justifyContent:"space-between",backgroundColor:"#F8F8F8"}}),e4=e=>{var t,n,l,o;let{details:a,handleClose:h,handleClick:p}=e;return(0,s.jsxs)(ej.ZP,{open:!0,anchor:"right",variant:"temporary",onClose:h,ModalProps:{keepMounted:!0},sx:{"& .MuiDrawer-paper":{width:{md:"50%",xs:"95%"}}},children:[(0,s.jsxs)(e5,{children:[(0,s.jsxs)(d.Z,{variant:"h5",children:["Lịch sử l\xe0m b\xe0i của: ",null==a?void 0:null===(t=a.payload)||void 0===t?void 0:t.student]}),(0,s.jsx)(x.Z,{size:"small",onClick:h,sx:{p:"0.438rem",borderRadius:1,color:"text.primary",backgroundColor:"action.selected","&:hover":{backgroundColor:e=>"rgba(".concat(e.palette.customColors.main,", 0.16)")}},children:(0,s.jsx)(T.Z,{icon:"tabler:x",fontSize:"1.125rem"})})]}),(0,s.jsx)(c.Z,{sx:{mt:3,px:3},children:(0,s.jsx)(e2,{children:null==a?void 0:null===(n=a.payload)||void 0===n?void 0:null===(l=n.logs)||void 0===l?void 0:l.map((e,t)=>(0,s.jsxs)(eK.Z,{children:[(0,s.jsxs)(eJ.Z,{children:[(0,s.jsx)(eQ.Z,{color:"error"}),(0,s.jsx)(e0.Z,{})]}),(0,s.jsxs)(eX.Z,{sx:{"& svg":{verticalAlign:"bottom",mx:4}},children:[(0,s.jsx)(c.Z,{sx:{mb:2,display:"flex",flexWrap:"wrap",alignItems:"center",justifyContent:"space-between"},children:(0,s.jsx)(d.Z,{sx:{mr:2},variant:"h5",dangerouslySetInnerHTML:{__html:e.text}})}),(0,s.jsx)(c.Z,{children:(0,s.jsx)(d.Z,{variant:"body",sx:{color:"text.disabled"},children:eT()(e.t).format("HH:mm:ss DD/MM/YYYY")})})]})]},t))})}),(0,s.jsx)(e5,{sx:{justifyContent:"flex-end"},children:(0,s.jsx)(u.Z,{onClick:p(null==a?void 0:null===(o=a.payload)||void 0===o?void 0:o.id,"view"),variant:"contained",startIcon:(0,s.jsx)(T.Z,{icon:"tabler:eye"}),children:"Chi tiết b\xe0i l\xe0m"})})]})};var e3=o.memo(e4),e9=n(7720),e6=n(8462),e8=n(9294),e7=n(1008);n(8594);var te=n(5600);let tt=e=>{let t=(e,t)=>{for(var n;null!==(n=t.exec(e));){var s=n[1],l=document.createElement("span");l.setAttribute("class","ql-formula"),l.setAttribute("data-value",s),e=e.replace(n[0],l.outerHTML)}return e};return e=t(e,/\$([^$]+)\$/g),e=t(e,/\\\((.*?)\\\)/g),(e=t(e,/\\\[(.*?)\\\]/g)).replace(/′/g,"'").replace(/\u2009/g," ").replace(/\u2004/g," ").replace(/\u00AF/g,"-")},tn=()=>{let e=document.querySelectorAll(".ql-formula");e.forEach(e=>{try{let t=e.getAttribute("data-value");t&&(e.innerHTML=e7.Z.renderToString(t,{throwOnError:!1}))}catch(e){console.log(e.message)}})},ts=e=>{var t,n,l;let{details:a,updatePoint:h}=e;return(0,o.useEffect)(()=>{if(a){let e=e=>{let{link:t,data:n}=e;return new Promise(e=>{fetch(t).then(e=>e.blob()).then(t=>{let s=new Image;s.src=URL.createObjectURL(t),s.onload=function(){var t=document.createElement("canvas"),l=t.getContext("2d");t.width=n.width,t.height=n.height,l.drawImage(s,n.x,n.y,n.width,n.height,0,0,n.width,n.height),t.toBlob(t=>{e(URL.createObjectURL(t))},"image/png")}}).catch(t=>{console.error("Error fetching image:",t),e("")})})},t=async()=>{try{let s=document.querySelectorAll(".quill-image");for(var t=0;t<s.length;t++){var n=s[t];if(!n.getAttribute("src")){let{link:t,data:s}=JSON.parse(n.getAttribute("data-value")),l=await e({link:t,data:s});n.setAttribute("src",l)}}}catch(e){console.log("renderImage",e.message)}};t(),tn()}},[a]),null==a?void 0:null===(t=a.payload)||void 0===t?void 0:null===(n=t.details)||void 0===n?void 0:null===(l=n.groups)||void 0===l?void 0:l.map(e=>{var t,n,l,o;return(0,s.jsxs)(e_.Z,{sx:{mt:10,background:"unset"},children:[e.content&&(null==a?void 0:null===(t=a.payload)||void 0===t?void 0:null===(n=t.details)||void 0===n?void 0:n.groups.length)>1?(0,s.jsx)(Q.Z,{dangerouslySetInnerHTML:{__html:tt(e.content)},sx:{px:{xs:1,md:3}}}):null,(0,s.jsx)(Q.Z,{sx:{padding:0,":last-of-type":{pb:0}},children:null==a?void 0:null===(l=a.payload)||void 0===l?void 0:null===(o=l.details)||void 0===o?void 0:o.questions.filter(t=>t.groupId==e.id).map((e,t)=>{var n,l;return(0,s.jsxs)(e_.Z,{sx:{mb:5,":last-of-type":{mb:0}},id:e.id,children:[(0,s.jsx)(K.Z,{title:(0,s.jsxs)(d.Z,{variant:"body",sx:{fontWeight:700,color:"primary.main",whiteSpace:"nowrap"},component:"span",children:[e.label||"C\xe2u"," ",e.numberUser," (",e.number,")."]}),action:(0,s.jsxs)(c.Z,{sx:{display:"flex",alignItems:"center"},children:[["TN","HK"].includes(e.type)?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(te.Z,{rounded:!0,label:"Đ\xe1p \xe1n đ\xfang: "+(null==e?void 0:null===(n=e.options)||void 0===n?void 0:n.map((e,t)=>(null==e?void 0:e.keys)?"".concat(String.fromCharCode(65+t)," (").concat(String.fromCharCode(65+e.postion),")"):"").filter(e=>e).join(", ")),skin:"light",color:"success"}),(0,s.jsx)(te.Z,{rounded:!0,label:"Đ\xe3 chọn: "+((null==e?void 0:e.answers)?null==e?void 0:null===(l=e.answers)||void 0===l?void 0:l.map(t=>{var n=null==e?void 0:e.options[t];return"".concat(String.fromCharCode(65+t)," (").concat(String.fromCharCode(65+n.postion),")")}).join(", "):""),skin:"light",color:e.isTrue?"success":"error",sx:{mx:1}})]}):null,["TL"].includes(e.type)?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(te.Z,{rounded:!0,label:"GV chấm:",skin:"light",color:"info"}),(0,s.jsx)(X.Z,{type:"number",size:"small",sx:{width:"auto",maxWidth:"8rem",mx:2},value:e.teacher||0,InputProps:{inputProps:{min:0,max:parseFloat(e.maxPoint),step:.01},endAdornment:(0,s.jsx)(O.Z,{position:"end",children:"điểm"})},onChange:t=>h(e.id,{teacher:t}),timeout:300}),(0,s.jsx)(te.Z,{rounded:!0,label:"Tối đa: ".concat(parseFloat(e.maxPoint).toFixed(2)," điểm"),skin:"light",color:"success"})]}):(0,s.jsx)(d.Z,{variant:"body",sx:{fontWeight:700,color:e.isTrue?"success.main":"error.main"},children:-1==e.point?"":parseFloat(e.point).toFixed(2)+" điểm"})]}),sx:{paddingY:3,px:{xs:1,sm:2,md:3},overflowX:"auto"}}),(0,s.jsx)(Q.Z,{dangerouslySetInnerHTML:{__html:tt(e.content)},sx:{" p":{m:0},p:{xs:1,md:2}}}),(0,s.jsx)(Q.Z,{sx:{px:{xs:1,md:2},mt:3},children:(0,s.jsxs)(e6.Z,{disablePadding:!0,children:[["TN","HK"].includes(e.type)?e.options.map((e,t)=>(0,s.jsxs)(e8.ZP,{sx:{borderRadius:1,mb:1,border:"1px solid #b2b2b299",px:{xs:1,md:2}},user:e.user||"",children:[(0,s.jsx)(es.Z,{children:(0,s.jsxs)(en.Z,{skin:(null==e?void 0:e.user)?"static":"light",sx:{fontWeight:600},children:[String.fromCharCode(65+t)," (",String.fromCharCode(65+e.postion),")"]})}),(0,s.jsx)(c.Z,{dangerouslySetInnerHTML:{__html:tt(e.text)},sx:{" p":{m:0},flexGrow:1}})]},t)):null,"TF"==e.type?e.options.map((e,t)=>(0,s.jsxs)(e8.ZP,{divider:!0,sx:{gap:1,cursor:"default",paddingX:2},children:[(0,s.jsx)(en.Z,{skin:"light",user:(null==e?void 0:e.user[0])||"",children:"Đ"}),(0,s.jsx)(en.Z,{skin:"light",user:(null==e?void 0:e.user[1])||"",children:"S"}),(0,s.jsxs)(en.Z,{skin:"light",color:"secondary",sx:{fontWeight:600},children:[String.fromCharCode(97+t)," (",String.fromCharCode(97+(null==e?void 0:e.postion)),")"]}),(0,s.jsx)(c.Z,{dangerouslySetInnerHTML:{__html:tt(e.text)},sx:{" p":{m:0},flexGrow:1}})]},t)):null]})}),"TL"==e.type?(0,s.jsxs)(Q.Z,{sx:{px:2},children:[(0,s.jsx)(e9.Z,{sx:{fontWeight:600},children:"B\xe0i l\xe0m của học sinh"}),(0,s.jsx)(c.Z,{dangerouslySetInnerHTML:{__html:tt(((null==e?void 0:e.answers)||[])[0]||"")},sx:{" p":{m:0}}})]}):null,"DT"==e.type?(0,s.jsx)(Q.Z,{sx:{px:2},children:(0,s.jsxs)(N.ZP,{container:!0,spacing:3,children:[(0,s.jsxs)(N.ZP,{item:!0,xs:12,md:6,children:[(0,s.jsx)(e9.Z,{sx:{fontWeight:600},children:"Đ\xe1p \xe1n của học sinh"}),(0,s.jsx)(c.Z,{dangerouslySetInnerHTML:{__html:tt(((null==e?void 0:e.answers)||[])[0]||"")},sx:{" p":{m:0}}})]}),(0,s.jsx)(N.ZP,{item:!0,xs:12,md:6,sx:{color:"success.main"},children:e.options.length?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e9.Z,{sx:{fontWeight:600},children:"Đ\xe1p \xe1n đ\xfang"}),e.options.map((e,t)=>(0,s.jsxs)(d.Z,{variant:"body",children:[e.text," |"," "]},t))]}):null})]})}):null]},e.id)})})]},e.id)})};var ti=o.memo(ts),tr=n(3395);let tl=e=>Math.floor(e/36e5).toString().padStart(2,"0")+":"+Math.floor((e%=36e5)/6e4).toString().padStart(2,"0")+":"+Math.floor((e%=6e4)/1e3).toString().padStart(2,"0"),to=e=>{var t,n,l;let{details:a}=e,{points:c}=null==a?void 0:null===(t=a.payload)||void 0===t?void 0:t.overview,{overview:d}=null==a?void 0:a.payload,{collects:h=[]}=null==a?void 0:null===(n=a.payload)||void 0===n?void 0:n.details,u=null==a?void 0:null===(l=a.payload)||void 0===l?void 0:l.Username,[x,p]=(0,o.useState)(0);return(0,o.useEffect)(()=>{var e,t,n;let s=null==a?void 0:null===(e=a.payload)||void 0===e?void 0:null===(t=e.details)||void 0===t?void 0:null===(n=t.questions)||void 0===n?void 0:n.reduce((e,t)=>e+=parseFloat(t.teacher||t.point),0);p(s||0)},[a]),(0,s.jsxs)(N.ZP,{container:!0,spacing:3,sx:{px:3},children:[(0,s.jsxs)(N.ZP,{item:!0,xs:12,md:4,children:[(0,s.jsx)(e9.Z,{children:"ĐIỂM"}),(0,s.jsx)(eR,{series:[parseFloat(100*x/c||0).toFixed(2)],options:{chart:{height:300,type:"radialBar",sparkline:{enabled:!0}},colors:["#51e5a8"],plotOptions:{radialBar:{offsetY:-10,startAngle:-150,endAngle:150,hollow:{margin:0,size:"75%"},track:{background:"#ebe9f1",strokeWidth:"50%",margin:0},dataLabels:{show:!0,name:{show:!1,color:"#5e5873",fontSize:"2.86rem"},value:{formatter:e=>parseFloat(e*c/100||0).toFixed(2),color:"#5e5873",fontSize:"2.86rem",show:!0}}}},fill:{type:"gradient",gradient:{shade:"dark",type:"horizontal",shadeIntensity:.5,gradientToColors:["#51e5a8"],inverseColors:!0,opacityFrom:1,opacityTo:1,stops:[0,100]}},stroke:{lineCap:"round"},labels:[""],grid:{padding:{bottom:30}}},type:"radialBar",height:300})]}),(0,s.jsxs)(N.ZP,{item:!0,xs:12,md:4,children:[u?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e9.Z,{sx:{mt:2},children:"TH\xd4NG TIN TH\xcd SINH"}),(0,s.jsxs)(e6.Z,{children:[(0,s.jsx)(e8.ZP,{disablePadding:!0,children:(0,s.jsxs)(es.Z,{sx:{alignItems:"center",color:"primary.main"},children:[(0,s.jsx)(T.Z,{icon:"tabler:user-bolt",fontSize:20}),(0,s.jsxs)(ei.Z,{sx:{fontWeight:600,ml:1},disableTypography:!0,children:["Họ v\xe0 t\xean: ",null==u?void 0:u.fullname]})]})}),(0,s.jsx)(e8.ZP,{disablePadding:!0,children:(0,s.jsxs)(es.Z,{sx:{alignItems:"center",color:"primary.main"},children:[(0,s.jsx)(T.Z,{icon:"tabler:cash-banknote",fontSize:20}),(0,s.jsxs)(ei.Z,{sx:{fontWeight:600,ml:1},disableTypography:!0,children:["Lớp: ",null==u?void 0:u.classes]})]})}),(0,s.jsx)(e8.ZP,{disablePadding:!0,children:(0,s.jsxs)(es.Z,{sx:{alignItems:"center",color:"primary.main"},children:[(0,s.jsx)(T.Z,{icon:"tabler:school",fontSize:20}),(0,s.jsxs)(ei.Z,{sx:{fontWeight:600,ml:1},disableTypography:!0,children:["Trường: ",null==u?void 0:u.school]})]})})]})]}):null,h.length?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e9.Z,{children:"TH\xd4NG TIN THU THẬP"}),(0,s.jsx)(e6.Z,{children:h.map((e,t)=>(0,s.jsx)(e8.ZP,{disablePadding:!0,children:(0,s.jsxs)(es.Z,{sx:{alignItems:"center",color:"primary.main"},children:[(0,s.jsx)(T.Z,{icon:"tabler:point",fontSize:20}),(0,s.jsxs)(ei.Z,{sx:{fontWeight:600,ml:1},disableTypography:!0,children:[null==e?void 0:e.label,": ",null==e?void 0:e.value]})]})},t))})]}):null]}),(0,s.jsxs)(N.ZP,{item:!0,xs:12,md:4,children:[(0,s.jsx)(e9.Z,{children:"TH\xd4NG TIN B\xc0I THI"}),(0,s.jsxs)(e6.Z,{children:[(0,s.jsx)(e8.ZP,{disablePadding:!0,children:(0,s.jsxs)(es.Z,{sx:{alignItems:"center",color:"warning.main"},children:[(0,s.jsx)(T.Z,{icon:"tabler:clock",fontSize:20}),(0,s.jsx)(ei.Z,{sx:{fontWeight:600,ml:1},disableTypography:!0,children:"Thời gian l\xe0m b\xe0i:"}),(0,s.jsx)(tr.Z,{sx:{fontWeight:600,fontSize:"1.2rem"},children:tl(d.time)})]})}),(0,s.jsx)(e8.ZP,{disablePadding:!0,children:(0,s.jsxs)(es.Z,{sx:{alignItems:"center"},children:[(0,s.jsx)(T.Z,{icon:"tabler:clock",fontSize:20}),(0,s.jsxs)(ei.Z,{sx:{fontWeight:600,ml:1},disableTypography:!0,children:["Bắt đầu l\xfac: ",eT()(d.startAt).format("HH:mm:ss DD/MM/YYYY")]})]})}),(0,s.jsx)(e8.ZP,{disablePadding:!0,children:(0,s.jsxs)(es.Z,{sx:{alignItems:"center"},children:[(0,s.jsx)(T.Z,{icon:"tabler:clock",fontSize:20}),(0,s.jsxs)(ei.Z,{sx:{fontWeight:600,ml:1},disableTypography:!0,children:["Nộp b\xe0i l\xfac: ",eT()(d.submitAt).format("HH:mm:ss DD/MM/YYYY")]})]})}),(0,s.jsx)(e8.ZP,{disablePadding:!0,children:(0,s.jsxs)(es.Z,{sx:{alignItems:"center",color:"success.main"},children:[(0,s.jsx)(T.Z,{icon:"tabler:circle-check",fontSize:20}),(0,s.jsx)(ei.Z,{sx:{fontWeight:600,ml:1},disableTypography:!0,children:"Số c\xe2u trắc nghiệm đ\xfang"}),(0,s.jsx)(tr.Z,{sx:{fontWeight:600,fontSize:"1.2rem"},children:d.right})]})}),(0,s.jsx)(e8.ZP,{disablePadding:!0,children:(0,s.jsxs)(es.Z,{sx:{alignItems:"center",color:"error.main"},children:[(0,s.jsx)(T.Z,{icon:"tabler:circle-x",fontSize:20}),(0,s.jsx)(ei.Z,{sx:{fontWeight:600,ml:1},disableTypography:!0,children:"Số c\xe2u trắc nghiệm sai"}),(0,s.jsx)(tr.Z,{sx:{fontWeight:600,fontSize:"1.2rem"},children:d.error})]})}),(0,s.jsx)(e8.ZP,{disablePadding:!0,children:(0,s.jsxs)(es.Z,{sx:{alignItems:"center"},children:[(0,s.jsx)(T.Z,{icon:"tabler:sum",fontSize:20}),(0,s.jsx)(ei.Z,{sx:{fontWeight:600,ml:1},disableTypography:!0,children:"Tổng số c\xe2u hỏi trong đề"}),(0,s.jsx)(tr.Z,{sx:{fontWeight:600,fontSize:"1.2rem"},children:d.total})]})}),(0,s.jsx)(e8.ZP,{disablePadding:!0,children:(0,s.jsxs)(es.Z,{sx:{alignItems:"center"},children:[(0,s.jsx)(T.Z,{icon:"tabler:sum",fontSize:20}),(0,s.jsx)(ei.Z,{sx:{fontWeight:600,ml:1},disableTypography:!0,children:"Đề số"}),(0,s.jsx)(tr.Z,{sx:{fontWeight:600,fontSize:"1.2rem"},children:d.number})]})}),(0,s.jsx)(e8.ZP,{disablePadding:!0,children:(0,s.jsxs)(es.Z,{sx:{alignItems:"center"},children:[(0,s.jsx)(T.Z,{icon:"tabler:sum",fontSize:20}),(0,s.jsx)(ei.Z,{sx:{fontWeight:600,ml:1,a:{textDecoration:"none"}},disableTypography:!0,children:"Link b\xe0i l\xe0m:"}),(0,s.jsx)(tr.Z,{sx:{fontWeight:600,fontSize:"1.2rem",a:{textDecoration:"none"}},children:(0,s.jsx)("a",{href:d.link,target:"_blank",children:"Click để xem"})})]})})]})]})]})},ta=(0,L.ZP)(c.Z)(e=>{let{theme:t}=e;return{display:"flex",alignItems:"center",padding:t.spacing(3),justifyContent:"space-between",backgroundColor:"#F8F8F8"}}),tc=e=>{var t,n,l,a;let{details:h,handleClose:p,handleClick:f,saveResults:g,realtime:m}=e,[v,b]=(0,o.useState)(h);(0,o.useEffect)(()=>{var e;b(h),sessionStorage.removeItem("results_"+(null==h?void 0:null===(e=h.payload)||void 0===e?void 0:e.id))},[h]);let C=(e,t)=>{var n,s;if(m)return!1;let l=JSON.parse(sessionStorage.getItem("results_"+(null==v?void 0:null===(n=v.payload)||void 0===n?void 0:n.id))||"{}");sessionStorage.setItem("results_"+(null==v?void 0:null===(s=v.payload)||void 0===s?void 0:s.id),JSON.stringify({...l,comments:{...(null==l?void 0:l.comments)||{},[e]:t}})),b(n=>{var s,l,o;return{...n,payload:{...n.payload,details:{...null==n?void 0:null===(s=n.payload)||void 0===s?void 0:s.details,comments:{...null==n?void 0:null===(l=n.payload)||void 0===l?void 0:null===(o=l.details)||void 0===o?void 0:o.comments,[e]:t}}}}})},I=(e,t)=>{var n;if(m)return!1;let{teacher:s}=t,l=JSON.parse(sessionStorage.getItem("results_"+(null==v?void 0:null===(n=v.payload)||void 0===n?void 0:n.id))||"{}");b(t=>{var n,o,a,c;return{...t,payload:{...t.payload,details:{...null==t?void 0:null===(n=t.payload)||void 0===n?void 0:n.details,questions:null==t?void 0:null===(o=t.payload)||void 0===o?void 0:null===(a=o.details)||void 0===a?void 0:null===(c=a.questions)||void 0===c?void 0:c.map(t=>{if(t.id==e){var n;return sessionStorage.setItem("results_"+(null==v?void 0:null===(n=v.payload)||void 0===n?void 0:n.id),JSON.stringify({...l,points:{...(null==l?void 0:l.points)||{},[e]:Math.min(s,t.maxPoint)}})),{...t,teacher:Math.min(s,t.maxPoint)}}return t})}}}})},y=()=>{if(m)return!1;try{var e,t;let{comments:n={},points:s={}}=JSON.parse(sessionStorage.getItem("results_"+(null==v?void 0:null===(e=v.payload)||void 0===e?void 0:e.id))||"{}");Object.keys(n).length||Object.keys(s).length?g(null==v?void 0:null===(t=v.payload)||void 0===t?void 0:t.id):P().fire("Bạn chưa chỉnh sửa g\xec","","info")}catch(e){}},w=()=>{var e;if(m)return p(),!1;let{comments:t={},points:n={}}=JSON.parse(sessionStorage.getItem("results_"+(null==v?void 0:null===(e=v.payload)||void 0===e?void 0:e.id))||"{}");Object.keys(t).length||Object.keys(n).length?P().fire({icon:"warning",title:"Ch\xfa \xfd",html:'Bạn chưa lưu kết quả chấm điểm của b\xe0i l\xe0m n\xe0y. Vui l\xf2ng nhấn <b style="color:red">Lưu b\xe0i l\xe0m</b> trước khi tho\xe1t.',showCancelButton:!0,cancelButtonText:"Đ\xe3 hiểu",cancelButtonColor:"#d33",confirmButtonText:"Kh\xf4ng lưu"}).then(e=>{if(e.isConfirmed){var t;sessionStorage.removeItem("results_"+(null==v?void 0:null===(t=v.payload)||void 0===t?void 0:t.id)),p()}}):p()},E=()=>{var e,t;let{comments:n={},points:s={}}=JSON.parse(sessionStorage.getItem("results_"+(null==v?void 0:null===(e=v.payload)||void 0===e?void 0:e.id))||"{}");Object.keys(n).length||Object.keys(s).length?P().fire({icon:"warning",title:"Ch\xfa \xfd",html:'Bạn chưa lưu kết quả chấm điểm của b\xe0i l\xe0m n\xe0y. Vui l\xf2ng nhấn <b style="color:red">Lưu b\xe0i l\xe0m</b> trước khi tho\xe1t.',showCancelButton:!0,cancelButtonText:"Đ\xe3 hiểu",cancelButtonColor:"#d33",confirmButtonText:"Kh\xf4ng lưu"}).then(e=>{if(e.isConfirmed){var t,n;sessionStorage.removeItem("results_"+(null==v?void 0:null===(t=v.payload)||void 0===t?void 0:t.id)),f(null==v?void 0:null===(n=v.payload)||void 0===n?void 0:n.id,"history")}}):f(null==v?void 0:null===(t=v.payload)||void 0===t?void 0:t.id,"history")()};return(0,s.jsx)(ej.ZP,{open:!0,anchor:"right",variant:"temporary",onClose:w,ModalProps:{keepMounted:!0},sx:{"& .MuiDrawer-paper":{width:{md:"75%",xs:"95%"}}},children:(0,s.jsxs)(c.Z,{sx:{p:2,minWidth:350},children:[(0,s.jsxs)(ta,{children:[(0,s.jsxs)(d.Z,{variant:"h5",children:["B\xe0i l\xe0m của: ",null==v?void 0:null===(t=v.payload)||void 0===t?void 0:t.student]}),(0,s.jsx)(x.Z,{size:"small",onClick:w,sx:{p:"0.438rem",borderRadius:1,color:"text.primary",backgroundColor:"action.selected","&:hover":{backgroundColor:e=>"rgba(".concat(e.palette.customColors.main,", 0.16)")}},children:(0,s.jsx)(T.Z,{icon:"tabler:x",fontSize:"1.125rem"})})]}),(0,s.jsxs)(c.Z,{sx:{mt:3,px:0},children:[(0,s.jsx)(to,{details:v}),m?null:(0,s.jsxs)(c.Z,{sx:{px:3},children:[(0,s.jsx)(e9.Z,{children:"NHẬN X\xc9T CỦA GI\xc1O VI\xcaN"}),(0,s.jsx)(X.Z,{fullWidth:!0,multiline:!0,minRows:3,value:((null==v?void 0:null===(n=v.payload)||void 0===n?void 0:null===(l=n.details)||void 0===l?void 0:l.comments)||{})[null==v?void 0:null===(a=v.payload)||void 0===a?void 0:a.id]||"",onChange:e=>{var t;return C(null==v?void 0:null===(t=v.payload)||void 0===t?void 0:t.id,e)}})]}),(0,s.jsxs)(c.Z,{sx:{px:{xs:0,md:3}},children:[(0,s.jsx)(e9.Z,{children:"CHI TIẾT B\xc0I L\xc0M"}),(0,s.jsx)(ti,{details:v,updatePoint:I})]})]}),(0,s.jsxs)(ta,{sx:{justifyContent:"flex-end"},children:[(0,s.jsx)(u.Z,{onClick:E,variant:"contained",color:"success",startIcon:(0,s.jsx)(T.Z,{icon:"tabler:mist"}),children:"Lịch sử b\xe0i l\xe0m"}),m?null:(0,s.jsx)(u.Z,{onClick:y,variant:"contained",startIcon:(0,s.jsx)(T.Z,{icon:"tabler:device-floppy"}),sx:{ml:2},children:"Lưu b\xe0i l\xe0m"})]})]})})};var td=(0,o.memo)(tc);let th=e=>{let{details:t,handleClose:n,handleClick:l,saveResults:o,realtime:a=!1}=e;return"history"==t.open?(0,s.jsx)(e3,{details:t,handleClose:n,handleClick:l}):"view"==t.open?(0,s.jsx)(td,{details:t,handleClose:n,handleClick:l,saveResults:o,realtime:a}):null};var tu=o.memo(th),tx=n(9008),tp=n.n(tx);let tf=()=>{var e,t,n,a,u,f,g;let v=(0,l.useRouter)(),b=(0,p.I0)(),[I,w]=(0,o.useState)({exams:null,results:[],labels:[],time:null}),[E,j]=(0,o.useState)({open:!1,payload:{}}),A=(0,o.useRef)(null);(0,o.useEffect)(()=>{b((0,m.V)({status:"Đang tải..."})),A.current&&A.current.terminate(),fetch("".concat(C.default.assetPrefix,"/scripts/worker.").concat(C.default.version,".js")).then(e=>e.blob()).then(e=>{A.current=new Worker(URL.createObjectURL(e)),A.current.onmessage=async e=>{let{action:t="",payload:n=null}=e.data;switch(t){case"fetchLeaderboard":w(n),b((0,m.V)({status:""}));break;case"viewDetails":j({open:"view",payload:n});break;case"historyDetails":j({open:"history",payload:n});break;case"updateRealtime":w(e=>({...e,...n}))}}});let e=async()=>{try{let{parent:e="",id:t=""}=v.query;if(!t)return v.push("/");await y.default.get("/leaderboard/".concat(t,"/timeout"));let{data:n}=await y.default.get("/quizs/".concat(t,"/details?parent=").concat(e)),{data:s}=await y.default.post("/leaderboard/".concat(t,"/sync?parent=").concat(e));if((null==n?void 0:n.error)||(null==s?void 0:s.error))return P().fire({icon:"error",title:"Oops...",text:(null==n?void 0:n.error)||(null==s?void 0:s.error),footer:'<a href="#">Tại sao t\xf4i gặp th\xf4ng b\xe1o n\xe0y?</a>'}),v.push("/");A.current.postMessage({action:"fetchLeaderboard",payload:{response:n,results:s}})}catch(e){console.log("fetchData",e.message)}};return v.isReady&&e(),()=>{A.current&&A.current.terminate(),b((0,m.V)({status:""}))}},[v,b]);let S=(e,t)=>()=>{switch(t){case"remove":P().fire({title:"Bạn chắc chứ?",html:'<p>Bạn đang muốn xo\xe1 b\xe0i l\xe0m của th\xed sinh: <b style="color:red">'.concat((null==e?void 0:e.student)||(null==e?void 0:e.id),"</b>?</p>"),icon:"warning",showCancelButton:!0,confirmButtonText:"V\xe2ng. X\xf3a đi!",cancelButtonText:"Hủy"}).then(async t=>{if(t.isConfirmed){var n;b((0,m.V)({status:"Vui l\xf2ng đợi..."}));let{data:{error:t,text:s,time:l}}=await y.default.delete("/leaderboard/".concat(null===(n=v.query)||void 0===n?void 0:n.id,"?resultId=").concat(null==e?void 0:e.id));if(b((0,m.V)({status:""})),t)return P().fire(t,"","error");P().fire(s,"","success"),A.current.postMessage({action:"currentRealtime",payload:{...I,results:I.results.filter(t=>t.ResultId!=(null==e?void 0:e.id)),time:l}})}});break;case"view":A.current.postMessage({action:"viewDetails",payload:{id:e,leaderboard:I}});break;case"download":break;case"history":A.current.postMessage({action:"historyDetails",payload:{id:e,leaderboard:I}})}},N=async e=>{try{let{comments:t={},points:n={}}=JSON.parse(sessionStorage.getItem("results_"+e)||"{}");if(Object.keys(t).length||Object.keys(n).length){let{id:s=""}=v.query;b((0,m.V)({status:"Đang lưu"}));let{data:l}=await y.default.post("/leaderboard/".concat(s,"?resultId=").concat(e),{comments:t,points:n});if(b((0,m.V)({status:""})),l.error)return P().fire("Xảy ra lỗi!",l.error,"error");P().fire({icon:"success",title:"Đ\xe3 lưu",timer:1500}),sessionStorage.removeItem("results_"+e),A.current.postMessage({action:"updateResult",payload:{results:{...l,id:e},leaderboard:I}}),j({open:!1})}}catch(e){console.log("saveResults",e.message)}};return(0,s.jsxs)(c.Z,{children:[(0,s.jsx)(tp(),{children:(0,s.jsxs)("title",{children:["Bảng điểm - ",(null==I?void 0:null===(e=I.exams)||void 0===e?void 0:null===(t=e.settings)||void 0===t?void 0:t.title)||"..."]})}),(0,s.jsx)(e_.Z,{className:"header-leaderboard",sx:{mb:5,color:"white"},children:(0,s.jsx)(K.Z,{title:(0,s.jsxs)(d.Z,{variant:"h5",component:eS(),href:"/p/create.html?parent=".concat(v.query.parent,"&id=").concat(v.query.id),sx:{color:"white",textDecoration:"none"},children:["BẢNG ĐIỂM - ",(null==I?void 0:null===(n=I.exams)||void 0===n?void 0:null===(a=n.settings)||void 0===a?void 0:a.title)||"..."]}),avatar:(0,s.jsx)(T.Z,{icon:"tabler:checkup-list",fontSize:"1.125rem"}),action:(0,s.jsxs)(c.Z,{sx:{display:"flex",alignItems:"center",color:"white"},children:[(0,s.jsx)(h.Z,{title:"Chỉnh sửa",children:(0,s.jsx)(x.Z,{sx:{color:"white"},component:eS(),href:"/p/create.html?parent=".concat(v.query.parent,"&id=").concat(v.query.id),children:(0,s.jsx)(T.Z,{icon:"tabler:edit",fontSize:20})})}),(0,s.jsx)(h.Z,{title:"Gi\xe1m s\xe1t",children:(0,s.jsx)(x.Z,{sx:{color:"white"},component:eS(),href:"/p/realtime.html?parent=".concat(v.query.parent,"&id=").concat(v.query.id),children:(0,s.jsx)(T.Z,{icon:"tabler:camera-bolt",fontSize:20})})}),(0,s.jsx)(h.Z,{title:"Xem đề thi",children:(0,s.jsx)(x.Z,{sx:{color:"white"},component:eS(),href:null!==(g=null==I?void 0:null===(u=I.exams)||void 0===u?void 0:null===(f=u.settings)||void 0===f?void 0:f.url)&&void 0!==g?g:"#",target:"_blank",children:(0,s.jsx)(T.Z,{icon:"tabler:eye",fontSize:20})})})]}),subheader:(0,s.jsxs)("div",{children:[(0,s.jsxs)(d.Z,{sx:{color:"white",display:{xs:"none",sm:"inline"}},variant:"body",children:["Cập nhật l\xfac"," "]}),(0,s.jsx)(d.Z,{sx:{color:"white"},variant:"body",children:eY(null==I?void 0:I.time).format("HH:mm:ss DD/MM/YYYY")})]}),sx:{p:{xs:2,md:5}}})}),(0,s.jsx)(eB,{results:I.results.map(e=>{var t,n;return{point:null==e?void 0:null===(t=e.overview)||void 0===t?void 0:t.point,number:null==e?void 0:null===(n=e.overview)||void 0===n?void 0:n.number}}),maxPoint:10}),(0,s.jsx)(eV,{results:I.results.map(e=>({...e.overview,id:e.ResultId})).sort((e,t)=>t.point!==e.point?t.point-e.point:t.time!==e.time?e.time-t.time:e.startAt-t.startAt).map((e,t)=>({...e,rank:t+1})),labelColumn:I.labels,handleClick:S}),(0,s.jsx)(tu,{details:E,handleClose:()=>{j({open:!1})},handleClick:S,saveResults:N})]})},tg=e=>{let{sx:t,icon:n,stats:l,title:o,avatarSize:a=42,iconSize:h="1.625rem",avatarColor:u="primary"}=e;return(0,s.jsx)(e_.Z,{sx:{...t},children:(0,s.jsxs)(Q.Z,{sx:{gap:3,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,s.jsxs)(c.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-start"},children:[(0,s.jsx)(d.Z,{variant:"h5",sx:{mb:.5},children:l}),(0,s.jsx)(d.Z,{variant:"body2",children:o})]}),(0,s.jsx)(en.Z,{skin:"light",color:u,sx:{width:a,height:a},children:(0,s.jsx)(T.Z,{icon:n,fontSize:h})})]})})},tm=e=>{let{statistic:t}=e,n=[{stats:null==t?void 0:t.total,icon:"tabler:list-check",title:"Số b\xe0i l\xe0m"},{stats:null==t?void 0:t.students,icon:"tabler:users",title:"Số học sinh",avatarColor:"success"},{stats:null==t?void 0:t.points,avatarColor:"error",title:"Điểm trung b\xecnh",icon:"tabler:circle-check"},{stats:null==t?void 0:t.times,title:"Thời gian trung b\xecnh",avatarColor:"warning",icon:"tabler:clock"}];return(0,s.jsx)(N.ZP,{container:!0,spacing:6,sx:{mb:5},children:n.map((e,t)=>(0,s.jsx)(N.ZP,{item:!0,xs:12,md:3,children:(0,s.jsx)(tg,{...e})},t))})};var tv=(0,o.memo)(tm);let tb=()=>{let[e,t]=(0,o.useState)(null);return(0,o.useEffect)(()=>{let e=setInterval(()=>{t(eY().format("HH:mm:ss DD/MM/YYYY"))},1e3);return()=>{clearInterval(e)}},[]),(0,s.jsxs)("div",{children:[(0,s.jsxs)(d.Z,{sx:{color:"white",display:{xs:"none",sm:"inline"}},variant:"body",children:["Cập nhật l\xfac"," "]}),(0,s.jsx)(d.Z,{sx:{color:"white"},variant:"body",children:e})]})};var tC=o.memo(tb),tT=n(2848),tI=n(6476);let ty=(0,L.ZP)(c.Z)(e=>{let{theme:t}=e;return{display:"flex",alignItems:"center",padding:t.spacing(2.5),boxShadow:t.shadows[1],justifyContent:"space-between",borderRadius:t.shape.borderRadius,backgroundColor:t.palette.background.paper}}),tw=(0,L.ZP)(c.Z)(e=>{let{theme:t}=e;return{padding:t.spacing(0,5,5),marginTop:5}}),tE=e=>{let{messages:t,sendMessage:n}=e,[l,a]=(0,o.useState)(""),h=()=>{n(l),a("")},x=(0,o.useRef)(null);return(0,o.useEffect)(()=>{if(x.current){let{scrollTop:e,scrollHeight:n,clientHeight:s}=x.current._outerRef;(e+s+150>=n||!e)&&x.current.scrollToItem(t.length-1,"end")}},[t]),(0,s.jsxs)(e_.Z,{children:[(0,s.jsx)(K.Z,{title:(0,s.jsx)(d.Z,{variant:"h4",children:"Nhật k\xfd hoạt động"})}),(0,s.jsxs)(c.Z,{sx:{flexGrow:1,height:"100%",backgroundColor:"action.hover"},children:[(0,s.jsx)(tT.t7,{ref:x,height:450,width:"100%",itemCount:t.length,itemSize:75,children:e=>{let{index:n,style:l}=e;return(0,s.jsx)("div",{style:l,children:(0,s.jsxs)(c.Z,{sx:{display:"flex",flexDirection:t[n].admin?"row-reverse":"row",alignItems:"center",mb:2},children:[(0,s.jsx)(en.Z,{children:t[n].admin?"GV":t[n].label}),(0,s.jsxs)(eA.Z,{severity:"success",icon:!1,sx:{mr:t[n].admin?2:void 0,ml:t[n].admin?void 0:2},children:[(0,s.jsx)(d.Z,{variant:"h6",sx:{fontWeight:600},dangerouslySetInnerHTML:{__html:t[n].text}}),(0,s.jsx)("div",{style:{textAlign:t[n].admin?"right":"left"},children:(0,s.jsx)(d.Z,{variant:"body",sx:{fontSize:"0.75rem"},children:eT()(t[n].t).format("HH:mm:ss DD/MM/YYYY")})})]})]},t[n].id+n)})}}),(0,s.jsx)(tw,{children:(0,s.jsxs)(ty,{children:[(0,s.jsx)(c.Z,{sx:{flexGrow:1,display:"flex",alignItems:"center"},children:(0,s.jsx)(tI.Z,{fullWidth:!0,placeholder:"Nhập lời nhắn để gửi...",sx:{"& .Mui-focused":{boxShadow:"none !important"},"& .MuiInputBase-input:not(textarea).MuiInputBase-inputSizeSmall":{p:e=>e.spacing(1.875,2.5)},"& .MuiInputBase-root":{border:"0 !important"}},value:l,onChange:e=>a(e.target.value)})}),(0,s.jsx)(c.Z,{sx:{display:"flex",alignItems:"center"},children:(0,s.jsx)(u.Z,{type:"submit",variant:"contained",startIcon:(0,s.jsx)(T.Z,{icon:"tabler:send"}),onClick:h,children:"Gửi"})})]})})]})]})};var tj=o.memo(tE),tA=n(7918),tP=n(8987),tS=n(8619);let tN=e=>Math.floor(e/36e5).toString().padStart(2,"0")+":"+Math.floor((e%=36e5)/6e4).toString().padStart(2,"0")+":"+Math.floor((e%=6e4)/1e3).toString().padStart(2,"0"),tZ=e=>{let{students:t,handleClick:n}=e,[l,a]=(0,o.useState)(eT()().valueOf()),[h,u]=(0,o.useState)(null),[x,p]=(0,o.useState)(null),[f,g]=(0,o.useState)({left:0,top:0});(0,o.useEffect)(()=>{let e=setInterval(()=>{a(eT()().valueOf())},1e3);return()=>{e&&clearInterval(e)}},[]);let m=()=>{u(null)},v=(e,t)=>{u(t.currentTarget),p(e),g({left:t.clientX,top:t.clientY})},b=e=>t=>{u(null),p(null),n(x,e)},C={online:"success",offline:"error",hidden:"warning"},I={online:"Đang online",offline:"Đang offline",hidden:"Đang tho\xe1t khỏi b\xe0i l\xe0m"};return(0,s.jsxs)(e_.Z,{children:[(0,s.jsx)(K.Z,{title:(0,s.jsxs)(d.Z,{variant:"h4",children:["Học sinh đang l\xe0m ",(0,s.jsx)(tA.Z,{label:t.length,color:"success"})]})}),(0,s.jsxs)(c.Z,{sx:{flexGrow:1,height:"100%",backgroundColor:"action.hover"},children:[(0,s.jsx)(tT.t7,{height:520,width:"100%",itemCount:t.length,itemSize:62,itemData:t,children:e=>{var t,n,o,a;let{style:c,data:h,index:u}=e;return(0,s.jsx)("div",{style:c,index:u,children:(0,s.jsxs)(tS.Z,{divider:!0,onClick:e=>v(h[u],e),children:[(0,s.jsx)(tP.Z,{children:(0,s.jsx)(en.Z,{color:C[null===(t=h[u])||void 0===t?void 0:t.status],children:h[u].label})}),(0,s.jsxs)(ei.Z,{children:[(0,s.jsx)(d.Z,{variant:"h6",color:C[null===(n=h[u])||void 0===n?void 0:n.status],children:h[u].student}),(0,s.jsx)(d.Z,{variant:"body2",color:C[null===(o=h[u])||void 0===o?void 0:o.status],children:I[null===(a=h[u])||void 0===a?void 0:a.status]})]}),(0,s.jsxs)(tr.Z,{sx:{textAlign:"center"},children:[(0,s.jsxs)(d.Z,{children:["Đ\xe3 l\xe0m ",h[u].taked,"/",h[u].total]}),(0,s.jsx)(d.Z,{color:"error",fontWeight:600,children:tN(l-h[u].startAt)})]})]})})}}),(null==t?void 0:t.length)&&x?(0,s.jsx)(er.Z,{anchorReference:"anchorPosition",anchorPosition:f,keepMounted:!0,open:!!h,onClose:m,children:[{action:"alert",title:"Nhắc nhở quay lại b\xe0i thi",icon:"tabler:bell-plus",show:!1},{action:"message",title:"Gửi lời nhắn ri\xeang",icon:"tabler:message-chatbot",show:!1},{action:"cancel",title:"Buộc dừng b\xe0i thi",icon:"tabler:user-cancel",show:!0}].map(e=>!e.show&&(null==x?void 0:x.status)!="offline"||e.show?(0,s.jsxs)(el.Z,{onClick:b(e.action),children:[(0,s.jsx)(es.Z,{children:(0,s.jsx)(T.Z,{icon:e.icon,fontSize:20})}),(0,s.jsx)(ei.Z,{children:e.title})]},e.action):null)}):null]})]})};var tL=o.memo(tZ),t_=n(1876).Buffer;let tk=e=>{let t=t_.from(e,"base64"),n=b().gunzipSync(t);return JSON.parse(n.toString())},tM=e=>{let{settings:t=[],questions:n=[]}=e;try{let e={quizs:[],groups:[],questions:[],settings:{collects:[],students:[]}};return n.forEach(t=>{t.quizs&&e.quizs.push(tk(t.quizs)),t.groups&&e.groups.push(tk(t.groups)),t.questions&&e.questions.push(tk(t.questions))}),t.forEach(t=>{t.settings&&(e.settings={...e.settings,...tk(t.settings),url:t.url,postId:t.postId}),t.collects&&e.settings.collects.push(tk(t.collects)),t.students&&e.settings.students.push(tk(t.students))}),e}catch(e){return console.log("parseRespone",e.message),{}}},tR=e=>{let{exams:t,results:n}=e;try{let{questions:e}=t,{results:s}=n,l={};e.forEach(e=>{l[e.id]=e});let o={},a=[];return s.forEach(e=>{if(!o[null==e?void 0:null===(n=e.details)||void 0===n?void 0:n.ResultId]){o[null==e?void 0:null===(s=e.details)||void 0===s?void 0:s.ResultId]=1;let y=tk(null==e?void 0:null===(c=e.details)||void 0===c?void 0:c.details),w=tk(null==e?void 0:null===(d=e.securitys)||void 0===d?void 0:d.securitys),E=tk(null==e?void 0:null===(h=e.logs)||void 0===h?void 0:h.logs),j={rank:0,point:0,right:0,number:y.quizs[0].number,retake:null==e?void 0:null===(u=e.details)||void 0===u?void 0:u.Retake,time:(w.submitAt||eT()().valueOf())-w.startAt,startAt:w.startAt,submitAt:w.submitAt,total:0,link:(null==t?void 0:null===(x=t.settings)||void 0===x?void 0:x.url)+"?id="+(null==e?void 0:null===(p=e.details)||void 0===p?void 0:p.ResultId),points:0,student:tU({...null==e?void 0:e.details,details:y}),hidden:(null==w?void 0:null===(f=w.hidden)||void 0===f?void 0:f.length)||0,left:(null==w?void 0:null===(g=w.left)||void 0===g?void 0:g.length)||0,menu:(null==w?void 0:null===(m=w.right)||void 0===m?void 0:m.length)||0,offline:(null==E?void 0:E.filter(e=>(null==e?void 0:e.a)=="offline").length)||0,devices:(null==w?void 0:null===(v=w.devices)||void 0===v?void 0:v.map(e=>e.n))||[],ip:(null==w?void 0:null===(b=w.ips)||void 0===b?void 0:b.map(e=>e.n))||[],taked:0};if(j.label=tz(j.student),null==e?void 0:null===(C=e.details)||void 0===C?void 0:C.Username){var n,s,c,d,h,u,x,p,f,g,m,v,b,C,T,I={fullname:" Họ v\xe0 t\xean",classes:" Lớp",school:" Trường",username:" T\xean đăng nhập"};Object.keys(I).forEach(t=>{var n;j[I[t]]=null==e?void 0:null===(n=e.details)||void 0===n?void 0:n.Username[t]})}null==y||null===(T=y.collects)||void 0===T||T.forEach(e=>{j[e.label]=e.value}),y.questions.forEach((e,t)=>{let n=l[e.id];if(n){var s,o;let{isTrue:t,point:l}=tW(e,n);t&&j.right++,j.point+=["TL"].includes(n.type)?parseFloat(((null==y?void 0:y.points)||{})[n.id]||l):parseFloat(l),j.points+=parseFloat(n.point),j.total++,(null==e?void 0:null===(s=e.answers)||void 0===s?void 0:s.length)&&!(null==e?void 0:null===(o=e.answers)||void 0===o?void 0:o.includes(-1))&&j.taked++}}),a.push({...null==e?void 0:e.details,details:y,logs:E,securitys:w,overview:j})}}),a}catch(e){return console.log("parseResults",e.message),[]}},tO=e=>{let{results:t}=e;try{let e={};return t.forEach(t=>{var n,s;if(null==t?void 0:t.Username){var l={fullname:" Họ v\xe0 t\xean",classes:" Lớp",school:" Trường",username:" T\xean đăng nhập"};Object.keys(l).forEach(t=>{e[l[t]]=""})}null==t||null===(n=t.details)||void 0===n||null===(s=n.collects)||void 0===s||s.forEach(t=>{e[t.label]=""})}),e}catch(e){return console.log("parseLabels",e.message),{}}},tH=e=>{let{results:t}=e,n={total:t.length,students:0,points:0,times:0};try{let e={};return t.forEach(t=>{var s,l;e[t.UserToken]||(e[t.UserToken]=1),n.points+=parseFloat(null!==(l=null==t?void 0:null===(s=t.overview)||void 0===s?void 0:s.point)&&void 0!==l?l:0),n.times+=isNaN(null==t?void 0:t.overview.time)?0:null==t?void 0:t.overview.time}),n.students=Object.keys(e).length,{...n,points:parseFloat(n.points/n.total).toFixed(2),times:tY(parseInt(n.times/n.total))}}catch(e){return console.log("parseStatistic",e.message),n}},tB=e=>{let{results:t}=e;try{let e=[];return t.forEach(t=>{e=e.concat([...t.logs,...Object.keys(t.securitys).reduce((e,n)=>e=n.includes("At")?e.concat([]):e.concat(t.securitys[n].map(e=>({...e,a:n}))),[])].map(e=>{var n,s;return{...e,id:t.ResultId,student:null==t?void 0:null===(n=t.overview)||void 0===n?void 0:n.student,label:tz(null==t?void 0:null===(s=t.overview)||void 0===s?void 0:s.student)}}))}),tG(e)}catch(e){return console.log("parseLogs",e.message),[]}},tD=e=>{let{results:t,exams:n}=e;try{let{questions:e}=n,s={};return e.forEach(e=>{s[e.id]=e}),t.map(e=>{var t,l,o,a,c,d,h;let{details:u,logs:x,securitys:p}=e,f={rank:0,point:0,right:0,number:u.quizs[0].number,retake:null==e?void 0:e.Retake,time:(p.submitAt||eT()().valueOf())-p.startAt,startAt:p.startAt,submitAt:p.submitAt,total:0,link:(null==n?void 0:null===(t=n.settings)||void 0===t?void 0:t.url)+"?id="+(null==e?void 0:e.ResultId),points:0,student:tU(e),hidden:(null==p?void 0:null===(l=p.hidden)||void 0===l?void 0:l.length)||0,left:(null==p?void 0:null===(o=p.left)||void 0===o?void 0:o.length)||0,menu:(null==p?void 0:null===(a=p.right)||void 0===a?void 0:a.length)||0,offline:(null==x?void 0:x.filter(e=>(null==e?void 0:e.a)=="offline").length)||0,devices:(null==p?void 0:null===(c=p.devices)||void 0===c?void 0:c.map(e=>e.n))||[],ip:(null==p?void 0:null===(d=p.ips)||void 0===d?void 0:d.map(e=>e.n))||[],taked:0};if(f.label=tz(f.student),null==e?void 0:e.Username){var g={fullname:" Họ v\xe0 t\xean",classes:" Lớp",school:" Trường",username:" T\xean đăng nhập"};Object.keys(g).forEach(t=>{f[g[t]]=null==e?void 0:e.Username[t]})}return null==u||null===(h=u.collects)||void 0===h||h.forEach(e=>{f[e.label]=e.value}),u.questions.forEach((e,t)=>{let n=s[e.id];if(n){var l,o;let{isTrue:t,point:s}=tW(e,n);t&&f.right++,f.point+=["TL"].includes(n.type)?parseFloat(((null==u?void 0:u.points)||{})[n.id]||s):parseFloat(s),f.points+=parseFloat(n.point),f.total++,(null==e?void 0:null===(l=e.answers)||void 0===l?void 0:l.length)&&!(null==e?void 0:null===(o=e.answers)||void 0===o?void 0:o.includes(-1))&&f.taked++}}),{...e,overview:f}})}catch(e){return console.log("handleUpdateResultsRealtime",e.message),[]}},tF=e=>{let{results:t,exams:n,message:s}=e;try{let{action:e,ResultId:u,time:x,payload:p}=s,f=t.find(e=>e.ResultId==u);if(!f)return null;var l,o,a,c=null!==(o=null==f?void 0:null===(l=f.overview)||void 0===l?void 0:l.student)&&void 0!==o?o:"",d=null;"answers"==e&&(d=null==n?void 0:null===(a=n.questions)||void 0===a?void 0:a.find(e=>e.id==p.id));var h=tq({a:e,student:c,p:p,question:d});if(!h)return null;return{label:tz(c),t:x,id:u,text:h}}catch(e){return console.log("handleUpdateLogs",e.message),null}},tq=e=>{let{a:t,student:n,n:s,p:l,question:o}=e;switch(t){case"devices":return'Bạn <b style="color:red">'.concat(n,'</b> đ\xe3 truy cập bằng <b style="color:green">').concat(s,"</b>.");case"ips":return'Bạn <b style="color:red">'.concat(n,'</b> đ\xe3 truy cập địa chỉ IP <b style="color:green">').concat(s,"</b>.");case"left":return'Bạn <b style="color:red">'.concat(n,"</b> đ\xe3 nhấn chuột tr\xe1i.");case"right":return'Bạn <b style="color:red">'.concat(n,"</b> đ\xe3 nhấn chuột phải.");case"shortcut":return'Bạn <b style="color:red">'.concat(n,"</b> đ\xe3 sử dụng ph\xedm tắt.");case"hidden":return'Bạn <b style="color:red">'.concat(n,"</b> đ\xe3 tho\xe1t khỏi m\xe0n h\xecnh l\xe0m b\xe0i.");case"visible":return'Bạn <b style="color:red">'.concat(n,"</b> đ\xe3 quay trở lại m\xe0n h\xecnh l\xe0m b\xe0i.");case"start":return'Bạn <b style="color:red">'.concat(n,"</b> đ\xe3 bắt đầu l\xe0m b\xe0i thi.");case"online":return'Bạn <b style="color:red">'.concat(n,"</b> đ\xe3 kết nối mạng trở lại (online).");case"offline":return'Bạn <b style="color:red">'.concat(n,"</b> đ\xe3 ngắt kết nối mạng (offline)");case"submit":return'Bạn <b style="color:red">'.concat(n,'</b> đ\xe3 nộp b\xe0i thi <b style="color:green">(').concat((e=>{switch(e){case"teacher":return"GV buộc dừng";case"user":return"HS tự nộp";case"autotimeout":case"timeout":return"Hết giờ";case"tabs":return"Chuyển tabs"}return"Chưa x\xe1c định"})(null==l?void 0:l.s),")</b>.");case"answers":if(!o)return'Bạn <b style="color:red">'.concat(n,"</b> đ\xe3 trả lời c\xe2u hỏi");switch(null==o?void 0:o.type){case"TN":return'Bạn <b style="color:red">'.concat(n,"</b> đ\xe3 trả lời c\xe2u ").concat(null==l?void 0:l.n," phần ").concat((null==l?void 0:l.g)+1,' chọn <b style="color:green">"').concat(String.fromCharCode(65+(null==l?void 0:l.v)*1),'"</b>');case"DT":case"TL":return'Bạn <b style="color:red">'.concat(n,"</b> đ\xe3 trả lời c\xe2u ").concat(null==l?void 0:l.n," phần ").concat((null==l?void 0:l.g)+1,' với nội dung <b style="color:green">"').concat(null==l?void 0:l.v,'"</b>');case"HK":return'Bạn <b style="color:red">'.concat(n,"</b> đ\xe3 trả lời c\xe2u ").concat(null==l?void 0:l.n," phần ").concat((null==l?void 0:l.g)+1," ").concat((null==l?void 0:l.t)=="r"?"bỏ":"",' chọn <b style="color:green">"').concat(String.fromCharCode(65+(null==l?void 0:l.v)*1),'"</b>');case"TF":return'Bạn <b style="color:red">'.concat(n,"</b> đ\xe3 trả lời c\xe2u ").concat(null==l?void 0:l.n," phần ").concat((null==l?void 0:l.g)+1," \xfd ").concat(String.fromCharCode(97+(null==l?void 0:l.p)*1),' chọn <b style="color:green">"').concat((null==l?void 0:l.v)=="T"?"Đ\xfang":"Sai",'"</b>')}return'Bạn <b style="color:red">'.concat(n,"</b> đ\xe3 trả lời c\xe2u ").concat(null==l?void 0:l.n," phần ").concat((null==l?void 0:l.g)+1," chọn ")}return""},tz=e=>{try{return e.split(" ").map(e=>e.substr(0,1)).filter(e=>e).map(e=>e.toLocaleUpperCase()).join("").substr(-3)}catch(e){return""}},tG=e=>{let t=e=>{var t,n,s,l,o,a,c,d,h,u,x,p,f,g,m,v,b,C;switch(e.a){case"devices":return'Bạn <b style="color:red">'.concat(e.student,'</b> đ\xe3 truy cập bằng <b style="color:green">').concat(e.n,"</b>.");case"ips":return'Bạn <b style="color:red">'.concat(e.student,'</b> đ\xe3 truy cập địa chỉ IP <b style="color:green">').concat(e.n,"</b>.");case"left":return'Bạn <b style="color:red">'.concat(e.student,"</b> đ\xe3 nhấn chuột tr\xe1i.");case"right":return'Bạn <b style="color:red">'.concat(e.student,"</b> đ\xe3 nhấn chuột phải.");case"shortcut":return'Bạn <b style="color:red">'.concat(e.student,"</b> đ\xe3 sử dụng ph\xedm tắt.");case"hidden":return'Bạn <b style="color:red">'.concat(e.student,"</b> đ\xe3 tho\xe1t khỏi m\xe0n h\xecnh l\xe0m b\xe0i.");case"visible":return'Bạn <b style="color:red">'.concat(e.student,"</b> đ\xe3 quay trở lại m\xe0n h\xecnh l\xe0m b\xe0i.");case"submit":return'Bạn <b style="color:red">'.concat(e.student,'</b> đ\xe3 nộp b\xe0i thi <b style="color:green">(').concat((e=>{switch(e){case"teacher":return"GV buộc dừng";case"user":return"HS tự nộp";case"autotimeout":case"timeout":return"Hết giờ";case"tabs":return"Chuyển tabs"}return"Chưa x\xe1c định"})(null==e?void 0:null===(t=e.p)||void 0===t?void 0:t.s),")</b>.");case"start":return'Bạn <b style="color:red">'.concat(e.student,"</b> đ\xe3 bắt đầu l\xe0m b\xe0i thi.");case"online":return'Bạn <b style="color:red">'.concat(e.student,"</b> đ\xe3 kết nối mạng trở lại (online).");case"offline":return'Bạn <b style="color:red">'.concat(e.student,"</b> đ\xe3 ngắt kết nối mạng (offline)");case"answers":if(!(null==e?void 0:e.question))return'Bạn <b style="color:red">'.concat(e.student,"</b> đ\xe3 trả lời c\xe2u hỏi");switch(null==e?void 0:null===(n=e.question)||void 0===n?void 0:n.type){case"TN":return'Bạn <b style="color:red">'.concat(e.student,"</b> đ\xe3 trả lời c\xe2u ").concat(null==e?void 0:null===(o=e.p)||void 0===o?void 0:o.n," phần ").concat((null==e?void 0:null===(a=e.p)||void 0===a?void 0:a.g)+1,' chọn <b style="color:green">"').concat(String.fromCharCode(65+(null==e?void 0:null===(c=e.p)||void 0===c?void 0:c.v)*1),'"</b>');case"DT":case"TL":return'Bạn <b style="color:red">'.concat(e.student,"</b> đ\xe3 trả lời c\xe2u ").concat(null==e?void 0:null===(d=e.p)||void 0===d?void 0:d.n," phần ").concat((null==e?void 0:null===(h=e.p)||void 0===h?void 0:h.g)+1,' với nội dung <b style="color:green">"').concat(null==e?void 0:null===(u=e.p)||void 0===u?void 0:u.v,'"</b>');case"HK":return'Bạn <b style="color:red">'.concat(e.student,"</b> đ\xe3 trả lời c\xe2u ").concat(null==e?void 0:null===(x=e.p)||void 0===x?void 0:x.n," phần ").concat((null==e?void 0:null===(p=e.p)||void 0===p?void 0:p.g)+1," ").concat((null==e?void 0:null===(f=e.p)||void 0===f?void 0:f.t)=="r"?"bỏ":"",' chọn <b style="color:green">"').concat(String.fromCharCode(65+(null==e?void 0:null===(g=e.p)||void 0===g?void 0:g.v)*1),'"</b>');case"TF":return'Bạn <b style="color:red">'.concat(e.student,"</b> đ\xe3 trả lời c\xe2u ").concat(null==e?void 0:null===(m=e.p)||void 0===m?void 0:m.n," phần ").concat((null==e?void 0:null===(v=e.p)||void 0===v?void 0:v.g)+1," \xfd ").concat(String.fromCharCode(97+(null==e?void 0:null===(b=e.p)||void 0===b?void 0:b.p)*1),' chọn <b style="color:green">"').concat((null==e?void 0:null===(C=e.p)||void 0===C?void 0:C.v)=="T"?"Đ\xfang":"Sai",'"</b>')}return'Bạn <b style="color:red">'.concat(e.student,"</b> đ\xe3 trả lời c\xe2u ").concat(null==e?void 0:null===(s=e.p)||void 0===s?void 0:s.n," phần ").concat((null==e?void 0:null===(l=e.p)||void 0===l?void 0:l.g)+1," chọn ")}return""};return e.sort((e,t)=>e.t-t.t).filter(e=>!["left","right","shortcut"].includes(e.a)).map(e=>({label:e.label,t:e.t,id:e.id,item:e,text:t(e)}))},tY=e=>Math.floor(e/36e5).toString().padStart(2,"0")+":"+Math.floor((e%=36e5)/6e4).toString().padStart(2,"0")+":"+Math.floor((e%=6e4)/1e3).toString().padStart(2,"0"),tW=(e,t)=>{let n=!1,s=t.point,l=[];switch(t.type){case"TN":n=(null==e?void 0:e.sorts.filter((n,s)=>t.options[n].keys&&((null==e?void 0:e.answers)||[]).includes(s)).length)===1;break;case"HK":n=(null==e?void 0:e.sorts.filter(e=>{var n;return null===(n=null==t?void 0:t.options[e])||void 0===n?void 0:n.keys}).length)===(null==e?void 0:e.sorts.filter((n,s)=>{var l;return(null===(l=null==t?void 0:t.options[n])||void 0===l?void 0:l.keys)&&((null==e?void 0:e.answers)||[]).includes(s)}).length);break;case"DT":n=(null==t?void 0:t.options.filter(n=>{var s,l,o,a=n.text,[c=""]=(null==e?void 0:e.answers)||[];return(null==t?void 0:null===(s=t.settings)||void 0===s?void 0:s.sign)&&(a=removeAccents(a),c=removeAccents(c)),(null==t?void 0:null===(l=t.settings)||void 0===l?void 0:l.upper)&&(a=a.toLowerCase(),c=c.toLowerCase()),(null==t?void 0:null===(o=t.settings)||void 0===o?void 0:o.space)&&(a=a.replace(/\s/g,""),c=c.replace(/\s/g,"")),a==c}).length)>0;break;case"TF":var o=null==e?void 0:e.sorts.filter((n,s)=>t.options[n].keys===((null==e?void 0:e.answers)||[])[s]).length;s=[0,.1,.25,.5,1][o]*t.point,n=o===t.options.length}return n||"TF"===t.type||(s=0),l=null==e?void 0:e.sorts.map((n,s)=>{let l="",o=t.options[n],a=(null==e?void 0:e.answers)||[];switch(t.type){case"TN":a[0]===s&&(l="error"),o.keys&&(l="right",a.length||(l="none"));break;case"HK":a.includes(s)&&(l="error"),o.keys&&(l="right",a.length||(l="none"));break;case"DT":break;case"TF":if(l=["",""],a[s]){if(a[s]==o.keys)switch(o.keys){case"T":l[0]="right";break;case"F":l[1]="right"}else switch(o.keys){case"T":l=["right","error"];break;case"F":l=["error","right"]}}else switch(o.keys){case"T":l[0]="none";break;case"F":l[1]="none"}}return{...o,user:l,postion:n}}),"DT"==t.type&&(l=t.options),{isTrue:n,point:s,options:l}},tU=e=>{try{var t,n,s,l,o;if(null==e?void 0:null===(t=e.details)||void 0===t?void 0:null===(n=t.collects)||void 0===n?void 0:n.length)return null==e?void 0:null===(s=e.details)||void 0===s?void 0:s.collects.find(e=>/tên|name/i.test(e.label)).value;if(null==e?void 0:e.Username)return(null==e?void 0:null===(l=e.Username)||void 0===l?void 0:l.fullname)||(null==e?void 0:null===(o=e.Username)||void 0===o?void 0:o.username);return e.ResultId}catch(e){return console.log("getNameStudent",e.message),""}},t$=new class{addTask(e){this.queue.push(e),this.processQueue()}processQueue(){if(this.running<this.limit&&this.queue.length>0){let e=this.queue.shift();this.running++,e(()=>{this.running--,this.processQueue()})}}constructor(e=1){this.queue=[],this.running=0,this.limit=e}}(1),tV=()=>{var e,t,n,a,u,f,g;let v=(0,l.useRouter)(),b=(0,p.I0)(),[C,I]=(0,o.useState)({exams:{},results:[],statistic:{},logs:[],labels:{},students:[]}),w=(0,o.useRef)(),E=(0,o.useRef)(),j=(0,o.useCallback)(e=>{t$.addTask(async t=>{I(n=>{let{action:s,ResultId:l,time:o}=e,{results:a,exams:c,logs:d,students:h}=n;var u=a.findIndex(e=>e.ResultId==l);switch(s){case"current":var x=tD({results:(null==e?void 0:e.payload)||[],exams:c});a=[...a,...x],h=x.map(e=>({id:e.ResultId,student:e.overview.student,startAt:e.overview.startAt,label:e.overview.label,taked:e.overview.taked,total:e.overview.total,status:e.status,clientId:e.ClientId,userToken:e.UserToken}));break;case"start":var x=tD({results:[null==e?void 0:e.payload],exams:c});a=[...a,...x],h=[...h,...x.map(e=>({id:e.ResultId,student:e.overview.student,startAt:e.overview.startAt,label:e.overview.label,taked:e.overview.taked,total:e.overview.total,status:e.status,clientId:e.ClientId,userToken:e.UserToken}))];break;case"answers":if(u>=0){var p,f,g=a[u],[x]=tD({results:[{...g,details:{...null==g?void 0:g.details,questions:null==g?void 0:null===(p=g.details)||void 0===p?void 0:null===(f=p.questions)||void 0===f?void 0:f.map(t=>{var n,s;return(null==t?void 0:t.id)==(null==e?void 0:null===(n=e.payload)||void 0===n?void 0:n.id)?{...t,answers:null==e?void 0:null===(s=e.payload)||void 0===s?void 0:s.answers}:t})},logs:[...(null==g?void 0:g.logs)||[],{a:s,p:null==e?void 0:e.payload,t:e.time}],status:"online"}],exams:c});a[u]=x}break;case"visible":case"hidden":case"devices":case"ips":case"left":case"right":case"shortcut":if(u>=0){var g=a[u],[x]=tD({results:[{...g,securitys:{...g.securitys,[s]:[...g.securitys[s]||[],{a:s,t:e.time}]},status:["hidden"].includes(s)?"hidden":"online"}],exams:c});a[u]=x}break;case"submit":case"online":case"offline":if(u>=0){var g=a[u],[x]=tD({results:[{...g,logs:[...(null==g?void 0:g.logs)||[],{a:s,p:null==e?void 0:e.payload,t:e.time}],status:s}],exams:c});a[u]=x}}switch(s){case"start":e.ResultId=e.payload.ResultId;case"visible":case"hidden":case"online":case"offline":case"devices":case"ips":case"left":case"right":case"shortcut":case"submit":case"answers":var m=tF({results:a,exams:c,message:e});m&&(d=[...d,m])}var v=h.findIndex(e=>e.id==l);switch(s){case"visible":v>=0&&(h[v]={...h[v],status:"online"});break;case"hidden":case"online":case"offline":v>=0&&(h[v]={...h[v],status:s});break;case"submit":h=h.filter(e=>e.id!=l);break;case"answers":if(v>=0){var g=a[u];h[v]={...h[v],status:"online",taked:g.overview.taked}}}return setTimeout(()=>{t()},5),{...n,results:a,logs:d,students:h,labels:tO({results:a}),statistic:tH({results:a})}})})},[]),A=(0,o.useCallback)(async e=>{let{exams:t}=e,{parent:n="",id:s=""}=v.query,{data:l}=await y.default.post("/leaderboard/".concat(s,"/sync?parent=").concat(n));if(!(null==l?void 0:l.error)){let e=tR({results:l,exams:t}),n=tB({results:e}),s=tH({results:e}),o=tO({results:e});I(t=>({...t,results:[...e,...t.results],logs:[...n,...t.logs],statistic:{...t.statistic,...s},labels:{...t.labels,...o}}))}},[]),S=(0,o.useCallback)(async()=>{t$.addTask(async e=>{let{parent:t="",id:n=""}=v.query;if(!n)return v.push("/");await y.default.get("/leaderboard/".concat(n,"/timeout"));let{data:s}=await y.default.get("/quizs/".concat(n,"/details?parent=").concat(t));if(null==s?void 0:s.error)return P().fire({icon:"error",title:"Oops...",text:null==s?void 0:s.error,footer:'<a href="#">Tại sao t\xf4i gặp th\xf4ng b\xe1o n\xe0y?</a>'}),v.push("/");let l=tM(s);A({exams:l}),I(e=>({...e,exams:l})),e()})},[]),Z=(0,o.useCallback)(()=>{t$.addTask(e=>{(null==w?void 0:w.current)&&w.current.close(),E.current&&clearInterval(E.current);let{id:t=""}=v.query,n="".concat("wss://cloud.taodethi.xyz","/socket?id=").concat(t,"&accessToken=").concat(localStorage.getItem("accessToken")||"");w.current=new WebSocket(n),w.current.onopen=()=>{b((0,m.V)({status:""})),e(),E.current=setInterval(()=>{w.current.send(JSON.stringify({action:"ping"}))},3e4)},w.current.onclose=e=>{console.log("Disconnected from server",e)},w.current.onerror=e=>{console.error("WebSocket error:",e)},w.current.onmessage=e=>{try{j(JSON.parse(e.data))}catch(e){}}})},[]);(0,o.useEffect)(()=>(b((0,m.V)({status:"Vui l\xf2ng đợi..."})),v.isReady&&(S(),Z()),()=>{(null==w?void 0:w.current)&&w.current.close(),E.current&&clearInterval(E.current),b((0,m.V)({status:""}))}),[v]);let L=(0,o.useCallback)((e,t)=>()=>{switch(t){case"remove":if(!(null==e?void 0:e.submitAt)){P().fire({icon:"error",title:"Xảy ra lỗi",text:"Vui l\xf2ng kết th\xfac b\xe0i thi n\xe0y trước khi x\xf3a n\xf3."});return}P().fire({title:"Bạn chắc chứ?",html:'<p>Bạn đang muốn xo\xe1 b\xe0i l\xe0m của th\xed sinh: <b style="color:red">'.concat((null==e?void 0:e.student)||(null==e?void 0:e.id),"</b>?</p>"),icon:"warning",showCancelButton:!0,confirmButtonText:"V\xe2ng. X\xf3a đi!",cancelButtonText:"Hủy"}).then(async e=>{e.isConfirmed});break;case"view":worker.current.postMessage({action:"viewDetails",payload:{id:e,leaderboard}})}},[]),_=(0,o.useCallback)((e,t)=>{switch(t){case"alert":P().fire({icon:"warning",title:"Ch\xfa \xfd",html:'Bạn muốn nhắc nhở bạn <b style="color:red">'.concat((null==e?void 0:e.student)||e.id,"</b> quay lại l\xe0m b\xe0i thi ngay?"),showCancelButton:!0,cancelButtonText:"Hủy",cancelButtonColor:"#d33",confirmButtonText:"Đ\xfang vậy"}).then(t=>{if(t.isConfirmed){var n,s;(null==w?void 0:null===(n=w.current)||void 0===n?void 0:n.readyState)===WebSocket.OPEN?(null==w||null===(s=w.current)||void 0===s||s.send(JSON.stringify({action:"alert",payload:{clientId:e.clientId,resultId:e.id}})),P().fire("Đ\xe3 gửi!","","success")):P().fire("Vui l\xf2ng kết nối mạng","","error")}});break;case"message":P().fire({html:'Gửi lời nhắn đến bạn <b style="color:red">'.concat(e.student,"</b>"),input:"text",inputAttributes:{autocapitalize:"off"},showCancelButton:!0,confirmButtonText:"Gửi ngay",showLoaderOnConfirm:!0,preConfirm:async e=>{if(!e.toString().trim())return P().showValidationMessage("Vui l\xf2ng nhập nội dung")},allowOutsideClick:()=>!P().isLoading()}).then(t=>{if(t.isConfirmed){var n,s;(null==w?void 0:null===(n=w.current)||void 0===n?void 0:n.readyState)===WebSocket.OPEN?(null==w||null===(s=w.current)||void 0===s||s.send(JSON.stringify({action:"message",payload:{clientId:e.clientId,resultId:e.id,message:t.value}})),P().fire("Đ\xe3 gửi!","","success")):P().fire("Vui l\xf2ng kết nối mạng","","error")}});break;case"cancel":P().fire({icon:"warning",title:"Kết th\xfac b\xe0i thi",html:'Bạn muốn Kết th\xfac b\xe0i thi của th\xed sinh <b style="color:red">'.concat(e.student,"</b>?"),showCancelButton:!0,cancelButtonText:"Hủy",cancelButtonColor:"#d33",confirmButtonText:"Đ\xfang vậy"}).then(t=>{if(t.isConfirmed){var n,s;(null==w?void 0:null===(n=w.current)||void 0===n?void 0:n.readyState)===WebSocket.OPEN?(null==w||null===(s=w.current)||void 0===s||s.send(JSON.stringify({action:"cancel",payload:{clientId:e.clientId,resultId:e.id,userToken:e.userToken}})),P().fire("Đ\xe3 gửi!","","success")):P().fire("Vui l\xf2ng kết nối mạng","","error")}})}},[]),k=(0,o.useCallback)(e=>{var t,n;if((null==w?void 0:null===(t=w.current)||void 0===t?void 0:t.readyState)===WebSocket.OPEN){let t=C.students.map(e=>null==e?void 0:e.clientId);if(!t.length)return P().fire("Lỗi!","Hiện tại kh\xf4ng c\xf3 học sinh n\xe0o đang l\xe0m b\xe0i thi","error");null==w||null===(n=w.current)||void 0===n||n.send(JSON.stringify({action:"sendall",payload:{message:e,lists:t}})),P().fire("Đ\xe3 gửi!","","success")}else P().fire("Vui l\xf2ng kết nối mạng","","error")},[]);return(0,s.jsxs)(c.Z,{children:[(0,s.jsx)(tp(),{children:(0,s.jsxs)("title",{children:["Gi\xe1m s\xe1t - ",(null==C?void 0:null===(e=C.exams)||void 0===e?void 0:null===(t=e.settings)||void 0===t?void 0:t.title)||"..."]})}),(0,s.jsx)(e_.Z,{className:"header-realtime",sx:{mb:5,color:"white"},children:(0,s.jsx)(K.Z,{title:(0,s.jsxs)(d.Z,{variant:"h5",component:eS(),href:"/p/create.html?parent=".concat(v.query.parent,"&id=").concat(v.query.id),sx:{color:"white",textDecoration:"none"},children:["GI\xc1M S\xc1T - ",(null==C?void 0:null===(n=C.exams)||void 0===n?void 0:null===(a=n.settings)||void 0===a?void 0:a.title)||"..."]}),avatar:(0,s.jsx)(T.Z,{icon:"tabler:camera-bolt",fontSize:"1.125rem"}),action:(0,s.jsxs)(c.Z,{sx:{display:"flex",alignItems:"center",color:"white"},children:[(0,s.jsx)(h.Z,{title:"Chỉnh sửa",children:(0,s.jsx)(x.Z,{sx:{color:"white"},component:eS(),href:"/p/create.html?parent=".concat(v.query.parent,"&id=").concat(v.query.id),children:(0,s.jsx)(T.Z,{icon:"tabler:edit",fontSize:20})})}),(0,s.jsx)(h.Z,{title:"Bảng điểm",children:(0,s.jsx)(x.Z,{sx:{color:"white"},component:eS(),href:"/p/leaderboard.html?parent=".concat(v.query.parent,"&id=").concat(v.query.id),children:(0,s.jsx)(T.Z,{icon:"tabler:checkup-list",fontSize:20})})}),(0,s.jsx)(h.Z,{title:"Xem đề thi",children:(0,s.jsx)(x.Z,{sx:{color:"white"},component:eS(),href:null!==(g=null==C?void 0:null===(u=C.exams)||void 0===u?void 0:null===(f=u.settings)||void 0===f?void 0:f.url)&&void 0!==g?g:"#",target:"_blank",children:(0,s.jsx)(T.Z,{icon:"tabler:eye",fontSize:20})})})]}),subheader:(0,s.jsx)(tC,{}),sx:{p:{xs:2,md:5}}})}),(0,s.jsx)(tv,{statistic:C.statistic}),(0,s.jsx)(eB,{results:C.results.map(e=>{var t,n;return{point:null==e?void 0:null===(t=e.overview)||void 0===t?void 0:t.point,number:null==e?void 0:null===(n=e.overview)||void 0===n?void 0:n.number}}),maxPoint:10}),(0,s.jsx)(eV,{results:C.results.map(e=>({...e.overview,id:e.ResultId})).sort((e,t)=>t.point!==e.point?t.point-e.point:t.time!==e.time?e.time-t.time:e.startAt-t.startAt).map((e,t)=>({...e,rank:t+1})),labelColumn:C.labels,handleClick:L,realtime:!0}),(0,s.jsxs)(N.ZP,{container:!0,spacing:3,sx:{mt:3},children:[(0,s.jsx)(N.ZP,{item:!0,xs:12,md:6,children:(0,s.jsx)(tj,{messages:C.logs,sendMessage:k})}),(0,s.jsx)(N.ZP,{item:!0,xs:12,md:6,children:(0,s.jsx)(tL,{students:C.students,handleClick:_})})]})]})},tQ=(0,L.ZP)(c.Z)(e=>{let{theme:t}=e;return{display:"flex",alignItems:"center",padding:t.spacing(6),justifyContent:"space-between"}}),tK=e=>{let{data:t,open:n,onChange:l}=e,[a,h]=(0,o.useState)({fullname:"",number:"",birthday:"",chatId:"",phone:"",email:"",sex:""}),p=e=>{h(t=>({...t,...e}))},f=()=>{var e,n,s;return(null===(e=a.fullname)||void 0===e?void 0:e.toString().trim())?(null==a?void 0:a.phone)&&!/^(03|05|07|08|09|01[2|6|8|9])+([0-9]{8})\b$/.test(null!==(n=null==a?void 0:a.phone)&&void 0!==n?n:"")?P().fire({icon:"error",title:"Xảy ra lỗi",text:"Số điện thoại kh\xf4ng hợp lệ"}):(null==a?void 0:a.email)&&!/^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$/g.test(null!==(s=null==a?void 0:a.email)&&void 0!==s?s:"")?P().fire({icon:"error",title:"Xảy ra lỗi",text:"Địa chỉ Email kh\xf4ng hợp lệ"}):JSON.stringify(t)==JSON.stringify(a)?void 0:void l(a):P().fire({icon:"error",title:"Xảy ra lỗi",text:"T\xean học sinh kh\xf4ng được để trống."})};return(0,o.useEffect)(()=>{n&&h(t)},[n,t]),(0,s.jsxs)(ej.ZP,{open:n,anchor:"right",variant:"temporary",ModalProps:{keepMounted:!0},sx:{"& .MuiDrawer-paper":{width:{xs:300,sm:400}}},children:[(0,s.jsxs)(tQ,{children:[(0,s.jsx)(d.Z,{variant:"h5",children:"Th\xeam/Sửa học sinh"}),(0,s.jsx)(x.Z,{size:"small",sx:{p:"0.438rem",borderRadius:1,color:"text.primary",backgroundColor:"action.selected","&:hover":{backgroundColor:e=>"rgba(".concat(e.palette.customColors.main,", 0.16)")}},onClick:()=>l(null),children:(0,s.jsx)(T.Z,{icon:"tabler:x",fontSize:"1.125rem"})})]}),(0,s.jsxs)(c.Z,{sx:{p:e=>e.spacing(0,6,6)},children:[(0,s.jsx)(X.Z,{fullWidth:!0,sx:{mb:2},label:"Họ v\xe0 t\xean",helperText:"Th\xf4ng tin bắt buộc",required:!0,value:a.fullname||"",onChange:e=>p({fullname:e.trim()})}),(0,s.jsx)(X.Z,{fullWidth:!0,sx:{mb:2},label:"Số b\xe1o danh",type:"number",value:a.number||"",onChange:e=>p({number:e})}),(0,s.jsx)(X.Z,{fullWidth:!0,sx:{mb:2},type:"date",label:"Ng\xe0y sinh",InputLabelProps:{shrink:!0},value:a.birthday||"",onChange:e=>p({birthday:e})}),(0,s.jsxs)(X.Z,{fullWidth:!0,select:!0,sx:{mb:2},label:"Giới t\xednh",value:a.sex||"",onChange:e=>p({sex:e}),children:[(0,s.jsx)(el.Z,{value:"",children:"Chưa x\xe1c định"}),(0,s.jsx)(el.Z,{value:"Nam",children:"Nam"}),(0,s.jsx)(el.Z,{value:"Nữ",children:"Nữ"})]}),(0,s.jsx)(X.Z,{fullWidth:!0,sx:{mb:2},label:"Số điện thoại",value:a.phone||"",onChange:e=>p({phone:e})}),(0,s.jsx)(X.Z,{fullWidth:!0,sx:{mb:2},label:"Địa chỉ Email",value:a.email||"",onChange:e=>p({email:e})}),(0,s.jsx)(X.Z,{fullWidth:!0,sx:{mb:2},label:"ChatId",value:a.chatId||"",onChange:e=>p({chatId:e})})]}),(0,s.jsxs)(c.Z,{sx:{mt:3,textAlign:"center"},children:[(0,s.jsx)(u.Z,{sx:{mr:2},variant:"tonal",color:"error",onClick:()=>l(null),children:"Hủy"}),(0,s.jsx)(u.Z,{variant:"contained",onClick:f,children:"Lưu"})]})]})},tX=e=>{let{handleFilter:t,toggle:n,value:l}=e;return(0,s.jsxs)(c.Z,{sx:{py:4,px:6,rowGap:2,columnGap:4,display:"flex",flexWrap:"wrap",alignItems:"center",justifyContent:"space-between"},children:[(0,s.jsx)(c.Z,{}),(0,s.jsxs)(c.Z,{sx:{rowGap:2,display:"flex",flexWrap:"wrap",alignItems:"center"},children:[(0,s.jsx)(tI.Z,{value:l,sx:{mr:4},placeholder:"T\xean học sinh... ",onChange:e=>t(e.target.value)}),(0,s.jsxs)(u.Z,{onClick:n,variant:"contained",sx:{"& svg":{mr:2}},children:[(0,s.jsx)(T.Z,{fontSize:"1.125rem",icon:"tabler:plus"}),"Th\xeam học sinh"]})]})]})};var tJ=n(2470);let t0=e=>{var t;return e.avatar?(0,s.jsx)(en.Z,{src:e.avatar,sx:{mr:2.5,width:38,height:38}}):(0,s.jsx)(en.Z,{skin:"light",color:e.avatarColor,sx:{mr:2.5,width:38,height:38,fontWeight:500,fontSize:e=>e.typography.body1.fontSize},children:(0,tJ.Q)(null!==(t=e.fullname)&&void 0!==t?t:"Chưa c\xf3 th\xf4ng tin").substr(-3)})},t1=()=>{let e=(0,l.useRouter)(),t=(0,p.I0)(),[n,a]=(0,o.useState)([]),{classes:u}=e.query,[f,g]=(0,o.useState)(!1),[v,b]=(0,o.useState)(""),[C,I]=(0,o.useState)({}),w=()=>g(!f),E=(0,o.useCallback)(async()=>{try{if(!u)return e.push("/p/classes.html");g(!1),I({}),t((0,m.V)({status:"Vui l\xf2ng đợi..."}));let{data:n}=await y.default.get("/classes/class/".concat(u,"/view"));if(t((0,m.V)({status:""})),null==n?void 0:n.error)return P().fire({icon:"error",title:"Xảy ra lỗi",text:null==n?void 0:n.error});a(n.students)}catch(e){console.log("fetchData",e.message)}},[]);(0,o.useEffect)(()=>{e.isReady&&E()},[e]),(0,o.useEffect)(()=>(t((0,m.V)({status:"Vui l\xf2ng đợi..."})),()=>{t((0,m.V)({status:""}))}),[]);let j=(0,o.useCallback)(async e=>{if(!e)return I({}),g(!1);t((0,m.V)({status:"Vui l\xf2ng đợi..."}));let{data:n}=await y.default.post("/classes/class/".concat(u,"/add"),e);if(null==n?void 0:n.error)return t((0,m.V)({status:""})),P().fire({icon:"error",title:"Xảy ra lỗi",text:null==n?void 0:n.error});P().fire({icon:"success",text:"Đ\xe3 th\xeam mới học sinh "+e.fullname,timer:2e3}),await E()},[]),A=(0,o.useCallback)(e=>{b(e)},[]),S=(0,o.useCallback)(e=>{console.log(e),I(e),g(!0)},[]),Z=(0,o.useCallback)(e=>{let{id:n,fullname:s}=e;P().fire({icon:"warning",title:"Ch\xfa \xfd",html:'Bạn đang muốn x\xf3a học sinh <b style="color:red">'.concat(s,"</b> ra khỏi lớp học n\xe0y?"),showCancelButton:!0,cancelButtonText:"Hủy",confirmButtonText:"X\xf3a đi"}).then(async e=>{if(e.isConfirmed){t((0,m.V)({status:"Vui l\xf2ng đợi..."}));let{data:e}=await y.default.delete("/classes/class/".concat(u,"?studentId=").concat(n));if(null==e?void 0:e.error)return t((0,m.V)({status:""})),P().fire({icon:"error",title:"Xảy ra lỗi",text:null==e?void 0:e.error});P().fire({icon:"success",text:"Đ\xe3 x\xf3a học sinh "+s,timer:2e3}),await E()}})},[]);return(0,s.jsxs)(N.ZP,{container:!0,spacing:6.5,children:[(0,s.jsxs)(N.ZP,{item:!0,xs:12,children:[(0,s.jsx)(tX,{value:v,handleFilter:A,toggle:w}),(0,s.jsx)(et._,{autoHeight:!0,rows:(null!=n?n:[]).filter(e=>e.fullname.toLocaleLowerCase().includes(v.toLocaleLowerCase())),columns:[{flex:.25,minWidth:280,field:"fullname",headerName:"Họ v\xe0 t\xean",renderCell:e=>{let{row:t}=e,{fullname:n,phone:l}=t;return(0,s.jsxs)(c.Z,{sx:{display:"flex",alignItems:"center"},children:[t0(t),(0,s.jsxs)(c.Z,{sx:{display:"flex",alignItems:"flex-start",flexDirection:"column"},children:[(0,s.jsx)(d.Z,{noWrap:!0,component:eS(),href:"#",sx:{fontWeight:500,textDecoration:"none",color:"text.secondary","&:hover":{color:"primary.main"}},children:n}),(0,s.jsx)(d.Z,{noWrap:!0,variant:"body2",sx:{color:"text.disabled"},children:l})]})]})}},{flex:.15,minWidth:120,headerName:"Số b\xe1o danh",field:"number",renderCell:e=>{let{row:t}=e;return(0,s.jsx)(d.Z,{noWrap:!0,sx:{fontWeight:500,color:"text.secondary",textTransform:"capitalize"},children:t.number})}},{flex:.15,minWidth:120,headerName:"Giới t\xednh",field:"sex",renderCell:e=>{let{row:t}=e;return(0,s.jsx)(d.Z,{noWrap:!0,sx:{fontWeight:500,color:"text.secondary",textTransform:"capitalize"},children:t.sex})}},{flex:.15,minWidth:120,headerName:"Ng\xe0y sinh",field:"birthday",renderCell:e=>{let{row:t}=e;return(0,s.jsx)(d.Z,{noWrap:!0,sx:{fontWeight:500,color:"text.secondary",textTransform:"capitalize"},children:t.birthday})}},{flex:.1,minWidth:100,sortable:!1,field:"id",headerName:"",renderCell:e=>{let{row:t}=e;return(0,s.jsxs)(c.Z,{children:[(0,s.jsx)(h.Z,{title:"Sửa",children:(0,s.jsx)(x.Z,{onClick:()=>S(t),children:(0,s.jsx)(T.Z,{icon:"tabler:pencil-minus"})})}),(0,s.jsx)(h.Z,{title:"Xo\xe1",children:(0,s.jsx)(x.Z,{color:"error",onClick:()=>Z(t),children:(0,s.jsx)(T.Z,{icon:"tabler:trash-filled"})})})]})}}],initialState:{pagination:{paginationModel:{pageSize:15}}},pageSizeOptions:[15,25,50],disableRowSelectionOnClick:!0})]}),(0,s.jsx)(tK,{open:f,onChange:j,data:C})]})};var t2=n(7922),t5=n(8756);let t4=e=>{let{children:t,option:n}=e;return n.href?(0,s.jsx)(c.Z,{component:eS(),href:n.href,...n.linkProps,sx:{px:4,py:1.5,width:"100%",display:"flex",color:"inherit",alignItems:"center",textDecoration:"none"},children:t}):(0,s.jsx)(s.Fragment,{children:t})},t3=e=>{let{icon:t,options:n,menuProps:l,iconProps:a,leftAlignMenu:c,iconButtonProps:d}=e,[h,u]=(0,o.useState)(null),{settings:p}=(0,t5.r)(),{direction:f}=p,g=e=>{u(e.currentTarget)},m=()=>{u(null)};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(x.Z,{"aria-haspopup":"true",onClick:g,...d,children:t||(0,s.jsx)(T.Z,{icon:"tabler:dots-vertical",...a})}),(0,s.jsx)(er.Z,{keepMounted:!0,anchorEl:h,onClose:m,open:!!h,...!c&&{anchorOrigin:{vertical:"bottom",horizontal:"ltr"===f?"right":"left"},transformOrigin:{vertical:"top",horizontal:"ltr"===f?"right":"left"}},...l,children:n.map((e,t)=>"string"==typeof e?(0,s.jsx)(el.Z,{onClick:m,children:e},t):"divider"in e?e.divider&&(0,s.jsx)(e9.Z,{...e.dividerProps},t):(0,s.jsx)(el.Z,{...e.menuItemProps,...e.href&&{sx:{p:0}},onClick:t=>{m(),e.menuItemProps&&e.menuItemProps.onClick&&e.menuItemProps.onClick(t)},children:(0,s.jsxs)(t4,{option:e,children:[e.icon?e.icon:null,e.text]})},t))})]})},t9=e=>isNaN(parseFloat(e))?0:parseFloat(e).toFixed(2);var t6=e=>{let{questionId:t}=e,n=(0,p.v9)(e=>e.quiz.questions.find(e=>e.id==t)),l=(0,p.I0)(),a=e=>{l((0,g.Ds)({id:t,...e}))},[c,d]=(0,o.useState)(!1),[u,x]=(0,o.useState)(!1),f=e=>()=>{l((0,g.Zw)({questionId:t,type:"point",value:n.point||0,list:e})),x(!1)},m=()=>{d(!0),x(!1)};return c?(0,s.jsx)(X.Z,{type:"number",size:"small",sx:{width:"auto",maxWidth:"8rem"},value:n.point||0,InputProps:{inputProps:{min:0,max:10,step:.01},endAdornment:(0,s.jsx)(O.Z,{position:"end",children:"điểm"})},onMouseLeave:()=>d(!1),onChange:e=>a({point:e}),timeout:300}):(0,s.jsx)(h.Z,{open:u,onOpen:()=>x(!0),onClose:()=>x(!1),title:(0,s.jsxs)(e6.Z,{component:"div",children:[(0,s.jsx)(e8.ZP,{disablePadding:!0,children:(0,s.jsx)(tS.Z,{sx:{paddingX:1},onClick:m,children:(0,s.jsx)(ei.Z,{disableTypography:!0,sx:{fontSize:".75rem",textAlign:"center"},children:"Click để sửa điểm"})})}),(0,s.jsx)(e8.ZP,{disablePadding:!0,children:(0,s.jsx)(tS.Z,{sx:{paddingX:1},onClick:f("group"),children:(0,s.jsx)(ei.Z,{disableTypography:!0,sx:{fontSize:".75rem"},children:"\xc1p dụng cho c\xe2u c\xf2n lại trong nh\xf3m"})})}),(0,s.jsx)(e8.ZP,{disablePadding:!0,children:(0,s.jsx)(tS.Z,{sx:{paddingX:1},onClick:f("exam"),children:(0,s.jsx)(ei.Z,{disableTypography:!0,sx:{fontSize:".75rem"},children:"\xc1p dụng cho c\xe2u c\xf2n lại trong đề thi"})})})]}),arrow:!0,children:(0,s.jsx)(tA.Z,{variant:"outlined",label:t9(n.point)+" điểm",skin:"light",color:"primary",sx:{cursor:"pointer"},onClick:m})})},t8=n(7435),t7=e=>{let{questionId:t}=e,n=(0,p.v9)(e=>e.quiz.questions.find(e=>e.id==t)),l=(0,p.I0)(),a=e=>{l((0,g.Ds)({id:t,...e}))},[c,d]=(0,o.useState)(!1);return c?(0,s.jsxs)(t8.Z,{spacing:2,onMouseLeave:()=>{d(!1)},children:[(0,s.jsx)(X.Z,{label:"Nh\xe3n",size:"small",value:n.label,onChange:e=>a({label:e.trim()}),sx:{maxWidth:"15rem"},timeout:100}),(0,s.jsx)(X.Z,{label:"STT",type:"number",size:"small",value:n.number,InputProps:{inputProps:{min:1}},sx:{maxWidth:"15rem"},onChange:e=>a({number:e}),timeout:300})]}):(0,s.jsx)(h.Z,{title:"Click để sửa số thứ tự c\xe2u",children:(0,s.jsx)(tA.Z,{label:"".concat(n.label||"C\xe2u"," ").concat(n.number),color:"primary",onClick:()=>d(!0)})})};let ne=eM()(()=>Promise.all([n.e(446),n.e(937),n.e(828),n.e(931)]).then(n.bind(n,4931)).then(e=>e.default),{loadableGenerated:{webpack:()=>[4931]},ssr:!1,loading:()=>(0,s.jsx)(c.Z,{sx:{textAlign:"center"},children:(0,s.jsx)(ef.Z,{})})}),nt=e=>(0,s.jsx)("div",{children:(0,s.jsx)(ne,{...e})});var nn=o.memo(nt);let ns={mouseX:null,mouseY:null},ni=e=>{let{children:t,onClick:n}=e,[l,a]=(0,o.useState)(ns),c=e=>{e.preventDefault(),a({mouseX:e.clientX-2,mouseY:e.clientY-4})},d=()=>{n({index:t.key,type:"remove"}),h()},h=()=>{a(ns)};return(0,s.jsxs)("div",{onContextMenu:c,style:{cursor:"context-menu"},children:[t,(0,s.jsx)(er.Z,{keepMounted:!0,onClose:h,open:null!==l.mouseY,anchorReference:"anchorPosition",anchorPosition:null!==l.mouseY&&null!==l.mouseX?{top:l.mouseY,left:l.mouseX}:void 0,children:(0,s.jsxs)(el.Z,{onClick:d,children:[(0,s.jsx)(es.Z,{children:(0,s.jsx)(T.Z,{icon:"tabler:circle-x",fontSize:20})}),(0,s.jsx)(ei.Z,{primary:"X\xf3a đ\xe1p \xe1n n\xe0y"})]})})]})},nr=e=>{let{question:t,onChange:n}=e,{type:l,options:a=[],settings:d={},id:g}=t,[m,v]=(0,o.useState)(!1),[b,C]=(0,o.useState)(""),[I,y]=(0,o.useState)(a),w=(0,p.I0)(),E=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return()=>{switch(l){case"TN":y(t=>t.map((t,n)=>({...t,keys:n===e})));break;case"HK":y(t=>t.map((t,n)=>({...t,keys:n===e?!t.keys:t.keys})));break;case"TF":y(n=>n.map((n,s)=>({...n,keys:s===e?t:n.keys})))}}},j=()=>{let e={text:"",keys:""};y(t=>[...t,e])},A=()=>{y(e=>[...e,...b.split("\n").map(e=>({text:e.trim(),keys:""})).filter(e=>e.text)]),C(""),v(!1)},P=e=>{let{index:t,type:n}=e;"remove"===n&&y(e=>{var n=[...e];return n.splice(parseInt(t),1),n})},S=()=>{w((0,f.z)({status:"options",data:{questionId:g,title:"CẤU H\xccNH NHẬN DIỆN Đ\xc1P \xc1N ĐIỀN TỪ",...d}}))},N=(0,o.useMemo)(()=>I.map((e,t)=>{let n=e=>{y(n=>n.map((n,s)=>({...n,text:s===t?e:n.text})))};return(0,s.jsx)(ni,{onClick:P,children:(0,s.jsx)(e8.ZP,{disablePadding:!0,sx:{borderRadius:1,mb:1,border:"1px solid #b2b2b299"},children:(0,s.jsxs)(tS.Z,{sx:{paddingX:1.25,borderRadius:1},user:"TF"!==l&e.keys?"right":"",children:["TF"==l?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(en.Z,{skin:"light",color:"success",sx:{mr:1},user:"T"==e.keys?"right":"",onClick:E(t,"T"),children:"Đ"}),(0,s.jsx)(en.Z,{skin:"light",user:"F"==e.keys?"right":"",color:"success",sx:{mr:1},onClick:E(t,"F"),children:"S"}),(0,s.jsx)(en.Z,{skin:"light",sx:{mr:1},children:String.fromCharCode(97+t)})]}):(0,s.jsx)(tP.Z,{sx:{mr:1.25},onClick:E(t),children:(0,s.jsx)(en.Z,{skin:e.keys?"light-static":"light",sx:{fontWeight:600},children:"MN|DT".includes(l)?t+1:String.fromCharCode(65+t)})}),(0,s.jsx)(ei.Z,{disableTypography:!0,sx:{justifyItems:"center"},children:"DT"==l?(0,s.jsx)(X.Z,{placeholder:"Vui l\xf2ng nhập danh s\xe1ch đ\xe1p \xe1n cần th\xeam",fullWidth:!0,value:e.text||"",onChange:n}):(0,s.jsx)(nn,{content:e.text||"",onChange:n})})]})},t)},t)}),[I,l]);return((0,o.useEffect)(()=>{JSON.stringify(a)!==JSON.stringify(I)&&n({options:I})},[I,a]),(0,o.useEffect)(()=>{JSON.stringify(a)!==JSON.stringify(I)&&y(a)},[]),"TN|HK|MN|DT|TF".includes(l))?(0,s.jsxs)(c.Z,{sx:{mb:2},children:[(0,s.jsxs)(c.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,s.jsx)(e9.Z,{sx:{flexGrow:"1"},children:"DANH S\xc1CH Đ\xc1P \xc1N"}),"DT".includes(l)?(0,s.jsx)(h.Z,{title:"C\xe0i đặt nhận diện đ\xe1p \xe1n",children:(0,s.jsx)(x.Z,{size:"small",sx:{ml:1},onClick:S,children:(0,s.jsx)(T.Z,{icon:"tabler:settings-check",fontSize:20})})}):null]}),(0,s.jsx)(e6.Z,{children:N}),(0,s.jsxs)(c.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[(0,s.jsx)(u.Z,{variant:"contained",size:"small",color:"success",onClick:j,children:"Th\xeam đ\xe1p \xe1n"}),(0,s.jsx)(u.Z,{variant:"tonal",size:"small",onClick:()=>v(!0),children:"Th\xeam nhanh"})]}),m?(0,s.jsxs)(c.Z,{children:[(0,s.jsx)(X.Z,{placeholder:"Vui l\xf2ng nhập danh s\xe1ch đ\xe1p \xe1n cần th\xeam",helperText:"* Lưu \xfd mỗi đ\xe1p \xe1n chỉ tr\xean một d\xf2ng",fullWidth:!0,minRows:3,multiline:!0,value:b,onChange:e=>C(e)}),(0,s.jsxs)(c.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"flex-end",mb:2},children:[(0,s.jsx)(u.Z,{variant:"tonal",size:"small",onClick:()=>{v(!1),C("")},sx:{mr:1},children:"Hủy"}),(0,s.jsx)(u.Z,{variant:"contained",size:"small",onClick:A,children:"X\xe1c nhận"})]})]}):null]}):null};var nl=o.memo(nr),no=n(5438),na=n(2852),nc=o.memo(function(e){let{videoId:t}=e;return(0,s.jsx)("div",{style:{position:"relative",paddingBottom:"56.25%",height:0,overflow:"hidden"},children:(0,s.jsx)("iframe",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%"},src:"https://www.youtube.com/embed/".concat((e=>{let t=e.match(/^(?:https?:\/\/)?(?:www\.)?youtu\.?be(?:\.com)?\/(?:watch\?v=|embed\/|v\/|youtu\.be\/|youtube\.com\/(?:c\/|v\/|u\/\w+\/|embed\/|watch\?v=|shorts\/))([\w-]{11})(?:[?&].*|$)/);return t?t[1]:null})(t)),title:"YouTube video player",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",frameBorder:"0",allowFullScreen:!0})})}),nd=o.memo(e=>{let{audio:t,onChange:n}=e,[l,a]=(0,o.useState)(""),{type:d,src:p}=t||{},f=e=>{let s=e.target.files[0];if(s){if("audio/mp3"===s.type||"audio/wav"===s.type||"audio/mpeg"===s.type||"audio/ogg"===s.type){let e=URL.createObjectURL(s);n({...t,src:e,type:"audio"})}else P().fire({icon:"error",title:"Oops...",text:"Chọn một file \xe2m thanh MP3 hoặc WAV."})}},g=e=>{let t=e.match(/^(?:https?:\/\/)?(?:www\.)?youtu\.?be(?:\.com)?\/(?:watch\?v=|embed\/|v\/|youtu\.be\/|youtube\.com\/(?:c\/|v\/|u\/\w+\/|embed\/|watch\?v=|shorts\/))([\w-]{11})(?:[?&].*|$)/);return t?t[1]:null},m=()=>{let e=g(l);e?(v({...t,src:l,type:"youtube"}),a("")):console.log("URL kh\xf4ng hợp lệ hoặc kh\xf4ng phải l\xe0 URL của video YouTube.")},v=e=>{n({...t,...e})};return(0,s.jsxs)(c.Z,{sx:{mb:2},children:[(0,s.jsxs)(c.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,s.jsxs)(u.Z,{variant:"tonal",fullWidth:!0,component:"label",sx:{mr:2},endIcon:(0,s.jsx)(T.Z,{icon:"tabler:headphones-filled"}),children:["Đ\xednh k\xe8m file \xe2m thanh",(0,s.jsx)("input",{type:"file",accept:".mp3, .wav,.mpeg, .ogg",hidden:!0,onChange:f})]}),(0,s.jsx)(u.Z,{variant:"tonal",fullWidth:!0,color:"success",endIcon:(0,s.jsx)(T.Z,{icon:"tabler:brand-youtube-filled"}),onClick:()=>{n({...t,type:"youtube",src:""})},children:"Đ\xednh k\xe8m video youtube"})]}),"youtube"!=d||p?null:(0,s.jsxs)(c.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",marginY:3},children:[(0,s.jsx)(R.Z,{size:"small",fullWidth:!0,variant:"outlined",label:"Link youtube",placeholder:"https://www.youtube.com/watch?v=TAODETHI",sx:{mr:2},color:"success",value:l,onChange:e=>a(e.target.value)}),(0,s.jsx)(u.Z,{variant:"outlined",color:"success",endIcon:(0,s.jsx)(T.Z,{icon:"tabler:square-rounded-plus-filled"}),onClick:m,children:"Th\xeam"})]}),"youtube"==d&&p?(0,s.jsx)(c.Z,{sx:{marginY:3},children:(0,s.jsx)(nc,{videoId:p})}):null,"audio"==d&&p?(0,s.jsx)(c.Z,{sx:{marginY:3},children:(0,s.jsx)("audio",{controls:!0,controlsList:"nodownload",preload:"metadata",src:p,style:{width:"100%"}})}):null,p?(0,s.jsxs)(e6.Z,{subheader:(0,s.jsx)(no.Z,{children:"C\xe0i đặt Tệp đ\xednh k\xe8m"}),children:[(0,s.jsxs)(tS.Z,{divider:!0,onClick:()=>v({download:!t.download}),children:[(0,s.jsx)(tP.Z,{children:(0,s.jsx)(T.Z,{icon:"tabler:download",fontSize:20})}),(0,s.jsxs)(ei.Z,{children:["Cho ph\xe9p tải file xuống",(0,s.jsx)(h.Z,{title:"Người nghe c\xf3 thể tải tập tin n\xe0y xuống m\xe1y t\xednh, điện thoại",children:(0,s.jsx)(x.Z,{size:"small",children:(0,s.jsx)(T.Z,{icon:"tabler:info-square-rounded",fontSize:20})})})]}),(0,s.jsx)(tr.Z,{children:(0,s.jsx)(na.Z,{edge:"end",checked:t.download||!1})})]}),(0,s.jsxs)(tS.Z,{divider:!0,onClick:()=>v({next:!t.next}),children:[(0,s.jsx)(tP.Z,{children:(0,s.jsx)(T.Z,{icon:"tabler:player-track-next",fontSize:20})}),(0,s.jsxs)(ei.Z,{children:["Cho ph\xe9p tua file nghe, video",(0,s.jsx)(h.Z,{title:"Người nghe c\xf3 thể tua để nghe trước tập tin \xe2m thanh hoặc video",children:(0,s.jsx)(x.Z,{size:"small",children:(0,s.jsx)(T.Z,{icon:"tabler:info-square-rounded",fontSize:20})})})]}),(0,s.jsx)(tr.Z,{children:(0,s.jsx)(na.Z,{edge:"end",checked:t.next||!1})})]}),(0,s.jsxs)(tS.Z,{divider:!0,onClick:()=>v({speed:!t.speed}),children:[(0,s.jsx)(tP.Z,{children:(0,s.jsx)(T.Z,{icon:"tabler:brand-speedtest",fontSize:20})}),(0,s.jsxs)(ei.Z,{children:["Cho ph\xe9p tăng, giảm tốc độ nghe",(0,s.jsx)(h.Z,{title:"Người nghe c\xf3 thể tăng tốc độ l\xean 2x hoặc x\xf3a 0.5x khi nghhe",children:(0,s.jsx)(x.Z,{size:"small",children:(0,s.jsx)(T.Z,{icon:"tabler:info-square-rounded",fontSize:20})})})]}),(0,s.jsx)(tr.Z,{children:(0,s.jsx)(na.Z,{edge:"end",checked:t.speed||!1})})]})]}):null]})});let nh=e=>{let{options:t=[],label:n="",questionId:l,onChange:a,value:c="",type:d="level"}=e,[u,x]=(0,o.useState)(!1),f=(0,p.I0)(),m=e=>()=>{f((0,g.Zw)({questionId:l,type:d,value:c,list:e})),x(!1)};return(0,s.jsx)(h.Z,{open:u,title:(0,s.jsxs)(e6.Z,{component:"div",children:[(0,s.jsx)(e8.ZP,{disablePadding:!0,children:(0,s.jsx)(tS.Z,{sx:{paddingX:1},onClick:m("group"),children:(0,s.jsx)(ei.Z,{disableTypography:!0,sx:{fontSize:".75rem"},children:"\xc1p dụng cho c\xe2u c\xf2n lại trong nh\xf3m"})})}),(0,s.jsx)(e8.ZP,{disablePadding:!0,children:(0,s.jsx)(tS.Z,{sx:{paddingX:1},onClick:m("exam"),children:(0,s.jsx)(ei.Z,{disableTypography:!0,sx:{fontSize:".75rem"},children:"\xc1p dụng cho c\xe2u c\xf2n lại trong đề thi"})})})]}),placement:"top",arrow:!0,onOpen:()=>x(!0),onClose:()=>x(!1),children:(0,s.jsx)(R.Z,{select:!0,label:n,size:"small",sx:{mr:1},value:c||"",onChange:e=>a(e.target.value),children:t.map(e=>(0,s.jsx)(el.Z,{value:e.key,children:e.title},e.key))})})};var nu=o.memo(nh);let nx=[{key:"TN",title:"Trắc nghiệm"},{key:"TF",title:"Trắc nghiệm đ\xfang sai"},{key:"HK",title:"Nhiều lựa chọn"},{key:"DT",title:"Điền từ"},{key:"TL",title:"Tự luận"}],np=[{key:"NB",title:"Nhận biết"},{key:"TH",title:"Th\xf4ng hiểu"},{key:"VD",title:"Vận dụng"},{key:"VDC",title:"Vận dụng cao"}],nf=e=>{let{questionId:t}=e,n=(0,p.v9)(e=>e.quiz.questions.find(e=>e.id==t)),[l,a]=(0,o.useState)(n),[f,m]=(0,o.useState)(!1),v=(0,p.I0)(),b=e=>{a(t=>({...t,...e}))},C=()=>{v((0,g.cN)({questionId:t}))},I=()=>{P().fire({title:"X\xf3a ".concat(l.label," ").concat(l.number),text:"Bạn đang thực hiện lệnh x\xf3a c\xe2u hỏi. Bạn c\xf3 muốn tiếp tục kh\xf4ng?",icon:"warning",showCancelButton:!0,confirmButtonText:"Đ\xfang. X\xf3a đi.",cancelButtonText:"Hủy"}).then(e=>{e.isConfirmed&&(v((0,g.dA)(t)),P().fire({position:"top-end",icon:"success",title:"Đ\xe3 x\xf3a c\xe2u hỏi",showConfirmButton:!1,timer:1500}))})},y=e=>t=>{let n=!l.audios&&Array.isArray(l.audios)?[...l.audios]:[{}];n[e]=t,b({audios:n})};(0,o.useEffect)(()=>{JSON.stringify(l)!==JSON.stringify(n)&&a(n)},[n]);let w=[{icon:(0,s.jsx)(T.Z,{icon:"tabler:circle-x"}),text:"X\xf3a c\xe2u hỏi n\xe0y",menuItemProps:{sx:{"& svg":{mr:2},color:"error.main"},onClick:I}}],E=(0,o.useCallback)(()=>{m(!0)},[]),j=(0,o.useCallback)(()=>{m(!1)},[]);return((0,o.useEffect)(()=>{JSON.stringify(l)!==JSON.stringify(n)&&v((0,g.Ds)(l))},[l]),l)?(0,s.jsxs)("div",{onMouseEnter:E,onMouseLeave:j,id:t,children:[(0,s.jsxs)(e_.Z,{sx:{mb:2},children:[(0,s.jsx)(K.Z,{title:(0,s.jsx)(t7,{questionId:t}),sx:{paddingY:2,overflowX:"auto",px:{xs:2,md:4}},action:(0,s.jsxs)(c.Z,{sx:{display:"flex",alignItems:"center"},children:[(0,s.jsx)(t6,{questionId:t}),(0,s.jsx)(h.Z,{title:"Th\xeam file nghe",children:(0,s.jsx)(x.Z,{size:"small",sx:{mr:1,ml:1,background:(l.audios||"").length?"#7367f0":"",color:(l.audios||"").length?"#fff":""},onClick:()=>{(l.audios||"").length?b({audios:[]}):b({audios:[{}]})},children:(0,s.jsx)(T.Z,{icon:(l.audios||"").length?"tabler:headphones-filled":"tabler:headphones-off",fontSize:20})})}),(0,s.jsx)(h.Z,{title:"Cố định đ\xe1p \xe1n",children:(0,s.jsx)(x.Z,{size:"small",sx:{mr:1,background:l.shuffle?"#7367f0":"",color:l.shuffle?"#fff":""},onClick:()=>b({shuffle:!l.shuffle}),children:(0,s.jsx)(T.Z,{icon:l.shuffle?"tabler:pin-filled":"tabler:pinned-off",fontSize:20})})}),(0,s.jsx)(nu,{label:"Loại c\xe2u hỏi",type:"type",questionId:t,value:l.type||"TN",options:nx,onChange:e=>b({type:e})}),(0,s.jsx)(nu,{label:"Mức độ",type:"level",questionId:t,value:l.level||"",options:np,onChange:e=>b({level:e})}),(0,s.jsx)(t3,{options:w,iconButtonProps:{size:"small",sx:{color:"text.disabled"}}})]})}),(0,s.jsx)(e9.Z,{}),(0,s.jsxs)(Q.Z,{sx:{px:{xs:2,md:4}},children:[l.audios&&l.audios.length?(0,s.jsx)(eA.Z,{severity:"warning",icon:!1,sx:{".MuiAlert-message":{width:"100%",overflow:"unset"},mt:3,".MuiListSubheader-root":{backgroundColor:"inherit"}},children:Array.isArray(l.audios)?l.audios.map((e,t)=>(0,s.jsx)(nd,{audio:e,onChange:y(t)},t)):null}):null,(0,s.jsx)(c.Z,{sx:{paddingY:3},children:(0,s.jsx)(nn,{content:l.content,onChange:e=>b({content:e})})}),(0,s.jsx)(nl,{question:l,onChange:b}),(0,s.jsxs)(eA.Z,{severity:"info",icon:!1,sx:{".MuiAlert-message":{width:"100%",overflow:"unset"}},children:[(0,s.jsx)(e9.Z,{children:"HƯỚNG DẪN GIẢI"}),(0,s.jsx)(c.Z,{children:(0,s.jsx)(nn,{content:l.explain||"",onChange:e=>b({explain:e})})})]})]})]}),(0,s.jsx)(c.Z,{sx:{mb:3,textAlign:"-webkit-center",height:"1.5rem"},children:f?(0,s.jsx)(e9.Z,{sx:{width:"75%"},children:(0,s.jsx)(u.Z,{variant:"tonal",size:"small",startIcon:(0,s.jsx)(T.Z,{icon:"tabler:plus"}),onClick:C,children:"Th\xeam c\xe2u hỏi"})}):null})]}):(0,s.jsx)(e_.Z,{sx:{mb:2,background:"#e91e1ec9"},children:(0,s.jsx)(K.Z,{title:(0,s.jsx)(d.Z,{sx:{textAlign:"center",color:"#fff"},variant:"h5",children:"C\xe2u hỏi kh\xf4ng tồn tại"})})})};var ng=o.memo(nf);let nm=e=>e.reduce((e,t)=>{let n=parseFloat(t.point);return isNaN(n)?e:e+n},0);var nv=e=>{let{groupId:t}=e,n=(0,p.v9)(e=>e.quiz.questions.filter(e=>e.groupId==t));return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(te.Z,{rounded:!0,label:"".concat(n.length," c\xe2u"),skin:"light",color:"primary",size:"small",sx:{mr:1,width:"100%"}}),(0,s.jsx)(te.Z,{rounded:!0,label:"".concat(nm(n).toFixed(2)," điểm"),skin:"light",color:"error",size:"small",sx:{width:"100%"}})]})};let nb=e=>{var t,n;let{groupId:l,isOne:a}=e,{questions:d,random:m,content:v,...b}=(0,p.v9)(e=>e.quiz.groups.find(e=>e.id==l)),C=(0,p.I0)(),[I,y]=(0,o.useState)(!0),w=(0,o.useMemo)(()=>d.map(e=>(0,s.jsx)(ng,{questionId:e},e)),[d]),E=()=>{C((0,g.xL)({groupId:l}))},j=()=>{C((0,g.mD)({id:l,random:!m}))},A=()=>{C((0,f.z)({status:"group",data:{...b,random:m,title:"CẤU H\xccNH NH\xd3M C\xc2U HỎI"}}))},S=e=>{C((0,g.mD)({id:l,content:e}))},N=()=>{P().fire({title:"X\xf3a nh\xf3m c\xe2u hỏi?",text:"Bạn đang thực hiện lệnh x\xf3a nh\xf3m c\xe2u hỏi n\xe0y. Bạn c\xf3 muốn tiếp tục kh\xf4ng?",icon:"warning",showCancelButton:!0,confirmButtonText:"Đ\xfang. X\xf3a đi.",cancelButtonText:"Hủy"}).then(e=>{e.isConfirmed&&(C((0,g.BN)({groupId:l})),P().fire({position:"top-end",icon:"success",title:"Đ\xe3 x\xf3a th\xe0nh c\xf4ng",showConfirmButton:!1,timer:1500}))})},Z=[{icon:(0,s.jsx)(T.Z,{icon:"tabler:circle-x"}),text:"X\xf3a nh\xf3m c\xe2u hỏi n\xe0y",menuItemProps:{sx:{"& svg":{mr:2},color:"error.main"},onClick:N}}];return a?(0,s.jsxs)(Q.Z,{sx:{paddingX:0,mt:3},id:l,children:[w,(null==w?void 0:w.length)?null:(0,s.jsx)(u.Z,{variant:"outlined",endIcon:(0,s.jsx)(T.Z,{icon:"tabler:help-octagon"}),fullWidth:!0,sx:{mb:2},onClick:E,children:"TH\xcaM C\xc2U HỎI"})]}):(0,s.jsxs)(c.Z,{children:[(0,s.jsxs)(e_.Z,{className:"header-group",sx:{border:0,boxShadow:0,mb:2.5},id:l,children:[(0,s.jsx)(K.Z,{sx:{paddingY:1,alignItems:"center"},avatar:(0,s.jsx)(T.Z,{icon:"tabler:clipboard-list"}),action:(0,s.jsxs)(c.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,s.jsx)(h.Z,{title:"Th\xeam file nghe cho nh\xf3m c\xe2u hỏi",children:(0,s.jsx)(x.Z,{size:"small",sx:{color:"text.secondary",background:(null==b?void 0:null===(t=b.audios)||void 0===t?void 0:t.length)?"#7367f0":"",color:(null==b?void 0:null===(n=b.audios)||void 0===n?void 0:n.length)?"#fff":""},onClick:A,children:(0,s.jsx)(T.Z,{icon:"tabler:headphones-filled",fontSize:20})})}),(0,s.jsx)(h.Z,{title:"Cố định c\xe2u hỏi trong nh\xf3m",children:(0,s.jsx)(x.Z,{size:"small",sx:{mx:1,background:m?"#7367f0":"",color:m?"#fff":""},onClick:j,children:(0,s.jsx)(T.Z,{icon:m?"tabler:pinned-filled":"tabler:pinned",fontSize:20})})}),(0,s.jsx)(nv,{groupId:l}),(0,s.jsx)(h.Z,{title:"Cấu h\xecnh nh\xf3m c\xe2u hỏi",children:(0,s.jsx)(x.Z,{size:"small",sx:{color:"text.secondary"},onClick:A,children:(0,s.jsx)(T.Z,{icon:"tabler:settings-share",fontSize:20})})}),(0,s.jsx)(t3,{options:Z,iconButtonProps:{size:"small",sx:{color:"text.disabled"}}}),(0,s.jsx)(h.Z,{title:"Ẩn/Hiện chi tiết",children:(0,s.jsx)(x.Z,{size:"small","aria-label":"collapse",sx:{mr:2,color:"text.secondary"},onClick:()=>y(!I),children:(0,s.jsx)(T.Z,{fontSize:20,icon:I?"tabler:chevron-up":"tabler:chevron-down"})})})]})}),(0,s.jsx)(Q.Z,{sx:{p:e=>"".concat(e.spacing(4,3,4)," !important")},children:(0,s.jsx)(nn,{content:v||"",sx:{marginY:5},onChange:S})})]}),(0,s.jsx)(t2.Z,{in:I,children:(0,s.jsxs)(Q.Z,{sx:{paddingX:0,mt:3},children:[w,(null==w?void 0:w.length)?null:(0,s.jsx)(u.Z,{variant:"outlined",endIcon:(0,s.jsx)(T.Z,{icon:"tabler:help-octagon"}),fullWidth:!0,sx:{mb:2},onClick:E,children:"TH\xcaM C\xc2U HỎI"})]})})]})},nC=e=>e.reduce((e,t)=>{let n=parseFloat(t.point);return isNaN(n)?e:e+n},0);var nT=e=>{let{quizId:t}=e,n=(0,p.v9)(e=>e.quiz.questions.filter(e=>e.quizId==t));return(0,s.jsxs)(c.Z,{sx:{display:"flex",alignItems:"center",flexFlow:"column",mr:1},children:[(0,s.jsx)(te.Z,{rounded:!0,label:"".concat(n.length," c\xe2u"),skin:"light",color:"primary",size:"small",sx:{mb:1,width:"100%"}}),(0,s.jsx)(te.Z,{rounded:!0,label:"".concat(nC(n).toFixed(2)," điểm"),skin:"light",color:"success",size:"small",sx:{width:"100%"}})]})},nI=n(6591);let ny=e=>{let{quizId:t}=e;return(0,s.jsx)(ej.ZP,{open:!!t,sx:{zIndex:1301},anchor:"right",children:"hihi"})},nw=e=>{let{quizId:t}=e,[n,l]=(0,o.useState)(!0),[a,d]=(0,o.useState)(!1),[f,v]=(0,o.useState)(""),b=(0,p.v9)(e=>e.quiz.quizs.find(e=>e.id==t)),C=(0,p.v9)(e=>e.quiz.questions.filter(e=>e.quizId==t)).length,I=(0,p.I0)(),y=()=>{I((0,g.Rp)({quizId:t}))},w=(0,o.useMemo)(()=>b.groups.map(e=>(0,s.jsx)(nb,{groupId:e,isOne:1==b.groups.length},e)),[b.groups]),E=()=>{(0,nI.ImportFile)(t,e=>{let{status:t,data:n,error:s}=e;if(s)return I((0,m.V)({status:""})),P().fire({icon:"error",title:"Oops...",text:s});switch(t){case"done":I((0,g.l$)(n)),I((0,m.V)({status:""}));break;case"loading":I((0,m.V)(n))}})},j=()=>{C?P().fire({title:"Thay đổi c\xe2u hỏi Đề số ".concat(b.number),html:"Khi bạn thay đổi dữ liệu c\xe2u hỏi của đề thi số ".concat(b.number,", nếu đ\xe3 c\xf3 học sinh l\xe0m b\xe0i th\xec dữ liệu b\xe0i l\xe0m của học sinh đ\xf3 sẽ kh\xf4ng được lưu v\xe0 t\xednh l\xe0 0 điểm. Để đảm bảo kh\xf4ng ảnh hưởng để kết quả của học sinh, chỉ chỉ c\xf3 thể chỉnh sửa ngay tại c\xe2u hỏi đ\xf3. Bạn c\xf3 muốn tiếp tục kh\xf4ng?"),icon:"warning",showCancelButton:!0,confirmButtonText:"Tiếp tục",cancelButtonText:"Hủy"}).then(e=>{e.isConfirmed&&E()}):E()},A=()=>{P().fire({title:"X\xf3a Đề số ".concat(b.number),text:"Bạn đang thực hiện lệnh x\xf3a đề thi. Bạn c\xf3 muốn tiếp tục kh\xf4ng?",icon:"warning",showCancelButton:!0,confirmButtonText:"Đ\xfang. X\xf3a đi.",cancelButtonText:"Hủy"}).then(e=>{e.isConfirmed&&(I((0,g.GE)({quizId:t})),P().fire({position:"top-end",icon:"success",title:"Đ\xe3 x\xf3a th\xe0nh c\xf4ng",showConfirmButton:!1,timer:1500}))})},S=()=>{I((0,g.QT)({quizId:t}))},N=[{icon:(0,s.jsx)(T.Z,{icon:"tabler:list-numbers"}),text:"Đ\xe1nh lại số thứ tự c\xe2u hỏi",menuItemProps:{sx:{"& svg":{mr:2}},onClick:S}},{icon:(0,s.jsx)(T.Z,{icon:"tabler:file-type-docx"}),text:"Nhập c\xe2u hỏi từ tập tin .pdf, .docx",menuItemProps:{sx:{"& svg":{mr:2}},onClick:j}},{icon:(0,s.jsx)(T.Z,{icon:"tabler:circle-x"}),text:"X\xf3a đề thi n\xe0y",menuItemProps:{sx:{"& svg":{mr:2},color:"error.main"},onClick:A}}];return(0,s.jsxs)("div",{style:{marginBottom:10},className:a?"card-fullscreen":"",id:b.id,children:[(0,s.jsx)(K.Z,{className:"header-exam",sx:{paddingY:3,borderRadius:"0.5rem","span, svg":{color:"#fff"}},title:"Đề số "+b.number,action:(0,s.jsxs)(c.Z,{sx:{display:"flex",alignItems:"center"},children:[(0,s.jsx)(h.Z,{title:"Nhập c\xe2u hỏi từ tập tin .pdf, .docx",children:(0,s.jsx)(x.Z,{size:"small",sx:{color:"text.secondary"},onClick:j,children:(0,s.jsx)(T.Z,{icon:"tabler:upload",fontSize:20})})}),(0,s.jsx)(nT,{quizId:t}),(0,s.jsx)(h.Z,{title:a?"Thu nhỏ m\xe0n h\xecnh đề thi số "+b.number:"Mở rộng m\xe0n h\xecnh đề thi số "+b.number,children:(0,s.jsx)(x.Z,{size:"small",sx:{color:"text.secondary"},onClick:()=>d(!a),children:(0,s.jsx)(T.Z,{icon:a?"tabler:arrows-minimize":"tabler:arrows-maximize",fontSize:20})})}),(0,s.jsx)(t3,{options:N,iconButtonProps:{size:"small",sx:{color:"text.disabled"}}}),(0,s.jsx)(h.Z,{title:n?"Ẩn chi tiết đề thi số "+b.number:"Hiển thị chi tiết đề thi số "+b.number,children:(0,s.jsx)(x.Z,{size:"small","aria-label":"collapse",sx:{mr:2,color:"text.secondary"},onClick:()=>l(!n),children:(0,s.jsx)(T.Z,{fontSize:20,icon:n?"tabler:chevron-up":"tabler:chevron-down"})})})]})}),(0,s.jsx)(t2.Z,{in:n,children:(0,s.jsxs)(Q.Z,{sx:{paddingX:0,mt:3},children:[w,(0,s.jsx)(u.Z,{variant:"tonal",endIcon:(0,s.jsx)(T.Z,{icon:"tabler:square-rounded-plus"}),fullWidth:!0,sx:{mb:2},color:"success",onClick:y,children:"TH\xcaM NH\xd3M C\xc2U HỎI"})]})}),(0,s.jsx)(ny,{quizId:f})]})},nE=()=>{let e=(0,p.v9)(e=>e.quiz.quizs),t=(0,p.I0)(),n=()=>{t((0,g.BT)())};return(0,s.jsxs)(s.Fragment,{children:[e.map(e=>(0,s.jsx)(nw,{quizId:e.id},e.id)),(0,s.jsx)(u.Z,{variant:"contained",endIcon:(0,s.jsx)(T.Z,{icon:"tabler:clipboard-plus"}),fullWidth:!0,sx:{mt:3},onClick:n,children:"TH\xcaM ĐỀ THI"})]})};var nj=n(4054),nA=n(3841),nP=n(7709);let nS=()=>{var e,t;let n=(0,p.v9)(e=>e.quiz.settings),[a,h]=(0,o.useState)(!1),u=(0,p.I0)(),m=(0,l.useRouter)(),v=q(),b=()=>{if(a)return;let e=document.createElement("input");e.setAttribute("type","file"),e.setAttribute("accept","image/*"),e.click(),e.onchange=async()=>{let[t]=e.files;if(t){h(!0);let e=n.cover||"https://i.imgur.com/dKZNJGk.png",s=URL.createObjectURL(t);C({cover:s});let{error:l,url:o}=await w(t);h(!1),l&&(C({cover:e}),P().fire({icon:"error",title:"C\xf3 lỗi khi thay đổi ảnh b\xeca"})),o&&C({cover:o})}}},C=e=>{u((0,g.kQ)(e))},I=e=>()=>{e&&m.push({pathname:e,query:m.query})},y=()=>{u((0,f.z)({status:"settings",data:{}}))},E=e=>{v.copy(e),S.ZP.success("Đ\xe3 sao ch\xe9p",{duration:2e3})};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e_.Z,{sx:{background:"#b1b1b11f",mb:3},children:(0,s.jsx)(Q.Z,{sx:{padding:".5rem!important"},children:(0,s.jsxs)(e6.Z,{component:"div",sx:{p:0},children:[(0,s.jsx)(e8.ZP,{disablePadding:!0,children:(0,s.jsxs)(tS.Z,{sx:{display:"flex",flexDirection:"column"},onClick:b,children:[a?(0,s.jsxs)(c.Z,{style:{position:"relative"},children:[(0,s.jsx)("img",{src:null!==(e=null==n?void 0:n.cover)&&void 0!==e?e:"https://i.imgur.com/dKZNJGk.png",style:{maxWidth:"100%",filter:"blur(5px)"}}),(0,s.jsx)(ef.Z,{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}})]}):(0,s.jsx)("img",{src:null!==(t=null==n?void 0:n.cover)&&void 0!==t?t:"https://i.imgur.com/dKZNJGk.png",style:{maxWidth:"100%"}}),(0,s.jsx)(ei.Z,{primary:"Click để thay đổi ảnh b\xeca"})]})}),(0,s.jsx)(e8.ZP,{disablePadding:!0,children:(0,s.jsx)(X.Z,{fullWidth:!0,label:"T\xean đề thi",value:n.title,onChange:e=>C({title:e})})}),(0,s.jsx)(e8.ZP,{disablePadding:!0,children:(0,s.jsxs)(c.Z,{sx:{width:"100%"},children:[(0,s.jsx)(d.Z,{variant:"h6",sx:{marginY:2},children:"Giới thiệu về đề thi"}),(0,s.jsx)(nn,{content:n.subtitle,sx:{minHeight:"5rem"},theme:"snow",inline:!0,onChange:e=>C({subtitle:e})})]})})]})})}),(null==n?void 0:n.url)?(0,s.jsx)(e_.Z,{sx:{mb:3},children:(0,s.jsx)(Q.Z,{sx:{p:"0.75rem!important"},children:(0,s.jsxs)(nj.Z,{fullWidth:!0,variant:"outlined",children:[(0,s.jsx)(nA.Z,{children:"Link đề thi"}),(0,s.jsx)(nP.Z,{value:(null==n?void 0:n.url)||"",disabled:!0,endAdornment:(0,s.jsx)(O.Z,{position:"end",children:(0,s.jsx)(x.Z,{edge:"end",onClick:()=>E(null==n?void 0:n.url),sx:{color:"success.main"},children:(0,s.jsx)(T.Z,{icon:"tabler:copy",fontSize:20})})}),label:"Link đề thi"})]})})}):null,(null==n?void 0:n.share)=="T"&&(null==n?void 0:n.id)?(0,s.jsx)(e_.Z,{sx:{mb:3},children:(0,s.jsx)(Q.Z,{sx:{p:"0.75rem!important"},children:(0,s.jsxs)(nj.Z,{fullWidth:!0,variant:"outlined",children:[(0,s.jsx)(nA.Z,{children:"M\xe3 chia sẻ"}),(0,s.jsx)(nP.Z,{value:j(null==n?void 0:n.id),disabled:!0,endAdornment:(0,s.jsx)(O.Z,{position:"end",children:(0,s.jsx)(x.Z,{edge:"end",onClick:()=>E(j(null==n?void 0:n.id)),sx:{color:"success.main"},children:(0,s.jsx)(T.Z,{icon:"tabler:copy",fontSize:20})})}),label:"M\xe3 chia sẻ"})]})})}):null,(0,s.jsx)(e_.Z,{className:"menu-settings",children:(0,s.jsx)(Q.Z,{sx:{padding:".5rem!important"},children:(0,s.jsxs)(e6.Z,{component:"div",sx:{p:0,color:"#fff"},children:[(0,s.jsx)(e8.ZP,{disablePadding:!0,onClick:y,children:(0,s.jsxs)(tS.Z,{children:[(0,s.jsx)(es.Z,{sx:{color:"#fff"},children:(0,s.jsx)(T.Z,{icon:"tabler:settings",fontSize:20})}),(0,s.jsx)(ei.Z,{primary:"C\xe0i đặt b\xe0i l\xe0m online",disableTypography:!0})]})}),(null==n?void 0:n.url)?(0,s.jsx)(e8.ZP,{disablePadding:!0,onClick:I("/p/leaderboard.html"),children:(0,s.jsxs)(tS.Z,{children:[(0,s.jsx)(es.Z,{sx:{color:"#fff"},children:(0,s.jsx)(T.Z,{icon:"tabler:checkup-list",fontSize:20})}),(0,s.jsx)(ei.Z,{primary:"Bảng điểm",disableTypography:!0})]})}):null,(null==n?void 0:n.url)?(0,s.jsx)(e8.ZP,{disablePadding:!0,onClick:I("/p/realtime.html"),children:(0,s.jsxs)(tS.Z,{children:[(0,s.jsx)(es.Z,{sx:{color:"#fff"},children:(0,s.jsx)(T.Z,{icon:"tabler:camera-bolt",fontSize:20})}),(0,s.jsx)(ei.Z,{primary:"Gi\xe1m s\xe1t thời gian thực",disableTypography:!0})]})}):null]})})})]})};var nN=function(e){let{videoId:t}=e;return(0,s.jsx)("div",{style:{position:"relative",paddingBottom:"56.25%",height:0,overflow:"hidden"},children:(0,s.jsx)("iframe",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%"},src:"https://www.youtube.com/embed/".concat((e=>{let t=e.match(/^(?:https?:\/\/)?(?:www\.)?youtu\.?be(?:\.com)?\/(?:watch\?v=|embed\/|v\/|youtu\.be\/|youtube\.com\/(?:c\/|v\/|u\/\w+\/|embed\/|watch\?v=|shorts\/))([\w-]{11})(?:[?&].*|$)/);return t?t[1]:null})(t)),title:"YouTube video player",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",frameBorder:"0",allowFullScreen:!0})})},nZ=e=>{let{audio:t,onChange:n}=e,[l,a]=(0,o.useState)(""),{type:d,src:p}=t||{},f=e=>{let s=e.target.files[0];if(s){if("audio/mp3"===s.type||"audio/wav"===s.type||"audio/mpeg"===s.type||"audio/ogg"===s.type){let e=URL.createObjectURL(s);n({...t,src:e,type:"audio"})}else P().fire({icon:"error",title:"Oops...",text:"Chọn một file \xe2m thanh MP3 hoặc WAV."})}},g=e=>{let t=e.match(/^(?:https?:\/\/)?(?:www\.)?youtu\.?be(?:\.com)?\/(?:watch\?v=|embed\/|v\/|youtu\.be\/|youtube\.com\/(?:c\/|v\/|u\/\w+\/|embed\/|watch\?v=|shorts\/))([\w-]{11})(?:[?&].*|$)/);return t?t[1]:null},m=()=>{let e=g(l);e?(v({...t,src:l,type:"youtube"}),a("")):console.log("URL kh\xf4ng hợp lệ hoặc kh\xf4ng phải l\xe0 URL của video YouTube.")},v=e=>{n({...t,...e})};return(0,s.jsxs)(c.Z,{sx:{mb:2},children:[(0,s.jsxs)(c.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,s.jsxs)(u.Z,{variant:"tonal",fullWidth:!0,component:"label",sx:{mr:2},endIcon:(0,s.jsx)(T.Z,{icon:"tabler:headphones-filled"}),children:["Đ\xednh k\xe8m file \xe2m thanh",(0,s.jsx)("input",{type:"file",accept:".mp3, .wav,.mpeg, .ogg",hidden:!0,onChange:f})]}),(0,s.jsx)(u.Z,{variant:"tonal",fullWidth:!0,color:"success",endIcon:(0,s.jsx)(T.Z,{icon:"tabler:brand-youtube-filled"}),onClick:()=>{n({...t,type:"youtube",src:""})},children:"Đ\xednh k\xe8m video youtube"})]}),"youtube"!=d||p?null:(0,s.jsxs)(c.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",marginY:3},children:[(0,s.jsx)(R.Z,{size:"small",fullWidth:!0,variant:"outlined",label:"Link youtube",placeholder:"https://www.youtube.com/watch?v=TAODETHI",sx:{mr:2},color:"success",value:l,onChange:e=>a(e.target.value)}),(0,s.jsx)(u.Z,{variant:"outlined",color:"success",endIcon:(0,s.jsx)(T.Z,{icon:"tabler:square-rounded-plus-filled"}),onClick:m,children:"Th\xeam"})]}),"youtube"==d&&p?(0,s.jsx)(c.Z,{sx:{marginY:3},children:(0,s.jsx)(nN,{videoId:p})}):null,"audio"==d&&p?(0,s.jsx)(c.Z,{sx:{marginY:3},children:(0,s.jsx)("audio",{controls:!0,controlsList:"nodownload",preload:"metadata",src:p,style:{width:"100%"}})}):null,p?(0,s.jsxs)(e6.Z,{subheader:(0,s.jsx)(no.Z,{children:"C\xe0i đặt Tệp đ\xednh k\xe8m"}),children:[(0,s.jsxs)(tS.Z,{divider:!0,onClick:()=>v({download:!t.download}),children:[(0,s.jsx)(tP.Z,{children:(0,s.jsx)(T.Z,{icon:"tabler:download",fontSize:20})}),(0,s.jsxs)(ei.Z,{children:["Cho ph\xe9p tải file xuống",(0,s.jsx)(h.Z,{title:"Người nghe c\xf3 thể tải tập tin n\xe0y xuống m\xe1y t\xednh, điện thoại",children:(0,s.jsx)(x.Z,{size:"small",children:(0,s.jsx)(T.Z,{icon:"tabler:info-square-rounded",fontSize:20})})})]}),(0,s.jsx)(tr.Z,{children:(0,s.jsx)(na.Z,{edge:"end",checked:t.download||!1})})]}),(0,s.jsxs)(tS.Z,{divider:!0,onClick:()=>v({next:!t.next}),children:[(0,s.jsx)(tP.Z,{children:(0,s.jsx)(T.Z,{icon:"tabler:player-track-next",fontSize:20})}),(0,s.jsxs)(ei.Z,{children:["Cho ph\xe9p tua file nghe, video",(0,s.jsx)(h.Z,{title:"Người nghe c\xf3 thể tua để nghe trước tập tin \xe2m thanh hoặc video",children:(0,s.jsx)(x.Z,{size:"small",children:(0,s.jsx)(T.Z,{icon:"tabler:info-square-rounded",fontSize:20})})})]}),(0,s.jsx)(tr.Z,{children:(0,s.jsx)(na.Z,{edge:"end",checked:t.next||!1})})]}),(0,s.jsxs)(tS.Z,{divider:!0,onClick:()=>v({speed:!t.speed}),children:[(0,s.jsx)(tP.Z,{children:(0,s.jsx)(T.Z,{icon:"tabler:brand-speedtest",fontSize:20})}),(0,s.jsxs)(ei.Z,{children:["Cho ph\xe9p tăng, giảm tốc độ nghe",(0,s.jsx)(h.Z,{title:"Người nghe c\xf3 thể tăng tốc độ l\xean 2x hoặc x\xf3a 0.5x khi nghhe",children:(0,s.jsx)(x.Z,{size:"small",children:(0,s.jsx)(T.Z,{icon:"tabler:info-square-rounded",fontSize:20})})})]}),(0,s.jsx)(tr.Z,{children:(0,s.jsx)(na.Z,{edge:"end",checked:t.speed||!1})})]})]}):null]})};let nL=(0,L.ZP)(x.Z)(e=>{let{theme:t}=e;return{top:0,right:0,color:"grey.500",position:"absolute",boxShadow:t.shadows[2],transform:"translate(10px, -10px)",borderRadius:t.shape.borderRadius,backgroundColor:"".concat(t.palette.background.paper," !important"),transition:"transform 0.25s ease-in-out, box-shadow 0.25s ease-in-out","&:hover":{transform:"translate(7px, -5px)"}}}),n_=[{key:"random",title:"Cố định c\xe2u hỏi trong nh\xf3m",icon:"tabler:arrows-shuffle",subtitle:"Thứ tự c\xe2u hỏi trong nh\xf3m sẽ được cố định. Kh\xf4ng thay đổi d\xf9 c\xf3 bật chế độ trộn c\xe2u hỏi."},{key:"order",title:"Đ\xe1nh lại thứ tự c\xe2u",icon:"tabler:list-numbers",subtitle:"Thứ tự c\xe2u hỏi sẽ đ\xe1nh lại từ c\xe2u 1"}];var nk=()=>{let e=(0,p.v9)(e=>e.popup.data),t=(0,p.I0)(),[n,l]=(0,o.useState)(e),a=()=>{t((0,f.z)({status:""}))},m=e=>()=>{l({...n,...e})},v=()=>{let{title:e,...s}=n;t((0,g.mD)(s)),a()},b=e=>t=>{let s=!n.audios&&Array.isArray(n.audios)?[...n.audios]:[{}];s[e]=t,m({audios:s})()};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(k.Z,{sx:{pb:e=>"".concat(e.spacing(8)," !important"),px:e=>["".concat(e.spacing(5)," !important"),"".concat(e.spacing(15)," !important")],pt:e=>["".concat(e.spacing(8)," !important"),"".concat(e.spacing(12.5)," !important")]},children:[(0,s.jsx)(nL,{onClick:a,children:(0,s.jsx)(T.Z,{icon:"tabler:x",fontSize:"1.25rem"})}),(0,s.jsx)(c.Z,{sx:{mb:5,textAlign:"center"},children:(0,s.jsx)(d.Z,{variant:"h5",sx:{mb:3},children:n.title})}),n.audios&&0!=n.audios.length?null:(0,s.jsx)(nZ,{audio:{},onChange:b(0)}),Array.isArray(n.audios)?n.audios.map((e,t)=>(0,s.jsx)(nZ,{audio:e,onChange:b(t)},t)):null,(0,s.jsx)(e6.Z,{subheader:(0,s.jsx)(no.Z,{children:"C\xe0i đặt kh\xe1c"}),children:n_.map(e=>(0,s.jsxs)(tS.Z,{onClick:m({[e.key]:!n[e.key]}),divider:!0,children:[(0,s.jsx)(tP.Z,{children:(0,s.jsx)(T.Z,{icon:e.icon,fontSize:20})}),(0,s.jsxs)(ei.Z,{children:[e.title,(0,s.jsx)(h.Z,{title:e.subtitle,children:(0,s.jsx)(x.Z,{size:"small",children:(0,s.jsx)(T.Z,{icon:"tabler:info-square-rounded",fontSize:20})})})]}),(0,s.jsx)(tr.Z,{children:(0,s.jsx)(na.Z,{edge:"end",checked:n[e.key]||!1})})]},e.key))})]}),(0,s.jsxs)(M.Z,{sx:{justifyContent:"center",px:e=>["".concat(e.spacing(5)," !important"),"".concat(e.spacing(15)," !important")],pb:e=>["".concat(e.spacing(8)," !important"),"".concat(e.spacing(12.5)," !important")]},children:[(0,s.jsx)(u.Z,{variant:"tonal",color:"secondary",onClick:a,children:"Hủy"}),(0,s.jsx)(u.Z,{variant:"contained",sx:{mr:1},onClick:v,children:"Lưu"})]})]})},nM=n(3401),nR=()=>"hi",nO=n(9033);let nH=e=>{let{data:t,icon:n,name:l,selected:o,gridProps:a,iconProps:h,handleChange:u,color:x="primary"}=e,{title:p,value:f,content:g}=t;return t?(0,s.jsx)(N.ZP,{item:!0,...a,children:(0,s.jsxs)(c.Z,{onClick:()=>u(f),sx:{p:4,height:"100%",display:"flex",borderRadius:1,cursor:"pointer",position:"relative",alignItems:"center",flexDirection:"column",border:e=>"1px solid ".concat(e.palette.divider),...o===f?{borderColor:"".concat(x,".main"),"& svg":{color:e=>"".concat(e.palette.primary.main," !important")}}:{"&:hover":{borderColor:e=>"rgba(".concat(e.palette.customColors.main,", 0.25)")}}},children:[n?(0,s.jsx)(T.Z,{icon:n,...h}):null,p?"string"==typeof p?(0,s.jsx)(d.Z,{variant:"h6",sx:{...g?{mb:2}:{my:"auto"}},children:p}):p:null,g?"string"==typeof g?(0,s.jsx)(d.Z,{variant:"body2",sx:{my:"auto",textAlign:"center"},children:g}):g:null,(0,s.jsx)(nO.Z,{name:l,size:"small",color:x,value:f,onChange:u,checked:o===f,sx:{mb:-2,...!n&&!p&&!g&&{mt:-2}}})]})}):null};var nB=n(3416);let nD=(0,nB.kP)("ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz-",8),nF={fullname:"",classes:"",school:"",username:"",password:""},nq=e=>{let{students:t=[],onChange:n}=e,[l,a]=(0,o.useState)(!1),[h,p]=(0,o.useState)(nF),[f,g]=(0,o.useState)(t),m=(0,o.useRef)(),v=()=>{let{fullname:e,username:t,password:n,id:s}=h;if(!e.trim())return P().fire({icon:"error",title:"Oops...",text:"Vui l\xf2ng nhập th\xf4ng tin Họ v\xe0 t\xean"});if(!t.trim())return P().fire({icon:"error",title:"Oops...",text:"Vui l\xf2ng nhập th\xf4ng tin T\xean đăng nhập"});if(!n.trim())return P().fire({icon:"error",title:"Oops...",text:"Vui l\xf2ng nhập th\xf4ng tin Mật khẩu"});if(f.find(e=>e.id!==s&&e.username.trim()===t.trim()&&e.password.trim()===n.trim()))return P().fire({icon:"error",title:"Oops...",text:"Th\xf4ng tin đăng nhập đ\xe3 tồn tại. Vui l\xf2ng kiểm tra lại!"});if(s){if(0===f.length)return;g(e=>e.map(e=>e.id===s?{...e,...h}:e))}else g(e=>[{...h,id:nD()},...e]);a(!1)},b=e=>()=>{0!==f.length&&g(t=>{let n=t.findIndex(t=>t.id===e.id);return[...f.slice(0,n),...f.slice(n+1)]})},I=()=>{let e=document.createElement("input");e.setAttribute("type","file"),e.setAttribute("accept",".xlsx"),e.click(),e.onchange=async()=>{var t;let[n]=e.files;if(n&&(null==n?void 0:null===(t=n.name)||void 0===t?void 0:t.endsWith(".xlsx"))){let e=new FileReader;e.onload=function(e){let t=e.target.result;m.current?m.current.postMessage({action:"students",payload:t}):P().fire({icon:"error",title:"Xảy ra lỗi",text:"Li\xean hệ quản trị vi\xean để được hỗ trợ."})},e.readAsBinaryString(n)}else P().fire({icon:"error",title:"Xảy ra lỗi",text:"Định dạng chưa được hỗ trợ. Vui l\xf2ng tải l\xean file .xlsx theo mẫu."})}},y=[{field:"num",headerName:"STT",maxWidth:50},{field:"fullname",headerName:"Họ v\xe0 t\xean",flex:.8,minWidth:200},{field:"classes",headerName:"Lớp",minWidth:80},{field:"school",headerName:"Trường",minWidth:130},{field:"username",headerName:"T\xean đăng nhập",minWidth:150},{field:"password",headerName:"Mật khẩu",minWidth:120},{field:"id",headerName:"H\xe0nh động",renderCell:e=>(0,s.jsxs)("div",{children:[(0,s.jsx)(x.Z,{size:"small",onClick:()=>{a(!0),p(e.row)},children:(0,s.jsx)(T.Z,{icon:"tabler:pencil-minus"})}),(0,s.jsx)(x.Z,{size:"small",color:"error",onClick:b(e.row),children:(0,s.jsx)(T.Z,{icon:"tabler:trash"})})]})}],w=()=>{if(m.current){let e=f.length?f:[{fullname:"Nguyễn Văn An",classes:"12A1",school:"Trường THPT Lương Thế Vinh",username:"annv",password:"luongthevinh"}];m.current.postMessage({action:"excel",payload:{results:e.map(e=>{let t={};return y.forEach(n=>{var s,l,o,a;["id","num"].includes(null==n?void 0:null===(s=n.field)||void 0===s?void 0:s.toLocaleLowerCase())||(t[null===(l=null==n?void 0:null===(o=n.headerName)||void 0===o?void 0:o.trim())||void 0===l?void 0:l.toLocaleUpperCase()]=null===(a=e[null==n?void 0:n.field])||void 0===a?void 0:a.trim())}),t})}})}else P().fire({icon:"error",title:"Xảy ra lỗi",text:"Li\xean hệ quản trị vi\xean để được hỗ trợ."})};return(0,o.useEffect)(()=>{n&&n(f)},[f]),(0,o.useEffect)(()=>{m.current&&m.current.terminate();let e=e=>{let t=e=>{g(e.map((e,t)=>({...e,num:t+1,id:nD()}))),P().fire({title:"Th\xe0nh c\xf4ng!",text:"Đ\xe3 th\xeam ".concat(e.length," học sinh!"),icon:"success",timer:3e3,showConfirmButton:!1})};f.length?P().fire({title:"Ch\xfa \xfd",html:'Bạn muốn bổ sung th\xeam <b style="color:green">'.concat(e.length,"</b> học sinh v\xe0o hay muốn thay thế to\xe0n bộ học sinh đ\xe3 c\xf3?"),icon:"warning",confirmButtonText:"Bổ sung",showDenyButton:!0,denyButtonText:"Thay thế"}).then(n=>{if(n.isConfirmed){let n=e.filter(e=>!f.find(t=>t.username==e.username));n.length!==e.length?P().fire({title:"Ch\xfa \xfd",html:"Ph\xe1t hiện ".concat(e.length-n.length," học sinh tr\xf9ng th\xf4ng tin đăng nhập. Bạn c\xf3 muốn tiếp tục kh\xf4ng?"),icon:"warning",confirmButtonText:"Bổ sung",showDenyButton:!0,denyButtonText:"Thay thế"}).then(e=>{e.isConfirmed&&t([...f,...n])}):t([...f,...e])}n.isDenied&&t(e)}):t(e)};return fetch("".concat(C.default.assetPrefix,"/scripts/worker.export.").concat(C.default.version,".js")).then(e=>e.blob()).then(t=>{m.current=new Worker(URL.createObjectURL(t)),m.current.onmessage=async t=>{let{action:n="",payload:s=null}=t.data;switch(n){case"students":let{results:l,status:o}=s;(null==o?void 0:o.empty)||(null==o?void 0:o.double)?P().fire({title:"Ch\xfa \xfd",html:'<div>Hệ thống ph\xe1t hiện c\xf3 <b style="color:red">'.concat(null==o?void 0:o.empty,'</b> dữ liệu bị trống v\xe0 <b style="color:red">').concat(null==o?void 0:o.double,"</b> dữ liệu tr\xf9ng t\xean đăng nhập. Bạn c\xf3 muốn tiếp tục cập nhật danh s\xe1ch kh\xf4ng?</div>"),icon:"warning",showCancelButton:!0,cancelButtonText:"Hủy",confirmButtonText:"Tiếp tục"}).then(t=>{t.isConfirmed&&e(l)}):e(l);break;case"excel":let a=new Blob([s],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),c=window.URL.createObjectURL(a),d=document.createElement("a");d.href=c,d.download="[Mẫu] Nhập danh s\xe1ch học sinh.xlsx",document.body.appendChild(d),d.click(),window.URL.revokeObjectURL(c)}}}),()=>{m.current&&m.current.terminate()}},[f]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(eA.Z,{severity:"info",color:"info",sx:{mt:3},icon:!1,children:"Gi\xe1o vi\xean sẽ tạo t\xean đăng nhập v\xe0 mật khẩu để học sinh điền th\xf4ng tin v\xe0o mới l\xe0m b\xe0i thi. Học sinh kh\xf4ng cần phải c\xf3 t\xe0i khoản tr\xean hệ thống."}),(0,s.jsxs)(c.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",my:3},children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(u.Z,{variant:"contained",sx:{mr:1,".MuiButton-startIcon":{mx:0},px:{xs:1,sm:4}},startIcon:(0,s.jsx)(T.Z,{icon:"tabler:cloud-upload"}),color:"success",onClick:I,children:(0,s.jsx)(d.Z,{variant:"body",sx:{display:{xs:"none",sm:"inline"},ml:2},children:"Nhập từ Excel"})}),(0,s.jsx)(u.Z,{variant:"tonal",sx:{".MuiButton-startIcon":{mx:0},px:{xs:1,sm:4}},startIcon:(0,s.jsx)(T.Z,{icon:"tabler:cloud-download"}),color:"success",onClick:w,children:(0,s.jsx)(d.Z,{variant:"body",sx:{display:{xs:"none",sm:"inline"},ml:2},children:"Tải file mẫu"})})]}),(0,s.jsx)(u.Z,{variant:"contained",startIcon:(0,s.jsx)(T.Z,{icon:"tabler:plus"}),onClick:()=>{a(!0),p(nF)},children:"Th\xeam học sinh"})]}),(0,s.jsx)(et._,{rows:f.map((e,t)=>({...e,num:t+1})),columns:y,autoHeight:!0,initialState:{pagination:{paginationModel:{pageSize:5}}},pageSizeOptions:[5,10,30,50]}),(0,s.jsx)(ej.ZP,{open:l,sx:{zIndex:1301},anchor:"right",children:(0,s.jsxs)(c.Z,{sx:{p:2,minWidth:350},children:[(0,s.jsx)(eA.Z,{severity:"success",children:"Th\xf4ng tin học sinh"}),(0,s.jsx)(X.Z,{fullWidth:!0,sx:{mt:3},label:"Họ v\xe0 t\xean",helperText:"Th\xf4ng tin bắt buộc",required:!0,value:h.fullname||"",onChange:e=>p({...h,fullname:e.trim()})}),(0,s.jsx)(X.Z,{fullWidth:!0,sx:{mt:3},label:"Lớp",value:h.classes||"",onChange:e=>p({...h,classes:e.trim()})}),(0,s.jsx)(X.Z,{fullWidth:!0,sx:{mt:3},label:"Trường",value:h.school||"",onChange:e=>p({...h,school:e.trim()})}),(0,s.jsx)(X.Z,{fullWidth:!0,sx:{mt:3},label:"T\xean đăng nhập",helperText:"Th\xf4ng tin bắt buộc",required:!0,value:h.username||"",onChange:e=>p({...h,username:e.trim()})}),(0,s.jsx)(X.Z,{fullWidth:!0,sx:{mt:3},label:"Mật khẩu",helperText:"Th\xf4ng tin bắt buộc",required:!0,value:h.password||"",onChange:e=>p({...h,password:e.trim()})}),(0,s.jsxs)(c.Z,{sx:{mt:3,textAlign:"center"},children:[(0,s.jsx)(u.Z,{sx:{mr:2},variant:"tonal",color:"error",onClick:()=>a(!1),children:"Hủy"}),(0,s.jsx)(u.Z,{variant:"contained",onClick:v,children:"Lưu"})]})]})})]})},nz=()=>(0,s.jsx)(eA.Z,{sx:{mt:3},icon:!1,children:"Ai cũng c\xf3 thể xem v\xe0 l\xe0m đề thi n\xe0y. Phần thu thập th\xf4ng tin y\xeau cầu tối thiểu phải c\xf3 1 trường th\xf4ng tin."}),nG=async e=>{try{return(await y.default.get(e)).data}catch(e){throw e}},nY=e=>{let{students:t=[],onChange:n}=e,{data:l,error:a,isLoading:d}=(0,V.Z)("/classes/class",nG),[h,u]=(0,o.useState)(t);return((0,o.useEffect)(()=>{n&&n(h)},[h]),a)?(0,s.jsx)(eA.Z,{sx:{mt:3},severity:"error",icon:!1,children:a.response.data.error}):d?(0,s.jsx)(c.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"center",marginY:10},children:(0,s.jsx)(ef.Z,{})}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(eA.Z,{sx:{my:3},severity:"warning",icon:!1,children:"Chỉ những t\xe0i khoản của học sinh trong lớp học mới được quyền l\xe0m đề thi n\xe0y"}),(0,s.jsx)(et._,{rows:l.map((e,t)=>({...e,num:t+1})),columns:[{field:"num",headerName:"STT",maxWidth:80},{field:"title",headerName:"Lớp học",width:250},{field:"total",headerName:"Số học sinh",width:150}],autoHeight:!0,checkboxSelection:!0,initialState:{pagination:{paginationModel:{pageSize:10}}},pageSizeOptions:[10,30,50],onRowSelectionModelChange:e=>{u(e)},rowSelectionModel:h})]})};(0,nB.kP)("ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz-",8);let nW=e=>{let{students:t=[],onChange:n}=e,[l,a]=(0,o.useState)([{id:"fasf",title:"12A1",total:12,select:4},{id:"\xe2cv",title:"12A2",total:12,select:4},{id:"ewg",title:"12A4",total:12,select:4},{id:"SEWEG",title:"12A3",total:12,select:4},{id:"REBB",title:"12A1",total:12,select:4},{id:"dbb",title:"12A5",total:12,select:4}]),[p,f]=(0,o.useState)(!1),[g,m]=(0,o.useState)(""),[v,b]=(0,o.useState)(t);return(0,o.useEffect)(()=>{n&&n(v)},[v]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(eA.Z,{sx:{my:3},severity:"error",icon:!1,children:"Chỉ những t\xe0i khoản của học sinh được chọn mới được quyền l\xe0m đề thi n\xe0y"}),(0,s.jsx)(et._,{rows:l.filter(e=>e.title.toLowerCase().includes(g.toLowerCase())).map((e,t)=>({...e,num:t+1})),columns:[{field:"actions",headerName:"",renderCell:e=>(0,s.jsx)(h.Z,{title:"Chọn học sinh",arrow:!0,children:(0,s.jsx)(x.Z,{size:"small",onClick:()=>{f(!0)},children:(0,s.jsx)(T.Z,{icon:"tabler:user-plus"})})})},{field:"num",headerName:"STT",maxWidth:80},{field:"title",headerName:"Lớp học",width:250},{field:"total",headerName:"Số học sinh",width:150},{field:"select",headerName:"Đ\xe3 chọn",width:100}],autoHeight:!0,initialState:{pagination:{paginationModel:{pageSize:10}}},pageSizeOptions:[10,30,50]}),(0,s.jsx)(ej.ZP,{open:p,sx:{zIndex:1301},anchor:"right",children:(0,s.jsxs)(c.Z,{children:[(0,s.jsx)(d.Z,{variant:"h4",sx:{m:2},children:"Lớp 125"}),(0,s.jsx)(et._,{rows:l.filter(e=>e.title.toLowerCase().includes(g.toLowerCase())).map((e,t)=>({...e,num:t+1})),columns:[{field:"num",headerName:"STT",maxWidth:80},{field:"title",headerName:"Họ v\xe0 t\xean",width:300}],autoHeight:!0,initialState:{pagination:{paginationModel:{pageSize:10}}},pageSizeOptions:[10,30,50],checkboxSelection:!0,onRowSelectionModelChange:e=>{b(e)},rowSelectionModel:v}),(0,s.jsxs)(c.Z,{sx:{mt:3,textAlign:"center"},children:[(0,s.jsx)(u.Z,{sx:{mr:2},variant:"tonal",color:"error",onClick:()=>f(!1),children:"Hủy"}),(0,s.jsx)(u.Z,{variant:"contained",children:"Lưu"})]})]})})]})};var nU=n(5715);let n$=e=>{let{accept:t,onChange:n,students:l=[]}=e,o=e=>{n(e)},{user:a}=(0,nU.a)(),c=[{value:"all",title:"Tất cả mọi người",isSelected:!0,icon:"tabler:world"},{value:"list",title:"Giao theo danh s\xe1ch",icon:"tabler:list-check"}];return(null==a?void 0:a.role)=="admin"&&(c=[{value:"all",title:"Tất cả mọi người",isSelected:!0,icon:"tabler:world"},{value:"list",title:"Giao theo danh s\xe1ch",icon:"tabler:list-check"},{value:"classes",title:"Giao theo lớp học",icon:"tabler:school"},{value:"student",title:"Giao theo học sinh",icon:"tabler:user"}]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(N.ZP,{container:!0,spacing:4,children:c.map((e,n)=>(0,s.jsx)(nH,{data:e,selected:t||"all",icon:e.icon,handleChange:e=>o({accept:"string"==typeof e?e:e.target.value,students:[]}),gridProps:{sm:Math.floor(12/c.length),xs:12},iconProps:{fontSize:"1.75rem",style:{marginBottom:8}}},n))}),"all"==t?(0,s.jsx)(nz,{onChange:e=>o({students:e}),students:l}):null,"classes"==t?(0,s.jsx)(nY,{onChange:e=>o({students:e}),students:l}):null,"student"==t?(0,s.jsx)(nW,{onChange:e=>o({students:e}),students:l}):null,"list"==t?(0,s.jsx)(nq,{onChange:e=>o({students:e}),students:l}):null]})};var nV=()=>{let e=(0,p.v9)(e=>e.quiz.settings),t=(0,p.I0)(),[n,l]=(0,o.useState)(e),[a,h]=(0,o.useState)(!1),m=()=>{t((0,f.z)({status:""}))},v=()=>{let{accept:e="all",collects:s=[],students:l=[]}=n;switch(e){case"all":if(!s.length)return P().fire({icon:"error",title:"Oops...",text:"Phần TH\xd4NG TIN CẦN THU THẬP phải c\xf3 tối thiểu 01 trường th\xf4ng tin"});break;case"classes":if(!l.length)return P().fire({icon:"error",title:"Oops...",text:"Vui l\xf2ng chọn tối thiểu 1 lớp học để giao b\xe0i"});break;case"student":if(!l.length)return P().fire({icon:"error",title:"Oops...",text:"Vui l\xf2ng chọn tối thiểu 1 học sinh để giao b\xe0i"});break;case"list":if(!l.length)return P().fire({icon:"error",title:"Oops...",text:"Vui l\xf2ng th\xeam tối thiểu 1 học sinh để giao b\xe0i"})}if(s.filter(e=>!e.label.trim()).length)return P().fire({icon:"error",title:"Oops...",text:"Phần TH\xd4NG TIN THU THẬP chưa nhập đầy đủ c\xe1c trường th\xf4ng tin"});t((0,g.kQ)(n)),m()},b=e=>{l(t=>({...t,...e}))},C=()=>{if(a)return;let e=document.createElement("input");e.setAttribute("type","file"),e.setAttribute("accept","image/*"),e.click(),e.onchange=async()=>{let[t]=e.files;if(t){h(!0);let e=n.cover||"https://i.imgur.com/dKZNJGk.png",s=URL.createObjectURL(t);b({cover:s});let{error:l,url:o}=await w(t);h(!1),l&&(b({cover:e}),P().fire({icon:"error",title:"C\xf3 lỗi khi thay đổi ảnh b\xeca"})),o&&b({cover:o})}}};return(0,s.jsxs)(k.Z,{sx:{paddingX:"0!important"},children:[(0,s.jsx)(e9.Z,{sx:{marginY:3},children:(0,s.jsx)(te.Z,{label:"TH\xd4NG TIN CƠ BẢN",skin:"light",color:"primary"})}),(0,s.jsxs)(N.ZP,{container:!0,spacing:3,children:[(0,s.jsxs)(N.ZP,{item:!0,xs:12,md:8,children:[(0,s.jsx)(c.Z,{children:(0,s.jsx)(X.Z,{label:"T\xean đề thi",fullWidth:!0,value:n.title||"",onChange:e=>b({title:e})})}),(0,s.jsxs)(c.Z,{sx:{mt:2},children:[(0,s.jsx)(d.Z,{variant:"h6",sx:{marginY:2},children:"Giới thiệu về đề thi"}),(0,s.jsx)(nn,{content:n.subtitle,sx:{minHeight:"5rem"},theme:"snow",inline:!0,onChange:e=>b({subtitle:e})})]})]}),(0,s.jsx)(N.ZP,{item:!0,xs:12,md:4,children:(0,s.jsxs)(c.Z,{onClick:C,sx:{display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",cursor:"pointer"},children:[a?(0,s.jsxs)(c.Z,{style:{position:"relative"},children:[(0,s.jsx)("img",{src:n.cover||"https://i.imgur.com/dKZNJGk.png",style:{maxWidth:"100%",filter:"blur(5px)"}}),(0,s.jsx)(ef.Z,{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}})]}):(0,s.jsx)("img",{src:n.cover||"https://i.imgur.com/dKZNJGk.png",style:{maxWidth:"100%"}}),(0,s.jsx)("span",{children:"Click để thay đổi ảnh b\xeca "})]})})]}),(0,s.jsx)(e9.Z,{sx:{marginY:3},children:(0,s.jsx)(te.Z,{label:"CHUNG",skin:"light",color:"primary"})}),(0,s.jsxs)(N.ZP,{container:!0,spacing:3,children:[(0,s.jsx)(N.ZP,{item:!0,xs:12,md:6,children:(0,s.jsx)(X.Z,{label:"Thời gian l\xe0m b\xe0i",fullWidth:!0,type:"number",placeholder:"90",InputProps:{endAdornment:(0,s.jsx)(O.Z,{position:"end",children:"ph\xfat"}),inputProps:{min:0,step:1}},value:n.timeout||"90",onChange:e=>b({timeout:e})})}),(0,s.jsx)(N.ZP,{item:!0,xs:12,md:6,children:(0,s.jsx)(X.Z,{label:"Số lần l\xe0m",type:"number",placeholder:"0",fullWidth:!0,helperText:"Số lần mỗi học sinh c\xf3 thể l\xe0m b\xe0i. 0 để kh\xf4ng giới hạn.",InputProps:{inputProps:{min:0,step:1}},value:n.retake||"0",onChange:e=>b({retake:e})})}),(0,s.jsx)(N.ZP,{item:!0,xs:12,md:6,children:(0,s.jsx)(X.Z,{label:"Thời gian bắt đầu",fullWidth:!0,InputLabelProps:{shrink:!0},type:"datetime-local",helperText:"Học sinh chỉ c\xf3 thể l\xe0m b\xe0i kể từ thời điểm bắt đầu",value:n.startTime||"",onChange:e=>b({startTime:e})})}),(0,s.jsx)(N.ZP,{item:!0,xs:12,md:6,children:(0,s.jsx)(X.Z,{label:"Thời gian hết hạn",fullWidth:!0,InputLabelProps:{shrink:!0},type:"datetime-local",helperText:"Qu\xe1 thời gian n\xe0y học sinh sẽ kh\xf4ng thể bắt đ\xe2u l\xe0m b\xe0i",value:n.endTime||"",onChange:e=>b({endTime:e})})})]}),(0,s.jsx)(e9.Z,{sx:{marginY:3},children:(0,s.jsx)(te.Z,{label:"BẢO MẬT",skin:"light",color:"warning"})}),(0,s.jsxs)(N.ZP,{container:!0,spacing:3,children:[(0,s.jsx)(N.ZP,{item:!0,xs:12,md:6,children:(0,s.jsx)(X.Z,{label:"Mật khẩu đề thi",fullWidth:!0,helperText:"Y\xeau cầu học sinh nhập đ\xfang mật khẩu mới c\xf3 thể bắt đầu l\xe0m b\xe0i",value:n.password||"",onChange:e=>b({password:e})})}),(0,s.jsx)(N.ZP,{item:!0,xs:12,md:6,children:(0,s.jsxs)(X.Z,{select:!0,label:"Tự động nộp b\xe0i khi chuyển tabs",fullWidth:!0,helperText:"Hệ thống sẽ tự động nộp b\xe0i l\xe0m khi học sinh chuyển tab kh\xe1c",value:n.tabs||"0",onChange:e=>b({tabs:e}),children:[(0,s.jsx)(el.Z,{value:"0",children:"Kh\xf4ng"}),(0,s.jsx)(el.Z,{value:"3",children:"Sau 3 gi\xe2y"}),(0,s.jsx)(el.Z,{value:"5",children:"Sau 5 gi\xe2y"}),(0,s.jsx)(el.Z,{value:"7",children:"Sau 7 gi\xe2y"}),(0,s.jsx)(el.Z,{value:"10",children:"Sau 10 gi\xe2y"}),(0,s.jsx)(el.Z,{value:"15",children:"Sau 15 gi\xe2y"}),(0,s.jsx)(el.Z,{value:"30",children:"Sau 30 gi\xe2y"}),(0,s.jsx)(el.Z,{value:"60",children:"Sau 60 gi\xe2y"})]})}),(0,s.jsx)(N.ZP,{item:!0,xs:12,md:6,children:(0,s.jsxs)(X.Z,{select:!0,label:"Chức năng m\xe3 chia sẻ",fullWidth:!0,helperText:"Gi\xe1o vi\xean kh\xe1c c\xf3 thể dễ d\xe0ng nhập nội dung đề thi n\xe0y cho đề thi của họ.",value:n.share||"F",onChange:e=>b({share:e}),children:[(0,s.jsx)(el.Z,{value:"F",children:"Kh\xf4ng"}),(0,s.jsx)(el.Z,{value:"T",children:"C\xf3"})]})})]}),(0,s.jsx)(e9.Z,{sx:{marginY:3},children:(0,s.jsx)(te.Z,{label:"C\xc2U HỎI V\xc0 TRẢ LỜI",skin:"light",color:"info"})}),(0,s.jsxs)(N.ZP,{container:!0,spacing:3,children:[(0,s.jsx)(N.ZP,{item:!0,xs:12,md:6,children:(0,s.jsxs)(X.Z,{select:!0,label:"Chế độ hiển thị c\xe2u hỏi",fullWidth:!0,value:n.showQuestions||"A",onChange:e=>b({showQuestions:e}),children:[(0,s.jsx)(el.Z,{value:"A",children:"Hiện to\xe0n bộ c\xe2u hỏi"}),(0,s.jsx)(el.Z,{value:"Q",children:"Hiện theo từng c\xe2u hỏi"})]})}),(0,s.jsx)(N.ZP,{item:!0,xs:12,md:6,children:(0,s.jsxs)(X.Z,{select:!0,label:"Bắt buộc l\xe0m tất cả c\xe1c c\xe2u hỏi",fullWidth:!0,value:n.require||"T",onChange:e=>b({require:e}),children:[(0,s.jsx)(el.Z,{value:"T",children:"Phải l\xe0m hết mới cho nộp b\xe0i"}),(0,s.jsx)(el.Z,{value:"F",children:"Kh\xf4ng cần phải l\xe0m hết"})]})}),(0,s.jsx)(N.ZP,{item:!0,xs:12,md:6,children:(0,s.jsxs)(X.Z,{select:!0,label:"Chế độ đảo c\xe2u hỏi",fullWidth:!0,helperText:"C\xe1c nh\xf3m c\xe2u hỏi đ\xe3 cố định th\xec hệ thống sẽ kh\xf4ng đảo c\xe2u hỏi nh\xf3m đ\xf3",value:n.randomQuestion||"N",onChange:e=>b({randomQuestion:e}),children:[(0,s.jsx)(el.Z,{value:"N",children:"Kh\xf4ng đảo c\xe2u hỏi"}),(0,s.jsx)(el.Z,{value:"E",children:"Đảo to\xe0n bộ đề thi"})]})}),(0,s.jsx)(N.ZP,{item:!0,xs:12,md:6,children:(0,s.jsxs)(X.Z,{select:!0,label:"Chế độ đảo đ\xe1p \xe1n",fullWidth:!0,helperText:"C\xe1c c\xe2u hỏi đ\xe3 cố định đ\xe1p \xe1n th\xec hệ thống sẽ kh\xf4ng đảo đ\xe1p \xe1n c\xe2u hỏi đ\xf3",value:n.randomAnswer||"F",onChange:e=>b({randomAnswer:e}),children:[(0,s.jsx)(el.Z,{value:"F",children:"Kh\xf4ng đảo đ\xe1p \xe1n"}),(0,s.jsx)(el.Z,{value:"T",children:"C\xf3 đảo đ\xe1p \xe1n"})]})}),(0,s.jsx)(N.ZP,{item:!0,xs:12,md:6,children:(0,s.jsxs)(X.Z,{select:!0,label:"Chế độ hiển thị b\xe0i l\xe0m",fullWidth:!0,value:n.showResult||"F",onChange:e=>b({showResult:e}),children:[(0,s.jsx)(el.Z,{value:"N",children:"Kh\xf4ng hiển thị"}),(0,s.jsx)(el.Z,{value:"F",children:"Ngay sau khi nộp b\xe0i"})]})}),(0,s.jsx)(N.ZP,{item:!0,xs:12,md:6,children:(0,s.jsxs)(X.Z,{select:!0,label:"Chế độ hiển thị điểm",fullWidth:!0,value:n.showPoint||"F",onChange:e=>b({showPoint:e}),children:[(0,s.jsx)(el.Z,{value:"N",children:"Kh\xf4ng hiển thị"}),(0,s.jsx)(el.Z,{value:"F",children:"Ngay sau khi nộp b\xe0i"})]})}),(0,s.jsx)(N.ZP,{item:!0,xs:12,md:6,children:(0,s.jsxs)(X.Z,{select:!0,label:"Chế độ hiển thị đ\xe1p \xe1n đ\xfang",fullWidth:!0,value:n.showKey||"A",onChange:e=>b({showKey:e}),children:[(0,s.jsx)(el.Z,{value:"A",children:"Lu\xf4n hiển thị"}),(0,s.jsx)(el.Z,{value:"T",children:"Chỉ c\xe2u đ\xfang"}),(0,s.jsx)(el.Z,{value:"F",children:"Chỉ c\xe2u sai"}),(0,s.jsx)(el.Z,{value:"H",children:"Lu\xf4n ẩn"})]})}),(0,s.jsx)(N.ZP,{item:!0,xs:12,md:6,children:(0,s.jsxs)(X.Z,{select:!0,label:"Chế độ hiển thị hướng dẫn giải",fullWidth:!0,value:n.showExplain||"A",onChange:e=>b({showExplain:e}),children:[(0,s.jsx)(el.Z,{value:"A",children:"Lu\xf4n hiển thị"}),(0,s.jsx)(el.Z,{value:"T",children:"Chỉ c\xe2u đ\xfang"}),(0,s.jsx)(el.Z,{value:"F",children:"Chỉ c\xe2u sai"}),(0,s.jsx)(el.Z,{value:"H",children:"Lu\xf4n ẩn"})]})})]}),(0,s.jsx)(e9.Z,{sx:{marginY:3},children:(0,s.jsx)(te.Z,{label:"AI C\xd3 THỂ L\xc0M?",skin:"light",color:"success"})}),(0,s.jsx)(n$,{accept:n.accept,onChange:b,students:n.students}),(0,s.jsx)(e9.Z,{sx:{marginY:3},children:(0,s.jsx)(te.Z,{label:"TH\xd4NG TIN CẦN THU THẬP",skin:"light",color:"success"})}),(0,s.jsxs)(c.Z,{children:[(0,s.jsx)(e6.Z,{children:(n.collects||[]).map((e,t)=>(0,s.jsxs)(e8.ZP,{disablePadding:!0,sx:{paddingY:1},children:[(0,s.jsx)(X.Z,{fullWidth:!0,size:"small",sx:{mr:2},InputProps:{startAdornment:(0,s.jsxs)(O.Z,{position:"start",children:["Th\xf4ng tin ",t+1]})},value:e.label,placeholder:"Nhập th\xf4ng tin cần thu thập",onChange:e=>b({collects:n.collects.map((n,s)=>s==t?{...n,label:e}:n)})}),(0,s.jsx)(tr.Z,{children:(0,s.jsx)(x.Z,{color:"error",onClick:()=>b({collects:n.collects.filter((e,n)=>n!=t)}),children:(0,s.jsx)(T.Z,{icon:"tabler:trash"})})})]},t))}),(0,s.jsx)(u.Z,{variant:"contained",startIcon:(0,s.jsx)(T.Z,{icon:"tabler:plus"}),onClick:()=>b({collects:n.collects?[...n.collects,{label:""}]:[{label:""}]}),children:"Th\xeam th\xf4ng tin"})]}),(0,s.jsxs)(c.Z,{sx:{mt:5,textAlign:"center"},children:[(0,s.jsx)(u.Z,{sx:{mr:2},variant:"tonal",color:"error",onClick:m,children:"Hủy"}),(0,s.jsx)(u.Z,{variant:"contained",onClick:v,children:"Lưu"})]})]})};let nQ=(0,L.ZP)(x.Z)(e=>{let{theme:t}=e;return{top:0,right:0,color:"grey.500",position:"absolute",boxShadow:t.shadows[2],transform:"translate(10px, -10px)",borderRadius:t.shape.borderRadius,backgroundColor:"".concat(t.palette.background.paper," !important"),transition:"transform 0.25s ease-in-out, box-shadow 0.25s ease-in-out","&:hover":{transform:"translate(7px, -5px)"}}});var nK=()=>{let e=(0,p.I0)(),t=()=>{e((0,f.z)({status:""}))};return(0,s.jsxs)(k.Z,{sx:{pb:e=>"".concat(e.spacing(8)," !important"),px:e=>["".concat(e.spacing(5)," !important"),"".concat(e.spacing(15)," !important")],pt:e=>["".concat(e.spacing(8)," !important"),"".concat(e.spacing(12.5)," !important")]},children:[(0,s.jsx)(nQ,{onClick:t,children:(0,s.jsx)(T.Z,{icon:"tabler:x",fontSize:"1.25rem"})}),(0,s.jsx)(nV,{})]})};let nX=(0,o.forwardRef)(function(e,t){return(0,s.jsx)(_.Z,{ref:t,...e})}),nJ=eM()(()=>Promise.all([n.e(117),n.e(141)]).then(n.bind(n,5141)),{loadableGenerated:{webpack:()=>[5141]},ssr:!1}),n0=e=>{let{type:t}=e;switch(t){case"quiz":return(0,s.jsx)(nR,{});case"group":return(0,s.jsx)(nk,{});case"options":return(0,s.jsx)(nM.default,{});case"math":return(0,s.jsx)(nJ,{});case"settings":return(0,s.jsx)(nK,{})}return null},n1=()=>{let{status:e,data:t}=(0,p.v9)(e=>e.popup);return(0,s.jsx)(Z.Z,{fullWidth:!0,open:!!e,maxWidth:"md",scroll:"body",TransitionComponent:nX,sx:{"& .MuiDialog-paper":{overflow:"visible"}},children:(0,s.jsx)(n0,{type:e})})},n2=()=>(0,s.jsxs)(N.ZP,{container:!0,spacing:3,children:[(0,s.jsx)(N.ZP,{item:!0,xs:12,md:4,children:(0,s.jsx)(nS,{})}),(0,s.jsx)(N.ZP,{item:!0,xs:12,md:8,children:(0,s.jsx)(nE,{})}),(0,s.jsx)(n1,{})]});n2.layout="hi";var n5=n(4521),n4=n.n(n5);let n3=(e,t)=>{var n=document.createElement("script");n.type="text/javascript",n.src=e,n.onload=t,n.onerror=e=>{console.log(e)},document.head.appendChild(n)},n9=(e,t)=>{var n=0;!function s(){if(n<e.length){var l=e[n];n3(C.default.assetPrefix+l,function(){n++,s()})}else"function"==typeof t&&t()}()},n6=(e,t)=>{let n=document.createElement("input");n.setAttribute("type","file"),n.setAttribute("accept",".pdf,.docx"),n.click(),n.onchange=async()=>{let[s]=n.files;s&&s.name.endsWith(".pdf")&&(console.log(s),n9(["/scripts/pdf.js","/scripts/pdf.worker.js"],function(){let n=new(n4())(e,t);n.parsePdf(s)}))}},n8=e=>{let{questionId:t}=e,n=(0,p.v9)(e=>e.quiz.questions.find(e=>e.id==t)),l=(0,p.I0)(),[a,d]=(0,o.useState)(n);(0,o.useEffect)(()=>{JSON.stringify(a)!==JSON.stringify(n)&&d(n)},[n]),(0,o.useEffect)(()=>{JSON.stringify(a)!==JSON.stringify(n)&&l((0,g.Ds)(a))},[a]);let h=e=>{d(t=>({...t,...e}))};return(0,s.jsxs)(e_.Z,{sx:{mb:2},children:[(0,s.jsx)(K.Z,{title:(0,s.jsx)(tA.Z,{label:"C\xe2u ".concat(a.number),color:"primary"}),sx:{paddingY:2,overflowX:"auto",px:{xs:2,md:4}}}),(0,s.jsx)(e9.Z,{}),(0,s.jsxs)(Q.Z,{sx:{px:{xs:2,md:4}},children:[(0,s.jsx)(c.Z,{sx:{paddingY:1},children:(0,s.jsx)(nn,{content:a.content,onChange:e=>h({content:e})})}),(0,s.jsx)(nl,{question:a,onChange:h}),(0,s.jsxs)(eA.Z,{severity:"info",icon:!1,sx:{".MuiAlert-message":{width:"100%",overflow:"unset"}},children:[(0,s.jsx)(e9.Z,{children:"HƯỚNG DẪN GIẢI"}),(0,s.jsx)(c.Z,{children:(0,s.jsx)(nn,{content:a.explain||"",onChange:e=>h({explain:e})})})]})]})]})},n7=e=>{let{groupId:t,isOne:n}=e,{questions:l,random:a,content:d,...h}=(0,p.v9)(e=>e.quiz.groups.find(e=>e.id==t)),u=(0,o.useMemo)(()=>l.map(e=>(0,s.jsx)(n8,{questionId:e},e)),[l]);return(0,s.jsxs)(c.Z,{children:[(0,s.jsx)(e_.Z,{className:"header-group",sx:{border:0,boxShadow:0,mb:2.5},children:(0,s.jsx)(K.Z,{sx:{paddingY:3,alignItems:"center"},avatar:(0,s.jsx)(T.Z,{icon:"tabler:clipboard-list"}),action:(0,s.jsx)(c.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:(0,s.jsx)(tA.Z,{label:"".concat(l.length," c\xe2u")})})})}),u]})},se=e=>{let{quizId:t}=e,n=(0,p.v9)(e=>e.quiz.quizs.find(e=>e.id==t)),l=(0,p.v9)(e=>e.quiz.questions.filter(e=>e.quizId==t)).length,a=(0,p.I0)(),d=()=>{n6(t,e=>{let{data:t}=e;console.log("handleImportFile",t),a((0,g.l$)(t))})},u=(0,o.useMemo)(()=>n.groups.map(e=>(0,s.jsx)(n7,{groupId:e,isOne:1==n.groups.length},e)),[n.groups]);return(0,s.jsxs)("div",{style:{marginBottom:10},children:[(0,s.jsx)(K.Z,{title:"CHI TIẾT ĐỀ THI",className:"header-exam",sx:{paddingY:3,borderRadius:"0.5rem","span, svg":{color:"#fff"}},action:(0,s.jsxs)(c.Z,{sx:{display:"flex",alignItems:"center"},children:[(0,s.jsx)(h.Z,{title:"Nhập c\xe2u hỏi từ tập tin .pdf",children:(0,s.jsx)(x.Z,{color:"success",sx:{mr:1},onClick:d,children:(0,s.jsx)(T.Z,{icon:"tabler:upload",fontSize:20})})}),(0,s.jsx)(h.Z,{title:"Bảng đ\xe1p \xe1n",children:(0,s.jsx)(x.Z,{color:"error",sx:{mr:1},children:(0,s.jsx)(T.Z,{icon:"tabler:clipboard-list",fontSize:20})})}),(0,s.jsx)(tA.Z,{label:"".concat(null!=l?l:0," c\xe2u")})]})}),(0,s.jsx)(Q.Z,{sx:{paddingX:0,mt:3},children:u})]})},st=e=>b().gzipSync(JSON.stringify(e)).toString("base64"),sn=e=>{if(e){var t=document.getElementById(e);if(t){var n=t.getBoundingClientRect().top+window.pageYOffset;window.scrollTo({top:n-100,behavior:"smooth"})}}},ss=()=>{let e=(0,p.v9)(e=>e.quiz),t=(0,p.I0)(),n=(0,l.useRouter)(),a=(0,o.useRef)(),[d,h]=(0,o.useState)(!1),[x,f]=(0,o.useState)(!1),[v,b]=(0,o.useState)({}),E=()=>{a.current.postMessage({action:"checkErrorCreate",payload:e})},j=async()=>{var s,l,o,a,c,d;t((0,m.V)({status:"Đang xử l\xfd...."}));let u=e.groups.filter(t=>e.quizs.flatMap(e=>e.groups).includes(t.id)),x=e.questions.filter(e=>u.flatMap(e=>e.questions).includes(e.id)).map(e=>"TL"==e.type?{...e,options:[]}:e),p=e=>{for(var t=e.split(","),n=t[0].match(/:(.*?);/),s=atob(t[1]),l=s.length,o=new Uint8Array(l);l--;)o[l]=s.charCodeAt(l);let a=n&&n.length>0?n[1]:"png";return new File([o],"hinhanh.".concat(a.split("/")[1]),{type:a})},v=e=>{let t=document.createElement("div");t.innerHTML=e||"";let n=t.getElementsByClassName("ql-formula");for(let e=n.length-1;e>=0;e--){let t=n[e];t.innerHTML=""}let s=t.getElementsByTagName("img");for(let e=0;e<s.length;e++){let t=s[e];t.src.startsWith("data:image/")&&(t.src="")}return t.innerHTML},C=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"content",n=[];for(let t=0;t<e.length;t+=3){let s=e.slice(t,t+3);n.push(s)}let s=[];for(let e=0;e<n.length;e++){let l=n[e],o=l.map(async e=>{let n;let s=[],l=e[t]||"",o=/<img.*?src="(data:image\/[^;]+;base64,.*?)".*?>/g;for(;n=o.exec(l);){let e=n[1],t=await w(p(e));s.push((null==t?void 0:t.url)||e)}let a=l.replace(o,(e,t)=>{let n=s.shift();return'<img src="'.concat(n,'" >')});return{...e,[t]:a}}),a=await Promise.all(o);s.push(...a)}return s},T=await C(x),E=await C(T,"explain"),j=await C(u);t((0,g.Be)({groups:j})),t((0,g.QV)({questions:E}));let S=E.map(e=>({...e,content:v(e.content||""),explain:v(e.explain||""),options:(e.options||[]).map(e=>({...e,text:v(e.text)}))})),N={...e.settings,parent:(null==n?void 0:null===(s=n.query)||void 0===s?void 0:s.parent)||"",id:(null==e?void 0:null===(l=e.settings)||void 0===l?void 0:l.id)||(null==n?void 0:null===(o=n.query)||void 0===o?void 0:o.id)||"",cover:null!==(d=null===(a=e.settings)||void 0===a?void 0:a.cover)&&void 0!==d?d:"https://i.imgur.com/dKZNJGk.png"},Z={questions:[...null==e?void 0:null===(c=e.quizs)||void 0===c?void 0:c.map(e=>({quizs:st(e),id:e.id,v:I.Version})),...null==j?void 0:j.map(e=>({groups:st(e),id:e.id,quizId:e.quizId,v:I.Version})),...null==S?void 0:S.map(e=>({questions:st(e),id:e.id,quizId:e.quizId,groupId:e.groupId,level:e.level,shuffle:e.shuffle,v:I.Version}))],settings:[{settings:st({...N,collects:void 0,students:void 0}),v:I.Version},...((null==N?void 0:N.collects)||[]).map(e=>({collects:st(e),v:I.Version})),...((null==N?void 0:N.students)||[]).map(e=>({students:st(e),v:I.Version,username:(null==e?void 0:e.username)||e}))],results:{...N,students:void 0,quizType:(null==S?void 0:S.filter(e=>"TL"==e.type).length)?"Hỗn hợp":"Trắc nghiệm",numberQuestions:Math.max(...null==j?void 0:j.map(e=>e.questions.length))}};t((0,m.V)({status:"Đang lưu"}));try{let e=(await y.default.post("/chatbot",Z)).data;if(e.error)return t((0,m.V)({status:""})),h(!1),P().fire({icon:"error",title:"Oops...",text:e.error,footer:'<a href="#">Why do I have this issue?</a>'});t((0,g.kQ)({id:e.id})),t((0,g.kQ)({url:e.url})),t((0,m.V)({status:""})),f(!0),b(e),h(!1),A({parent:e.parent,id:e.id})}catch(e){return t((0,m.V)({status:""})),P().fire({icon:"error",title:"Oops...",text:"Vui l\xf2ng thử lại sau",footer:'<a href="#">Why do I have this issue?</a>'})}},A=e=>{let t=n.asPath.split("?")[0],s=new URLSearchParams(e).toString(),l="".concat(t,"?").concat(s);n.replace(l,void 0,{shallow:!0})},S=async()=>{try{var e;let{id:s="",parent:l=""}=n.query;if(!s){t((0,g._e)({quizs:[],groups:[],questions:[],settings:{collects:[{label:"Họ v\xe0 t\xean"},{label:"Lớp"}],students:[],title:""}})),t((0,g.BT)()),t((0,m.V)({status:""}));return}let o=(await (0,y.default)("/chatbot/".concat(s,"/details?parent=").concat(l))).data;if(null==o?void 0:o.error){P().fire({icon:"error",title:"Oops...",text:o.error,footer:'<a href="#">Why do I have this issue?</a>'}),t((0,m.V)({status:""})),n.push("/p/chatbot.html");return}return null==a?void 0:null===(e=a.current)||void 0===e?void 0:e.postMessage({action:"fetchCreate",payload:o})}catch(e){return console.log("fetchData",e),P().fire({icon:"error",title:"Oops...",text:"Vui l\xf2ng li\xean hệ Admin để được hỗ trợ",footer:'<a href="#">Why do I have this issue?</a>'})}};return(0,o.useEffect)(()=>{d&&j()},[d]),(0,o.useEffect)(()=>()=>{t((0,m.V)({status:""}))},[]),(0,o.useEffect)(()=>(t((0,m.V)({status:"Vui l\xf2ng đợi..."})),n.isReady&&(a.current&&a.current.terminate(),fetch("".concat(C.default.assetPrefix,"/scripts/worker.").concat(C.default.version,".js")).then(e=>e.blob()).then(e=>{a.current=new Worker(URL.createObjectURL(e)),a.current.onmessage=async e=>{let{action:n="",payload:s=null}=e.data;switch(n){case"fetchCreate":t((0,g._e)(s)),setTimeout(()=>{t((0,m.V)({status:""}))},500);break;case"checkErrorCreate":let{errors:l,warnings:o}=s;if(l.length)return sn(l[0].id),P().fire({icon:"error",title:"Oops...",text:l[0].text,footer:'<a href="#">Why do I have this issue?</a>'});o.length?P().fire({title:"Ch\xfa \xfd",html:'<p>Hệ thống ph\xe1t hiện một số vấn đề sau, bạn h\xe3y kiểm tra lại n\xf3 trước khi lưu đề thi.</p><ul style=" text-align: left; ">'.concat(o.map(e=>"<li>".concat(e,"</li>")).join(""),"</ul>"),icon:"warning",showCancelButton:!0,confirmButtonText:"Vẫn lưu",cancelButtonText:"Huỷ"}).then(e=>{e.isConfirmed&&h(!0)}):h(!0)}},S()})),()=>{a.current&&a.current.terminate(),t((0,m.V)({status:""}))}),[n]),(0,s.jsxs)(c.Z,{sx:{position:"fixed",bottom:15,right:"3.85rem",zIndex:1031},children:[(0,s.jsx)(u.Z,{variant:"contained",startIcon:(0,s.jsx)(T.Z,{icon:"tabler:device-floppy"}),onClick:E,color:"error",sx:{boxShadow:"0 1px 20px 1px #EA5455!important",":hover":{boxShadow:"none!important"}},children:"LƯU ĐỀ THI"}),(0,s.jsx)(Y,{show:x,setShow:f,data:v})]})},si=()=>{var e,t;let n=(0,p.v9)(e=>e.quiz.settings),[a,h]=(0,o.useState)(!1),u=(0,p.I0)(),m=(0,l.useRouter)(),v=q(),b=()=>{if(a)return;let e=document.createElement("input");e.setAttribute("type","file"),e.setAttribute("accept","image/*"),e.click(),e.onchange=async()=>{let[t]=e.files;if(t){h(!0);let e=n.cover||"https://i.imgur.com/dKZNJGk.png",s=URL.createObjectURL(t);C({cover:s});let{error:l,url:o}=await w(t);h(!1),l&&(C({cover:e}),P().fire({icon:"error",title:"C\xf3 lỗi khi thay đổi ảnh b\xeca"})),o&&C({cover:o})}}},C=e=>{u((0,g.kQ)(e))},I=e=>()=>{e&&m.push({pathname:e,query:m.query})},y=()=>{u((0,f.z)({status:"settings",data:{}}))},E=e=>{v.copy(e),S.ZP.success("Đ\xe3 sao ch\xe9p",{duration:2e3})};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e_.Z,{sx:{background:"#b1b1b11f",mb:3},children:(0,s.jsx)(Q.Z,{sx:{padding:".5rem!important"},children:(0,s.jsxs)(e6.Z,{component:"div",sx:{p:0},children:[(0,s.jsx)(e8.ZP,{disablePadding:!0,children:(0,s.jsxs)(tS.Z,{sx:{display:"flex",flexDirection:"column"},onClick:b,children:[a?(0,s.jsxs)(c.Z,{style:{position:"relative"},children:[(0,s.jsx)("img",{src:null!==(e=null==n?void 0:n.cover)&&void 0!==e?e:"https://i.imgur.com/dKZNJGk.png",style:{maxWidth:"100%",filter:"blur(5px)"}}),(0,s.jsx)(ef.Z,{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}})]}):(0,s.jsx)("img",{src:null!==(t=null==n?void 0:n.cover)&&void 0!==t?t:"https://i.imgur.com/dKZNJGk.png",style:{maxWidth:"100%"}}),(0,s.jsx)(ei.Z,{primary:"Click để thay đổi ảnh b\xeca"})]})}),(0,s.jsx)(e8.ZP,{disablePadding:!0,children:(0,s.jsx)(X.Z,{fullWidth:!0,label:"T\xean đề thi",value:n.title,onChange:e=>C({title:e})})}),(0,s.jsx)(e8.ZP,{disablePadding:!0,children:(0,s.jsxs)(c.Z,{sx:{width:"100%"},children:[(0,s.jsx)(d.Z,{variant:"h6",sx:{marginY:2},children:"Giới thiệu về đề thi"}),(0,s.jsx)(nn,{content:n.subtitle,sx:{minHeight:"5rem"},theme:"snow",inline:!0,onChange:e=>C({subtitle:e})})]})})]})})}),(null==n?void 0:n.url)?(0,s.jsx)(e_.Z,{sx:{mb:3},children:(0,s.jsx)(Q.Z,{sx:{p:"0.75rem!important"},children:(0,s.jsxs)(nj.Z,{fullWidth:!0,variant:"outlined",children:[(0,s.jsx)(nA.Z,{children:"Link đề thi"}),(0,s.jsx)(nP.Z,{value:(null==n?void 0:n.url)||"",disabled:!0,endAdornment:(0,s.jsx)(O.Z,{position:"end",children:(0,s.jsx)(x.Z,{edge:"end",onClick:()=>E(null==n?void 0:n.url),sx:{color:"success.main"},children:(0,s.jsx)(T.Z,{icon:"tabler:copy",fontSize:20})})}),label:"Link đề thi"})]})})}):null,(null==n?void 0:n.share)=="T"&&(null==n?void 0:n.id)?(0,s.jsx)(e_.Z,{sx:{mb:3},children:(0,s.jsx)(Q.Z,{sx:{p:"0.75rem!important"},children:(0,s.jsxs)(nj.Z,{fullWidth:!0,variant:"outlined",children:[(0,s.jsx)(nA.Z,{children:"M\xe3 chia sẻ"}),(0,s.jsx)(nP.Z,{value:j(null==n?void 0:n.id),disabled:!0,endAdornment:(0,s.jsx)(O.Z,{position:"end",children:(0,s.jsx)(x.Z,{edge:"end",onClick:()=>E(j(null==n?void 0:n.id)),sx:{color:"success.main"},children:(0,s.jsx)(T.Z,{icon:"tabler:copy",fontSize:20})})}),label:"M\xe3 chia sẻ"})]})})}):null,(0,s.jsx)(e_.Z,{className:"menu-settings",children:(0,s.jsx)(Q.Z,{sx:{padding:".5rem!important"},children:(0,s.jsxs)(e6.Z,{component:"div",sx:{p:0,color:"#fff"},children:[(0,s.jsx)(e8.ZP,{disablePadding:!0,onClick:y,children:(0,s.jsxs)(tS.Z,{children:[(0,s.jsx)(es.Z,{sx:{color:"#fff"},children:(0,s.jsx)(T.Z,{icon:"tabler:settings",fontSize:20})}),(0,s.jsx)(ei.Z,{primary:"C\xe0i đặt b\xe0i l\xe0m online",disableTypography:!0})]})}),(null==n?void 0:n.url)?(0,s.jsx)(e8.ZP,{disablePadding:!0,onClick:I("/p/leaderboard.html"),children:(0,s.jsxs)(tS.Z,{children:[(0,s.jsx)(es.Z,{sx:{color:"#fff"},children:(0,s.jsx)(T.Z,{icon:"tabler:checkup-list",fontSize:20})}),(0,s.jsx)(ei.Z,{primary:"Bảng điểm",disableTypography:!0})]})}):null,(null==n?void 0:n.url)?(0,s.jsx)(e8.ZP,{disablePadding:!0,onClick:I("/p/realtime.html"),children:(0,s.jsxs)(tS.Z,{children:[(0,s.jsx)(es.Z,{sx:{color:"#fff"},children:(0,s.jsx)(T.Z,{icon:"tabler:camera-bolt",fontSize:20})}),(0,s.jsx)(ei.Z,{primary:"Gi\xe1m s\xe1t thời gian thực",disableTypography:!0})]})}):null]})})})]})},sr=()=>{let e=(0,p.v9)(e=>e.quiz.quizs);return(0,s.jsxs)(N.ZP,{container:!0,spacing:3,children:[(0,s.jsx)(N.ZP,{item:!0,xs:12,md:4,children:(0,s.jsx)(si,{})}),(0,s.jsxs)(N.ZP,{item:!0,xs:12,md:8,children:[e.map(e=>(0,s.jsx)(se,{quizId:e.id},e.id)),(0,s.jsx)(ss,{}),(0,s.jsx)(n1,{})]})]})},sl=()=>{let e=(0,l.useRouter)(),[t,n]=(0,o.useState)("");switch((0,o.useEffect)(()=>{n(e.query.slug)},[e.query]),t){case"classes.html":return(0,s.jsx)(ev,{});case"exams.html":return(0,s.jsx)(eL,{});case"leaderboard.html":return(0,s.jsx)(tf,{});case"realtime.html":return(0,s.jsx)(tV,{});case"view-classes.html":return(0,s.jsx)(t1,{});case"create.html":return(0,s.jsx)(n2,{});case"chatbot.html":return(0,s.jsx)(sr,{})}return(0,s.jsx)(s.Fragment,{})};sl.getLayout=e=>(0,s.jsx)(a.Z,{customAppBar:(0,s.jsx)($,{}),children:e});var so=sl},1117:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});let s=n(8754),l=s._(n(7274));class o{static load(e){Object.assign(this,e)}}o.RENDER_SCALE=2,o.LINE_SMALL_HEIGHT=7*o.RENDER_SCALE,o.SPLIT_MARGIN=3*o.RENDER_SCALE,o.INTERSEC_MARGIN=20*o.RENDER_SCALE,o.LINE_MARGIN=2*o.RENDER_SCALE,o.MARGIN_LEFT=2*o.RENDER_SCALE,o.ENABLE_IMAGE_PROCESS=!0,o.STEP_SIZE=2,o.CROP_FULL_WIDTH=!0,o.OVERLAP=.5,o.QUESTION_PATTERN=[],o.QUESTION_PATTERN2=[],o.BREAK_LINE_PATTERN=[],o.SECTION_PATTERN_LOWER=[],o.SECTION_PATTERN_NORMAL=[],o.KICK_PATTERN=[],o.TVCN_CHAR=[],o.HET_PATTERN=[],o.DAPAN_PATTERN=[],o.HUONGDAN_PATTERN=[],o.MULTIPLE_ANS_PATTERN=[],o.DRAW_RESULT="",o.SKIP_CHAR=[],o.FOOTER_PATTERN=[],o.HELP_ANS_PATTERN=[],o.RES_ANS_PATTERN=[],o.FIX_NO_END_PATTERN=[],o.GROUP_TF_PATTERN=[];class a{}a.RENDER_SCALE=2,a.LINE_SMALL_HEIGHT=7*a.RENDER_SCALE,a.SPLIT_MARGIN=3*a.RENDER_SCALE,a.INTERSEC_MARGIN=20*a.RENDER_SCALE,a.LINE_MAGIN=2*a.RENDER_SCALE,a.MARGIN_LEFT=2*a.RENDER_SCALE,a.ENABLE_IMAGE_PROCESS=!0,a.STEP_SIZE=2,a.CROP_FULL_WIDTH=!0,a.OVERLAP=.5,a.QUESTION_PATTERN=[],a.QUESTION_PATTERN2=[],a.BREAK_LINE_PATTERN=[],a.SECTION_PATTERN_LOWER=[],a.SECTION_PATTERN_NORMAL=[],a.KICK_PATTERN=[],a.TVCN_CHAR=[],a.HET_PATTERN=[],a.DAPAN_PATTERN=[],a.HUONGDAN_PATTERN=[],a.MULTIPLE_ANS_PATTERN=[],a.DRAW_RESULT="",a.SKIP_CHAR=[],a.FOOTER_PATTERN=[],a.HELP_ANS_PATTERN=[],a.ANS_PATTERN=[];class c{addTask(e,t,n,s){if(this.is_running)return;var l=n||[];let o=this.queues.length;this.all_tasks++,this.queues.push({task:()=>new Promise(n=>{this.wrap_counter++,t.call(e,...l).then(e=>{this.wrap_counter_done++,this.callLog(s),n({status:!0,value:e,index:o})}).catch(e=>{this.wrap_counter_done++,this.callLog(s),n({status:!1,error:e,index:o})})}),name:s})}callLog(e){this.action_log_item&&this.all_tasks>0&&this.action_log_item.function.call({},this.wrap_counter_done,this.all_tasks,...this.action_log_item.params?this.action_log_item.params:[],e)}start(){return new Promise(e=>{0===this.queues.length&&e({datas:[],errs:[]}),this.result_common_temp={datas:[],errs:[]};for(let e=0;e<this.limit_one_process;e++){let e=this.queues.shift();if(!e)break;this.tasks.push(e)}this.count_task_root_done=0,this.is_running=!0,this.runner(e)})}checker(e,t){this.count_task_root_done++,e.status&&e.value?this.result_common_temp.datas.push({index:e.index,value:e.value}):e.error&&this.result_common_temp.errs.push({index:e.index,value:e.error}),this.result_common_temp.errs.length>0&&this.end_with_error&&(this.is_running=!1,t(this.makeResultObj())),this.count_task_root_done===this.all_tasks&&(this.is_running=!1,t(this.makeResultObj())),this.nextItem(t)}makeResultObj(){return{datas:this.result_common_temp.datas.sort(function(e,t){return e.index-t.index}).map(e=>e.value),errs:this.result_common_temp.errs.sort(function(e,t){return e.index-t.index}).map(e=>e.value)}}nextItem(e){let t=this.queues.shift();t&&t.task.call(this).then(t=>{this.checker(t,e)})}runner(e){this.tasks.length>0?this.tasks.forEach(t=>{t.task.call(this).then(t=>{this.checker(t,e)})}):(this.is_running=!1,e(this.makeResultObj()))}constructor(e,t,n,s){this.tasks=[],this.queues=[],this.is_running=!1,this.all_tasks=0,this.wrap_counter=0,this.wrap_counter_done=0,this.count_task_root_done=0,this.limit_one_process=e,this.result_common_temp={datas:[],errs:[]},this.action_log_item=t,this.delay_time=n||1e3,this.end_with_error=null!=s&&s}}e.exports={Constants:o,Utils:class{static capitalizeFirstLetter(e){return e.charAt(0).toUpperCase()+e.slice(1)}static tagLang(e){let t=new Map([["EASY","NB"],["MEDIUM","TH"],["HARD","VD"],["HARDEST","VDC"],["MC","TN"],["FB","ĐT"],["ES","TL"],["TF","ĐS"],["GR","NH"]]);return t.has(e)?t.get(e):e}static parseInclude(e){var t;let n=e.split("=>"),s=n.length>1?n[1]:-1,l=n[0],o,a=(l=l.replaceAll(/\[@([CTQGK][-\d]+):(:(user[_0-9]*)-)?[^\]]*\]/g,"$1:$3").replaceAll(/\[@(F:[^\]]*)\]/g,"$1").replaceAll(/\[[^\]\d]+(\d+)[^\]\d]+\]/g,"$1").replaceAll(/\[[^\]]+\]/g,"")).split("."),c=[],d=[],h=[],u=[],x=[],p=[],f=[],g=[],m=[],v=new Map([["EASY","NB"],["MEDIUM","TH"],["HARD","VD"],["HARDEST","VDC"],["MC","TN"],["FB","ĐT"],["ES","TL"],["TF","ĐS"],["GR","NH"]]),b=[];for(let e=a.length-1;e>=0;e--){let n=a[e].trim();if(/^\d*$/.test(n)){o=+n;continue}for(let e of n.split(",")){let n=e.split(":"),s=n[0],l=null!==(t=n[1])&&void 0!==t?t:"";if(/^G[-\d]+$/.test(s.trim()))c.push(+s.trim().substring(1));else if(/^Q[-\d]+$/.test(s.trim()))h.push(+s.trim().substring(1)),g.push(l),b.push({type:"QUEST",id:+s.trim().substring(1)});else if(/^C[-\d]+$/.test(s.trim())){let e=+s.trim().substring(1);u.push(e),p.push(l),b.push({type:""!=l?"SHARE":"CATEGORY",id:e})}else if(/^K[-\d]+$/.test(s.trim())){let e=+s.trim().substring(1);u.push(e),p.push(l),b.push({type:""!=l?"SHARE":"KNOWLEDGE",id:e})}else if(/^T[-\d]+$/.test(s.trim()))d.push(+s.trim().substring(1)),f.push(l),b.push({type:"EXAM",id:+s.trim().substring(1),groupIds:c});else if(e.trim().startsWith("F:")){let t=e.trim().substring(2);m.push(v.has(t)?v.get(t):t)}}if(b.length>0){if(m.length>0){let e=["TL","TN","ĐT","ES","MC","FB","TF","GR","ĐS","NH"];for(let t of b)t.tags=m.filter(t=>0>e.indexOf(t)),t.answerTypes=m.filter(t=>e.indexOf(t)>=0).map(e=>"TL"==e||"ES"==e?3:"TN"==e||"MC"==e?1:"ĐS"==e?5:"NH"==e?0:4)}break}}return h.length>0&&(o=h.length),x.push(...p),x.push(...f),x.push(...g),{paths:b,shareTypes:x,catId:u,examId:d,tag:m,groupId:c,questId:h,getNum:o,idx:s}}static getNumberFromStr(e){let t=e.match(/(\d+)/);return t?t[0]:""}static removeAccents(e){for(let t of["a\xe0ả\xe3\xe1ạăằẳẵắặ\xe2ầẩẫấậ","A\xc0Ả\xc3\xc1ẠĂẰẲẴẮẶ\xc2ẦẨẪẤẬ","dđ","DĐ","e\xe8ẻẽ\xe9ẹ\xeaềểễếệ","E\xc8ẺẼ\xc9Ẹ\xcaỀỂỄẾỆ","i\xecỉĩ\xedị","I\xccỈĨ\xcdỊ","o\xf2ỏ\xf5\xf3ọ\xf4ồổỗốộơờởỡớợ","O\xd2Ỏ\xd5\xd3Ọ\xd4ỒỔỖỐỘƠỜỞỠỚỢ","u\xf9ủũ\xfaụưừửữứự","U\xd9ỦŨ\xdaỤƯỪỬỮỨỰ","yỳỷỹ\xfdỵ","YỲỶỸ\xddỴ"]){let n=RegExp("["+t.substring(1)+"]","g");e=e.replace(n,t[0])}return e}static zeroPad(e,t){return(Array(e=e||2).join("0")+t).slice(-1*e)}},PdfConst:new a,Task:c,Image:class{cssStringToJSON(e){for(var t={},n=e.split(";"),s=0;s<n.length;s++){var l=n[s].split(":");if(2===l.length){var o=l[0].trim(),a=l[1].trim();t[o]=a}}return t}getStyle(e){let t=e.match(/style="([^"]*)"/);return t?t[1]:""}cropImage(){}start(e){this.callback=e,this.questions.forEach(e=>{var t,n,s;(null===(t=e.content)||void 0===t?void 0:t.includes("<img "))&&this.replaceImage(e,"content"),(null===(n=e.explain)||void 0===n?void 0:n.includes("<img "))&&this.replaceImage(e,"explain"),(null===(s=e.options)||void 0===s?void 0:s.find(e=>e.text.includes("<img ")))&&this.replaceImage(e,"options")}),this.imageMaps.forEach(e=>{this.taskConvertBase64ToCanvas.addTask(this,this.startConvertCanvas,[e])}),this.taskConvertBase64ToCanvas.start().then(e=>{if(e.errs.length>0)this.callback({error:e.errs});else{let t=0,n=[],s=()=>{let e=document.createElement("canvas");e.width=this.sizeDefaultCanvas,e.height=this.sizeDefaultCanvas;let t=e.getContext("2d");t&&(t.fillStyle="white",t.fillRect(0,0,this.sizeDefaultCanvas,this.sizeDefaultCanvas)),n.push({cdn:"",cX:0,cY:0,canvas:e,imgs:[]})};s(),e.datas.forEach((e,l)=>{var o=n[n.length-1];o.cX+e.canvas.width+4>this.sizeDefaultCanvas?(o.cX=4,o.cY+=t+4,t=0):o.cX+=4,o.cY+e.canvas.height>this.sizeDefaultCanvas&&(s(),o=n[n.length-1]);var a=o.canvas.getContext("2d");o.imgs.push({x:o.cX,y:o.cY,width:e.canvas.width,height:e.canvas.height,index:l,style:this.getStyle(e.base),url:e.canvas.toDataURL("image/png",1)}),null==a||a.drawImage(e.canvas,0,0,e.canvas.width,e.canvas.height,o.cX,o.cY,e.canvas.width,e.canvas.height),o.cX+=e.canvas.width,t=t<e.canvas.height?e.canvas.height:t}),n[0].imgs.length>0?(n.forEach(e=>{this.taskUploadImage.addTask(this,this.startUploadFile,[e])}),this.taskUploadImage.start().then(t=>{t.errs.length>0?this.callback({error:t.errs}):(t.datas.forEach(t=>{t.imgs.forEach(n=>{let s=e.datas[n.index];if(s){let e={link:t.cdn,data:{x:n.x,y:n.y,width:n.width,height:n.height,style:n.style}};s.objs.forEach(t=>{let l='<img class="quill-image"  data-value=\''.concat(JSON.stringify(e),"' style=\"").concat(n.style,'"/>');"options"===s.path?t[s.path]=t[s.path].map(e=>({...e,text:e.text.replace(s.base,l)})):t[s.path]=t[s.path].replace(s.base,l)})}})}),this.callback({success:this.questions}))})):this.callback({success:this.questions})}})}replaceImage(e,t){var n=e[t];"options"==t&&(n=e[t].map(e=>e.text).join(""));let s=n.matchAll(this.pattern_image);for(;;){let n=s.next();if(n.done)break;let[l]=n.value,[,o,a]=l.match(/data-value=(?:"([^"]*)"|'([^']*)')/)||[];o||a||this.imageMaps.push({base:l,data:null,objs:[e],path:t,canvas:document.createElement("canvas")})}}startConvertCanvas(e){return new Promise((t,n)=>{let s=new Image;s.crossOrigin="anonymous",s.onload=()=>{var n;let l=1;if(s.width>this.sizeDefaultCanvas&&(l=this.sizeDefaultCanvas/s.width),s.height>this.sizeDefaultCanvas){let e=this.sizeDefaultCanvas/s.height;e<l&&(l=e)}e.canvas.width=s.width*l,e.canvas.height=s.height*l,null===(n=e.canvas.getContext("2d"))||void 0===n||n.drawImage(s,0,0,s.width,s.height,0,0,e.canvas.width,e.canvas.height),t(e)},s.onerror=()=>{e.canvas.width=1,e.canvas.height=1;let n=e.canvas.getContext("2d");n&&(n.fillStyle="white",n.fillRect(0,0,1,1)),t(e)};let l=this.pattern_base64.exec(e.base);null!=l?s.src=l[0]:n(Error("lỗi regex"))})}startUploadFile(e){return new Promise(async(t,n)=>{let s=new FormData;s.append("image",this.dataURLtoFile(e.canvas.toDataURL("image/png",1)));let{data:o}=await l.default.post("/uploads",s,{headers:{"Content-Type":"multipart/form-data"}}),{error:a,url:c}=o;if(a)return t({...e,cdn:await this.canvasToBlobURL(e.canvas,"image/png",1)||""});t({...e,cdn:c})})}canvasToBlobURL(e,t,n){return new Promise(function(s,l){e.toBlob(function(e){e?s(URL.createObjectURL(e)):l("Kh\xf4ng thể chuyển đổi canvas th\xe0nh blob.")},t,n)})}dataURLtoFile(e){let t=this.getFileName(e);for(var n=e.split(","),s=n[0].match(/:(.*?);/),l=atob(n[1]),o=l.length,a=new Uint8Array(o);o--;)a[o]=l.charCodeAt(o);return new File([a],t,{type:s&&s.length>0?s[1]:"png"})}getFileName(e){var t=e.split("").reverse().join(""),n=t.indexOf(";"),s=t.indexOf("/",n);return t.substring(n,s).split("").reverse().join("")}constructor(e){this.questions=JSON.parse(JSON.stringify(e)),this.callback=()=>{},this.sizeDefaultCanvas=1100,this.actionRunAfterConvert=[],this.imageMaps=[],this.pattern_base64=/data:image[^"'\\]+/i,this.pattern_image=/<img[^>]+data:image[^>]+>/g,this.taskConvertBase64ToCanvas=new c(50,{function:(e,t)=>{this.callbackBase64ToCanvas&&this.callbackBase64ToCanvas(e,t)}}),this.taskUploadImage=new c(3,{function:(e,t)=>{this.callbackUploadImage&&this.callbackUploadImage(e,t)}})}},Version:"test"}},6781:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});let s=n(1117);class l{constructor(e,t){this.baseUnits=0,this.thousands=0,this.num=e,this.str=t}}let o={SectionSugg:()=>{},toArabic:e=>{var t;let n=e.toUpperCase();if(t=n,!/^M{0,4}(CM|CD|D?C{0,3})(XC|XL|L?X{0,3})(IX|IV|V?I{0,3})$/.test(t))return null;let s=[new l(1e3,"M"),new l(900,"CM"),new l(500,"D"),new l(400,"CD"),new l(100,"C"),new l(90,"XC"),new l(50,"L"),new l(40,"XL"),new l(10,"X"),new l(9,"IX"),new l(5,"V"),new l(4,"IV"),new l(1,"I")],o=0,a=0;for(;n.length>0&&a<s.length;){let e=s[a];n.startsWith(e.str)?(o+=e.num,n=n.substring(e.str.length)):a++}return n.length>0?null:o},isRoman:()=>{},toRoman:()=>{},RomanNumber:()=>{}},a=e=>{let t="z",n="abcdefghijklmnopqrstuvwxyz0123456789",s=n.length;for(let l=0;l<e;l++)t+=n.charAt(Math.floor(Math.random()*s));return t};class c{process(e){let t=/^\s*#(\d)\s*\[[A-Z0-9\-\[\]\$!:b]+\]/g,n=["NB","TH","VD","VDC"],s=0,l=!1,o=1;for(let a of e){let c=a.matchAll(t).next();if(!c.done){let t=+c.value[1]-1;t<n.length&&(e[s]=a.replace(c.value[0],"C\xe2u ".concat(o++,". (").concat(n[t],")"))),l=!0}l&&"GY"==a.trim()&&(e[s]="Lời giải"),s++}}}class d{process(e){let t=["(^c\xe2u\\s*\\d{1,4}[^0-9])","(^câu\\s*\\d{1,4}[^0-9])","(^c\xa9u\\s*\\d{1,4}[^0-9])","(^ca‚u\\s*\\d{1,4}[^0-9])","(^b\xe0i\\s*\\d{1,4}[^0-9])","(^bài\\s*\\d{1,4}[^0-9])","(^cau\\s*\\d{1,4}[^0-9])","(^bai\\s*\\d{1,4}[^0-9])","(^question\\s*\\d{1,4}[^0-9])","(^questions\\s*\\d{1,4}[^0-9])","(^\\[\\d{1,4}\\][^0-9])","(^\\d+\\s*\\(nb\\))","(^\\d+\\s*\\(th\\))","(^\\d+\\s*\\(vd\\))","(^\\d+\\s*\\(vdc\\))","(^c\xe2u\\s*\\d{1,4}[\\s\\.:]*$)","(^câu\\s*\\d{1,4}[\\s\\.:]*$)","(^c\xa9u\\s*\\d{1,4}[\\s\\.:]*$)","(^ca‚u\\s*\\d{1,4}[\\s\\.:]*$)","(^b\xe0i\\s*\\d{1,4}[\\s\\.:]*$)","(^bài\\s*\\d{1,4}[\\s\\.:]*$)","(^cau\\s*\\d{1,4}[\\s\\.:]*$)","(^bai\\s*\\d{1,4}[\\s\\.:]*$)","(^questions\\s*\\d{1,4}[\\s\\.:]*$)","(^question\\s*\\d{1,4}[\\s\\.:]*$)"],n=["(^(\\d+\\s*\\.)\\s*[\\.0-9])","(^(\\d+\\s*\\.)\\s*\\(\\s*\\d+\\s*\\))","(^(\\d+\\s*\\.)\\s*[^\\s]\\s*[^\\s0-9])","(^\\d+\\s*\\.\\s*$)"],l=["(HƯỚNG\\s*DẪN)","(ƯỚNG\\s*DẪN\\s*GIẢI\\s*CHI)","(GIẢI\\s*TH\xcdCH\\s*CHI\\s*TIẾT)","(Hướng\\s*dẫn\\s*giải)","(Lời\\s*giải)","(LỜI\\s*GIẢI)","(GIẢI\\s*CHI\\s*TIẾT)","(HD:)","(GLOSSARY)"],o=0,a=[],c=[];for(let d of e){let e=this.do(d,t,n);null!=e?(a.push({idx:o,val:s.Utils.capitalizeFirstLetter(e.olabel)}),c.push("q")):null!=(e=this.match(d,l))&&c.push("h"),o++}if(c.join("-").startsWith("q-h-q-h")){let t=1;for(let n of a)e[n.idx]=e[n.idx].replace(n.val,n.val.replace(/\d+/g,t+"")),t++}}do(e,t,n){let s=this.matchPos(e,t,n);if(s.value){let t=null;for(let e=s.value.length-1;e>=0;e--)if(s.value[e]){t=s.value[e];break}if(null==t)return null;let n=e.replace(/\|/g,"").toLowerCase().indexOf(t),l=n,o="",a=e.toLowerCase();for((t.endsWith("(")||t.endsWith("["))&&(t=t.substring(0,t.length-1));l<a.length&&("|"!=a[l]&&(o+=a[l]),l++,o!=t););return{pos:[n,l],olabel:t}}return null}matchPos(e,t,n){let s=e.replace(/\|/g,"").toLowerCase().trim(),l=t.join("|"),o=s.matchAll(l).next();return o.value||(l=n.join("|"),o=s.matchAll(l).next()),o}match(e,t){let n=e.replace(/\|/g,"").trim().match(t.join("|"));return null!=n&&n.length>0?{pos:[0,0],olabel:""}:null}}class h{readFileInputEventAsArrayBuffer(e,t){var n=new FileReader;n.onload=function(e){t(e.target.result)},n.readAsArrayBuffer(e)}handleFileSelect(e,t,n,l){let o=this,a=(e,t)=>{n&&n(e,t,"lang_auto_cong_thuc")},c=new s.Task(30,{function:n?(e,t)=>{n&&n(e,t,"lang_auto_image")}:()=>{}});this.readFileInputEventAsArrayBuffer(e,function(e){taodethiDocx.readDocx(e,a).then(function(e){for(let t of e.data)"img"==t.type&&("image/x-wmf"==t.contentType||"image/x-emf"==t.contentType?c.addTask(o,o.convert,[t]):t.value="data:"+t.contentType+";base64, "+t.value,!t.cssStyle&&t.height&&t.width&&"EMU"==t.measureUnit)&&(t.cssStyle="width:".concat(+t.width/12700,"pt;height:").concat(+t.height/12700,"pt;margin-top:0px;"));c.start().then(()=>{let n=new Map,s=0;for(let t of e.data)"img"==t.type&&t.cropInfo&&n.set(s,1),s++;if(t&&0==n.size)t(e);else for(let l of(s=0,e.data)){if("img"==l.type&&l.cropInfo){let a=s,c=document.createElement("img");c.src=l.value,c.onload=()=>{o.cropImage(l,c),n.delete(a),0==n.size&&t&&t(e)},c.onerror=()=>{n.delete(a),0==n.size&&t&&t(e)}}s++}})}).catch(e=>{l&&l(e.message)})})}convert(e){return new Promise(t=>{if("image/x-wmf"==e.contentType)e.value=this.wmf.toPNG("data:"+e.contentType+";base64, "+e.value),t();else{let s=new ToContext2D(0,1),l=this.decodeBase64(e.value);try{FromEMF.Parse(l,s)}catch(e){}var n=this.scaleCanvas(s.canvas,200,200);e.value=n.toDataURL(),t()}})}decodeBase64(e){return Uint8Array.from(atob(e),function(e){return e.charCodeAt(0)})}scaleCanvas(e,t,n){var s;let l=document.createElement("canvas");return l.width=t,l.height=n,null===(s=l.getContext("2d"))||void 0===s||s.drawImage(e,0,0,e.width,e.height,0,0,t,n),l}cropImage(e,t){var n;if(!e.cropInfo)return;let s=e.cropInfo.left?+e.cropInfo.left:0,l=e.cropInfo.top?+e.cropInfo.top:0,o=e.cropInfo.right?+e.cropInfo.right:0,a=e.cropInfo.bottom?+e.cropInfo.bottom:0;if(s+l+o+a==0)return;let c=t.width,d=t.height,h=s*c/1e5,u=l*d/1e5,x=c-o*c/1e5-h,p=d-a*d/1e5-u,f=document.createElement("canvas");f.width=x,f.height=p,null===(n=f.getContext("2d"))||void 0===n||n.drawImage(t,h,u,x,p,0,0,x,p),e.value=f.toDataURL()}constructor(e){this.commonService=e,this.wmf=new WMFConverter}}class u{setLines(e){this._lines=e}parse(e){return this._lstQuest=this.exParser.parse(this._lines,e,!1),this._lstQuest}constructor(e){this.conf=e,this._lstQuest=[],this._lines=[],this.singleMode=!1,this.exParser=new x(e)}}class x{setLang(e){this.lang=e,this.DEF_QUEST_NAME="vi"==e?"c\xe2u ":"question "}fixItems(e){let t=["(^b\xe0i\\s+\\d+)"],n=[],s=0,l=!1;for(let o of e)o.type==w.TYPE_NAME&&o.olabel&&(o.olabel.trim().match(t.join("|"))?n.push(s):l=!0),s++;if(l)for(let t of n)t+1<e.length&&e[t+1].type==w.TYPE_NAME&&(e[t].type=y.TYPE_NAME,e[t].pos=[0,0]);return e}parse(e,t,n){var l,a,c,d,h,u,x,p,v,b,C,T,I,P,S,N,Z,L,_,k,M,R,O;let H="__NO-SEC__";new f().fixNoEnd(e);let F=this.findItems(e,n);this.fixItems(F);let q=new Map,z=[],G=null,Y=0,W=H,U="main",$=0,V=0,Q=new Map,K=new Map,X=H;for(let t=0;t<F.length;t++){let n=F[t],o=t==F.length-1?void 0:F[t+1],P=this.getPartInfo(e,n,o);if(this.loadText(e,P),n.type==y.TYPE_NAME&&"main"==U&&(Y++,W=null!==(l=n.extInfo)&&void 0!==l?l:Y+"",z.push({label:Y,parts:P,answers:[],isGroup:!0})),n.type==w.TYPE_NAME){if(o&&o.type==E.TYPE_NAME&&o.pos[2]>0){let s;for(let e=t+1;e<F.length;e++)if(F[e].type!=E.TYPE_NAME){s=F[e];break}P=this.getPartInfo(e,n,s),this.loadText(e,P)}let s=n.label?+n.label:0,l=q.get(W+"--"+s);if(l&&"main"!=U){let e=P.map(e=>e.text).join("\n").trim();l.help&&1==e.split("\n").length&&0==l.answers.length?l.strAns=e.replaceAll(/\[![hcluib]+:\$([^\]]*)\$\]/g,"$1").trim():l.help=P,G=l}else"main"==U&&(l={label:s,olabel:n.olabel,answers:[],parts:P},Y>0&&(l.group=Y,l.extInfo=W),q.set(W+"--"+s,l),z.push(l),G=l)}if(n.type==E.TYPE_NAME&&G&&"main"==U){let t=!1;if(P.length>0){let n=e[P[0].lineIdx].replace(/\|/g,"").trim().match(s.Constants.MULTIPLE_ANS_PATTERN.join("|"));null!=n&&n.length>0&&(t=!0)}let l=""==n.olabel;n.pos[2]>0&&((P=[P[0]])[0].e=n.pos[2],this.loadText(e,P),l=!0);let o={label:null!==(a=n.label)&&void 0!==a?a:"",isCorrect:"*"==n.extInfo,parts:l?[P[0]]:P,isInline:l,olabel:n.olabel};G.answers.push(o),G.isFixAns=l||t}if(n.type==A.TYPE_NAME){if(n.label&&/\.\d*$/.test(n.label)){let e=n.label.split("."),t=+e[e.length-1],s=null!==(c=P[0].text)&&void 0!==c?c:"",l=null!==(d=K.get(s))&&void 0!==d?d:-1;if(l++,K.set(s,l),0==t){Y++,W=null!==(h=n.label)&&void 0!==h?h:"";let e=s+"=>"+l+"-0",t=[];t.push(...P),t[0]={lineIdx:P[0].lineIdx,s:0,b:0,text:e},z.push({label:Y,parts:t,answers:[],isGroup:!0});continue}let o=G?G.label:0,a=0;for(let e=0;e<t;e++){a++;let t=s+"=>"+l+"-"+e,n=[];n.push(...P),n[0]={lineIdx:P[0].lineIdx,s:0,b:0,text:t};let c={label:o+a,olabel:G?null===(u=G.olabel)||void 0===u?void 0:u.replace(/\d+/,o+a+""):this.DEF_QUEST_NAME+(o+a)+".",answers:[],parts:n};Y>0&&(c.group=Y,c.extInfo=W),q.set(W+"--"+c.label,c),z.push(c),G=c}}else if(n.label&&/\.Q\d+(,Q\d+)*$/.test(n.label)){let e=n.label.split(".").pop(),t=null!==(x=null==e?void 0:e.split(",").length)&&void 0!==x?x:0;for(let e=0;e<t;e++){let t={lineIdx:P[0].lineIdx,s:0,b:0,text:P[0].text+"=>0-"+e},n=G?G.label:0,s={label:n+1,olabel:G?null===(p=G.olabel)||void 0===p?void 0:p.replace(/\d+/,n+1+""):this.DEF_QUEST_NAME+(n+1)+".",answers:[],parts:[t]};Y>0&&(s.group=Y,s.extInfo=W),q.set(W+"--"+s.label,s),z.push(s),G=s}}}n.type==j.TYPE_NAME&&G&&(P.splice(0,1),o&&o.type==w.TYPE_NAME&&o.label&&!q.has(W+"--"+o.label)||!o||o.type==y.TYPE_NAME||o.type==g.TYPE_NAME?"main"==U&&(G.help=P):"main"==U&&(U="info",$=null!==(v=n.lineIdx)&&void 0!==v?v:0),$>0&&0==V&&(V=null!==(b=n.lineIdx)&&void 0!==b?b:0)),(n.type==g.TYPE_NAME||n.type==m.TYPE_NAME)&&(U="info",$=null!==(C=n.lineIdx)&&void 0!==C?C:0,Y=0),n.type==y.TYPE_NAME&&"info"==U&&W!=H&&(Y++,W=X=null!==(T=n.extInfo)&&void 0!==T?T:Y+""),n.type==f.TYPE_NAME&&(n.extInfo=X,Q.has(X)||Q.set(X,[]),null===(I=Q.get(X))||void 0===I||I.push(n))}let J=new f,ee=new Map;for(let t of Q){let n=J.getAnsMC(e,t[1]),s=null!==(P=(0,o.toArabic)(t[0]))&&void 0!==P?P:t[0];for(let e of n)ee.set(s+"--"+e[0],e[1])}let et=new Map;if($>0){let t=V>0?e.slice($,V):e.slice($);for(let e of J.getAnsStr(t)){let t=!1,n=+e[0].split("-")[1],s=H,l=0;for(let e=0;e<F.length;e++){let o=F[e];o.type!=g.TYPE_NAME&&o.type!=m.TYPE_NAME?o.type==y.TYPE_NAME&&t&&(null!==(S=o.lineIdx)&&void 0!==S?S:0)<$+n&&(l++,s=null!==(N=o.extInfo)&&void 0!==N?N:l+""):t=!0}let a=(0,o.toArabic)(s);a&&(s=a+""),et.set(s+"--"+e[0].split("-")[0],e[1])}}let en=[];for(let t of z){if(t.isGroup){en.push(t);continue}let n=null!==(Z=t.extInfo)&&void 0!==Z?Z:H,l=(null!==(L=(0,o.toArabic)(n))&&void 0!==L?L:n)+"--"+t.label,a=H+"--"+t.label,c=null!==(k=null!==(_=ee.get(l))&&void 0!==_?_:ee.get(a))&&void 0!==k?k:"",d=null!==(R=null!==(M=et.get(l))&&void 0!==M?M:et.get(a))&&void 0!==R?R:"",h="";t.help&&(h=null!==(O=J.getAnsFromHelp(t.help,e))&&void 0!==O?O:""),c.startsWith("!")&&(t.typeCode="TF");let u=c;if(""==u.trim()&&(u=h),""==u.trim()&&(u=d),t.answers.length>0){if(0==t.answers.filter(e=>e.isCorrect).length)for(let e of t.answers)/^!?[A-H,\s]+$/.test(u)&&u.indexOf(e.label.toUpperCase())>=0&&(e.isCorrect=!0);let n=t.answers.filter(e=>e.isCorrect).length;if(t.typeCode||(t.typeCode=n>1?"MC":"SC"),0==n&&""!=u&&"!"!=u){for(let n of(t.typeCode="FI",t.strAns=u,t.answers))for(let s of n.parts)s.s=s.b,this.loadText(e,[s]),t.parts.push(s);t.answers=[]}}else t.strAns=""==u&&t.strAns?t.strAns:u,t.typeCode||""==t.strAns||(t.typeCode="FI");if(t.typeCode||(t.typeCode="ES"),t.answers.length>0){if(")"==t.answers[0].olabel&&"a"==t.answers[0].label)t.typeCode="TF";else if(t.group){let e=en.filter(e=>e.label==t.group)[0];if(e){let n=e.parts.map(e=>e.text).join(" ").toLowerCase().match(s.Constants.GROUP_TF_PATTERN.join("|"));n&&n.length>0&&(t.typeCode="TF")}}}}this.metadata={res1:ee,res2:et};try{new B().run(z)}catch(e){}return z}static fixNoEnd(e){new f().fixNoEnd(e)}getPartInfo(e,t,n){var s,l;let o=null!==(s=t.lineIdx)&&void 0!==s?s:0,a=null!==(l=null==n?void 0:n.lineIdx)&&void 0!==l?l:e.length-1;if(o==a)return n?[{lineIdx:o,b:t.pos[0],s:t.pos[1],e:null==n?void 0:n.pos[0]}]:[{lineIdx:o,b:t.pos[0],s:t.pos[1]}];{let s=[];s.push({lineIdx:o,b:t.pos[0],s:t.pos[1]});for(let e=o+1;e<a;e++)s.push({lineIdx:e,b:0,s:0});if(n){let t=null==n?void 0:n.pos[0];""!=e[a].substring(0,t).replace(/\|/g,"").trim()&&s.push({lineIdx:a,b:0,s:0,e:t})}else s.push({lineIdx:a,b:0,s:0});return s}}loadText(e,t){for(let n of t)n.text=e[n.lineIdx].substring(n.s,n.e)}findItems(e,t){let n=["remove:q-s-a => 1","remove:s-s => 0","remove:h-h => 0","remove:h-a => 0","rmdup:a-a => void","remove:q-a:\\d+\\-[^A] => 0","remove:s-a:.+\\-[^A] => 0","remove:a-a:A\\-[^BC] => 0","remove:a-a:B\\-[^CD] => 0","remove:a-a:C\\-[^DB] => 0","remove:a-a:D\\-[^E] => 0","remove:a-a:E\\-[^F] => 0","remove:a-a-a:A-B\\-[^C] => 0","remove:a-a-a:A-C\\-[^B] => 0"];t&&(n=["remove:q-s-a => 1","remove:s-s => 0","remove:h-h => 0","remove:h-a => 0","remove:q-a:\\d+\\-[^A] => 0","remove:s-a:.+\\-[^A] => 0","remove:a-a:A\\-[^ABC] => 0","remove:a-a:B\\-[^ABCD] => 0","remove:a-a:C\\-[^ABCDE] => 0","remove:a-a:D\\-[^ADEF] => 0","remove:a-a:E\\-[^AEF] => 0"]);let s=[new C,new T,new b,new I],l=[{parser:new f,also:[2]},{parser:new y,from:[0],to:[1],also:[3]},{parser:new w,from:[0],to:[1],also:[3]},{parser:new E},{parser:new g,to:[2]},{parser:new m,to:[2],also:[6]},{parser:new j},{parser:new A,from:[0],to:[1]}],o=[{name:"start",expect:[1,2,7]},{name:"main",expect:[1,2,3,4,5,6,7]},{name:"info",expect:[0,1,2,6]}],a=o[0],c=[],d=0;for(let t of e)if(""!=t){for(let e of a.expect){let n=l[e],s=n.parser.parse(t);if(s.length>0){if(s.forEach(e=>e.lineIdx=d),c.push(...s),n.parser.TYPE==j.TYPE_NAME){let e=c.filter(e=>e.type==w.TYPE_NAME).length,t=c.filter(e=>e.type==j.TYPE_NAME).length,n=c.filter(e=>e.type==m.TYPE_NAME).length;if(a.name==o[1].name&&e>1&&0==t){a=o[2];let e=o[2].expect.indexOf(6);e>=0&&o[2].expect.splice(e,1)}else if(a.name==o[2].name){n>0&&l[0].parser.off();let e=o[2].expect.indexOf(6);e>=0&&o[2].expect.splice(e,1)}}if(n.to){let e=0;for(let t of n.to)(n.from&&o[n.from[e]]==a||!n.from)&&(a=o[t]),e++}if(n.also)for(let e of n.also){let n=c[c.length-1].pos[1],s=l[e].parser.parse(t.substring(n));s.length>0&&(s.forEach(e=>{e.lineIdx=d;for(let t=0;t<e.pos.length;t++)e.pos[t]=e.pos[t]+n}),c.push(...s))}break}}d++}else d++;let h=[];for(let e of n)for(let t of s){let n=t.load(e);if(n){h.push(n);break}}let u=0;for(;u<c.length;){for(let e of h){let t=c.length;if(e.run(c,u)){let e=t-c.length;e>0&&(u-=e+1);break}}u++}return c}constructor(e){this.DEF_QUEST_NAME="c\xe2u ",this.lang="vi",s.Constants.load(e)}}class p{on(){this.isOn=!0}off(){this.isOn=!1}parse(e){return this.isOn?this.do(e):[]}match(e,t){let n=e.replace(/\|/g,"").trim().match(t.join("|"));return null!=n&&n.length>0?[{type:this.TYPE,pos:[0,0]}]:[]}constructor(){this.isOn=!0,this.TYPE="default"}}class f extends p{do(e){let t=/^[0-9ABCDEFGH\u0110Sabcdefgh\u0111s]+$/i,n=this.cleanDS(e),l=this.cleanLine(n);if(this.cleanStyle(n).trim().match(s.Constants.HELP_ANS_PATTERN.join("|")),t.test(l)&&l.length>=2)return[{type:f.TYPE_NAME,pos:[0,0]}];t=/^\[\*(!!\d+!!:)?(\s*\d+[^\]|]+\|?)+\*\]$/i;let o=this.cleanLineKeepTable(n.trim());return o=o.replaceAll("\\|",""),t.test(o)&&l.length>=2?[{type:f.TYPE_NAME,pos:[0,0]}]:[]}fixNoEnd(e){let t=[new g,new m],n=[],l=0,o=-1;for(let a of e){if(""==a.trim()){l++;continue}for(let e of t){let t=e.parse(a);t.length>0&&n.push(...t)}let e=this.cleanDS(a);(e=this.cleanLineKeepTable(e)).trim().match(s.Constants.FIX_NO_END_PATTERN.join("|"))&&-1==o&&(o=l),l++}if(0==n.length&&o>=0){for(let t=o-1;t>=0;t--)if(!e[t].trim().startsWith("[*"))return e.splice(t+1,0,"Hết"),e}}cleanLine(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e;for(let e of(n=this.cleanStyle(n),[/\|/g,t?/[\s:;![\]@*$()]+/g:/[\s.\-:,;![\]@*$()]+/g,/C\xe2u/g,/C\xc2U/g,/\u0110\xe1p\xe1n/g,/\u0110\/A/g,/Question/g,/Questions/g,/question/g,/questions/g,/ch\u1ecdn/g,/Ch\u1ecdn/g,"–","−"]))n=n.replaceAll(e,"");return n.replaceAll("\\n","")}cleanLineKeepTable(e){let t=e;for(let e of(t=(t=t.replaceAll(/\[![!iucsbp]+:\$(([^$]|\$[^\]])+)\$\]/g,"$1")).replaceAll(/\[![!iucsbp]+:!!\]/g,""),[/C\xe2u/g,/C\xc2U/g,/\u0110\xe1p\xe1n/g,/\u0110\/A/g,/Question/g,/Questions/g,/question/g,/questions/g,/ch\u1ecdn/g,/Ch\u1ecdn/g,"–","−"]))t=t.replaceAll(e,"");return t.replaceAll("\\n","")}cleanDS(e){return e.replaceAll(/([a-d])[.),]\s*[\u0110\u0111]\xfang/g,"$1) Đ").replaceAll(/([a-d])[.),]\s*[Ss]ai/g,"$1) S")}pivotTable(e){let t=e.length,n=e[0].length,s=[];for(let l=0;l<n;l++){let n=[];for(let s=0;s<t;s++)n.push(e[s][l]);s.push(n)}return s}getAnsMC(e,t){var n;let l=[],o=[],a=[],c=new Map;for(let d of t){let t=e[null!==(n=d.lineIdx)&&void 0!==n?n:0];t=this.cleanDS(t);let h=this.cleanLine(t);if(/^\d+([a-dA-D][D\u0110S\u0111sd])+$/.test(h)){let e=s.Utils.getNumberFromStr(h),t=h.replace(e,"").replaceAll(/[a-dA-D][Ss]/g,"").replaceAll(/([a-dA-D])[\u0111\u0110Dd]/g,"$1").toUpperCase();c.set(+e,t)}if(o.push(t),t.trim().startsWith("[*")){let e=t.replace(/\[\*(!!\d+!!:)?/g,"").replace("*]","").replace(/\s\|\s/g,"|").trim();e=e.replaceAll("\\|","__//__").replaceAll("|","_##_").replaceAll("__//__","|"),a.push(e.split("_##_"))}else l.push(t)}let d=new Map;if(a.length>0){let e=0,t=0,n=/^([a-dA-D][D\u0110S\u0111sd])*$/,s=-1,l=!0,o=0;for(let e=0;e<a.length;e++){let t=a[e];for(let e=0;e<t.length;e++){let s=t[e],a=this.cleanLineKeepTable(s.trim()).match(/^(\d+)([.:,)])/i);if(!a){l=!1,d.clear();break}o=+a[1];let c=s.substring(s.indexOf(a[2])+1).trim();n.test(c)&&""!=c&&(c="!"+(c=c.replaceAll(/[a-dA-D][Ss]/g,"").replaceAll(/([a-dA-D])[\u0111\u0110Dd]/g,"$1").toUpperCase())),d.set(o,c)}if(!l)break}for(l&&c.size>0&&(e=a.length+1);e<a.length;){let l=!0;for(let n=0;n<a[e].length;n++){let s=+this.cleanLine(a[e][n]);if(0!=s){if(s-t!=1&&0!=t){l=!1;break}t=s}}if(l){if(s=e,++e>=a.length)break;for(let t=0;t<a[s].length;t++){let l=+this.cleanLine(a[s][t]),o=this.cleanLine(a[e][t]);n.test(o)&&""!=o&&(o="!"+(o=o.replaceAll(/[a-dA-D][Ss]/g,"").replaceAll(/([a-dA-D])[\u0111\u0110Dd]/g,"$1").toUpperCase())),d.set(l,o.startsWith("!")?o:a[e][t].trim())}e++}else{if(0==e){let n=!0;t=0;for(let e=0;e<a.length;e++){let s=+this.cleanLine(a[e][0]);if(0!=s){if(s-t!=1&&0!=t){n=!1;break}t=s}}if(n){a=this.pivotTable(a),e=0,t=0,s=-1;continue}break}{let t=!0;for(let l=0;l<a[e].length;l++){let o=this.cleanLine(a[e][l]);if(!n.test(o)){t=!1;break}{let e=+this.cleanLine(a[s][l]);""!=o&&(o=o.replaceAll(/[a-dA-D][Ss]/g,"").replaceAll(/([a-dA-D])[\u0111\u0110Dd]/g,"$1").toUpperCase()),d.set(e,d.get(e)+o)}}if(e++,!t){d.clear();break}}}}}for(let e of(0==d.size&&(l=o),d))c.set(e[0],e[1]);let h=[];for(let e of l){let t=this.cleanLine(e).trim();/(\d+[A-H])+/i.test(t)&&h.push(t)}let u=h.join(""),x=this.cleanLine(u);for(let e of this.getResultMC(x.toUpperCase()))c.set(e.num,e.str);return c}cleanStyle(e){let t=e;return(t=(t=t.replaceAll(/\[![!iucsbp]+:\$(([^$]|\$[^\]])+)\$\]/g,"$1")).replaceAll(/\[![!iucsbp]+:!!\]/g,"")).replaceAll(/\[\*(!!\d+!!:)?/g,"").replaceAll("*]","")}getAnsStr(e){let t=e.join("\n");t=this.cleanStyle(t),t=this.cleanDS(t);let n=this.getResultStr(t),s=new Map,l=/^([a-dA-D][\u0110S\u0111sDd])*$/;for(let e of n){let t=this.cleanLine(e.str);l.test(t)&&(e.str="!"+t.replaceAll(/[a-dA-D][Ss]/g,"").replaceAll(/([a-dA-D])[\u0111\u0110Dd]/g,"$1").toUpperCase()),s.set(e.num+"-"+e.lineIdx,e.str)}return s}getAnsFromHelp(e,t){var n,l;let o=[],a=/^([a-dA-D][\u0110S\u0111sDd])*$/;for(let n of e){let e=t[n.lineIdx];e=this.cleanStyle(e),""!=(e=this.cleanDS(e).trim())&&o.push(e)}o.length>1&&(o=[o[0],o[o.length-1]]);let c=0;for(let t of o){let o=t.trim().match(s.Constants.HELP_ANS_PATTERN.join("|")),d=2*s.Constants.HELP_ANS_PATTERN.length+1;if(null!=o)for(let t=0;t<d;t++){if(0==t||t%2>0)continue;let s=null===(n=o[t])||void 0===n?void 0:n.trim();if(null!=s){let t=0==c?0:e.length-1;e[t].text=null===(l=e[t].text)||void 0===l?void 0:l.replace(o[0],"");let n=this.cleanLine(s);return a.test(n)&&(s="!"+n.replaceAll(/[a-dA-D][Ss]/g,"").replaceAll(/([a-dA-D])[\u0111\u0110Dd]/g,"$1").toUpperCase()),s}}c++}return""}getResultStr(e){let t=[],n=e.replace(/\n/g,"\n"),l=s.Constants.QUESTION_PATTERN.join("|").replace(/\(\^/g,"("),o=n.matchAll(RegExp(l,"ig"));for(;;){let e=o.next();if(e.done)break;let t=e.value[0],l=s.Utils.getNumberFromStr(t);n=n.replace(t,l+".")}let a,c=s.Constants.RES_ANS_PATTERN.length>0?RegExp(s.Constants.RES_ANS_PATTERN.join("|"),"g"):/\d+[.-][^|0-9]/g,d=n.matchAll(c),h=-1;for(;;){let e=d.next();if(e.done)break;if(-1==h)h=e.value.index,a=e;else{let s=n.substr(h,e.value.index-h);t.push(this.toAns(s,a,this.getLineIdx(n,h))),h=e.value.index,a=e}}if(h>=0&&a){let e=n.substr(h);t.push(this.toAns(e,a,this.getLineIdx(n,h)))}return t}getLineIdx(e,t){return e.substring(0,t).split("\n").length-1}toAns(e,t,n){let s=t.value[0].length-1;return{num:+t.value[0].substr(0,s-1),str:e.substring(s).replace(/\s+/g," ").trim(),lineIdx:n}}getResultMC(e){let t=[],n="",s=[],l=!1;for(let t=0;t<e.length;t++){let o=e.charCodeAt(t),a=o>=65&&o<=72;if(a&&""==n)return[];a!=l&&(s.push(n),n=""),l=a,n+=e[t]}""!=n&&s.push(n);for(let e=1;e<s.length;e+=2){let n=0,l=Math.floor(s[e-1].length/s[e].length),o=+s[e-1].substring(n,l),a=o,c=!1;for(let d=0;d<s[e].length;d++){if(d>=s[e-1].length||(o=+s[e-1].substring(n,n+l))!=a){c=!0;break}t.push({num:o,str:s[e][d]}),n+=l,l=(a=o+1).toString().length}if(c){t=[];break}}if(0==t.length)for(let e=1;e<s.length;e+=2){let n=+s[e-1];if(e>1&&n!=t[t.length-1].num+1)return[];t.push({num:n,str:s[e]})}return t}constructor(e){super(),this.TYPE=f.TYPE_NAME,null!=e&&(this.isOn=e)}}f.TYPE_NAME="chitietdapan";class g extends p{do(e){return this.match(e,s.Constants.HET_PATTERN)}constructor(e){super(),null!=e&&(this.isOn=e),this.TYPE=g.TYPE_NAME}}g.TYPE_NAME="end";class m extends p{do(e){return this.match(e,s.Constants.DAPAN_PATTERN)}static getAnsFromHelp(e){for(let t of e){let e=t.replace(/\|/g,"").trim().match(s.Constants.HELP_ANS_PATTERN.join("|"));if(null!=e){for(let t of e)if(null!=t&&1==t.length)return t}}return""}constructor(e){super(),null!=e&&(this.isOn=e),this.TYPE=m.TYPE_NAME}}m.TYPE_NAME="dapan";class v{checkVal(e,t){var n;if(""==this.valPattern)return!0;let s=[];for(let l=Math.ceil(this.pattern.length/2);l>0;l--)s.push(null===(n=e[t-l+1].label)||void 0===n?void 0:n.trim());let l=s.join("-");return new RegExp(this.valPattern).test(l.toLocaleUpperCase())}getStack(e,t){let n="",s=t-10>=0?t-10:0;for(;s<=t;s++)n+="-"+e[s].type[0];return n}constructor(e,t){if(this.TYPE="",this.pattern="",this.valPattern="",this.data=[],this.TYPE=t,!e.startsWith(this.TYPE))return;let n=e.substring(this.TYPE.length).split("=>"),s=n[0].split(":");this.pattern=s[0].trim(),this.valPattern=s.length>1?s[1].trim():"",this.data=n[1].split(",").map(e=>e.trim())}}class b extends v{load(e){let t=new b(e);return""!=t.pattern?t:null}run(e,t){var n,l,o;if(""==this.pattern)return!1;let a=e[t];if(a.type[0]!=this.pattern)return!1;let c=[],d=[],h="";for(let n=0;n<t;n++){let t=e[n];(t.type==g.TYPE_NAME||t.type==m.TYPE_NAME)&&(h="da"),t.type==j.TYPE_NAME&&"da"==h&&(h="hd")}if("da"==h)return!1;for(let n=t-1;n>=0;n--){let t=e[n];if(t.type==g.TYPE_NAME||t.type==m.TYPE_NAME||"hd"==h&&t.type==j.TYPE_NAME||(t.type[0]==this.pattern&&t.olabel&&(c.push(t.olabel),d.push(t.label)),2==c.length))break}if(c.length>=1){let h=c[0],u=2==c.length?c[1]:h,x=null!==(n=a.olabel)&&void 0!==n?n:"";if("a"==this.pattern&&(""==h&&(h="."),""==u&&(u="."),""==x&&(x=".")),""==this.valPattern){if(h==u&&x!=h)return e.splice(t,1),!0}else for(let n of this.valPattern.split(",")){let c=n.trim(),p=new RegExp(s.Constants[c].join("|"));if(p.test(h)&&p.test(u)&&!p.test(x)&&+(null!==(l=d[0])&&void 0!==l?l:"0")+1!=+(null!==(o=a.label)&&void 0!==o?o:"0"))return e.splice(t,1),!0}}return!1}constructor(e){super(null!=e?e:"","same:")}}class C extends v{load(e){let t=new C(e);return""!=t.pattern?t:null}run(e,t){if(""==this.pattern)return!1;if(this.getStack(e,t).endsWith(this.pattern)&&this.checkVal(e,t)){for(let n of this.data)e.splice(t-+n,1);return!0}return!1}constructor(e){super(null!=e?e:"","remove:")}}class T extends v{load(e){let t=new T(e);return""!=t.pattern?t:null}run(e,t){if(""==this.pattern)return!1;if(this.getStack(e,t).endsWith(this.pattern)&&this.checkVal(e,t)){for(let n of this.data){let s=n.split(":"),l=t-+s[0],o=e[l].label;e[l].label=s[1],e[l].err=o+" -> "+s[1]}return!0}return!1}constructor(e){super(null!=e?e:"","modify:")}}class I extends v{load(e){let t=new I(e);return""!=t.pattern?t:null}run(e,t){var n,s;if(""==this.pattern)return!1;if(this.getStack(e,t).endsWith(this.pattern)){let l=null!==(n=e[t].score)&&void 0!==n?n:0,o=null!==(s=e[t-1].score)&&void 0!==s?s:0;if(e[t].label==e[t-1].label)return e.splice(l>o?t-1:t,1),!0}return!1}constructor(e){super(null!=e?e:"","rmdup:")}}class y extends p{do(e){let t=e.replace(/\|/g,""),n=(t=t.replaceAll(/\[![!ibuc]+:\$(([^$]|\$[^\]])+)\$\]/g,"$1")).toLowerCase().trim().match(s.Constants.SECTION_PATTERN_LOWER.join("|")),l=null!=n&&n.length>0;if(l||(l=null!=(n=t.trim().match(s.Constants.SECTION_PATTERN_NORMAL.join("|")))&&n.length>0),l&&n){let e,n=/\s+([0-9ABCDEFIVX]+)\s*[.:]/g,s=t.matchAll(n).next();return s.done&&(n=/\s+([0-9ABCDEFIVX]+)\s*$/g,s=t.matchAll(n).next()),s.done||(e=s.value[1]),[{type:this.TYPE,pos:[0,0],label:t,extInfo:e}]}return[]}constructor(e){super(),null!=e&&(this.isOn=e),this.TYPE=y.TYPE_NAME}}y.TYPE_NAME="section";class w extends p{do(e){let t=this.matchPos(e);if(t.value){let n=null;for(let e=t.value.length-1;e>=0;e--)if(t.value[e]){n=t.value[e];break}if(null==n)return[];let s=e.replace(/\|/g,"").toLowerCase().indexOf(n),l=s,o="",a=e.toLowerCase();for((n.endsWith("(")||n.endsWith("["))&&(n=n.substring(0,n.length-1));l<a.length&&("|"!=a[l]&&(o+=a[l]),l++,o!=n););let c={type:this.TYPE,pos:[s,l]};return c.label=this.getNumberFromStr(e.substring(c.pos[0],c.pos[1])),c.olabel=n,[c]}return[]}matchPos(e){let t=e.replace(/\|/g,"").toLowerCase().trim(),n=s.Constants.QUESTION_PATTERN.join("|"),l=t.matchAll(n).next();return l.value||(n=s.Constants.QUESTION_PATTERN2.join("|"),l=t.matchAll(n).next()),l}getNumberFromStr(e){let t=e.match(/(\d+)/);return t?t[0]:""}constructor(e){super(),null!=e&&(this.isOn=e),this.TYPE=w.TYPE_NAME}}w.TYPE_NAME="question";class E extends p{do(e){var t;let n=[],s="|"+e,l=/([\s|.\]]+\*?[A-Ha-h][\s|]*[.)])/g,o=this.matchPos(s,l,!1);0==o.length&&(o=this.matchPos(s,l,!0));let a=!1;0==o.length&&/^\|?\s*\*?[A-H\s|]+$/g.test(s)&&(a=!0,o=this.matchPos(s,/\*?[A-H]/g,!1));let c=!1;if(0==o.length&&(a=!0,c=!0,o=this.matchPos(s,/\[\*?[A-H]:[^\]]+\]/g,!1)),o.length>0)for(let l of o){let o=l.index+l.value.length-1,d=-9999,h=l.value.replace(/\*?[\sA-Ha-h|]/g,"");c&&(d=l.index+l.value.length-2,l.index=l.index+1,o=l.index+1+(l.value.startsWith("[*")?1:0),h=".");let u={type:this.TYPE,pos:[l.index-1,o,d]},x=e.substring(u.pos[0]);if(!a&&!/^\|?\s*[*A-Himg\s|.]+$/g.test(s)&&x.trim()==l.value.trim())continue;u.label=e.substring(u.pos[0],u.pos[0]+1),"*"==u.label&&(u.label=e.substring(u.pos[0]+1,u.pos[0]+2),u.extInfo="*"),u.olabel=h,u.score=1,""==e.substring(0,u.pos[0]).replace(/[\s|]/g,"")&&(u.score=2);let p=e.replace(/\[![a-z0-9_]+:[a-z0-9_]+\]/g,"").trim().toUpperCase().replace("*",""),f=RegExp("^A\\s*"+(null===(t=u.olabel)||void 0===t?void 0:t.replace(/([.)])/,"\\$1")));(c||"A"!=u.label.toUpperCase()||f.test(p))&&n.push(u)}return n}matchPos(e,t,n){let s=n?e.toUpperCase():e,l=/[\s|.\]]/,o=s.matchAll(t),a=[];for(;;){let e=o.next();if(e.done)break;let t=0;for(let n=e.value.index;n<s.length&&l.test(s[n]);n++)t++;let n=e.value[0].substr(t,1),c=/[[(]\s*(VD|TH|NB|VDC|EASY|MEDIUM|HARD|HARDEST)\s*[\d.]*\s*[)\]]\s*[:.]?/g,d=/\[![a-z]+:\$\s*\$\]/g;("A"!=n||s.replace(/\|/g,"").replace(/\[!info:\d+\]/g,"").replace(c,"").replace(d,"").trim().startsWith("A"))&&("*A"!=n||s.replace(/\|/g,"").replace(/\[!info:\d+\]/g,"").replace(c,"").replace(d,"").trim().startsWith("*A"))&&a.push({value:e.value[0].substr(t),index:e.value.index+t})}return a}constructor(e){super(),null!=e&&(this.isOn=e),this.TYPE=E.TYPE_NAME}}E.TYPE_NAME="answer";class j extends p{do(e){return this.match(e,s.Constants.HUONGDAN_PATTERN)}constructor(e){super(),null!=e&&(this.isOn=e),this.TYPE=j.TYPE_NAME}}j.TYPE_NAME="huongdan";class A extends p{do(e){let t=e.replace(/\|/g,"").trim();if(/^\[@[^!\]]+\]([\.,]\[[^\]!]+\])*$/.test(t)){let e=t;return e=e.replaceAll(/\[@([CTQG]\d+):[^\]]*\]/g,"$1").replaceAll(/\[@(F:[^\]]*)\]/g,"$1").replaceAll(/\[[^\]\d]+(\d+)[^\]\d]+\]/g,"$1").replaceAll(/\[[^\]]+\]/g,""),[{type:this.TYPE,pos:[0,0],label:"@@."+e}]}return[]}constructor(e){super(),null!=e&&(this.isOn=e),this.TYPE=A.TYPE_NAME}}A.TYPE_NAME="include";class P{setLoadingManager(e){this.loadingManager=e}loadImage(e,t){return new Promise((n,s)=>{let l=a(10);this.loadingManager.set(l,e),(0,r.dr)(e,t).then(e=>{n(e),this.loadingManager.delete(l)}).catch(()=>{this.loadingManager.delete(l),s(Error())})})}loadImageToBase64(e,t){return new Promise((n,s)=>{let l=new Image;l.crossOrigin="anonymous",l.setAttribute("count","1");let o=a(10);this.loadingManager.set(o,e),l.onload=()=>{var e;let t=document.createElement("canvas");t.width=l.width,t.height=l.height,null===(e=t.getContext("2d"))||void 0===e||e.drawImage(l,0,0,l.width,l.height,0,0,t.width,t.height);let s=this.isCropImage?i.rj.cropCanvas(t):t;n("<img id='".concat(o,"' class='img-docx' alt='error...' src='").concat(s.toDataURL(),"' style='width: ").concat(s.width*this.ratioImage,"px;height: auto'>")),this.loadingManager.delete(o)},l.onerror=()=>{this.loadingManager.delete(o);let n=l.getAttribute("count");n&&1==Number(n)?(l.src=null!=e?e:t.getMyCdn(e),l.setAttribute("count","2")):n&&5>Number(n)?(l.setAttribute("count",n+1),l.src=null!=e?e:t.getMyCdn(e)+"?t="+new Date().getTime()):s(Error())},l.src=null!=e?e:t.getMyCdn(e)})}constructor(){this.isCropImage=!0,this.loadingManager=new Map,this.ratioImage=.65}}class S extends P{findAttributes(e){let t={content:"",attr:[]};return t.content=e.replace(/(\w+)=["']?((?:.(?!["']?\s+=|\s*\/?[>"']))+.)["']?/g,e=>{let n=(0,Vo.Z)();return t.attr.push({key:n,value:e}),n}),t}processMapException(e,t){return t.forEach(t=>{e=e.replace(t.key,t.value)}),e}render(e,t,n){if(e.trim().startsWith("[@"))return e;let s=this.findAttributes(e),l=e=s.content,o=this.chemBase.join("|"),a=RegExp("(?:[\\s,.:;\"'=–\\-\\/\\+\\?<>]|^)\\(?\\d*(".concat(o,")+\\d*(").concat(o,"|\\d+|\\(|\\))*(?:(?=[\\s,.:;\"'=–\\-\\/\\+\\?<>])|\\(\\w+\\)|$)"),"g"),c=l.matchAll(a),d=[];for(;;){let e=c.next();if(e.done)break;let t=0==e.value.index?e.value[0]:e.value[0].substring(1);t.replace("(","").replace(")","").length<=1||d.push({s:0==e.value.index?0:e.value.index+1,len:t.length,val:this.autoFormat(t)})}if(d.sort((e,t)=>e.s>t.s?-1:1),d.filter(e=>/\d+/.test(e.val)).length>0)for(let e of d)l=l.substring(0,e.s)+"\\("+e.val+"\\)"+l.substring(e.s+e.len);return this.processMapException(l,s.attr)}autoFormat(e){return e.replaceAll(/([^\(])(\d+)/g,"$1_{$2}")}constructor(){super(...arguments),this.chemBase=["H","He","Li","Be","B","C","N","O","F","Ne","Na","Mg","Al","Si","P","S","Cl","Ar","K","Ca","Sc","Ti","V","Cr","Mn","Fe","Co","Ni","Cu","Zn","Ga","Ge","As","Se","Br","Kr","Rb","Sr","Y","Zr","Nb","Mo","Tc","Ru","Rh","Pd","Ag","Cd","In","Sn","Sb","Te","I","Xe","Cs","Ba","La","Ce","Pr","Nd","Pm","Sm","Eu","Gd","Tb","Dy","Ho","Er","Tm","Yb","Lu","Hf","Ta","W","Re","Os","Ir","Pt","Au","Hg","Tl","Pb","Bi","Po","At","Rn","Fr","Ra","Ac","Th","Pa","U","Np","Pu","Am","Cm","Bk","Cf","Es","Fm","Md","No","Lr","Rf","Db","Sg","Bh","Hs","Mt","Ds","Rg","Cn","Nh","Fl","Mc","Lv","Ts","Og"]}}class N extends P{render(e,t,n){if(0>e.indexOf("[img:"))return e;let s=e,l=s.matchAll(/\[img:\$[a-zA-Z0-9_]+\$\]/g);for(;;){let e=l.next();if(e.done)break;let n=e.value[0],c=n.replace("[img:$","").replace("$]","");if(t){let e=t.find(e=>e.id===c);if(e){var o;let t=document.createElement("img");t.id=c,t.classList.add(0===c.indexOf("af")?"qv_full_a_img":0===c.indexOf("f")?"qv_full_img":"qv_img"),t.crossOrigin="anonymous",t.style.cssText=(null!==(o=e.cssStyle)&&void 0!==o?o:"").replace(/position:[^;]+;?/gi,"");let l=a(10),d=e.link;this.loadingManager.set(l,d),t.onload=()=>{this.loadingManager.delete(l)},t.onerror=()=>{this.loadingManager.delete(l)},t.src=d,s=s.replace(n,t.outerHTML)}}}return s}constructor(e){super(),this.cdnService=e}}class Z extends P{render(e,t,n){let s=e,l=s.matchAll(/\[\*?[A-H]:[^\]]+\]/g);for(;;){let e=l.next();if(e.done)break;let t=e.value[0],n=t.substring(1,t.length-1).split(":");2==n[0].length&&(n[0]=n[0].substring(1)),s=s.replace(t,"<span class=\"qv_string_eng_ans\" style='cursor: pointer;padding: 0 5px;font-weight: bold;text-decoration: underline;position: relative;height: 40px;display: inline-block;'>".concat(n[1]," <span style='position: absolute;top: 20px;left: 45%;'>").concat(n[0],"</span></span>"))}return s}revert(e,t){let n=e;return(n=n.replaceAll(/<span class="qv_string_eng_ans"[^>]+>([^><]+)<span[^>]+>([^><]+)<\/span><\/span>/g,"[$2:$1]")).replace("["+t+":","[*"+t+":")}}class L extends P{trimWithBr(e){for(e=e.trim();/^<br>|<br>$/.test(e);)e=e.replace(/^<br>|<br>$/,"").trim();return e}render(e){let t=e,n=t.split("<br>"),s=0,l=/\[![!aibucsbphl]+:!!\]/;for(let e of n){if(l.test(e)){let t=e.split(":!!]")[0].split("["),o=t[t.length-1].split(":")[0];n[s]=e.startsWith("[*")?"[* ["+o+":$"+e.replace(l,"$]").substring(2):"["+o+":$"+e.replace(l,"$]")}s++}let o=(t=(t=n.join("<br>")).replaceAll(/\[![!aibucsbphl]+:\$\$\]/g,"")).matchAll(/\[![!aibucsbphl]+:\$(([^\$]|\$[^\]])+)\$\]/g);for(;;){let e=o.next();if(e.done)break;let n=e.value[0],s=e.value[1],l=n.split(":")[0].split("!");l.shift(),l.filter(e=>"a"==e).length>0&&(s=s.toUpperCase());for(let e=l.length-1;e>=0;e--){let t=l[e];s="hl"==t||"cl"==t?s:"<".concat(t,">").concat(s,"</").concat(t,">")}t=t.replace(n,s)}return this.trimWithBr(t)}}class _ extends P{render(e,t,n){let s=e;for(let e of[[/([^<])-+([^\-><]+)-+>/g,"$1\\( \\xrightarrow[]{$2} \\)"],[/<-+([^\-><]+)-+([^>])/g,"\\( \\xleftarrow[]{$1} \\)$2"],[/([^<])--+>/g,"$1\\( \\longrightarrow \\)"],[/<--+([^>])/g,"\\( \\longleftarrow \\)$1"],[/<-+>/g,"\\( \\longleftrightarrow \\)"],[/([^<])->/g,"$1\\( \\rightarrow \\)"],[/<-([^>])/g,"\\( \\leftarrow \\)$1"]])s=s.replaceAll(e[0],e[1]);return s}}class k extends P{render(e,t,n){let s=e.split("<br>"),l=[],o=[];for(let e of s){let t=e.replaceAll("\\|","__//__");if(t.trim().startsWith("[*")&&t.trim().endsWith("*]")){let e=t.replaceAll("\\n","<br>").replaceAll("[*","<tr><td>").replaceAll("*]","</td></tr>");e=e.replaceAll("|","</td><td>"),o.push(e)}else o.length>0&&(l.push('<table class="q-table">'+o.join("")+"</table>"),o=[]),l.push(t)}return o.length>0&&l.push('<table class="q-table">'+o.join("")+"</table>"),l.join("<br>").replaceAll("__//__","|")}static revert(e){let t=new DOMParser().parseFromString(e,"text/html").documentElement.querySelectorAll(".q-table"),n=e;for(let e=0;e<t.length;e++){let s=t[e],l=s.outerHTML,o=s.querySelectorAll("tr"),a=[];for(let e=0;e<o.length;e++){let t=[],n=o[e].querySelectorAll("td");for(let e=0;e<n.length;e++)t.push(n[e].innerHTML.trim());a.push(t)}let c=[];for(let e of a)c.push("[* "+e.join(" | ")+" *]");let d=c.join("\n");n=n.replace(l,d)}return n}}class M extends P{convertMath(e){var t=e.replace(/\>(log|tan)\</g,">\\$1<").replace(//g,"");return MathML2LaTeX.convert(t)}render(e,t,n){let s=e,l=s.matchAll(/\[!m:\$(([^\]]|[^\$]\])+)\$\]/g);for(;;){let e=l.next();if(e.done)break;let t=e.value[0],n=e.value[1],o=this.mathMap.get(n),a="",c=document.createElement("span");c.classList.add("ql-formula"),c.setAttribute("data-value",this.convertMath(o.str)),a=c.outerHTML,s=s.replace(t,a)}return s}constructor(e,t){super(),this.mathMap=e,this.commonService=t}}class R extends P{render(e,t,n){return this.bypassChild(e).replaceAll(/\\\)\s*\\\(/g,"")}bypassChild(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"\\(",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"\\)";if(t.length!==n.length)return"";let s=[],l=0;for(;;){let n=e.indexOf(t,l);if(-1===n)break;s.push("s_"+n),l=n+1}for(l=0;;){let t=e.indexOf(n,l);if(-1===t)break;s.push("e_"+t),l=t+1}s.sort(function(e,t){return parseInt(e.substr(2))-parseInt(t.substring(2))});let o=[],a=[];return s.forEach(e=>{if("s"===e.substring(0,1))o.push(parseInt(e.substring(2)));else if(1==o.length)o=[];else{let t=o.pop();if(t){let n=parseInt(e.substring(2));a.push(t),a.push(n)}}}),a.sort(function(e,t){return e-t}).reverse().forEach(n=>{e=e.substring(0,n)+e.substring(n+t.length)}),e}}class O extends P{render(e,t,n){var l,o,c,d;let h=e.split("<br>")[0].trim(),u=h.split("=>"),x=u.length>1?+u[1].split("-")[1]:0,p=u.length>1?+u[1].split("-")[0]:0;if(!this.callBack||!/^\[@[CTGK][\-\d]+:[^\]]+\]([\.,]\[[^\]]+\])+$/.test(u[0].trim())&&!/^\[@Q[\-\d]+:[^\]]+\](\s*,\s*\[@Q[\-\d]+:[^\]]+\])*$/.test(u[0].trim()))return e;let f=u[0]+"=>"+p,g=s.Utils.parseInclude(h);if(this.apiDataCache){let e=this.apiDataCache.get(h);if(e&&this.callBack)return setTimeout(()=>{e&&this.callBack&&this.callBack(e)},50),"Loading...|"+g.questId.join(",")}if(this.apiCallbackCache){let e={i:x,call:this.callBack,err:this.onError},t=this.apiCallbackCache.get(f);if(t)return t.push(e),"Loading...|"+g.questId.join(",");this.apiCallbackCache.set(f,[e])}let m=this.loadedQuestIds&&0==g.questId.length?this.loadedQuestIds:[];0==g.getNum&&g.groupId.length>0&&(g.getNum=1,m=g.questId.length>0?m:[]),this.getOne&&g.getNum&&g.getNum>1&&(g.getNum=1);let v=a(10);if(null===(l=this.matrixData)||void 0===l?void 0:l.filter(e=>e.key==f)[0])setTimeout(()=>{},400);else{this.loadingManager.set(v,h);let e={exceptQuestionIds:m,matrix:[]};null===(o=e.matrix)||void 0===o||o.push({number:g.getNum,key:f,paths:g.paths.map(e=>({type:e.type,id:e.id,groupIds:e.groupIds,tags:e.tags,answerTypes:e.answerTypes}))});let t=(null===(c=e.matrix)||void 0===c?void 0:c.filter(e=>{var t;return null!==(d=null===(t=e.paths)||void 0===t?void 0:t.filter(e=>"KNOWLEDGE"==e.type).length)&&void 0!==d&&d}).length)?null==n?void 0:n.apiQuestionsMatrixGlobalPost(e):null==n?void 0:n.apiQuestionsMatrixPost(e);t&&t.subscribe(e=>{1===e.success&&e.data&&e.data[0]&&e.data[0].questions&&e.data[0].questions.length>0&&e.data[0].questions,setTimeout(()=>{},400),this.loadingManager.delete(v)})}return"Loading...|"+g.questId}processImageQuestion(e,t,n){let s=t[0].metaData;if(s){let t={x:0,y:0,w:s.question.width,h:s.question.height},l=s.question.height;s.answers&&s.answers.forEach((s,o)=>{let a="";if(1!==s.width||1!==s.height){let n=this.cropImageWithPos({x:s.x,y:s.y,w:s.width,h:s.height},{x:s.remove.x,y:s.remove.y,w:s.remove.width,h:s.remove.height},e);n.classList.add("qv_ats_image"),l>s.y&&(t.h=s.y,l=s.y),a=n.outerHTML}n.answers.push({renderedStr:a,ans:n.quest.answers[o]})}),t.h<5&&(t.h=1,t.h=1);let o=this.cropImageWithPos(t,{x:s.question.remove.x,y:s.question.remove.y,w:s.question.remove.width,h:s.question.remove.height},e,!0);o.classList.add("qv_qts_image"),n.renderedStr=o.outerHTML,n.meta&&(n.meta.heightLabel=this.calculateHeightLabel(e,s.question.remove))}else n.renderedStr=e.outerHTML}cropImageWithPos(e,t,n,s,l){let o=document.createElement("canvas");o.width=e.w,o.height=e.h;let a=o.getContext("2d"),c=document.createElement("img");null==a||a.drawImage(n,e.x,e.y,e.w,e.h,0,0,e.w,e.h),a&&(a.fillStyle="#fff"),null==a||a.fillRect(t.x-e.x,t.y-e.y,t.w,t.h);let d=jr.rj.cropCanvas(o,void 0);return l?d:(c.src=d.toDataURL(),c.style.width=d.width*this.ratioImage+"px",c)}calculateHeightLabel(e,t){return this.cropImageWithPos({x:t.x,y:t.y,w:t.width,h:t.height},{x:0,y:0,w:0,h:0},e,!1,!0).height}constructor(e,t,n,s,l,o,a,c,d,h){var u;super(),this.cdnService=e,this.commonService=t,this.callBack=n,this.apiCallbackCache=s,this.editor=l,this.onError=o,this.loadedQuestIds=a,this.apiDataCache=c,this.matrixData=d,this.discoveryService=h,this.getOne=!1,this.trans={err_empty_quest:""},u="lang_auto_khong_tai_duoc_cau_hoi_tu_ngan_hang",this.trans.err_empty_quest=void 0!==u?u:""}}class H extends P{render(e,t,n,s){if(0>e.indexOf("@[]"))return s&&s(),e;let l,o=/@\[\]\{[^@]+\}@\[\]/g,c=e,d=new Map;for(;null!==(l=o.exec(e));){var h;let e=l[0],t=e.split("@[]")[1],n=this.commonService.willDeleteParseJson(t),s=n.link,o=a(10);c=c.replace(e,"<div id='".concat(o,"' class='img-docx skeleton-box-loading' style='width: ").concat(n.data.width*this.ratioImage,"px;height: ").concat(n.data.height*this.ratioImage,"px'></div>")),d.has(s)?null===(h=d.get(s))||void 0===h||h.push({id:o,data:n.data}):d.set(s,[{id:o,data:n.data}])}return this.startLoadImage(d).then(()=>{s&&s()}).catch(e=>{this.callbackFall&&this.callbackFall(e)}),c}startLoadImage(e){return new Promise((t,n)=>{var s=0;e.size>0?e.forEach((l,o)=>{this.loadImage(o,this.cdnService).then(o=>{if(this.processImageQuestion(o,l,n),this.loadingManager.delete(o.id),this.callBack)for(let e of l)this.callBack(e.id,e.renderStr);++s===e.size&&t()}).catch(()=>{let e=o.split("/");n(new r.l("LOAD_IMAGE",[e[e.length-1]],"lang_testbank_render_cant_download_the_image"))})}):t()})}processImageQuestion(e,t,n){t.forEach(t=>{try{var s;let n=document.createElement("canvas");t.data.width=-1===t.data.width?e.width:t.data.width,t.data.height=-1===t.data.height?e.height:t.data.height,n.width=t.data.width,n.height=t.data.height,null===(s=n.getContext("2d"))||void 0===s||s.drawImage(e,t.data.x,t.data.y,t.data.width,t.data.height,0,0,n.width,n.height);let l=this.isCropImage?i.rj.cropCanvas(n):n;l=this.isCanvasEmpty(l)?n:l,t.renderStr="<img id='".concat(t.id,"' class='img-docx' alt='error...' src='").concat(l.toDataURL(),"' style='width: ").concat(l.width*this.ratioImage,"px;height: auto'>")}catch(s){let t=e.src;return void n(new r.l("CROP_IMAGE",[t[t.length-1]],"Kh\xf4ng cắt được nội dung trong h\xecnh ảnh"))}})}isCanvasEmpty(e){let t=document.createElement("canvas");return t.width=e.width,t.height=e.height,e.toDataURL()===t.toDataURL()}constructor(e,t,n,s,l){super(),this.cdnService=e,this.commonService=t,this.configRenderService=n,this.callBack=s,this.callbackFall=l}}class B{run(e){for(let t of e)for(let e of(t.error=[],this.lstChecker)){let n=e.check(t);t.error.push(...n)}}constructor(){this.lstChecker=[new q]}}class F{}class q extends F{check(e){return"SC"!=e.typeCode&&"MC"!=e.typeCode||0!=e.answers.filter(e=>e.isCorrect).length?[]:[{type:"NO_ANS",msg:"ERR_NO_CORRECT_ANS",quickFix:["Bấm v\xe0o A, B, C hoặc D để chọn l\xe0m đ\xe1p \xe1n đ\xfang"]}]}}e.exports=class{parseDocx(e){this.getLstQuestWithFile(e,[]).then(e=>{console.log(e),this.convertDocx(e)})}convertDocx(e){let{lstQuest:t}=e,n=[],s=[];t.forEach((e,t)=>{let{quest:l}=e;if(l.isGroup)n.push({id:a(7),quizId:this.quizId,questions:[],content:e.renderedStr,title:"",audios:[]});else{var o,c,d,h,u,x,p,f,g,m;n.length||l.group||n.push({id:a(7),quizId:this.quizId,questions:[],content:"",title:"",audios:[]});let t=n[l.group-1||0],v={id:a(7),content:null!==(h=e.renderedStr)&&void 0!==h?h:"",quizId:this.quizId,groupId:t.id,label:"C\xe2u",number:l.label,type:(e=>{switch(e){case"MC":return"HK";case"SC":return"TN";case"FI":return"DT";case"ES":break;case"TF":return"TF"}return"TL"})(null!==(u=null==l?void 0:l.typeCode)&&void 0!==u?u:""),options:e.answers.map(e=>{var t;return{text:null!==(t=e.renderedStr)&&void 0!==t?t:"",keys:e.ans.isCorrect}}),explain:null!==(x=e.helpRenderedStr)&&void 0!==x?x:"",level:e.tag,shuffle:!!l.isFixAns};"DT"==v.type&&(v.options=(null!==(p=null==e?void 0:e.strAns)&&void 0!==p?p:[]).map(e=>({text:null==e?void 0:e.toString().trim()}))),"TF"==v.type&&(v.options=null===(f=e.answers)||void 0===f?void 0:f.map(e=>{var t;return{text:null!==(t=e.renderedStr)&&void 0!==t?t:"",keys:e.ans.isCorrect?"T":"F"}})),(null===(o=null===(c=null==e?void 0:null===(d=e.helpRenderedStr)||void 0===d?void 0:d.toString())||void 0===c?void 0:c.trim())||void 0===o?void 0:o.length)<5&&"TL"==v.type&&(v.type="DT",v.options.push({text:null===(g=null==e?void 0:null===(m=e.helpRenderedStr)||void 0===m?void 0:m.toString())||void 0===g?void 0:g.trim()})),t.questions.push(v.id),s.push(v)}}),s=s.map((e,t,n)=>{var l=0;return"TF"==e.type&&(l=1),"TN"==e.type&&(l=.25),"DT"==e.type&&(18==n.filter(e=>"TN"==e.type).length&&(l=.25),12==n.filter(e=>"TN"==e.type).length&&(l=.5)),s.length===n.filter(e=>"TN"==e.type).length&&(l=(10/s.length).toFixed(2)),{...e,point:l}}),this.callback({status:"done",data:{groups:n,questions:s,quizId:this.quizId}})}getLstQuestWithFile(e,t,n){return console.log({i:t}),new Promise((l,o)=>{let a=new h(this.commonService),x=[],p=new Map,f=[],g=[],m=1;a.handleFileSelect(e,e=>{for(let t of(console.log(e),e.data))if("img"==t.type)x.push({id:t.key,link:t.value,cssStyle:t.cssStyle}),t.cssStyle&&t.cssStyle.split(";").length>2&&f.push(["^\\[img:\\$".concat(t.key,"\\$\\]"),"[img:$".concat(t.key,"$]\n")]);else if("mathml"==t.type){let e=+t.key.split("_")[1];p.set(t.key,{id:e,str:t.value,raw:t.docx,lineIdx:0,startCol:0,endCol:0}),e>m&&(m=e)}for(let t of(m++,e.lines)){if(0==t.length)continue;let e="";for(let n of(e=Array.isArray(t[0])&&Array.isArray(t[t.length-1])&&Array.isArray(t[Math.floor(t.length/2)])?"[* "+t.map(e=>e.map(e=>e.join("").replaceAll("\n","\\n")).join("\\n")).join(" | ")+" *]":t.join(""),f))e=e.replaceAll(RegExp(n[0],"g"),n[1]);for(let t of e.split("\n"))g.push(t)}new c().process(g);let o=this.processStyle(g);console.log("process",{I:o,p:g}),this.processMath(o,p),new d().process(o);let a=new u(this.cropPdfParams);a.setLines(o);let h=a.parse(),v=new s.Task(2);console.log(v);for(let e=0;e<h.length;e++)v.addTask(this,this.renderQuest,[t,p,x,h[e],e,n]);v.start().then(e=>{setTimeout(()=>{l({lstQuest:t,mathMap:p,images:x})},10*x.length)})})})}fillImg(e,t,n,s){let l=RegExp("<div id='"+n+"'[^>]+></div>","g"),o=e[t];for(let e of(o.renderedStr=o.renderedStr.replace(l,null!=s?s:""),o.answers))e.renderedStr=e.renderedStr.replace(l,null!=s?s:"");o.helpRenderedStr&&(o.helpRenderedStr=o.helpRenderedStr.replace(l,null!=s?s:""))}fillError(e,t,n){e[t].err="<span style='color:red'>".concat(n,"</span>")}parseExtra(e){if(e.startsWith("[@"))return{val:"",idx:0,id:e};let t=e.matchAll(/\[!info:\d+\]/g),n="",s=0;for(;;){let e=t.next();if(e.done)break;n=e.value[0],s=e.value.index;break}if(""==n)return{val:"",idx:0,id:"0"};let l=n.replace("[!info:","").replace("]","").trim();return{val:n,idx:s,id:l}}upperFirst(e){return e?e.charAt(0).toUpperCase()+e.slice(1):""}getIncludeIds(e,t){return[]}renderStr(e,t,n,s,l,o,a,c){let d=!(arguments.length>8)||void 0===arguments[8]||arguments[8],h=d?s.replaceAll(/<([\/!a-zA-Z])/g,"&lt;$1").replaceAll(/&lt;([ubi])>/g,"<$1>").replaceAll(/&lt;[\/]([ubi])>/g,"</$1>").replaceAll("&lt;br>","<br>").replaceAll("<&lt;","&lt;&lt;").replaceAll("<&lt;","&lt;&lt;").replaceAll("<&lt;","&lt;&lt;"):s,u=[new S,new N(this.cdnService),new Z,new L,new _,new k,new M(t,this.commonService),new R,new H(this.cdnService,this.commonService,this.configRenderService,o),new O(this.cdnService,this.commonService,a,this.apiCallbackCache,this.aztEditor,c,this.getIncludeIds(e),this.apiDataCache,this.matrixLoadedData)];for(let e of("link"==l&&(u=[new H(this.cdnService,this.commonService,this.configRenderService,o)]),"help"==l&&u.pop(),u))e.setLoadingManager(this.loadingManager),h=e.render(h,n,this.questionService);return h}renderQuest(e,t,n,s,l,o){return new Promise(a=>{var c,d,h,u,x,p;let f=3;s.answers.length>0&&(f=1),0==s.answers.length&&s.strAns&&(f=4),"TF"==s.typeCode&&(f=5,s.answers.forEach(e=>{e.label=e.label.toLowerCase(),e.olabel=")"}));let g=(t,n)=>{this.fillImg(e,l,t,n)},m=e=>{},v=t=>{this.fillError(e,l,t)},b=s.parts.map(e=>null!==(c=e.text)&&void 0!==c?c:"").join("<br>").trim(),C=this.parseTag(b);""!=C[0]?a=b[1]:s.help&&s.help.length>0&&(C=this.parseTag(null!==(d=s.help[0].text)&&void 0!==d?d:""));let T=this.parseExtra(b);if("0"!=T.id){let e=this.extraMap.get(T.id);if(e&&e.replaceIdx>=0)return this.lstQuestReplace[e.replaceIdx]}""!=T.val&&(b=b.substring(0,T.idx)+b.substring(T.idx+T.val.length));let I=s.help?s.help.map(e=>null!==(h=e.text)&&void 0!==h?h:"").join("<br>").trim():void 0,y=this.findAnsSplit(null!==(u=s.strAns)&&void 0!==u?u:"",this.cropPdfParams.STRANS_SPLIT),w={renderedStr:this.renderStr(e,t,n,b,"full",g,m,v),quest:s,type:f,tag:""==C[0]?"NB":null!==(x=C[0])&&void 0!==x?x:"NB",strAns:s.strAns?s.strAns.split(y).map(e=>e.trim()):void 0,label:this.upperFirst(null!==(p=s.olabel)&&void 0!==p?p:""),helpRenderedStr:I?this.renderStr(e,t,n,I,"full",g,m,v):void 0,answers:s.answers.map(s=>{var l;let o=s.parts.map(e=>null!==(l=e.text)&&void 0!==l?l:"").join("<br>").trim();return{renderedStr:this.renderStr(e,t,n,o,"full",g,m,v),ans:s}})};if(w.renderedStr.startsWith("Loading...|")){let e=w.renderedStr.split("|");if(0>e[1].indexOf(",")){let t=+e[1];t>0&&(w.id=t)}w.renderedStr=e[0]}e[l]=w,o&&o(w),a(w)})}findAnsSplit(e,t){if(!t)return"|";for(let n=0;n<t.length;n++)if(e.indexOf(t[n])>=0)return t[n];return"|"}parseTag(e){let t=e.trim(),n=t.matchAll(/^(\[!info:\d+\]\s*)?(\[[iubchl!]+:\$\s*)?[\[\(]\s*(VD|TH|NB|VDC|EASY|MEDIUM|HARD|HARDEST)\s*[\d\.]*\s*[\)\]]/g).next();return n.done?["",t]:(t=t.replace(/[\[\(]\s*(VD|TH|NB|VDC|EASY|MEDIUM|HARD|HARDEST)\s*[\d\.]*\s*[\)\]]\s*[:.]?/g," "),[n.value[3],t])}processStyle(e){var t;let n=/\[![!ibuchl]+:\$(([^\$]|\$[^\]])+)\$\]/g,s=/^\s*\[\*\s*[AC]\.[^\|]+\|\s*[BD]\..*\*\]\s*$/g,l=[],o=0;for(let t of e){if(s.test(e[o].replaceAll(n,"$1"))&&(e[o]=e[o].replaceAll("[*","").replaceAll("*]","").replaceAll("|"," ").trim(),t=e[o]),t){let s,a=t.matchAll(n),c=0;for(;;){let e=a.next();if(e.done)break;let t=e.value[0],n=t.indexOf(":"),d=t.substring(1,n),h=e.value.index-c,u=h+e.value[1].length;s&&h==s.e&&s.style==d?s.e=u:(s={lineIdx:o,s:h,e:u,style:d},l.push(s)),c+=n+4}e[o]=t.replaceAll(n,"$1")}o++}let a=new u(this.cropPdfParams);a.setLines(e);let c=a.parse(),d=[],h=new Map,x=0;for(let t of c){for(let e of(x++,t.parts))d.push(e);for(let n of t.answers){let s=this.hasStyleAns(e,n.parts[0],l);for(let e of(""!=s&&h.set("".concat(t.label,"-").concat(t.group,"-").concat(n.label,"-").concat(x),s),n.parts))d.push(e)}}for(let e of c)if(e.help)for(let t of e.help)d.push(t);this.applyStyle(e,d,l),a.setLines(e);let p=[];for(let e of(x=0,c=null!==(t=a.parse())&&void 0!==t?t:[])){x++;let t=new Map;if(!(e.answers.filter(e=>e.isCorrect).length>0)){for(let n of e.answers){let s=h.get("".concat(e.label,"-").concat(e.group,"-").concat(n.label,"-").concat(x));s&&""!=s&&t.set(s,t.has(s)?void 0:n.parts[0])}for(let e of t)if(e[1]){p.push(e[1]);break}}}for(let t=p.length-1;t>=0;t--){let n=p[t];e[n.lineIdx]=e[n.lineIdx].substring(0,n.b)+"*"+e[n.lineIdx].substring(n.b)}return e=this.processUnderlineAns(e),c.length>0?e.slice(c[0].parts[0].lineIdx):e}processUnderlineAns(e){let t=/\[[!bihl]*[!u]+[!bihl]*:\$(([^\$]|\$[^\]])+)\$\]/g,n=0,s=[];for(let l of e){if(/^[ABCD\.\s\t\*]+$/.test(l)&&""!=l.trim()&&n>0){let o=l,a=(o=o.replaceAll(/[\s\t\.]+/g,"")).indexOf("*"),c=0;if(o=o.replaceAll(/[\*]+/g,""),"ABCDEFGH".indexOf(o)>=0){let l=e[n-1].match(t);if(l&&o.length==l.length){for(let t of l)e[n-1]=e[n-1].replace(t,t.replace(/\[[!bihl]*[!u]+[!bihl]*:\$/g,"[".concat(a==c?"*":"").concat(o.substring(0,1),":")).replace("$]","]")),s[s.length-1]=e[n-1],o=o.substring(1),c++;n++;continue}}}s.push(l),n++}return s}hasStyleAns(e,t,n){if(!t)return"";for(let e of n.filter(e=>e.lineIdx==t.lineIdx&&e.s<=t.b&&e.e>=t.b))if(e.style.indexOf("!u")>=0||e.style.indexOf("!b")>=0||e.style.indexOf("!hl")>=0)return e.style;return""}applyStyle(e,t,n){for(let l=t.length-1;l>=0;l--){let o=t[l],a=n.filter(e=>e.lineIdx==o.lineIdx&&e.e>=o.s);for(let t=a.length-1;t>=0;t--){var s;let n=a[t].s>=o.s?a[t].s:o.s,l=a[t].e<=(null!==(s=o.e)&&void 0!==s?s:9999999)?a[t].e:o.e,c=a[t].style.replaceAll("!hl","");if(n<l&&""!=c){let t=e[o.lineIdx],s=t.substring(n,l);""!=s.trim()&&(e[o.lineIdx]=t.substring(0,n)+"["+c+":$"+s+"$]"+t.substring(l))}}}}processMath(e,t){let n=0;for(let s of e){let e=s.matchAll(this.MATH_PAT);for(;;){let s=e.next();if(s.done)break;let l=s.value[0],o=t.get(s.value[1]);o&&(o.lineIdx=n+1,o.startCol=s.value.index+1,o.endCol=o.startCol+l.length)}n++}}constructor(e,t){this.quizId=e,this.callback=t,this.loadingManager=new Map,this.MATH_PAT=/\[!m:\$([^\$\]]+)\$\]/g,this.lstQuestReplace=[],this.extraMap=new Map,this.cropPdfParams={RENDER_SCALE:2,LINE_SMALL_HEIGHT:8,SPLIT_MARGIN:3,INTERSEC_MARGIN:10,LINE_MAGIN:2,MARGIN_LEFT:2,ENABLE_IMAGE_PROCESS:!0,STEP_SIZE:3,CROP_FULL_WIDTH:!0,OVERLAP:.5,QUESTION_PATTERN:["(^c\xe2u\\s*\\d{1,4}[^0-9])","(^câu\\s*\\d{1,4}[^0-9])","(^c\xe2u\\|*\\s*\\d{1,4}[^0-9])","(^câu\\|*\\s*\\d{1,4}[^0-9])","(^c\xa9u\\s*\\d{1,4}[^0-9])","(^ca‚u\\s*\\d{1,4}[^0-9])","(^b\xe0i\\s*\\d{1,4}[^0-9])","(^bài\\s*\\d{1,4}[^0-9])","(^cau\\s*\\d{1,4}[^0-9])","(^bai\\s*\\d{1,4}[^0-9])","(^question\\s*\\d{1,4}[^0-9])","(^questions\\s*\\d{1,4}[^0-9])","(^\\[\\d{1,4}\\][^0-9])","(^\\d+\\s*\\(nb\\))","(^\\d+\\s*\\(th\\))","(^\\d+\\s*\\(vd\\))","(^\\d+\\s*\\(vdc\\))","(^c\xe2u\\s*\\d{1,4}[\\s\\.:]*$)","(^câu\\s*\\d{1,4}[\\s\\.:]*$)","(^c\xa9u\\s*\\d{1,4}[\\s\\.:]*$)","(^ca‚u\\s*\\d{1,4}[\\s\\.:]*$)","(^b\xe0i\\s*\\d{1,4}[\\s\\.:]*$)","(^bài\\s*\\d{1,4}[\\s\\.:]*$)","(^cau\\s*\\d{1,4}[\\s\\.:]*$)","(^bai\\s*\\d{1,4}[\\s\\.:]*$)","(^questions\\s*\\d{1,4}[\\s\\.:]*$)","(^question\\s*\\d{1,4}[\\s\\.:]*$)"],QUESTION_PATTERN2:["(^(\\d+\\s*\\.)\\s*[\\.0-9])","(^(\\d+\\s*\\.)\\s*\\(\\s*\\d+\\s*\\))","(^(\\d+\\s*\\.)\\s*[^\\s])","(^\\d+\\s*\\.\\s*$)"],BREAK_LINE_PATTERN:["(^C\xe2u\\s*\\d+\\s*[:\\.]\\s*[Aa]\\s*\\.)","(^C\xa9u\\s*\\d+\\s*[:\\.]\\s*[Aa]\\s*\\.)","(^B\xe0i\\s*\\d+\\s*[:\\.]\\s*[Aa]\\s*\\.)","(^Cau\\s*\\d+\\s*[:\\.]\\s*[Aa]\\s*\\.)","(^Bai\\s*\\d+\\s*[:\\.]\\s*[Aa]\\s*\\.)","(^Question\\s*\\d+\\s*[:\\.]\\s*[Aa]\\s*\\.)","(^\\d+\\s*[:\\.]\\s*[Aa]\\s*\\.)"],SECTION_PATTERN_LOWER:["(^mark\\s*the\\s*letter)","(^read\\s*the\\s*follow)","(^reading\\s*the\\s*follow)","(^read\\s*the\\s*text)","(^read\\s*the\\s*passage)","(^read\\s*the\\s*paragraph)","(^read\\s*and\\s*choose)","(^put\\s*these\\s*word)","(^supply\\s*the\\s*correct)","(^make\\s*questions?\\s*for)","(^fill\\s*in\\s*the\\s*blank)","(^fill\\s*in\\s*each\\s*numbered)","(write\\s*the\\s*months\\s*in\\s*english)","(write\\s*the\\s*telephone\\s*numbers\\s*in\\s*english)","(^which\\s*of\\s*the\\s*following)","(^choose\\s*the\\s*suitable\\s*word)","(^choose\\s*the\\s*word)","(^choose\\s*the\\s*option)","(^choose\\s*the\\s*item\\s*among)","(^choose\\s*the\\s*underlined\\s*word)","(^combine\\s*two\\s*sentences)","(^each\\s*of\\s*the\\s*following)","(^finish\\s*the\\s*second\\s*sentence)","(^identify\\s*the\\s*underlined)","(^identify\\s*a\\s*mistake)","(^indicate\\s*the\\s*word)","(^indicate\\s*the\\s*correct)","(^indicate\\s*the\\s*sentence)","(^indicate\\s*the\\s*underlined)","(^circle\\s*the\\s*underlined)","(^circle\\s*the\\s*word\\s*whose\\s*underlined)","(^choose\\s*the\\s*underlined)","(^\\*?find\\s*the\\s*word)","(^find\\s*a\\s*mistake)","(^fill\\s*the\\s*circle)","(^listen\\s*to.*conversation)","(^there\\s*are.*blanks\\s*in\\s*the\\s*passage\\s*below)","(^listen\\s*to\\s*the\\s*recording)","(^listen\\s*to\\s*three\\s*people)","(^listen\\s*and\\s*circle)","(^listen\\s*again\\s*and\\s*choose)","(^\\*?listen\\s*and\\s*complete)","(^\\*?choose\\s*the\\s*best)","(^choose\\s*the\\s*correct)","(^put\\s*in\\s*the\\s*correct)","(^complete\\s*the\\s*second\\s*sentence)","(^complete\\s*the\\s*sentences)","(^give\\s*the\\s*correct\\s*form)","(^mark\\s*a,\\s*b,)","(^circle\\s*the\\s*letter)","(^you\\s*will\\s*hear)","(^blacken\\s*the\\s*letter)","(^đọc\\s*đoạn\\s*tr\xedch)","(^đọc\\s*đoạn\\s*văn\\s*sau\\s*v\xe0\\s*trả\\s*lời)","(^dựa\\s*v\xe0o\\s*th\xf4ng\\s*tin\\s*dưới\\s*đ\xe2y)","(^dựa\\s*v\xe0o\\s*c\xe1c\\s*th\xf4ng\\s*tin\\s*được\\s*cung\\s*cấp\\s*dưới\\s*đ\xe2y)","(^đọc\\s*th\xf4ng\\s*tin\\s*v\xe0\\s*trả\\s*lời)","(^section\\s*[0-9abcdefghivx]+)","(^part[^a-z]+[0-9abcdefghivx]+\\s*[\\.:\\-])","(^phần\\s*[0-9abcdefivx]+[\\.:])","(^phần\\s*[0-9abcdefivx]+\\s*$)","(^nh\xf3m\\s*[0-9abcdefivx]+[\\.:])","(^chương\\s*[0-9abcdefivx]+[\\.:])","(^questions?\\s*\\d+\\s*[\\–\\-to]+\\s*\\d+)","(^passage\\s*[0-9abcdefghivx]+)","(^use\\s*the\\s*word\\s*given\\s*in\\s*capitals)","(^tự\\s*luận)","(^[\\d]+[.]\\s*nhận\\s*biết)","(^[\\d]+[.]\\s*th\xf4ng\\s*hiểu)","(^[\\d]+[.]\\s*vận\\s*dụng)","(^[\\d]+[.]\\s*vận\\s*dụng\\s*cao)","(^chủ\\s*đề\\s*\\d*:)"],SECTION_PATTERN_NORMAL:["(^[IVX]+\\s*[\\.\\-\\–]\\s*[A-Z\xc0Ả\xc3\xc1ẠĂẰẲẴẮẶ\xc2ẦẨẪẤẬĐ\xc8ẺẼ\xc9Ẹ\xcaỀỂỄẾỆ\xccỈĨ\xcdỊ\xd2Ỏ\xd5\xd3Ọ\xd4ỒỔỖỐỘƠỜỞỠỚỢ\xd9ỦŨ\xdaỤƯỪỬỮỨỰỲỶỸ\xddỴ]+)","(^[\\d]+\\.[\\d]+\\.[\\d]*\\.*\\s*[A-Z\xc0Ả\xc3\xc1ẠĂẰẲẴẮẶ\xc2ẦẨẪẤẬĐ\xc8ẺẼ\xc9Ẹ\xcaỀỂỄẾỆ\xccỈĨ\xcdỊ\xd2Ỏ\xd5\xd3Ọ\xd4ỒỔỖỐỘƠỜỞỠỚỢ\xd9ỦŨ\xdaỤƯỪỬỮỨỰỲỶỸ\xddỴ]+)","(^[IVX]+\\s*[\\.:]\\s*$)"],KICK_PATTERN:["(^Chọn\\s*[ABВCDEFGHIJK]+)","(^Chon\\s*[ABВCDEFGHIJK]+)"],TVCN_CHAR:[["Α","A"],["В","B"]],HET_PATTERN:["(HẾT)","(H\xcáT)","(HET)","(\\-\\-HT\\-\\-)","(THE\\s*END)","(The\\s*end[^a-z0-9]*$)","(^[^A-Za-z]*Hết[^A-Za-z]*)$"],DAPAN_PATTERN:["(\xc1P \xc1N)","(\xc1P \xc1)","(\xc1P\xc1N)","(ÁP ÁN)","(BẢNG\xc1\xc1)","(KHO\xc1\\s*C\xc2U\\s*TRẮC\\s*NGHIỆM)","(ÁPÁN)","(ANSWER KEYS)","(^KEYS$)","(Bảng\\s*đ\xe1p\\s*\xe1n)","(Đ\xe1p\\s*\xe1n\\s*v\xe0\\s*hướng)","(Dap\\s*an\\s*va\\s*huong)","(Đ\xe1p\\s*\xe1n\\s*[.:]\\s*$)","(Đ\xe1p\\s*\xe1n\\s*$)"],HUONGDAN_PATTERN:["(HƯỚNG\\s*DẪN)","(ƯỚNG\\s*DẪN\\s*GIẢI\\s*CHI)","(GIẢI\\s*TH\xcdCH\\s*CHI\\s*TIẾT)","(Hướng\\s*dẫn\\s*giải)","(Lời\\s*giải)","(Trả\\s*lời)","(LỜI\\s*GIẢI)","(GIẢI\\s*CHI\\s*TIẾT)","(HD:)","(GLOSSARY)"],MULTIPLE_ANS_PATTERN:["([ABCDEFGH]\\s*v\xe0\\s*[ABCDEFGH]\\s*đều)","(Cả\\s*[ABCDEFGH]\\s*v\xe0\\s*[ABCDEFGH])","(Cả\\s*[ABCDEFGH]\\s*,\\s*[ABCDEFGH])","(Cả\\s*3\\s*đ\xe1p\\s*\xe1n)","(Cả\\s*đ\xe1p\\s*\xe1n)","(Tất\\s*cả\\s*đ\xe1p\\s*\xe1n)","(Kết\\s*quả\\s*kh\xe1c)","(Đ\xe1p\\s*\xe1n\\s*kh\xe1c)","(Đ\xe1p\\s*\xe1n\\s*[ABCDEFGH]\\s*v\xe0\\s*[ABCDEFGH])","(Tất\\s*cả\\s*đều)"],DRAW_RESULT:"",SKIP_CHAR:["","√","p","(",")","[","]","{","}",""],FOOTER_PATTERN:["(trang\\s*\\d+)","(Page\\s*\\d+)","(Trang\\s*\\d+)","(TRANG\\s*\\d+)","(^\\d{1,4}$)","(^[\\-\\s]*\\d{1,4}[\\-\\s]*$)"],HELP_ANS_PATTERN:["([\\s\\.]*Chọn\\s*:?\\s*([A-K])[^A-Za-z0-9]*$)","([\\d\\s\\.:]*Đ\xe1p\\s*\xe1n\\s*l\xe0\\s*:?\\s*([A-K])[^A-Za-z0-9]*$)","([\\d\\s\\.:]*Chọn\\s*đ\xe1p\\s*\xe1n\\s*:?\\s*([A-K])[^A-Za-z0-9]*$)","([\\d\\s\\.:]*Đ\xe1p\\s*\xe1n\\s*đ\xfang\\s*:?\\s*([A-K])[^A-Za-z0-9]*$)","([\\d\\s\\.:]*Đ\xe1p\\s*\xe1n\\s*:?\\s*([A-K])[^A-Za-z0-9]*$)","([\\d\\s\\.:]*Đ\xe1p\\s*\xe1n\\s*l\xe0\\s*:?\\s*(.+)\\.\\s*$)","([\\d\\s\\.:]*Đ\xe1p\\s*\xe1n\\s*đ\xfang\\s*:?\\s*(.+)\\.\\s*$)","([\\d\\s\\.:]*Đ\xe1p\\s*\xe1n\\s*:?\\s*(.+)\\.\\s*$)","([\\d\\s\\.:]*Đ\xe1p\\s*\xe1n\\s*l\xe0\\s*:?\\s*(.+)$)","([\\d\\s\\.:]*Đ\xe1p\\s*\xe1n\\s*đ\xfang\\s*:?\\s*(.+)$)","([\\d\\s\\.:]*Đ\xe1p\\s*\xe1n\\s*:?\\s*(.+)$)","(([aA][.,\\)]\\s*[ĐSđsdD][\\s|]*[bB][.,\\)]\\s*[ĐSđsdD][\\s|]*[cC][.,\\)]\\s*[ĐSđsdD][\\s|]*[dD][.,\\)]\\s*[ĐSđsdD]))"],GROUP_TF_PATTERN:["(trắc nghiệm đ\xfang[\\s\\\\\\/]*sai)"],FIX_NO_END_PATTERN:["(^\\[\\*\\s*\\d+[.-]?\\s*[A-D]\\s*\\|(\\s*\\d+[.-]?\\s*[A-D]\\s*\\|?)+\\*\\]$)"],RES_ANS_PATTERN:["(\\d+[.-][^|0-9])"],STRANS_SPLIT:"|/\\"}}}},4521:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n(8754),n(3401);let s=n(1117);class l{on(){this.isOn=!0}off(){this.isOn=!1}process(e,t,n,s,l,o){return this.isOn?this.parse(e,t,n,s,l,o):[]}constructor(){this.isOn=!0,this.TYPE="default"}}class o extends l{parse(e,t,n,s,l,o){var a=this.matchPos(t.strLine);if(a.value){let e=null;for(let t=a.value.length-1;t>=0;t--)if(a.value[t]){e=a.value[t];break}if(null==e)return[];let s=e.matchAll(/\d+/g).next(),c=e.length;s.done||e.trim().endsWith(".")||e.trim().endsWith(":")||(c=s.value.index+s.value[0].length);let d=t.strLine.replace(/\|/g,"").toLowerCase().indexOf(e)+c-1;return[{str:this.getNumberFromStr(e),pageIndex:t.pageIndex,lineIndex:n,transform:t.transform,startLeft:m.calIndexPos2(t.textObjs,l,o,d,!0),type:this.TYPE}]}return[]}matchPos(e){let t=e.replace(/\|/g,"").toLowerCase().trim();if(0==this.questType){let e=s.PdfConst.QUESTION_PATTERN.join("|");return t.matchAll(e).next()}{let e=s.PdfConst.QUESTION_PATTERN2.join("|");return t.matchAll(e).next()}}getNumberFromStr(e){var t=e.match(/(\d+)/);return t?t[0]:""}static getRemoveBox(e,t){let n=e.startLeft?e.startLeft[5]:t[e.lineIndex].top,l=e.transform[4]-s.PdfConst.MARGIN_LEFT,o=e.startLeft?e.startLeft[5]+e.startLeft[3]:t[e.lineIndex].bottom;return{pageIndex:e.pageIndex,top:n||20,left:l,heigh:o&&n?o-n:0,width:(e.startLeft?e.startLeft[4]:0)-l}}static getBoxes(e,t,n,l){let o=l;for(let n=e.lineIndex;n<t.length;n++)if(m.isLastLineOfPage(n,t)){let e=t[n].isFooter?t[n-1]:t[n];o=e.transform[5]+e.height+20;break}let a=[],c=e.pageIndex,d=n?n.lineIndex:t.length-1,h=t[e.lineIndex].transform[4]-s.PdfConst.MARGIN_LEFT,u=t[e.lineIndex].top;if(!u)return[];let x=s.PdfConst.CROP_FULL_WIDTH?m.getMaxLineRight(-1,t)+2*s.PdfConst.MARGIN_LEFT:t[e.lineIndex].transform[4]+t[e.lineIndex].width+2*s.PdfConst.MARGIN_LEFT,p=o,f=c,g=e.lineIndex+1;for(;g<=d;g++){let e=t[g].top;if(g!=t.length-1||n||(e=t[g].bottom),!s.PdfConst.CROP_FULL_WIDTH){let e=t[g-1].transform[4]+t[g-1].width+2*s.PdfConst.MARGIN_LEFT;e>x&&(x=e)}let l=t[g-1].transform[4]-s.PdfConst.MARGIN_LEFT;l<h&&(h=l),t[g].isFooter&&e?p=e:(t[g].pageIndex>f&&(t[g-1].isFooter||(p=o),a.push({pageIndex:f,top:u,left:h,width:x-h,heigh:p-u}),u=20,h=m.getMinLineLeft(t[g].pageIndex,t)-s.PdfConst.MARGIN_LEFT),f=t[g].pageIndex,e&&(p=e))}if(g-=1,!n&&m.isLastLineOfPage(g,t)){let e=t[g].isFooter?t[g-1]:t[g];p=e.transform[5]+e.height+20}return m.isFirstLineOfPage(g,t)||a.push({pageIndex:f,top:u,left:h,width:x-h,heigh:p-u}),a}constructor(e){super(),this.TYPE=o.TYPE_NAME,this.questType=e}}o.TYPE_NAME="question";class a extends l{parse(e,t,n,l,a,c){let d=t.strLine.replace(/\|/g,"").toLowerCase().trim().match(s.PdfConst.SECTION_PATTERN_LOWER.join("|")),h=null!=d&&d.length>0;if(h||(h=null!=(d=t.strLine.replace(/\|/g,"").trim().match(s.PdfConst.SECTION_PATTERN_NORMAL.join("|")))&&d.length>0),h&&d){let s=t.strLine.indexOf(d[0])+d[0].length+1,l=[d[0][0]];for(let t=e.length-1;t>=0;t--){if(e[t].type==o.TYPE_NAME){l.push(".Q");break}l.push(e[t].str[0])}return"HGFEDCBA.Q".endsWith(l.join(""))?[]:[{str:d[0],pageIndex:t.pageIndex,lineIndex:n,transform:t.transform,startLeft:m.calIndexPos(t.textObjs,a,c,s,!0),type:this.TYPE}]}return[]}static getRemoveBox(e,t){let n=t[e.lineIndex].top,l=e.transform[4]-s.PdfConst.MARGIN_LEFT,o=t[e.lineIndex].bottom;return{pageIndex:e.pageIndex,top:n||20,left:l,heigh:o&&n?o-n:0,width:l-l}}static getBoxes(e,t,n,l){let o=[],a=e.pageIndex,c=n?n.lineIndex:t.length-1,d=m.getMinLineLeft(-1,t)-s.PdfConst.MARGIN_LEFT,h=t[e.lineIndex].top;if(!h)return[];let u=m.getMaxLineRight(-1,t)+2*s.PdfConst.MARGIN_LEFT,x=l,p=a,f=e.lineIndex+1;for(;f<=c;f++){let e=t[f].top;if(t[f].isFooter&&e)x=e;else if(t[f].pageIndex>p&&(o.push({pageIndex:p,top:h,left:d,width:u-d,heigh:x-h}),h=20),p=t[f].pageIndex,e){x=e;break}}return f>=t.length&&(f=t.length-1),m.isFirstLineOfPage(f,t)||o.push({pageIndex:p,top:h,left:d,width:u-d,heigh:x-h}),o}constructor(){super(),this.TYPE=a.TYPE_NAME}}a.TYPE_NAME="section";class c extends l{parse(e,t,n,s,l,o){var a=[],c=this.matchPos(t.strLine,!1);if(0==c.length&&(c=this.matchPos(t.strLine,!0)),c.length>0)for(let e of c)a.push({str:e.value,pageIndex:t.pageIndex,lineIndex:n,transform:m.calIndexPos(t.textObjs,l,o,e.index),startLeft:m.calIndexPos2(t.textObjs,l,o,e.index+1),type:this.TYPE});return a}static getRemoveBox(e,t){let n=e.startLeft?e.startLeft[5]-2:t[e.lineIndex].top,l=e.transform[4]-s.PdfConst.MARGIN_LEFT,o=e.startLeft?e.startLeft[5]+e.startLeft[3]:t[e.lineIndex].bottom;return{pageIndex:e.pageIndex,top:n||20,left:l,heigh:o&&n?o-n:0,width:(e.startLeft?e.startLeft[4]:0)-l}}static getBoxes(e,t,n,l){let o=s.PdfConst.MARGIN_LEFT,a=[],d=t[e.lineIndex].top,h=t[e.lineIndex].bottom;if(!d||!h)return[];let u=h,x=e.transform[4]-o,p=n&&e.lineIndex==n.lineIndex?n.transform[4]-o:t[e.lineIndex].transform[4]+t[e.lineIndex].width+o;if(a.push({pageIndex:e.pageIndex,top:d,left:x,width:p-x,heigh:h-d}),n&&n.lineIndex==e.lineIndex)return a;d=h,h=l,p=0;let f=e.pageIndex,g=0;for(g=e.lineIndex+1;g<t.length;g++){if(h==l&&m.isLastLineOfPage(g,t)){let e=t[g].isFooter?t[g-1]:t[g];h=e.transform[5]+e.height+20}let n=t[g].top;if(g>e.lineIndex+1&&!t[g-1].isFooter){let e=t[g-1].transform[4]+t[g-1].width+o;e>p&&(p=e);let n=t[g-1].transform[4]-o;n<x&&(x=n)}if(t[g].isFooter&&n)g-e.lineIndex>1?(h=t[g-1].transform[5]+t[g-1].height+s.PdfConst.LINE_MAGIN,x=t[e.lineIndex+1].transform[4]-o):h=t[e.lineIndex].bottom;else if(t[g].pageIndex>f&&(h&&h-d>s.PdfConst.LINE_SMALL_HEIGHT&&g-e.lineIndex>1&&a.push({pageIndex:f,top:d,left:x,width:p-x,heigh:h-d}),u=d=20),f=t[g].pageIndex,n){h=n;break}}if(g>=t.length&&(g=t.length-1),g-e.lineIndex>1&&t[g-1].transform[5]>u&&!m.isFirstLineOfPage(g,t)){let n=20==d?t[g].transform[4]:t[e.lineIndex+1].transform[4];h&&h-d>s.PdfConst.LINE_SMALL_HEIGHT&&a.push({pageIndex:f,top:d,left:n,width:p-n,heigh:h-d})}n&&n.type==c.TYPE_NAME&&n.transform[4]>t[n.lineIndex].transform[4]+25*s.PdfConst.RENDER_SCALE&&(p=n.transform[4]-o,d=t[n.lineIndex].top,x=t[n.lineIndex].transform[4]-o,h=t[n.lineIndex].bottom,d&&h&&h-d>s.PdfConst.LINE_SMALL_HEIGHT&&a.push({pageIndex:f,top:d,left:x,width:p-x,heigh:h-d}));for(let e=a.length-1;e>=1;e--)a[e].left-(a[e-1].left+a[e-1].width)>=20*s.PdfConst.RENDER_SCALE&&a.splice(e,1);return a}matchPos(e,t){for(var n=t?e.toUpperCase():e,l=s.PdfConst.ANS_PATTERN,o=RegExp("[\\s\\|\\.]"),a=n.matchAll(l),c=[];;){var d=a.next();if(d.done)break;for(var h=0,u=d.value.index;u<n.length&&o.test(n[u]);u++)h++;let e=d.value[0].substr(h,1);("A"!=e||n.replace(/\|/g,"").trim().startsWith("A"))&&c.push({value:e,index:d.value.index+h})}return c}constructor(){super(),this.TYPE=c.TYPE_NAME}}c.TYPE_NAME="answer";class d extends l{parse(e,t,n,l,o,a){let c=t.strLine.replace(/\|/g,"").trim().match(s.PdfConst.HET_PATTERN.join("|"));return null!=c&&c.length>0?[{str:t.strLine,pageIndex:t.pageIndex,lineIndex:n,transform:t.transform,type:this.TYPE}]:[]}static getBoxes(e,t,n,s){return[]}strContains(e,t){for(let n of t)if(e.indexOf(n)>=0)return!0;return!1}constructor(e){super(),null!=e&&(this.isOn=e),this.TYPE=d.TYPE_NAME}}d.TYPE_NAME="het";class h extends l{parse(e,t,n,l,o,a){let c=t.strLine.replace(/\|/g,"").trim().match(s.PdfConst.DAPAN_PATTERN.join("|"));return null!=c&&c.length>0?[{str:t.strLine,pageIndex:t.pageIndex,lineIndex:n,transform:t.transform,type:this.TYPE}]:[]}static getBoxes(e,t,n,s){return[]}static getAnsFromHelp(e){for(let t of e){let e=t.strLine.replace(/\|/g,"").trim().match(s.PdfConst.HELP_ANS_PATTERN.join("|"));if(null!=e){for(let t=0;t<e.length;t++)if(null!=e[t]&&1==e[t].length)return e[t]}}return""}strContains(e,t){for(let n of t)if(e.indexOf(n)>=0)return!0;return!1}constructor(e){super(),null!=e&&(this.isOn=e),this.TYPE=h.TYPE_NAME}}h.TYPE_NAME="dapan";class u extends l{parse(e,t,n,l,o,a){let c=t.strLine.replace(/\|/g,"").trim().match(s.PdfConst.HUONGDAN_PATTERN.join("|"));return null!=c&&c.length>0?[{str:t.strLine,pageIndex:t.pageIndex,lineIndex:n,transform:t.transform,type:this.TYPE}]:[]}static getBoxes(e,t,n,s){return o.getBoxes(e,t,n,s)}strContains(e,t){for(let n of t)if(e.indexOf(n)>=0)return!0;return!1}constructor(){super(),this.TYPE=u.TYPE_NAME}}u.TYPE_NAME="huongdan";class x extends l{parse(e,t,n,s,l,o){var a=t.strLine.replace(/\|/g,"").replace(/\s*\.*\-*:*,*;*/g,"");return a=(a=(a=(a=(a=a.replace(/C\xe2u/g,"")).replace(/\u0110\xe1p\xe1n/g,"")).replace(/\u0110\xe1p/g,"")).replace(/\xe1n/g,"")).replace(/\u0110\/A/g,""),/^[0-9ABCDEFGHabcdefgh]+$/g.test(a)&&a.length>=2&&(null==this.firstLine&&(this.firstLine=t,this.lineIdx=n),this.str+=a),[]}static getBoxes(e,t,n,s){return[]}getResult(e){let t=[],n="",s=[],l=!1;for(let t=0;t<e.length;t++){let o=e.charCodeAt(t),a=o>=65&&o<=72;if(a&&""==n)return[];a!=l&&(s.push(n),n=""),l=a,n+=e[t]}""!=n&&s.push(n);for(let e=1;e<s.length;e+=2){let n=0,l=Math.floor(s[e-1].length/s[e].length),o=+s[e-1].substr(n,l),a=o;for(let c=0;c<s[e].length;c++){if(c>=s[e-1].length||(o=+s[e-1].substr(n,l))!=a)return[];t.push({num:o,str:s[e][c]}),n+=l,l=(a=o+1).toString().length}}return t}on(){super.on(),this.firstLine=null,this.lineIdx=0,this.str=""}off(){if(super.off(),this.offCalback&&this.firstLine){var e=this.getResult(this.str.toUpperCase());if(e.length>0){let t=JSON.stringify({main:e,sub:[]});this.offCalback([{str:t,pageIndex:this.firstLine.pageIndex,lineIndex:this.lineIdx,transform:this.firstLine.transform,type:this.TYPE}])}}this.firstLine=null,this.str=""}constructor(e,t){super(),this.firstLine=null,this.lineIdx=0,this.str="",this.TYPE=x.TYPE_NAME,null!=e&&(this.isOn=e),this.offCalback=t}}x.TYPE_NAME="dapanchitiet";class p extends l{parse(e,t,n,l,o,a){if(!t.isLastLine||l&&t.transform[5]<l.transform[5]+l.height)return[];var c=t.strLine.replace(/\|/g,"").trim().match(s.PdfConst.FOOTER_PATTERN.join("|"));return null!=c&&c.length>0?[{str:c[0],pageIndex:t.pageIndex,lineIndex:n,transform:t.transform,type:this.TYPE}]:[]}static getBoxes(e,t,n,s){return[]}constructor(){super(),this.TYPE=p.TYPE_NAME}}p.TYPE_NAME="footer";class f extends l{parse(e,t,n,s,l,o){for(let a of[new p,new u])if(a.parse(e,t,n,s,l,o).length>0)return[];var a=t.strLine;return null==this.firstLine&&(this.firstLine=t,this.lineIdx=n),this.str+=a+"\n",[]}static getBoxes(e,t,n,s){return[]}getResult(e){let t=[],n=e.replace(/\n/g,"\n|"),l=s.PdfConst.QUESTION_PATTERN.join("|").replace(/\(\^/g,"(\\|"),o=n.matchAll(RegExp(l,"ig"));for(;;){let e=o.next();if(e.done)break;let t=e.value[0],s=this.getNumberFromStr(t);n=n.replace(t,s+".")}let a,c=n.matchAll(/\d+[\.\-]/g),d=-1;for(;;){let e=c.next();if(e.done)break;if(-1==d)d=e.value.index,a=e;else{let s=n.substr(d,e.value.index-d);t.push(this.toAns(s,a)),d=e.value.index,a=e}}if(d>=0&&a){let e=n.substr(d);t.push(this.toAns(e,a))}return t}toAns(e,t){let n=t.value[0].length;return{num:+t.value[0].substr(0,n-1),str:e.substr(n).replace(/\|/g," ").replace(/ +/g," ").trim()}}getNumberFromStr(e){var t=e.match(/(\d+)/);return t?t[0]:""}on(){super.on(),this.firstLine=null,this.lineIdx=0,this.str=""}off(){if(super.off(),this.offCalback&&this.firstLine){var e=this.getResult(this.str);if(e.length>0){let t=JSON.stringify({main:[],sub:e});this.offCalback([{str:t,pageIndex:this.firstLine.pageIndex,lineIndex:this.lineIdx,transform:this.firstLine.transform,type:this.TYPE}])}}this.firstLine=null,this.str=""}constructor(e,t){super(),this.firstLine=null,this.lineIdx=0,this.str="",this.TYPE=f.TYPE_NAME,null!=e&&(this.isOn=e),this.offCalback=t}}f.TYPE_NAME="dapandientu";class g{getErrorQtns(e){var t=[];for(let n=0;n<e.length;n++)!e[n].isGroup&&0==e[n].answers.length&&(e[n].strAns&&void 0!==e[n].strAns||t.push(e[n].num));return t}sumHighTo(e,t){let n=0,s=t.filter(e=>!e.inactive);for(let t=0;t<e;t++)n+=Math.round(s[t].heigh);return n}maxWidthTo(e,t){let n=[],s=t.filter(e=>!e.inactive);for(let t=0;t<e;t++)n.push(s[t].width);return Math.round(Math.max(...n))}constructor(e){this.commonService=e,this.fillColor=(e,t,n,s,l,o)=>{t.fillStyle=e,t.fillRect(Math.round(n),Math.round(s),Math.round(l),Math.round(o))},this.drawRect=(e,t,n,s,l,o)=>{t.beginPath(),t.lineWidth=1,t.strokeStyle=e,t.rect(Math.round(n),Math.round(s),Math.round(l),Math.round(o)),t.stroke()},this.getSingleImgData=(e,t)=>{var n,s;if(e.inactive){let e=null!==(n=this.commonService.myTranslateInstant("lang_auto_khong_xac_dinh_duoc_vung_thong_tin"))&&void 0!==n?n:"";throw this.commonService.snackError(e),Error(e)}try{let n=document.createElement("canvas");return n.width=0==e.width?2:Math.round(e.width),n.height=0==e.heigh?2:Math.round(e.heigh),null===(s=n.getContext("2d"))||void 0===s||s.drawImage(t[e.pageIndex].canvas,Math.round(e.left),Math.round(e.top),n.width,n.height,0,0,n.width,n.height),n.toDataURL("image/png")}catch(e){return console.log(e),"https://via.placeholder.com/300"}},this.getScatteredImgData=(e,t)=>{let n=e.filter(e=>!e.inactive);if(e.filter(e=>e.inactive).length==e.length){var s;let e=null!==(s=this.commonService.myTranslateInstant("lang_auto_khong_xac_dinh_duoc_vung_thong_tin"))&&void 0!==s?s:"";throw this.commonService.snackError(e),Error(e)}try{let e=document.createElement("canvas"),s=n.map(e=>e.width);e.width=Math.round(Math.max(...s));let l=0;for(let e=0;e<n.length;e++)l+=n[e].heigh;e.height=Math.round(l);let o=e.getContext("2d");for(let e=0;e<n.length;e++)null==o||o.drawImage(t[n[e].pageIndex].canvas,Math.round(n[e].left),Math.round(n[e].top),Math.round(n[e].width),Math.round(n[e].heigh),0,0==e?0:this.sumHighTo(e,n),Math.round(n[e].width),Math.round(n[e].heigh));return e.toDataURL("image/png")}catch(e){return console.log(e),"https://via.placeholder.com/300"}}}}class m{static drawPoint(e,t,n){null!=e&&(e.fillStyle=t,e.beginPath(),e.arc(n.left,n.top,5,0,2*Math.PI),e.fill())}static drawBox(e,t,n,s){null!=e&&(s?(e.fillStyle=t,e.beginPath(),e.rect(n.left,n.top,n.width,n.heigh),e.fill()):(e.strokeStyle=t,e.beginPath(),e.rect(n.left,n.top,n.width,n.heigh),e.stroke()))}static drawBox2(e,t,n,s,l){null!=e&&(e.strokeStyle=t,e.beginPath(),e.rect(l[4],l[5],n,s),e.stroke())}static drawLine(e,t,n,s){null!=e&&(e.strokeStyle=t,e.beginPath(),e.moveTo(n,s),e.lineTo(e.canvas.width-10,s),e.stroke())}static drawText(e,t,n,s){null!=e&&(e.font="11px Arial",e.fillStyle=t,e.fillText(s,n[4],n[5]))}static isLineIntersec(e,t){let n=e.transform[5]<=t.transform[5]&&t.transform[5]<=e.transform[5]+e.height,l=t.transform[5]<=e.transform[5]&&e.transform[5]<=t.transform[5]+t.height,o=e.transform[4]<=t.transform[4]&&t.transform[4]<=e.transform[4]+e.width+s.PdfConst.INTERSEC_MARGIN,a=t.transform[4]<=e.transform[4]&&e.transform[4]<=t.transform[4]+t.width+s.PdfConst.INTERSEC_MARGIN,c=this.isSameLine(e,t);return(n||l)&&(o||a)&&!c}static isLineVIntersec(e,t){return(e.transform[5]<=t.transform[5]&&t.transform[5]<=e.transform[5]+e.height||t.transform[5]<=e.transform[5]&&e.transform[5]<=t.transform[5]+t.height)&&(e.transform[4]<=t.transform[4]&&t.transform[4]<=e.transform[4]+e.width+s.PdfConst.INTERSEC_MARGIN||t.transform[4]<=e.transform[4]&&e.transform[4]<=t.transform[4]+t.width+s.PdfConst.INTERSEC_MARGIN)&&Math.abs(t.transform[4]-e.transform[4])>s.PdfConst.INTERSEC_MARGIN/2}static isSameLine(e,t){return Math.abs(e.transform[5]+e.height-(t.transform[5]+t.height))<=s.PdfConst.LINE_MAGIN}static isObjIntersec(e,t){return e.transform[5]<=t.transform[5]&&t.transform[5]<=e.transform[5]+e.height||t.transform[5]<=e.transform[5]&&e.transform[5]<=t.transform[5]+t.height}static isObjFullIntersec(e,t){return(e.transform[5]<=t.transform[5]&&t.transform[5]<=e.transform[5]+e.height||t.transform[5]<=e.transform[5]&&e.transform[5]<=t.transform[5]+t.height)&&(e.transform[4]<=t.transform[4]&&t.transform[4]<=e.transform[4]+e.width||t.transform[4]<=e.transform[4]&&e.transform[4]<=t.transform[4]+t.width)}static isFirstLineOfPage(e,t){return!(e<0||e>=t.length||0!=e&&t[e-1].pageIndex==t[e].pageIndex)}static isLastLineOfPage(e,t){return!(e<0||e>=t.length||e!=t.length-1&&t[e+1].pageIndex==t[e].pageIndex)}static getTopLine(e,t,n){let l=n[t];for(let o of[[s.PdfConst.STEP_SIZE,s.PdfConst.OVERLAP],[1,s.PdfConst.OVERLAP],[1,.3]]){let a=o[0],c=o[1],d=l.transform[5],h=0,u=3*a;if(!m.isFirstLineOfPage(t,n)){let e=m.isSameLine(n[t-1],l);m.isLineIntersec(n[t-1],l)?(d=n[t-1].transform[5]+n[t-1].height,h=n[t-1].transform[5],n[t-1].transform[4]>n[t].transform[4]+2*s.PdfConst.MARGIN_LEFT?h-=2*s.PdfConst.MARGIN_LEFT:h+=n[t-1].height*c,a=1,u=n[t].transform[5]+n[t].height/2-d):(h=e&&t-2>=0?n[t-2].transform[5]+n[t-2].height*c:n[t-1].transform[5]+n[t-1].height*c,e&&m.isFirstLineOfPage(t-1,n)&&(h=0))}if(!s.PdfConst.ENABLE_IMAGE_PROCESS)return[d,0];let x=!1;for(;d>h;){if(!m.hasColor(e,l.transform[4],d,l.width,a))return[d,0];x||(x=!0,d+=u),d-=a}}return[l.transform[5],1]}static arrContains(e,t){for(let n of t)if(n==e)return!0;return!1}static getBottomLine(e,t,n){let l=n[t];for(let o of[[s.PdfConst.STEP_SIZE,s.PdfConst.OVERLAP],[1,s.PdfConst.OVERLAP],[1,.3]]){let a=o[0],c=o[1],d=l.transform[5]+l.height,h=9999,u=3*a;if(!m.isLastLineOfPage(t,n)){let e=m.isSameLine(n[t+1],l);m.isLineIntersec(n[t+1],l)?(d=n[t+1].transform[5],h=n[t+1].transform[5]+n[t+1].height,n[t+1].transform[4]>n[t].transform[4]+2*s.PdfConst.MARGIN_LEFT?h+=2*s.PdfConst.MARGIN_LEFT:h-=n[t+1].height*c,u=n[t].transform[5]+n[t].height/2-d):(h=e&&t+2<n.length?n[t+2].transform[5]+n[t+2].height-n[t+2].height*c:n[t+1].transform[5]+n[t+1].height-n[t+1].height*c,e&&m.isLastLineOfPage(t+1,n)&&(h=9999));let o=n[t+1].top;if(o&&d>=o&&!e)return[o,0]}if(!s.PdfConst.ENABLE_IMAGE_PROCESS)return[d,0];let x=!1;for(;d<h;){if(!m.hasColor(e,l.transform[4],d,l.width,a))return[d,0];x||(x=!0,d-=u),d+=a}}return[l.transform[5]+l.height,1]}static hasColor(e,t,n,s,l){let o=Math.round(t),a=Math.round(o+s),c=Math.round(n),d=Math.round(c+l);for(let t=c;t<d;t++)for(let n=o;n<a;n++){let s=4*(t*e.width+n);if((e.data[s]+e.data[s+1]+e.data[s+2])/3<150)return!0}return!1}static calIndexPos2(e,t,n,l,o){let a=[],c=0,d=0,h=0,u=0,x=0,p=0,f=!0,g=!0;for(let b of e){g=this.isObjIntersec(e[0],b),u=b.transform[4],o||(c+=u-h>s.PdfConst.SPLIT_MARGIN&&""!=b.str.trim()||x!=b.transform[5]?1:0),f=u+2*s.PdfConst.MARGIN_LEFT>=h;let C=b.transform[4]+b.width;if(g&&(h=C),C>d&&g&&(d=C),(c+=b.str.length)>l&&f&&g){b.transform.forEach(e=>{a.push(e)}),a[3]=b.height,a[2]=p,a[1]=b.str.length-c+l;let e=b.str.substr(0,b.str.length-c+l+1);if(e.length==b.str.length){a[4]=a[4]+b.width;break}var m=t[b.fontName].fontFamily,v=Math.hypot(b.transform[2],b.transform[3]);n.font="".concat(v,"px ").concat(m);let s=n.measureText(e).width,o=n.measureText(b.str).width;a[4]=a[4]+b.width*s/o;break}g&&(x=b.transform[5]),p++}return 0==a.length&&(a=[0,e[e.length-1].length-1,e.length-1,e[0].height,d,e[0].transform[5]]),a}static calIndexPos(e,t,n,l,o){let a=[],c=0,d=0,h=0,u=0,x=0,p=0,f=!0,g=!0;for(let b of e){g=this.isObjIntersec(e[0],b),u=b.transform[4],o||(c+=u-h>s.PdfConst.SPLIT_MARGIN&&""!=b.str.trim()||x!=b.transform[5]?1:0,u-h>s.PdfConst.SPLIT_MARGIN&&""!=b.str.trim()||b.transform[5],b.str),f=u+2*s.PdfConst.MARGIN_LEFT>=h;let C=b.transform[4]+b.width;if(g&&(h=C),C>d&&g&&(d=C),(c+=b.str.length)>l&&f&&g){let e=b.str.substr(0,b.str.length-c+l);var m=t[b.fontName].fontFamily,v=Math.hypot(b.transform[2],b.transform[3]);n.font="".concat(v,"px ").concat(m);let s=n.measureText(e).width,o=n.measureText(b.str).width;b.transform.forEach(e=>{a.push(e)}),a[4]=a[4]+b.width*s/o,a[3]=b.height,a[2]=p,a[1]=b.str.length-c+l;break}g&&(x=b.transform[5]),p++}return 0==a.length&&(a=[0,e[e.length-1].length-1,e.length-1,e[0].height,d,e[0].transform[5]]),a}static getTextBottom(e,t,n,s){let l=Math.atan2(e[1],e[0]);t.vertical&&(l+=Math.PI/2);let o=Math.hypot(e[2],e[3]),a=o*m.getAscent(t.fontFamily,n,s);e[5];let c=0,d=0*(c=0===l?a:a*Math.cos(l));return[e[5]-c-d,o+d]}static getAscent(e,t,n){let s=n.get(e);if(s)return s;t.save(),t.font="30px ".concat(e);let l=t.measureText(""),o=l.fontBoundingBoxAscent,a=Math.abs(l.fontBoundingBoxDescent);if(o){t.restore();let s=o/(o+a);return n.set(e,s),s}t.strokeStyle="red",t.clearRect(0,0,30,30),t.strokeText("g",0,0);let c=t.getImageData(0,0,30,30).data;a=0;for(let e=c.length-1-3;e>=0;e-=4)if(c[e]>0){a=Math.ceil(e/4/30);break}t.clearRect(0,0,30,30),t.strokeText("A",0,30),c=t.getImageData(0,0,30,30).data,o=0;for(let e=0,t=c.length;e<t;e+=4)if(c[e]>0){o=30-Math.floor(e/4/30);break}if(t.restore(),o){let t=o/(o+a);return n.set(e,t),t}return n.set(e,.8),.8}static getMaxLineRight(e,t){let n=0;for(let s of t)if(s.pageIndex==e||-1==e){let e=s.transform[4]+s.width;e>n&&(n=e)}return n}static getMinLineLeft(e,t){let n=99999;for(let s of t)if(s.pageIndex==e||-1==e){let e=s.transform[4];e<n&&(n=e)}return n}}class v{loadPdf(e,t){var n=URL.createObjectURL(e);let s=pdfjsLib.getDocument({url:n,cMapPacked:!0,cMapUrl:"/assets/js/pdf-js-v2/cmaps/",disableAutoFetch:!1,disableFontFace:!1,disableRange:!1,disableStream:!1,docBaseUrl:"",enableXfa:!0,fontExtraProperties:!1,isEvalSupported:!0,maxImageSize:-1,pdfBug:!1,standardFontDataUrl:"/assets/js/pdf-js-v2/standard_fonts/",verbosity:1});var l=[];let o=this;s.promise.then(function(e){o.optionalContentConfigPromise=e.getOptionalContentConfig();for(var n=e._pdfInfo.numPages,s=1;s<=n;s++)e.getPage(s).then(e=>{l.push(e),l.length==n&&t(l=l.sort((e,t)=>e._pageIndex>t._pageIndex?1:-1))})},function(e){console.error(e)})}getImages(e,t){let n=[];if("function"!=typeof e.objs.getAll)return console.log("Unable to read img"),n;let s=e.objs.getAll();for(let e of Object.keys(s))s[e].data.pageIndex=t,n.push(s[e].data);return n}isImageObj(e){return -999==e.transform[0]&&"img"==e.str}getLines(e,t,n,l){let o=l.scale,a=e.items.length;for(let t=0;t<a;t++){let s=e.items[t];this.isImageObj(s)||(s.transform=v.transform(l.transform,s.transform),s.width=s.width*o),s.transform[4]+s.width>n.canvas.width&&(s.width=n.canvas.width-s.transform[4]-20);let a=this.isImageObj(s)?[s.transform[5],s.height]:m.getTextBottom(s.transform,e.styles[s.fontName],this.tempCanvas,this.ascentCache);s.height=a[1];let c=Math.ceil(a[0]);s.transform[5]=c}e.items.sort((e,t)=>1e6*Math.floor(e.transform[5])-e.transform[4]<1e6*Math.floor(t.transform[5])-t.transform[4]?-1:1);let c,d=[],h=0;this.imageCache[t]?c=this.imageCache[t]:(c=n.getImageData(0,0,n.canvas.width,n.canvas.height),this.imageCache[t]=c);var u={strLine:"",transform:[],textObjs:[],pageIndex:t,width:0,height:0,txtLength:0};for(let n=0;n<a;n++){let l=e.items[n];if(this.isImageObj(l)){for(let t=0;t<a;t++)if(n!=t&&m.isObjIntersec(l,e.items[t])){l.str="";break}}if(m.arrContains(l.str.trim(),s.PdfConst.SKIP_CHAR))continue;let o=Math.floor(l.transform[5]+l.height);0!=h?h-o>=-s.PdfConst.LINE_MAGIN?this.addTxtToLine(u,l):0!=u.textObjs.length&&(d.push(u),h=Math.floor((u=this.newLine(l,t)).transform[5]+u.height)):h=Math.floor((u=this.newLine(l,t)).transform[5]+u.height)}for(let e of(d.push(u),d))this.calculateSize(e);for(let e of(this.findAndMergeAnsQuestBlock(d,"ans"),this.findAndMergeAnsQuestBlock(d,"quest"),this.findAndMergeBlock(d),this.mergeIntersecLine(d),this.mergeSmallLine(d,c),d))this.calculateSize(e);return d}mergeIntersecLine(e){let t=0;for(;t<e.length;){let n=e[t];++t<e.length&&m.isLineVIntersec(n,e[t])&&(this.mergeLine(n,e[t]),e.splice(t,1),t--)}}findAndSplitQuestAnsLine(e,t,n){let l=0,o=[],a=s.PdfConst.BREAK_LINE_PATTERN.join("|");for(let t of e){t.top=void 0,t.bottom=void 0;var c=t.strLine.replace(/\|/g,"").trim().match(a);if(null!=c&&c.length>0){let e=/[\s\|\.]+[B\u0412][\s\|]*\./g,n=t.strLine.trim().toUpperCase().match(e);if(null!=n&&n.length>0){let e=c[0].toUpperCase().indexOf("A");o.push({lineIndex:l,strIndex:e})}}l++}for(let s=o.length-1;s>=0;s--){let l=o[s].lineIndex;this.splitLine(l,t[e[l].pageIndex],n[e[l].pageIndex],o[s].strIndex,e)}}mergeSmallLine(e,t){let n=0,l=1.2*s.PdfConst.LINE_SMALL_HEIGHT;for(;n<e.length;){let s=e[n];if(!s||!this.isSmallLine(s)){n++;continue}n-1>=0&&!e[n-1].bottom&&(e[n-1].bottom=m.getBottomLine(t,n-1,e)[0]),n+1<e.length&&!e[n+1].top&&(e[n+1].top=m.getTopLine(t,n+1,e)[0]);let o=n-1<0?-9999:this.getLineTop(s)-this.getLineBot(e[n-1]),a=n+1>=e.length?-9999:this.getLineTop(e[n+1])-this.getLineBot(s),c=n-1>=0&&e[n-1].transform[4]<=s.transform[4]&&s.transform[4]<=e[n-1].transform[4]+e[n-1].width,d=n+1<e.length&&e[n+1].transform[4]<=s.transform[4]&&s.transform[4]<=e[n+1].transform[4]+e[n+1].width;if(0==n&&a<=l&&d){this.mergeLine(e[n+1],s),e.splice(n,1),n--;continue}if(n==e.length-1&&o<=l&&c){this.mergeLine(e[n-1],s),e.splice(n,1),n--;continue}let h=-1;o>a&&d&&a<=l?h=n+1:o<=a&&c&&o<=l?h=n-1:o<=a&&d&&a<=l?h=n+1:o>a&&c&&o<=l&&(h=n-1),h>=0?(this.mergeLine(e[h],s),e.splice(n,1),n--):n++}}isSmallLine(e){return e.height<s.PdfConst.LINE_SMALL_HEIGHT}mergeLine(e,t){for(let n of t.textObjs)this.addTxtToLine(e,n)}findAndMergeAnsQuestBlock(e,t){let n=0;for(;n<e.length;){if("ans"==t&&this.isAnsLine(e[n])||"quest"==t&&this.isQuestLine(e[n])){let s=n,l=-1,o=1,a=[];for(;o<=10;){if((s=n+l*o)<0){l=1,o=1;continue}if(s>=e.length)break;let c=this.isAnsLine(e[s]),d=c||this.isQuestLine(e[s]),h="ans"==t&&c&&m.isSameLine(e[n],e[s]),u=!d&&m.isLineIntersec(e[n],e[s])&&e[s].transform[4]>e[n].transform[4];if((h||u)&&a.push(s),o++,d&&1==l)break;(o>10||d)&&-1==l&&(l=1,o=1)}for(let t of(a.sort((e,t)=>e<t?1:-1),a))for(let s of e[t].textObjs)this.addTxtToLine(e[n],s);for(let t of a)e.splice(t,1),t<n&&n--}n++}}findAndMergeBlock(e){let t=0;for(;t<e.length;){if(this.isAnsLine(e[t])||this.isQuestLine(e[t])){t++;continue}let n=t+1;for(;n<e.length&&e[t].pageIndex==e[n].pageIndex;){let s=this.isAnsLine(e[n])||this.isQuestLine(e[n]);if(m.isLineIntersec(e[t],e[n])&&!s||m.isSameLine(e[t],e[n])){for(let s of e[n].textObjs)this.addTxtToLine(e[t],s);e.splice(n,1),n=t}n++}t++}}isAnsLine(e){let t=e.strLine.trim().match(/[\s\|\.]+[AB\u0412CDEFGHIJK]\s*\./g);return null!=t&&t.length>0}isQuestLine(e){let t=s.PdfConst.QUESTION_PATTERN.join("|"),n=e.strLine.replace(/\|/g,"").toLowerCase().trim().match(t);return null!=n&&n.length>0}encodeLines(e,t){let n="",l=0;for(let o of t){if(o.height<s.PdfConst.LINE_SMALL_HEIGHT){l-1>=0&&!t[l-1].bottom&&(t[l-1].bottom=m.getBottomLine(e,l-1,t)[0]),l+1<t.length&&!t[l+1].top&&(t[l+1].top=m.getTopLine(e,l+1,t)[0]);let a=l-1<0?-9999:this.getLineTop(o)-this.getLineBot(t[l-1]),c=l+1>=t.length?-9999:this.getLineTop(t[l+1])-this.getLineBot(o),d=l-1>=0&&t[l-1].transform[4]<=o.transform[4]&&o.transform[4]+o.width<=t[l-1].transform[4]+t[l-1].width,h=l+1<t.length&&t[l+1].transform[4]<=o.transform[4]&&o.transform[4]+o.width<=t[l+1].transform[4]+t[l+1].width,u=1.2*s.PdfConst.LINE_SMALL_HEIGHT;Math.abs(a)>=u&&Math.abs(c)>=u?n+="L":n+=-9999==a?"3":-9999==c?"4":a>c&&h?"2":a<=c&&d?"1":a<=c&&h?"2":a>c&&d?"1":"L"}else n+="L";l++}return n}getLineTop(e){return e.top?e.top:e.transform[5]}getLineBot(e){return e.bottom?e.bottom:e.transform[5]+e.height}splitLine(e,t,n,s,l){let o=l[e],a=m.calIndexPos(o.textObjs,t,n,s,!0),c=this.newLine(o.textObjs[0],o.pageIndex),d=a[2],h=a[1],u=o.textObjs[d],x=u.transform,p={str:u.str.substr(0,h),width:a[4]-x[4],height:u.height,fontName:u.fontName,transform:[x[0],x[1],x[2],x[3],x[4],x[5]]},f={str:u.str.substr(h),width:u.width-p.width,height:u.height,fontName:u.fontName,transform:[x[0],x[1],x[2],x[3],a[4],x[5]]},g=o.textObjs;o.textObjs=[],c.textObjs=[];for(let e=0;e<g.length;e++)e<d?this.addTxtToLine(o,g[e]):e>d?this.addTxtToLine(c,g[e]):(this.addTxtToLine(o,p),this.addTxtToLine(c,f));return this.calculateSize(o),this.calculateSize(c),e==l.length-1?l.push(c):l.splice(e+1,0,c),c}findAndMergeSmallLine(e,t,n){let s=0,l=e.matchAll(n),o=[];for(;;){let e=l.next();if(e.done)break;let n=e.value[0],a=e.value.index,c=0,d=[];for(let e=0;e<n.length;e++)"L"==n[e]?c=a+e:d.push(a+e);for(let e of d){for(let n of t[e].textObjs)this.addTxtToLine(t[c],n);t[c].top=void 0,t[c].bottom=void 0,o.push(e)}s++}for(let e of(o.sort((e,t)=>e<t?1:-1),o))t.splice(e,1);return s}newLine(e,t){let n={strLine:"",transform:[],textObjs:[],pageIndex:t,width:0,height:0,txtLength:0};return n.transform[4]=e.transform[4],n.transform[5]=e.transform[5],n.height=e.height,n.width=e.width,n.txtLength=e.str.length,n.textObjs.push(e),n}addTxtToLine(e,t){t.transform[4]<e.transform[4]&&(e.transform[4]=t.transform[4]),t.transform[5]<e.transform[5]&&(e.transform[5]=t.transform[5]),t.transform[5]+t.height>e.transform[5]+e.height&&(e.height=t.transform[5]+t.height-e.transform[5]),t.transform[4]+t.width>e.transform[4]+e.width&&(e.width=t.transform[4]+t.width-e.transform[4]),e.txtLength+=t.str.length,e.textObjs.push(t);let n=e.transform[4]+e.width,s=e.height;for(let t of e.textObjs)t.transform[4]+t.width>n&&(n=t.transform[4]+t.width),t.transform[5]+t.height>e.transform[5]+s&&(s=t.transform[5]+t.height-e.transform[5]);e.width=n-e.transform[4],e.height=s}static transform(e,t){return pdfjsLib.Util.transform(e,t)}render(e,t,n,s){for(var l,o=e.length,a=0;a<o;a++){var c=document.createElement("div");c.className="pdf-page",c.id="page-"+a,null===(l=document.getElementById(t))||void 0===l||l.appendChild(c),this.renderPage(e[a],n,s)}}calculateSize(e){if(0==e.textObjs.length)return;e.textObjs.sort((e,t)=>1e6*Math.floor(e.transform[4])+e.transform[5]>1e6*Math.floor(t.transform[4])+t.transform[5]?1:-1),e.strLine="";let t=0,n=0,l=0,o=0,a=9999,c=0,d=9999;for(let h of e.textObjs){let u=m.isObjIntersec(e.textObjs[0],h),x=(l=h.transform[4])-n>s.PdfConst.SPLIT_MARGIN&&""!=h.str.trim()||o!=h.transform[5]?"|":"";e.strLine+=x+h.str,l<d&&(d=l);let p=h.transform[4]+h.width;u&&(n=p),p>t&&u&&(t=p),u&&(o=h.transform[5]),h.transform[5]<a&&(a=h.transform[5]),h.transform[5]+h.height>c&&(c=h.transform[5]+h.height)}e.transform[4]=d,e.transform[5]=a,e.width=t-d,e.height=c-a,e.transform[0]=a,e.transform[1]=c;let h=s.PdfConst.TVCN_CHAR,u=e.strLine;for(let e of h)u=u.replace(RegExp(e[0],"g"),e[1]);e.strLine=u}renderPage(e,t,n){var s=e._pageIndex,l=e.getViewport({scale:t});let o=.8*l.width;var a=document.createElement("canvas"),c=document.getElementById("page-"+s);null==c||c.appendChild(a),a.id="canvas"+s;var d=a.getContext("2d",{alpha:!1});a.height=l.height,a.width=l.width,a.style.height=l.height*o/l.width+"px",a.style.width=o+"px",c&&(c.style.width=a.style.width,c.style.height=a.style.height);let h={canvasContext:d,transform:[1,0,0,1,0,0],viewport:l,annotationMode:pdfjsLib.AnnotationMode.ENABLE_FORMS,optionalContentConfigPromise:this.optionalContentConfigPromise,annotationCanvasMap:new Map,pageColors:{background:"Canvas",foreground:"CanvasText"}};e.render(h).promise.then(function(){n&&n(d,e._pageIndex,l)})}constructor(){let e=document.createElement("canvas");this.tempCanvas=e.getContext("2d"),this.ascentCache=new Map,this.imageCache=[]}}e.exports=class{get totalNumberQuestion(){return this.questionList.filter(e=>e.tempData.isSelect&&e.answers.length).length}updateStatusCallback(e){}onCompleteCallback(e,t){e.length>0?(this.startQuestion=e[0].num,this.labelHolderSize.width=2*t[0].canvas.width,this.rootQuestionInfo=e,this.rootCanvases=t.map(e=>e.canvas),this.rootHeaderPosition={pageIndex:0,top:1,left:e[0].positions[0].left,width:e[0].positions[0].left+e[0].positions[0].width<t[0].canvas.width?e[0].positions[0].width:t[0].canvas.width-e[0].positions[0].left,heigh:e[0].positions[0].top-1},this.processData()):(this.errAnalyzingPdf=!0,this.isShowLoadingFileExam=!1)}cloneCanvas(){let e=this.rootCanvases;for(let t=0;t<e.length;t++){let n=e[t],s=document.createElement("canvas");s.width=n.width,s.height=n.height;let l=document.createElement("canvas");l.width=n.width,l.height=n.height;let o=s.getContext("2d");null==o||o.drawImage(n,0,0,n.width,n.height,0,0,n.width,n.height);let a=l.getContext("2d");null==a||a.drawImage(n,0,0,n.width,n.height,0,0,n.width,n.height),o&&a&&this.clonedCtxForCreate.push(a)}}processData(){this.questionList=[],this.abcdLabelPos={},this.groupImages={},this.totalInGroupTracking=0,this.questionLabelMap=[],this.groupLengths=[],this.countGroup=0,this.labelsUrls=[],this.labelsBase64s=[],this.firstInGroupIndexes=[],this.clonedCtxForCreate=[],this.cloneCanvas();let e=this.clonedCtxForCreate[0].canvas.width;this.rootQuestionInfo.forEach(t=>{t.positions.forEach(t=>{t.width+t.left>e&&(t.width=e-t.left)})});let t=this.rootQuestionInfo,n=this.clonedCtxForCreate;t.forEach(e=>{e.remove.heigh=Math.round(e.remove.heigh),e.remove.width=Math.round(e.remove.width),e.remove.top=Math.round(e.remove.top),e.remove.left=Math.round(e.remove.left),e.positions.forEach(e=>{e.heigh=Math.round(e.heigh),e.width=Math.round(e.width),e.top=Math.round(e.top),e.left=Math.round(e.left)}),e.help&&(e.help.remove&&(e.help.remove.heigh=Math.round(e.help.remove.heigh),e.help.remove.width=Math.round(e.help.remove.width),e.help.remove.left=Math.round(e.help.remove.left),e.help.remove.top=Math.round(e.help.remove.top)),e.help.positions.forEach(e=>{e.heigh=Math.round(e.heigh),e.width=Math.round(e.width),e.top=Math.round(e.top),e.left=Math.round(e.left)})),e.answers.length>0&&e.answers.forEach(e=>{e.remove.heigh=Math.round(e.remove.heigh),e.remove.width=Math.round(e.remove.width),e.remove.top=Math.round(e.remove.top),e.remove.left=Math.round(e.remove.left),e.positions.forEach(e=>{e.heigh=Math.round(e.heigh),e.width=Math.round(e.width),e.top=Math.round(e.top),e.left=Math.round(e.left)})})});let s=document.createElement("canvas");s.width=this.labelHolderSize.width,s.height=this.labelHolderSize.height;let l=s.getContext("2d"),o=0,a=()=>{l&&(this.labelsBase64s[o]=l.canvas.toDataURL("image/png"),o++,l.clearRect(0,0,l.canvas.width,l.canvas.height)),d.left=0,d.top=0},c=0,d={left:0,top:0,locate:0},h=[],u=e=>{let t=!0;for(let n=0;n<e.length;n++)if(1==e[n].remove.width||1==e[n].remove.heigh){t=!1;break}return t};t.forEach(e=>{h.push(e.answers.length)});for(let e=0;e<t.length;e++)if(u(t[e].answers)&&t[e].answers.length==Math.max(...h)){t[e].answers.forEach(e=>{null==l||l.drawImage(n[e.remove.pageIndex].canvas,e.remove.left,e.remove.top,e.remove.width,e.remove.heigh,d.left,d.top,e.remove.width,e.remove.heigh),this.abcdLabelPos[e.label]={left:d.left,top:d.top},d.left=d.left+e.remove.width+5});break}this.examHeader=this.cropperService.getSingleImgData(this.rootHeaderPosition,n);for(let e=0;e<t.length;e++){let s={isFixAns:t[e].isFixAns?1:0,forcedFixAns:!!t[e].isFixAns,groupType:0,original:"",debugView:"",group:t[e].group,groupUrl:this.groupImages["image_group_".concat(t[e].group)]?this.groupImages["image_group_".concat(t[e].group)]:"",question:{label:t[e].num,posit:{top:0,left:0,locate:0},url:"",urlExcludeLabelOnly:"",width:1,height:1,remove:{x:1,y:1,width:1,height:1,url:this.cropperService.getSingleImgData(t[e].remove,n),left:0,top:0}},answers:[],help:{num:t[e].num,url:""},tempData:{sort:e,point:0,answerType:1,answerConfig:{},answerResult:[],isShowAttach:!1,questionMedia:[],isSelect:!0,isShowHelp:!1},rootIndex:e},h=t[e].positions;if(s.original=this.cropperService.getScatteredImgData(h,n),t[e].isGroup){this.groupLengths.push(this.totalInGroupTracking),this.totalInGroupTracking=0,this.countGroup++,s.isGroup=!0;var x=this.cropperService.getScatteredImgData(t[e].positions,n);this.groupImages["image_group_".concat(t[e].num)]=x}else{c++,this.totalInGroupTracking++,l&&0!=c&&d.left+t[e].remove.width>l.canvas.width?(d.left=0,d.top=d.top+this.maxQuestionLabelHeight+5,this.maxQuestionLabelHeight=0,l&&d.top+t[e].remove.heigh>l.canvas.height&&a(),null==l||l.drawImage(n[t[e].remove.pageIndex].canvas,t[e].remove.left,t[e].remove.top,t[e].remove.width,t[e].remove.heigh,d.left,d.top,t[e].remove.width,t[e].remove.heigh),s.question.remove.left=d.left,s.question.remove.top=d.top,this.questionLabelMap.push({locate:o,left:d.left,top:d.top,width:t[e].remove.width,height:t[e].remove.heigh}),d.left=d.left+t[e].remove.width+5):(l&&d.top+t[e].remove.heigh>l.canvas.height&&a(),null==l||l.drawImage(n[t[e].remove.pageIndex].canvas,t[e].remove.left,t[e].remove.top,t[e].remove.width,t[e].remove.heigh,d.left,d.top,t[e].remove.width,t[e].remove.heigh),s.question.remove.left=d.left,s.question.remove.top=d.top,this.questionLabelMap.push({locate:o,left:d.left,top:d.top,width:t[e].remove.width,height:t[e].remove.heigh}),d.left=d.left+t[e].remove.width+5,t[e].remove.heigh>this.maxQuestionLabelHeight&&(this.maxQuestionLabelHeight=t[e].remove.heigh)),this.cropperService.fillColor("#ffffff",n[t[e].remove.pageIndex],t[e].remove.left,t[e].remove.top,t[e].remove.width,t[e].remove.heigh),s.question.urlExcludeLabelOnly=1==h.length?this.cropperService.getSingleImgData(h[0],n):this.cropperService.getScatteredImgData(h,n),s.question.remove.x=t[e].remove.left-h[0].left,s.question.remove.y=t[e].remove.top-h[0].top,s.question.remove.width=t[e].remove.width,s.question.remove.height=t[e].remove.heigh,t[e].answers.length>0?t[e].answers.forEach(e=>{let t={label:e.label,posit:{left:0,top:0,locate:0},url:"",x:e.positions[0].left-h[0].left,y:e.positions[0].top-h[0].top,width:1,height:1,remove:{x:e.remove.left-h[0].left,y:e.remove.top-h[0].top,xAns:e.remove.left-e.positions[0].left,yAns:e.remove.top-e.positions[0].top,width:e.remove.width,height:e.remove.heigh,url:this.cropperService.getSingleImgData(e.remove,n),left:0,top:0}};if(h.length>1&&h[0].pageIndex!==e.remove.pageIndex&&(t.remove.y=e.remove.top-h[1].top+h[0].heigh),this.cropperService.fillColor("#ffffff",n[e.remove.pageIndex],e.remove.left,e.remove.top,e.remove.width,e.remove.heigh),h.length>1){for(let n=0;n<h.length;n++)if(h[n].pageIndex==e.positions[0].pageIndex){t.y=0==n?e.positions[0].top-h[n].top:e.positions[0].top-h[n].top+h[0].heigh;break}}if(e.isCorrect&&(s.tempData.answerResult=[e.label]),1==e.positions.length)t.url=this.cropperService.getSingleImgData(e.positions[0],n),t.width=e.positions[0].width,t.height=e.positions[0].heigh;else{t.url=this.cropperService.getScatteredImgData(e.positions,n);let s=e.positions.filter(e=>!e.inactive);t.width=this.cropperService.maxWidthTo(s.length,e.positions),t.height=this.cropperService.sumHighTo(s.length,e.positions)}s.answers.push(t),e.positions.forEach(e=>{this.cropperService.fillColor("#ffffff",n[e.pageIndex],e.left,e.top,e.width,e.heigh)})}):t[e].strAns&&void 0!==t[e].strAns?(s.tempData.answerType=4,s.tempData.answerResult.push(t[e].strAns||"")):s.tempData.answerType=3;let u=t[e].help;if(u&&(u.remove&&this.cropperService.fillColor("#ffffff",n[u.remove.pageIndex],u.remove.left,u.remove.top,u.remove.width,u.remove.heigh),u.positions&&u.positions.length>0&&(s.help.url=this.cropperService.getScatteredImgData(u.positions,n))),1==h.length){var p=h[0];if(s.answers.length){var[f]=s.answers;p.heigh=f.y}s.question.url=this.cropperService.getSingleImgData(p,n),s.question.width=p.width,s.question.height=p.heigh}else{s.question.url=this.cropperService.getScatteredImgData(h,n);let e=h.filter(e=>!e.inactive);s.question.width=this.cropperService.maxWidthTo(e.length,h),s.question.height=this.cropperService.sumHighTo(e.length,h)}this.questionList.push(s)}}for(let e=0;e<this.questionList.length;e++)this.questionList[e].tempData.point=this.totalNumberQuestion?Number(this.totalPoint/this.totalNumberQuestion):0,this.questionList[e].index=e;let g=0;for(let e=0;e<this.groupLengths.length;e++)this.firstInGroupIndexes.push(g+this.groupLengths[e]),g+=this.groupLengths[e];this.completeCropper()}generateIdRequired(e){let t="z",n="abcdefghijklmnopqrstuvwxyz0123456789",s=n.length;for(let l=0;l<e;l++)t+=n.charAt(Math.floor(Math.random()*s));return t}createElementImage(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;var n="";return t&&(n=' style="width:'.concat((100*t[1].width/t[0].width).toFixed(2),'%"')),e?'<p><img class="quill-image" src="'.concat(e,'"').concat(n,"/></p>"):""}completeCropper(){let e=[],t=[],n=this.quizId,s=(10/this.questionList.filter(e=>e.tempData.isSelect&&e.answers.length).length).toFixed(2);t=this.questionList.map(t=>{(!t.group||e.length+1!=t.group)&&(e.length||t.group)||e.push({id:this.generateIdRequired(7),quizId:n,questions:[],content:this.createElementImage(t.groupUrl),title:"",audios:[]});let l=e[e.length-1],o={id:this.generateIdRequired(7),content:this.createElementImage(t.question.urlExcludeLabelOnly),quizId:n,groupId:l.id,point:t.tempData.isSelect&&t.answers.length?s:0,label:"C\xe2u",number:t.question.label,type:"TN",options:t.answers.map(e=>({text:e.label,keys:(t.tempData.answerResult||[]).includes(e.label)})),explain:this.createElementImage(t.help.url),level:"",shuffle:!!t.isFixAns};return l.questions.push(o.id),o}),this.callback({status:"done",data:{groups:e,questions:t,quizId:this.quizId}})}parsePdf(e){let t=new v;t.loadPdf(e,e=>{let n=e.length,l=[],o=[],a=document.createElement("div");a.id="hiddenWrapper",a.style.width="1px",a.style.height="1px",a.style.overflow="hidden",a.style.opacity="0",a.style.zIndex="-9999",a.style.position="fixed",a.style.top="0",a.style.left="0",document.body.appendChild(a);let c=document.createElement("div"),d="canvasWrapper";c.id=d,a.appendChild(c);let h=new Date().getTime(),u=[];t.render(e,d,s.PdfConst.RENDER_SCALE,(t,s,a)=>{if(null!=t&&(l[s]=t,o[s]=a),u.push(1),this.updateStatusCallback&&this.updateStatusCallback("Rendering: ".concat(u.length,"/").concat(n)),u.length==n){let t=new Date().getTime();this.updateStatusCallback&&this.updateStatusCallback("Render done: "+(t-h)/1e3+" secs"),this.startAnalyze(l,o,e)}})})}startAnalyze(e,t,n){let l=n.length,a=[],c=[],d=[],u=[],p=new v,f=new Date().getTime();for(let g=0;g<l;g++){let m=g,v=p.getImages(n[g],m);for(let e of v)u.push(e);n[g].getTextContent().then(n=>{for(let e of v)n.items.push(this.imgToTextObj(e,n.items.length>0?n.items[0].fontName:""));var g,b=p.getLines(n,m,e[m],t[m]);if(c=c.concat(b),d[m]=n.styles,a.push(1),a.length==l){c.sort((e,t)=>1e7*e.pageIndex+(e.transform.length>0?e.transform[5]:0)-(1e7*t.pageIndex+(t.transform.length>0?t.transform[5]:0))),p.findAndSplitQuestAnsLine(c,d,e),""!=s.PdfConst.DRAW_RESULT&&console.log(c);let t=this.findEntityPos(c,d,e,p.imageCache,0),n=!1;for(let e of t)if(e.type==o.TYPE_NAME){n=!0;break}if(n||(t=this.findEntityPos(c,d,e,p.imageCache,1)),0==t.length)return void(this.onCompleteCallback&&this.onCompleteCallback([],e));let l=t[0].type==x.TYPE_NAME,a=l?JSON.parse(t[0].str):null,m=new Map,v=new Map;if(l){for(let e of a.main)m.set(e.num,e.str);for(let e of a.sub)v.set(e.num,e.str)}let b=this.getQuestionInfo(t,c,e,m);for(let e of(b.forEach(e=>{if(!m.has(e.num)&&!v.has(e.num)&&e.help&&e.help.text){let t=h.getAnsFromHelp(e.help.text);""!=t&&v.set(e.num,t)}}),b)){if(!e.isGroup&&0==e.answers.length&&m.has(e.num)){let t={pageIndex:e.remove.pageIndex,top:e.remove.top-1,left:e.remove.left-1,width:1,heigh:1};for(let n of["A","B","C","D"]){let s={label:n,remove:t,positions:[t]};m.get(e.num)==n&&(s.isCorrect=!0),e.answers.push(s)}e.isFixAns=!0}if(!e.isGroup&&0==e.answers.length&&!m.has(e.num)&&v.has(e.num)&&(e.strAns=v.get(e.num)),!e.isGroup&&e.answers.length>0&&!m.has(e.num)&&v.has(e.num))for(let t of e.answers)t.label==(null===(g=v.get(e.num))||void 0===g?void 0:g.toUpperCase().substring(0,1))&&(t.isCorrect=!0)}let C=new Date().getTime();this.updateStatusCallback&&this.updateStatusCallback("Analyze done: "+(C-f)/1e3+" secs"),this.showOnCanvas(b,t,c,e,u,s.PdfConst.DRAW_RESULT),this.onCompleteCallback&&this.onCompleteCallback(b,e)}})}}imgToTextObj(e,t){return{str:"img",fontName:t,width:e.paintWidth,height:e.paintHeight,transform:[-999,0,0,0,-e.left,-e.top-e.paintHeight]}}findEntityPos(e,t,n,s,l){let g=[],v=!1;var b=[{parser:new a,on:[],off:[]},{parser:new o(l),on:[3,4],off:[6]},{parser:new c,on:[3,6],off:[]},{parser:new d(!1),on:[6,8],off:[0,2]},{parser:new h(!1),on:[6,8],off:[0,2,4]},{parser:new u,on:[],off:[8]},{parser:new x(!1,e=>{for(let t of e)g.unshift(t)}),on:[],off:[2]},{parser:new p,on:[],off:[]},{parser:new f(!1,e=>{if(0!=e.length){if(g.length>0&&g[0].type==x.TYPE_NAME){let t=JSON.parse(e[0].str),n=JSON.parse(g[0].str);n.sub=t.sub,g[0].str=JSON.stringify(n)}else e[0].type=x.TYPE_NAME,g.unshift(e[0])}}),on:[],off:[2]}],C=[8,0,1,2,3,4,5,6,7],T=null;let I=0,y="";for(let s of e){for(let l of((I==e.length-1||s.pageIndex<e[I+1].pageIndex)&&(s.isLastLine=!0),C)){let e=b[l];var w=e.parser.process(g,s,I,T,t[s.pageIndex],n[s.pageIndex]);if(w.length>0){for(let e of w){if(e.type!=c.TYPE_NAME&&e.type!=p.TYPE_NAME&&(y=""),e.type==c.TYPE_NAME){if(!"ABCDEFGH".startsWith(y+e.str))continue;y+=e.str;for(let e=g.length-1;e>=0&&g[e].type==a.TYPE_NAME;e--)g.splice(e,1)}e.type==p.TYPE_NAME&&(s.isFooter=!0),e.type==h.TYPE_NAME&&(v=!0),e.type==u.TYPE_NAME&&v&&b[5].parser.off(),g.push(e)}for(let t of e.on)b[t].parser.on();for(let t of e.off)b[t].parser.off();break}}T=s,I++}for(let e of b)e.parser.off();return g.forEach(t=>{if(!e[t.lineIndex].top){let n=m.getTopLine(s[t.pageIndex],t.lineIndex,e);e[t.lineIndex].top=n[0],1!=t.isIntersec&&(t.isIntersec=n[1])}}),g.forEach(t=>{if(!e[t.lineIndex].bottom){let n=m.getBottomLine(s[t.pageIndex],t.lineIndex,e);e[t.lineIndex].bottom=n[0],1!=t.isIntersec&&(t.isIntersec=n[0])}}),g}showOnCanvas(e,t,n,l,f,g){let v=new Date().getTime(),b=new Map([["A","rgba(18, 0, 255, 0.4)"],["B","rgba(0, 158, 34, 0.4)"],["C","rgba(50, 50, 50, 0.4)"],["D","rgba(132, 0, 137, 0.4)"],["E","rgba(132, 0, 137, 0.4)"],["F","rgba(132, 0, 137, 0.4)"],["G","rgba(132, 0, 137, 0.4)"],["H","rgba(132, 0, 137, 0.4)"]]),C=new Map([[o.TYPE_NAME,"red"],[c.TYPE_NAME,"blue"],[d.TYPE_NAME,"gray"],[x.TYPE_NAME,"green"],[h.TYPE_NAME,"orange"],[u.TYPE_NAME,"pink"],[p.TYPE_NAME,"yellow"],[a.TYPE_NAME,"black"]]);if(g.indexOf("quest")>=0)for(let t of e){for(let e of t.positions)m.drawBox(l[e.pageIndex],t.isGroup?"black":"red",e);for(let e of(m.drawBox(l[t.remove.pageIndex],"yellow",t.remove),t.answers)){for(let t of e.positions)m.drawBox(l[t.pageIndex],b.get(e.label)+"",t,!0);m.drawBox(l[e.remove.pageIndex],"yellow",e.remove),e.isCorrect&&m.drawPoint(l[e.positions[0].pageIndex],"green",e.positions[0])}if(t.help){for(let e of t.help.positions)m.drawBox(l[e.pageIndex],"orange",e);t.help.remove&&m.drawBox(l[t.help.remove.pageIndex],"yellow",t.help.remove)}}if(g.indexOf("line")>=0)for(let e of n)m.drawBox2(l[e.pageIndex],e.height<s.PdfConst.LINE_SMALL_HEIGHT?"red":"rgba(50, 58, 168, 0.4)",e.width,e.height,e.transform);if(g.indexOf("txt")>=0)for(let e of n)for(let t of e.textObjs)""!=t.str.trim()&&m.drawBox2(l[e.pageIndex],e.height<s.PdfConst.LINE_SMALL_HEIGHT?"red":"rgba(132, 0, 137, 0.2)",t.width,t.height,t.transform);if(g.indexOf("img")>=0)for(let e of f)m.drawBox2(l[e.pageIndex],"green",e.paintWidth,e.paintHeight,[0,0,0,0,-e.left,-e.top-e.paintHeight]);if(g.indexOf("pos")>=0)for(let e of t){let t={top:e.transform[5],left:e.transform[4],width:0,heigh:0,pageIndex:e.pageIndex};m.drawPoint(l[e.pageIndex],C.get(e.type)+"",t)}let T=new Date().getTime();this.updateStatusCallback&&this.updateStatusCallback("Draw done: "+(T-v)/1e3+" secs")}getQuestionInfo(e,t,n,l){if(0==e.length)return[];let x=0,f=[],g=new Map,m="",v=!1,b=!1,C=0;for(let T of(e.forEach((n,s)=>{s>0&&null==e[s-1].text&&(e[s-1].text=t.slice(e[s-1].lineIndex,n.lineIndex)),s==e.length-1&&(e[s].text=t.slice(e[s].lineIndex,t.length))}),e.forEach(T=>{let I=":"+T.type;v||T.type!=d.TYPE_NAME&&T.type!=h.TYPE_NAME||(v=!0);let y=null;for(let t=x+1;t<e.length;t++)if((T.type!=o.TYPE_NAME||e[t].type!=c.TYPE_NAME)&&e[t].type!=p.TYPE_NAME){y=e[t];break}let w=n[T.pageIndex].canvas.height-20;if(v||T.type!=a.TYPE_NAME||(C++,f.push({num:C,answers:[],remove:a.getRemoveBox(T,t),positions:a.getBoxes(T,t,y,w),isGroup:!0,text:T.text})),v||T.type!=o.TYPE_NAME||f.push({num:+T.str,answers:[],remove:o.getRemoveBox(T,t),positions:o.getBoxes(T,t,y,w),group:C,text:T.text}),!v&&T.type==c.TYPE_NAME&&f.length>0){let e=f[f.length-1].num,n={label:T.str,remove:c.getRemoveBox(T,t),positions:c.getBoxes(T,t,y,w)};l.size>0&&l.get(e)==n.label&&(n.isCorrect=!0),f[f.length-1].answers.push(n);let o=t[T.lineIndex].strLine.replace(/\|/g,"").trim().match(s.PdfConst.MULTIPLE_ANS_PATTERN.join("|"));null!=o&&o.length>0&&(f[f.length-1].isFixAns=!0),1==T.isIntersec&&(f[f.length-1].isFixAns=!0)}if(!b&&T.type==u.TYPE_NAME&&1==f.length&&m.endsWith(":".concat(o.TYPE_NAME,":").concat(c.TYPE_NAME))&&(b=!0),T.type==u.TYPE_NAME&&b){let e=f[f.length-1].num;g.set(e,{num:e,positions:u.getBoxes(T,t,y,w),text:T.text})}if(T.type!=u.TYPE_NAME||b||(g.clear(),v=!0),v&&T.type==o.TYPE_NAME){let e=+T.str;g.get(e)||g.set(e,{num:e,positions:o.getBoxes(T,t,y,w),remove:o.getRemoveBox(T,t),text:T.text})}m.endsWith(I)||T.type==p.TYPE_NAME||(m+=I),x++}),f))T.isGroup||(T.help=g.get(T.num),1==T.answers.length&&(T.answers=[]));return f}constructor(e,t){var n,l,o;console.log(this),this.cropperService=new g,this.labelHolderSize={width:3500,height:3500},this.totalPoint=10,this.quizId=e,this.callback=t;let a={RENDER_SCALE:2,LINE_SMALL_HEIGHT:8,SPLIT_MARGIN:3,INTERSEC_MARGIN:10,LINE_MAGIN:2,MARGIN_LEFT:2,ENABLE_IMAGE_PROCESS:!0,STEP_SIZE:3,CROP_FULL_WIDTH:!0,OVERLAP:.5,QUESTION_PATTERN:["(^c\xe2u\\s*\\d{1,4}[^0-9])","(^câu\\s*\\d{1,4}[^0-9])","(^c\xa9u\\s*\\d{1,4}[^0-9])","(^ca‚u\\s*\\d{1,4}[^0-9])","(^b\xe0i\\s*\\d{1,4}[^0-9])","(^bài\\s*\\d{1,4}[^0-9])","(^cau\\s*\\d{1,4}[^0-9])","(^bai\\s*\\d{1,4}[^0-9])","(^question\\s*\\d{1,4}[^0-9])","(^questions\\s*\\d{1,4}[^0-9])","(^\\[\\d{1,4}\\][^0-9])","(^\\d+\\s*\\(nb\\))","(^\\d+\\s*\\(th\\))","(^\\d+\\s*\\(vd\\))","(^\\d+\\s*\\(vdc\\))","(^c\xe2u\\s*\\d{1,4}[\\s\\.:]*$)","(^câu\\s*\\d{1,4}[\\s\\.:]*$)","(^c\xa9u\\s*\\d{1,4}[\\s\\.:]*$)","(^ca‚u\\s*\\d{1,4}[\\s\\.:]*$)","(^b\xe0i\\s*\\d{1,4}[\\s\\.:]*$)","(^bài\\s*\\d{1,4}[\\s\\.:]*$)","(^cau\\s*\\d{1,4}[\\s\\.:]*$)","(^bai\\s*\\d{1,4}[\\s\\.:]*$)","(^questions\\s*\\d{1,4}[\\s\\.:]*$)","(^question\\s*\\d{1,4}[\\s\\.:]*$)"],QUESTION_PATTERN2:["(^(\\d+\\s*\\.)\\s*[\\.0-9])","(^(\\d+\\s*\\.)\\s*\\(\\s*\\d+\\s*\\))","(^(\\d+\\s*\\.)\\s*[^\\s]\\s*[^\\s0-9])","(^\\d+\\s*\\.\\s*$)"],BREAK_LINE_PATTERN:["(^C\xe2u\\s*\\d+\\s*[:\\.]\\s*[Aa]\\s*\\.)","(^C\xa9u\\s*\\d+\\s*[:\\.]\\s*[Aa]\\s*\\.)","(^B\xe0i\\s*\\d+\\s*[:\\.]\\s*[Aa]\\s*\\.)","(^Cau\\s*\\d+\\s*[:\\.]\\s*[Aa]\\s*\\.)","(^Bai\\s*\\d+\\s*[:\\.]\\s*[Aa]\\s*\\.)","(^Question\\s*\\d+\\s*[:\\.]\\s*[Aa]\\s*\\.)","(^\\d+\\s*[:\\.]\\s*[Aa]\\s*\\.)"],SECTION_PATTERN_LOWER:["(^mark\\s*the\\s*letter)","(^read\\s*the\\s*follow)","(^reading\\s*the\\s*follow)","(^read\\s*the\\s*text)","(^read\\s*the\\s*passage)","(^read\\s*the\\s*paragraph)","(^read\\s*and\\s*choose)","(^put\\s*these\\s*word)","(^supply\\s*the\\s*correct)","(^make\\s*questions?\\s*for)","(^fill\\s*in\\s*the\\s*blank)","(^fill\\s*in\\s*each\\s*numbered)","(write\\s*the\\s*months\\s*in\\s*english)","(write\\s*the\\s*telephone\\s*numbers\\s*in\\s*english)","(^which\\s*of\\s*the\\s*following)","(^choose\\s*the\\s*suitable\\s*word)","(^choose\\s*the\\s*word)","(^choose\\s*the\\s*option)","(^choose\\s*the\\s*item\\s*among)","(^choose\\s*the\\s*underlined\\s*word)","(^combine\\s*two\\s*sentences)","(^each\\s*of\\s*the\\s*following)","(^finish\\s*the\\s*second\\s*sentence)","(^identify\\s*the\\s*underlined)","(^identify\\s*a\\s*mistake)","(^indicate\\s*the\\s*word)","(^indicate\\s*the\\s*correct)","(^indicate\\s*the\\s*sentence)","(^indicate\\s*the\\s*underlined)","(^circle\\s*the\\s*underlined)","(^circle\\s*the\\s*word\\s*whose\\s*underlined)","(^choose\\s*the\\s*underlined)","(^\\*?find\\s*the\\s*word)","(^find\\s*a\\s*mistake)","(^fill\\s*the\\s*circle)","(^listen\\s*to.*conversation)","(^there\\s*are.*blanks\\s*in\\s*the\\s*passage\\s*below)","(^listen\\s*to\\s*the\\s*recording)","(^listen\\s*and\\s*circle)","(^listen\\s*again\\s*and\\s*choose)","(^\\*?listen\\s*and\\s*complete)","(^\\*?choose\\s*the\\s*best)","(^choose\\s*the\\s*correct)","(^put\\s*in\\s*the\\s*correct)","(^complete\\s*the\\s*second\\s*sentence)","(^complete\\s*the\\s*sentences)","(^give\\s*the\\s*correct\\s*form)","(^mark\\s*a,\\s*b,)","(^circle\\s*the\\s*letter)","(^you\\s*will\\s*hear)","(^blacken\\s*the\\s*letter)","(^đọc\\s*đoạn\\s*tr\xedch)","(^dựa\\s*v\xe0o\\s*th\xf4ng\\s*tin\\s*dưới\\s*đ\xe2y)","(^dựa\\s*v\xe0o\\s*c\xe1c\\s*th\xf4ng\\s*tin\\s*được\\s*cung\\s*cấp\\s*dưới\\s*đ\xe2y)","(^section\\s*[0-9abcdefghivx]+)","(^part[^a-z]+[0-9abcdefghivx]+\\s*[\\.:\\-])","(^phần\\s*[0-9abcdefivx]+[\\.:])","(^nh\xf3m\\s*[0-9abcdefivx]+[\\.:])","(^chương\\s*[0-9abcdefivx]+[\\.:])","(^questions?\\s*\\d+\\s*[\\–\\-to]+\\s*\\d+)","(^passage\\s*[0-9abcdefghivx]+)","(^use\\s*the\\s*word\\s*given\\s*in\\s*capitals)","(^tự\\s*luận)"],SECTION_PATTERN_NORMAL:["(^[IVX]+\\s*[\\.\\-\\–]\\s*[A-Z\xc0Ả\xc3\xc1ẠĂẰẲẴẮẶ\xc2ẦẨẪẤẬĐ\xc8ẺẼ\xc9Ẹ\xcaỀỂỄẾỆ\xccỈĨ\xcdỊ\xd2Ỏ\xd5\xd3Ọ\xd4ỒỔỖỐỘƠỜỞỠỚỢ\xd9ỦŨ\xdaỤƯỪỬỮỨỰỲỶỸ\xddỴ]+)","(^[\\d]+\\.[\\d]+\\.[\\d]*\\.*\\s*[A-Z\xc0Ả\xc3\xc1ẠĂẰẲẴẮẶ\xc2ẦẨẪẤẬĐ\xc8ẺẼ\xc9Ẹ\xcaỀỂỄẾỆ\xccỈĨ\xcdỊ\xd2Ỏ\xd5\xd3Ọ\xd4ỒỔỖỐỘƠỜỞỠỚỢ\xd9ỦŨ\xdaỤƯỪỬỮỨỰỲỶỸ\xddỴ]+)","(^[IVX]+\\s*[\\.:]\\s*$)"],KICK_PATTERN:["(^Chọn\\s*[ABВCDEFGHIJK]+)","(^Chon\\s*[ABВCDEFGHIJK]+)"],TVCN_CHAR:[["Α","A"],["В","B"]],HET_PATTERN:["(HẾT)","(H\xcáT)","(HET)","(\\-\\-HT\\-\\-)","(THE\\s*END)","(The\\s*end[^a-z0-9]*$)","(^[^A-Za-z]*Hết[^A-Za-z]*)$"],DAPAN_PATTERN:["(\xc1P \xc1N)","(\xc1P \xc1)","(\xc1P\xc1N)","(ÁP ÁN)","(BẢNG\xc1\xc1)","(KHO\xc1\\s*C\xc2U\\s*TRẮC\\s*NGHIỆM)","(ÁPÁN)","(ANSWER KEYS)","(^KEYS$)","(Bảng\\s*đ\xe1p\\s*\xe1n)","(Đ\xe1p\\s*\xe1n\\s*v\xe0\\s*hướng)","(Dap\\s*an\\s*va\\s*huong)","(Đ\xe1p\\s*\xe1n\\s*[.:]\\s*$)","(Đ\xe1p\\s*\xe1n\\s*$)"],HUONGDAN_PATTERN:["(HƯỚNG\\s*DẪN)","(ƯỚNG\\s*DẪN\\s*GIẢI\\s*CHI)","(GIẢI\\s*TH\xcdCH\\s*CHI\\s*TIẾT)","(Hướng\\s*dẫn\\s*giải)","(Lời\\s*giải)","(LỜI\\s*GIẢI)","(GIẢI\\s*CHI\\s*TIẾT)","(HD:)","(GLOSSARY)"],MULTIPLE_ANS_PATTERN:["([ABCDEFGH]\\s*v\xe0\\s*[ABCDEFGH]\\s*đều)","(Cả\\s*[ABCDEFGH]\\s*v\xe0\\s*[ABCDEFGH])","(Cả\\s*[ABCDEFGH]\\s*,\\s*[ABCDEFGH])","(Cả\\s*3\\s*đ\xe1p\\s*\xe1n)","(Cả\\s*đ\xe1p\\s*\xe1n)","(Tất\\s*cả\\s*đ\xe1p\\s*\xe1n)","(Kết\\s*quả\\s*kh\xe1c)","(Đ\xe1p\\s*\xe1n\\s*kh\xe1c)","(Đ\xe1p\\s*\xe1n\\s*[ABCDEFGH]\\s*v\xe0\\s*[ABCDEFGH])","(Tất\\s*cả\\s*đều)"],DRAW_RESULT:"",SKIP_CHAR:["","√","p","(",")","[","]","{","}",""],FOOTER_PATTERN:["(trang\\s*\\d+)","(Page\\s*\\d+)","(Trang\\s*\\d+)","(TRANG\\s*\\d+)","(^\\d{1,4}$)","(^[\\-\\s]*\\d{1,4}[\\-\\s]*$)"],HELP_ANS_PATTERN:["([\\s\\.]*Chọn\\s*([A-K]))","([\\d\\s\\.:]*Đ\xe1p\\s*\xe1n\\s*([A-K]))","([\\d\\s\\.:]*Đ\xe1p\\s*\xe1n\\s*l\xe0\\s*([A-K]))","([\\d\\s\\.:]*Chọn\\s*đ\xe1p\\s*\xe1n\\s*([A-K]))"],RES_ANS_PATTERN:["(\\d+[.-][^|0-9])"],STRANS_SPLIT:"|/\\"};s.PdfConst.RENDER_SCALE=a.RENDER_SCALE,s.PdfConst.LINE_SMALL_HEIGHT=a.LINE_SMALL_HEIGHT*s.PdfConst.RENDER_SCALE,s.PdfConst.SPLIT_MARGIN=a.SPLIT_MARGIN*s.PdfConst.RENDER_SCALE,s.PdfConst.INTERSEC_MARGIN=a.INTERSEC_MARGIN*s.PdfConst.RENDER_SCALE,s.PdfConst.LINE_MAGIN=a.LINE_MAGIN*s.PdfConst.RENDER_SCALE,s.PdfConst.MARGIN_LEFT=a.MARGIN_LEFT*s.PdfConst.RENDER_SCALE,s.PdfConst.ENABLE_IMAGE_PROCESS=a.ENABLE_IMAGE_PROCESS,s.PdfConst.STEP_SIZE=a.STEP_SIZE,s.PdfConst.CROP_FULL_WIDTH=a.CROP_FULL_WIDTH,s.PdfConst.OVERLAP=a.OVERLAP,s.PdfConst.QUESTION_PATTERN=a.QUESTION_PATTERN,s.PdfConst.QUESTION_PATTERN2=a.QUESTION_PATTERN2,s.PdfConst.BREAK_LINE_PATTERN=a.BREAK_LINE_PATTERN,s.PdfConst.SECTION_PATTERN_LOWER=a.SECTION_PATTERN_LOWER,s.PdfConst.SECTION_PATTERN_NORMAL=a.SECTION_PATTERN_NORMAL,s.PdfConst.KICK_PATTERN=a.KICK_PATTERN,s.PdfConst.TVCN_CHAR=a.TVCN_CHAR,s.PdfConst.HET_PATTERN=a.HET_PATTERN,s.PdfConst.DAPAN_PATTERN=a.DAPAN_PATTERN,s.PdfConst.HUONGDAN_PATTERN=a.HUONGDAN_PATTERN,s.PdfConst.MULTIPLE_ANS_PATTERN=a.MULTIPLE_ANS_PATTERN,s.PdfConst.DRAW_RESULT=a.DRAW_RESULT,s.PdfConst.SKIP_CHAR=a.SKIP_CHAR,s.PdfConst.FOOTER_PATTERN=null!==(n=a.FOOTER_PATTERN)&&void 0!==n?n:["(trang\\s*\\d+)","(Page\\s*\\d+)","(Trang\\s*\\d+)","(TRANG\\s*\\d+)","(^\\d{1,4}$)"],s.PdfConst.HELP_ANS_PATTERN=null!==(l=a.HELP_ANS_PATTERN)&&void 0!==l?l:["([\\s\\.]*Chọn\\s*([ABCDEFGH]))"],s.PdfConst.ANS_PATTERN=null!==(o=a.ANS_PATTERN)&&void 0!==o?o:["([\\s\\|\\.]+[ABCDEFGHIJK][\\s\\|]*[\\.\\)])"]}}},9716:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});let s=n(1117);class l{on(){this.isOn=!0}off(){this.isOn=!1}process(e,t,n,s,l,o){return this.isOn?this.parse(e,t,n,s,l,o):[]}constructor(){this.isOn=!0,this.TYPE="default"}}class o extends l{parse(e,t,n,s,l,o){var a=this.matchPos(t.strLine);if(a.value){let e=null;for(let t=a.value.length-1;t>=0;t--)if(a.value[t]){e=a.value[t];break}if(null==e)return[];let s=e.matchAll(/\d+/g).next(),c=e.length;s.done||e.trim().endsWith(".")||e.trim().endsWith(":")||(c=s.value.index+s.value[0].length);let d=t.strLine.replace(/\|/g,"").toLowerCase().indexOf(e)+c-1;return[{str:this.getNumberFromStr(e),pageIndex:t.pageIndex,lineIndex:n,transform:t.transform,startLeft:m.calIndexPos2(t.textObjs,l,o,d,!0),type:this.TYPE}]}return[]}matchPos(e){let t=e.replace(/\|/g,"").toLowerCase().trim();if(0==this.questType){let e=s.PdfConst.QUESTION_PATTERN.join("|");return t.matchAll(e).next()}{let e=s.PdfConst.QUESTION_PATTERN2.join("|");return t.matchAll(e).next()}}getNumberFromStr(e){var t=e.match(/(\d+)/);return t?t[0]:""}static getRemoveBox(e,t){let n=e.startLeft?e.startLeft[5]:t[e.lineIndex].top,l=e.transform[4]-s.PdfConst.MARGIN_LEFT,o=e.startLeft?e.startLeft[5]+e.startLeft[3]:t[e.lineIndex].bottom;return{pageIndex:e.pageIndex,top:n||20,left:l,heigh:o&&n?o-n:0,width:(e.startLeft?e.startLeft[4]:0)-l}}static getBoxes(e,t,n,l){let o=l;for(let n=e.lineIndex;n<t.length;n++)if(m.isLastLineOfPage(n,t)){let e=t[n].isFooter?t[n-1]:t[n];o=e.transform[5]+e.height+20;break}let a=[],c=e.pageIndex,d=n?n.lineIndex:t.length-1,h=t[e.lineIndex].transform[4]-s.PdfConst.MARGIN_LEFT,u=t[e.lineIndex].top;if(!u)return[];let x=s.PdfConst.CROP_FULL_WIDTH?m.getMaxLineRight(-1,t)+2*s.PdfConst.MARGIN_LEFT:t[e.lineIndex].transform[4]+t[e.lineIndex].width+2*s.PdfConst.MARGIN_LEFT,p=o,f=c,g=e.lineIndex+1;for(;g<=d;g++){let e=t[g].top;if(g!=t.length-1||n||(e=t[g].bottom),!s.PdfConst.CROP_FULL_WIDTH){let e=t[g-1].transform[4]+t[g-1].width+2*s.PdfConst.MARGIN_LEFT;e>x&&(x=e)}let l=t[g-1].transform[4]-s.PdfConst.MARGIN_LEFT;l<h&&(h=l),t[g].isFooter&&e?p=e:(t[g].pageIndex>f&&(t[g-1].isFooter||(p=o),a.push({pageIndex:f,top:u,left:h,width:x-h,heigh:p-u}),u=20,h=m.getMinLineLeft(t[g].pageIndex,t)-s.PdfConst.MARGIN_LEFT),f=t[g].pageIndex,e&&(p=e))}if(g-=1,!n&&m.isLastLineOfPage(g,t)){let e=t[g].isFooter?t[g-1]:t[g];p=e.transform[5]+e.height+20}return m.isFirstLineOfPage(g,t)||a.push({pageIndex:f,top:u,left:h,width:x-h,heigh:p-u}),a}constructor(e){super(),this.TYPE=o.TYPE_NAME,this.questType=e}}o.TYPE_NAME="question";class a extends l{parse(e,t,n,l,a,c){let d=t.strLine.replace(/\|/g,"").toLowerCase().trim().match(s.PdfConst.SECTION_PATTERN_LOWER.join("|")),h=null!=d&&d.length>0;if(h||(h=null!=(d=t.strLine.replace(/\|/g,"").trim().match(s.PdfConst.SECTION_PATTERN_NORMAL.join("|")))&&d.length>0),h&&d){let s=t.strLine.indexOf(d[0])+d[0].length+1,l=[d[0][0]];for(let t=e.length-1;t>=0;t--){if(e[t].type==o.TYPE_NAME){l.push(".Q");break}l.push(e[t].str[0])}return"HGFEDCBA.Q".endsWith(l.join(""))?[]:[{str:d[0],pageIndex:t.pageIndex,lineIndex:n,transform:t.transform,startLeft:m.calIndexPos(t.textObjs,a,c,s,!0),type:this.TYPE}]}return[]}static getRemoveBox(e,t){let n=t[e.lineIndex].top,l=e.transform[4]-s.PdfConst.MARGIN_LEFT,o=t[e.lineIndex].bottom;return{pageIndex:e.pageIndex,top:n||20,left:l,heigh:o&&n?o-n:0,width:l-l}}static getBoxes(e,t,n,l){let o=[],a=e.pageIndex,c=n?n.lineIndex:t.length-1,d=m.getMinLineLeft(-1,t)-s.PdfConst.MARGIN_LEFT,h=t[e.lineIndex].top;if(!h)return[];let u=m.getMaxLineRight(-1,t)+2*s.PdfConst.MARGIN_LEFT,x=l,p=a,f=e.lineIndex+1;for(;f<=c;f++){let e=t[f].top;if(t[f].isFooter&&e)x=e;else if(t[f].pageIndex>p&&(o.push({pageIndex:p,top:h,left:d,width:u-d,heigh:x-h}),h=20),p=t[f].pageIndex,e){x=e;break}}return f>=t.length&&(f=t.length-1),m.isFirstLineOfPage(f,t)||o.push({pageIndex:p,top:h,left:d,width:u-d,heigh:x-h}),o}constructor(){super(),this.TYPE=a.TYPE_NAME}}a.TYPE_NAME="section";class c extends l{parse(e,t,n,s,l,o){var a=[],c=this.matchPos(t.strLine,!1);if(0==c.length&&(c=this.matchPos(t.strLine,!0)),c.length>0)for(let e of c)a.push({str:e.value,pageIndex:t.pageIndex,lineIndex:n,transform:m.calIndexPos(t.textObjs,l,o,e.index),startLeft:m.calIndexPos2(t.textObjs,l,o,e.index+1),type:this.TYPE});return a}static getRemoveBox(e,t){let n=e.startLeft?e.startLeft[5]-2:t[e.lineIndex].top,l=e.transform[4]-s.PdfConst.MARGIN_LEFT,o=e.startLeft?e.startLeft[5]+e.startLeft[3]:t[e.lineIndex].bottom;return{pageIndex:e.pageIndex,top:n||20,left:l,heigh:o&&n?o-n:0,width:(e.startLeft?e.startLeft[4]:0)-l}}static getBoxes(e,t,n,l){let o=s.PdfConst.MARGIN_LEFT,a=[],d=t[e.lineIndex].top,h=t[e.lineIndex].bottom;if(!d||!h)return[];let u=h,x=e.transform[4]-o,p=n&&e.lineIndex==n.lineIndex?n.transform[4]-o:t[e.lineIndex].transform[4]+t[e.lineIndex].width+o;if(a.push({pageIndex:e.pageIndex,top:d,left:x,width:p-x,heigh:h-d}),n&&n.lineIndex==e.lineIndex)return a;d=h,h=l,p=0;let f=e.pageIndex,g=0;for(g=e.lineIndex+1;g<t.length;g++){if(h==l&&m.isLastLineOfPage(g,t)){let e=t[g].isFooter?t[g-1]:t[g];h=e.transform[5]+e.height+20}let n=t[g].top;if(g>e.lineIndex+1&&!t[g-1].isFooter){let e=t[g-1].transform[4]+t[g-1].width+o;e>p&&(p=e);let n=t[g-1].transform[4]-o;n<x&&(x=n)}if(t[g].isFooter&&n)g-e.lineIndex>1?(h=t[g-1].transform[5]+t[g-1].height+s.PdfConst.LINE_MAGIN,x=t[e.lineIndex+1].transform[4]-o):h=t[e.lineIndex].bottom;else if(t[g].pageIndex>f&&(h&&h-d>s.PdfConst.LINE_SMALL_HEIGHT&&g-e.lineIndex>1&&a.push({pageIndex:f,top:d,left:x,width:p-x,heigh:h-d}),u=d=20),f=t[g].pageIndex,n){h=n;break}}if(g>=t.length&&(g=t.length-1),g-e.lineIndex>1&&t[g-1].transform[5]>u&&!m.isFirstLineOfPage(g,t)){let n=20==d?t[g].transform[4]:t[e.lineIndex+1].transform[4];h&&h-d>s.PdfConst.LINE_SMALL_HEIGHT&&a.push({pageIndex:f,top:d,left:n,width:p-n,heigh:h-d})}n&&n.type==c.TYPE_NAME&&n.transform[4]>t[n.lineIndex].transform[4]+25*s.PdfConst.RENDER_SCALE&&(p=n.transform[4]-o,d=t[n.lineIndex].top,x=t[n.lineIndex].transform[4]-o,h=t[n.lineIndex].bottom,d&&h&&h-d>s.PdfConst.LINE_SMALL_HEIGHT&&a.push({pageIndex:f,top:d,left:x,width:p-x,heigh:h-d}));for(let e=a.length-1;e>=1;e--)a[e].left-(a[e-1].left+a[e-1].width)>=20*s.PdfConst.RENDER_SCALE&&a.splice(e,1);return a}matchPos(e,t){for(var n=t?e.toUpperCase():e,l=s.PdfConst.ANS_PATTERN,o=RegExp("[\\s\\|\\.]"),a=n.matchAll(l),c=[];;){var d=a.next();if(d.done)break;for(var h=0,u=d.value.index;u<n.length&&o.test(n[u]);u++)h++;let e=d.value[0].substr(h,1);("A"!=e||n.replace(/\|/g,"").trim().startsWith("A"))&&c.push({value:e,index:d.value.index+h})}return c}constructor(){super(),this.TYPE=c.TYPE_NAME}}c.TYPE_NAME="answer";class d extends l{parse(e,t,n,l,o,a){let c=t.strLine.replace(/\|/g,"").trim().match(s.PdfConst.HET_PATTERN.join("|"));return null!=c&&c.length>0?[{str:t.strLine,pageIndex:t.pageIndex,lineIndex:n,transform:t.transform,type:this.TYPE}]:[]}static getBoxes(e,t,n,s){return[]}strContains(e,t){for(let n of t)if(e.indexOf(n)>=0)return!0;return!1}constructor(e){super(),null!=e&&(this.isOn=e),this.TYPE=d.TYPE_NAME}}d.TYPE_NAME="het";class h extends l{parse(e,t,n,l,o,a){let c=t.strLine.replace(/\|/g,"").trim().match(s.PdfConst.DAPAN_PATTERN.join("|"));return null!=c&&c.length>0?[{str:t.strLine,pageIndex:t.pageIndex,lineIndex:n,transform:t.transform,type:this.TYPE}]:[]}static getBoxes(e,t,n,s){return[]}static getAnsFromHelp(e){for(let t of e){let e=t.strLine.replace(/\|/g,"").trim().match(s.PdfConst.HELP_ANS_PATTERN.join("|"));if(null!=e){for(let t=0;t<e.length;t++)if(null!=e[t]&&1==e[t].length)return e[t]}}return""}strContains(e,t){for(let n of t)if(e.indexOf(n)>=0)return!0;return!1}constructor(e){super(),null!=e&&(this.isOn=e),this.TYPE=h.TYPE_NAME}}h.TYPE_NAME="dapan";class u extends l{parse(e,t,n,l,o,a){let c=t.strLine.replace(/\|/g,"").trim().match(s.PdfConst.HUONGDAN_PATTERN.join("|"));return null!=c&&c.length>0?[{str:t.strLine,pageIndex:t.pageIndex,lineIndex:n,transform:t.transform,type:this.TYPE}]:[]}static getBoxes(e,t,n,s){return D.QuestionParser.getBoxes(e,t,n,s)}strContains(e,t){for(let n of t)if(e.indexOf(n)>=0)return!0;return!1}constructor(){super(),this.TYPE=u.TYPE_NAME}}u.TYPE_NAME="huongdan";class x extends l{parse(e,t,n,s,l,o){var a=t.strLine.replace(/\|/g,"").replace(/\s*\.*\-*:*,*;*/g,"");return a=(a=(a=(a=(a=a.replace(/C\xe2u/g,"")).replace(/\u0110\xe1p\xe1n/g,"")).replace(/\u0110\xe1p/g,"")).replace(/\xe1n/g,"")).replace(/\u0110\/A/g,""),/^[0-9ABCDEFGHabcdefgh]+$/g.test(a)&&a.length>=2&&(null==this.firstLine&&(this.firstLine=t,this.lineIdx=n),this.str+=a),[]}static getBoxes(e,t,n,s){return[]}getResult(e){let t=[],n="",s=[],l=!1;for(let t=0;t<e.length;t++){let o=e.charCodeAt(t),a=o>=65&&o<=72;if(a&&""==n)return[];a!=l&&(s.push(n),n=""),l=a,n+=e[t]}""!=n&&s.push(n);for(let e=1;e<s.length;e+=2){let n=0,l=Math.floor(s[e-1].length/s[e].length),o=+s[e-1].substr(n,l),a=o;for(let c=0;c<s[e].length;c++){if(c>=s[e-1].length||(o=+s[e-1].substr(n,l))!=a)return[];t.push({num:o,str:s[e][c]}),n+=l,l=(a=o+1).toString().length}}return t}on(){super.on(),this.firstLine=null,this.lineIdx=0,this.str=""}off(){if(super.off(),this.offCalback&&this.firstLine){var e=this.getResult(this.str.toUpperCase());if(e.length>0){let t=JSON.stringify({main:e,sub:[]});this.offCalback([{str:t,pageIndex:this.firstLine.pageIndex,lineIndex:this.lineIdx,transform:this.firstLine.transform,type:this.TYPE}])}}this.firstLine=null,this.str=""}constructor(e,t){super(),this.firstLine=null,this.lineIdx=0,this.str="",this.TYPE=x.TYPE_NAME,null!=e&&(this.isOn=e),this.offCalback=t}}x.TYPE_NAME="dapanchitiet";class p extends l{parse(e,t,n,l,o,a){if(!t.isLastLine||l&&t.transform[5]<l.transform[5]+l.height)return[];var c=t.strLine.replace(/\|/g,"").trim().match(s.PdfConst.FOOTER_PATTERN.join("|"));return null!=c&&c.length>0?[{str:c[0],pageIndex:t.pageIndex,lineIndex:n,transform:t.transform,type:this.TYPE}]:[]}static getBoxes(e,t,n,s){return[]}constructor(){super(),this.TYPE=p.TYPE_NAME}}p.TYPE_NAME="footer";class f extends l{parse(e,t,n,s,l,o){for(let a of[new p,new u])if(a.parse(e,t,n,s,l,o).length>0)return[];var a=t.strLine;return null==this.firstLine&&(this.firstLine=t,this.lineIdx=n),this.str+=a+"\n",[]}static getBoxes(e,t,n,s){return[]}getResult(e){let t=[],n=e.replace(/\n/g,"\n|"),l=s.PdfConst.QUESTION_PATTERN.join("|").replace(/\(\^/g,"(\\|"),o=n.matchAll(RegExp(l,"ig"));for(;;){let e=o.next();if(e.done)break;let t=e.value[0],s=this.getNumberFromStr(t);n=n.replace(t,s+".")}let a,c=n.matchAll(/\d+[\.\-]/g),d=-1;for(;;){let e=c.next();if(e.done)break;if(-1==d)d=e.value.index,a=e;else{let s=n.substr(d,e.value.index-d);t.push(this.toAns(s,a)),d=e.value.index,a=e}}if(d>=0&&a){let e=n.substr(d);t.push(this.toAns(e,a))}return t}toAns(e,t){let n=t.value[0].length;return{num:+t.value[0].substr(0,n-1),str:e.substr(n).replace(/\|/g," ").replace(/ +/g," ").trim()}}getNumberFromStr(e){var t=e.match(/(\d+)/);return t?t[0]:""}on(){super.on(),this.firstLine=null,this.lineIdx=0,this.str=""}off(){if(super.off(),this.offCalback&&this.firstLine){var e=this.getResult(this.str);if(e.length>0){let t=JSON.stringify({main:[],sub:e});this.offCalback([{str:t,pageIndex:this.firstLine.pageIndex,lineIndex:this.lineIdx,transform:this.firstLine.transform,type:this.TYPE}])}}this.firstLine=null,this.str=""}constructor(e,t){super(),this.firstLine=null,this.lineIdx=0,this.str="",this.TYPE=f.TYPE_NAME,null!=e&&(this.isOn=e),this.offCalback=t}}f.TYPE_NAME="dapandientu";class g{getErrorQtns(e){var t=[];for(let n=0;n<e.length;n++)!e[n].isGroup&&0==e[n].answers.length&&(e[n].strAns&&void 0!==e[n].strAns||t.push(e[n].num));return t}sumHighTo(e,t){let n=0,s=t.filter(e=>!e.inactive);for(let t=0;t<e;t++)n+=Math.round(s[t].heigh);return n}maxWidthTo(e,t){let n=[],s=t.filter(e=>!e.inactive);for(let t=0;t<e;t++)n.push(s[t].width);return Math.round(Math.max(...n))}constructor(e){this.commonService=e,this.fillColor=(e,t,n,s,l,o)=>{t.fillStyle=e,t.fillRect(Math.round(n),Math.round(s),Math.round(l),Math.round(o))},this.drawRect=(e,t,n,s,l,o)=>{t.beginPath(),t.lineWidth=1,t.strokeStyle=e,t.rect(Math.round(n),Math.round(s),Math.round(l),Math.round(o)),t.stroke()},this.getSingleImgData=(e,t)=>{var n,s;if(e.inactive){let e=null!==(n=this.commonService.myTranslateInstant("lang_auto_khong_xac_dinh_duoc_vung_thong_tin"))&&void 0!==n?n:"";throw this.commonService.snackError(e),Error(e)}try{let n=document.createElement("canvas");return n.width=0==e.width?2:Math.round(e.width),n.height=0==e.heigh?2:Math.round(e.heigh),null===(s=n.getContext("2d"))||void 0===s||s.drawImage(t[e.pageIndex].canvas,Math.round(e.left),Math.round(e.top),n.width,n.height,0,0,n.width,n.height),n.toDataURL("image/png")}catch(e){return console.log(e),"https://via.placeholder.com/300"}},this.getScatteredImgData=(e,t)=>{let n=e.filter(e=>!e.inactive);if(e.filter(e=>e.inactive).length==e.length){var s;let e=null!==(s=this.commonService.myTranslateInstant("lang_auto_khong_xac_dinh_duoc_vung_thong_tin"))&&void 0!==s?s:"";throw this.commonService.snackError(e),Error(e)}try{let e=document.createElement("canvas"),s=n.map(e=>e.width);e.width=Math.round(Math.max(...s));let l=0;for(let e=0;e<n.length;e++)l+=n[e].heigh;e.height=Math.round(l);let o=e.getContext("2d");for(let e=0;e<n.length;e++)null==o||o.drawImage(t[n[e].pageIndex].canvas,Math.round(n[e].left),Math.round(n[e].top),Math.round(n[e].width),Math.round(n[e].heigh),0,0==e?0:this.sumHighTo(e,n),Math.round(n[e].width),Math.round(n[e].heigh));return e.toDataURL("image/png")}catch(e){return console.log(e),"https://via.placeholder.com/300"}}}}class m{static drawPoint(e,t,n){null!=e&&(e.fillStyle=t,e.beginPath(),e.arc(n.left,n.top,5,0,2*Math.PI),e.fill())}static drawBox(e,t,n,s){null!=e&&(s?(e.fillStyle=t,e.beginPath(),e.rect(n.left,n.top,n.width,n.heigh),e.fill()):(e.strokeStyle=t,e.beginPath(),e.rect(n.left,n.top,n.width,n.heigh),e.stroke()))}static drawBox2(e,t,n,s,l){null!=e&&(e.strokeStyle=t,e.beginPath(),e.rect(l[4],l[5],n,s),e.stroke())}static drawLine(e,t,n,s){null!=e&&(e.strokeStyle=t,e.beginPath(),e.moveTo(n,s),e.lineTo(e.canvas.width-10,s),e.stroke())}static drawText(e,t,n,s){null!=e&&(e.font="11px Arial",e.fillStyle=t,e.fillText(s,n[4],n[5]))}static isLineIntersec(e,t){let n=e.transform[5]<=t.transform[5]&&t.transform[5]<=e.transform[5]+e.height,l=t.transform[5]<=e.transform[5]&&e.transform[5]<=t.transform[5]+t.height,o=e.transform[4]<=t.transform[4]&&t.transform[4]<=e.transform[4]+e.width+s.PdfConst.INTERSEC_MARGIN,a=t.transform[4]<=e.transform[4]&&e.transform[4]<=t.transform[4]+t.width+s.PdfConst.INTERSEC_MARGIN,c=this.isSameLine(e,t);return(n||l)&&(o||a)&&!c}static isLineVIntersec(e,t){return(e.transform[5]<=t.transform[5]&&t.transform[5]<=e.transform[5]+e.height||t.transform[5]<=e.transform[5]&&e.transform[5]<=t.transform[5]+t.height)&&(e.transform[4]<=t.transform[4]&&t.transform[4]<=e.transform[4]+e.width+s.PdfConst.INTERSEC_MARGIN||t.transform[4]<=e.transform[4]&&e.transform[4]<=t.transform[4]+t.width+s.PdfConst.INTERSEC_MARGIN)&&Math.abs(t.transform[4]-e.transform[4])>s.PdfConst.INTERSEC_MARGIN/2}static isSameLine(e,t){return Math.abs(e.transform[5]+e.height-(t.transform[5]+t.height))<=s.PdfConst.LINE_MAGIN}static isObjIntersec(e,t){return e.transform[5]<=t.transform[5]&&t.transform[5]<=e.transform[5]+e.height||t.transform[5]<=e.transform[5]&&e.transform[5]<=t.transform[5]+t.height}static isObjFullIntersec(e,t){return(e.transform[5]<=t.transform[5]&&t.transform[5]<=e.transform[5]+e.height||t.transform[5]<=e.transform[5]&&e.transform[5]<=t.transform[5]+t.height)&&(e.transform[4]<=t.transform[4]&&t.transform[4]<=e.transform[4]+e.width||t.transform[4]<=e.transform[4]&&e.transform[4]<=t.transform[4]+t.width)}static isFirstLineOfPage(e,t){return!(e<0||e>=t.length||0!=e&&t[e-1].pageIndex==t[e].pageIndex)}static isLastLineOfPage(e,t){return!(e<0||e>=t.length||e!=t.length-1&&t[e+1].pageIndex==t[e].pageIndex)}static getTopLine(e,t,n){let l=n[t];for(let o of[[s.PdfConst.STEP_SIZE,s.PdfConst.OVERLAP],[1,s.PdfConst.OVERLAP],[1,.3]]){let a=o[0],c=o[1],d=l.transform[5],h=0,u=3*a;if(!m.isFirstLineOfPage(t,n)){let e=m.isSameLine(n[t-1],l);m.isLineIntersec(n[t-1],l)?(d=n[t-1].transform[5]+n[t-1].height,h=n[t-1].transform[5],n[t-1].transform[4]>n[t].transform[4]+2*s.PdfConst.MARGIN_LEFT?h-=2*s.PdfConst.MARGIN_LEFT:h+=n[t-1].height*c,a=1,u=n[t].transform[5]+n[t].height/2-d):(h=e&&t-2>=0?n[t-2].transform[5]+n[t-2].height*c:n[t-1].transform[5]+n[t-1].height*c,e&&m.isFirstLineOfPage(t-1,n)&&(h=0))}if(!s.PdfConst.ENABLE_IMAGE_PROCESS)return[d,0];let x=!1;for(;d>h;){if(!m.hasColor(e,l.transform[4],d,l.width,a))return[d,0];x||(x=!0,d+=u),d-=a}}return[l.transform[5],1]}static arrContains(e,t){for(let n of t)if(n==e)return!0;return!1}static getBottomLine(e,t,n){let l=n[t];for(let o of[[s.PdfConst.STEP_SIZE,s.PdfConst.OVERLAP],[1,s.PdfConst.OVERLAP],[1,.3]]){let a=o[0],c=o[1],d=l.transform[5]+l.height,h=9999,u=3*a;if(!m.isLastLineOfPage(t,n)){let e=m.isSameLine(n[t+1],l);m.isLineIntersec(n[t+1],l)?(d=n[t+1].transform[5],h=n[t+1].transform[5]+n[t+1].height,n[t+1].transform[4]>n[t].transform[4]+2*s.PdfConst.MARGIN_LEFT?h+=2*s.PdfConst.MARGIN_LEFT:h-=n[t+1].height*c,u=n[t].transform[5]+n[t].height/2-d):(h=e&&t+2<n.length?n[t+2].transform[5]+n[t+2].height-n[t+2].height*c:n[t+1].transform[5]+n[t+1].height-n[t+1].height*c,e&&m.isLastLineOfPage(t+1,n)&&(h=9999));let o=n[t+1].top;if(o&&d>=o&&!e)return[o,0]}if(!s.PdfConst.ENABLE_IMAGE_PROCESS)return[d,0];let x=!1;for(;d<h;){if(!m.hasColor(e,l.transform[4],d,l.width,a))return[d,0];x||(x=!0,d-=u),d+=a}}return[l.transform[5]+l.height,1]}static hasColor(e,t,n,s,l){let o=Math.round(t),a=Math.round(o+s),c=Math.round(n),d=Math.round(c+l);for(let t=c;t<d;t++)for(let n=o;n<a;n++){let s=4*(t*e.width+n);if((e.data[s]+e.data[s+1]+e.data[s+2])/3<150)return!0}return!1}static calIndexPos2(e,t,n,l,o){let a=[],c=0,d=0,h=0,u=0,x=0,p=0,f=!0,g=!0;for(let b of e){g=this.isObjIntersec(e[0],b),u=b.transform[4],o||(c+=u-h>s.PdfConst.SPLIT_MARGIN&&""!=b.str.trim()||x!=b.transform[5]?1:0),f=u+2*s.PdfConst.MARGIN_LEFT>=h;let C=b.transform[4]+b.width;if(g&&(h=C),C>d&&g&&(d=C),(c+=b.str.length)>l&&f&&g){b.transform.forEach(e=>{a.push(e)}),a[3]=b.height,a[2]=p,a[1]=b.str.length-c+l;let e=b.str.substr(0,b.str.length-c+l+1);if(e.length==b.str.length){a[4]=a[4]+b.width;break}var m=t[b.fontName].fontFamily,v=Math.hypot(b.transform[2],b.transform[3]);n.font="".concat(v,"px ").concat(m);let s=n.measureText(e).width,o=n.measureText(b.str).width;a[4]=a[4]+b.width*s/o;break}g&&(x=b.transform[5]),p++}return 0==a.length&&(a=[0,e[e.length-1].length-1,e.length-1,e[0].height,d,e[0].transform[5]]),a}static calIndexPos(e,t,n,l,o){let a=[],c=0,d=0,h=0,u=0,x=0,p=0,f=!0,g=!0;for(let b of e){g=this.isObjIntersec(e[0],b),u=b.transform[4],o||(c+=u-h>s.PdfConst.SPLIT_MARGIN&&""!=b.str.trim()||x!=b.transform[5]?1:0,u-h>s.PdfConst.SPLIT_MARGIN&&""!=b.str.trim()||b.transform[5],b.str),f=u+2*s.PdfConst.MARGIN_LEFT>=h;let C=b.transform[4]+b.width;if(g&&(h=C),C>d&&g&&(d=C),(c+=b.str.length)>l&&f&&g){let e=b.str.substr(0,b.str.length-c+l);var m=t[b.fontName].fontFamily,v=Math.hypot(b.transform[2],b.transform[3]);n.font="".concat(v,"px ").concat(m);let s=n.measureText(e).width,o=n.measureText(b.str).width;b.transform.forEach(e=>{a.push(e)}),a[4]=a[4]+b.width*s/o,a[3]=b.height,a[2]=p,a[1]=b.str.length-c+l;break}g&&(x=b.transform[5]),p++}return 0==a.length&&(a=[0,e[e.length-1].length-1,e.length-1,e[0].height,d,e[0].transform[5]]),a}static getTextBottom(e,t,n,s){let l=Math.atan2(e[1],e[0]);t.vertical&&(l+=Math.PI/2);let o=Math.hypot(e[2],e[3]),a=o*m.getAscent(t.fontFamily,n,s);e[5];let c=0,d=0*(c=0===l?a:a*Math.cos(l));return[e[5]-c-d,o+d]}static getAscent(e,t,n){let s=n.get(e);if(s)return s;t.save(),t.font="30px ".concat(e);let l=t.measureText(""),o=l.fontBoundingBoxAscent,a=Math.abs(l.fontBoundingBoxDescent);if(o){t.restore();let s=o/(o+a);return n.set(e,s),s}t.strokeStyle="red",t.clearRect(0,0,30,30),t.strokeText("g",0,0);let c=t.getImageData(0,0,30,30).data;a=0;for(let e=c.length-1-3;e>=0;e-=4)if(c[e]>0){a=Math.ceil(e/4/30);break}t.clearRect(0,0,30,30),t.strokeText("A",0,30),c=t.getImageData(0,0,30,30).data,o=0;for(let e=0,t=c.length;e<t;e+=4)if(c[e]>0){o=30-Math.floor(e/4/30);break}if(t.restore(),o){let t=o/(o+a);return n.set(e,t),t}return n.set(e,.8),.8}static getMaxLineRight(e,t){let n=0;for(let s of t)if(s.pageIndex==e||-1==e){let e=s.transform[4]+s.width;e>n&&(n=e)}return n}static getMinLineLeft(e,t){let n=99999;for(let s of t)if(s.pageIndex==e||-1==e){let e=s.transform[4];e<n&&(n=e)}return n}}class v{loadPdf(e,t){var n=URL.createObjectURL(e);let s=pdfjsLib.getDocument({url:n,cMapPacked:!0,cMapUrl:"/assets/js/pdf-js-v2/cmaps/",disableAutoFetch:!1,disableFontFace:!1,disableRange:!1,disableStream:!1,docBaseUrl:"",enableXfa:!0,fontExtraProperties:!1,isEvalSupported:!0,maxImageSize:-1,pdfBug:!1,standardFontDataUrl:"/assets/js/pdf-js-v2/standard_fonts/",verbosity:1});var l=[];let o=this;s.promise.then(function(e){o.optionalContentConfigPromise=e.getOptionalContentConfig();for(var n=e._pdfInfo.numPages,s=1;s<=n;s++)e.getPage(s).then(e=>{l.push(e),l.length==n&&t(l=l.sort((e,t)=>e._pageIndex>t._pageIndex?1:-1))})},function(e){console.error(e)})}getImages(e,t){let n=[];if("function"!=typeof e.objs.getAll)return console.log("Unable to read img"),n;let s=e.objs.getAll();for(let e of Object.keys(s))s[e].data.pageIndex=t,n.push(s[e].data);return n}isImageObj(e){return -999==e.transform[0]&&"img"==e.str}getLines(e,t,n,l){let o=l.scale,a=e.items.length;for(let t=0;t<a;t++){let s=e.items[t];this.isImageObj(s)||(s.transform=v.transform(l.transform,s.transform),s.width=s.width*o),s.transform[4]+s.width>n.canvas.width&&(s.width=n.canvas.width-s.transform[4]-20);let a=this.isImageObj(s)?[s.transform[5],s.height]:m.getTextBottom(s.transform,e.styles[s.fontName],this.tempCanvas,this.ascentCache);s.height=a[1];let c=Math.ceil(a[0]);s.transform[5]=c}e.items.sort((e,t)=>1e6*Math.floor(e.transform[5])-e.transform[4]<1e6*Math.floor(t.transform[5])-t.transform[4]?-1:1);let c,d=[],h=0;this.imageCache[t]?c=this.imageCache[t]:(c=n.getImageData(0,0,n.canvas.width,n.canvas.height),this.imageCache[t]=c);var u={strLine:"",transform:[],textObjs:[],pageIndex:t,width:0,height:0,txtLength:0};for(let n=0;n<a;n++){let l=e.items[n];if(this.isImageObj(l)){for(let t=0;t<a;t++)if(n!=t&&m.isObjIntersec(l,e.items[t])){l.str="";break}}if(m.arrContains(l.str.trim(),s.PdfConst.SKIP_CHAR))continue;let o=Math.floor(l.transform[5]+l.height);0!=h?h-o>=-s.PdfConst.LINE_MAGIN?this.addTxtToLine(u,l):0!=u.textObjs.length&&(d.push(u),h=Math.floor((u=this.newLine(l,t)).transform[5]+u.height)):h=Math.floor((u=this.newLine(l,t)).transform[5]+u.height)}for(let e of(d.push(u),d))this.calculateSize(e);for(let e of(this.findAndMergeAnsQuestBlock(d,"ans"),this.findAndMergeAnsQuestBlock(d,"quest"),this.findAndMergeBlock(d),this.mergeIntersecLine(d),this.mergeSmallLine(d,c),d))this.calculateSize(e);return d}mergeIntersecLine(e){let t=0;for(;t<e.length;){let n=e[t];++t<e.length&&m.isLineVIntersec(n,e[t])&&(this.mergeLine(n,e[t]),e.splice(t,1),t--)}}findAndSplitQuestAnsLine(e,t,n){let l=0,o=[],a=s.PdfConst.BREAK_LINE_PATTERN.join("|");for(let t of e){t.top=void 0,t.bottom=void 0;var c=t.strLine.replace(/\|/g,"").trim().match(a);if(null!=c&&c.length>0){let e=/[\s\|\.]+[B\u0412][\s\|]*\./g,n=t.strLine.trim().toUpperCase().match(e);if(null!=n&&n.length>0){let e=c[0].toUpperCase().indexOf("A");o.push({lineIndex:l,strIndex:e})}}l++}for(let s=o.length-1;s>=0;s--){let l=o[s].lineIndex;this.splitLine(l,t[e[l].pageIndex],n[e[l].pageIndex],o[s].strIndex,e)}}mergeSmallLine(e,t){let n=0,l=1.2*s.PdfConst.LINE_SMALL_HEIGHT;for(;n<e.length;){let s=e[n];if(!s||!this.isSmallLine(s)){n++;continue}n-1>=0&&!e[n-1].bottom&&(e[n-1].bottom=m.getBottomLine(t,n-1,e)[0]),n+1<e.length&&!e[n+1].top&&(e[n+1].top=m.getTopLine(t,n+1,e)[0]);let o=n-1<0?-9999:this.getLineTop(s)-this.getLineBot(e[n-1]),a=n+1>=e.length?-9999:this.getLineTop(e[n+1])-this.getLineBot(s),c=n-1>=0&&e[n-1].transform[4]<=s.transform[4]&&s.transform[4]<=e[n-1].transform[4]+e[n-1].width,d=n+1<e.length&&e[n+1].transform[4]<=s.transform[4]&&s.transform[4]<=e[n+1].transform[4]+e[n+1].width;if(0==n&&a<=l&&d){this.mergeLine(e[n+1],s),e.splice(n,1),n--;continue}if(n==e.length-1&&o<=l&&c){this.mergeLine(e[n-1],s),e.splice(n,1),n--;continue}let h=-1;o>a&&d&&a<=l?h=n+1:o<=a&&c&&o<=l?h=n-1:o<=a&&d&&a<=l?h=n+1:o>a&&c&&o<=l&&(h=n-1),h>=0?(this.mergeLine(e[h],s),e.splice(n,1),n--):n++}}isSmallLine(e){return e.height<s.PdfConst.LINE_SMALL_HEIGHT}mergeLine(e,t){for(let n of t.textObjs)this.addTxtToLine(e,n)}findAndMergeAnsQuestBlock(e,t){let n=0;for(;n<e.length;){if("ans"==t&&this.isAnsLine(e[n])||"quest"==t&&this.isQuestLine(e[n])){let s=n,l=-1,o=1,a=[];for(;o<=10;){if((s=n+l*o)<0){l=1,o=1;continue}if(s>=e.length)break;let c=this.isAnsLine(e[s]),d=c||this.isQuestLine(e[s]),h="ans"==t&&c&&m.isSameLine(e[n],e[s]),u=!d&&m.isLineIntersec(e[n],e[s])&&e[s].transform[4]>e[n].transform[4];if((h||u)&&a.push(s),o++,d&&1==l)break;(o>10||d)&&-1==l&&(l=1,o=1)}for(let t of(a.sort((e,t)=>e<t?1:-1),a))for(let s of e[t].textObjs)this.addTxtToLine(e[n],s);for(let t of a)e.splice(t,1),t<n&&n--}n++}}findAndMergeBlock(e){let t=0;for(;t<e.length;){if(this.isAnsLine(e[t])||this.isQuestLine(e[t])){t++;continue}let n=t+1;for(;n<e.length&&e[t].pageIndex==e[n].pageIndex;){let s=this.isAnsLine(e[n])||this.isQuestLine(e[n]);if(m.isLineIntersec(e[t],e[n])&&!s||m.isSameLine(e[t],e[n])){for(let s of e[n].textObjs)this.addTxtToLine(e[t],s);e.splice(n,1),n=t}n++}t++}}isAnsLine(e){let t=e.strLine.trim().match(/[\s\|\.]+[AB\u0412CDEFGHIJK]\s*\./g);return null!=t&&t.length>0}isQuestLine(e){let t=s.PdfConst.QUESTION_PATTERN.join("|"),n=e.strLine.replace(/\|/g,"").toLowerCase().trim().match(t);return null!=n&&n.length>0}encodeLines(e,t){let n="",l=0;for(let o of t){if(o.height<s.PdfConst.LINE_SMALL_HEIGHT){l-1>=0&&!t[l-1].bottom&&(t[l-1].bottom=m.getBottomLine(e,l-1,t)[0]),l+1<t.length&&!t[l+1].top&&(t[l+1].top=m.getTopLine(e,l+1,t)[0]);let a=l-1<0?-9999:this.getLineTop(o)-this.getLineBot(t[l-1]),c=l+1>=t.length?-9999:this.getLineTop(t[l+1])-this.getLineBot(o),d=l-1>=0&&t[l-1].transform[4]<=o.transform[4]&&o.transform[4]+o.width<=t[l-1].transform[4]+t[l-1].width,h=l+1<t.length&&t[l+1].transform[4]<=o.transform[4]&&o.transform[4]+o.width<=t[l+1].transform[4]+t[l+1].width,u=1.2*s.PdfConst.LINE_SMALL_HEIGHT;Math.abs(a)>=u&&Math.abs(c)>=u?n+="L":n+=-9999==a?"3":-9999==c?"4":a>c&&h?"2":a<=c&&d?"1":a<=c&&h?"2":a>c&&d?"1":"L"}else n+="L";l++}return n}getLineTop(e){return e.top?e.top:e.transform[5]}getLineBot(e){return e.bottom?e.bottom:e.transform[5]+e.height}splitLine(e,t,n,s,l){let o=l[e],a=m.calIndexPos(o.textObjs,t,n,s,!0),c=this.newLine(o.textObjs[0],o.pageIndex),d=a[2],h=a[1],u=o.textObjs[d],x=u.transform,p={str:u.str.substr(0,h),width:a[4]-x[4],height:u.height,fontName:u.fontName,transform:[x[0],x[1],x[2],x[3],x[4],x[5]]},f={str:u.str.substr(h),width:u.width-p.width,height:u.height,fontName:u.fontName,transform:[x[0],x[1],x[2],x[3],a[4],x[5]]},g=o.textObjs;o.textObjs=[],c.textObjs=[];for(let e=0;e<g.length;e++)e<d?this.addTxtToLine(o,g[e]):e>d?this.addTxtToLine(c,g[e]):(this.addTxtToLine(o,p),this.addTxtToLine(c,f));return this.calculateSize(o),this.calculateSize(c),e==l.length-1?l.push(c):l.splice(e+1,0,c),c}findAndMergeSmallLine(e,t,n){let s=0,l=e.matchAll(n),o=[];for(;;){let e=l.next();if(e.done)break;let n=e.value[0],a=e.value.index,c=0,d=[];for(let e=0;e<n.length;e++)"L"==n[e]?c=a+e:d.push(a+e);for(let e of d){for(let n of t[e].textObjs)this.addTxtToLine(t[c],n);t[c].top=void 0,t[c].bottom=void 0,o.push(e)}s++}for(let e of(o.sort((e,t)=>e<t?1:-1),o))t.splice(e,1);return s}newLine(e,t){let n={strLine:"",transform:[],textObjs:[],pageIndex:t,width:0,height:0,txtLength:0};return n.transform[4]=e.transform[4],n.transform[5]=e.transform[5],n.height=e.height,n.width=e.width,n.txtLength=e.str.length,n.textObjs.push(e),n}addTxtToLine(e,t){t.transform[4]<e.transform[4]&&(e.transform[4]=t.transform[4]),t.transform[5]<e.transform[5]&&(e.transform[5]=t.transform[5]),t.transform[5]+t.height>e.transform[5]+e.height&&(e.height=t.transform[5]+t.height-e.transform[5]),t.transform[4]+t.width>e.transform[4]+e.width&&(e.width=t.transform[4]+t.width-e.transform[4]),e.txtLength+=t.str.length,e.textObjs.push(t);let n=e.transform[4]+e.width,s=e.height;for(let t of e.textObjs)t.transform[4]+t.width>n&&(n=t.transform[4]+t.width),t.transform[5]+t.height>e.transform[5]+s&&(s=t.transform[5]+t.height-e.transform[5]);e.width=n-e.transform[4],e.height=s}static transform(e,t){return pdfjsLib.Util.transform(e,t)}render(e,t,n,s){for(var l,o=e.length,a=0;a<o;a++){var c=document.createElement("div");c.className="pdf-page",c.id="page-"+a,null===(l=document.getElementById(t))||void 0===l||l.appendChild(c),this.renderPage(e[a],n,s)}}calculateSize(e){if(0==e.textObjs.length)return;e.textObjs.sort((e,t)=>1e6*Math.floor(e.transform[4])+e.transform[5]>1e6*Math.floor(t.transform[4])+t.transform[5]?1:-1),e.strLine="";let t=0,n=0,l=0,o=0,a=9999,c=0,d=9999;for(let h of e.textObjs){let u=m.isObjIntersec(e.textObjs[0],h),x=(l=h.transform[4])-n>s.PdfConst.SPLIT_MARGIN&&""!=h.str.trim()||o!=h.transform[5]?"|":"";e.strLine+=x+h.str,l<d&&(d=l);let p=h.transform[4]+h.width;u&&(n=p),p>t&&u&&(t=p),u&&(o=h.transform[5]),h.transform[5]<a&&(a=h.transform[5]),h.transform[5]+h.height>c&&(c=h.transform[5]+h.height)}e.transform[4]=d,e.transform[5]=a,e.width=t-d,e.height=c-a,e.transform[0]=a,e.transform[1]=c;let h=s.PdfConst.TVCN_CHAR,u=e.strLine;for(let e of h)u=u.replace(RegExp(e[0],"g"),e[1]);e.strLine=u}renderPage(e,t,n){var s=e._pageIndex,l=e.getViewport({scale:t});let o=.8*l.width;var a=document.createElement("canvas"),c=document.getElementById("page-"+s);null==c||c.appendChild(a),a.id="canvas"+s;var d=a.getContext("2d",{alpha:!1});a.height=l.height,a.width=l.width,a.style.height=l.height*o/l.width+"px",a.style.width=o+"px",c&&(c.style.width=a.style.width,c.style.height=a.style.height);let h={canvasContext:d,transform:[1,0,0,1,0,0],viewport:l,annotationMode:pdfjsLib.AnnotationMode.ENABLE_FORMS,optionalContentConfigPromise:this.optionalContentConfigPromise,annotationCanvasMap:new Map,pageColors:{background:"Canvas",foreground:"CanvasText"}};e.render(h).promise.then(function(){n&&n(d,e._pageIndex,l)})}constructor(){let e=document.createElement("canvas");this.tempCanvas=e.getContext("2d"),this.ascentCache=new Map,this.imageCache=[]}}e.exports=class{get totalNumberQuestion(){return this.questionList.filter(e=>e.tempData.isSelect&&e.answers.length).length}updateStatusCallback(e){}onCompleteCallback(e,t){e.length>0?(this.startQuestion=e[0].num,this.labelHolderSize.width=2*t[0].canvas.width,this.rootQuestionInfo=e,this.rootCanvases=t.map(e=>e.canvas),this.rootHeaderPosition={pageIndex:0,top:1,left:e[0].positions[0].left,width:e[0].positions[0].left+e[0].positions[0].width<t[0].canvas.width?e[0].positions[0].width:t[0].canvas.width-e[0].positions[0].left,heigh:e[0].positions[0].top-1},this.processData()):(this.errAnalyzingPdf=!0,this.isShowLoadingFileExam=!1)}cloneCanvas(){let e=this.rootCanvases;for(let t=0;t<e.length;t++){let n=e[t],s=document.createElement("canvas");s.width=n.width,s.height=n.height;let l=document.createElement("canvas");l.width=n.width,l.height=n.height;let o=s.getContext("2d");null==o||o.drawImage(n,0,0,n.width,n.height,0,0,n.width,n.height);let a=l.getContext("2d");null==a||a.drawImage(n,0,0,n.width,n.height,0,0,n.width,n.height),o&&a&&this.clonedCtxForCreate.push(a)}}processData(){this.questionList=[],this.abcdLabelPos={},this.groupImages={},this.totalInGroupTracking=0,this.questionLabelMap=[],this.groupLengths=[],this.countGroup=0,this.labelsUrls=[],this.labelsBase64s=[],this.firstInGroupIndexes=[],this.clonedCtxForCreate=[],this.cloneCanvas();let e=this.clonedCtxForCreate[0].canvas.width;this.rootQuestionInfo.forEach(t=>{t.positions.forEach(t=>{t.width+t.left>e&&(t.width=e-t.left)})});let t=this.rootQuestionInfo,n=this.clonedCtxForCreate;t.forEach(e=>{e.remove.heigh=Math.round(e.remove.heigh),e.remove.width=Math.round(e.remove.width),e.remove.top=Math.round(e.remove.top),e.remove.left=Math.round(e.remove.left),e.positions.forEach(e=>{e.heigh=Math.round(e.heigh),e.width=Math.round(e.width),e.top=Math.round(e.top),e.left=Math.round(e.left)}),e.help&&(e.help.remove&&(e.help.remove.heigh=Math.round(e.help.remove.heigh),e.help.remove.width=Math.round(e.help.remove.width),e.help.remove.left=Math.round(e.help.remove.left),e.help.remove.top=Math.round(e.help.remove.top)),e.help.positions.forEach(e=>{e.heigh=Math.round(e.heigh),e.width=Math.round(e.width),e.top=Math.round(e.top),e.left=Math.round(e.left)})),e.answers.length>0&&e.answers.forEach(e=>{e.remove.heigh=Math.round(e.remove.heigh),e.remove.width=Math.round(e.remove.width),e.remove.top=Math.round(e.remove.top),e.remove.left=Math.round(e.remove.left),e.positions.forEach(e=>{e.heigh=Math.round(e.heigh),e.width=Math.round(e.width),e.top=Math.round(e.top),e.left=Math.round(e.left)})})});let s=document.createElement("canvas");s.width=this.labelHolderSize.width,s.height=this.labelHolderSize.height;let l=s.getContext("2d"),o=0,a=()=>{l&&(this.labelsBase64s[o]=l.canvas.toDataURL("image/png"),o++,l.clearRect(0,0,l.canvas.width,l.canvas.height)),d.left=0,d.top=0},c=0,d={left:0,top:0,locate:0},h=[],u=e=>{let t=!0;for(let n=0;n<e.length;n++)if(1==e[n].remove.width||1==e[n].remove.heigh){t=!1;break}return t};t.forEach(e=>{h.push(e.answers.length)});for(let e=0;e<t.length;e++)if(u(t[e].answers)&&t[e].answers.length==Math.max(...h)){t[e].answers.forEach(e=>{null==l||l.drawImage(n[e.remove.pageIndex].canvas,e.remove.left,e.remove.top,e.remove.width,e.remove.heigh,d.left,d.top,e.remove.width,e.remove.heigh),this.abcdLabelPos[e.label]={left:d.left,top:d.top},d.left=d.left+e.remove.width+5});break}this.examHeader=this.cropperService.getSingleImgData(this.rootHeaderPosition,n);for(let e=0;e<t.length;e++){let s={isFixAns:t[e].isFixAns?1:0,forcedFixAns:!!t[e].isFixAns,groupType:0,original:"",debugView:"",group:t[e].group,groupUrl:this.groupImages["image_group_".concat(t[e].group)]?this.groupImages["image_group_".concat(t[e].group)]:"",question:{label:t[e].num,posit:{top:0,left:0,locate:0},url:"",urlExcludeLabelOnly:"",width:1,height:1,remove:{x:1,y:1,width:1,height:1,url:this.cropperService.getSingleImgData(t[e].remove,n),left:0,top:0}},answers:[],help:{num:t[e].num,url:""},tempData:{sort:e,point:0,answerType:1,answerConfig:{},answerResult:[],isShowAttach:!1,questionMedia:[],isSelect:!0,isShowHelp:!1},rootIndex:e},h=t[e].positions;if(s.original=this.cropperService.getScatteredImgData(h,n),t[e].isGroup){this.groupLengths.push(this.totalInGroupTracking),this.totalInGroupTracking=0,this.countGroup++,s.isGroup=!0;var x=this.cropperService.getScatteredImgData(t[e].positions,n);this.groupImages["image_group_".concat(t[e].num)]=x}else{c++,this.totalInGroupTracking++,l&&0!=c&&d.left+t[e].remove.width>l.canvas.width?(d.left=0,d.top=d.top+this.maxQuestionLabelHeight+5,this.maxQuestionLabelHeight=0,l&&d.top+t[e].remove.heigh>l.canvas.height&&a(),null==l||l.drawImage(n[t[e].remove.pageIndex].canvas,t[e].remove.left,t[e].remove.top,t[e].remove.width,t[e].remove.heigh,d.left,d.top,t[e].remove.width,t[e].remove.heigh),s.question.remove.left=d.left,s.question.remove.top=d.top,this.questionLabelMap.push({locate:o,left:d.left,top:d.top,width:t[e].remove.width,height:t[e].remove.heigh}),d.left=d.left+t[e].remove.width+5):(l&&d.top+t[e].remove.heigh>l.canvas.height&&a(),null==l||l.drawImage(n[t[e].remove.pageIndex].canvas,t[e].remove.left,t[e].remove.top,t[e].remove.width,t[e].remove.heigh,d.left,d.top,t[e].remove.width,t[e].remove.heigh),s.question.remove.left=d.left,s.question.remove.top=d.top,this.questionLabelMap.push({locate:o,left:d.left,top:d.top,width:t[e].remove.width,height:t[e].remove.heigh}),d.left=d.left+t[e].remove.width+5,t[e].remove.heigh>this.maxQuestionLabelHeight&&(this.maxQuestionLabelHeight=t[e].remove.heigh)),this.cropperService.fillColor("#ffffff",n[t[e].remove.pageIndex],t[e].remove.left,t[e].remove.top,t[e].remove.width,t[e].remove.heigh),s.question.urlExcludeLabelOnly=1==h.length?this.cropperService.getSingleImgData(h[0],n):this.cropperService.getScatteredImgData(h,n),s.question.remove.x=t[e].remove.left-h[0].left,s.question.remove.y=t[e].remove.top-h[0].top,s.question.remove.width=t[e].remove.width,s.question.remove.height=t[e].remove.heigh,t[e].answers.length>0?t[e].answers.forEach(e=>{let t={label:e.label,posit:{left:0,top:0,locate:0},url:"",x:e.positions[0].left-h[0].left,y:e.positions[0].top-h[0].top,width:1,height:1,remove:{x:e.remove.left-h[0].left,y:e.remove.top-h[0].top,xAns:e.remove.left-e.positions[0].left,yAns:e.remove.top-e.positions[0].top,width:e.remove.width,height:e.remove.heigh,url:this.cropperService.getSingleImgData(e.remove,n),left:0,top:0}};if(h.length>1&&h[0].pageIndex!==e.remove.pageIndex&&(t.remove.y=e.remove.top-h[1].top+h[0].heigh),this.cropperService.fillColor("#ffffff",n[e.remove.pageIndex],e.remove.left,e.remove.top,e.remove.width,e.remove.heigh),h.length>1){for(let n=0;n<h.length;n++)if(h[n].pageIndex==e.positions[0].pageIndex){t.y=0==n?e.positions[0].top-h[n].top:e.positions[0].top-h[n].top+h[0].heigh;break}}if(e.isCorrect&&(s.tempData.answerResult=[e.label]),1==e.positions.length)t.url=this.cropperService.getSingleImgData(e.positions[0],n),t.width=e.positions[0].width,t.height=e.positions[0].heigh;else{t.url=this.cropperService.getScatteredImgData(e.positions,n);let s=e.positions.filter(e=>!e.inactive);t.width=this.cropperService.maxWidthTo(s.length,e.positions),t.height=this.cropperService.sumHighTo(s.length,e.positions)}s.answers.push(t),e.positions.forEach(e=>{this.cropperService.fillColor("#ffffff",n[e.pageIndex],e.left,e.top,e.width,e.heigh)})}):t[e].strAns&&void 0!==t[e].strAns?(s.tempData.answerType=4,s.tempData.answerResult.push(t[e].strAns||"")):s.tempData.answerType=3;let u=t[e].help;if(u&&(u.remove&&this.cropperService.fillColor("#ffffff",n[u.remove.pageIndex],u.remove.left,u.remove.top,u.remove.width,u.remove.heigh),u.positions&&u.positions.length>0&&(s.help.url=this.cropperService.getScatteredImgData(u.positions,n))),1==h.length){var p=h[0];if(s.answers.length){var[f]=s.answers;p.heigh=f.y}s.question.url=this.cropperService.getSingleImgData(p,n),s.question.width=p.width,s.question.height=p.heigh}else{s.question.url=this.cropperService.getScatteredImgData(h,n);let e=h.filter(e=>!e.inactive);s.question.width=this.cropperService.maxWidthTo(e.length,h),s.question.height=this.cropperService.sumHighTo(e.length,h)}this.questionList.push(s)}}for(let e=0;e<this.questionList.length;e++)this.questionList[e].tempData.point=this.totalNumberQuestion?Number(this.totalPoint/this.totalNumberQuestion):0,this.questionList[e].index=e;let g=0;for(let e=0;e<this.groupLengths.length;e++)this.firstInGroupIndexes.push(g+this.groupLengths[e]),g+=this.groupLengths[e];this.completeCropper()}generateIdRequired(e){let t="z",n="abcdefghijklmnopqrstuvwxyz0123456789",s=n.length;for(let l=0;l<e;l++)t+=n.charAt(Math.floor(Math.random()*s));return t}createElementImage(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;var n="";return t&&(n=' style="width:'.concat((100*t[1].width/t[0].width).toFixed(2),'%"')),e?'<p><img class="quill-image" src="'.concat(e,'"').concat(n,"/></p>"):""}completeCropper(){let e=[],t=[],n=this.quizId,s=(10/this.questionList.filter(e=>e.tempData.isSelect&&e.answers.length).length).toFixed(2);t=this.questionList.map(t=>{(!t.group||e.length+1!=t.group)&&(e.length||t.group)||e.push({id:this.generateIdRequired(7),quizId:n,questions:[],content:this.createElementImage(t.groupUrl),title:"",audios:[]});let l=e[e.length-1],o={id:this.generateIdRequired(7),content:this.createElementImage(t.question.url),quizId:n,groupId:l.id,point:t.tempData.isSelect&&t.answers.length?s:0,label:"C\xe2u",number:t.question.label,type:t.answers.length?"TN":"TL",options:t.answers.map(e=>({text:this.createElementImage(e.url,[t.question,e]),label:e.label})),explain:"",keys:t.tempData.answerResult||[],level:"",shuffle:!!t.isFixAns};return l.questions.push(o.id),o}),this.callback({status:"done",data:{groups:e,questions:t,quizId:this.quizId}})}parsePdf(e){let t=new v;t.loadPdf(e,e=>{let n=e.length,l=[],o=[],a=document.createElement("div");a.id="hiddenWrapper",a.style.width="1px",a.style.height="1px",a.style.overflow="hidden",a.style.opacity="0",a.style.zIndex="-9999",a.style.position="fixed",a.style.top="0",a.style.left="0",document.body.appendChild(a);let c=document.createElement("div"),d="canvasWrapper";c.id=d,a.appendChild(c);let h=new Date().getTime(),u=[];t.render(e,d,s.PdfConst.RENDER_SCALE,(t,s,a)=>{if(null!=t&&(l[s]=t,o[s]=a),u.push(1),this.updateStatusCallback&&this.updateStatusCallback("Rendering: ".concat(u.length,"/").concat(n)),u.length==n){let t=new Date().getTime();this.updateStatusCallback&&this.updateStatusCallback("Render done: "+(t-h)/1e3+" secs"),this.startAnalyze(l,o,e)}})})}startAnalyze(e,t,n){let l=n.length,a=[],c=[],d=[],u=[],p=new v,f=new Date().getTime();for(let g=0;g<l;g++){let m=g,v=p.getImages(n[g],m);for(let e of v)u.push(e);n[g].getTextContent().then(n=>{for(let e of v)n.items.push(this.imgToTextObj(e,n.items.length>0?n.items[0].fontName:""));var g,b=p.getLines(n,m,e[m],t[m]);if(c=c.concat(b),d[m]=n.styles,a.push(1),a.length==l){c.sort((e,t)=>1e7*e.pageIndex+(e.transform.length>0?e.transform[5]:0)-(1e7*t.pageIndex+(t.transform.length>0?t.transform[5]:0))),p.findAndSplitQuestAnsLine(c,d,e),""!=s.PdfConst.DRAW_RESULT&&console.log(c);let t=this.findEntityPos(c,d,e,p.imageCache,0),n=!1;for(let e of t)if(e.type==o.TYPE_NAME){n=!0;break}if(n||(t=this.findEntityPos(c,d,e,p.imageCache,1)),0==t.length)return void(this.onCompleteCallback&&this.onCompleteCallback([],e));let l=t[0].type==x.TYPE_NAME,a=l?JSON.parse(t[0].str):null,m=new Map,v=new Map;if(l){for(let e of a.main)m.set(e.num,e.str);for(let e of a.sub)v.set(e.num,e.str)}let b=this.getQuestionInfo(t,c,e,m);for(let e of(b.forEach(e=>{if(!m.has(e.num)&&!v.has(e.num)&&e.help&&e.help.text){let t=h.getAnsFromHelp(e.help.text);""!=t&&v.set(e.num,t)}}),b)){if(!e.isGroup&&0==e.answers.length&&m.has(e.num)){let t={pageIndex:e.remove.pageIndex,top:e.remove.top-1,left:e.remove.left-1,width:1,heigh:1};for(let n of["A","B","C","D"]){let s={label:n,remove:t,positions:[t]};m.get(e.num)==n&&(s.isCorrect=!0),e.answers.push(s)}e.isFixAns=!0}if(!e.isGroup&&0==e.answers.length&&!m.has(e.num)&&v.has(e.num)&&(e.strAns=v.get(e.num)),!e.isGroup&&e.answers.length>0&&!m.has(e.num)&&v.has(e.num))for(let t of e.answers)t.label==(null===(g=v.get(e.num))||void 0===g?void 0:g.toUpperCase().substring(0,1))&&(t.isCorrect=!0)}let C=new Date().getTime();this.updateStatusCallback&&this.updateStatusCallback("Analyze done: "+(C-f)/1e3+" secs"),this.showOnCanvas(b,t,c,e,u,s.PdfConst.DRAW_RESULT),this.onCompleteCallback&&this.onCompleteCallback(b,e)}})}}imgToTextObj(e,t){return{str:"img",fontName:t,width:e.paintWidth,height:e.paintHeight,transform:[-999,0,0,0,-e.left,-e.top-e.paintHeight]}}findEntityPos(e,t,n,s,l){let g=[],v=!1;var b=[{parser:new a,on:[],off:[]},{parser:new o(l),on:[3,4],off:[6]},{parser:new c,on:[3,6],off:[]},{parser:new d(!1),on:[6,8],off:[0,2]},{parser:new h(!1),on:[6,8],off:[0,2,4]},{parser:new u,on:[],off:[8]},{parser:new x(!1,e=>{for(let t of e)g.unshift(t)}),on:[],off:[2]},{parser:new p,on:[],off:[]},{parser:new f(!1,e=>{if(0!=e.length){if(g.length>0&&g[0].type==x.TYPE_NAME){let t=JSON.parse(e[0].str),n=JSON.parse(g[0].str);n.sub=t.sub,g[0].str=JSON.stringify(n)}else e[0].type=x.TYPE_NAME,g.unshift(e[0])}}),on:[],off:[2]}],C=[8,0,1,2,3,4,5,6,7],T=null;let I=0,y="";for(let s of e){for(let l of((I==e.length-1||s.pageIndex<e[I+1].pageIndex)&&(s.isLastLine=!0),C)){let e=b[l];var w=e.parser.process(g,s,I,T,t[s.pageIndex],n[s.pageIndex]);if(w.length>0){for(let e of w){if(e.type!=c.TYPE_NAME&&e.type!=p.TYPE_NAME&&(y=""),e.type==c.TYPE_NAME){if(!"ABCDEFGH".startsWith(y+e.str))continue;y+=e.str;for(let e=g.length-1;e>=0&&g[e].type==a.TYPE_NAME;e--)g.splice(e,1)}e.type==p.TYPE_NAME&&(s.isFooter=!0),e.type==h.TYPE_NAME&&(v=!0),e.type==u.TYPE_NAME&&v&&b[5].parser.off(),g.push(e)}for(let t of e.on)b[t].parser.on();for(let t of e.off)b[t].parser.off();break}}T=s,I++}for(let e of b)e.parser.off();return g.forEach(t=>{if(!e[t.lineIndex].top){let n=m.getTopLine(s[t.pageIndex],t.lineIndex,e);e[t.lineIndex].top=n[0],1!=t.isIntersec&&(t.isIntersec=n[1])}}),g.forEach(t=>{if(!e[t.lineIndex].bottom){let n=m.getBottomLine(s[t.pageIndex],t.lineIndex,e);e[t.lineIndex].bottom=n[0],1!=t.isIntersec&&(t.isIntersec=n[0])}}),g}showOnCanvas(e,t,n,l,f,g){let v=new Date().getTime(),b=new Map([["A","rgba(18, 0, 255, 0.4)"],["B","rgba(0, 158, 34, 0.4)"],["C","rgba(50, 50, 50, 0.4)"],["D","rgba(132, 0, 137, 0.4)"],["E","rgba(132, 0, 137, 0.4)"],["F","rgba(132, 0, 137, 0.4)"],["G","rgba(132, 0, 137, 0.4)"],["H","rgba(132, 0, 137, 0.4)"]]),C=new Map([[o.TYPE_NAME,"red"],[c.TYPE_NAME,"blue"],[d.TYPE_NAME,"gray"],[x.TYPE_NAME,"green"],[h.TYPE_NAME,"orange"],[u.TYPE_NAME,"pink"],[p.TYPE_NAME,"yellow"],[a.TYPE_NAME,"black"]]);if(g.indexOf("quest")>=0)for(let t of e){for(let e of t.positions)m.drawBox(l[e.pageIndex],t.isGroup?"black":"red",e);for(let e of(m.drawBox(l[t.remove.pageIndex],"yellow",t.remove),t.answers)){for(let t of e.positions)m.drawBox(l[t.pageIndex],b.get(e.label)+"",t,!0);m.drawBox(l[e.remove.pageIndex],"yellow",e.remove),e.isCorrect&&m.drawPoint(l[e.positions[0].pageIndex],"green",e.positions[0])}if(t.help){for(let e of t.help.positions)m.drawBox(l[e.pageIndex],"orange",e);t.help.remove&&m.drawBox(l[t.help.remove.pageIndex],"yellow",t.help.remove)}}if(g.indexOf("line")>=0)for(let e of n)m.drawBox2(l[e.pageIndex],e.height<s.PdfConst.LINE_SMALL_HEIGHT?"red":"rgba(50, 58, 168, 0.4)",e.width,e.height,e.transform);if(g.indexOf("txt")>=0)for(let e of n)for(let t of e.textObjs)""!=t.str.trim()&&m.drawBox2(l[e.pageIndex],e.height<s.PdfConst.LINE_SMALL_HEIGHT?"red":"rgba(132, 0, 137, 0.2)",t.width,t.height,t.transform);if(g.indexOf("img")>=0)for(let e of f)m.drawBox2(l[e.pageIndex],"green",e.paintWidth,e.paintHeight,[0,0,0,0,-e.left,-e.top-e.paintHeight]);if(g.indexOf("pos")>=0)for(let e of t){let t={top:e.transform[5],left:e.transform[4],width:0,heigh:0,pageIndex:e.pageIndex};m.drawPoint(l[e.pageIndex],C.get(e.type)+"",t)}let T=new Date().getTime();this.updateStatusCallback&&this.updateStatusCallback("Draw done: "+(T-v)/1e3+" secs")}getQuestionInfo(e,t,n,l){if(0==e.length)return[];let x=0,f=[],g=new Map,m="",v=!1,b=!1,C=0;for(let T of(e.forEach((n,s)=>{s>0&&null==e[s-1].text&&(e[s-1].text=t.slice(e[s-1].lineIndex,n.lineIndex)),s==e.length-1&&(e[s].text=t.slice(e[s].lineIndex,t.length))}),e.forEach(T=>{let I=":"+T.type;v||T.type!=d.TYPE_NAME&&T.type!=h.TYPE_NAME||(v=!0);let y=null;for(let t=x+1;t<e.length;t++)if((T.type!=o.TYPE_NAME||e[t].type!=c.TYPE_NAME)&&e[t].type!=p.TYPE_NAME){y=e[t];break}let w=n[T.pageIndex].canvas.height-20;if(v||T.type!=a.TYPE_NAME||(C++,f.push({num:C,answers:[],remove:a.getRemoveBox(T,t),positions:a.getBoxes(T,t,y,w),isGroup:!0,text:T.text})),v||T.type!=o.TYPE_NAME||f.push({num:+T.str,answers:[],remove:o.getRemoveBox(T,t),positions:o.getBoxes(T,t,y,w),group:C,text:T.text}),!v&&T.type==c.TYPE_NAME&&f.length>0){let e=f[f.length-1].num,n={label:T.str,remove:c.getRemoveBox(T,t),positions:c.getBoxes(T,t,y,w)};l.size>0&&l.get(e)==n.label&&(n.isCorrect=!0),f[f.length-1].answers.push(n);let o=t[T.lineIndex].strLine.replace(/\|/g,"").trim().match(s.PdfConst.MULTIPLE_ANS_PATTERN.join("|"));null!=o&&o.length>0&&(f[f.length-1].isFixAns=!0),1==T.isIntersec&&(f[f.length-1].isFixAns=!0)}if(!b&&T.type==u.TYPE_NAME&&1==f.length&&m.endsWith(":".concat(o.TYPE_NAME,":").concat(c.TYPE_NAME))&&(b=!0),T.type==u.TYPE_NAME&&b){let e=f[f.length-1].num;g.set(e,{num:e,positions:u.getBoxes(T,t,y,w),text:T.text})}if(T.type!=u.TYPE_NAME||b||(g.clear(),v=!0),v&&T.type==o.TYPE_NAME){let e=+T.str;g.get(e)||g.set(e,{num:e,positions:o.getBoxes(T,t,y,w),remove:o.getRemoveBox(T,t),text:T.text})}m.endsWith(I)||T.type==p.TYPE_NAME||(m+=I),x++}),f))T.isGroup||(T.help=g.get(T.num),1==T.answers.length&&(T.answers=[]));return f}constructor(e,t){var n,l,o;this.cropperService=new g,this.labelHolderSize={width:3500,height:3500},this.totalPoint=10,this.quizId=e,this.callback=t;let a={RENDER_SCALE:2,LINE_SMALL_HEIGHT:8,SPLIT_MARGIN:3,INTERSEC_MARGIN:10,LINE_MAGIN:2,MARGIN_LEFT:2,ENABLE_IMAGE_PROCESS:!0,STEP_SIZE:3,CROP_FULL_WIDTH:!0,OVERLAP:.5,QUESTION_PATTERN:["(^c\xe2u\\s*\\d{1,4}[^0-9])","(^câu\\s*\\d{1,4}[^0-9])","(^c\xa9u\\s*\\d{1,4}[^0-9])","(^ca‚u\\s*\\d{1,4}[^0-9])","(^b\xe0i\\s*\\d{1,4}[^0-9])","(^bài\\s*\\d{1,4}[^0-9])","(^cau\\s*\\d{1,4}[^0-9])","(^bai\\s*\\d{1,4}[^0-9])","(^question\\s*\\d{1,4}[^0-9])","(^questions\\s*\\d{1,4}[^0-9])","(^\\[\\d{1,4}\\][^0-9])","(^\\d+\\s*\\(nb\\))","(^\\d+\\s*\\(th\\))","(^\\d+\\s*\\(vd\\))","(^\\d+\\s*\\(vdc\\))","(^c\xe2u\\s*\\d{1,4}[\\s\\.:]*$)","(^câu\\s*\\d{1,4}[\\s\\.:]*$)","(^c\xa9u\\s*\\d{1,4}[\\s\\.:]*$)","(^ca‚u\\s*\\d{1,4}[\\s\\.:]*$)","(^b\xe0i\\s*\\d{1,4}[\\s\\.:]*$)","(^bài\\s*\\d{1,4}[\\s\\.:]*$)","(^cau\\s*\\d{1,4}[\\s\\.:]*$)","(^bai\\s*\\d{1,4}[\\s\\.:]*$)","(^questions\\s*\\d{1,4}[\\s\\.:]*$)","(^question\\s*\\d{1,4}[\\s\\.:]*$)"],QUESTION_PATTERN2:["(^(\\d+\\s*\\.)\\s*[\\.0-9])","(^(\\d+\\s*\\.)\\s*\\(\\s*\\d+\\s*\\))","(^(\\d+\\s*\\.)\\s*[^\\s]\\s*[^\\s0-9])","(^\\d+\\s*\\.\\s*$)"],BREAK_LINE_PATTERN:["(^C\xe2u\\s*\\d+\\s*[:\\.]\\s*[Aa]\\s*\\.)","(^C\xa9u\\s*\\d+\\s*[:\\.]\\s*[Aa]\\s*\\.)","(^B\xe0i\\s*\\d+\\s*[:\\.]\\s*[Aa]\\s*\\.)","(^Cau\\s*\\d+\\s*[:\\.]\\s*[Aa]\\s*\\.)","(^Bai\\s*\\d+\\s*[:\\.]\\s*[Aa]\\s*\\.)","(^Question\\s*\\d+\\s*[:\\.]\\s*[Aa]\\s*\\.)","(^\\d+\\s*[:\\.]\\s*[Aa]\\s*\\.)"],SECTION_PATTERN_LOWER:["(^mark\\s*the\\s*letter)","(^read\\s*the\\s*follow)","(^reading\\s*the\\s*follow)","(^read\\s*the\\s*text)","(^read\\s*the\\s*passage)","(^read\\s*the\\s*paragraph)","(^read\\s*and\\s*choose)","(^put\\s*these\\s*word)","(^supply\\s*the\\s*correct)","(^make\\s*questions?\\s*for)","(^fill\\s*in\\s*the\\s*blank)","(^fill\\s*in\\s*each\\s*numbered)","(write\\s*the\\s*months\\s*in\\s*english)","(write\\s*the\\s*telephone\\s*numbers\\s*in\\s*english)","(^which\\s*of\\s*the\\s*following)","(^choose\\s*the\\s*suitable\\s*word)","(^choose\\s*the\\s*word)","(^choose\\s*the\\s*option)","(^choose\\s*the\\s*item\\s*among)","(^choose\\s*the\\s*underlined\\s*word)","(^combine\\s*two\\s*sentences)","(^each\\s*of\\s*the\\s*following)","(^finish\\s*the\\s*second\\s*sentence)","(^identify\\s*the\\s*underlined)","(^identify\\s*a\\s*mistake)","(^indicate\\s*the\\s*word)","(^indicate\\s*the\\s*correct)","(^indicate\\s*the\\s*sentence)","(^indicate\\s*the\\s*underlined)","(^circle\\s*the\\s*underlined)","(^circle\\s*the\\s*word\\s*whose\\s*underlined)","(^choose\\s*the\\s*underlined)","(^\\*?find\\s*the\\s*word)","(^find\\s*a\\s*mistake)","(^fill\\s*the\\s*circle)","(^listen\\s*to.*conversation)","(^there\\s*are.*blanks\\s*in\\s*the\\s*passage\\s*below)","(^listen\\s*to\\s*the\\s*recording)","(^listen\\s*and\\s*circle)","(^listen\\s*again\\s*and\\s*choose)","(^\\*?listen\\s*and\\s*complete)","(^\\*?choose\\s*the\\s*best)","(^choose\\s*the\\s*correct)","(^put\\s*in\\s*the\\s*correct)","(^complete\\s*the\\s*second\\s*sentence)","(^complete\\s*the\\s*sentences)","(^give\\s*the\\s*correct\\s*form)","(^mark\\s*a,\\s*b,)","(^circle\\s*the\\s*letter)","(^you\\s*will\\s*hear)","(^blacken\\s*the\\s*letter)","(^đọc\\s*đoạn\\s*tr\xedch)","(^dựa\\s*v\xe0o\\s*th\xf4ng\\s*tin\\s*dưới\\s*đ\xe2y)","(^dựa\\s*v\xe0o\\s*c\xe1c\\s*th\xf4ng\\s*tin\\s*được\\s*cung\\s*cấp\\s*dưới\\s*đ\xe2y)","(^section\\s*[0-9abcdefghivx]+)","(^part[^a-z]+[0-9abcdefghivx]+\\s*[\\.:\\-])","(^phần\\s*[0-9abcdefivx]+[\\.:])","(^nh\xf3m\\s*[0-9abcdefivx]+[\\.:])","(^chương\\s*[0-9abcdefivx]+[\\.:])","(^questions?\\s*\\d+\\s*[\\–\\-to]+\\s*\\d+)","(^passage\\s*[0-9abcdefghivx]+)","(^use\\s*the\\s*word\\s*given\\s*in\\s*capitals)","(^tự\\s*luận)"],SECTION_PATTERN_NORMAL:["(^[IVX]+\\s*[\\.\\-\\–]\\s*[A-Z\xc0Ả\xc3\xc1ẠĂẰẲẴẮẶ\xc2ẦẨẪẤẬĐ\xc8ẺẼ\xc9Ẹ\xcaỀỂỄẾỆ\xccỈĨ\xcdỊ\xd2Ỏ\xd5\xd3Ọ\xd4ỒỔỖỐỘƠỜỞỠỚỢ\xd9ỦŨ\xdaỤƯỪỬỮỨỰỲỶỸ\xddỴ]+)","(^[\\d]+\\.[\\d]+\\.[\\d]*\\.*\\s*[A-Z\xc0Ả\xc3\xc1ẠĂẰẲẴẮẶ\xc2ẦẨẪẤẬĐ\xc8ẺẼ\xc9Ẹ\xcaỀỂỄẾỆ\xccỈĨ\xcdỊ\xd2Ỏ\xd5\xd3Ọ\xd4ỒỔỖỐỘƠỜỞỠỚỢ\xd9ỦŨ\xdaỤƯỪỬỮỨỰỲỶỸ\xddỴ]+)","(^[IVX]+\\s*[\\.:]\\s*$)"],KICK_PATTERN:["(^Chọn\\s*[ABВCDEFGHIJK]+)","(^Chon\\s*[ABВCDEFGHIJK]+)"],TVCN_CHAR:[["Α","A"],["В","B"]],HET_PATTERN:["(HẾT)","(H\xcáT)","(HET)","(\\-\\-HT\\-\\-)","(THE\\s*END)","(The\\s*end[^a-z0-9]*$)","(^[^A-Za-z]*Hết[^A-Za-z]*)$"],DAPAN_PATTERN:["(\xc1P \xc1N)","(\xc1P \xc1)","(\xc1P\xc1N)","(ÁP ÁN)","(BẢNG\xc1\xc1)","(KHO\xc1\\s*C\xc2U\\s*TRẮC\\s*NGHIỆM)","(ÁPÁN)","(ANSWER KEYS)","(^KEYS$)","(Bảng\\s*đ\xe1p\\s*\xe1n)","(Đ\xe1p\\s*\xe1n\\s*v\xe0\\s*hướng)","(Dap\\s*an\\s*va\\s*huong)","(Đ\xe1p\\s*\xe1n\\s*[.:]\\s*$)","(Đ\xe1p\\s*\xe1n\\s*$)"],HUONGDAN_PATTERN:["(HƯỚNG\\s*DẪN)","(ƯỚNG\\s*DẪN\\s*GIẢI\\s*CHI)","(GIẢI\\s*TH\xcdCH\\s*CHI\\s*TIẾT)","(Hướng\\s*dẫn\\s*giải)","(Lời\\s*giải)","(LỜI\\s*GIẢI)","(GIẢI\\s*CHI\\s*TIẾT)","(HD:)","(GLOSSARY)"],MULTIPLE_ANS_PATTERN:["([ABCDEFGH]\\s*v\xe0\\s*[ABCDEFGH]\\s*đều)","(Cả\\s*[ABCDEFGH]\\s*v\xe0\\s*[ABCDEFGH])","(Cả\\s*[ABCDEFGH]\\s*,\\s*[ABCDEFGH])","(Cả\\s*3\\s*đ\xe1p\\s*\xe1n)","(Cả\\s*đ\xe1p\\s*\xe1n)","(Tất\\s*cả\\s*đ\xe1p\\s*\xe1n)","(Kết\\s*quả\\s*kh\xe1c)","(Đ\xe1p\\s*\xe1n\\s*kh\xe1c)","(Đ\xe1p\\s*\xe1n\\s*[ABCDEFGH]\\s*v\xe0\\s*[ABCDEFGH])","(Tất\\s*cả\\s*đều)"],DRAW_RESULT:"",SKIP_CHAR:["","√","p","(",")","[","]","{","}",""],FOOTER_PATTERN:["(trang\\s*\\d+)","(Page\\s*\\d+)","(Trang\\s*\\d+)","(TRANG\\s*\\d+)","(^\\d{1,4}$)","(^[\\-\\s]*\\d{1,4}[\\-\\s]*$)"],HELP_ANS_PATTERN:["([\\s\\.]*Chọn\\s*([A-K]))","([\\d\\s\\.:]*Đ\xe1p\\s*\xe1n\\s*([A-K]))","([\\d\\s\\.:]*Đ\xe1p\\s*\xe1n\\s*l\xe0\\s*([A-K]))","([\\d\\s\\.:]*Chọn\\s*đ\xe1p\\s*\xe1n\\s*([A-K]))"],RES_ANS_PATTERN:["(\\d+[.-][^|0-9])"],STRANS_SPLIT:"|/\\"};s.PdfConst.RENDER_SCALE=a.RENDER_SCALE,s.PdfConst.LINE_SMALL_HEIGHT=a.LINE_SMALL_HEIGHT*s.PdfConst.RENDER_SCALE,s.PdfConst.SPLIT_MARGIN=a.SPLIT_MARGIN*s.PdfConst.RENDER_SCALE,s.PdfConst.INTERSEC_MARGIN=a.INTERSEC_MARGIN*s.PdfConst.RENDER_SCALE,s.PdfConst.LINE_MAGIN=a.LINE_MAGIN*s.PdfConst.RENDER_SCALE,s.PdfConst.MARGIN_LEFT=a.MARGIN_LEFT*s.PdfConst.RENDER_SCALE,s.PdfConst.ENABLE_IMAGE_PROCESS=a.ENABLE_IMAGE_PROCESS,s.PdfConst.STEP_SIZE=a.STEP_SIZE,s.PdfConst.CROP_FULL_WIDTH=a.CROP_FULL_WIDTH,s.PdfConst.OVERLAP=a.OVERLAP,s.PdfConst.QUESTION_PATTERN=a.QUESTION_PATTERN,s.PdfConst.QUESTION_PATTERN2=a.QUESTION_PATTERN2,s.PdfConst.BREAK_LINE_PATTERN=a.BREAK_LINE_PATTERN,s.PdfConst.SECTION_PATTERN_LOWER=a.SECTION_PATTERN_LOWER,s.PdfConst.SECTION_PATTERN_NORMAL=a.SECTION_PATTERN_NORMAL,s.PdfConst.KICK_PATTERN=a.KICK_PATTERN,s.PdfConst.TVCN_CHAR=a.TVCN_CHAR,s.PdfConst.HET_PATTERN=a.HET_PATTERN,s.PdfConst.DAPAN_PATTERN=a.DAPAN_PATTERN,s.PdfConst.HUONGDAN_PATTERN=a.HUONGDAN_PATTERN,s.PdfConst.MULTIPLE_ANS_PATTERN=a.MULTIPLE_ANS_PATTERN,s.PdfConst.DRAW_RESULT=a.DRAW_RESULT,s.PdfConst.SKIP_CHAR=a.SKIP_CHAR,s.PdfConst.FOOTER_PATTERN=null!==(n=a.FOOTER_PATTERN)&&void 0!==n?n:["(trang\\s*\\d+)","(Page\\s*\\d+)","(Trang\\s*\\d+)","(TRANG\\s*\\d+)","(^\\d{1,4}$)"],s.PdfConst.HELP_ANS_PATTERN=null!==(l=a.HELP_ANS_PATTERN)&&void 0!==l?l:["([\\s\\.]*Chọn\\s*([ABCDEFGH]))"],s.PdfConst.ANS_PATTERN=null!==(o=a.ANS_PATTERN)&&void 0!==o?o:["([\\s\\|\\.]+[ABCDEFGHIJK][\\s\\|]*[\\.\\)])"]}}},6591:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});let s=n(8754),l=s._(n(6781)),o=s._(n(9716)),a=s._(n(1674)),c=(e,t)=>{var n=document.createElement("script");n.type="text/javascript",n.src=e,n.onload=t,n.onerror=e=>{console.log(e)},document.head.appendChild(n)},d=(e,t)=>{var n=0;!function s(){if(n<e.length){var l=e[n];c(a.default.assetPrefix+l,function(){n++,s()})}else"function"==typeof t&&t()}()},h=(e,t)=>{let n=document.createElement("input");n.setAttribute("type","file"),n.setAttribute("accept",".pdf,.docx"),n.click(),n.onchange=async()=>{let[s]=n.files;if(s){t({status:"loading",data:{status:"Đang xử l\xfd tệp tin"}});try{s.name.endsWith(".docx")?d(["/scripts/docx_v3.js","/scripts/SaxonJS2_v2.js","/scripts/sprintf.min.js","/scripts/bundle.js","/scripts/wmf.v1.js","/scripts/FromEMF.f1.js","/scripts/ToContext2D.f1.js","/scripts/UDOC.f1.js","/scripts/mathml2latex.js"],function(){let n=new l.default(e,t);n.parseDocx(s)}):s.name.endsWith(".pdf")?d(["/scripts/pdf.js","/scripts/pdf.worker.js"],function(){let n=new o.default(e,t);n.parsePdf(s)}):t({error:"Định dạng kh\xf4ng hỗ trợ. Vui l\xf2ng sử dụng tập tin định dạng .pdf hoặc .docx"})}catch(e){console.error("Error uploading image:",e),t({error:"Error uploading image:"})}}}};e.exports={ImportFile:h}},3401:function(e,t,n){"use strict";n.r(t);var s=n(5893),l=n(7294),o=n(1649),a=n(2078),c=n(131),d=n(6822),h=n(3321),u=n(948),x=n(5861),p=n(9581),f=n(1425),g=n(3946),m=n(8462),v=n(2852),b=n(9334),C=n(8987),T=n(5438),I=n(3395),y=n(8619),w=n(4386),E=n(9878);let j=(0,u.ZP)(g.Z)(e=>{let{theme:t}=e;return{top:0,right:0,color:"grey.500",position:"absolute",boxShadow:t.shadows[2],transform:"translate(10px, -10px)",borderRadius:t.shape.borderRadius,backgroundColor:"".concat(t.palette.background.paper," !important"),transition:"transform 0.25s ease-in-out, box-shadow 0.25s ease-in-out","&:hover":{transform:"translate(7px, -5px)"}}}),A=[{key:"upper",title:"Bỏ qua chữ hoa",icon:"tabler:letter-case-lower",subtitle:'"Đ\xe1p \xe1n" th\xe0nh "đ\xe1p \xe1n"'},{key:"sign",title:"Bỏ qua dấu c\xe2u",icon:"tabler:bolt",subtitle:'"Đ\xe1p \xe1n" th\xe0nh "dap an"'},{key:"space",title:"Bỏ qua dấu c\xe1ch",icon:"tabler:separator-vertical",subtitle:'"Đ\xe1p \xe1n" th\xe0nh "Đ\xe1p\xe1n"'}];t.default=()=>{let e=(0,o.v9)(e=>e.popup.data),t=(0,o.I0)(),[n,u]=(0,l.useState)(e),P=()=>{t((0,a.z)({status:""}))},S=e=>()=>{u({...n,...e})},N=()=>{let{questionId:e,title:s,...l}=n;t((0,c.Ds)({id:e,settings:l})),P()},Z=()=>{let{questionId:e,title:s,...l}=n;t((0,c.Zw)({questionId:e,type:"settings",value:l,list:"exam"})),P()};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(p.Z,{sx:{pb:e=>"".concat(e.spacing(8)," !important"),px:e=>["".concat(e.spacing(5)," !important"),"".concat(e.spacing(15)," !important")],pt:e=>["".concat(e.spacing(8)," !important"),"".concat(e.spacing(12.5)," !important")]},children:[(0,s.jsx)(j,{onClick:P,children:(0,s.jsx)(E.Z,{icon:"tabler:x",fontSize:"1.25rem"})}),(0,s.jsx)(d.Z,{sx:{mb:5,textAlign:"center"},children:(0,s.jsx)(x.Z,{variant:"h5",sx:{mb:3},children:n.title})}),(0,s.jsx)(m.Z,{subheader:(0,s.jsx)(T.Z,{children:"C\xe0i đặt"}),children:A.map(e=>(0,s.jsxs)(y.Z,{onClick:S({[e.key]:!n[e.key]}),divider:!0,children:[(0,s.jsx)(C.Z,{children:(0,s.jsx)(E.Z,{icon:e.icon,fontSize:20})}),(0,s.jsxs)(b.Z,{children:[e.title,(0,s.jsx)(w.Z,{title:e.subtitle,children:(0,s.jsx)(g.Z,{size:"small",children:(0,s.jsx)(E.Z,{icon:"tabler:info-square-rounded",fontSize:20})})})]}),(0,s.jsx)(I.Z,{children:(0,s.jsx)(v.Z,{edge:"end",checked:n[e.key]||!1})})]},e.key))})]}),(0,s.jsxs)(f.Z,{sx:{justifyContent:"center",px:e=>["".concat(e.spacing(5)," !important"),"".concat(e.spacing(15)," !important")],pb:e=>["".concat(e.spacing(8)," !important"),"".concat(e.spacing(12.5)," !important")]},children:[(0,s.jsx)(h.Z,{variant:"tonal",color:"secondary",onClick:P,children:"Hủy"}),(0,s.jsx)(h.Z,{variant:"contained",sx:{mr:1},onClick:N,children:"Lưu"}),(0,s.jsx)(h.Z,{variant:"contained",sx:{mr:1},onClick:Z,color:"success",children:"\xc1p dụng cho c\xe1c c\xe2u c\xf2n lại"})]})]})}}},function(e){e.O(0,[265,518,393,774,888,179],function(){return e(e.s=5603)}),_N_E=e.O()}]);