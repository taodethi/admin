(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[523],{4264:function(t,s,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/p/create.html",function(){return n(4493)}])},6316:function(t,s,n){"use strict";var i=n(7294),r=n(6485),l=n.n(r);let a=t=>t&&("TEXTAREA"===t.nodeName||"INPUT"===t.nodeName);s.Z=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=(0,i.useRef)(null),n=()=>{t.onSuccess&&t.onSuccess(),t.selectOnCopy&&a(s.current)&&s.current.select()},r=()=>{t.onError&&t.onError();let n=!1!==t.selectOnError;n&&a(s.current)&&s.current.select()},h=t=>{l()(t).then(n).catch(r)},c=(0,i.useCallback)(t=>{"string"==typeof t?h(t):s.current&&h(s.current.value)},[]);return{copy:c,target:s}}},4493:function(t,s,n){"use strict";n.r(s),n.d(s,{default:function(){return tA}});var i=n(5893),r=n(6886),l=n(1649),a=n(131),h=n(9878),c=n(3321),d=n(2078),u=n(7052),p=n(7294),x=n(3946),g=n(7922),f=n(6822),v=n(4386),b=n(1664),E=n.n(b),T=n(8333),C=n(7720),I=n(8972),w=n(8756);let A=t=>{let{children:s,option:n}=t;return n.href?(0,i.jsx)(f.Z,{component:E(),href:n.href,...n.linkProps,sx:{px:4,py:1.5,width:"100%",display:"flex",color:"inherit",alignItems:"center",textDecoration:"none"},children:s}):(0,i.jsx)(i.Fragment,{children:s})},j=t=>{let{icon:s,options:n,menuProps:r,iconProps:l,leftAlignMenu:a,iconButtonProps:c}=t,[d,u]=(0,p.useState)(null),{settings:g}=(0,w.r)(),{direction:f}=g,v=t=>{u(t.currentTarget)},b=()=>{u(null)};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(x.Z,{"aria-haspopup":"true",onClick:v,...c,children:s||(0,i.jsx)(h.Z,{icon:"tabler:dots-vertical",...l})}),(0,i.jsx)(T.Z,{keepMounted:!0,anchorEl:d,onClose:b,open:!!d,...!a&&{anchorOrigin:{vertical:"bottom",horizontal:"ltr"===f?"right":"left"},transformOrigin:{vertical:"top",horizontal:"ltr"===f?"right":"left"}},...r,children:n.map((t,s)=>"string"==typeof t?(0,i.jsx)(I.Z,{onClick:b,children:t},s):"divider"in t?t.divider&&(0,i.jsx)(C.Z,{...t.dividerProps},s):(0,i.jsx)(I.Z,{...t.menuItemProps,...t.href&&{sx:{p:0}},onClick:s=>{b(),t.menuItemProps&&t.menuItemProps.onClick&&t.menuItemProps.onClick(s)},children:(0,i.jsxs)(A,{option:t,children:[t.icon?t.icon:null,t.text]})},s))})]})};var P=n(6455),y=n.n(P),N=n(6242),_=n(8445),S=n(4267),L=n(5861),Z=n(6901),k=n(7109),R=n(7918),M=n(8462),O=n(9294),H=n(8619),q=n(9334),B=n(8232);let F=t=>isNaN(parseFloat(t))?0:parseFloat(t).toFixed(2);var G=t=>{let{questionId:s}=t,n=(0,l.v9)(t=>t.quiz.questions.find(t=>t.id==s)),r=(0,l.I0)(),h=t=>{r((0,a.Ds)({id:s,...t}))},[c,d]=(0,p.useState)(!1),[u,x]=(0,p.useState)(!1),g=t=>()=>{r((0,a.Zw)({questionId:s,type:"point",value:n.point||0,list:t})),x(!1)},f=()=>{d(!0),x(!1)};return c?(0,i.jsx)(B.Z,{type:"number",size:"small",sx:{width:"auto",maxWidth:"8rem"},value:n.point||0,InputProps:{inputProps:{min:0,max:10,step:.01},endAdornment:(0,i.jsx)(k.Z,{position:"end",children:"điểm"})},onMouseLeave:()=>d(!1),onChange:t=>h({point:t}),timeout:300}):(0,i.jsx)(v.Z,{open:u,onOpen:()=>x(!0),onClose:()=>x(!1),title:(0,i.jsxs)(M.Z,{component:"div",children:[(0,i.jsx)(O.ZP,{disablePadding:!0,children:(0,i.jsx)(H.Z,{sx:{paddingX:1},onClick:f,children:(0,i.jsx)(q.Z,{disableTypography:!0,sx:{fontSize:".75rem",textAlign:"center"},children:"Click để sửa điểm"})})}),(0,i.jsx)(O.ZP,{disablePadding:!0,children:(0,i.jsx)(H.Z,{sx:{paddingX:1},onClick:g("group"),children:(0,i.jsx)(q.Z,{disableTypography:!0,sx:{fontSize:".75rem"},children:"\xc1p dụng cho c\xe2u c\xf2n lại trong nh\xf3m"})})}),(0,i.jsx)(O.ZP,{disablePadding:!0,children:(0,i.jsx)(H.Z,{sx:{paddingX:1},onClick:g("exam"),children:(0,i.jsx)(q.Z,{disableTypography:!0,sx:{fontSize:".75rem"},children:"\xc1p dụng cho c\xe2u c\xf2n lại trong đề thi"})})})]}),arrow:!0,children:(0,i.jsx)(R.Z,{variant:"outlined",label:F(n.point)+" điểm",skin:"light",color:"primary",sx:{cursor:"pointer"},onClick:f})})},z=n(7435),Y=t=>{let{questionId:s}=t,n=(0,l.v9)(t=>t.quiz.questions.find(t=>t.id==s)),r=(0,l.I0)(),h=t=>{r((0,a.Ds)({id:s,...t}))},[c,d]=(0,p.useState)(!1);return c?(0,i.jsxs)(z.Z,{spacing:2,onMouseLeave:()=>{d(!1)},children:[(0,i.jsx)(B.Z,{label:"Nh\xe3n",size:"small",value:n.label,onChange:t=>h({label:t.trim()}),sx:{maxWidth:"15rem"},timeout:100}),(0,i.jsx)(B.Z,{label:"STT",type:"number",size:"small",value:n.number,InputProps:{inputProps:{min:1}},sx:{maxWidth:"15rem"},onChange:t=>h({number:t}),timeout:300})]}):(0,i.jsx)(v.Z,{title:"Click để sửa số thứ tự c\xe2u",children:(0,i.jsx)(R.Z,{label:"".concat(n.label||"C\xe2u"," ").concat(n.number),color:"primary",onClick:()=>d(!0)})})},$=n(8987),U=n(410),W=n(8885),Q=n(8456),V=n(5152),K=n.n(V);let X=K()(()=>Promise.all([n.e(265),n.e(446),n.e(937),n.e(850),n.e(874),n.e(931)]).then(n.bind(n,4931)).then(t=>t.default),{loadableGenerated:{webpack:()=>[4931]},ssr:!1,loading:()=>(0,i.jsx)(f.Z,{sx:{textAlign:"center"},children:(0,i.jsx)(Q.Z,{})})}),J=t=>(0,i.jsx)("div",{children:(0,i.jsx)(X,{...t})});var ee=p.memo(J);let et={mouseX:null,mouseY:null},es=t=>{let{children:s,onClick:n}=t,[r,l]=(0,p.useState)(et),a=t=>{t.preventDefault(),l({mouseX:t.clientX-2,mouseY:t.clientY-4})},c=()=>{n({index:s.key,type:"remove"}),d()},d=()=>{l(et)};return(0,i.jsxs)("div",{onContextMenu:a,style:{cursor:"context-menu"},children:[s,(0,i.jsx)(T.Z,{keepMounted:!0,onClose:d,open:null!==r.mouseY,anchorReference:"anchorPosition",anchorPosition:null!==r.mouseY&&null!==r.mouseX?{top:r.mouseY,left:r.mouseX}:void 0,children:(0,i.jsxs)(I.Z,{onClick:c,children:[(0,i.jsx)(W.Z,{children:(0,i.jsx)(h.Z,{icon:"tabler:circle-x",fontSize:20})}),(0,i.jsx)(q.Z,{primary:"X\xf3a đ\xe1p \xe1n n\xe0y"})]})})]})},en=t=>{let{question:s,onChange:n}=t,{type:r,options:a=[],settings:u={},id:g}=s,[b,E]=(0,p.useState)(!1),[T,I]=(0,p.useState)(""),[w,A]=(0,p.useState)(a),j=(0,l.I0)(),P=function(t){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return()=>{switch(r){case"TN":A(s=>s.map((s,n)=>({...s,keys:n===t})));break;case"HK":A(s=>s.map((s,n)=>({...s,keys:n===t?!s.keys:s.keys})));break;case"TF":A(n=>n.map((n,i)=>({...n,keys:i===t?s:n.keys})))}}},y=()=>{let t={text:"",keys:""};A(s=>[...s,t])},N=()=>{A(t=>[...t,...T.split("\n").map(t=>({text:t.trim(),keys:""})).filter(t=>t.text)]),I(""),E(!1)},_=t=>{let{index:s,type:n}=t;"remove"===n&&A(t=>{var n=[...t];return n.splice(parseInt(s),1),n})},S=()=>{j((0,d.z)({status:"options",data:{questionId:g,title:"CẤU H\xccNH NHẬN DIỆN Đ\xc1P \xc1N ĐIỀN TỪ",...u}}))},L=(0,p.useMemo)(()=>w.map((t,s)=>{let n=t=>{A(n=>n.map((n,i)=>({...n,text:i===s?t:n.text})))};return(0,i.jsx)(es,{onClick:_,children:(0,i.jsx)(O.ZP,{disablePadding:!0,sx:{borderRadius:1,mb:1,border:"1px solid #b2b2b299"},children:(0,i.jsxs)(H.Z,{sx:{paddingX:1.25,borderRadius:1},user:"TF"!==r&t.keys?"right":"",children:["TF"==r?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(U.Z,{skin:"light",color:"success",sx:{mr:1},user:"T"==t.keys?"right":"",onClick:P(s,"T"),children:"Đ"}),(0,i.jsx)(U.Z,{skin:"light",user:"F"==t.keys?"right":"",color:"success",sx:{mr:1},onClick:P(s,"F"),children:"S"}),(0,i.jsx)(U.Z,{skin:"light",sx:{mr:1},children:String.fromCharCode(97+s)})]}):(0,i.jsx)($.Z,{sx:{mr:1.25},onClick:P(s),children:(0,i.jsx)(U.Z,{skin:t.keys?"light-static":"light",sx:{fontWeight:600},children:"MN|DT".includes(r)?s+1:String.fromCharCode(65+s)})}),(0,i.jsx)(q.Z,{disableTypography:!0,sx:{justifyItems:"center"},children:"DT"==r?(0,i.jsx)(B.Z,{placeholder:"Vui l\xf2ng nhập danh s\xe1ch đ\xe1p \xe1n cần th\xeam",fullWidth:!0,value:t.text||"",onChange:n}):(0,i.jsx)(ee,{content:t.text||"",onChange:n})})]})},s)},s)}),[w,r]);return((0,p.useEffect)(()=>{JSON.stringify(a)!==JSON.stringify(w)&&n({options:w})},[w,a]),(0,p.useEffect)(()=>{JSON.stringify(a)!==JSON.stringify(w)&&A(a)},[]),"TN|HK|MN|DT|TF".includes(r))?(0,i.jsxs)(f.Z,{sx:{mb:2},children:[(0,i.jsxs)(f.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,i.jsx)(C.Z,{sx:{flexGrow:"1"},children:"DANH S\xc1CH Đ\xc1P \xc1N"}),"DT".includes(r)?(0,i.jsx)(v.Z,{title:"C\xe0i đặt nhận diện đ\xe1p \xe1n",children:(0,i.jsx)(x.Z,{size:"small",sx:{ml:1},onClick:S,children:(0,i.jsx)(h.Z,{icon:"tabler:settings-check",fontSize:20})})}):null]}),(0,i.jsx)(M.Z,{children:L}),(0,i.jsxs)(f.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[(0,i.jsx)(c.Z,{variant:"contained",size:"small",color:"success",onClick:y,children:"Th\xeam đ\xe1p \xe1n"}),(0,i.jsx)(c.Z,{variant:"tonal",size:"small",onClick:()=>E(!0),children:"Th\xeam nhanh"})]}),b?(0,i.jsxs)(f.Z,{children:[(0,i.jsx)(B.Z,{placeholder:"Vui l\xf2ng nhập danh s\xe1ch đ\xe1p \xe1n cần th\xeam",helperText:"* Lưu \xfd mỗi đ\xe1p \xe1n chỉ tr\xean một d\xf2ng",fullWidth:!0,minRows:3,multiline:!0,value:T,onChange:t=>I(t)}),(0,i.jsxs)(f.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"flex-end",mb:2},children:[(0,i.jsx)(c.Z,{variant:"tonal",size:"small",onClick:()=>{E(!1),I("")},sx:{mr:1},children:"Hủy"}),(0,i.jsx)(c.Z,{variant:"contained",size:"small",onClick:N,children:"X\xe1c nhận"})]})]}):null]}):null};var ei=p.memo(en),er=n(5438),el=n(3395),ea=n(2852),eo=n(1903),eh=p.memo(function(t){let{videoId:s}=t;return(0,i.jsx)("div",{style:{position:"relative",paddingBottom:"56.25%",height:0,overflow:"hidden"},children:(0,i.jsx)("iframe",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%"},src:"https://www.youtube.com/embed/".concat((t=>{let s=t.match(/^(?:https?:\/\/)?(?:www\.)?youtu\.?be(?:\.com)?\/(?:watch\?v=|embed\/|v\/|youtu\.be\/|youtube\.com\/(?:c\/|v\/|u\/\w+\/|embed\/|watch\?v=|shorts\/))([\w-]{11})(?:[?&].*|$)/);return s?s[1]:null})(s)),title:"YouTube video player",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",frameBorder:"0",allowFullScreen:!0})})}),ec=p.memo(t=>{let{audio:s,onChange:n}=t,[r,l]=(0,p.useState)(""),{type:a,src:d}=s||{},u=t=>{let i=t.target.files[0];if(i){if("audio/mp3"===i.type||"audio/wav"===i.type||"audio/mpeg"===i.type||"audio/ogg"===i.type){let t=URL.createObjectURL(i);n({...s,src:t,type:"audio"})}else y().fire({icon:"error",title:"Oops...",text:"Chọn một file \xe2m thanh MP3 hoặc WAV."})}},g=t=>{let s=t.match(/^(?:https?:\/\/)?(?:www\.)?youtu\.?be(?:\.com)?\/(?:watch\?v=|embed\/|v\/|youtu\.be\/|youtube\.com\/(?:c\/|v\/|u\/\w+\/|embed\/|watch\?v=|shorts\/))([\w-]{11})(?:[?&].*|$)/);return s?s[1]:null},b=()=>{let t=g(r);t?(E({...s,src:r,type:"youtube"}),l("")):console.log("URL kh\xf4ng hợp lệ hoặc kh\xf4ng phải l\xe0 URL của video YouTube.")},E=t=>{n({...s,...t})};return(0,i.jsxs)(f.Z,{sx:{mb:2},children:[(0,i.jsxs)(f.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,i.jsxs)(c.Z,{variant:"tonal",fullWidth:!0,component:"label",sx:{mr:2},endIcon:(0,i.jsx)(h.Z,{icon:"tabler:headphones-filled"}),children:["Đ\xednh k\xe8m file \xe2m thanh",(0,i.jsx)("input",{type:"file",accept:".mp3, .wav,.mpeg, .ogg",hidden:!0,onChange:u})]}),(0,i.jsx)(c.Z,{variant:"tonal",fullWidth:!0,color:"success",endIcon:(0,i.jsx)(h.Z,{icon:"tabler:brand-youtube-filled"}),onClick:()=>{n({...s,type:"youtube",src:""})},children:"Đ\xednh k\xe8m video youtube"})]}),"youtube"!=a||d?null:(0,i.jsxs)(f.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",marginY:3},children:[(0,i.jsx)(eo.Z,{size:"small",fullWidth:!0,variant:"outlined",label:"Link youtube",placeholder:"https://www.youtube.com/watch?v=TAODETHI",sx:{mr:2},color:"success",value:r,onChange:t=>l(t.target.value)}),(0,i.jsx)(c.Z,{variant:"outlined",color:"success",endIcon:(0,i.jsx)(h.Z,{icon:"tabler:square-rounded-plus-filled"}),onClick:b,children:"Th\xeam"})]}),"youtube"==a&&d?(0,i.jsx)(f.Z,{sx:{marginY:3},children:(0,i.jsx)(eh,{videoId:d})}):null,"audio"==a&&d?(0,i.jsx)(f.Z,{sx:{marginY:3},children:(0,i.jsx)("audio",{controls:!0,controlsList:"nodownload",preload:"metadata",src:d,style:{width:"100%"}})}):null,d?(0,i.jsxs)(M.Z,{subheader:(0,i.jsx)(er.Z,{children:"C\xe0i đặt Tệp đ\xednh k\xe8m"}),children:[(0,i.jsxs)(H.Z,{divider:!0,onClick:()=>E({download:!s.download}),children:[(0,i.jsx)($.Z,{children:(0,i.jsx)(h.Z,{icon:"tabler:download",fontSize:20})}),(0,i.jsxs)(q.Z,{children:["Cho ph\xe9p tải file xuống",(0,i.jsx)(v.Z,{title:"Người nghe c\xf3 thể tải tập tin n\xe0y xuống m\xe1y t\xednh, điện thoại",children:(0,i.jsx)(x.Z,{size:"small",children:(0,i.jsx)(h.Z,{icon:"tabler:info-square-rounded",fontSize:20})})})]}),(0,i.jsx)(el.Z,{children:(0,i.jsx)(ea.Z,{edge:"end",checked:s.download||!1})})]}),(0,i.jsxs)(H.Z,{divider:!0,onClick:()=>E({next:!s.next}),children:[(0,i.jsx)($.Z,{children:(0,i.jsx)(h.Z,{icon:"tabler:player-track-next",fontSize:20})}),(0,i.jsxs)(q.Z,{children:["Cho ph\xe9p tua file nghe, video",(0,i.jsx)(v.Z,{title:"Người nghe c\xf3 thể tua để nghe trước tập tin \xe2m thanh hoặc video",children:(0,i.jsx)(x.Z,{size:"small",children:(0,i.jsx)(h.Z,{icon:"tabler:info-square-rounded",fontSize:20})})})]}),(0,i.jsx)(el.Z,{children:(0,i.jsx)(ea.Z,{edge:"end",checked:s.next||!1})})]}),(0,i.jsxs)(H.Z,{divider:!0,onClick:()=>E({speed:!s.speed}),children:[(0,i.jsx)($.Z,{children:(0,i.jsx)(h.Z,{icon:"tabler:brand-speedtest",fontSize:20})}),(0,i.jsxs)(q.Z,{children:["Cho ph\xe9p tăng, giảm tốc độ nghe",(0,i.jsx)(v.Z,{title:"Người nghe c\xf3 thể tăng tốc độ l\xean 2x hoặc x\xf3a 0.5x khi nghhe",children:(0,i.jsx)(x.Z,{size:"small",children:(0,i.jsx)(h.Z,{icon:"tabler:info-square-rounded",fontSize:20})})})]}),(0,i.jsx)(el.Z,{children:(0,i.jsx)(ea.Z,{edge:"end",checked:s.speed||!1})})]})]}):null]})});let ed=t=>{let{options:s=[],label:n="",questionId:r,onChange:h,value:c="",type:d="level"}=t,[u,x]=(0,p.useState)(!1),g=(0,l.I0)(),f=t=>()=>{g((0,a.Zw)({questionId:r,type:d,value:c,list:t})),x(!1)};return(0,i.jsx)(v.Z,{open:u,title:(0,i.jsxs)(M.Z,{component:"div",children:[(0,i.jsx)(O.ZP,{disablePadding:!0,children:(0,i.jsx)(H.Z,{sx:{paddingX:1},onClick:f("group"),children:(0,i.jsx)(q.Z,{disableTypography:!0,sx:{fontSize:".75rem"},children:"\xc1p dụng cho c\xe2u c\xf2n lại trong nh\xf3m"})})}),(0,i.jsx)(O.ZP,{disablePadding:!0,children:(0,i.jsx)(H.Z,{sx:{paddingX:1},onClick:f("exam"),children:(0,i.jsx)(q.Z,{disableTypography:!0,sx:{fontSize:".75rem"},children:"\xc1p dụng cho c\xe2u c\xf2n lại trong đề thi"})})})]}),placement:"top",arrow:!0,onOpen:()=>x(!0),onClose:()=>x(!1),children:(0,i.jsx)(eo.Z,{select:!0,label:n,size:"small",sx:{mr:1},value:c||"",onChange:t=>h(t.target.value),children:s.map(t=>(0,i.jsx)(I.Z,{value:t.key,children:t.title},t.key))})})};var eu=p.memo(ed);let ep=new class{count(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default";t in this.data||this.clear(t),this.data[t]++}get(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default";if(t in this.data)return this.data[t]}clear(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default";this.data[t]=-1}clearAll(){this.data={}}constructor(){this.data={}}},ex=t=>{let{label:s,className:n}=t,[r]=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default";return ep.count(t),[ep.get(t)]}(s);return(0,i.jsx)(R.Z,{label:r,color:"success"})},eg=[{key:"TN",title:"Trắc nghiệm"},{key:"TF",title:"Trắc nghiệm đ\xfang sai"},{key:"HK",title:"Nhiều lựa chọn"},{key:"DT",title:"Điền từ"},{key:"TL",title:"Tự luận"}],ef=[{key:"NB",title:"Nhận biết"},{key:"TH",title:"Th\xf4ng hiểu"},{key:"VD",title:"Vận dụng"},{key:"VDC",title:"Vận dụng cao"}],em=t=>{let{questionId:s}=t,n=(0,l.v9)(t=>t.quiz.questions.find(t=>t.id==s)),[r,d]=(0,p.useState)(n),[u,g]=(0,p.useState)(!1),b=(0,l.I0)(),E=t=>{d(s=>({...s,...t}))},T=()=>{b((0,a.cN)({questionId:s}))},I=()=>{y().fire({title:"X\xf3a ".concat(r.label," ").concat(r.number),text:"Bạn đang thực hiện lệnh x\xf3a c\xe2u hỏi. Bạn c\xf3 muốn tiếp tục kh\xf4ng?",icon:"warning",showCancelButton:!0,confirmButtonText:"Đ\xfang. X\xf3a đi.",cancelButtonText:"Hủy"}).then(t=>{t.isConfirmed&&(b((0,a.dA)(s)),y().fire({position:"top-end",icon:"success",title:"Đ\xe3 x\xf3a c\xe2u hỏi",showConfirmButton:!1,timer:1500}))})},w=t=>s=>{let n=!r.audios&&Array.isArray(r.audios)?[...r.audios]:[{}];n[t]=s,E({audios:n})};(0,p.useEffect)(()=>{JSON.stringify(r)!==JSON.stringify(n)&&d(n)},[n]);let A=[{icon:(0,i.jsx)(h.Z,{icon:"tabler:circle-x"}),text:"X\xf3a c\xe2u hỏi n\xe0y",menuItemProps:{sx:{"& svg":{mr:2},color:"error.main"},onClick:I}}],P=(0,p.useCallback)(()=>{g(!0)},[]),k=(0,p.useCallback)(()=>{g(!1)},[]);return((0,p.useEffect)(()=>{JSON.stringify(r)!==JSON.stringify(n)&&b((0,a.Ds)(r))},[r]),r)?(0,i.jsxs)("div",{onMouseEnter:P,onMouseLeave:k,id:s,children:[(0,i.jsxs)(N.Z,{sx:{mb:2},children:[(0,i.jsx)(_.Z,{title:(0,i.jsx)(Y,{questionId:s}),sx:{paddingY:2,overflowX:"auto"},action:(0,i.jsxs)(f.Z,{sx:{display:"flex",alignItems:"center"},children:[(0,i.jsx)(G,{questionId:s}),(0,i.jsx)(v.Z,{title:"Th\xeam file nghe",children:(0,i.jsx)(x.Z,{size:"small",sx:{mr:1,ml:1,background:(r.audios||"").length?"#7367f0":"",color:(r.audios||"").length?"#fff":""},onClick:()=>{(r.audios||"").length?E({audios:[]}):E({audios:[{}]})},children:(0,i.jsx)(h.Z,{icon:(r.audios||"").length?"tabler:headphones-filled":"tabler:headphones-off",fontSize:20})})}),(0,i.jsx)(v.Z,{title:"Cố định đ\xe1p \xe1n",children:(0,i.jsx)(x.Z,{size:"small",sx:{mr:1,background:r.shuffle?"#7367f0":"",color:r.shuffle?"#fff":""},onClick:()=>E({shuffle:!r.shuffle}),children:(0,i.jsx)(h.Z,{icon:r.shuffle?"tabler:pin-filled":"tabler:pinned-off",fontSize:20})})}),(0,i.jsx)(eu,{label:"Loại c\xe2u hỏi",type:"type",questionId:s,value:r.type||"TN",options:eg,onChange:t=>E({type:t})}),(0,i.jsx)(eu,{label:"Mức độ",type:"level",questionId:s,value:r.level||"",options:ef,onChange:t=>E({level:t})}),(0,i.jsx)(j,{options:A,iconButtonProps:{size:"small",sx:{color:"text.disabled"}}})]})}),(0,i.jsx)(C.Z,{}),(0,i.jsxs)(S.Z,{children:[r.audios&&r.audios.length?(0,i.jsx)(Z.Z,{severity:"warning",icon:!1,sx:{".MuiAlert-message":{width:"100%",overflow:"unset"},mt:3,".MuiListSubheader-root":{backgroundColor:"inherit"}},children:Array.isArray(r.audios)?r.audios.map((t,s)=>(0,i.jsx)(ec,{audio:t,onChange:w(s)},s)):null}):null,(0,i.jsx)(f.Z,{sx:{paddingY:3},children:(0,i.jsx)(ee,{content:r.content,onChange:t=>E({content:t})})}),(0,i.jsx)(ei,{question:r,onChange:E}),(0,i.jsxs)(Z.Z,{severity:"info",icon:!1,sx:{".MuiAlert-message":{width:"100%",overflow:"unset"}},children:[(0,i.jsx)(C.Z,{children:"HƯỚNG DẪN GIẢI"}),(0,i.jsx)(f.Z,{children:(0,i.jsx)(ee,{content:r.explain||"",onChange:t=>E({explain:t})})})]}),(0,i.jsx)(ex,{label:s})]})]}),(0,i.jsx)(f.Z,{sx:{mb:3,textAlign:"-webkit-center",height:"1.5rem"},children:u?(0,i.jsx)(C.Z,{sx:{width:"75%"},children:(0,i.jsx)(c.Z,{variant:"tonal",size:"small",startIcon:(0,i.jsx)(h.Z,{icon:"tabler:plus"}),onClick:T,children:"Th\xeam c\xe2u hỏi"})}):null})]}):(0,i.jsx)(N.Z,{sx:{mb:2,background:"#e91e1ec9"},children:(0,i.jsx)(_.Z,{title:(0,i.jsx)(L.Z,{sx:{textAlign:"center",color:"#fff"},variant:"h5",children:"C\xe2u hỏi kh\xf4ng tồn tại"})})})};var ev=p.memo(em),eb=n(5600);let eE=t=>t.reduce((t,s)=>{let n=parseFloat(s.point);return isNaN(n)?t:t+n},0);var eT=t=>{let{groupId:s}=t,n=(0,l.v9)(t=>t.quiz.questions.filter(t=>t.groupId==s));return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(eb.Z,{rounded:!0,label:"".concat(n.length," c\xe2u"),skin:"light",color:"primary",size:"small",sx:{mr:1,width:"100%"}}),(0,i.jsx)(eb.Z,{rounded:!0,label:"".concat(eE(n).toFixed(2)," điểm"),skin:"light",color:"error",size:"small",sx:{width:"100%"}})]})};let eC=t=>{var s,n;let{groupId:r,isOne:u}=t,{questions:b,random:E,content:T,...C}=(0,l.v9)(t=>t.quiz.groups.find(t=>t.id==r)),I=(0,l.I0)(),[w,A]=(0,p.useState)(!0),P=(0,p.useMemo)(()=>b.map(t=>(0,i.jsx)(ev,{questionId:t},t)),[b]),L=()=>{I((0,a.xL)({groupId:r}))},Z=()=>{I((0,a.mD)({id:r,random:!E}))},k=()=>{I((0,d.z)({status:"group",data:{...C,random:E,title:"CẤU H\xccNH NH\xd3M C\xc2U HỎI"}}))},R=t=>{I((0,a.mD)({id:r,content:t}))},M=()=>{y().fire({title:"X\xf3a nh\xf3m c\xe2u hỏi?",text:"Bạn đang thực hiện lệnh x\xf3a nh\xf3m c\xe2u hỏi n\xe0y. Bạn c\xf3 muốn tiếp tục kh\xf4ng?",icon:"warning",showCancelButton:!0,confirmButtonText:"Đ\xfang. X\xf3a đi.",cancelButtonText:"Hủy"}).then(t=>{t.isConfirmed&&(I((0,a.BN)({groupId:r})),y().fire({position:"top-end",icon:"success",title:"Đ\xe3 x\xf3a th\xe0nh c\xf4ng",showConfirmButton:!1,timer:1500}))})},O=[{icon:(0,i.jsx)(h.Z,{icon:"tabler:circle-x"}),text:"X\xf3a nh\xf3m c\xe2u hỏi n\xe0y",menuItemProps:{sx:{"& svg":{mr:2},color:"error.main"},onClick:M}}];return u?(0,i.jsxs)(S.Z,{sx:{paddingX:0,mt:3},id:r,children:[P,(null==P?void 0:P.length)?null:(0,i.jsx)(c.Z,{variant:"outlined",endIcon:(0,i.jsx)(h.Z,{icon:"tabler:help-octagon"}),fullWidth:!0,sx:{mb:2},onClick:L,children:"TH\xcaM C\xc2U HỎI"})]}):(0,i.jsxs)(f.Z,{children:[(0,i.jsxs)(N.Z,{className:"header-group",sx:{border:0,boxShadow:0,mb:2.5},id:r,children:[(0,i.jsx)(_.Z,{sx:{paddingY:1,alignItems:"center"},avatar:(0,i.jsx)(h.Z,{icon:"tabler:clipboard-list"}),action:(0,i.jsxs)(f.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,i.jsx)(v.Z,{title:"Th\xeam file nghe cho nh\xf3m c\xe2u hỏi",children:(0,i.jsx)(x.Z,{size:"small",sx:{color:"text.secondary",background:(null==C?void 0:null===(s=C.audios)||void 0===s?void 0:s.length)?"#7367f0":"",color:(null==C?void 0:null===(n=C.audios)||void 0===n?void 0:n.length)?"#fff":""},onClick:k,children:(0,i.jsx)(h.Z,{icon:"tabler:headphones-filled",fontSize:20})})}),(0,i.jsx)(v.Z,{title:"Cố định c\xe2u hỏi trong nh\xf3m",children:(0,i.jsx)(x.Z,{size:"small",sx:{mx:1,background:E?"#7367f0":"",color:E?"#fff":""},onClick:Z,children:(0,i.jsx)(h.Z,{icon:E?"tabler:pinned-filled":"tabler:pinned",fontSize:20})})}),(0,i.jsx)(eT,{groupId:r}),(0,i.jsx)(v.Z,{title:"Cấu h\xecnh nh\xf3m c\xe2u hỏi",children:(0,i.jsx)(x.Z,{size:"small",sx:{color:"text.secondary"},onClick:k,children:(0,i.jsx)(h.Z,{icon:"tabler:settings-share",fontSize:20})})}),(0,i.jsx)(j,{options:O,iconButtonProps:{size:"small",sx:{color:"text.disabled"}}}),(0,i.jsx)(v.Z,{title:"Ẩn/Hiện chi tiết",children:(0,i.jsx)(x.Z,{size:"small","aria-label":"collapse",sx:{mr:2,color:"text.secondary"},onClick:()=>A(!w),children:(0,i.jsx)(h.Z,{fontSize:20,icon:w?"tabler:chevron-up":"tabler:chevron-down"})})})]})}),(0,i.jsx)(S.Z,{sx:{p:t=>"".concat(t.spacing(4,3,4)," !important")},children:(0,i.jsx)(ee,{content:T||"",sx:{marginY:5},onChange:R})})]}),(0,i.jsx)(g.Z,{in:w,children:(0,i.jsxs)(S.Z,{sx:{paddingX:0,mt:3},children:[P,(null==P?void 0:P.length)?null:(0,i.jsx)(c.Z,{variant:"outlined",endIcon:(0,i.jsx)(h.Z,{icon:"tabler:help-octagon"}),fullWidth:!0,sx:{mb:2},onClick:L,children:"TH\xcaM C\xc2U HỎI"})]})})]})},eI=t=>t.reduce((t,s)=>{let n=parseFloat(s.point);return isNaN(n)?t:t+n},0);var ew=t=>{let{quizId:s}=t,n=(0,l.v9)(t=>t.quiz.questions.filter(t=>t.quizId==s));return(0,i.jsxs)(f.Z,{sx:{display:"flex",alignItems:"center",flexFlow:"column",mr:1},children:[(0,i.jsx)(eb.Z,{rounded:!0,label:"".concat(n.length," c\xe2u"),skin:"light",color:"primary",size:"small",sx:{mb:1,width:"100%"}}),(0,i.jsx)(eb.Z,{rounded:!0,label:"".concat(eI(n).toFixed(2)," điểm"),skin:"light",color:"success",size:"small",sx:{width:"100%"}})]})},eA=n(6591),ej=n(7533);let eP=t=>{let{quizId:s}=t;return(0,i.jsx)(ej.ZP,{open:!!s,sx:{zIndex:1301},anchor:"right",children:"hihi"})},ey=t=>{let{quizId:s}=t,[n,r]=(0,p.useState)(!0),[d,b]=(0,p.useState)(!1),[E,T]=(0,p.useState)(""),C=(0,l.v9)(t=>t.quiz.quizs.find(t=>t.id==s)),I=(0,l.v9)(t=>t.quiz.questions.filter(t=>t.quizId==s)).length,w=(0,l.I0)(),A=()=>{w((0,a.Rp)({quizId:s}))},P=(0,p.useMemo)(()=>C.groups.map(t=>(0,i.jsx)(eC,{groupId:t,isOne:1==C.groups.length},t)),[C.groups]),N=()=>{(0,eA.ImportFile)(s,t=>{let{status:s,data:n,error:i}=t;if(i)return w((0,u.V)({status:""})),y().fire({icon:"error",title:"Oops...",text:i});switch(s){case"done":w((0,a.l$)(n)),w((0,u.V)({status:""}));break;case"loading":w((0,u.V)(n))}})},L=()=>{I?y().fire({title:"Thay đổi c\xe2u hỏi Đề số ".concat(C.number),html:"Khi bạn thay đổi dữ liệu c\xe2u hỏi của đề thi số ".concat(C.number,", nếu đ\xe3 c\xf3 học sinh l\xe0m b\xe0i th\xec dữ liệu b\xe0i l\xe0m của học sinh đ\xf3 sẽ kh\xf4ng được lưu v\xe0 t\xednh l\xe0 0 điểm. Để đảm bảo kh\xf4ng ảnh hưởng để kết quả của học sinh, chỉ chỉ c\xf3 thể chỉnh sửa ngay tại c\xe2u hỏi đ\xf3. Bạn c\xf3 muốn tiếp tục kh\xf4ng?"),icon:"warning",showCancelButton:!0,confirmButtonText:"Tiếp tục",cancelButtonText:"Hủy"}).then(t=>{t.isConfirmed&&N()}):N()},Z=()=>{y().fire({title:"X\xf3a Đề số ".concat(C.number),text:"Bạn đang thực hiện lệnh x\xf3a đề thi. Bạn c\xf3 muốn tiếp tục kh\xf4ng?",icon:"warning",showCancelButton:!0,confirmButtonText:"Đ\xfang. X\xf3a đi.",cancelButtonText:"Hủy"}).then(t=>{t.isConfirmed&&(w((0,a.GE)({quizId:s})),y().fire({position:"top-end",icon:"success",title:"Đ\xe3 x\xf3a th\xe0nh c\xf4ng",showConfirmButton:!1,timer:1500}))})},k=()=>{w((0,a.QT)({quizId:s}))},R=[{icon:(0,i.jsx)(h.Z,{icon:"tabler:list-numbers"}),text:"Đ\xe1nh lại số thứ tự c\xe2u hỏi",menuItemProps:{sx:{"& svg":{mr:2}},onClick:k}},{icon:(0,i.jsx)(h.Z,{icon:"tabler:file-type-docx"}),text:"Nhập c\xe2u hỏi từ tập tin .pdf, .docx",menuItemProps:{sx:{"& svg":{mr:2}},onClick:L}},{icon:(0,i.jsx)(h.Z,{icon:"tabler:circle-x"}),text:"X\xf3a đề thi n\xe0y",menuItemProps:{sx:{"& svg":{mr:2},color:"error.main"},onClick:Z}}];return(0,i.jsxs)("div",{style:{marginBottom:10},className:d?"card-fullscreen":"",id:C.id,children:[(0,i.jsx)(_.Z,{className:"header-exam",sx:{paddingY:3,borderRadius:"0.5rem","span, svg":{color:"#fff"}},title:"Đề số "+C.number,action:(0,i.jsxs)(f.Z,{sx:{display:"flex",alignItems:"center"},children:[(0,i.jsx)(v.Z,{title:"Nhập c\xe2u hỏi từ tập tin .pdf, .docx",children:(0,i.jsx)(x.Z,{size:"small",sx:{color:"text.secondary"},onClick:L,children:(0,i.jsx)(h.Z,{icon:"tabler:upload",fontSize:20})})}),(0,i.jsx)(ew,{quizId:s}),(0,i.jsx)(v.Z,{title:d?"Thu nhỏ m\xe0n h\xecnh đề thi số "+C.number:"Mở rộng m\xe0n h\xecnh đề thi số "+C.number,children:(0,i.jsx)(x.Z,{size:"small",sx:{color:"text.secondary"},onClick:()=>b(!d),children:(0,i.jsx)(h.Z,{icon:d?"tabler:arrows-minimize":"tabler:arrows-maximize",fontSize:20})})}),(0,i.jsx)(j,{options:R,iconButtonProps:{size:"small",sx:{color:"text.disabled"}}}),(0,i.jsx)(v.Z,{title:n?"Ẩn chi tiết đề thi số "+C.number:"Hiển thị chi tiết đề thi số "+C.number,children:(0,i.jsx)(x.Z,{size:"small","aria-label":"collapse",sx:{mr:2,color:"text.secondary"},onClick:()=>r(!n),children:(0,i.jsx)(h.Z,{fontSize:20,icon:n?"tabler:chevron-up":"tabler:chevron-down"})})})]})}),(0,i.jsx)(g.Z,{in:n,children:(0,i.jsxs)(S.Z,{sx:{paddingX:0,mt:3},children:[P,(0,i.jsx)(c.Z,{variant:"tonal",endIcon:(0,i.jsx)(h.Z,{icon:"tabler:square-rounded-plus"}),fullWidth:!0,sx:{mb:2},color:"success",onClick:A,children:"TH\xcaM NH\xd3M C\xc2U HỎI"})]})}),(0,i.jsx)(eP,{quizId:E})]})},eN=()=>{let t=(0,l.v9)(t=>t.quiz.quizs),s=(0,l.I0)(),n=()=>{s((0,a.BT)())};return(0,i.jsxs)(i.Fragment,{children:[t.map(t=>(0,i.jsx)(ey,{quizId:t.id},t.id)),(0,i.jsx)(c.Z,{variant:"contained",endIcon:(0,i.jsx)(h.Z,{icon:"tabler:clipboard-plus"}),fullWidth:!0,sx:{mt:3},onClick:n,children:"TH\xcaM ĐỀ THI"})]})};var e_=n(1163),eS=n(4054),eL=n(3841),eZ=n(7709),ek=n(7274);let eR=async t=>{try{let s=new FormData;s.append("image",t);let{data:n}=await ek.default.post("/uploads",s,{headers:{"Content-Type":"multipart/form-data"}}),{error:i,url:r}=n;if(i)return await eM(s);return n}catch(t){return console.log("uploadImage",t),{error:"Lỗi uploadImage"}}},eM=async t=>{try{let n=["3dc71c29dd62dd5","d7a0e7522c8cb79","0f8d50b5b4afbcc"];var s=new Headers;s.append("Authorization","Client-ID "+n[Math.floor(Math.random()*n.length)]);let i=await fetch("https://api.imgur.com/3/upload",{method:"POST",headers:s,body:t,redirect:"follow"}),r=await i.json();return{url:r.data.link}}catch(t){return console.log("uploadImgur",t),{error:"Tải h\xecnh ảnh thất bại"}}};var eO=n(6316),eH=n(6501);let eD=()=>{var t,s;let n=(0,l.v9)(t=>t.quiz.settings),[r,c]=(0,p.useState)(!1),u=(0,l.I0)(),g=(0,e_.useRouter)(),v=(0,eO.Z)(),b=()=>{if(r)return;let t=document.createElement("input");t.setAttribute("type","file"),t.setAttribute("accept","image/*"),t.click(),t.onchange=async()=>{let[s]=t.files;if(s){c(!0);let t=n.cover||"https://i.imgur.com/dKZNJGk.png",i=URL.createObjectURL(s);E({cover:i});let{error:r,url:l}=await eR(s);c(!1),r&&(E({cover:t}),y().fire({icon:"error",title:"C\xf3 lỗi khi thay đổi ảnh b\xeca"})),l&&E({cover:l})}}},E=t=>{u((0,a.kQ)(t))},T=t=>()=>{t&&g.push({pathname:t,query:g.query})},C=()=>{u((0,d.z)({status:"settings",data:{}}))},I=t=>{v.copy(t),eH.ZP.success("Đ\xe3 sao ch\xe9p",{duration:2e3})};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(N.Z,{sx:{background:"#b1b1b11f",mb:3},children:(0,i.jsx)(S.Z,{sx:{padding:".5rem!important"},children:(0,i.jsxs)(M.Z,{component:"div",sx:{p:0},children:[(0,i.jsx)(O.ZP,{disablePadding:!0,children:(0,i.jsxs)(H.Z,{sx:{display:"flex",flexDirection:"column"},onClick:b,children:[r?(0,i.jsxs)(f.Z,{style:{position:"relative"},children:[(0,i.jsx)("img",{src:null!==(t=null==n?void 0:n.cover)&&void 0!==t?t:"https://i.imgur.com/dKZNJGk.png",style:{maxWidth:"100%",filter:"blur(5px)"}}),(0,i.jsx)(Q.Z,{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}})]}):(0,i.jsx)("img",{src:null!==(s=null==n?void 0:n.cover)&&void 0!==s?s:"https://i.imgur.com/dKZNJGk.png",style:{maxWidth:"100%"}}),(0,i.jsx)(q.Z,{primary:"Click để thay đổi ảnh b\xeca"})]})}),(0,i.jsx)(O.ZP,{disablePadding:!0,children:(0,i.jsx)(B.Z,{fullWidth:!0,label:"T\xean đề thi",value:n.title,onChange:t=>E({title:t})})}),(0,i.jsx)(O.ZP,{disablePadding:!0,children:(0,i.jsxs)(f.Z,{sx:{width:"100%"},children:[(0,i.jsx)(L.Z,{variant:"h6",sx:{marginY:2},children:"Giới thiệu về đề thi"}),(0,i.jsx)(ee,{content:n.subtitle,sx:{minHeight:"5rem"},theme:"snow",inline:!0,onChange:t=>E({subtitle:t})})]})})]})})}),(null==n?void 0:n.url)?(0,i.jsx)(N.Z,{sx:{mb:3},children:(0,i.jsx)(S.Z,{sx:{p:"0.75rem!important"},children:(0,i.jsxs)(eS.Z,{fullWidth:!0,variant:"outlined",children:[(0,i.jsx)(eL.Z,{children:"Link đề thi"}),(0,i.jsx)(eZ.Z,{value:(null==n?void 0:n.url)||"",disabled:!0,endAdornment:(0,i.jsx)(k.Z,{position:"end",children:(0,i.jsx)(x.Z,{edge:"end",onClick:()=>I(null==n?void 0:n.url),sx:{color:"success.main"},children:(0,i.jsx)(h.Z,{icon:"tabler:copy",fontSize:20})})}),label:"Link đề thi"})]})})}):null,(0,i.jsx)(N.Z,{className:"menu-settings",children:(0,i.jsx)(S.Z,{sx:{padding:".5rem!important"},children:(0,i.jsxs)(M.Z,{component:"div",sx:{p:0,color:"#fff"},children:[(0,i.jsx)(O.ZP,{disablePadding:!0,onClick:C,children:(0,i.jsxs)(H.Z,{children:[(0,i.jsx)(W.Z,{sx:{color:"#fff"},children:(0,i.jsx)(h.Z,{icon:"tabler:settings",fontSize:20})}),(0,i.jsx)(q.Z,{primary:"C\xe0i đặt b\xe0i l\xe0m online",disableTypography:!0})]})}),(null==n?void 0:n.url)?(0,i.jsx)(O.ZP,{disablePadding:!0,onClick:T("/p/leaderboard.html"),children:(0,i.jsxs)(H.Z,{children:[(0,i.jsx)(W.Z,{sx:{color:"#fff"},children:(0,i.jsx)(h.Z,{icon:"tabler:checkup-list",fontSize:20})}),(0,i.jsx)(q.Z,{primary:"Bảng điểm",disableTypography:!0})]})}):null,(null==n?void 0:n.url)?(0,i.jsx)(O.ZP,{disablePadding:!0,onClick:T("/p/realtime.html"),children:(0,i.jsxs)(H.Z,{children:[(0,i.jsx)(W.Z,{sx:{color:"#fff"},children:(0,i.jsx)(h.Z,{icon:"tabler:camera-bolt",fontSize:20})}),(0,i.jsx)(q.Z,{primary:"Gi\xe1m s\xe1t thời gian thực",disableTypography:!0})]})}):null]})})})]})};var eq=n(8262),eB=n(6628),eF=n(948),eG=n(9581),ez=n(1425),eY=function(t){let{videoId:s}=t;return(0,i.jsx)("div",{style:{position:"relative",paddingBottom:"56.25%",height:0,overflow:"hidden"},children:(0,i.jsx)("iframe",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%"},src:"https://www.youtube.com/embed/".concat((t=>{let s=t.match(/^(?:https?:\/\/)?(?:www\.)?youtu\.?be(?:\.com)?\/(?:watch\?v=|embed\/|v\/|youtu\.be\/|youtube\.com\/(?:c\/|v\/|u\/\w+\/|embed\/|watch\?v=|shorts\/))([\w-]{11})(?:[?&].*|$)/);return s?s[1]:null})(s)),title:"YouTube video player",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",frameBorder:"0",allowFullScreen:!0})})},e$=t=>{let{audio:s,onChange:n}=t,[r,l]=(0,p.useState)(""),{type:a,src:d}=s||{},u=t=>{let i=t.target.files[0];if(i){if("audio/mp3"===i.type||"audio/wav"===i.type||"audio/mpeg"===i.type||"audio/ogg"===i.type){let t=URL.createObjectURL(i);n({...s,src:t,type:"audio"})}else y().fire({icon:"error",title:"Oops...",text:"Chọn một file \xe2m thanh MP3 hoặc WAV."})}},g=t=>{let s=t.match(/^(?:https?:\/\/)?(?:www\.)?youtu\.?be(?:\.com)?\/(?:watch\?v=|embed\/|v\/|youtu\.be\/|youtube\.com\/(?:c\/|v\/|u\/\w+\/|embed\/|watch\?v=|shorts\/))([\w-]{11})(?:[?&].*|$)/);return s?s[1]:null},b=()=>{let t=g(r);t?(E({...s,src:r,type:"youtube"}),l("")):console.log("URL kh\xf4ng hợp lệ hoặc kh\xf4ng phải l\xe0 URL của video YouTube.")},E=t=>{n({...s,...t})};return(0,i.jsxs)(f.Z,{sx:{mb:2},children:[(0,i.jsxs)(f.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,i.jsxs)(c.Z,{variant:"tonal",fullWidth:!0,component:"label",sx:{mr:2},endIcon:(0,i.jsx)(h.Z,{icon:"tabler:headphones-filled"}),children:["Đ\xednh k\xe8m file \xe2m thanh",(0,i.jsx)("input",{type:"file",accept:".mp3, .wav,.mpeg, .ogg",hidden:!0,onChange:u})]}),(0,i.jsx)(c.Z,{variant:"tonal",fullWidth:!0,color:"success",endIcon:(0,i.jsx)(h.Z,{icon:"tabler:brand-youtube-filled"}),onClick:()=>{n({...s,type:"youtube",src:""})},children:"Đ\xednh k\xe8m video youtube"})]}),"youtube"!=a||d?null:(0,i.jsxs)(f.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",marginY:3},children:[(0,i.jsx)(eo.Z,{size:"small",fullWidth:!0,variant:"outlined",label:"Link youtube",placeholder:"https://www.youtube.com/watch?v=TAODETHI",sx:{mr:2},color:"success",value:r,onChange:t=>l(t.target.value)}),(0,i.jsx)(c.Z,{variant:"outlined",color:"success",endIcon:(0,i.jsx)(h.Z,{icon:"tabler:square-rounded-plus-filled"}),onClick:b,children:"Th\xeam"})]}),"youtube"==a&&d?(0,i.jsx)(f.Z,{sx:{marginY:3},children:(0,i.jsx)(eY,{videoId:d})}):null,"audio"==a&&d?(0,i.jsx)(f.Z,{sx:{marginY:3},children:(0,i.jsx)("audio",{controls:!0,controlsList:"nodownload",preload:"metadata",src:d,style:{width:"100%"}})}):null,d?(0,i.jsxs)(M.Z,{subheader:(0,i.jsx)(er.Z,{children:"C\xe0i đặt Tệp đ\xednh k\xe8m"}),children:[(0,i.jsxs)(H.Z,{divider:!0,onClick:()=>E({download:!s.download}),children:[(0,i.jsx)($.Z,{children:(0,i.jsx)(h.Z,{icon:"tabler:download",fontSize:20})}),(0,i.jsxs)(q.Z,{children:["Cho ph\xe9p tải file xuống",(0,i.jsx)(v.Z,{title:"Người nghe c\xf3 thể tải tập tin n\xe0y xuống m\xe1y t\xednh, điện thoại",children:(0,i.jsx)(x.Z,{size:"small",children:(0,i.jsx)(h.Z,{icon:"tabler:info-square-rounded",fontSize:20})})})]}),(0,i.jsx)(el.Z,{children:(0,i.jsx)(ea.Z,{edge:"end",checked:s.download||!1})})]}),(0,i.jsxs)(H.Z,{divider:!0,onClick:()=>E({next:!s.next}),children:[(0,i.jsx)($.Z,{children:(0,i.jsx)(h.Z,{icon:"tabler:player-track-next",fontSize:20})}),(0,i.jsxs)(q.Z,{children:["Cho ph\xe9p tua file nghe, video",(0,i.jsx)(v.Z,{title:"Người nghe c\xf3 thể tua để nghe trước tập tin \xe2m thanh hoặc video",children:(0,i.jsx)(x.Z,{size:"small",children:(0,i.jsx)(h.Z,{icon:"tabler:info-square-rounded",fontSize:20})})})]}),(0,i.jsx)(el.Z,{children:(0,i.jsx)(ea.Z,{edge:"end",checked:s.next||!1})})]}),(0,i.jsxs)(H.Z,{divider:!0,onClick:()=>E({speed:!s.speed}),children:[(0,i.jsx)($.Z,{children:(0,i.jsx)(h.Z,{icon:"tabler:brand-speedtest",fontSize:20})}),(0,i.jsxs)(q.Z,{children:["Cho ph\xe9p tăng, giảm tốc độ nghe",(0,i.jsx)(v.Z,{title:"Người nghe c\xf3 thể tăng tốc độ l\xean 2x hoặc x\xf3a 0.5x khi nghhe",children:(0,i.jsx)(x.Z,{size:"small",children:(0,i.jsx)(h.Z,{icon:"tabler:info-square-rounded",fontSize:20})})})]}),(0,i.jsx)(el.Z,{children:(0,i.jsx)(ea.Z,{edge:"end",checked:s.speed||!1})})]})]}):null]})};let eU=(0,eF.ZP)(x.Z)(t=>{let{theme:s}=t;return{top:0,right:0,color:"grey.500",position:"absolute",boxShadow:s.shadows[2],transform:"translate(10px, -10px)",borderRadius:s.shape.borderRadius,backgroundColor:"".concat(s.palette.background.paper," !important"),transition:"transform 0.25s ease-in-out, box-shadow 0.25s ease-in-out","&:hover":{transform:"translate(7px, -5px)"}}}),eW=[{key:"random",title:"Cố định c\xe2u hỏi trong nh\xf3m",icon:"tabler:arrows-shuffle",subtitle:"Thứ tự c\xe2u hỏi trong nh\xf3m sẽ được cố định. Kh\xf4ng thay đổi d\xf9 c\xf3 bật chế độ trộn c\xe2u hỏi."},{key:"order",title:"Đ\xe1nh lại thứ tự c\xe2u",icon:"tabler:list-numbers",subtitle:"Thứ tự c\xe2u hỏi sẽ đ\xe1nh lại từ c\xe2u 1"}];var eQ=()=>{let t=(0,l.v9)(t=>t.popup.data),s=(0,l.I0)(),[n,r]=(0,p.useState)(t),u=()=>{s((0,d.z)({status:""}))},g=t=>()=>{r({...n,...t})},b=()=>{let{title:t,...i}=n;s((0,a.mD)(i)),u()},E=t=>s=>{let i=!n.audios&&Array.isArray(n.audios)?[...n.audios]:[{}];i[t]=s,g({audios:i})()};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(eG.Z,{sx:{pb:t=>"".concat(t.spacing(8)," !important"),px:t=>["".concat(t.spacing(5)," !important"),"".concat(t.spacing(15)," !important")],pt:t=>["".concat(t.spacing(8)," !important"),"".concat(t.spacing(12.5)," !important")]},children:[(0,i.jsx)(eU,{onClick:u,children:(0,i.jsx)(h.Z,{icon:"tabler:x",fontSize:"1.25rem"})}),(0,i.jsx)(f.Z,{sx:{mb:5,textAlign:"center"},children:(0,i.jsx)(L.Z,{variant:"h5",sx:{mb:3},children:n.title})}),n.audios&&0!=n.audios.length?null:(0,i.jsx)(e$,{audio:{},onChange:E(0)}),Array.isArray(n.audios)?n.audios.map((t,s)=>(0,i.jsx)(e$,{audio:t,onChange:E(s)},s)):null,(0,i.jsx)(M.Z,{subheader:(0,i.jsx)(er.Z,{children:"C\xe0i đặt kh\xe1c"}),children:eW.map(t=>(0,i.jsxs)(H.Z,{onClick:g({[t.key]:!n[t.key]}),divider:!0,children:[(0,i.jsx)($.Z,{children:(0,i.jsx)(h.Z,{icon:t.icon,fontSize:20})}),(0,i.jsxs)(q.Z,{children:[t.title,(0,i.jsx)(v.Z,{title:t.subtitle,children:(0,i.jsx)(x.Z,{size:"small",children:(0,i.jsx)(h.Z,{icon:"tabler:info-square-rounded",fontSize:20})})})]}),(0,i.jsx)(el.Z,{children:(0,i.jsx)(ea.Z,{edge:"end",checked:n[t.key]||!1})})]},t.key))})]}),(0,i.jsxs)(ez.Z,{sx:{justifyContent:"center",px:t=>["".concat(t.spacing(5)," !important"),"".concat(t.spacing(15)," !important")],pb:t=>["".concat(t.spacing(8)," !important"),"".concat(t.spacing(12.5)," !important")]},children:[(0,i.jsx)(c.Z,{variant:"tonal",color:"secondary",onClick:u,children:"Hủy"}),(0,i.jsx)(c.Z,{variant:"contained",sx:{mr:1},onClick:b,children:"Lưu"})]})]})};let eV=(0,eF.ZP)(x.Z)(t=>{let{theme:s}=t;return{top:0,right:0,color:"grey.500",position:"absolute",boxShadow:s.shadows[2],transform:"translate(10px, -10px)",borderRadius:s.shape.borderRadius,backgroundColor:"".concat(s.palette.background.paper," !important"),transition:"transform 0.25s ease-in-out, box-shadow 0.25s ease-in-out","&:hover":{transform:"translate(7px, -5px)"}}}),eK=[{key:"upper",title:"Bỏ qua chữ hoa",icon:"tabler:letter-case-lower",subtitle:'"Đ\xe1p \xe1n" th\xe0nh "đ\xe1p \xe1n"'},{key:"sign",title:"Bỏ qua dấu c\xe2u",icon:"tabler:bolt",subtitle:'"Đ\xe1p \xe1n" th\xe0nh "dap an"'},{key:"space",title:"Bỏ qua dấu c\xe1ch",icon:"tabler:separator-vertical",subtitle:'"Đ\xe1p \xe1n" th\xe0nh "Đ\xe1p\xe1n"'}];var eX=()=>{let t=(0,l.v9)(t=>t.popup.data),s=(0,l.I0)(),[n,r]=(0,p.useState)(t),u=()=>{s((0,d.z)({status:""}))},g=t=>()=>{r({...n,...t})},b=()=>{let{questionId:t,title:i,...r}=n;s((0,a.Ds)({id:t,settings:r})),u()},E=()=>{let{questionId:t,title:i,...r}=n;s((0,a.Zw)({questionId:t,type:"settings",value:r,list:"exam"})),u()};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(eG.Z,{sx:{pb:t=>"".concat(t.spacing(8)," !important"),px:t=>["".concat(t.spacing(5)," !important"),"".concat(t.spacing(15)," !important")],pt:t=>["".concat(t.spacing(8)," !important"),"".concat(t.spacing(12.5)," !important")]},children:[(0,i.jsx)(eV,{onClick:u,children:(0,i.jsx)(h.Z,{icon:"tabler:x",fontSize:"1.25rem"})}),(0,i.jsx)(f.Z,{sx:{mb:5,textAlign:"center"},children:(0,i.jsx)(L.Z,{variant:"h5",sx:{mb:3},children:n.title})}),(0,i.jsx)(M.Z,{subheader:(0,i.jsx)(er.Z,{children:"C\xe0i đặt"}),children:eK.map(t=>(0,i.jsxs)(H.Z,{onClick:g({[t.key]:!n[t.key]}),divider:!0,children:[(0,i.jsx)($.Z,{children:(0,i.jsx)(h.Z,{icon:t.icon,fontSize:20})}),(0,i.jsxs)(q.Z,{children:[t.title,(0,i.jsx)(v.Z,{title:t.subtitle,children:(0,i.jsx)(x.Z,{size:"small",children:(0,i.jsx)(h.Z,{icon:"tabler:info-square-rounded",fontSize:20})})})]}),(0,i.jsx)(el.Z,{children:(0,i.jsx)(ea.Z,{edge:"end",checked:n[t.key]||!1})})]},t.key))})]}),(0,i.jsxs)(ez.Z,{sx:{justifyContent:"center",px:t=>["".concat(t.spacing(5)," !important"),"".concat(t.spacing(15)," !important")],pb:t=>["".concat(t.spacing(8)," !important"),"".concat(t.spacing(12.5)," !important")]},children:[(0,i.jsx)(c.Z,{variant:"tonal",color:"secondary",onClick:u,children:"Hủy"}),(0,i.jsx)(c.Z,{variant:"contained",sx:{mr:1},onClick:b,children:"Lưu"}),(0,i.jsx)(c.Z,{variant:"contained",sx:{mr:1},onClick:E,color:"success",children:"\xc1p dụng cho c\xe1c c\xe2u c\xf2n lại"})]})]})},eJ=()=>"hi",e0=n(9033);let e1=t=>{let{data:s,icon:n,name:l,selected:a,gridProps:c,iconProps:d,handleChange:u,color:p="primary"}=t,{title:x,value:g,content:v}=s;return s?(0,i.jsx)(r.ZP,{item:!0,...c,children:(0,i.jsxs)(f.Z,{onClick:()=>u(g),sx:{p:4,height:"100%",display:"flex",borderRadius:1,cursor:"pointer",position:"relative",alignItems:"center",flexDirection:"column",border:t=>"1px solid ".concat(t.palette.divider),...a===g?{borderColor:"".concat(p,".main"),"& svg":{color:t=>"".concat(t.palette.primary.main," !important")}}:{"&:hover":{borderColor:t=>"rgba(".concat(t.palette.customColors.main,", 0.25)")}}},children:[n?(0,i.jsx)(h.Z,{icon:n,...d}):null,x?"string"==typeof x?(0,i.jsx)(L.Z,{variant:"h6",sx:{...v?{mb:2}:{my:"auto"}},children:x}):x:null,v?"string"==typeof v?(0,i.jsx)(L.Z,{variant:"body2",sx:{my:"auto",textAlign:"center"},children:v}):v:null,(0,i.jsx)(e0.Z,{name:l,size:"small",color:p,value:g,onChange:u,checked:a===g,sx:{mb:-2,...!n&&!x&&!v&&{mt:-2}}})]})}):null};var e2=n(3416),e4=n(4531);let e5=(0,e2.kP)("ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz-",8),e3={fullname:"",classes:"",school:"",username:"",password:""},e9=t=>{let{students:s=[],onChange:n}=t,[r,l]=(0,p.useState)(!1),[a,d]=(0,p.useState)(e3),[u,g]=(0,p.useState)(s),v=()=>{let{fullname:t,username:s,password:n,id:i}=a;if(!t.trim())return y().fire({icon:"error",title:"Oops...",text:"Vui l\xf2ng nhập th\xf4ng tin Họ v\xe0 t\xean"});if(!s.trim())return y().fire({icon:"error",title:"Oops...",text:"Vui l\xf2ng nhập th\xf4ng tin T\xean đăng nhập"});if(!n.trim())return y().fire({icon:"error",title:"Oops...",text:"Vui l\xf2ng nhập th\xf4ng tin Mật khẩu"});if(u.find(t=>t.id!==i&&t.username.trim()===s.trim()&&t.password.trim()===n.trim()))return y().fire({icon:"error",title:"Oops...",text:"Th\xf4ng tin đăng nhập đ\xe3 tồn tại. Vui l\xf2ng kiểm tra lại!"});if(i){if(0===u.length)return;g(t=>t.map(t=>t.id===i?{...t,...a}:t))}else g(t=>[{...a,id:e5()},...t]);l(!1)},b=t=>()=>{0!==u.length&&g(s=>{let n=s.findIndex(s=>s.id===t.id);return[...u.slice(0,n),...u.slice(n+1)]})};return(0,p.useEffect)(()=>{n&&n(u)},[u]),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(Z.Z,{severity:"info",color:"info",sx:{mt:3},icon:!1,children:"Gi\xe1o vi\xean sẽ tạo t\xean đăng nhập v\xe0 mật khẩu để học sinh điền th\xf4ng tin v\xe0o mới l\xe0m b\xe0i thi. Học sinh kh\xf4ng cần phải c\xf3 t\xe0i khoản tr\xean hệ thống."}),(0,i.jsxs)(f.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mt:3},children:[(0,i.jsx)("div",{}),(0,i.jsx)(c.Z,{variant:"contained",startIcon:(0,i.jsx)(h.Z,{icon:"tabler:plus"}),onClick:()=>{l(!0),d(e3)},children:"Th\xeam học sinh"})]}),(0,i.jsx)(e4._,{rows:u.map((t,s)=>({...t,num:s+1})),columns:[{field:"num",headerName:"STT",maxWidth:50},{field:"fullname",headerName:"Họ v\xe0 t\xean",flex:.8,minWidth:200},{field:"classes",headerName:"Lớp",minWidth:80},{field:"school",headerName:"Trường",minWidth:130},{field:"username",headerName:"T\xean đăng nhập",minWidth:150},{field:"password",headerName:"Mật khẩu",minWidth:120},{field:"id",headerName:"H\xe0nh động",renderCell:t=>(0,i.jsxs)("div",{children:[(0,i.jsx)(x.Z,{size:"small",onClick:()=>{l(!0),d(t.row)},children:(0,i.jsx)(h.Z,{icon:"tabler:pencil-minus"})}),(0,i.jsx)(x.Z,{size:"small",color:"error",onClick:b(t.row),children:(0,i.jsx)(h.Z,{icon:"tabler:trash"})})]})}],autoHeight:!0,initialState:{pagination:{paginationModel:{pageSize:5}}},pageSizeOptions:[5,10,30,50]}),(0,i.jsx)(ej.ZP,{open:r,sx:{zIndex:1301},anchor:"right",children:(0,i.jsxs)(f.Z,{sx:{p:2,minWidth:350},children:[(0,i.jsx)(Z.Z,{severity:"success",children:"Th\xf4ng tin học sinh"}),(0,i.jsx)(B.Z,{fullWidth:!0,sx:{mt:3},label:"Họ v\xe0 t\xean",helperText:"Th\xf4ng tin bắt buộc",required:!0,value:a.fullname||"",onChange:t=>d({...a,fullname:t.trim()})}),(0,i.jsx)(B.Z,{fullWidth:!0,sx:{mt:3},label:"Lớp",value:a.classes||"",onChange:t=>d({...a,classes:t.trim()})}),(0,i.jsx)(B.Z,{fullWidth:!0,sx:{mt:3},label:"Trường",value:a.school||"",onChange:t=>d({...a,school:t.trim()})}),(0,i.jsx)(B.Z,{fullWidth:!0,sx:{mt:3},label:"T\xean đăng nhập",helperText:"Th\xf4ng tin bắt buộc",required:!0,value:a.username||"",onChange:t=>d({...a,username:t.trim()})}),(0,i.jsx)(B.Z,{fullWidth:!0,sx:{mt:3},label:"Mật khẩu",helperText:"Th\xf4ng tin bắt buộc",required:!0,value:a.password||"",onChange:t=>d({...a,password:t.trim()})}),(0,i.jsxs)(f.Z,{sx:{mt:3,textAlign:"center"},children:[(0,i.jsx)(c.Z,{sx:{mr:2},variant:"tonal",color:"error",onClick:()=>l(!1),children:"Hủy"}),(0,i.jsx)(c.Z,{variant:"contained",onClick:v,children:"Lưu"})]})]})})]})},e6=()=>(0,i.jsx)(Z.Z,{sx:{mt:3},icon:!1,children:"Ai cũng c\xf3 thể xem v\xe0 l\xe0m đề thi n\xe0y. Phần thu thập th\xf4ng tin y\xeau cầu tối thiểu phải c\xf3 1 trường th\xf4ng tin."});var e8=n(9770);let e7=async t=>{try{return(await ek.default.get(t)).data}catch(t){throw t}},te=t=>{let{students:s=[],onChange:n}=t,{data:r,error:l,isLoading:a}=(0,e8.Z)("/classes/class",e7),[h,c]=(0,p.useState)(s);return((0,p.useEffect)(()=>{n&&n(h)},[h]),l)?(0,i.jsx)(Z.Z,{sx:{mt:3},severity:"error",icon:!1,children:l.response.data.error}):a?(0,i.jsx)(f.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"center",marginY:10},children:(0,i.jsx)(Q.Z,{})}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(Z.Z,{sx:{mt:3},severity:"warning",icon:!1,children:"Chỉ những t\xe0i khoản của học sinh trong lớp học mới được quyền l\xe0m đề thi n\xe0y"}),(0,i.jsx)(e4._,{rows:r.map((t,s)=>({...t,num:s+1})),columns:[{field:"num",headerName:"STT",maxWidth:80},{field:"title",headerName:"Lớp học",width:250},{field:"total",headerName:"Số học sinh",width:150}],autoHeight:!0,checkboxSelection:!0,initialState:{pagination:{paginationModel:{pageSize:10}}},pageSizeOptions:[10,30,50],onRowSelectionModelChange:t=>{c(t)},rowSelectionModel:h})]})};(0,e2.kP)("ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz-",8);let tt=t=>{let{students:s=[],onChange:n}=t,[r,l]=(0,p.useState)([{id:"fasf",title:"12A1",total:12,select:4},{id:"\xe2cv",title:"12A2",total:12,select:4},{id:"ewg",title:"12A4",total:12,select:4},{id:"SEWEG",title:"12A3",total:12,select:4},{id:"REBB",title:"12A1",total:12,select:4},{id:"dbb",title:"12A5",total:12,select:4}]),[a,d]=(0,p.useState)(!1),[u,g]=(0,p.useState)(""),[b,E]=(0,p.useState)(s);return(0,p.useEffect)(()=>{n&&n(b)},[b]),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(Z.Z,{sx:{mt:3},severity:"error",icon:!1,children:"Chỉ những t\xe0i khoản của học sinh được chọn mới được quyền l\xe0m đề thi n\xe0y"}),(0,i.jsx)(e4._,{rows:r.filter(t=>t.title.toLowerCase().includes(u.toLowerCase())).map((t,s)=>({...t,num:s+1})),columns:[{field:"num",headerName:"STT",maxWidth:80},{field:"title",headerName:"Lớp học",width:250},{field:"total",headerName:"Số học sinh",width:150},{field:"select",headerName:"Đ\xe3 chọn",width:100},{field:"id",headerName:"",renderCell:t=>(0,i.jsx)(v.Z,{title:"Chọn học sinh",arrow:!0,children:(0,i.jsx)(x.Z,{size:"small",onClick:()=>{d(!0)},children:(0,i.jsx)(h.Z,{icon:"tabler:user-plus"})})})}],autoHeight:!0,initialState:{pagination:{paginationModel:{pageSize:10}}},pageSizeOptions:[10,30,50]}),(0,i.jsx)(ej.ZP,{open:a,sx:{zIndex:1301},anchor:"right",children:(0,i.jsxs)(f.Z,{children:[(0,i.jsx)(L.Z,{variant:"h4",sx:{m:2},children:"Lớp 125"}),(0,i.jsx)(e4._,{rows:r.filter(t=>t.title.toLowerCase().includes(u.toLowerCase())).map((t,s)=>({...t,num:s+1})),columns:[{field:"num",headerName:"STT",maxWidth:80},{field:"title",headerName:"Họ v\xe0 t\xean",width:300}],autoHeight:!0,initialState:{pagination:{paginationModel:{pageSize:10}}},pageSizeOptions:[10,30,50],checkboxSelection:!0,onRowSelectionModelChange:t=>{E(t)},rowSelectionModel:b}),(0,i.jsxs)(f.Z,{sx:{mt:3,textAlign:"center"},children:[(0,i.jsx)(c.Z,{sx:{mr:2},variant:"tonal",color:"error",onClick:()=>d(!1),children:"Hủy"}),(0,i.jsx)(c.Z,{variant:"contained",children:"Lưu"})]})]})})]})},ts=[{value:"all",title:"Tất cả mọi người",isSelected:!0,icon:"tabler:world"},{value:"list",title:"Giao theo danh s\xe1ch",icon:"tabler:list-check"}],ti=t=>{let{accept:s,onChange:n,students:l=[]}=t,a=t=>{n(t)};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r.ZP,{container:!0,spacing:4,children:ts.map((t,n)=>(0,i.jsx)(e1,{data:t,selected:s||"all",icon:t.icon,handleChange:t=>a({accept:"string"==typeof t?t:t.target.value,students:[]}),gridProps:{sm:6,xs:12},iconProps:{fontSize:"1.75rem",style:{marginBottom:8}}},n))}),"all"==s?(0,i.jsx)(e6,{onChange:t=>a({students:t}),students:l}):null,"classes"==s?(0,i.jsx)(te,{onChange:t=>a({students:t}),students:l}):null,"student"==s?(0,i.jsx)(tt,{onChange:t=>a({students:t}),students:l}):null,"list"==s?(0,i.jsx)(e9,{onChange:t=>a({students:t}),students:l}):null]})};var tr=()=>{let t=(0,l.v9)(t=>t.quiz.settings),s=(0,l.I0)(),[n,u]=(0,p.useState)(t),[g,v]=(0,p.useState)(!1),b=()=>{s((0,d.z)({status:""}))},E=()=>{let{accept:t="all",collects:i=[],students:r=[]}=n;switch(t){case"all":if(!i.length)return y().fire({icon:"error",title:"Oops...",text:"Phần TH\xd4NG TIN CẦN THU THẬP phải c\xf3 tối thiểu 01 trường th\xf4ng tin"});break;case"classes":if(!r.length)return y().fire({icon:"error",title:"Oops...",text:"Vui l\xf2ng chọn tối thiểu 1 lớp học để giao b\xe0i"});break;case"student":if(!r.length)return y().fire({icon:"error",title:"Oops...",text:"Vui l\xf2ng chọn tối thiểu 1 học sinh để giao b\xe0i"});break;case"list":if(!r.length)return y().fire({icon:"error",title:"Oops...",text:"Vui l\xf2ng th\xeam tối thiểu 1 học sinh để giao b\xe0i"})}if(i.filter(t=>!t.label.trim()).length)return y().fire({icon:"error",title:"Oops...",text:"Phần TH\xd4NG TIN THU THẬP chưa nhập đầy đủ c\xe1c trường th\xf4ng tin"});s((0,a.kQ)(n)),b()},T=t=>{u(s=>({...s,...t}))},w=()=>{if(g)return;let t=document.createElement("input");t.setAttribute("type","file"),t.setAttribute("accept","image/*"),t.click(),t.onchange=async()=>{let[s]=t.files;if(s){v(!0);let t=n.cover||"https://i.imgur.com/dKZNJGk.png",i=URL.createObjectURL(s);T({cover:i});let{error:r,url:l}=await eR(s);v(!1),r&&(T({cover:t}),y().fire({icon:"error",title:"C\xf3 lỗi khi thay đổi ảnh b\xeca"})),l&&T({cover:l})}}};return(0,i.jsxs)(eG.Z,{sx:{paddingX:"0!important"},children:[(0,i.jsx)(C.Z,{sx:{marginY:3},children:(0,i.jsx)(eb.Z,{label:"TH\xd4NG TIN CƠ BẢN",skin:"light",color:"primary"})}),(0,i.jsxs)(r.ZP,{container:!0,spacing:3,children:[(0,i.jsxs)(r.ZP,{item:!0,xs:12,md:8,children:[(0,i.jsx)(f.Z,{children:(0,i.jsx)(B.Z,{label:"T\xean đề thi",fullWidth:!0,value:n.title||"",onChange:t=>T({title:t})})}),(0,i.jsxs)(f.Z,{sx:{mt:2},children:[(0,i.jsx)(L.Z,{variant:"h6",sx:{marginY:2},children:"Giới thiệu về đề thi"}),(0,i.jsx)(ee,{content:n.subtitle,sx:{minHeight:"5rem"},theme:"snow",inline:!0,onChange:t=>T({subtitle:t})})]})]}),(0,i.jsx)(r.ZP,{item:!0,xs:12,md:4,children:(0,i.jsxs)(f.Z,{onClick:w,sx:{display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",cursor:"pointer"},children:[g?(0,i.jsxs)(f.Z,{style:{position:"relative"},children:[(0,i.jsx)("img",{src:n.cover||"https://i.imgur.com/dKZNJGk.png",style:{maxWidth:"100%",filter:"blur(5px)"}}),(0,i.jsx)(Q.Z,{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}})]}):(0,i.jsx)("img",{src:n.cover||"https://i.imgur.com/dKZNJGk.png",style:{maxWidth:"100%"}}),(0,i.jsx)("span",{children:"Click để thay đổi ảnh b\xeca "})]})})]}),(0,i.jsx)(C.Z,{sx:{marginY:3},children:(0,i.jsx)(eb.Z,{label:"CHUNG",skin:"light",color:"primary"})}),(0,i.jsxs)(r.ZP,{container:!0,spacing:3,children:[(0,i.jsx)(r.ZP,{item:!0,xs:12,md:6,children:(0,i.jsx)(B.Z,{label:"Thời gian l\xe0m b\xe0i",fullWidth:!0,type:"number",placeholder:"90",InputProps:{endAdornment:(0,i.jsx)(k.Z,{position:"end",children:"ph\xfat"}),inputProps:{min:0,step:1}},value:n.timeout||"90",onChange:t=>T({timeout:t})})}),(0,i.jsx)(r.ZP,{item:!0,xs:12,md:6,children:(0,i.jsx)(B.Z,{label:"Số lần l\xe0m",type:"number",placeholder:"0",fullWidth:!0,helperText:"Số lần mỗi học sinh c\xf3 thể l\xe0m b\xe0i. 0 để kh\xf4ng giới hạn.",InputProps:{inputProps:{min:0,step:1}},value:n.retake||"0",onChange:t=>T({retake:t})})}),(0,i.jsx)(r.ZP,{item:!0,xs:12,md:6,children:(0,i.jsx)(B.Z,{label:"Thời gian bắt đầu",fullWidth:!0,InputLabelProps:{shrink:!0},type:"datetime-local",helperText:"Học sinh chỉ c\xf3 thể l\xe0m b\xe0i kể từ thời điểm bắt đầu",value:n.startTime||"",onChange:t=>T({startTime:t})})}),(0,i.jsx)(r.ZP,{item:!0,xs:12,md:6,children:(0,i.jsx)(B.Z,{label:"Thời gian hết hạn",fullWidth:!0,InputLabelProps:{shrink:!0},type:"datetime-local",helperText:"Qu\xe1 thời gian n\xe0y học sinh sẽ kh\xf4ng thể bắt đ\xe2u l\xe0m b\xe0i",value:n.endTime||"",onChange:t=>T({endTime:t})})})]}),(0,i.jsx)(C.Z,{sx:{marginY:3},children:(0,i.jsx)(eb.Z,{label:"BẢO MẬT",skin:"light",color:"warning"})}),(0,i.jsxs)(r.ZP,{container:!0,spacing:3,children:[(0,i.jsx)(r.ZP,{item:!0,xs:12,md:6,children:(0,i.jsx)(B.Z,{label:"Mật khẩu đề thi",fullWidth:!0,helperText:"Y\xeau cầu học sinh nhập đ\xfang mật khẩu mới c\xf3 thể bắt đầu l\xe0m b\xe0i",value:n.password||"",onChange:t=>T({password:t})})}),(0,i.jsx)(r.ZP,{item:!0,xs:12,md:6,children:(0,i.jsxs)(B.Z,{select:!0,label:"Tự động nộp b\xe0i khi chuyển tabs",fullWidth:!0,helperText:"Hệ thống sẽ tự động nộp b\xe0i l\xe0m khi học sinh chuyển tab kh\xe1c",value:n.tabs||"10",onChange:t=>T({tabs:t}),children:[(0,i.jsx)(I.Z,{value:"0",children:"Kh\xf4ng"}),(0,i.jsx)(I.Z,{value:"3",children:"Sau 3 gi\xe2y"}),(0,i.jsx)(I.Z,{value:"5",children:"Sau 5 gi\xe2y"}),(0,i.jsx)(I.Z,{value:"7",children:"Sau 7 gi\xe2y"}),(0,i.jsx)(I.Z,{value:"10",children:"Sau 10 gi\xe2y"}),(0,i.jsx)(I.Z,{value:"15",children:"Sau 15 gi\xe2y"}),(0,i.jsx)(I.Z,{value:"30",children:"Sau 30 gi\xe2y"}),(0,i.jsx)(I.Z,{value:"60",children:"Sau 60 gi\xe2y"})]})})]}),(0,i.jsx)(C.Z,{sx:{marginY:3},children:(0,i.jsx)(eb.Z,{label:"C\xc2U HỎI V\xc0 TRẢ LỜI",skin:"light",color:"info"})}),(0,i.jsxs)(r.ZP,{container:!0,spacing:3,children:[(0,i.jsx)(r.ZP,{item:!0,xs:12,md:6,children:(0,i.jsxs)(B.Z,{select:!0,label:"Chế độ hiển thị c\xe2u hỏi",fullWidth:!0,value:n.showQuestions||"A",onChange:t=>T({showQuestions:t}),children:[(0,i.jsx)(I.Z,{value:"A",children:"Hiện to\xe0n bộ c\xe2u hỏi"}),(0,i.jsx)(I.Z,{value:"Q",children:"Hiện theo từng c\xe2u hỏi"})]})}),(0,i.jsx)(r.ZP,{item:!0,xs:12,md:6,children:(0,i.jsxs)(B.Z,{select:!0,label:"Bắt buộc l\xe0m tất cả c\xe1c c\xe2u hỏi",fullWidth:!0,value:n.require||"T",onChange:t=>T({require:t}),children:[(0,i.jsx)(I.Z,{value:"T",children:"Phải l\xe0m hết mới cho nộp b\xe0i"}),(0,i.jsx)(I.Z,{value:"F",children:"Kh\xf4ng cần phải l\xe0m hết"})]})}),(0,i.jsx)(r.ZP,{item:!0,xs:12,md:6,children:(0,i.jsxs)(B.Z,{select:!0,label:"Chế độ đảo c\xe2u hỏi",fullWidth:!0,helperText:"C\xe1c nh\xf3m c\xe2u hỏi đ\xe3 cố định th\xec hệ thống sẽ kh\xf4ng đảo c\xe2u hỏi nh\xf3m đ\xf3",value:n.randomQuestion||"N",onChange:t=>T({randomQuestion:t}),children:[(0,i.jsx)(I.Z,{value:"N",children:"Kh\xf4ng đảo c\xe2u hỏi"}),(0,i.jsx)(I.Z,{value:"E",children:"Đảo to\xe0n bộ đề thi"})]})}),(0,i.jsx)(r.ZP,{item:!0,xs:12,md:6,children:(0,i.jsxs)(B.Z,{select:!0,label:"Chế độ đảo đ\xe1p \xe1n",fullWidth:!0,helperText:"C\xe1c c\xe2u hỏi đ\xe3 cố định đ\xe1p \xe1n th\xec hệ thống sẽ kh\xf4ng đảo đ\xe1p \xe1n c\xe2u hỏi đ\xf3",value:n.randomAnswer||"F",onChange:t=>T({randomAnswer:t}),children:[(0,i.jsx)(I.Z,{value:"F",children:"Kh\xf4ng đảo đ\xe1p \xe1n"}),(0,i.jsx)(I.Z,{value:"T",children:"C\xf3 đảo đ\xe1p \xe1n"})]})}),(0,i.jsx)(r.ZP,{item:!0,xs:12,md:6,children:(0,i.jsxs)(B.Z,{select:!0,label:"Chế độ hiển thị b\xe0i l\xe0m",fullWidth:!0,value:n.showResult||"F",onChange:t=>T({showResult:t}),children:[(0,i.jsx)(I.Z,{value:"N",children:"Kh\xf4ng hiển thị"}),(0,i.jsx)(I.Z,{value:"F",children:"Ngay sau khi nộp b\xe0i"})]})}),(0,i.jsx)(r.ZP,{item:!0,xs:12,md:6,children:(0,i.jsxs)(B.Z,{select:!0,label:"Chế độ hiển thị điểm",fullWidth:!0,value:n.showPoint||"F",onChange:t=>T({showPoint:t}),children:[(0,i.jsx)(I.Z,{value:"N",children:"Kh\xf4ng hiển thị"}),(0,i.jsx)(I.Z,{value:"F",children:"Ngay sau khi nộp b\xe0i"})]})}),(0,i.jsx)(r.ZP,{item:!0,xs:12,md:6,children:(0,i.jsxs)(B.Z,{select:!0,label:"Chế độ hiển thị đ\xe1p \xe1n đ\xfang",fullWidth:!0,value:n.showKey||"F",onChange:t=>T({showKey:t}),children:[(0,i.jsx)(I.Z,{value:"A",children:"Lu\xf4n hiển thị"}),(0,i.jsx)(I.Z,{value:"T",children:"Chỉ c\xe2u đ\xfang"}),(0,i.jsx)(I.Z,{value:"F",children:"Chỉ c\xe2u sai"}),(0,i.jsx)(I.Z,{value:"H",children:"Lu\xf4n ẩn"})]})}),(0,i.jsx)(r.ZP,{item:!0,xs:12,md:6,children:(0,i.jsxs)(B.Z,{select:!0,label:"Chế độ hiển thị hướng dẫn giải",fullWidth:!0,value:n.showExplain||"A",onChange:t=>T({showExplain:t}),children:[(0,i.jsx)(I.Z,{value:"A",children:"Lu\xf4n hiển thị"}),(0,i.jsx)(I.Z,{value:"T",children:"Chỉ c\xe2u đ\xfang"}),(0,i.jsx)(I.Z,{value:"F",children:"Chỉ c\xe2u sai"}),(0,i.jsx)(I.Z,{value:"H",children:"Lu\xf4n ẩn"})]})})]}),(0,i.jsx)(C.Z,{sx:{marginY:3},children:(0,i.jsx)(eb.Z,{label:"AI C\xd3 THỂ L\xc0M?",skin:"light",color:"success"})}),(0,i.jsx)(ti,{accept:n.accept,onChange:T,students:n.students}),(0,i.jsx)(C.Z,{sx:{marginY:3},children:(0,i.jsx)(eb.Z,{label:"TH\xd4NG TIN CẦN THU THẬP",skin:"light",color:"success"})}),(0,i.jsxs)(f.Z,{children:[(0,i.jsx)(M.Z,{children:(n.collects||[]).map((t,s)=>(0,i.jsxs)(O.ZP,{disablePadding:!0,sx:{paddingY:1},children:[(0,i.jsx)(B.Z,{fullWidth:!0,size:"small",sx:{mr:2},InputProps:{startAdornment:(0,i.jsxs)(k.Z,{position:"start",children:["Th\xf4ng tin ",s+1]})},value:t.label,placeholder:"Nhập th\xf4ng tin cần thu thập",onChange:t=>T({collects:n.collects.map((n,i)=>i==s?{...n,label:t}:n)})}),(0,i.jsx)(el.Z,{children:(0,i.jsx)(x.Z,{color:"error",onClick:()=>T({collects:n.collects.filter((t,n)=>n!=s)}),children:(0,i.jsx)(h.Z,{icon:"tabler:trash"})})})]},s))}),(0,i.jsx)(c.Z,{variant:"contained",startIcon:(0,i.jsx)(h.Z,{icon:"tabler:plus"}),onClick:()=>T({collects:n.collects?[...n.collects,{label:""}]:[{label:""}]}),children:"Th\xeam th\xf4ng tin"})]}),(0,i.jsxs)(f.Z,{sx:{mt:5,textAlign:"center"},children:[(0,i.jsx)(c.Z,{sx:{mr:2},variant:"tonal",color:"error",onClick:b,children:"Hủy"}),(0,i.jsx)(c.Z,{variant:"contained",onClick:E,children:"Lưu"})]})]})};let tl=(0,eF.ZP)(x.Z)(t=>{let{theme:s}=t;return{top:0,right:0,color:"grey.500",position:"absolute",boxShadow:s.shadows[2],transform:"translate(10px, -10px)",borderRadius:s.shape.borderRadius,backgroundColor:"".concat(s.palette.background.paper," !important"),transition:"transform 0.25s ease-in-out, box-shadow 0.25s ease-in-out","&:hover":{transform:"translate(7px, -5px)"}}});var ta=()=>{let t=(0,l.v9)(t=>t.popup.data),s=(0,l.I0)(),[n,r]=(0,p.useState)(t),a=()=>{s((0,d.z)({status:""}))};return(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)(eG.Z,{sx:{background:"#f8f7fa",pb:t=>"".concat(t.spacing(8)," !important"),px:t=>["".concat(t.spacing(5)," !important"),"".concat(t.spacing(15)," !important")],pt:t=>["".concat(t.spacing(8)," !important"),"".concat(t.spacing(12.5)," !important")]},children:[(0,i.jsx)(tl,{onClick:a,children:(0,i.jsx)(h.Z,{icon:"tabler:x",fontSize:"1.25rem"})}),(0,i.jsx)(tr,{})]})})};let to=(0,p.forwardRef)(function(t,s){return(0,i.jsx)(eB.Z,{ref:s,...t})}),th=K()(()=>Promise.all([n.e(117),n.e(141)]).then(n.bind(n,5141)),{loadableGenerated:{webpack:()=>[5141]},ssr:!1}),tc=t=>{let{type:s}=t;switch(s){case"quiz":return(0,i.jsx)(eJ,{});case"group":return(0,i.jsx)(eQ,{});case"options":return(0,i.jsx)(eX,{});case"math":return(0,i.jsx)(th,{});case"settings":return(0,i.jsx)(ta,{})}return null},td=()=>{let{status:t,data:s}=(0,l.v9)(t=>t.popup);return(0,i.jsx)(eq.Z,{fullWidth:!0,open:!!t,maxWidth:"md",scroll:"body",TransitionComponent:to,sx:{"& .MuiDialog-paper":{overflow:"visible"}},children:(0,i.jsx)(tc,{type:t})})};var tu=()=>(0,i.jsxs)(r.ZP,{container:!0,spacing:3,children:[(0,i.jsx)(r.ZP,{item:!0,xs:12,md:4,children:(0,i.jsx)(eD,{})}),(0,i.jsx)(r.ZP,{item:!0,xs:12,md:8,children:(0,i.jsx)(eN,{})}),(0,i.jsx)(td,{})]}),tp=n(1023),tx=n(7715),tg=n.n(tx),tf=n(5591),tm=n(1117);let tv=(0,eF.ZP)(x.Z)(t=>{let{theme:s}=t;return{top:0,right:0,color:"grey.500",position:"absolute",boxShadow:s.shadows[2],transform:"translate(10px, -10px)",borderRadius:s.shape.borderRadius,backgroundColor:"".concat(s.palette.background.paper," !important"),transition:"transform 0.25s ease-in-out, box-shadow 0.25s ease-in-out","&:hover":{transform:"translate(7px, -5px)"}}}),tb=(0,p.forwardRef)(function(t,s){return(0,i.jsx)(eB.Z,{ref:s,...t})}),tE=t=>{let{show:s,setShow:n,data:l}=t,a=(0,eO.Z)(),d=()=>{n(!1)},u=t=>()=>{a.copy(t),eH.ZP.success("Đ\xe3 sao ch\xe9p th\xe0nh c\xf4ng!",{duration:3e3})};return(0,i.jsxs)(eq.Z,{fullWidth:!0,open:s,maxWidth:"sm",scroll:"body",onClose:d,onBackdropClick:d,TransitionComponent:tb,sx:{"& .MuiDialog-paper":{overflow:"visible"}},children:[(0,i.jsxs)(eG.Z,{sx:{pb:t=>"".concat(t.spacing(8)," !important"),px:t=>["".concat(t.spacing(5)," !important"),"".concat(t.spacing(15)," !important")],pt:t=>["".concat(t.spacing(8)," !important"),"".concat(t.spacing(12.5)," !important")]},children:[(0,i.jsx)(tv,{onClick:d,children:(0,i.jsx)(h.Z,{icon:"tabler:x",fontSize:"1.25rem"})}),(0,i.jsxs)(f.Z,{sx:{mb:4,textAlign:"center"},children:[(0,i.jsx)(L.Z,{variant:"h3",sx:{mb:3},children:"Cập nhật th\xe0nh c\xf4ng \uD83C\uDF89"}),(0,i.jsx)(L.Z,{sx:{color:"text.secondary"},children:"Copy link b\xean dưới v\xe0 gửi cho học sinh. Học sinh truy cập link để l\xe0m b\xe0i v\xe0 nộp b\xe0i."})]}),(0,i.jsxs)(r.ZP,{container:!0,spacing:6,children:[(0,i.jsx)(r.ZP,{item:!0,xs:12,children:(0,i.jsx)(eo.Z,{label:"Link đề thi",fullWidth:!0,sx:{m:1},InputProps:{endAdornment:(0,i.jsx)(k.Z,{position:"end",children:(0,i.jsx)(c.Z,{variant:"contained",endIcon:(0,i.jsx)(h.Z,{icon:"tabler:copy"}),onClick:u((null==l?void 0:l.url)||""),children:"Sao ch\xe9p"})}),readOnly:!0},InputLabelProps:{shrink:!0},variant:"outlined",value:(null==l?void 0:l.url)||""})}),(0,i.jsx)(r.ZP,{item:!0,xs:12,children:(0,i.jsx)(eo.Z,{label:"M\xe3 nh\xfang Website",fullWidth:!0,sx:{m:1},InputLabelProps:{shrink:!0},InputProps:{endAdornment:(0,i.jsx)(k.Z,{position:"end",children:(0,i.jsx)(c.Z,{variant:"contained",endIcon:(0,i.jsx)(h.Z,{icon:"tabler:copy"}),color:"success",onClick:u('<iframe width="100%" height="900" src="'.concat(null==l?void 0:l.url,'"  title="').concat(null==l?void 0:l.title,'" frameborder="0" allow="accelerometer;autoplay;clipboard-write;encrypted-media; gyroscope; picture-in-picture" allowfullscreen> </iframe>')),children:"Sao ch\xe9p"})}),readOnly:!0},variant:"outlined",value:'<iframe width="100%" height="900" src="'.concat(null==l?void 0:l.url,'"  title="').concat(null==l?void 0:l.title,'" frameborder="0" allow="accelerometer;autoplay;clipboard-write;encrypted-media; gyroscope; picture-in-picture" allowfullscreen> </iframe>')})})]})]}),(0,i.jsx)(ez.Z,{sx:{justifyContent:"center",px:t=>["".concat(t.spacing(5)," !important"),"".concat(t.spacing(15)," !important")],pb:t=>["".concat(t.spacing(8)," !important"),"".concat(t.spacing(12.5)," !important")]},children:(0,i.jsx)(c.Z,{variant:"contained",sx:{mr:1},onClick:d,children:"OK"})})]})},tT=t=>tg().gzipSync(JSON.stringify(t)).toString("base64"),tC=t=>{if(t){var s=document.getElementById(t);if(s){var n=s.getBoundingClientRect().top+window.pageYOffset;window.scrollTo({top:n-100,behavior:"smooth"})}}},tI=()=>{let t=(0,l.v9)(t=>t.quiz),s=(0,l.I0)(),n=(0,e_.useRouter)(),[r,g]=(0,p.useState)(!1),[b,E]=(0,p.useState)({}),[T,C]=(0,p.useState)(!1),I=(0,p.useRef)(null),w=()=>{s((0,d.z)({status:"settings",data:{}}))};(0,p.useEffect)(()=>{T&&j()},[T]);let A=t=>{let s=n.asPath.split("?")[0],i=new URLSearchParams(t).toString(),r="".concat(s,"?").concat(i);n.replace(r,void 0,{shallow:!0})},j=()=>{s((0,u.V)({status:"Đang xử l\xfd...."}));let i=t.groups.filter(s=>t.quizs.flatMap(t=>t.groups).includes(s.id)),r=t.questions.filter(t=>i.flatMap(t=>t.questions).includes(t.id)).map(t=>"TL"==t.type?{...t,options:[]}:t);new tm.Image(r).start(async r=>{var l,h,c,d,p;let{error:x,success:f}=r;if(x||!f.length)return s((0,u.V)({status:""})),C(!1),y().fire({icon:"error",title:"Oppss...",html:"Vui l\xf2ng thử lại sau!"+x});let v=t=>{for(var s=t.split(","),n=s[0].match(/:(.*?);/),i=atob(s[1]),r=i.length,l=new Uint8Array(r);r--;)l[r]=i.charCodeAt(r);let a=n&&n.length>0?n[1]:"png";return new File([l],"hinhanh.".concat(a.split("/")[1]),{type:a})},b=async t=>{let s=[];for(let n=0;n<t.length;n+=3){let i=t.slice(n,n+3);s.push(i)}let n=[];for(let t=0;t<s.length;t++){let i=s[t],r=i.map(async t=>{let s;let n=[],i=t.content||"",r=/<img.*?src="(data:image\/[^;]+;base64,.*?)".*?>/g;for(;s=r.exec(i);){let t=s[1],i=await eR(v(t));n.push((null==i?void 0:i.url)||t)}let l=i.replace(r,(t,s)=>{let i=n.shift();return'<img src="'.concat(i,'" >')});return{...t,content:l}}),l=await Promise.all(r);n.push(...l)}return n},T=t=>{let s=document.createElement("div");s.innerHTML=t||"";let n=s.getElementsByClassName("ql-formula");for(let t=n.length-1;t>=0;t--){let s=n[t];s.innerHTML=""}let i=s.getElementsByTagName("img");for(let t=0;t<i.length;t++){let s=i[t];s.src.startsWith("data:image/")&&(s.src="")}return s.innerHTML},I=async t=>{let s;if(!t)return"";let n=/<img.*?src="(data:image\/[^;]+;base64,.*?)".*?>/g,i=[];for(;s=n.exec(t);){let t=s[1],n=await eR(v(t));i.push((null==n?void 0:n.url)||t)}let r=t.replace(n,(t,s)=>{let n=i.shift();return'<img src="'.concat(n,'" >')});return r},w=await I((null===(l=t.settings)||void 0===l?void 0:l.subtitle)||""),j=t=>new Promise(s=>{var n=new XMLHttpRequest;n.open("GET",t,!0),n.responseType="blob",n.onload=function(){if(200===n.status){var t=n.response,i=t.type;s(new File([t],"audio_file.mp3",{type:i}))}},n.send()}),P=async t=>{let s=[];for(var n=0;n<t.length;n++){var i=t[n];if(null==i?void 0:null===(r=i.audios)||void 0===r?void 0:r.length){for(var r,l,a=[],h=0;h<(null==i?void 0:null===(l=i.audios)||void 0===l?void 0:l.length);h++){var c=null==i?void 0:i.audios[h];if((null==c?void 0:c.type)=="audio"&&/^blob\:/i.test(null==c?void 0:c.src)){var{url:d}=await eR(await j(null==c?void 0:c.src));a.push({...c,src:d})}else a.push(c)}s.push({...i,audios:a})}else s.push(i)}return s},N=await P(await b(i));f=await P(f),s((0,a.Be)({groups:N})),s((0,a.QV)({questions:f})),s((0,a.kQ)({subtitle:w})),s((0,a.kQ)({subtitle:w}));let _=f.map(t=>({...t,content:T(t.content||""),explain:T(t.explain||""),options:(t.options||[]).map(t=>({...t,text:T(t.text)}))})),S={...t.settings,subtitle:w,parent:(null==n?void 0:null===(h=n.query)||void 0===h?void 0:h.parent)||"",id:(null==t?void 0:null===(c=t.settings)||void 0===c?void 0:c.id)||(null==n?void 0:null===(d=n.query)||void 0===d?void 0:d.id)||""},L={questions:[...null==t?void 0:null===(p=t.quizs)||void 0===p?void 0:p.map(t=>({quizs:tT(t),id:t.id,v:tm.Version})),...null==N?void 0:N.map(t=>({groups:tT(t),id:t.id,quizId:t.quizId,v:tm.Version})),...null==_?void 0:_.map(t=>({questions:tT(t),id:t.id,quizId:t.quizId,groupId:t.groupId,level:t.level,shuffle:t.shuffle,v:tm.Version}))],settings:[{settings:tT({...S,collects:void 0,students:void 0}),v:tm.Version},...((null==S?void 0:S.collects)||[]).map(t=>({collects:tT(t),v:tm.Version})),...((null==S?void 0:S.students)||[]).map(t=>({students:tT(t),v:tm.Version,username:(null==t?void 0:t.username)||t}))],results:{...S,students:void 0,quizType:(null==_?void 0:_.filter(t=>"TL"==t.type).length)?"Hỗn hợp":"Trắc nghiệm",numberQuestions:Math.max(...null==N?void 0:N.map(t=>t.questions.length))}};s((0,u.V)({status:"Đang lưu"}));let Z=(await ek.default.post("/quizs",L)).data;if(Z.error)return s((0,u.V)({status:""})),C(!1),y().fire({icon:"error",title:"Oops...",text:Z.error,footer:'<a href="#">Why do I have this issue?</a>'});s((0,a.kQ)({id:Z.id})),s((0,a.kQ)({url:Z.url})),(0,tf.JG)(Z.parent?"/exams/".concat(Z.parent):"/exams",Z,{revalidate:!1,populateCache:(t,s)=>n.query.id?(s||[]).map(t=>t.id==n.query.id?Z:t):[...s||[],t]}),s((0,u.V)({status:""})),g(!0),E(Z),C(!1),A({parent:Z.parent,id:Z.id})})},P=()=>{I.current.postMessage({action:"checkErrorCreate",payload:t})},N=async()=>{try{var t;let{id:i="",parent:r=""}=n.query;if(!i){s((0,a._e)({quizs:[],groups:[],questions:[],settings:{collects:[{label:"Họ v\xe0 t\xean"},{label:"Lớp"}],students:[],title:""}})),s((0,a.BT)()),s((0,u.V)({status:""}));return}let l=(await (0,ek.default)("/quizs/".concat(i,"/details?parent=").concat(r))).data;if(null==l?void 0:l.error){y().fire({icon:"error",title:"Oops...",text:l.error,footer:'<a href="#">Why do I have this issue?</a>'}),s((0,u.V)({status:""})),n.push("/p/create.html");return}if(!((null==l?void 0:l.questions.length)&&(null==l?void 0:l.settings.length)&&(null==l?void 0:null===(t=l.results)||void 0===t?void 0:t.sheetId))){s((0,u.V)({status:"Đang đồng bộ dữ liệu đề thi..."}));let{data:t}=await ek.default.post("/quizs/".concat(i,"/sync?parent=").concat(r));if(t.error)return n.push("/"),y().fire({icon:"error",title:"Oops...",text:t.error,footer:'<a href="#">Why do I have this issue?</a>'});s((0,u.V)({status:"Đang đồng bộ dữ liệu b\xe0i l\xe0m..."}));let{data:l}=await ek.default.post("/leaderboard/".concat(i,"/sync?parent=").concat(r));if(l.error)return y().fire({icon:"error",title:"Oops...",text:l.error,footer:'<a href="#">Why do I have this issue?</a>'});return N()}return I.current.postMessage({action:"fetchCreate",payload:l})}catch(t){return y().fire({icon:"error",title:"Oops...",text:"Vui l\xf2ng li\xean hệ Admin để được hỗ trợ",footer:'<a href="#">Why do I have this issue?</a>'})}};return(0,p.useEffect)(()=>(s((0,u.V)({status:"Đang tải..."})),n.isReady&&(I.current&&I.current.terminate(),I.current=new Worker("/scripts/worker.js"),I.current.onmessage=async t=>{let{action:n="",payload:i=null}=t.data;switch(n){case"fetchCreate":s((0,a._e)(i)),setTimeout(()=>{s((0,u.V)({status:""}))},500);break;case"checkErrorCreate":let{errors:r,warnings:l}=i;if(r.length)return tC(r[0].id),y().fire({icon:"error",title:"Oops...",text:r[0].text,footer:'<a href="#">Why do I have this issue?</a>'});l.length?y().fire({title:"Ch\xfa \xfd",html:'<p>Hệ thống ph\xe1t hiện một số vấn đề sau, bạn h\xe3y kiểm tra lại n\xf3 trước khi lưu đề thi.</p><ul style=" text-align: left; ">'.concat(l.map(t=>"<li>".concat(t,"</li>")).join(""),"</ul>"),icon:"warning",showCancelButton:!0,confirmButtonText:"Vẫn lưu",cancelButtonText:"Huỷ"}).then(t=>{t.isConfirmed&&C(!0)}):C(!0)}},N()),()=>{I.current&&I.current.terminate()}),[n]),(0,p.useEffect)(()=>()=>{s((0,u.V)({status:""}))},[]),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(f.Z,{sx:{width:"100%",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,i.jsx)(f.Z,{className:"actions-left",sx:{mr:2,display:"flex",alignItems:"center"},children:(0,i.jsx)(L.Z,{variant:"h5",sx:{cursor:"text",overflow:"hidden",textOverflow:"ellipsis",lineHeight:1.5,maxHeight:"3rem"},onClick:w,children:t.settings.title})}),(0,i.jsxs)(f.Z,{className:"actions-right",sx:{display:"flex",alignItems:"center"},children:[(0,i.jsx)(v.Z,{title:"Chỉnh sửa c\xe0i đặt",children:(0,i.jsx)(x.Z,{color:"inherit",sx:{mr:1},onClick:w,children:(0,i.jsx)(h.Z,{fontSize:"1.5rem",icon:"tabler:settings-filled"})})}),(0,i.jsx)(c.Z,{variant:"contained",color:"success",startIcon:(0,i.jsx)(h.Z,{icon:"tabler:device-floppy"}),onClick:P,children:(0,i.jsx)(L.Z,{variant:"body",children:"LƯU"})})]}),(0,i.jsx)(tE,{show:r,setShow:g,data:b})]}),(0,i.jsx)(f.Z,{sx:{position:"fixed",bottom:"2.5rem",right:"4.5rem",zIndex:1031},children:(0,i.jsx)(c.Z,{variant:"contained",startIcon:(0,i.jsx)(h.Z,{icon:"tabler:device-floppy"}),onClick:P,color:"error",sx:{boxShadow:"0 1px 20px 1px #EA5455!important",":hover":{boxShadow:"none!important"}},children:"LƯU ĐỀ THI"})})]})},tw=()=>(0,i.jsx)(tu,{});tw.getLayout=t=>(0,i.jsx)(tp.Z,{customAppBar:(0,i.jsx)(tI,{}),children:t}),tw.guestGuard=!1;var tA=tw},1117:function(t,s,n){"use strict";Object.defineProperty(s,"__esModule",{value:!0});let i=n(8754),r=i._(n(7274));class l{static load(t){Object.assign(this,t)}}l.RENDER_SCALE=2,l.LINE_SMALL_HEIGHT=7*l.RENDER_SCALE,l.SPLIT_MARGIN=3*l.RENDER_SCALE,l.INTERSEC_MARGIN=20*l.RENDER_SCALE,l.LINE_MARGIN=2*l.RENDER_SCALE,l.MARGIN_LEFT=2*l.RENDER_SCALE,l.ENABLE_IMAGE_PROCESS=!0,l.STEP_SIZE=2,l.CROP_FULL_WIDTH=!0,l.OVERLAP=.5,l.QUESTION_PATTERN=[],l.QUESTION_PATTERN2=[],l.BREAK_LINE_PATTERN=[],l.SECTION_PATTERN_LOWER=[],l.SECTION_PATTERN_NORMAL=[],l.KICK_PATTERN=[],l.TVCN_CHAR=[],l.HET_PATTERN=[],l.DAPAN_PATTERN=[],l.HUONGDAN_PATTERN=[],l.MULTIPLE_ANS_PATTERN=[],l.DRAW_RESULT="",l.SKIP_CHAR=[],l.FOOTER_PATTERN=[],l.HELP_ANS_PATTERN=[],l.RES_ANS_PATTERN=[];class a{}a.RENDER_SCALE=2,a.LINE_SMALL_HEIGHT=7*a.RENDER_SCALE,a.SPLIT_MARGIN=3*a.RENDER_SCALE,a.INTERSEC_MARGIN=20*a.RENDER_SCALE,a.LINE_MAGIN=2*a.RENDER_SCALE,a.MARGIN_LEFT=2*a.RENDER_SCALE,a.ENABLE_IMAGE_PROCESS=!0,a.STEP_SIZE=2,a.CROP_FULL_WIDTH=!0,a.OVERLAP=.5,a.QUESTION_PATTERN=[],a.QUESTION_PATTERN2=[],a.BREAK_LINE_PATTERN=[],a.SECTION_PATTERN_LOWER=[],a.SECTION_PATTERN_NORMAL=[],a.KICK_PATTERN=[],a.TVCN_CHAR=[],a.HET_PATTERN=[],a.DAPAN_PATTERN=[],a.HUONGDAN_PATTERN=[],a.MULTIPLE_ANS_PATTERN=[],a.DRAW_RESULT="",a.SKIP_CHAR=[],a.FOOTER_PATTERN=[],a.HELP_ANS_PATTERN=[],a.ANS_PATTERN=[];class h{addTask(t,s,n,i){var r=n||[];if(!this.is_runner){let n=()=>new Promise(n=>{this.wrap_counter++,this.actionLogItem&&this.all_tasks>0&&this.actionLogItem.function.call({},this.wrap_counter_done,this.all_tasks,...this.actionLogItem.params?this.actionLogItem.params:[],i),s.call(t,...r).then(t=>{this.wrap_counter_done++,n({status:!0,value:t})}).catch(t=>{this.wrap_counter_done++,n({status:!1,error:t})})});this.all_tasks++;let l=[];if(this.tasks.length>0?l=this.tasks[this.tasks.length-1]:this.tasks.push(l),l.length<this.limit_one_process)l.push({task:n,name:i});else{let t=[];t.push({task:n,name:i}),this.tasks.push(t)}}}start(){return new Promise(t=>{0===this.tasks.length&&(this.clear(),t({datas:[],errs:[]})),this.result_common={datas:[],errs:[]},this.task_runner_index=-1,this.count_task_root_done=0,this.count_task_item_done=0,this.is_runner=!0,this.runnerItem(t)})}restart(){this.result_common={datas:[],errs:[]},this.clear()}clear(){this.count_task_root_done=0,this.count_task_item_done=0,this.tasks=[],this.all_tasks=0,this.task_runner_index=-1,this.wrap_counter=0,this.wrap_counter_done=0,this.is_runner=!1}runnerItem(t){this.task_runner_index++,this.task_runner=this.tasks[this.task_runner_index],this.task_runner&&this.task_runner.length>0?Promise.all(this.task_runner.map(t=>t.task.call(this))).then(s=>{this.count_task_root_done++,s.forEach(t=>{this.count_task_item_done++,t.status&&t.value?this.result_common.datas.push(t.value):t.error&&this.result_common.errs.push(t.error)}),this.result_common.errs.length>0&&this.endWithError&&(this.is_runner=!1,this.clear(),t(this.result_common)),this.count_task_item_done===this.all_tasks?(this.is_runner=!1,this.clear(),t(this.result_common)):setTimeout(()=>{this.runnerItem(t)},this.delay_time)}):(this.is_runner=!1,this.count_task_root_done++,this.clear(),t(this.result_common))}constructor(t,s,n,i){this.tasks=[],this.count_task_root_done=0,this.task_runner=[],this.task_runner_index=-1,this.all_tasks=0,this.count_task_item_done=0,this.is_runner=!1,this.wrap_counter=0,this.wrap_counter_done=0,this.limit_one_process=t,this.result_common={datas:[],errs:[]},this.actionLogItem=s,this.delay_time=n||1e3,this.endWithError=null!=i&&i}}t.exports={Constants:l,Utils:class{static capitalizeFirstLetter(t){return t.charAt(0).toUpperCase()+t.slice(1)}static tagLang(t){let s=new Map([["EASY","NB"],["MEDIUM","TH"],["HARD","VD"],["HARDEST","VDC"],["MC","TN"],["FB","ĐT"],["ES","TL"]]);return s.has(t)?s.get(t):t}static parseInclude(t){let s=t.split("=>"),n=s.length>1?s[1]:-1,i=s[0].replace(/\[@([CTQGK][\-\d]+):(:(user[_0-9]*)\-)?[^\]]*\]/g,"$1:$3").replace(/\[@(F:[^\]]*)\]/g,"$1").replace(/\[[^\]\d]+(\d+)[^\]\d]+\]/g,"$1").replace(/\[[^\]]+\]/g,""),r=[],l=[],a=[],h=[],c=[],d=[],u=[],p=n;for(let t of i.split(".")){if(/^\d*$/.test(t)){p=+t;continue}for(let s of t.split(",")){let t=s.split(":"),n=t[0].trim(),i=t[1]||"";if(/^G[\-\d]+$/.test(n))d.push(+n.substring(1));else if(/^Q[\-\d]+$/.test(n))l.push(+n.substring(1)),u.push({type:"QUEST",id:+n.substring(1)});else if(/^C[\-\d]+$/.test(n)){let t=+n.substring(1);a.push(t),u.push({type:""!==i?"SHARE":"CATEGORY",id:t})}else if(/^K[\-\d]+$/.test(n)){let t=+n.substring(1);h.push(t),u.push({type:""!==i?"SHARE":"KNOWLEDGE",id:t})}else if(/^T[\-\d]+$/.test(n))r.push(+n.substring(1)),u.push({type:"EXAM",id:+n.substring(1),groupIds:d});else if(/^F:/.test(s.trim())){let t=s.trim().substring(2);c.push(langMap.has(t)?langMap.get(t):t)}}if(u.length>0){if(c.length>0){let t=c.filter(t=>["TL","ES","MC","FB"].indexOf(t)>=0).map(t=>"TL"===t||"ES"===t?3:"MC"===t||"FB"===t?1:4);for(let s of u)s.tags=c.filter(t=>0>["TL","TN","ĐT","ES","MC","FB"].indexOf(t)),s.answerTypes=t}break}}return l.length>0&&(p=l.length),{paths:u,shareTypes:a.concat(h).concat(l),catId:a,examId:r,tag:c,groupId:d,questId:l,getNum:p,idx:n}}static getNumberFromStr(t){let s=t.match(/(\d+)/);return s?s[0]:""}static removeAccents(t){for(let s of["a\xe0ả\xe3\xe1ạăằẳẵắặ\xe2ầẩẫấậ","A\xc0Ả\xc3\xc1ẠĂẰẲẴẮẶ\xc2ẦẨẪẤẬ","dđ","DĐ","e\xe8ẻẽ\xe9ẹ\xeaềểễếệ","E\xc8ẺẼ\xc9Ẹ\xcaỀỂỄẾỆ","i\xecỉĩ\xedị","I\xccỈĨ\xcdỊ","o\xf2ỏ\xf5\xf3ọ\xf4ồổỗốộơờởỡớợ","O\xd2Ỏ\xd5\xd3Ọ\xd4ỒỔỖỐỘƠỜỞỠỚỢ","u\xf9ủũ\xfaụưừửữứự","U\xd9ỦŨ\xdaỤƯỪỬỮỨỰ","yỳỷỹ\xfdỵ","YỲỶỸ\xddỴ"]){let n=RegExp("["+s.substring(1)+"]","g");t=t.replace(n,s[0])}return t}static zeroPad(t,s){return(Array(t=t||2).join("0")+s).slice(-1*t)}},PdfConst:new a,Task:h,Image:class{cssStringToJSON(t){for(var s={},n=t.split(";"),i=0;i<n.length;i++){var r=n[i].split(":");if(2===r.length){var l=r[0].trim(),a=r[1].trim();s[l]=a}}return s}getStyle(t){let s=t.match(/style="([^"]*)"/);return s?s[1]:""}cropImage(){}start(t){this.callback=t,this.questions.forEach(t=>{var s,n,i;(null===(s=t.content)||void 0===s?void 0:s.includes("<img "))&&this.replaceImage(t,"content"),(null===(n=t.explain)||void 0===n?void 0:n.includes("<img "))&&this.replaceImage(t,"explain"),(null===(i=t.options)||void 0===i?void 0:i.find(t=>t.text.includes("<img ")))&&this.replaceImage(t,"options")}),this.imageMaps.forEach(t=>{this.taskConvertBase64ToCanvas.addTask(this,this.startConvertCanvas,[t])}),this.taskConvertBase64ToCanvas.start().then(t=>{if(t.errs.length>0)this.callback({error:t.errs});else{let s=0,n=[],i=()=>{let t=document.createElement("canvas");t.width=this.sizeDefaultCanvas,t.height=this.sizeDefaultCanvas;let s=t.getContext("2d");s&&(s.fillStyle="white",s.fillRect(0,0,this.sizeDefaultCanvas,this.sizeDefaultCanvas)),n.push({cdn:"",cX:0,cY:0,canvas:t,imgs:[]})};i(),t.datas.forEach((t,r)=>{var l=n[n.length-1];l.cX+t.canvas.width+4>this.sizeDefaultCanvas?(l.cX=4,l.cY+=s+4,s=0):l.cX+=4,l.cY+t.canvas.height>this.sizeDefaultCanvas&&(i(),l=n[n.length-1]);var a=l.canvas.getContext("2d");l.imgs.push({x:l.cX,y:l.cY,width:t.canvas.width,height:t.canvas.height,index:r,style:this.getStyle(t.base),url:t.canvas.toDataURL("image/png",1)}),null==a||a.drawImage(t.canvas,0,0,t.canvas.width,t.canvas.height,l.cX,l.cY,t.canvas.width,t.canvas.height),l.cX+=t.canvas.width,s=s<t.canvas.height?t.canvas.height:s}),n[0].imgs.length>0?(n.forEach(t=>{this.taskUploadImage.addTask(this,this.startUploadFile,[t])}),this.taskUploadImage.start().then(s=>{s.errs.length>0?this.callback({error:s.errs}):(s.datas.forEach(s=>{s.imgs.forEach(n=>{let i=t.datas[n.index];if(i){let t={link:s.cdn,data:{x:n.x,y:n.y,width:n.width,height:n.height,style:n.style}};i.objs.forEach(s=>{let r='<img class="quill-image"  data-value=\''.concat(JSON.stringify(t),"' style=\"").concat(n.style,'"/>');"options"===i.path?s[i.path]=s[i.path].map(t=>({...t,text:t.text.replace(i.base,r)})):s[i.path]=s[i.path].replace(i.base,r)})}})}),this.callback({success:this.questions}))})):this.callback({success:this.questions})}})}replaceImage(t,s){var n=t[s];"options"==s&&(n=t[s].map(t=>t.text).join(""));let i=n.matchAll(this.pattern_image);for(;;){let n=i.next();if(n.done)break;let[r]=n.value,[,l,a]=r.match(/data-value=(?:"([^"]*)"|'([^']*)')/)||[];l||a||this.imageMaps.push({base:r,data:null,objs:[t],path:s,canvas:document.createElement("canvas")})}}startConvertCanvas(t){return new Promise((s,n)=>{let i=new Image;i.crossOrigin="anonymous",i.onload=()=>{var n;let r=1;if(i.width>this.sizeDefaultCanvas&&(r=this.sizeDefaultCanvas/i.width),i.height>this.sizeDefaultCanvas){let t=this.sizeDefaultCanvas/i.height;t<r&&(r=t)}t.canvas.width=i.width*r,t.canvas.height=i.height*r,null===(n=t.canvas.getContext("2d"))||void 0===n||n.drawImage(i,0,0,i.width,i.height,0,0,t.canvas.width,t.canvas.height),s(t)},i.onerror=()=>{t.canvas.width=1,t.canvas.height=1;let n=t.canvas.getContext("2d");n&&(n.fillStyle="white",n.fillRect(0,0,1,1)),s(t)};let r=this.pattern_base64.exec(t.base);null!=r?i.src=r[0]:n(Error("lỗi regex"))})}startUploadFile(t){return new Promise(async(s,n)=>{let i=new FormData;i.append("image",this.dataURLtoFile(t.canvas.toDataURL("image/png",1)));let{data:l}=await r.default.post("/uploads",i,{headers:{"Content-Type":"multipart/form-data"}}),{error:a,url:h}=l;if(a)return s({...t,cdn:await this.canvasToBlobURL(t.canvas,"image/png",1)||""});s({...t,cdn:h})})}canvasToBlobURL(t,s,n){return new Promise(function(i,r){t.toBlob(function(t){t?i(URL.createObjectURL(t)):r("Kh\xf4ng thể chuyển đổi canvas th\xe0nh blob.")},s,n)})}dataURLtoFile(t){let s=this.getFileName(t);for(var n=t.split(","),i=n[0].match(/:(.*?);/),r=atob(n[1]),l=r.length,a=new Uint8Array(l);l--;)a[l]=r.charCodeAt(l);return new File([a],s,{type:i&&i.length>0?i[1]:"png"})}getFileName(t){var s=t.split("").reverse().join(""),n=s.indexOf(";"),i=s.indexOf("/",n);return s.substring(n,i).split("").reverse().join("")}constructor(t){this.questions=JSON.parse(JSON.stringify(t)),this.callback=()=>{},this.sizeDefaultCanvas=1100,this.actionRunAfterConvert=[],this.imageMaps=[],this.pattern_base64=/data:image[^"'\\]+/i,this.pattern_image=/<img[^>]+data:image[^>]+>/g,this.taskConvertBase64ToCanvas=new h(50,{function:(t,s)=>{this.callbackBase64ToCanvas&&this.callbackBase64ToCanvas(t,s)}}),this.taskUploadImage=new h(3,{function:(t,s)=>{this.callbackUploadImage&&this.callbackUploadImage(t,s)}})}},Version:"test"}},6781:function(t,s,n){"use strict";Object.defineProperty(s,"__esModule",{value:!0});let i=n(1117),r=t=>{let s="z",n="abcdefghijklmnopqrstuvwxyz0123456789",i=n.length;for(let r=0;r<t;r++)s+=n.charAt(Math.floor(Math.random()*i));return s};class l{readFileInputEventAsArrayBuffer(t,s){var n=new FileReader;n.onload=function(t){s(t.target.result)},n.readAsArrayBuffer(t)}handleFileSelect(t,s,n){let r=this,l=(t,s)=>{n&&n(t,s,"lang_auto_cong_thuc")},a=new i.Task(30,{function:n?(t,s)=>{n&&n(t,s,"lang_auto_image")}:()=>{}});this.readFileInputEventAsArrayBuffer(t,function(t){taodethiDocx.readDocx(t,l).then(function(t){for(let s of t.data)"img"==s.type&&("image/x-wmf"==s.contentType||"image/x-emf"==s.contentType?a.addTask(r,r.convert,[s]):s.value="data:"+s.contentType+";base64, "+s.value,!s.cssStyle&&s.height&&s.width&&"EMU"==s.measureUnit)&&(s.cssStyle="width:".concat(+s.width/12700,"pt;height:").concat(+s.height/12700,"pt;margin-top:0px;"));a.start().then(()=>{let n=new Map,i=0;for(let s of t.data)"img"==s.type&&s.cropInfo&&n.set(i,1),i++;if(s&&0==n.size)s(t);else for(let l of(i=0,t.data)){if("img"==l.type&&l.cropInfo){let a=i,h=document.createElement("img");h.src=l.value,h.onload=()=>{r.cropImage(l,h),n.delete(a),0==n.size&&s&&s(t)},h.onerror=()=>{n.delete(a),0==n.size&&s&&s(t)}}i++}})})})}convert(t){return new Promise(s=>{if("image/x-wmf"==t.contentType)t.value=this.wmf.toPNG("data:"+t.contentType+";base64, "+t.value),s();else{let i=new ToContext2D(0,1),r=this.decodeBase64(t.value);try{FromEMF.Parse(r,i)}catch(t){}var n=this.scaleCanvas(i.canvas,200,200);t.value=n.toDataURL(),s()}})}decodeBase64(t){return Uint8Array.from(atob(t),function(t){return t.charCodeAt(0)})}scaleCanvas(t,s,n){var i;let r=document.createElement("canvas");return r.width=s,r.height=n,null===(i=r.getContext("2d"))||void 0===i||i.drawImage(t,0,0,t.width,t.height,0,0,s,n),r}cropImage(t,s){var n;if(!t.cropInfo)return;let i=t.cropInfo.left?+t.cropInfo.left:0,r=t.cropInfo.top?+t.cropInfo.top:0,l=t.cropInfo.right?+t.cropInfo.right:0,a=t.cropInfo.bottom?+t.cropInfo.bottom:0;if(i+r+l+a==0)return;let h=s.width,c=s.height,d=i*h/1e5,u=r*c/1e5,p=h-l*h/1e5-d,x=c-a*c/1e5-u,g=document.createElement("canvas");g.width=p,g.height=x,null===(n=g.getContext("2d"))||void 0===n||n.drawImage(s,d,u,p,x,0,0,p,x),t.value=g.toDataURL()}constructor(t){this.wmf=new WMFConverter}}class a{process(t){let s=["(^c\xe2u\\s*\\d{1,4}[^0-9])","(^câu\\s*\\d{1,4}[^0-9])","(^c\xa9u\\s*\\d{1,4}[^0-9])","(^ca‚u\\s*\\d{1,4}[^0-9])","(^b\xe0i\\s*\\d{1,4}[^0-9])","(^bài\\s*\\d{1,4}[^0-9])","(^cau\\s*\\d{1,4}[^0-9])","(^bai\\s*\\d{1,4}[^0-9])","(^question\\s*\\d{1,4}[^0-9])","(^questions\\s*\\d{1,4}[^0-9])","(^\\[\\d{1,4}\\][^0-9])","(^\\d+\\s*\\(nb\\))","(^\\d+\\s*\\(th\\))","(^\\d+\\s*\\(vd\\))","(^\\d+\\s*\\(vdc\\))","(^c\xe2u\\s*\\d{1,4}[\\s\\.:]*$)","(^câu\\s*\\d{1,4}[\\s\\.:]*$)","(^c\xa9u\\s*\\d{1,4}[\\s\\.:]*$)","(^ca‚u\\s*\\d{1,4}[\\s\\.:]*$)","(^b\xe0i\\s*\\d{1,4}[\\s\\.:]*$)","(^bài\\s*\\d{1,4}[\\s\\.:]*$)","(^cau\\s*\\d{1,4}[\\s\\.:]*$)","(^bai\\s*\\d{1,4}[\\s\\.:]*$)","(^questions\\s*\\d{1,4}[\\s\\.:]*$)","(^question\\s*\\d{1,4}[\\s\\.:]*$)"],n=["(^(\\d+\\s*\\.)\\s*[\\.0-9])","(^(\\d+\\s*\\.)\\s*\\(\\s*\\d+\\s*\\))","(^(\\d+\\s*\\.)\\s*[^\\s]\\s*[^\\s0-9])","(^\\d+\\s*\\.\\s*$)"],r=["(HƯỚNG\\s*DẪN)","(ƯỚNG\\s*DẪN\\s*GIẢI\\s*CHI)","(GIẢI\\s*TH\xcdCH\\s*CHI\\s*TIẾT)","(Hướng\\s*dẫn\\s*giải)","(Lời\\s*giải)","(LỜI\\s*GIẢI)","(GIẢI\\s*CHI\\s*TIẾT)","(HD:)","(GLOSSARY)"],l=0,a=[],h=[];for(let c of t){let t=this.do(c,s,n);null!=t?(a.push({idx:l,val:i.Utils.capitalizeFirstLetter(t.olabel)}),h.push("q")):null!=(t=this.match(c,r))&&h.push("h"),l++}if(h.join("-").startsWith("q-h-q-h")){let s=1;for(let n of a)t[n.idx]=t[n.idx].replace(n.val,n.val.replace(/\d+/g,s+"")),s++}}do(t,s,n){let i=this.matchPos(t,s,n);if(i.value){let s=null;for(let t=i.value.length-1;t>=0;t--)if(i.value[t]){s=i.value[t];break}if(null==s)return null;let n=t.replace(/\|/g,"").toLowerCase().indexOf(s),r=n,l="",a=t.toLowerCase();for((s.endsWith("(")||s.endsWith("["))&&(s=s.substring(0,s.length-1));r<a.length&&("|"!=a[r]&&(l+=a[r]),r++,l!=s););return{pos:[n,r],olabel:s}}return null}matchPos(t,s,n){let i=t.replace(/\|/g,"").toLowerCase().trim(),r=s.join("|"),l=i.matchAll(r).next();return l.value||(r=n.join("|"),l=i.matchAll(r).next()),l}match(t,s){let n=t.replace(/\|/g,"").trim().match(s.join("|"));return null!=n&&n.length>0?{pos:[0,0],olabel:""}:null}}class h{process(t){let s=/^\s*#(\d)\s*\[[A-Z0-9\-\[\]\$!:b]+\]/g,n=["NB","TH","VD","VDC"],i=0,r=!1,l=1;for(let a of t){let h=a.matchAll(s).next();if(!h.done){let s=+h.value[1]-1;s<n.length&&(t[i]=a.replace(h.value[0],"C\xe2u ".concat(l++,". (").concat(n[s],")"))),r=!0}r&&"GY"==a.trim()&&(t[i]="Lời giải"),i++}}}class c{setApiService(t){this.apiService=t}setSingleMode(t){this.singleMode=t}setLines(t){this._lines=t}parse(t){return this._lstQuest=this.exParser.parse(this._lines,t,!1),this._lstQuest}constructor(t){this.conf=t,this._lstQuest=[],this._lines=[],this.singleMode=!1,this.exParser=new d(t),this.apiService=null}}class d{parse(t,s,n){var r,l,a,h,c,d,u,p,x,g,f,v;let P=this.findItems(t,n),y=new Map,N=[],_=null,S=0,L="main",Z=0,k=0,R=[],M=!0,O=new Map;for(let s=0;s<P.length;s++){let n=P[s],g=s==P.length-1?void 0:P[s+1],f=this.getPartInfo(t,n,g);if(this.loadText(t,f),n.type==E.TYPE_NAME&&"main"==L&&(S++,N.push({label:S,parts:f,answers:[],isGroup:!0})),n.type==T.TYPE_NAME){if(g&&g.type==C.TYPE_NAME&&g.pos[2]>0){let i;for(let t=s+1;t<P.length;t++)if(P[t].type!=C.TYPE_NAME){i=P[t];break}f=this.getPartInfo(t,n,i),this.loadText(t,f)}let i=n.label?+n.label:0,r=y.get(i);r&&"main"!=L?(r.help=f,_=r):"main"==L&&(r={label:i,olabel:n.olabel,answers:[],parts:f},S>0&&(r.group=S),y.set(i,r),N.push(r),_=r)}if(n.type==C.TYPE_NAME&&_){let s=!1;if(f.length>0){let n=t[f[0].lineIdx].replace(/\|/g,"").trim().match(i.Constants.MULTIPLE_ANS_PATTERN.join("|"));null!=n&&n.length>0&&(s=!0)}let l=""==n.olabel;n.pos[2]>0&&((f=[f[0]])[0].e=n.pos[2],this.loadText(t,f),l=!0);let a={label:null!==(r=n.label)&&void 0!==r?r:"",isCorrect:"*"==n.extInfo,parts:l?[f[0]]:f,isInline:l,olabel:n.olabel};_.answers.push(a),_.isFixAns=l||s}if(n.type==j.TYPE_NAME){if(n.label&&/\.\d*$/.test(n.label)){let t=n.label.split("."),s=+t[t.length-1],i=null!==(l=f[0].text)&&void 0!==l?l:"",r=null!==(a=O.get(i))&&void 0!==a?a:-1;if(r++,O.set(i,r),0==s){S++;let t=i+"=>"+r+"-0",s=[];s.push(...f),s[0]={lineIdx:f[0].lineIdx,s:0,b:0,text:t},N.push({label:S,parts:s,answers:[],isGroup:!0});continue}let c=_?_.label:0,d=0;for(let t=0;t<s;t++){d++;let s=i+"=>"+r+"-"+t,n=[];n.push(...f),n[0]={lineIdx:f[0].lineIdx,s:0,b:0,text:s};let l={label:c+d,olabel:_?null===(h=_.olabel)||void 0===h?void 0:h.replace(/\d+/,c+d+""):this.DEF_QUEST_NAME+(c+d)+".",answers:[],parts:n};y.set(l.label,l),N.push(l),_=l}}else if(n.label&&/\.Q\d+(,Q\d+)*$/.test(n.label)){let t=n.label.split(".").pop(),s=null!==(c=null==t?void 0:t.split(",").length)&&void 0!==c?c:0;for(let t=0;t<s;t++){let s={lineIdx:f[0].lineIdx,s:0,b:0,text:f[0].text+"=>0-"+t},n=_?_.label:0,i={label:n+1,olabel:_?null===(d=_.olabel)||void 0===d?void 0:d.replace(/\d+/,n+1+""):this.DEF_QUEST_NAME+(n+1)+".",answers:[],parts:[s]};y.set(i.label,i),N.push(i),_=i}}}n.type==A.TYPE_NAME&&_&&(f.splice(0,1),g&&g.type==T.TYPE_NAME&&g.label&&!y.has(+g.label)||!g||g.type==E.TYPE_NAME?"main"==L&&(_.help=f):"main"==L&&(L="info",Z=null!==(u=n.lineIdx)&&void 0!==u?u:0),Z>0&&0==k&&(k=null!==(p=n.lineIdx)&&void 0!==p?p:0)),(n.type==I.TYPE_NAME||n.type==w.TYPE_NAME)&&(L="info",Z=null!==(x=n.lineIdx)&&void 0!==x?x:0),n.type==b.TYPE_NAME&&M&&R.push(n),n.type!=b.TYPE_NAME&&R.length>0&&(M=!1)}let H=new b,q=H.getAnsMC(t,R),B=new Map;if(Z>0){let s=k>0?t.slice(Z,k):t.slice(Z);B=H.getAnsStr(s)}for(let s of N){if(s.isGroup)continue;let n=null!==(g=q.get(s.label))&&void 0!==g?g:"",i=null!==(f=B.get(s.label))&&void 0!==f?f:"",r="";if(s.help&&(r=null!==(v=H.getAnsFromHelp(s.help,t))&&void 0!==v?v:""),s.answers.length>0){if(0==s.answers.filter(t=>t.isCorrect).length){let t=n;for(let n of(""==t.trim()&&(t=r),""==t.trim()&&(t=i),s.answers))/^[A-H,\s]+$/.test(t)&&t.indexOf(n.label)>=0&&(n.isCorrect=!0)}}else s.strAns=i;s.answers.filter(t=>{var s,n;return(null==t?void 0:null===(s=t.answers)||void 0===s?void 0:null===(n=s.label)||void 0===n?void 0:n.charCodeAt(0))>=97}).length&&(s.strAns=i)}return N}cleanRes(t){for(let s of t){for(let t=s.parts.length-1;t>=0;t--)""==s.parts[t].text&&s.parts.splice(t,1);for(let t of s.answers)for(let s=t.parts.length-1;s>=0;s--)""==t.parts[s].text&&t.parts.splice(s,1);if(s.help)for(let t=s.help.length-1;t>=0;t--)""==s.help[t].text&&s.help.splice(t,1)}}getPartInfo(t,s,n){var i,r;let l=null!==(i=s.lineIdx)&&void 0!==i?i:0,a=null!==(r=null==n?void 0:n.lineIdx)&&void 0!==r?r:t.length-1;if(l==a)return n?[{lineIdx:l,b:s.pos[0],s:s.pos[1],e:null==n?void 0:n.pos[0]}]:[{lineIdx:l,b:s.pos[0],s:s.pos[1]}];{let i=[];i.push({lineIdx:l,b:s.pos[0],s:s.pos[1]});for(let t=l+1;t<a;t++)i.push({lineIdx:t,b:0,s:0});if(n){let s=null==n?void 0:n.pos[0];""!=t[a].substring(0,s).replace(/\|/g,"").trim()&&i.push({lineIdx:a,b:0,s:0,e:s})}else i.push({lineIdx:a,b:0,s:0});return i}}loadText(t,s){for(let n of s)n.text=t[n.lineIdx].substring(n.s,n.e)}findItems(t,s){let n=["remove:q-s-a => 1","remove:s-s => 0","remove:h-h => 0","remove:h-a => 0","rmdup:a-a => void","remove:s-a:.+\\-[^A] => 0","remove:a-a:A\\-[^B] => 0","remove:a-a:B\\-[^C] => 0","remove:a-a:C\\-[^D] => 0","remove:a-a:D\\-[^E] => 0","remove:a-a:E\\-[^F] => 0","same:q:QUESTION_PATTERN,QUESTION_PATTERN2 => void"];s&&(n=["remove:q-s-a => 1","remove:s-s => 0","remove:h-h => 0","remove:h-a => 0","remove:q-a:\\d+\\-[^A] => 0","remove:s-a:.+\\-[^A] => 0","remove:a-a:A\\-[^AB] => 0","remove:a-a:B\\-[^ABCD] => 0","remove:a-a:C\\-[^ACDE] => 0","remove:a-a:D\\-[^ADEF] => 0","remove:a-a:E\\-[^AEF] => 0","same:a: => void","same:q:QUESTION_PATTERN,QUESTION_PATTERN2 => void"]);let i=[new p,new x,new g,new f],r=[{parser:new b,also:[2]},{parser:new E,from:[0],to:[1],also:[3]},{parser:new T,from:[0],to:[1],also:[3]},{parser:new C},{parser:new I,to:[2]},{parser:new w,to:[2],also:[6]},{parser:new A},{parser:new j,from:[0],to:[1]}],l=[{name:"start",expect:[1,2,7]},{name:"main",expect:[1,2,3,4,5,6,7]},{name:"info",expect:[0,1,2,6]}],a=l[0],h=[],c=0;for(let s of t)if(""!=s){for(let t of a.expect){let n=r[t],i=n.parser.parse(s);if(i.length>0){if(i.forEach(t=>t.lineIdx=c),h.push(...i),n.parser.TYPE==A.TYPE_NAME){let t=h.filter(t=>t.type==T.TYPE_NAME).length,s=h.filter(t=>t.type==A.TYPE_NAME).length,n=h.filter(t=>t.type==w.TYPE_NAME).length;if(a.name==l[1].name&&t>1&&0==s){a=l[2];let t=l[2].expect.indexOf(6);t>=0&&l[2].expect.splice(t,1)}else if(a.name==l[2].name){n>0&&r[0].parser.off();let t=l[2].expect.indexOf(6);t>=0&&l[2].expect.splice(t,1)}}if(n.to){let t=0;for(let s of n.to)(n.from&&l[n.from[t]]==a||!n.from)&&(a=l[s]),t++}if(n.also)for(let t of n.also){let n=h[h.length-1].pos[1],i=r[t].parser.parse(s.substring(n));i.length>0&&(i.forEach(t=>{t.lineIdx=c;for(let s=0;s<t.pos.length;s++)t.pos[s]=t.pos[s]+n}),h.push(...i))}break}}c++}else c++;let d=[];for(let t of n)for(let s of i){let n=s.load(t);if(n){d.push(n);break}}let u=0;for(;u<h.length;){for(let t of d){let s=h.length;if(t.run(h,u)){let t=s-h.length;t>0&&(u-=t+1);break}}u++}return h}constructor(t){this.DEF_QUEST_NAME="c\xe2u ",i.Constants.load(t)}}class u{checkVal(t,s){var n;if(""==this.valPattern)return!0;let i=[];for(let r=Math.ceil(this.pattern.length/2);r>0;r--)i.push(null===(n=t[s-r+1].label)||void 0===n?void 0:n.trim());let r=i.join("-");return new RegExp(this.valPattern).test(r)}getStack(t,s){let n="",i=s-10>=0?s-10:0;for(;i<=s;i++)n+="-"+t[i].type[0];return n}constructor(t,s){if(this.TYPE="",this.pattern="",this.valPattern="",this.data=[],this.TYPE=s,!t.startsWith(this.TYPE))return;let n=t.substring(this.TYPE.length).split("=>"),i=n[0].split(":");this.pattern=i[0].trim(),this.valPattern=i.length>1?i[1].trim():"",this.data=n[1].split(",").map(t=>t.trim())}}class p extends u{load(t){let s=new p(t);return""!=s.pattern?s:null}run(t,s){if(""==this.pattern)return!1;if(this.getStack(t,s).endsWith(this.pattern)&&this.checkVal(t,s)){for(let n of this.data)t.splice(s-+n,1);return!0}return!1}constructor(t){super(null!=t?t:"","remove:")}}class x extends u{load(t){let s=new x(t);return""!=s.pattern?s:null}run(t,s){if(""==this.pattern)return!1;if(this.getStack(t,s).endsWith(this.pattern)&&this.checkVal(t,s)){for(let n of this.data){let i=n.split(":"),r=s-+i[0],l=t[r].label;t[r].label=i[1],t[r].err=l+" -> "+i[1]}return!0}return!1}constructor(t){super(null!=t?t:"","modify:")}}class g extends u{load(t){let s=new g(t);return""!=s.pattern?s:null}run(t,s){var n,r,l;if(""==this.pattern)return!1;let a=t[s];if(a.type[0]!=this.pattern)return!1;let h=[],c=[],d="";for(let n=0;n<s;n++){let s=t[n];(s.type==I.TYPE_NAME||s.type==w.TYPE_NAME)&&(d="da"),s.type==A.TYPE_NAME&&"da"==d&&(d="hd")}if("da"==d)return!1;for(let n=s-1;n>=0;n--){let s=t[n];if(s.type==I.TYPE_NAME||s.type==w.TYPE_NAME||"hd"==d&&s.type==A.TYPE_NAME||(s.type[0]==this.pattern&&s.olabel&&(h.push(s.olabel),c.push(s.label)),2==h.length))break}if(h.length>=1){let d=h[0],u=2==h.length?h[1]:d,p=null!==(n=a.olabel)&&void 0!==n?n:"";if("a"==this.pattern&&(""==d&&(d="."),""==u&&(u="."),""==p&&(p=".")),""==this.valPattern){if(d==u&&p!=d)return t.splice(s,1),!0}else for(let n of this.valPattern.split(",")){let h=n.trim(),x=new RegExp(i.Constants[h].join("|"));if(x.test(d)&&x.test(u)&&!x.test(p)&&+(null!==(r=c[0])&&void 0!==r?r:"0")+1!=+(null!==(l=a.label)&&void 0!==l?l:"0"))return t.splice(s,1),!0}}return!1}constructor(t){super(null!=t?t:"","same:")}}class f extends u{load(t){let s=new f(t);return""!=s.pattern?s:null}run(t,s){var n,i;if(""==this.pattern)return!1;if(this.getStack(t,s).endsWith(this.pattern)){let r=null!==(n=t[s].score)&&void 0!==n?n:0,l=null!==(i=t[s-1].score)&&void 0!==i?i:0;if(t[s].label==t[s-1].label)return t.splice(r>l?s-1:s,1),!0}return!1}constructor(t){super(null!=t?t:"","rmdup:")}}class v{on(){this.isOn=!0}off(){this.isOn=!1}parse(t){return this.isOn?this.do(t):[]}match(t,s){let n=t.replace(/\|/g,"").trim().match(s.join("|"));return null!=n&&n.length>0?[{type:this.TYPE,pos:[0,0]}]:[]}constructor(){this.isOn=!0,this.TYPE="default"}}class b extends v{do(t){let s=this.cleanLine(t);return/^[0-9ABCDEFGHabcdefghĐS]+$/g.test(s)&&s.length>=2?[{type:b.TYPE_NAME,pos:[0,0]}]:[]}cleanLine(t){let s=t;for(let t of(s=(s=s.replaceAll(/\[![!iucsbp]+:\$(([^$]|\$[^\]])+)\$\]/g,"$1")).replaceAll(/\[![!iucsbp]+:!!\]/g,""),[/\|/g,/[\s.\-:,;![\]@*$()\u2013]+/g,/C\xe2u/g,/\u0110\xe1p\xe1n/g,/\u0110\/A/g,/Question/g,/Questions/g,/question/g,/questions/g]))s=s.replaceAll(t,"");return s.replaceAll("\\n"," ")}getAnsMC(t,s){var n;let i=[];for(let r of s)i.push(t[null!==(n=r.lineIdx)&&void 0!==n?n:0]);let r=i.join(""),l=this.cleanLine(r),a=this.getResultMC(l.toUpperCase()),h=new Map;for(let t of a)h.set(t.num,t.str);return h}getAnsStr(t){let s=t.join("\n");s=(s=(s=s.replaceAll(/\[![!iucsbp]+:\$(([^$]|\$[^\]])+)\$\]/g,"$1")).replaceAll(/\[![!iucsbp]+:!!\]/g,"")).replaceAll("[*","").replaceAll("*]","");let n=this.getResultStr(s),i=new Map;for(let t of n)i.set(t.num,t.str);return i}getAnsFromHelp(t,s){let n=[];for(let i of t){let t=s[i.lineIdx];t=(t=t.replaceAll(/\[![!iucsbp]+:\$(([^$]|\$[^\]])+)\$\]/g,"$1")).replaceAll(/\[![!iucsbp]+:!!\]/g,""),n.push(t)}let r=0;for(let s of n){let n=s.trim().match(i.Constants.HELP_ANS_PATTERN.join("|"));if(null!=n){for(let s of n)if(null!=s&&1==s.length)return t.splice(r,1),s}r++}return""}getResultStr(t){let s=[],n=t.replace(/\n/g,"\n"),r=i.Constants.QUESTION_PATTERN.join("|").replace(/\(\^/g,"("),l=n.matchAll(RegExp(r,"ig"));for(;;){let t=l.next();if(t.done)break;let s=t.value[0],r=i.Utils.getNumberFromStr(s);n=n.replace(s,r+".")}let a,h=i.Constants.RES_ANS_PATTERN.length>0?RegExp(i.Constants.RES_ANS_PATTERN.join("|"),"g"):/\d+[.-][^|0-9]/g,c=n.matchAll(h),d=-1;for(;;){let t=c.next();if(t.done)break;if(-1==d)d=t.value.index,a=t;else{let i=n.substr(d,t.value.index-d);s.push(this.toAns(i,a)),d=t.value.index,a=t}}if(d>=0&&a){let t=n.substr(d);s.push(this.toAns(t,a))}return s}toAns(t,s){let n=s.value[0].length-1;return{num:+s.value[0].substr(0,n-1),str:t.substring(n).replace(/\s+/g," ").trim()}}getResultMC(t){let s=[],n="",i=[],r=!1;for(let s=0;s<t.length;s++){let l=t.charCodeAt(s),a=l>=65&&l<=72;if(a&&""==n)return[];a!=r&&(i.push(n),n=""),r=a,n+=t[s]}""!=n&&i.push(n);for(let t=1;t<i.length;t+=2){let n=0,r=Math.floor(i[t-1].length/i[t].length),l=+i[t-1].substring(n,r),a=l,h=!1;for(let c=0;c<i[t].length;c++){if(c>=i[t-1].length||(l=+i[t-1].substring(n,n+r))!=a){h=!0;break}s.push({num:l,str:i[t][c]}),n+=r,r=(a=l+1).toString().length}if(h){s=[];break}}if(0==s.length)for(let t=1;t<i.length;t+=2){let n=+i[t-1];if(t>1&&n!=s[s.length-1].num+1)return[];s.push({num:n,str:i[t]})}return s}constructor(t){super(),this.TYPE=b.TYPE_NAME,null!=t&&(this.isOn=t)}}b.TYPE_NAME="chitietdapan";class E extends v{do(t){let s=t.replace(/\|/g,""),n=(s=s.replaceAll(/\[![!ibuc]+:\$(([^\$]|\$[^\]])+)\$\]/g,"$1")).toLowerCase().trim().match(i.Constants.SECTION_PATTERN_LOWER.join("|")),r=null!=n&&n.length>0;return r||(r=null!=(n=s.trim().match(i.Constants.SECTION_PATTERN_NORMAL.join("|")))&&n.length>0),r&&n?[{type:this.TYPE,pos:[0,0],label:s}]:[]}constructor(t){super(),null!=t&&(this.isOn=t),this.TYPE="section",this.TYPE_NAME=this.TYPE}}E.TYPE_NAME="section";class T extends v{do(t){let s=this.matchPos(t);if(s.value){let n=null;for(let t=s.value.length-1;t>=0;t--)if(s.value[t]){n=s.value[t];break}if(null==n)return[];let i=t.replace(/\|/g,"").toLowerCase().indexOf(n),r=i,l="",a=t.toLowerCase();for((n.endsWith("(")||n.endsWith("["))&&(n=n.substring(0,n.length-1));r<a.length&&("|"!=a[r]&&(l+=a[r]),r++,l!=n););let h={type:this.TYPE,pos:[i,r]};return h.label=this.getNumberFromStr(t.substring(h.pos[0],h.pos[1])),h.olabel=n,[h]}return[]}matchPos(t){let s=t.replace(/\|/g,"").toLowerCase().trim(),n=i.Constants.QUESTION_PATTERN.join("|"),r=s.matchAll(n).next();return r.value||(n=i.Constants.QUESTION_PATTERN2.join("|"),r=s.matchAll(n).next()),r}getNumberFromStr(t){let s=t.match(/(\d+)/);return s?s[0]:""}constructor(t){super(),null!=t&&(this.isOn=t),this.TYPE=T.TYPE_NAME}}T.TYPE_NAME="question";class C extends v{do(t){let s=[],n="|"+t,i=/([\s|.\]]+\*?[A-H][\s|]*[.)]|[a-h]\))/g,r=this.matchPos(n,i,!1);0==r.length&&(r=this.matchPos(n,i,!0));let l=!1;0==r.length&&/^\|?\s*\*?[A-H\s|]+$/g.test(n)&&(l=!0,r=this.matchPos(n,/\*?[A-H]/g,!1));let a=!1;if(0==r.length&&(l=!0,a=!0,r=this.matchPos(n,/\[\*?[A-H]:[^\]]+\]/g,!1)),r.length>0)for(let i of r){let r=i.index+i.value.length-1,h=-9999,c=i.value.replace(/\*?[\sA-H|]/g,"");a&&(h=i.index+i.value.length-2,i.index=i.index+1,r=i.index+1+(i.value.startsWith("[*")?1:0),c=".");let d={type:this.TYPE,pos:[i.index-1,r,h]},u=t.substring(d.pos[0]);(l||/^\|?\s*\*?[A-Himg\s|.]+$/g.test(n)||u.trim()!=i.value.trim())&&(d.label=t.substring(d.pos[0],d.pos[0]+1),"*"==d.label&&(d.label=t.substring(d.pos[0]+1,d.pos[0]+2),d.extInfo="*"),d.olabel=c,d.score=1,""==t.substring(0,d.pos[0]).replace(/[\s|]/g,"")&&(d.score=2),s.push(d))}return s}matchPos(t,s,n){let i=n?t.toUpperCase():t,r=/[\s|.\]]/,l=i.matchAll(s),a=[];for(;;){let t=l.next();if(t.done)break;let s=0;for(let n=t.value.index;n<i.length&&r.test(i[n]);n++)s++;let n=t.value[0].substr(s,1),h=/[[(]\s*(VD|TH|NB|VDC|EASY|MEDIUM|HARD|HARDEST)\s*[\d.]*\s*[)\]]\s*[:.]?/g,c=/\[![a-z]+:\$\s*\$\]/g;("A"!=n||i.replace(/\|/g,"").replace(/\[!info:\d+\]/g,"").replace(h,"").replace(c,"").trim().startsWith("A"))&&("*A"!=n||i.replace(/\|/g,"").replace(/\[!info:\d+\]/g,"").replace(h,"").replace(c,"").trim().startsWith("*A"))&&a.push({value:t.value[0].substr(s),index:t.value.index+s})}return a}constructor(t){super(),null!=t&&(this.isOn=t),this.TYPE=C.TYPE_NAME}}C.TYPE_NAME="answer";class I extends v{do(t){return this.match(t,i.Constants.HET_PATTERN)}constructor(t){super(),null!=t&&(this.isOn=t),this.TYPE=I.TYPE_NAME}}I.TYPE_NAME="end";class w extends v{do(t){return this.match(t,i.Constants.DAPAN_PATTERN)}static getAnsFromHelp(t){for(let s of t){let t=s.replace(/\|/g,"").trim().match(i.Constants.HELP_ANS_PATTERN.join("|"));if(null!=t){for(let s of t)if(null!=s&&1==s.length)return s}}return""}constructor(t){super(),null!=t&&(this.isOn=t),this.TYPE=w.TYPE_NAME}}w.TYPE_NAME="dapan";class A extends v{do(t){return this.match(t,i.Constants.HUONGDAN_PATTERN)}constructor(t){super(),null!=t&&(this.isOn=t),this.TYPE=A.TYPE_NAME}}A.TYPE_NAME="huongdan";class j extends v{do(t){let s=t.replace(/\|/g,"").trim();if(/^\[@[^!\]]+\]([\.,]\[[^\]!]+\])*$/.test(s)){let t=s;return t=t.replaceAll(/\[@([CTQG]\d+):[^\]]*\]/g,"$1").replaceAll(/\[@(F:[^\]]*)\]/g,"$1").replaceAll(/\[[^\]\d]+(\d+)[^\]\d]+\]/g,"$1").replaceAll(/\[[^\]]+\]/g,""),[{type:this.TYPE,pos:[0,0],label:"@@."+t}]}return[]}constructor(t){super(),null!=t&&(this.isOn=t),this.TYPE=j.TYPE_NAME}}j.TYPE_NAME="include";class P{setCallback(t){}setApiCache(t){}setLoadingManager(t){this.loadingManager=t}loadImage(t,s){return new Promise((n,i)=>{let l=r(10);this.loadingManager.set(l,t),(0,o.dr)(t,s).then(t=>{n(t),this.loadingManager.delete(l)}).catch(()=>{this.loadingManager.delete(l),i(Error())})})}loadImageToBase64(t,s){return new Promise((n,i)=>{let l=new Image;l.crossOrigin="anonymous",l.setAttribute("count","1");let a=r(10);this.loadingManager.set(a,t),l.onload=()=>{var t;let s=document.createElement("canvas");s.width=l.width,s.height=l.height,null===(t=s.getContext("2d"))||void 0===t||t.drawImage(l,0,0,l.width,l.height,0,0,s.width,s.height);let i=this.isCropImage?e.rj.cropCanvas(s):s;n("<img id='".concat(a,"' class='img-docx' alt='error...' src='").concat(i.toDataURL(),"' style='width: ").concat(i.width*this.ratioImage,"px;height: auto'>")),this.loadingManager.delete(a)},l.onerror=()=>{this.loadingManager.delete(a);let n=l.getAttribute("count");n&&1==Number(n)?(l.src=s.getMyCdn(t),l.setAttribute("count","2")):n&&5>Number(n)?(l.setAttribute("count",n+1),l.src=s.getRawCdnLink(t)+"?t="+new Date().getTime()):i(Error())},l.src=s.getRawCdnLink(t)})}constructor(){this.isCropImage=!0,this.loadingManager=new Map,this.ratioImage=.65}}class y extends P{render(t,s,n){if(t.trim().startsWith("[@"))return t;let i=t,r=this.chemBase.join("|"),l=RegExp("(?:[\\s,.:;\"'=–\\-\\/\\+\\?<>]|^)\\(?\\d*(".concat(r,")+\\d*(").concat(r,"|\\d+|\\(|\\))*(?:(?=[\\s,.:;\"'=–\\-\\/\\+\\?<>])|\\(\\w+\\)|$)"),"g"),a=i.matchAll(l),h=[];for(;;){let t=a.next();if(t.done)break;let s=0==t.value.index?t.value[0]:t.value[0].substring(1);s.replace("(","").replace(")","").length<=1||h.push({s:0==t.value.index?0:t.value.index+1,len:s.length,val:this.autoFormat(s)})}if(h.sort((t,s)=>t.s>s.s?-1:1),h.filter(t=>/\d+/.test(t.val)).length>0)for(let t of h)i=i.substring(0,t.s)+"\\("+t.val+"\\)"+i.substring(t.s+t.len);return i}autoFormat(t){return t.replaceAll(/([^\(])(\d+)/g,"$1_{$2}")}constructor(){super(...arguments),this.chemBase=["H","He","Li","Be","B","C","N","O","F","Ne","Na","Mg","Al","Si","P","S","Cl","Ar","K","Ca","Sc","Ti","V","Cr","Mn","Fe","Co","Ni","Cu","Zn","Ga","Ge","As","Se","Br","Kr","Rb","Sr","Y","Zr","Nb","Mo","Tc","Ru","Rh","Pd","Ag","Cd","In","Sn","Sb","Te","I","Xe","Cs","Ba","La","Ce","Pr","Nd","Pm","Sm","Eu","Gd","Tb","Dy","Ho","Er","Tm","Yb","Lu","Hf","Ta","W","Re","Os","Ir","Pt","Au","Hg","Tl","Pb","Bi","Po","At","Rn","Fr","Ra","Ac","Th","Pa","U","Np","Pu","Am","Cm","Bk","Cf","Es","Fm","Md","No","Lr","Rf","Db","Sg","Bh","Hs","Mt","Ds","Rg","Cn","Nh","Fl","Mc","Lv","Ts","Og"]}}class N extends P{render(t,s,n){if(0>t.indexOf("[img:"))return t;let i=t,l=i.matchAll(/\[img:\$[a-zA-Z0-9_]+\$\]/g);for(;;){let t=l.next();if(t.done)break;let n=t.value[0],h=n.replace("[img:$","").replace("$]","");if(s){let t=s.find(t=>t.id===h);if(t){var a;let s=document.createElement("img");s.id=h,s.classList.add(0===h.indexOf("af")?"qv_full_a_img":0===h.indexOf("f")?"qv_full_img":"qv_img"),s.crossOrigin="anonymous",s.style.cssText=null!==(a=t.cssStyle)&&void 0!==a?a:"";let l=r(10),c=t.link;s.classList.add("quill-image"),this.loadingManager.set(l,c),s.onload=()=>{this.loadingManager.delete(l)},s.onerror=()=>{this.loadingManager.delete(l)},s.src=c,i=i.replace(n,s.outerHTML)}}}return i}cssStringToJSON(t){for(var s={},n=t.split(";"),i=0;i<n.length;i++){var r=n[i].split(":");if(2===r.length){var l=r[0].trim(),a=r[1].trim();s[l]=a}}return s}constructor(t){super(),this.cdnService=t}}class _ extends P{render(t,s,n){let i=t,r=i.matchAll(/\[\*?[A-H]:[^\]]+\]/g);for(;;){let t=r.next();if(t.done)break;let s=t.value[0],n=s.substring(1,s.length-1).split(":");2==n[0].length&&(n[0]=n[0].substring(1)),i=i.replace(s,"<span class=\"qv_string_eng_ans\" style='cursor: pointer;padding: 0 5px;font-weight: bold;text-decoration: underline;position: relative;height: 40px;display: inline-block;'>".concat(n[1]," <span style='position: absolute;top: 20px;left: 45%;'>").concat(n[0],"</span></span>"))}return i}revert(t,s){let n=t;return(n=n.replaceAll(/<span class="qv_string_eng_ans"[^>]+>([^><]+)<span[^>]+>([^><]+)<\/span><\/span>/g,"[$2:$1]")).replace("["+s+":","[*"+s+":")}}class S extends P{trimWithBr(t){for(t=t.trim();/^<br>|<br>$/.test(t);)t=t.replace(/^<br>|<br>$/,"").trim();return t}render(t){let s=t,n=s.split("<br>"),i=0,r=/\[![!aibucsbphl]+:!!\]/;for(let t of n){if(r.test(t)){let s=t.split(":!!]")[0].split("["),l=s[s.length-1].split(":")[0];n[i]=t.startsWith("[*")?"[* ["+l+":$"+t.replace(r,"$]").substring(2):"["+l+":$"+t.replace(r,"$]")}i++}let l=(s=(s=n.join("<br>")).replaceAll(/\[![!aibucsbphl]+:\$\$\]/g,"")).matchAll(/\[![!aibucsbphl]+:\$(([^\$]|\$[^\]])+)\$\]/g);for(;;){let t=l.next();if(t.done)break;let n=t.value[0],i=t.value[1],r=n.split(":")[0].split("!");r.shift(),r.filter(t=>"a"==t).length>0&&(i=i.toUpperCase());for(let t=r.length-1;t>=0;t--){let s=r[t];i="hl"==s||"cl"==s?i:"<".concat(s,">").concat(i,"</").concat(s,">")}s=s.replace(n,i)}return this.trimWithBr(s)}}class L extends P{render(t,s,n){let i=t;for(let t of[[/([^<])-+([^\-><]+)-+>/g,"$1\\( \\xrightarrow[]{$2} \\)"],[/<-+([^\-><]+)-+([^>])/g,"\\( \\xleftarrow[]{$1} \\)$2"],[/([^<])--+>/g,"$1\\( \\longrightarrow \\)"],[/<--+([^>])/g,"\\( \\longleftarrow \\)$1"],[/<-+>/g,"\\( \\longleftrightarrow \\)"],[/([^<])->/g,"$1\\( \\rightarrow \\)"],[/<-([^>])/g,"\\( \\leftarrow \\)$1"]])i=i.replaceAll(t[0],t[1]);return i}}class Z extends P{render(t,s,n){let i=t.split("<br>"),r=[],l=[];for(let t of i)if(t.trim().startsWith("[*")&&t.trim().endsWith("*]")){let s=t.replaceAll("\\n","<br>").replaceAll("[*","<tr><td>").replaceAll("*]","</td></tr>");s=s.replaceAll("|","</td><td>"),l.push(s)}else l.length>0&&(r.push('<table class="q-table">'+l.join("")+"</table>"),l=[]),r.push(t);return l.length>0&&r.push('<table class="q-table">'+l.join("")+"</table>"),r.join("<br>")}}class k extends P{render(t,s,n){return this.bypassChild(t).replaceAll(/\\\)\s*\\\(/g,"")}bypassChild(t){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"\\(",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"\\)";if(s.length!==n.length)return"";let i=[],r=0;for(;;){let n=t.indexOf(s,r);if(-1===n)break;i.push("s_"+n),r=n+1}for(r=0;;){let s=t.indexOf(n,r);if(-1===s)break;i.push("e_"+s),r=s+1}i.sort(function(t,s){return parseInt(t.substr(2))-parseInt(s.substring(2))});let l=[],a=[];return i.forEach(t=>{if("s"===t.substring(0,1))l.push(parseInt(t.substring(2)));else if(1==l.length)l=[];else{let s=l.pop();if(s){let n=parseInt(t.substring(2));a.push(s),a.push(n)}}}),a.sort(function(t,s){return t-s}).reverse().forEach(n=>{t=t.substring(0,n)+t.substring(n+s.length)}),t}}class R extends P{getSimilar(t,s,n){var i;let r=fe.G.generateIdRequired(10);return this.loadingManager.set(r,t),null===(i=this.discoveryService)||void 0===i||i.apiDiscoveryQuestionsInfoPost({text:t,maxRate:.99}).subscribe(t=>{let s=[];1===t.success&&t.data&&t.data.objs&&t.data.objs.length>0&&(s=t.data.objs),this.apiCallbackCache=new Map;let n=0;for(let t of s){let t={i:n,call:this.callBack,err:this.onError};n++;let s=this.apiCallbackCache.get(r);s?s.push(t):this.apiCallbackCache.set(r,[t])}0==s.length&&this.onError&&this.onError("NO_DATA"),setTimeout(()=>{this.processApiResponse(s,r,!1)},400),this.loadingManager.delete(r)}),"Loading...|0"}render(t,s,n){var r,l,a,h;let c=t.split("<br>")[0].trim(),d=c.split("=>"),u=d.length>1?+d[1].split("-")[1]:0,p=d.length>1?+d[1].split("-")[0]:0;if(!this.callBack||!/^\[@[CTGK][\-\d]+:[^\]]+\]([\.,]\[[^\]]+\])+$/.test(d[0].trim())&&!/^\[@Q[\-\d]+:[^\]]+\](\s*,\s*\[@Q[\-\d]+:[^\]]+\])*$/.test(d[0].trim()))return t;let x=d[0]+"=>"+p,g=i.Utils.parseInclude(c);if(this.apiDataCache){let t=this.apiDataCache.get(c);if(t&&this.callBack)return setTimeout(()=>{t&&this.callBack&&this.callBack(t)},50),"Loading...|"+g.questId.join(",")}if(this.apiCallbackCache){let t={i:u,call:this.callBack,err:this.onError},s=this.apiCallbackCache.get(x);if(s)return s.push(t),"Loading...|"+g.questId.join(",");this.apiCallbackCache.set(x,[t])}let f=this.loadedQuestIds&&0==g.questId.length?this.loadedQuestIds:[],v=!1;0==g.getNum&&g.groupId.length>0&&(v=!0,g.getNum=1,f=g.questId.length>0?f:[]),this.getOne&&g.getNum&&g.getNum>1&&(g.getNum=1);let b=fe.G.generateIdRequired(10),E=null===(r=this.matrixData)||void 0===r?void 0:r.filter(t=>t.key==x)[0];if(E)setTimeout(()=>{var t;this.processApiResponse(null!==(t=null==E?void 0:E.questions)&&void 0!==t?t:[],x,v)},400);else{this.loadingManager.set(b,c);let t={exceptQuestionIds:f,matrix:[]};null===(l=t.matrix)||void 0===l||l.push({number:g.getNum,key:x,paths:g.paths.map(t=>({type:t.type,id:t.id,groupIds:t.groupIds,tags:t.tags,answerTypes:t.answerTypes}))});let s=(null===(a=t.matrix)||void 0===a?void 0:a.filter(t=>{var s;return null!==(h=null===(s=t.paths)||void 0===s?void 0:s.filter(t=>"KNOWLEDGE"==t.type).length)&&void 0!==h&&h}).length)?null==n?void 0:n.apiQuestionsMatrixGlobalPost(t):null==n?void 0:n.apiQuestionsMatrixPost(t);s&&s.subscribe(t=>{let s=[];1===t.success&&t.data&&t.data[0]&&t.data[0].questions&&t.data[0].questions.length>0&&(s=t.data[0].questions),setTimeout(()=>{this.processApiResponse(s,x,v)},400),this.loadingManager.delete(b)})}return"Loading...|"+g.questId}setGetOne(t){this.getOne=t}processApiResponse(t,s,n){var i,r,l,a,h,c;let d=null!=t?t:[],u=null===(i=this.apiCallbackCache)||void 0===i?void 0:i.get(s);if(u)for(let t of u){let i=this.getOne?0:t.i;if(d.length<=i){t.err&&t.err(this.trans.err_empty_quest);continue}let r=d[i],u=this.commonService.willDeleteParseJson(null!==(l=r.content)&&void 0!==l?l:"[]"),p={type:"bank",sourceId:r.id};if(u&&u.length>0&&u[0].vMetaEditor&&(p.heightLabel=u[0].vMetaEditor.heightLabel),n){let n=this.commonService.willDeleteParseJson(r.content||"[]"),i="",l={renderedStr:i,label:"",quest:{label:0,isGroup:!0,parts:[],answers:[]},answers:[],isFixGroup:"1"===r.groupType,meta:p};if(1==r.isImage&&n[0].groupUrl){let s=fe.G.generateIdRequired(10);this.loadingManager.set(s,n[0].groupUrl),this.loadImage(n[0].groupUrl,this.cdnService).then(n=>{var i;let r=document.createElement("canvas");r.width=n.width,r.height=n.height,null===(i=r.getContext("2d"))||void 0===i||i.drawImage(n,0,0,n.width,n.height);let a=document.createElement("img");a.src=r.toDataURL(),a.classList.add("qv_img-group-content"),l.renderedStr=a.outerHTML,t.call(l),this.loadingManager.delete(s)}).catch(n=>{l.renderedStr="Load image error",t.call(l),this.loadingManager.delete(s)})}else i=null!==(a=n[0].groupContent)&&void 0!==a?a:"",l.renderedStr=i,t.call(l);this.apiDataCache&&this.apiDataCache.set(s+"-"+t.i,l);continue}let x=4==r.answerType&&r.answerResult?this.commonService.willDeleteParseJson(r.answerResult):[],g="text";if(1===r.isImage&&(g=this.commonService.willDeleteParseJson(r.content||"")[0].url?"image":g),"image"===g){let n=this.commonService.willDeleteParseJson(r.content||""),i=n[0].metaData,l={renderedStr:"",label:"",attachments:r.attachments,quest:{isFixAns:1==r.isFixAns,label:0,parts:[],answers:i&&i.answers?i.answers.map(t=>{var s;return{label:t.label,isCorrect:-1!==(null===(s=r.answerResult)||void 0===s?void 0:s.indexOf(t.label)),parts:[]}}):(null!==(c=this.commonService.willDeleteParseJson(null!==(h=r.answerConfig)&&void 0!==h?h:"").answer)&&void 0!==c?c:[]).map(t=>{var s;return{label:t,isCorrect:-1!==(null===(s=r.answerResult)||void 0===s?void 0:s.indexOf(t)),parts:[]}})},strAns:x.length>0?x:void 0,answers:[],v:i?"pdf-2-0":"pdf-1-0",id:r.id,meta:p};l.originCorrectAns=l.quest.answers.filter(t=>t.isCorrect).map(t=>t.label).join(),r.tags&&(l.tag=r.tags.map(t=>({id:t.id,code:t.code,viName:t.viName,enName:t.enName})));let a=fe.G.generateIdRequired(10);this.loadingManager.set(a,n[0].url),this.loadImage(n[0].url,this.cdnService).then(i=>{this.processImageQuestion(i,n,l),r.answerMedia?this.loadImageToBase64(r.answerMedia,this.cdnService).then(s=>{l.helpRenderedStr=s,t.call(l)}):t.call(l),this.apiDataCache&&this.apiDataCache.set(s+"-"+t.i,l),this.loadingManager.delete(a)}).catch(s=>{l.renderedStr="Load image error",t.call(l),this.loadingManager.delete(a)})}else{let n=this.commonService.willDeleteParseJson(r.content||"[]"),i=this.commonService.willDeleteParseJson(r.answerConfig||"[]"),l={renderedStr:"",label:"",attachments:r.attachments,quest:{isFixAns:1==r.isFixAns,label:0,parts:[],answers:i?i.map(t=>{var s;return{label:t.key,isCorrect:-1!==(null===(s=r.answerResult)||void 0===s?void 0:s.indexOf(t.key)),parts:[]}}):[]},strAns:x.length>0?x:void 0,answers:[],v:"docx",id:r.id,meta:p};l.originCorrectAns=l.quest.answers.filter(t=>t.isCorrect).map(t=>t.label).join(),n.length>0&&(l.renderedStr=n[0].content),r.answerMedia&&(l.helpRenderedStr=r.answerMedia),r.tags&&(l.tag=r.tags.map(t=>({id:t.id,code:t.code,viName:t.viName,enName:t.enName}))),l.answers=l.quest.answers.map((t,s)=>({renderedStr:i[s].content,ans:t})),this.apiDataCache&&this.apiDataCache.set(s+"-"+t.i,l),t.call(l)}}null===(r=this.apiCallbackCache)||void 0===r||r.delete(s)}setCallback(t){this.callBack=t}setApiCache(t){this.apiCallbackCache=t}processImageQuestion(t,s,n){let i=s[0].metaData;if(i){let s={x:0,y:0,w:i.question.width,h:i.question.height},r=i.question.height;i.answers&&i.answers.forEach((i,l)=>{let a="";if(1!==i.width||1!==i.height){let n=this.cropImageWithPos({x:i.x,y:i.y,w:i.width,h:i.height},{x:i.remove.x,y:i.remove.y,w:i.remove.width,h:i.remove.height},t);n.classList.add("qv_ats_image"),r>i.y&&(s.h=i.y,r=i.y),a=n.outerHTML}n.answers.push({renderedStr:a,ans:n.quest.answers[l]})}),s.h<5&&(s.h=1,s.h=1);let l=this.cropImageWithPos(s,{x:i.question.remove.x,y:i.question.remove.y,w:i.question.remove.width,h:i.question.remove.height},t,!0);l.classList.add("qv_qts_image"),n.renderedStr=l.outerHTML,n.meta&&(n.meta.heightLabel=this.calculateHeightLabel(t,i.question.remove))}else n.renderedStr=t.outerHTML}cropImageWithPos(t,s,n,i,r){let l=document.createElement("canvas");l.width=t.w,l.height=t.h;let a=l.getContext("2d"),h=document.createElement("img");null==a||a.drawImage(n,t.x,t.y,t.w,t.h,0,0,t.w,t.h),a&&(a.fillStyle="#fff"),null==a||a.fillRect(s.x-t.x,s.y-t.y,s.w,s.h);let c=tn.rj.cropCanvas(l,void 0);return r?c:(h.src=c.toDataURL(),h.style.width=c.width*this.ratioImage+"px",h)}calculateHeightLabel(t,s){return this.cropImageWithPos({x:s.x,y:s.y,w:s.width,h:s.height},{x:0,y:0,w:0,h:0},t,!1,!0).height}constructor(t,s,n,i,r,l,a,h,c,d){super(),this.cdnService=t,this.commonService=s,this.callBack=n,this.apiCallbackCache=i,this.editor=r,this.onError=l,this.loadedQuestIds=a,this.apiDataCache=h,this.matrixData=c,this.discoveryService=d,this.getOne=!1,this.trans={err_empty_quest:""},this.trans.err_empty_quest="lang_auto_khong_tai_duoc_cau_hoi_tu_ngan_hang"}}class M extends P{render(t,s,n,i){if(0>t.indexOf("@[]"))return i&&i(),t;let r,l=/@\[\]\{[^@]+\}@\[\]/g,a=t,h=new Map;for(;null!==(r=l.exec(t));){var c;let t=r[0],s=t.split("@[]")[1],n=this.commonService.willDeleteParseJson(s),i=n.link,l=m.G.generateIdRequired(10);a=a.replace(t,"<div id='".concat(l,"' class='img-docx skeleton-box-loading' style='width: ").concat(n.data.width*this.ratioImage,"px;height: ").concat(n.data.height*this.ratioImage,"px'></div>")),h.has(i)?null===(c=h.get(i))||void 0===c||c.push({id:l,data:n.data}):h.set(i,[{id:l,data:n.data}])}return this.startLoadImage(h).then(()=>{i&&i()}).catch(t=>{this.callbackFall&&this.callbackFall(t)}),a}startLoadImage(t){return new Promise((s,n)=>{var i=0;t.size>0?t.forEach((r,l)=>{this.loadImage(l,this.cdnService).then(l=>{if(this.processImageQuestion(l,r,n),this.loadingManager.delete(l.id),this.callBack)for(let t of r)this.callBack(t.id,t.renderStr);++i===t.size&&s()}).catch(()=>{let t=l.split("/");n(new O("LOAD_IMAGE",[t[t.length-1]],"lang_testbank_render_cant_download_the_image"))})}):s()})}processImageQuestion(t,s,n){s.forEach(s=>{try{var i;let n=document.createElement("canvas");s.data.width=-1===s.data.width?t.width:s.data.width,s.data.height=-1===s.data.height?t.height:s.data.height,n.width=s.data.width,n.height=s.data.height,null===(i=n.getContext("2d"))||void 0===i||i.drawImage(t,s.data.x,s.data.y,s.data.width,s.data.height,0,0,n.width,n.height);let r=this.isCropImage?e.rj.cropCanvas(n):n;r=this.isCanvasEmpty(r)?n:r,s.renderStr="<img id='".concat(s.id,"' class='img-docx' alt='error...' src='").concat(r.toDataURL(),"' style='width: ").concat(r.width*this.ratioImage,"px;height: auto'>")}catch(i){let s=t.src;return void n(new O("CROP_IMAGE",[s[s.length-1]],"Kh\xf4ng cắt được nội dung trong h\xecnh ảnh"))}})}isCanvasEmpty(t){let s=document.createElement("canvas");return s.width=t.width,s.height=t.height,t.toDataURL()===s.toDataURL()}constructor(t,s,n,i,r){super(),this.cdnService=t,this.commonService=s,this.configRenderService=n,this.callBack=i,this.callbackFall=r}}class O{constructor(t,s,n,i){this.type=t,this.data=s,this.message=n,this.questionNumber=i}}class H extends P{convertMath(t){var s=t.replace(/\>(log|tan)\</g,">\\$1<").replace(//g,"");return document.createElement("span").innerHTML=t,MathML2LaTeX.convert(s)}render(t,s,n){let i=t,r=i.matchAll(/\[!m:\$(([^\]]|[^\$]\])+)\$\]/g);for(;;){let t=r.next();if(t.done)break;let s=t.value[0],n=t.value[1],l=this.mathMap.get(n),a="",h=document.createElement("span");h.classList.add("ql-formula"),h.setAttribute("data-value",this.convertMath(l.str)),a=h.outerHTML,i=i.replace(s,a)}return i}constructor(t){super(),this.mathMap=t}}t.exports=class{parseDocx(t){this.getLstQuestWithFile(t,[]).then(t=>{this.convertDocx(t)})}convertDocx(t){let{lstQuest:s}=t,n=[],i=[];s.forEach((t,s)=>{let{quest:l}=t;if(l.isGroup)n.push({id:r(7),quizId:this.quizId,questions:[],content:t.renderedStr,title:"",audios:[]});else{var a,h;n.length||l.group||n.push({id:r(7),quizId:this.quizId,questions:[],content:"",title:"",audios:[]});let s=n[l.group-1||0],c={id:r(7),content:"<p>".concat(t.renderedStr,"</p>"),quizId:this.quizId,groupId:s.id,label:"C\xe2u",number:l.label,type:1==t.type?"TN":"TL",options:t.answers.map(t=>({text:"<p>".concat(t.renderedStr,"</p>"),keys:t.ans.isCorrect})),explain:"<p>".concat(t.helpRenderedStr||"","</p>"),level:t.tag,shuffle:!!l.isFixAns};t.answers.filter(t=>t.ans.isCorrect).length>1&&(c.type="HK"),t.answers.filter(t=>{var s;return(null===(s=t.ans.label)||void 0===s?void 0:s.charCodeAt(0))>=97}).length&&(c.type="TF"),/(^\d.*\d$|^\d$)/g.test(null==t?void 0:null===(a=t.helpRenderedStr)||void 0===a?void 0:a.trim())&&(c.type="DT",c.explain="",c.options=[{text:null==t?void 0:null===(h=t.helpRenderedStr)||void 0===h?void 0:h.trim()}]),s.questions.push(c.id),i.push(c)}}),i=i.map((t,s,n)=>{var r=0;return"TF"==t.type&&(r=1),"TN"==t.type&&(r=.25),"DT"==t.type&&(18==n.filter(t=>"TN"==t.type).length&&(r=.25),12==n.filter(t=>"TN"==t.type).length&&(r=.5)),i.length===n.filter(t=>"TN"==t.type).length&&(r=(10/i.length).toFixed(2)),{...t,point:r}}),this.callback({status:"done",data:{groups:n,questions:i,quizId:this.quizId}})}getLstQuestWithFile(t,s,n){return new Promise((r,d)=>{let u=new l,p=[],x=new Map,g=[],f=[],v=1;u.handleFileSelect(t,t=>{for(let s of t.data)if("img"==s.type)p.push({id:s.key,link:s.value,cssStyle:s.cssStyle}),s.cssStyle&&s.cssStyle.split(";").length>2&&g.push(["^\\[img:\\$".concat(s.key,"\\$\\]"),"[img:$".concat(s.key,"$]\n")]);else if("mathml"==s.type){let t=+s.key.split("_")[1];x.set(s.key,{id:t,str:s.value,raw:s.docx,lineIdx:0,startCol:0,endCol:0}),t>v&&(v=t)}for(let s of(v++,t.lines)){if(0==s.length)continue;let t="";for(let n of(t=Array.isArray(s[0])&&Array.isArray(s[s.length-1])&&Array.isArray(s[Math.floor(s.length/2)])?"[* "+s.map(t=>t.map(t=>t.join("").replaceAll("\n","\\n")).join("\\n")).join(" | ")+" *]":s.join(""),g))t=t.replaceAll(RegExp(n[0],"g"),n[1]);for(let s of t.split("\n"))f.push(s)}new h().process(f);let l=this.processStyle(f);this.processMath(l,x),new a().process(l);let d=new c(this.cropPdfParams);d.setLines(l);let u=d.parse(),b=new i.Task(8);for(let t=0;t<u.length;t++)b.addTask(this,this.renderQuest,[s,x,p,u[t],t,n]);b.start().then(t=>{setTimeout(()=>{r({lstQuest:s,mathMap:x,images:p})},10*p.length)})})})}processLevel(t){let s=/^\s*#(\d)\s*\[[A-Z0-9\-\[\]\$!:b]+\]/g,n=["NB","TH","VD","VDC"],i=0,r=!1,l=1;for(let a of t){let h=a.matchAll(s).next();if(!h.done){let s=+h.value[1]-1;s<n.length&&(t[i]=a.replace(h.value[0],"C\xe2u ".concat(l++,". (").concat(n[s],")"))),r=!0}r&&"GY"==a.trim()&&(t[i]="Lời giải"),i++}}hasStyleAns(t,s,n){if(!s)return"";for(let t of n.filter(t=>t.lineIdx==s.lineIdx&&t.s<=s.b&&t.e>=s.b))if(t.style.indexOf("!u")>=0||t.style.indexOf("!b")>=0||t.style.indexOf("!hl")>=0)return t.style;return""}applyStyle(t,s,n){for(let r=s.length-1;r>=0;r--){let l=s[r],a=n.filter(t=>t.lineIdx==l.lineIdx&&t.e>=l.s);for(let s=a.length-1;s>=0;s--){var i;let n=a[s].s>=l.s?a[s].s:l.s,r=a[s].e<=(null!==(i=l.e)&&void 0!==i?i:9999999)?a[s].e:l.e,h=a[s].style.replaceAll("!hl","");if(n<r&&""!=h){let s=t[l.lineIdx],i=s.substring(n,r);""!=i.trim()&&(t[l.lineIdx]=s.substring(0,n)+"["+h+":$"+i+"$]"+s.substring(r))}}}}processUnderlineAns(t){let s=/\[[!bihl]*[!u]+[!bihl]*:\$(([^\$]|\$[^\]])+)\$\]/g,n=0,i=[];for(let r of t){if(/^[ABCD\.\s\t\*]+$/.test(r)&&""!=r.trim()&&n>0){let l=r,a=(l=l.replaceAll(/[\s\t\.]+/g,"")).indexOf("*"),h=0;if(l=l.replaceAll(/[\*]+/g,""),"ABCDEFGH".indexOf(l)>=0){let r=t[n-1].match(s);if(r&&l.length==r.length){for(let s of r)t[n-1]=t[n-1].replace(s,s.replace(/\[[!bihl]*[!u]+[!bihl]*:\$/g,"[".concat(a==h?"*":"").concat(l.substring(0,1),":")).replace("$]","]")),i[i.length-1]=t[n-1],l=l.substring(1),h++;n++;continue}}}i.push(r),n++}return i}processStyle(t){var s;let n=/\[![!ibuchl]+:\$(([^\$]|\$[^\]])+)\$\]/g,i=/^\s*\[\*\s*[AC]\.[^\|]+\|\s*[BD]\..*\*\]\s*$/g,r=[],l=0;for(let s of t){if(i.test(t[l].replaceAll(n,"$1"))&&(t[l]=t[l].replaceAll("[*","").replaceAll("*]","").replaceAll("|"," ").trim(),s=t[l]),s){let i,a=s.matchAll(n),h=0;for(;;){let t=a.next();if(t.done)break;let s=t.value[0],n=s.indexOf(":"),c=s.substring(1,n),d=t.value.index-h,u=d+t.value[1].length;i&&d==i.e&&i.style==c?i.e=u:(i={lineIdx:l,s:d,e:u,style:c},r.push(i)),h+=n+4}t[l]=s.replaceAll(n,"$1")}l++}let a=new c(this.cropPdfParams);a.setLines(t);let h=a.parse(),d=[],u=new Map,p=0;for(let s of h){for(let t of(p++,s.parts))d.push(t);for(let n of s.answers){let i=this.hasStyleAns(t,n.parts[0],r);for(let t of(""!=i&&u.set("".concat(s.label,"-").concat(s.group,"-").concat(n.label,"-").concat(p),i),n.parts))d.push(t)}}for(let t of h)if(t.help)for(let s of t.help)d.push(s);this.applyStyle(t,d,r),a.setLines(t);let x=[];for(let t of(p=0,h=null!==(s=a.parse())&&void 0!==s?s:[])){p++;let s=new Map;if(!(t.answers.filter(t=>t.isCorrect).length>0)){for(let n of t.answers){let i=u.get("".concat(t.label,"-").concat(t.group,"-").concat(n.label,"-").concat(p));i&&""!=i&&s.set(i,s.has(i)?void 0:n.parts[0])}for(let t of s)if(t[1]){x.push(t[1]);break}}}for(let s=x.length-1;s>=0;s--){let n=x[s];t[n.lineIdx]=t[n.lineIdx].substring(0,n.b)+"*"+t[n.lineIdx].substring(n.b)}return t=this.processUnderlineAns(t),h.length>0?t.slice(h[0].parts[0].lineIdx):t}processMath(t,s){let n=0;for(let i of t){let t=i.matchAll(this.MATH_PAT);for(;;){let i=t.next();if(i.done)break;let r=i.value[0],l=s.get(i.value[1]);l&&(l.lineIdx=n+1,l.startCol=i.value.index+1,l.endCol=l.startCol+r.length)}n++}}getLoadedIds(t){var s;return t.filter(t=>t.id&&t.id>0).map(t=>null!==(s=t.id)&&void 0!==s?s:0)}getIncludeIds(t,s){return[]}renderStr(t,s,n,i,r,l,a,h){let c=!(arguments.length>8)||void 0===arguments[8]||arguments[8],d=c?i.replaceAll(/<([\/!a-zA-Z])/g,"&lt;$1").replaceAll(/&lt;([ubi])>/g,"<$1>").replaceAll(/&lt;[\/]([ubi])>/g,"</$1>").replaceAll("&lt;br>","<br>").replaceAll("<&lt;","&lt;&lt;").replaceAll("<&lt;","&lt;&lt;").replaceAll("<&lt;","&lt;&lt;"):i,u=[new y,new N(this.cdnService),new _,new S,new L,new Z,new H(s),new k,new M(this.cdnService,this.commonService,this.configRenderService,l),new R(this.cdnService,this.commonService,a,this.apiCallbackCache,this.aztEditor,h,this.getIncludeIds(t),this.apiDataCache,this.matrixLoadedData)];for(let t of("link"==r&&(u=[new M(this.cdnService,this.commonService,this.configRenderService,l)]),"help"==r&&u.pop(),u))t.setLoadingManager(this.loadingManager),d=t.render(d,n,this.questionService);return d}upperFirst(t){return t?t.charAt(0).toUpperCase()+t.slice(1):""}parseExtra(t){if(t.startsWith("[@"))return{val:"",idx:0,id:t};let s=t.matchAll(/\[!info:\d+\]/g),n="",i=0;for(;;){let t=s.next();if(t.done)break;n=t.value[0],i=t.value.index;break}if(""==n)return{val:"",idx:0,id:"0"};let r=n.replace("[!info:","").replace("]","").trim();return{val:n,idx:i,id:r}}fillImg(t,s,n,i){let r=RegExp("<div id='"+n+"'[^>]+></div>","g"),l=t[s];for(let t of(l.renderedStr=l.renderedStr.replace(r,null!=i?i:""),l.answers))t.renderedStr=t.renderedStr.replace(r,null!=i?i:"");l.helpRenderedStr&&(l.helpRenderedStr=l.helpRenderedStr.replace(r,null!=i?i:""))}fillError(t,s,n){t[s].err="<span style='color:red'>".concat(n,"</span>")}parseTag(t){let s=t.trim(),n=s.matchAll(/^(\[!info:\d+\]\s*)?(\[[iubchl!]+:\$\s*)?[\[\(]\s*(VD|TH|NB|VDC|EASY|MEDIUM|HARD|HARDEST)\s*[\d\.]*\s*[\)\]]/g).next();return n.done?["",s]:(s=s.replace(/[\[\(]\s*(VD|TH|NB|VDC|EASY|MEDIUM|HARD|HARDEST)\s*[\d\.]*\s*[\)\]]\s*[:.]?/g," "),[n.value[3],s])}renderQuest(t,s,n,i,r,l){return new Promise(a=>{var h,c,d,u;let p=3;i.answers.length>0&&(p=1),0==i.answers.length&&i.strAns&&(p=4);let x=(s,n)=>{console.log("nvanh fill image ",t.length,s,n),this.fillImg(t,r,s,n)},g=t=>{console.log("nvanh fill quest ",r,t)},f=s=>{this.fillError(t,r,s)},v=i.parts.map(t=>null!==(h=t.text)&&void 0!==h?h:"").join("<br>").trim(),b=this.parseExtra(v),E=this.parseTag(v);""!=E[0]?v=E[1]:i.help&&i.help.length>0&&(E=this.parseTag(null!==(c=i.help[0].text)&&void 0!==c?c:"")),""!=b.val&&(v=v.substring(0,b.idx)+v.substring(b.idx+b.val.length));let T=i.help?i.help.map(t=>null!==(d=t.text)&&void 0!==d?d:"").join("<br>").trim():void 0,C={renderedStr:this.renderStr(t,s,n,v,"full",x,g,f),quest:i,type:p,tag:E[0]||"",strAns:i.strAns?i.strAns.split(/[\|]/).map(t=>t.trim()):void 0,label:this.upperFirst(null!==(u=i.olabel)&&void 0!==u?u:""),helpRenderedStr:T?this.renderStr(t,s,n,T,"full",x,g,f):void 0,answers:i.answers.map(i=>{var r;let l=i.parts.map(t=>null!==(r=t.text)&&void 0!==r?r:"").join("<br>").trim();return{renderedStr:this.renderStr(t,s,n,l,"full",x,g,f),ans:i}})};if(C.renderedStr.startsWith("Loading...|")){let t=C.renderedStr.split("|");if(0>t[1].indexOf(",")){let s=+t[1];s>0&&(C.id=s)}C.renderedStr=t[0]}t[r]=C,l&&l(C),a(C)})}constructor(t,s){this.quizId=t,this.callback=s,this.loadingManager=new Map,this.MATH_PAT=/\[!m:\$([^\$\]]+)\$\]/g,this.cropPdfParams={RENDER_SCALE:2,LINE_SMALL_HEIGHT:8,SPLIT_MARGIN:3,INTERSEC_MARGIN:10,LINE_MAGIN:2,MARGIN_LEFT:2,ENABLE_IMAGE_PROCESS:!0,STEP_SIZE:3,CROP_FULL_WIDTH:!0,OVERLAP:.5,QUESTION_PATTERN:["(^c\xe2u\\s*\\d{1,4}[^0-9])","(^câu\\s*\\d{1,4}[^0-9])","(^c\xa9u\\s*\\d{1,4}[^0-9])","(^ca‚u\\s*\\d{1,4}[^0-9])","(^b\xe0i\\s*\\d{1,4}[^0-9])","(^bài\\s*\\d{1,4}[^0-9])","(^cau\\s*\\d{1,4}[^0-9])","(^bai\\s*\\d{1,4}[^0-9])","(^question\\s*\\d{1,4}[^0-9])","(^questions\\s*\\d{1,4}[^0-9])","(^\\[\\d{1,4}\\][^0-9])","(^\\d+\\s*\\(nb\\))","(^\\d+\\s*\\(th\\))","(^\\d+\\s*\\(vd\\))","(^\\d+\\s*\\(vdc\\))","(^c\xe2u\\s*\\d{1,4}[\\s\\.:]*$)","(^câu\\s*\\d{1,4}[\\s\\.:]*$)","(^c\xa9u\\s*\\d{1,4}[\\s\\.:]*$)","(^ca‚u\\s*\\d{1,4}[\\s\\.:]*$)","(^b\xe0i\\s*\\d{1,4}[\\s\\.:]*$)","(^bài\\s*\\d{1,4}[\\s\\.:]*$)","(^cau\\s*\\d{1,4}[\\s\\.:]*$)","(^bai\\s*\\d{1,4}[\\s\\.:]*$)","(^questions\\s*\\d{1,4}[\\s\\.:]*$)","(^question\\s*\\d{1,4}[\\s\\.:]*$)"],QUESTION_PATTERN2:["(^(\\d+\\s*\\.)\\s*[\\.0-9])","(^(\\d+\\s*\\.)\\s*\\(\\s*\\d+\\s*\\))","(^(\\d+\\s*\\.)\\s*[^\\s]\\s*[^\\s0-9])","(^\\d+\\s*\\.\\s*$)"],BREAK_LINE_PATTERN:["(^C\xe2u\\s*\\d+\\s*[:\\.]\\s*[Aa]\\s*\\.)","(^C\xa9u\\s*\\d+\\s*[:\\.]\\s*[Aa]\\s*\\.)","(^B\xe0i\\s*\\d+\\s*[:\\.]\\s*[Aa]\\s*\\.)","(^Cau\\s*\\d+\\s*[:\\.]\\s*[Aa]\\s*\\.)","(^Bai\\s*\\d+\\s*[:\\.]\\s*[Aa]\\s*\\.)","(^Question\\s*\\d+\\s*[:\\.]\\s*[Aa]\\s*\\.)","(^\\d+\\s*[:\\.]\\s*[Aa]\\s*\\.)"],SECTION_PATTERN_LOWER:["(^mark\\s*the\\s*letter)","(^read\\s*the\\s*follow)","(^reading\\s*the\\s*follow)","(^read\\s*the\\s*text)","(^read\\s*the\\s*passage)","(^read\\s*the\\s*paragraph)","(^read\\s*and\\s*choose)","(^put\\s*these\\s*word)","(^supply\\s*the\\s*correct)","(^make\\s*questions?\\s*for)","(^fill\\s*in\\s*the\\s*blank)","(^fill\\s*in\\s*each\\s*numbered)","(write\\s*the\\s*months\\s*in\\s*english)","(write\\s*the\\s*telephone\\s*numbers\\s*in\\s*english)","(^which\\s*of\\s*the\\s*following)","(^choose\\s*the\\s*suitable\\s*word)","(^choose\\s*the\\s*word)","(^choose\\s*the\\s*option)","(^choose\\s*the\\s*item\\s*among)","(^choose\\s*the\\s*underlined\\s*word)","(^combine\\s*two\\s*sentences)","(^each\\s*of\\s*the\\s*following)","(^finish\\s*the\\s*second\\s*sentence)","(^identify\\s*the\\s*underlined)","(^identify\\s*a\\s*mistake)","(^indicate\\s*the\\s*word)","(^indicate\\s*the\\s*correct)","(^indicate\\s*the\\s*sentence)","(^indicate\\s*the\\s*underlined)","(^circle\\s*the\\s*underlined)","(^circle\\s*the\\s*word\\s*whose\\s*underlined)","(^choose\\s*the\\s*underlined)","(^\\*?find\\s*the\\s*word)","(^find\\s*a\\s*mistake)","(^fill\\s*the\\s*circle)","(^listen\\s*to.*conversation)","(^there\\s*are.*blanks\\s*in\\s*the\\s*passage\\s*below)","(^listen\\s*to\\s*the\\s*recording)","(^listen\\s*and\\s*circle)","(^listen\\s*again\\s*and\\s*choose)","(^\\*?listen\\s*and\\s*complete)","(^\\*?choose\\s*the\\s*best)","(^choose\\s*the\\s*correct)","(^put\\s*in\\s*the\\s*correct)","(^complete\\s*the\\s*second\\s*sentence)","(^complete\\s*the\\s*sentences)","(^give\\s*the\\s*correct\\s*form)","(^mark\\s*a,\\s*b,)","(^circle\\s*the\\s*letter)","(^you\\s*will\\s*hear)","(^blacken\\s*the\\s*letter)","(^đọc\\s*đoạn\\s*tr\xedch)","(^dựa\\s*v\xe0o\\s*th\xf4ng\\s*tin\\s*dưới\\s*đ\xe2y)","(^dựa\\s*v\xe0o\\s*c\xe1c\\s*th\xf4ng\\s*tin\\s*được\\s*cung\\s*cấp\\s*dưới\\s*đ\xe2y)","(^section\\s*[0-9abcdefghivx]+)","(^part[^a-z]+[0-9abcdefghivx]+\\s*[\\.:\\-])","(^phần\\s*[0-9abcdefivx]+[\\.:])","(^nh\xf3m\\s*[0-9abcdefivx]+[\\.:])","(^chương\\s*[0-9abcdefivx]+[\\.:])","(^questions?\\s*\\d+\\s*[\\–\\-to]+\\s*\\d+)","(^passage\\s*[0-9abcdefghivx]+)","(^use\\s*the\\s*word\\s*given\\s*in\\s*capitals)","(^tự\\s*luận)"],SECTION_PATTERN_NORMAL:["(^[IVX]+\\s*[\\.\\-\\–]\\s*[A-Z\xc0Ả\xc3\xc1ẠĂẰẲẴẮẶ\xc2ẦẨẪẤẬĐ\xc8ẺẼ\xc9Ẹ\xcaỀỂỄẾỆ\xccỈĨ\xcdỊ\xd2Ỏ\xd5\xd3Ọ\xd4ỒỔỖỐỘƠỜỞỠỚỢ\xd9ỦŨ\xdaỤƯỪỬỮỨỰỲỶỸ\xddỴ]+)","(^[\\d]+\\.[\\d]+\\.[\\d]*\\.*\\s*[A-Z\xc0Ả\xc3\xc1ẠĂẰẲẴẮẶ\xc2ẦẨẪẤẬĐ\xc8ẺẼ\xc9Ẹ\xcaỀỂỄẾỆ\xccỈĨ\xcdỊ\xd2Ỏ\xd5\xd3Ọ\xd4ỒỔỖỐỘƠỜỞỠỚỢ\xd9ỦŨ\xdaỤƯỪỬỮỨỰỲỶỸ\xddỴ]+)","(^[IVX]+\\s*[\\.:]\\s*$)"],KICK_PATTERN:["(^Chọn\\s*[ABВCDEFGHIJK]+)","(^Chon\\s*[ABВCDEFGHIJK]+)"],TVCN_CHAR:[["Α","A"],["В","B"]],HET_PATTERN:["(HẾT)","(H\xcáT)","(HET)","(\\-\\-HT\\-\\-)","(THE\\s*END)","(The\\s*end[^a-z0-9]*$)","(^[^A-Za-z]*Hết[^A-Za-z]*)$"],DAPAN_PATTERN:["(\xc1P \xc1N)","(\xc1P \xc1)","(\xc1P\xc1N)","(ÁP ÁN)","(BẢNG\xc1\xc1)","(KHO\xc1\\s*C\xc2U\\s*TRẮC\\s*NGHIỆM)","(ÁPÁN)","(ANSWER KEYS)","(^KEYS$)","(Bảng\\s*đ\xe1p\\s*\xe1n)","(Đ\xe1p\\s*\xe1n\\s*v\xe0\\s*hướng)","(Dap\\s*an\\s*va\\s*huong)","(Đ\xe1p\\s*\xe1n\\s*[.:]\\s*$)","(Đ\xe1p\\s*\xe1n\\s*$)"],HUONGDAN_PATTERN:["(HƯỚNG\\s*DẪN)","(ƯỚNG\\s*DẪN\\s*GIẢI\\s*CHI)","(GIẢI\\s*TH\xcdCH\\s*CHI\\s*TIẾT)","(Hướng\\s*dẫn\\s*giải)","(Lời\\s*giải)","(LỜI\\s*GIẢI)","(GIẢI\\s*CHI\\s*TIẾT)","(HD:)","(GLOSSARY)","Lời\\sgiải"],MULTIPLE_ANS_PATTERN:["([ABCDEFGH]\\s*v\xe0\\s*[ABCDEFGH]\\s*đều)","(Cả\\s*[ABCDEFGH]\\s*v\xe0\\s*[ABCDEFGH])","(Cả\\s*[ABCDEFGH]\\s*,\\s*[ABCDEFGH])","(Cả\\s*3\\s*đ\xe1p\\s*\xe1n)","(Cả\\s*đ\xe1p\\s*\xe1n)","(Tất\\s*cả\\s*đ\xe1p\\s*\xe1n)","(Kết\\s*quả\\s*kh\xe1c)","(Đ\xe1p\\s*\xe1n\\s*kh\xe1c)","(Đ\xe1p\\s*\xe1n\\s*[ABCDEFGH]\\s*v\xe0\\s*[ABCDEFGH])","(Tất\\s*cả\\s*đều)"],DRAW_RESULT:"",SKIP_CHAR:["","√","p","(",")","[","]","{","}",""],FOOTER_PATTERN:["(trang\\s*\\d+)","(Page\\s*\\d+)","(Trang\\s*\\d+)","(TRANG\\s*\\d+)","(^\\d{1,4}$)","(^[\\-\\s]*\\d{1,4}[\\-\\s]*$)"],HELP_ANS_PATTERN:["([\\s\\.]*Chọn\\s*([A-K]))","([\\d\\s\\.:]*Đ\xe1p\\s*\xe1n\\s*([A-K]))","([\\d\\s\\.:]*Đ\xe1p\\s*\xe1n\\s*l\xe0\\s*([A-K]))","([\\d\\s\\.:]*Chọn\\s*đ\xe1p\\s*\xe1n\\s*([A-K]))"],RES_ANS_PATTERN:["(\\d+[.-][^|0-9])"],STRANS_SPLIT:"|/\\"}}}},9716:function(t,s,n){"use strict";Object.defineProperty(s,"__esModule",{value:!0});let i=n(1117);class r{on(){this.isOn=!0}off(){this.isOn=!1}process(t,s,n,i,r,l){return this.isOn?this.parse(t,s,n,i,r,l):[]}constructor(){this.isOn=!0,this.TYPE="default"}}class l extends r{parse(t,s,n,i,r,l){var a=this.matchPos(s.strLine);if(a.value){let t=null;for(let s=a.value.length-1;s>=0;s--)if(a.value[s]){t=a.value[s];break}if(null==t)return[];let i=t.matchAll(/\d+/g).next(),h=t.length;i.done||t.trim().endsWith(".")||t.trim().endsWith(":")||(h=i.value.index+i.value[0].length);let c=s.strLine.replace(/\|/g,"").toLowerCase().indexOf(t)+h-1;return[{str:this.getNumberFromStr(t),pageIndex:s.pageIndex,lineIndex:n,transform:s.transform,startLeft:v.calIndexPos2(s.textObjs,r,l,c,!0),type:this.TYPE}]}return[]}matchPos(t){let s=t.replace(/\|/g,"").toLowerCase().trim();if(0==this.questType){let t=i.PdfConst.QUESTION_PATTERN.join("|");return s.matchAll(t).next()}{let t=i.PdfConst.QUESTION_PATTERN2.join("|");return s.matchAll(t).next()}}getNumberFromStr(t){var s=t.match(/(\d+)/);return s?s[0]:""}static getRemoveBox(t,s){let n=t.startLeft?t.startLeft[5]:s[t.lineIndex].top,r=t.transform[4]-i.PdfConst.MARGIN_LEFT,l=t.startLeft?t.startLeft[5]+t.startLeft[3]:s[t.lineIndex].bottom;return{pageIndex:t.pageIndex,top:n||20,left:r,heigh:l&&n?l-n:0,width:(t.startLeft?t.startLeft[4]:0)-r}}static getBoxes(t,s,n,r){let l=r;for(let n=t.lineIndex;n<s.length;n++)if(v.isLastLineOfPage(n,s)){let t=s[n].isFooter?s[n-1]:s[n];l=t.transform[5]+t.height+20;break}let a=[],h=t.pageIndex,c=n?n.lineIndex:s.length-1,d=s[t.lineIndex].transform[4]-i.PdfConst.MARGIN_LEFT,u=s[t.lineIndex].top;if(!u)return[];let p=i.PdfConst.CROP_FULL_WIDTH?v.getMaxLineRight(-1,s)+2*i.PdfConst.MARGIN_LEFT:s[t.lineIndex].transform[4]+s[t.lineIndex].width+2*i.PdfConst.MARGIN_LEFT,x=l,g=h,f=t.lineIndex+1;for(;f<=c;f++){let t=s[f].top;if(f!=s.length-1||n||(t=s[f].bottom),!i.PdfConst.CROP_FULL_WIDTH){let t=s[f-1].transform[4]+s[f-1].width+2*i.PdfConst.MARGIN_LEFT;t>p&&(p=t)}let r=s[f-1].transform[4]-i.PdfConst.MARGIN_LEFT;r<d&&(d=r),s[f].isFooter&&t?x=t:(s[f].pageIndex>g&&(s[f-1].isFooter||(x=l),a.push({pageIndex:g,top:u,left:d,width:p-d,heigh:x-u}),u=20,d=v.getMinLineLeft(s[f].pageIndex,s)-i.PdfConst.MARGIN_LEFT),g=s[f].pageIndex,t&&(x=t))}if(f-=1,!n&&v.isLastLineOfPage(f,s)){let t=s[f].isFooter?s[f-1]:s[f];x=t.transform[5]+t.height+20}return v.isFirstLineOfPage(f,s)||a.push({pageIndex:g,top:u,left:d,width:p-d,heigh:x-u}),a}constructor(t){super(),this.TYPE=l.TYPE_NAME,this.questType=t}}l.TYPE_NAME="question";class a extends r{parse(t,s,n,r,a,h){let c=s.strLine.replace(/\|/g,"").toLowerCase().trim().match(i.PdfConst.SECTION_PATTERN_LOWER.join("|")),d=null!=c&&c.length>0;if(d||(d=null!=(c=s.strLine.replace(/\|/g,"").trim().match(i.PdfConst.SECTION_PATTERN_NORMAL.join("|")))&&c.length>0),d&&c){let i=s.strLine.indexOf(c[0])+c[0].length+1,r=[c[0][0]];for(let s=t.length-1;s>=0;s--){if(t[s].type==l.TYPE_NAME){r.push(".Q");break}r.push(t[s].str[0])}return"HGFEDCBA.Q".endsWith(r.join(""))?[]:[{str:c[0],pageIndex:s.pageIndex,lineIndex:n,transform:s.transform,startLeft:v.calIndexPos(s.textObjs,a,h,i,!0),type:this.TYPE}]}return[]}static getRemoveBox(t,s){let n=s[t.lineIndex].top,r=t.transform[4]-i.PdfConst.MARGIN_LEFT,l=s[t.lineIndex].bottom;return{pageIndex:t.pageIndex,top:n||20,left:r,heigh:l&&n?l-n:0,width:r-r}}static getBoxes(t,s,n,r){let l=[],a=t.pageIndex,h=n?n.lineIndex:s.length-1,c=v.getMinLineLeft(-1,s)-i.PdfConst.MARGIN_LEFT,d=s[t.lineIndex].top;if(!d)return[];let u=v.getMaxLineRight(-1,s)+2*i.PdfConst.MARGIN_LEFT,p=r,x=a,g=t.lineIndex+1;for(;g<=h;g++){let t=s[g].top;if(s[g].isFooter&&t)p=t;else if(s[g].pageIndex>x&&(l.push({pageIndex:x,top:d,left:c,width:u-c,heigh:p-d}),d=20),x=s[g].pageIndex,t){p=t;break}}return g>=s.length&&(g=s.length-1),v.isFirstLineOfPage(g,s)||l.push({pageIndex:x,top:d,left:c,width:u-c,heigh:p-d}),l}constructor(){super(),this.TYPE=a.TYPE_NAME}}a.TYPE_NAME="section";class h extends r{parse(t,s,n,i,r,l){var a=[],h=this.matchPos(s.strLine,!1);if(0==h.length&&(h=this.matchPos(s.strLine,!0)),h.length>0)for(let t of h)a.push({str:t.value,pageIndex:s.pageIndex,lineIndex:n,transform:v.calIndexPos(s.textObjs,r,l,t.index),startLeft:v.calIndexPos2(s.textObjs,r,l,t.index+1),type:this.TYPE});return a}static getRemoveBox(t,s){let n=t.startLeft?t.startLeft[5]-2:s[t.lineIndex].top,r=t.transform[4]-i.PdfConst.MARGIN_LEFT,l=t.startLeft?t.startLeft[5]+t.startLeft[3]:s[t.lineIndex].bottom;return{pageIndex:t.pageIndex,top:n||20,left:r,heigh:l&&n?l-n:0,width:(t.startLeft?t.startLeft[4]:0)-r}}static getBoxes(t,s,n,r){let l=i.PdfConst.MARGIN_LEFT,a=[],c=s[t.lineIndex].top,d=s[t.lineIndex].bottom;if(!c||!d)return[];let u=d,p=t.transform[4]-l,x=n&&t.lineIndex==n.lineIndex?n.transform[4]-l:s[t.lineIndex].transform[4]+s[t.lineIndex].width+l;if(a.push({pageIndex:t.pageIndex,top:c,left:p,width:x-p,heigh:d-c}),n&&n.lineIndex==t.lineIndex)return a;c=d,d=r,x=0;let g=t.pageIndex,f=0;for(f=t.lineIndex+1;f<s.length;f++){if(d==r&&v.isLastLineOfPage(f,s)){let t=s[f].isFooter?s[f-1]:s[f];d=t.transform[5]+t.height+20}let n=s[f].top;if(f>t.lineIndex+1&&!s[f-1].isFooter){let t=s[f-1].transform[4]+s[f-1].width+l;t>x&&(x=t);let n=s[f-1].transform[4]-l;n<p&&(p=n)}if(s[f].isFooter&&n)f-t.lineIndex>1?(d=s[f-1].transform[5]+s[f-1].height+i.PdfConst.LINE_MAGIN,p=s[t.lineIndex+1].transform[4]-l):d=s[t.lineIndex].bottom;else if(s[f].pageIndex>g&&(d&&d-c>i.PdfConst.LINE_SMALL_HEIGHT&&f-t.lineIndex>1&&a.push({pageIndex:g,top:c,left:p,width:x-p,heigh:d-c}),u=c=20),g=s[f].pageIndex,n){d=n;break}}if(f>=s.length&&(f=s.length-1),f-t.lineIndex>1&&s[f-1].transform[5]>u&&!v.isFirstLineOfPage(f,s)){let n=20==c?s[f].transform[4]:s[t.lineIndex+1].transform[4];d&&d-c>i.PdfConst.LINE_SMALL_HEIGHT&&a.push({pageIndex:g,top:c,left:n,width:x-n,heigh:d-c})}n&&n.type==h.TYPE_NAME&&n.transform[4]>s[n.lineIndex].transform[4]+25*i.PdfConst.RENDER_SCALE&&(x=n.transform[4]-l,c=s[n.lineIndex].top,p=s[n.lineIndex].transform[4]-l,d=s[n.lineIndex].bottom,c&&d&&d-c>i.PdfConst.LINE_SMALL_HEIGHT&&a.push({pageIndex:g,top:c,left:p,width:x-p,heigh:d-c}));for(let t=a.length-1;t>=1;t--)a[t].left-(a[t-1].left+a[t-1].width)>=20*i.PdfConst.RENDER_SCALE&&a.splice(t,1);return a}matchPos(t,s){for(var n=s?t.toUpperCase():t,r=i.PdfConst.ANS_PATTERN,l=RegExp("[\\s\\|\\.]"),a=n.matchAll(r),h=[];;){var c=a.next();if(c.done)break;for(var d=0,u=c.value.index;u<n.length&&l.test(n[u]);u++)d++;let t=c.value[0].substr(d,1);("A"!=t||n.replace(/\|/g,"").trim().startsWith("A"))&&h.push({value:t,index:c.value.index+d})}return h}constructor(){super(),this.TYPE=h.TYPE_NAME}}h.TYPE_NAME="answer";class c extends r{parse(t,s,n,r,l,a){let h=s.strLine.replace(/\|/g,"").trim().match(i.PdfConst.HET_PATTERN.join("|"));return null!=h&&h.length>0?[{str:s.strLine,pageIndex:s.pageIndex,lineIndex:n,transform:s.transform,type:this.TYPE}]:[]}static getBoxes(t,s,n,i){return[]}strContains(t,s){for(let n of s)if(t.indexOf(n)>=0)return!0;return!1}constructor(t){super(),null!=t&&(this.isOn=t),this.TYPE=c.TYPE_NAME}}c.TYPE_NAME="het";class d extends r{parse(t,s,n,r,l,a){let h=s.strLine.replace(/\|/g,"").trim().match(i.PdfConst.DAPAN_PATTERN.join("|"));return null!=h&&h.length>0?[{str:s.strLine,pageIndex:s.pageIndex,lineIndex:n,transform:s.transform,type:this.TYPE}]:[]}static getBoxes(t,s,n,i){return[]}static getAnsFromHelp(t){for(let s of t){let t=s.strLine.replace(/\|/g,"").trim().match(i.PdfConst.HELP_ANS_PATTERN.join("|"));if(null!=t){for(let s=0;s<t.length;s++)if(null!=t[s]&&1==t[s].length)return t[s]}}return""}strContains(t,s){for(let n of s)if(t.indexOf(n)>=0)return!0;return!1}constructor(t){super(),null!=t&&(this.isOn=t),this.TYPE=d.TYPE_NAME}}d.TYPE_NAME="dapan";class u extends r{parse(t,s,n,r,l,a){let h=s.strLine.replace(/\|/g,"").trim().match(i.PdfConst.HUONGDAN_PATTERN.join("|"));return null!=h&&h.length>0?[{str:s.strLine,pageIndex:s.pageIndex,lineIndex:n,transform:s.transform,type:this.TYPE}]:[]}static getBoxes(t,s,n,i){return D.QuestionParser.getBoxes(t,s,n,i)}strContains(t,s){for(let n of s)if(t.indexOf(n)>=0)return!0;return!1}constructor(){super(),this.TYPE=u.TYPE_NAME}}u.TYPE_NAME="huongdan";class p extends r{parse(t,s,n,i,r,l){var a=s.strLine.replace(/\|/g,"").replace(/\s*\.*\-*:*,*;*/g,"");return a=(a=(a=(a=(a=a.replace(/C\xe2u/g,"")).replace(/\u0110\xe1p\xe1n/g,"")).replace(/\u0110\xe1p/g,"")).replace(/\xe1n/g,"")).replace(/\u0110\/A/g,""),/^[0-9ABCDEFGHabcdefgh]+$/g.test(a)&&a.length>=2&&(null==this.firstLine&&(this.firstLine=s,this.lineIdx=n),this.str+=a),[]}static getBoxes(t,s,n,i){return[]}getResult(t){let s=[],n="",i=[],r=!1;for(let s=0;s<t.length;s++){let l=t.charCodeAt(s),a=l>=65&&l<=72;if(a&&""==n)return[];a!=r&&(i.push(n),n=""),r=a,n+=t[s]}""!=n&&i.push(n);for(let t=1;t<i.length;t+=2){let n=0,r=Math.floor(i[t-1].length/i[t].length),l=+i[t-1].substr(n,r),a=l;for(let h=0;h<i[t].length;h++){if(h>=i[t-1].length||(l=+i[t-1].substr(n,r))!=a)return[];s.push({num:l,str:i[t][h]}),n+=r,r=(a=l+1).toString().length}}return s}on(){super.on(),this.firstLine=null,this.lineIdx=0,this.str=""}off(){if(super.off(),this.offCalback&&this.firstLine){var t=this.getResult(this.str.toUpperCase());if(t.length>0){let s=JSON.stringify({main:t,sub:[]});this.offCalback([{str:s,pageIndex:this.firstLine.pageIndex,lineIndex:this.lineIdx,transform:this.firstLine.transform,type:this.TYPE}])}}this.firstLine=null,this.str=""}constructor(t,s){super(),this.firstLine=null,this.lineIdx=0,this.str="",this.TYPE=p.TYPE_NAME,null!=t&&(this.isOn=t),this.offCalback=s}}p.TYPE_NAME="dapanchitiet";class x extends r{parse(t,s,n,r,l,a){if(!s.isLastLine||r&&s.transform[5]<r.transform[5]+r.height)return[];var h=s.strLine.replace(/\|/g,"").trim().match(i.PdfConst.FOOTER_PATTERN.join("|"));return null!=h&&h.length>0?[{str:h[0],pageIndex:s.pageIndex,lineIndex:n,transform:s.transform,type:this.TYPE}]:[]}static getBoxes(t,s,n,i){return[]}constructor(){super(),this.TYPE=x.TYPE_NAME}}x.TYPE_NAME="footer";class g extends r{parse(t,s,n,i,r,l){for(let a of[new x,new u])if(a.parse(t,s,n,i,r,l).length>0)return[];var a=s.strLine;return null==this.firstLine&&(this.firstLine=s,this.lineIdx=n),this.str+=a+"\n",[]}static getBoxes(t,s,n,i){return[]}getResult(t){let s=[],n=t.replace(/\n/g,"\n|"),r=i.PdfConst.QUESTION_PATTERN.join("|").replace(/\(\^/g,"(\\|"),l=n.matchAll(RegExp(r,"ig"));for(;;){let t=l.next();if(t.done)break;let s=t.value[0],i=this.getNumberFromStr(s);n=n.replace(s,i+".")}let a,h=n.matchAll(/\d+[\.\-]/g),c=-1;for(;;){let t=h.next();if(t.done)break;if(-1==c)c=t.value.index,a=t;else{let i=n.substr(c,t.value.index-c);s.push(this.toAns(i,a)),c=t.value.index,a=t}}if(c>=0&&a){let t=n.substr(c);s.push(this.toAns(t,a))}return s}toAns(t,s){let n=s.value[0].length;return{num:+s.value[0].substr(0,n-1),str:t.substr(n).replace(/\|/g," ").replace(/ +/g," ").trim()}}getNumberFromStr(t){var s=t.match(/(\d+)/);return s?s[0]:""}on(){super.on(),this.firstLine=null,this.lineIdx=0,this.str=""}off(){if(super.off(),this.offCalback&&this.firstLine){var t=this.getResult(this.str);if(t.length>0){let s=JSON.stringify({main:[],sub:t});this.offCalback([{str:s,pageIndex:this.firstLine.pageIndex,lineIndex:this.lineIdx,transform:this.firstLine.transform,type:this.TYPE}])}}this.firstLine=null,this.str=""}constructor(t,s){super(),this.firstLine=null,this.lineIdx=0,this.str="",this.TYPE=g.TYPE_NAME,null!=t&&(this.isOn=t),this.offCalback=s}}g.TYPE_NAME="dapandientu";class f{getErrorQtns(t){var s=[];for(let n=0;n<t.length;n++)!t[n].isGroup&&0==t[n].answers.length&&(t[n].strAns&&void 0!==t[n].strAns||s.push(t[n].num));return s}sumHighTo(t,s){let n=0,i=s.filter(t=>!t.inactive);for(let s=0;s<t;s++)n+=Math.round(i[s].heigh);return n}maxWidthTo(t,s){let n=[],i=s.filter(t=>!t.inactive);for(let s=0;s<t;s++)n.push(i[s].width);return Math.round(Math.max(...n))}constructor(t){this.commonService=t,this.fillColor=(t,s,n,i,r,l)=>{s.fillStyle=t,s.fillRect(Math.round(n),Math.round(i),Math.round(r),Math.round(l))},this.drawRect=(t,s,n,i,r,l)=>{s.beginPath(),s.lineWidth=1,s.strokeStyle=t,s.rect(Math.round(n),Math.round(i),Math.round(r),Math.round(l)),s.stroke()},this.getSingleImgData=(t,s)=>{var n,i;if(t.inactive){let t=null!==(n=this.commonService.myTranslateInstant("lang_auto_khong_xac_dinh_duoc_vung_thong_tin"))&&void 0!==n?n:"";throw this.commonService.snackError(t),Error(t)}try{let n=document.createElement("canvas");return n.width=0==t.width?2:Math.round(t.width),n.height=0==t.heigh?2:Math.round(t.heigh),null===(i=n.getContext("2d"))||void 0===i||i.drawImage(s[t.pageIndex].canvas,Math.round(t.left),Math.round(t.top),n.width,n.height,0,0,n.width,n.height),n.toDataURL("image/png")}catch(t){return console.log(t),"https://via.placeholder.com/300"}},this.getScatteredImgData=(t,s)=>{let n=t.filter(t=>!t.inactive);if(t.filter(t=>t.inactive).length==t.length){var i;let t=null!==(i=this.commonService.myTranslateInstant("lang_auto_khong_xac_dinh_duoc_vung_thong_tin"))&&void 0!==i?i:"";throw this.commonService.snackError(t),Error(t)}try{let t=document.createElement("canvas"),i=n.map(t=>t.width);t.width=Math.round(Math.max(...i));let r=0;for(let t=0;t<n.length;t++)r+=n[t].heigh;t.height=Math.round(r);let l=t.getContext("2d");for(let t=0;t<n.length;t++)null==l||l.drawImage(s[n[t].pageIndex].canvas,Math.round(n[t].left),Math.round(n[t].top),Math.round(n[t].width),Math.round(n[t].heigh),0,0==t?0:this.sumHighTo(t,n),Math.round(n[t].width),Math.round(n[t].heigh));return t.toDataURL("image/png")}catch(t){return console.log(t),"https://via.placeholder.com/300"}}}}class v{static drawPoint(t,s,n){null!=t&&(t.fillStyle=s,t.beginPath(),t.arc(n.left,n.top,5,0,2*Math.PI),t.fill())}static drawBox(t,s,n,i){null!=t&&(i?(t.fillStyle=s,t.beginPath(),t.rect(n.left,n.top,n.width,n.heigh),t.fill()):(t.strokeStyle=s,t.beginPath(),t.rect(n.left,n.top,n.width,n.heigh),t.stroke()))}static drawBox2(t,s,n,i,r){null!=t&&(t.strokeStyle=s,t.beginPath(),t.rect(r[4],r[5],n,i),t.stroke())}static drawLine(t,s,n,i){null!=t&&(t.strokeStyle=s,t.beginPath(),t.moveTo(n,i),t.lineTo(t.canvas.width-10,i),t.stroke())}static drawText(t,s,n,i){null!=t&&(t.font="11px Arial",t.fillStyle=s,t.fillText(i,n[4],n[5]))}static isLineIntersec(t,s){let n=t.transform[5]<=s.transform[5]&&s.transform[5]<=t.transform[5]+t.height,r=s.transform[5]<=t.transform[5]&&t.transform[5]<=s.transform[5]+s.height,l=t.transform[4]<=s.transform[4]&&s.transform[4]<=t.transform[4]+t.width+i.PdfConst.INTERSEC_MARGIN,a=s.transform[4]<=t.transform[4]&&t.transform[4]<=s.transform[4]+s.width+i.PdfConst.INTERSEC_MARGIN,h=this.isSameLine(t,s);return(n||r)&&(l||a)&&!h}static isLineVIntersec(t,s){return(t.transform[5]<=s.transform[5]&&s.transform[5]<=t.transform[5]+t.height||s.transform[5]<=t.transform[5]&&t.transform[5]<=s.transform[5]+s.height)&&(t.transform[4]<=s.transform[4]&&s.transform[4]<=t.transform[4]+t.width+i.PdfConst.INTERSEC_MARGIN||s.transform[4]<=t.transform[4]&&t.transform[4]<=s.transform[4]+s.width+i.PdfConst.INTERSEC_MARGIN)&&Math.abs(s.transform[4]-t.transform[4])>i.PdfConst.INTERSEC_MARGIN/2}static isSameLine(t,s){return Math.abs(t.transform[5]+t.height-(s.transform[5]+s.height))<=i.PdfConst.LINE_MAGIN}static isObjIntersec(t,s){return t.transform[5]<=s.transform[5]&&s.transform[5]<=t.transform[5]+t.height||s.transform[5]<=t.transform[5]&&t.transform[5]<=s.transform[5]+s.height}static isObjFullIntersec(t,s){return(t.transform[5]<=s.transform[5]&&s.transform[5]<=t.transform[5]+t.height||s.transform[5]<=t.transform[5]&&t.transform[5]<=s.transform[5]+s.height)&&(t.transform[4]<=s.transform[4]&&s.transform[4]<=t.transform[4]+t.width||s.transform[4]<=t.transform[4]&&t.transform[4]<=s.transform[4]+s.width)}static isFirstLineOfPage(t,s){return!(t<0||t>=s.length||0!=t&&s[t-1].pageIndex==s[t].pageIndex)}static isLastLineOfPage(t,s){return!(t<0||t>=s.length||t!=s.length-1&&s[t+1].pageIndex==s[t].pageIndex)}static getTopLine(t,s,n){let r=n[s];for(let l of[[i.PdfConst.STEP_SIZE,i.PdfConst.OVERLAP],[1,i.PdfConst.OVERLAP],[1,.3]]){let a=l[0],h=l[1],c=r.transform[5],d=0,u=3*a;if(!v.isFirstLineOfPage(s,n)){let t=v.isSameLine(n[s-1],r);v.isLineIntersec(n[s-1],r)?(c=n[s-1].transform[5]+n[s-1].height,d=n[s-1].transform[5],n[s-1].transform[4]>n[s].transform[4]+2*i.PdfConst.MARGIN_LEFT?d-=2*i.PdfConst.MARGIN_LEFT:d+=n[s-1].height*h,a=1,u=n[s].transform[5]+n[s].height/2-c):(d=t&&s-2>=0?n[s-2].transform[5]+n[s-2].height*h:n[s-1].transform[5]+n[s-1].height*h,t&&v.isFirstLineOfPage(s-1,n)&&(d=0))}if(!i.PdfConst.ENABLE_IMAGE_PROCESS)return[c,0];let p=!1;for(;c>d;){if(!v.hasColor(t,r.transform[4],c,r.width,a))return[c,0];p||(p=!0,c+=u),c-=a}}return[r.transform[5],1]}static arrContains(t,s){for(let n of s)if(n==t)return!0;return!1}static getBottomLine(t,s,n){let r=n[s];for(let l of[[i.PdfConst.STEP_SIZE,i.PdfConst.OVERLAP],[1,i.PdfConst.OVERLAP],[1,.3]]){let a=l[0],h=l[1],c=r.transform[5]+r.height,d=9999,u=3*a;if(!v.isLastLineOfPage(s,n)){let t=v.isSameLine(n[s+1],r);v.isLineIntersec(n[s+1],r)?(c=n[s+1].transform[5],d=n[s+1].transform[5]+n[s+1].height,n[s+1].transform[4]>n[s].transform[4]+2*i.PdfConst.MARGIN_LEFT?d+=2*i.PdfConst.MARGIN_LEFT:d-=n[s+1].height*h,u=n[s].transform[5]+n[s].height/2-c):(d=t&&s+2<n.length?n[s+2].transform[5]+n[s+2].height-n[s+2].height*h:n[s+1].transform[5]+n[s+1].height-n[s+1].height*h,t&&v.isLastLineOfPage(s+1,n)&&(d=9999));let l=n[s+1].top;if(l&&c>=l&&!t)return[l,0]}if(!i.PdfConst.ENABLE_IMAGE_PROCESS)return[c,0];let p=!1;for(;c<d;){if(!v.hasColor(t,r.transform[4],c,r.width,a))return[c,0];p||(p=!0,c-=u),c+=a}}return[r.transform[5]+r.height,1]}static hasColor(t,s,n,i,r){let l=Math.round(s),a=Math.round(l+i),h=Math.round(n),c=Math.round(h+r);for(let s=h;s<c;s++)for(let n=l;n<a;n++){let i=4*(s*t.width+n);if((t.data[i]+t.data[i+1]+t.data[i+2])/3<150)return!0}return!1}static calIndexPos2(t,s,n,r,l){let a=[],h=0,c=0,d=0,u=0,p=0,x=0,g=!0,f=!0;for(let E of t){f=this.isObjIntersec(t[0],E),u=E.transform[4],l||(h+=u-d>i.PdfConst.SPLIT_MARGIN&&""!=E.str.trim()||p!=E.transform[5]?1:0),g=u+2*i.PdfConst.MARGIN_LEFT>=d;let T=E.transform[4]+E.width;if(f&&(d=T),T>c&&f&&(c=T),(h+=E.str.length)>r&&g&&f){E.transform.forEach(t=>{a.push(t)}),a[3]=E.height,a[2]=x,a[1]=E.str.length-h+r;let t=E.str.substr(0,E.str.length-h+r+1);if(t.length==E.str.length){a[4]=a[4]+E.width;break}var v=s[E.fontName].fontFamily,b=Math.hypot(E.transform[2],E.transform[3]);n.font="".concat(b,"px ").concat(v);let i=n.measureText(t).width,l=n.measureText(E.str).width;a[4]=a[4]+E.width*i/l;break}f&&(p=E.transform[5]),x++}return 0==a.length&&(a=[0,t[t.length-1].length-1,t.length-1,t[0].height,c,t[0].transform[5]]),a}static calIndexPos(t,s,n,r,l){let a=[],h=0,c=0,d=0,u=0,p=0,x=0,g=!0,f=!0;for(let E of t){f=this.isObjIntersec(t[0],E),u=E.transform[4],l||(h+=u-d>i.PdfConst.SPLIT_MARGIN&&""!=E.str.trim()||p!=E.transform[5]?1:0,u-d>i.PdfConst.SPLIT_MARGIN&&""!=E.str.trim()||E.transform[5],E.str),g=u+2*i.PdfConst.MARGIN_LEFT>=d;let T=E.transform[4]+E.width;if(f&&(d=T),T>c&&f&&(c=T),(h+=E.str.length)>r&&g&&f){let t=E.str.substr(0,E.str.length-h+r);var v=s[E.fontName].fontFamily,b=Math.hypot(E.transform[2],E.transform[3]);n.font="".concat(b,"px ").concat(v);let i=n.measureText(t).width,l=n.measureText(E.str).width;E.transform.forEach(t=>{a.push(t)}),a[4]=a[4]+E.width*i/l,a[3]=E.height,a[2]=x,a[1]=E.str.length-h+r;break}f&&(p=E.transform[5]),x++}return 0==a.length&&(a=[0,t[t.length-1].length-1,t.length-1,t[0].height,c,t[0].transform[5]]),a}static getTextBottom(t,s,n,i){let r=Math.atan2(t[1],t[0]);s.vertical&&(r+=Math.PI/2);let l=Math.hypot(t[2],t[3]),a=l*v.getAscent(s.fontFamily,n,i);t[5];let h=0,c=0*(h=0===r?a:a*Math.cos(r));return[t[5]-h-c,l+c]}static getAscent(t,s,n){let i=n.get(t);if(i)return i;s.save(),s.font="30px ".concat(t);let r=s.measureText(""),l=r.fontBoundingBoxAscent,a=Math.abs(r.fontBoundingBoxDescent);if(l){s.restore();let i=l/(l+a);return n.set(t,i),i}s.strokeStyle="red",s.clearRect(0,0,30,30),s.strokeText("g",0,0);let h=s.getImageData(0,0,30,30).data;a=0;for(let t=h.length-1-3;t>=0;t-=4)if(h[t]>0){a=Math.ceil(t/4/30);break}s.clearRect(0,0,30,30),s.strokeText("A",0,30),h=s.getImageData(0,0,30,30).data,l=0;for(let t=0,s=h.length;t<s;t+=4)if(h[t]>0){l=30-Math.floor(t/4/30);break}if(s.restore(),l){let s=l/(l+a);return n.set(t,s),s}return n.set(t,.8),.8}static getMaxLineRight(t,s){let n=0;for(let i of s)if(i.pageIndex==t||-1==t){let t=i.transform[4]+i.width;t>n&&(n=t)}return n}static getMinLineLeft(t,s){let n=99999;for(let i of s)if(i.pageIndex==t||-1==t){let t=i.transform[4];t<n&&(n=t)}return n}}class b{loadPdf(t,s){var n=URL.createObjectURL(t);let i=pdfjsLib.getDocument({url:n,cMapPacked:!0,cMapUrl:"/assets/js/pdf-js-v2/cmaps/",disableAutoFetch:!1,disableFontFace:!1,disableRange:!1,disableStream:!1,docBaseUrl:"",enableXfa:!0,fontExtraProperties:!1,isEvalSupported:!0,maxImageSize:-1,pdfBug:!1,standardFontDataUrl:"/assets/js/pdf-js-v2/standard_fonts/",verbosity:1});var r=[];let l=this;i.promise.then(function(t){l.optionalContentConfigPromise=t.getOptionalContentConfig();for(var n=t._pdfInfo.numPages,i=1;i<=n;i++)t.getPage(i).then(t=>{r.push(t),r.length==n&&s(r=r.sort((t,s)=>t._pageIndex>s._pageIndex?1:-1))})},function(t){console.error(t)})}getImages(t,s){let n=[];if("function"!=typeof t.objs.getAll)return console.log("Unable to read img"),n;let i=t.objs.getAll();for(let t of Object.keys(i))i[t].data.pageIndex=s,n.push(i[t].data);return n}isImageObj(t){return -999==t.transform[0]&&"img"==t.str}getLines(t,s,n,r){let l=r.scale,a=t.items.length;for(let s=0;s<a;s++){let i=t.items[s];this.isImageObj(i)||(i.transform=b.transform(r.transform,i.transform),i.width=i.width*l),i.transform[4]+i.width>n.canvas.width&&(i.width=n.canvas.width-i.transform[4]-20);let a=this.isImageObj(i)?[i.transform[5],i.height]:v.getTextBottom(i.transform,t.styles[i.fontName],this.tempCanvas,this.ascentCache);i.height=a[1];let h=Math.ceil(a[0]);i.transform[5]=h}t.items.sort((t,s)=>1e6*Math.floor(t.transform[5])-t.transform[4]<1e6*Math.floor(s.transform[5])-s.transform[4]?-1:1);let h,c=[],d=0;this.imageCache[s]?h=this.imageCache[s]:(h=n.getImageData(0,0,n.canvas.width,n.canvas.height),this.imageCache[s]=h);var u={strLine:"",transform:[],textObjs:[],pageIndex:s,width:0,height:0,txtLength:0};for(let n=0;n<a;n++){let r=t.items[n];if(this.isImageObj(r)){for(let s=0;s<a;s++)if(n!=s&&v.isObjIntersec(r,t.items[s])){r.str="";break}}if(v.arrContains(r.str.trim(),i.PdfConst.SKIP_CHAR))continue;let l=Math.floor(r.transform[5]+r.height);0!=d?d-l>=-i.PdfConst.LINE_MAGIN?this.addTxtToLine(u,r):0!=u.textObjs.length&&(c.push(u),d=Math.floor((u=this.newLine(r,s)).transform[5]+u.height)):d=Math.floor((u=this.newLine(r,s)).transform[5]+u.height)}for(let t of(c.push(u),c))this.calculateSize(t);for(let t of(this.findAndMergeAnsQuestBlock(c,"ans"),this.findAndMergeAnsQuestBlock(c,"quest"),this.findAndMergeBlock(c),this.mergeIntersecLine(c),this.mergeSmallLine(c,h),c))this.calculateSize(t);return c}mergeIntersecLine(t){let s=0;for(;s<t.length;){let n=t[s];++s<t.length&&v.isLineVIntersec(n,t[s])&&(this.mergeLine(n,t[s]),t.splice(s,1),s--)}}findAndSplitQuestAnsLine(t,s,n){let r=0,l=[],a=i.PdfConst.BREAK_LINE_PATTERN.join("|");for(let s of t){s.top=void 0,s.bottom=void 0;var h=s.strLine.replace(/\|/g,"").trim().match(a);if(null!=h&&h.length>0){let t=/[\s\|\.]+[B\u0412][\s\|]*\./g,n=s.strLine.trim().toUpperCase().match(t);if(null!=n&&n.length>0){let t=h[0].toUpperCase().indexOf("A");l.push({lineIndex:r,strIndex:t})}}r++}for(let i=l.length-1;i>=0;i--){let r=l[i].lineIndex;this.splitLine(r,s[t[r].pageIndex],n[t[r].pageIndex],l[i].strIndex,t)}}mergeSmallLine(t,s){let n=0,r=1.2*i.PdfConst.LINE_SMALL_HEIGHT;for(;n<t.length;){let i=t[n];if(!i||!this.isSmallLine(i)){n++;continue}n-1>=0&&!t[n-1].bottom&&(t[n-1].bottom=v.getBottomLine(s,n-1,t)[0]),n+1<t.length&&!t[n+1].top&&(t[n+1].top=v.getTopLine(s,n+1,t)[0]);let l=n-1<0?-9999:this.getLineTop(i)-this.getLineBot(t[n-1]),a=n+1>=t.length?-9999:this.getLineTop(t[n+1])-this.getLineBot(i),h=n-1>=0&&t[n-1].transform[4]<=i.transform[4]&&i.transform[4]<=t[n-1].transform[4]+t[n-1].width,c=n+1<t.length&&t[n+1].transform[4]<=i.transform[4]&&i.transform[4]<=t[n+1].transform[4]+t[n+1].width;if(0==n&&a<=r&&c){this.mergeLine(t[n+1],i),t.splice(n,1),n--;continue}if(n==t.length-1&&l<=r&&h){this.mergeLine(t[n-1],i),t.splice(n,1),n--;continue}let d=-1;l>a&&c&&a<=r?d=n+1:l<=a&&h&&l<=r?d=n-1:l<=a&&c&&a<=r?d=n+1:l>a&&h&&l<=r&&(d=n-1),d>=0?(this.mergeLine(t[d],i),t.splice(n,1),n--):n++}}isSmallLine(t){return t.height<i.PdfConst.LINE_SMALL_HEIGHT}mergeLine(t,s){for(let n of s.textObjs)this.addTxtToLine(t,n)}findAndMergeAnsQuestBlock(t,s){let n=0;for(;n<t.length;){if("ans"==s&&this.isAnsLine(t[n])||"quest"==s&&this.isQuestLine(t[n])){let i=n,r=-1,l=1,a=[];for(;l<=10;){if((i=n+r*l)<0){r=1,l=1;continue}if(i>=t.length)break;let h=this.isAnsLine(t[i]),c=h||this.isQuestLine(t[i]),d="ans"==s&&h&&v.isSameLine(t[n],t[i]),u=!c&&v.isLineIntersec(t[n],t[i])&&t[i].transform[4]>t[n].transform[4];if((d||u)&&a.push(i),l++,c&&1==r)break;(l>10||c)&&-1==r&&(r=1,l=1)}for(let s of(a.sort((t,s)=>t<s?1:-1),a))for(let i of t[s].textObjs)this.addTxtToLine(t[n],i);for(let s of a)t.splice(s,1),s<n&&n--}n++}}findAndMergeBlock(t){let s=0;for(;s<t.length;){if(this.isAnsLine(t[s])||this.isQuestLine(t[s])){s++;continue}let n=s+1;for(;n<t.length&&t[s].pageIndex==t[n].pageIndex;){let i=this.isAnsLine(t[n])||this.isQuestLine(t[n]);if(v.isLineIntersec(t[s],t[n])&&!i||v.isSameLine(t[s],t[n])){for(let i of t[n].textObjs)this.addTxtToLine(t[s],i);t.splice(n,1),n=s}n++}s++}}isAnsLine(t){let s=t.strLine.trim().match(/[\s\|\.]+[AB\u0412CDEFGHIJK]\s*\./g);return null!=s&&s.length>0}isQuestLine(t){let s=i.PdfConst.QUESTION_PATTERN.join("|"),n=t.strLine.replace(/\|/g,"").toLowerCase().trim().match(s);return null!=n&&n.length>0}encodeLines(t,s){let n="",r=0;for(let l of s){if(l.height<i.PdfConst.LINE_SMALL_HEIGHT){r-1>=0&&!s[r-1].bottom&&(s[r-1].bottom=v.getBottomLine(t,r-1,s)[0]),r+1<s.length&&!s[r+1].top&&(s[r+1].top=v.getTopLine(t,r+1,s)[0]);let a=r-1<0?-9999:this.getLineTop(l)-this.getLineBot(s[r-1]),h=r+1>=s.length?-9999:this.getLineTop(s[r+1])-this.getLineBot(l),c=r-1>=0&&s[r-1].transform[4]<=l.transform[4]&&l.transform[4]+l.width<=s[r-1].transform[4]+s[r-1].width,d=r+1<s.length&&s[r+1].transform[4]<=l.transform[4]&&l.transform[4]+l.width<=s[r+1].transform[4]+s[r+1].width,u=1.2*i.PdfConst.LINE_SMALL_HEIGHT;Math.abs(a)>=u&&Math.abs(h)>=u?n+="L":n+=-9999==a?"3":-9999==h?"4":a>h&&d?"2":a<=h&&c?"1":a<=h&&d?"2":a>h&&c?"1":"L"}else n+="L";r++}return n}getLineTop(t){return t.top?t.top:t.transform[5]}getLineBot(t){return t.bottom?t.bottom:t.transform[5]+t.height}splitLine(t,s,n,i,r){let l=r[t],a=v.calIndexPos(l.textObjs,s,n,i,!0),h=this.newLine(l.textObjs[0],l.pageIndex),c=a[2],d=a[1],u=l.textObjs[c],p=u.transform,x={str:u.str.substr(0,d),width:a[4]-p[4],height:u.height,fontName:u.fontName,transform:[p[0],p[1],p[2],p[3],p[4],p[5]]},g={str:u.str.substr(d),width:u.width-x.width,height:u.height,fontName:u.fontName,transform:[p[0],p[1],p[2],p[3],a[4],p[5]]},f=l.textObjs;l.textObjs=[],h.textObjs=[];for(let t=0;t<f.length;t++)t<c?this.addTxtToLine(l,f[t]):t>c?this.addTxtToLine(h,f[t]):(this.addTxtToLine(l,x),this.addTxtToLine(h,g));return this.calculateSize(l),this.calculateSize(h),t==r.length-1?r.push(h):r.splice(t+1,0,h),h}findAndMergeSmallLine(t,s,n){let i=0,r=t.matchAll(n),l=[];for(;;){let t=r.next();if(t.done)break;let n=t.value[0],a=t.value.index,h=0,c=[];for(let t=0;t<n.length;t++)"L"==n[t]?h=a+t:c.push(a+t);for(let t of c){for(let n of s[t].textObjs)this.addTxtToLine(s[h],n);s[h].top=void 0,s[h].bottom=void 0,l.push(t)}i++}for(let t of(l.sort((t,s)=>t<s?1:-1),l))s.splice(t,1);return i}newLine(t,s){let n={strLine:"",transform:[],textObjs:[],pageIndex:s,width:0,height:0,txtLength:0};return n.transform[4]=t.transform[4],n.transform[5]=t.transform[5],n.height=t.height,n.width=t.width,n.txtLength=t.str.length,n.textObjs.push(t),n}addTxtToLine(t,s){s.transform[4]<t.transform[4]&&(t.transform[4]=s.transform[4]),s.transform[5]<t.transform[5]&&(t.transform[5]=s.transform[5]),s.transform[5]+s.height>t.transform[5]+t.height&&(t.height=s.transform[5]+s.height-t.transform[5]),s.transform[4]+s.width>t.transform[4]+t.width&&(t.width=s.transform[4]+s.width-t.transform[4]),t.txtLength+=s.str.length,t.textObjs.push(s);let n=t.transform[4]+t.width,i=t.height;for(let s of t.textObjs)s.transform[4]+s.width>n&&(n=s.transform[4]+s.width),s.transform[5]+s.height>t.transform[5]+i&&(i=s.transform[5]+s.height-t.transform[5]);t.width=n-t.transform[4],t.height=i}static transform(t,s){return pdfjsLib.Util.transform(t,s)}render(t,s,n,i){for(var r,l=t.length,a=0;a<l;a++){var h=document.createElement("div");h.className="pdf-page",h.id="page-"+a,null===(r=document.getElementById(s))||void 0===r||r.appendChild(h),this.renderPage(t[a],n,i)}}calculateSize(t){if(0==t.textObjs.length)return;t.textObjs.sort((t,s)=>1e6*Math.floor(t.transform[4])+t.transform[5]>1e6*Math.floor(s.transform[4])+s.transform[5]?1:-1),t.strLine="";let s=0,n=0,r=0,l=0,a=9999,h=0,c=9999;for(let d of t.textObjs){let u=v.isObjIntersec(t.textObjs[0],d),p=(r=d.transform[4])-n>i.PdfConst.SPLIT_MARGIN&&""!=d.str.trim()||l!=d.transform[5]?"|":"";t.strLine+=p+d.str,r<c&&(c=r);let x=d.transform[4]+d.width;u&&(n=x),x>s&&u&&(s=x),u&&(l=d.transform[5]),d.transform[5]<a&&(a=d.transform[5]),d.transform[5]+d.height>h&&(h=d.transform[5]+d.height)}t.transform[4]=c,t.transform[5]=a,t.width=s-c,t.height=h-a,t.transform[0]=a,t.transform[1]=h;let d=i.PdfConst.TVCN_CHAR,u=t.strLine;for(let t of d)u=u.replace(RegExp(t[0],"g"),t[1]);t.strLine=u}renderPage(t,s,n){var i=t._pageIndex,r=t.getViewport({scale:s});let l=.8*r.width;var a=document.createElement("canvas"),h=document.getElementById("page-"+i);null==h||h.appendChild(a),a.id="canvas"+i;var c=a.getContext("2d",{alpha:!1});a.height=r.height,a.width=r.width,a.style.height=r.height*l/r.width+"px",a.style.width=l+"px",h&&(h.style.width=a.style.width,h.style.height=a.style.height);let d={canvasContext:c,transform:[1,0,0,1,0,0],viewport:r,annotationMode:pdfjsLib.AnnotationMode.ENABLE_FORMS,optionalContentConfigPromise:this.optionalContentConfigPromise,annotationCanvasMap:new Map,pageColors:{background:"Canvas",foreground:"CanvasText"}};t.render(d).promise.then(function(){n&&n(c,t._pageIndex,r)})}constructor(){let t=document.createElement("canvas");this.tempCanvas=t.getContext("2d"),this.ascentCache=new Map,this.imageCache=[]}}t.exports=class{get totalNumberQuestion(){return this.questionList.filter(t=>t.tempData.isSelect&&t.answers.length).length}updateStatusCallback(t){}onCompleteCallback(t,s){t.length>0?(this.startQuestion=t[0].num,this.labelHolderSize.width=2*s[0].canvas.width,this.rootQuestionInfo=t,this.rootCanvases=s.map(t=>t.canvas),this.rootHeaderPosition={pageIndex:0,top:1,left:t[0].positions[0].left,width:t[0].positions[0].left+t[0].positions[0].width<s[0].canvas.width?t[0].positions[0].width:s[0].canvas.width-t[0].positions[0].left,heigh:t[0].positions[0].top-1},this.processData()):(this.errAnalyzingPdf=!0,this.isShowLoadingFileExam=!1)}cloneCanvas(){let t=this.rootCanvases;for(let s=0;s<t.length;s++){let n=t[s],i=document.createElement("canvas");i.width=n.width,i.height=n.height;let r=document.createElement("canvas");r.width=n.width,r.height=n.height;let l=i.getContext("2d");null==l||l.drawImage(n,0,0,n.width,n.height,0,0,n.width,n.height);let a=r.getContext("2d");null==a||a.drawImage(n,0,0,n.width,n.height,0,0,n.width,n.height),l&&a&&this.clonedCtxForCreate.push(a)}}processData(){this.questionList=[],this.abcdLabelPos={},this.groupImages={},this.totalInGroupTracking=0,this.questionLabelMap=[],this.groupLengths=[],this.countGroup=0,this.labelsUrls=[],this.labelsBase64s=[],this.firstInGroupIndexes=[],this.clonedCtxForCreate=[],this.cloneCanvas();let t=this.clonedCtxForCreate[0].canvas.width;this.rootQuestionInfo.forEach(s=>{s.positions.forEach(s=>{s.width+s.left>t&&(s.width=t-s.left)})});let s=this.rootQuestionInfo,n=this.clonedCtxForCreate;s.forEach(t=>{t.remove.heigh=Math.round(t.remove.heigh),t.remove.width=Math.round(t.remove.width),t.remove.top=Math.round(t.remove.top),t.remove.left=Math.round(t.remove.left),t.positions.forEach(t=>{t.heigh=Math.round(t.heigh),t.width=Math.round(t.width),t.top=Math.round(t.top),t.left=Math.round(t.left)}),t.help&&(t.help.remove&&(t.help.remove.heigh=Math.round(t.help.remove.heigh),t.help.remove.width=Math.round(t.help.remove.width),t.help.remove.left=Math.round(t.help.remove.left),t.help.remove.top=Math.round(t.help.remove.top)),t.help.positions.forEach(t=>{t.heigh=Math.round(t.heigh),t.width=Math.round(t.width),t.top=Math.round(t.top),t.left=Math.round(t.left)})),t.answers.length>0&&t.answers.forEach(t=>{t.remove.heigh=Math.round(t.remove.heigh),t.remove.width=Math.round(t.remove.width),t.remove.top=Math.round(t.remove.top),t.remove.left=Math.round(t.remove.left),t.positions.forEach(t=>{t.heigh=Math.round(t.heigh),t.width=Math.round(t.width),t.top=Math.round(t.top),t.left=Math.round(t.left)})})});let i=document.createElement("canvas");i.width=this.labelHolderSize.width,i.height=this.labelHolderSize.height;let r=i.getContext("2d"),l=0,a=()=>{r&&(this.labelsBase64s[l]=r.canvas.toDataURL("image/png"),l++,r.clearRect(0,0,r.canvas.width,r.canvas.height)),c.left=0,c.top=0},h=0,c={left:0,top:0,locate:0},d=[],u=t=>{let s=!0;for(let n=0;n<t.length;n++)if(1==t[n].remove.width||1==t[n].remove.heigh){s=!1;break}return s};s.forEach(t=>{d.push(t.answers.length)});for(let t=0;t<s.length;t++)if(u(s[t].answers)&&s[t].answers.length==Math.max(...d)){s[t].answers.forEach(t=>{null==r||r.drawImage(n[t.remove.pageIndex].canvas,t.remove.left,t.remove.top,t.remove.width,t.remove.heigh,c.left,c.top,t.remove.width,t.remove.heigh),this.abcdLabelPos[t.label]={left:c.left,top:c.top},c.left=c.left+t.remove.width+5});break}this.examHeader=this.cropperService.getSingleImgData(this.rootHeaderPosition,n);for(let t=0;t<s.length;t++){let i={isFixAns:s[t].isFixAns?1:0,forcedFixAns:!!s[t].isFixAns,groupType:0,original:"",debugView:"",group:s[t].group,groupUrl:this.groupImages["image_group_".concat(s[t].group)]?this.groupImages["image_group_".concat(s[t].group)]:"",question:{label:s[t].num,posit:{top:0,left:0,locate:0},url:"",urlExcludeLabelOnly:"",width:1,height:1,remove:{x:1,y:1,width:1,height:1,url:this.cropperService.getSingleImgData(s[t].remove,n),left:0,top:0}},answers:[],help:{num:s[t].num,url:""},tempData:{sort:t,point:0,answerType:1,answerConfig:{},answerResult:[],isShowAttach:!1,questionMedia:[],isSelect:!0,isShowHelp:!1},rootIndex:t},d=s[t].positions;if(i.original=this.cropperService.getScatteredImgData(d,n),s[t].isGroup){this.groupLengths.push(this.totalInGroupTracking),this.totalInGroupTracking=0,this.countGroup++,i.isGroup=!0;var p=this.cropperService.getScatteredImgData(s[t].positions,n);this.groupImages["image_group_".concat(s[t].num)]=p}else{h++,this.totalInGroupTracking++,r&&0!=h&&c.left+s[t].remove.width>r.canvas.width?(c.left=0,c.top=c.top+this.maxQuestionLabelHeight+5,this.maxQuestionLabelHeight=0,r&&c.top+s[t].remove.heigh>r.canvas.height&&a(),null==r||r.drawImage(n[s[t].remove.pageIndex].canvas,s[t].remove.left,s[t].remove.top,s[t].remove.width,s[t].remove.heigh,c.left,c.top,s[t].remove.width,s[t].remove.heigh),i.question.remove.left=c.left,i.question.remove.top=c.top,this.questionLabelMap.push({locate:l,left:c.left,top:c.top,width:s[t].remove.width,height:s[t].remove.heigh}),c.left=c.left+s[t].remove.width+5):(r&&c.top+s[t].remove.heigh>r.canvas.height&&a(),null==r||r.drawImage(n[s[t].remove.pageIndex].canvas,s[t].remove.left,s[t].remove.top,s[t].remove.width,s[t].remove.heigh,c.left,c.top,s[t].remove.width,s[t].remove.heigh),i.question.remove.left=c.left,i.question.remove.top=c.top,this.questionLabelMap.push({locate:l,left:c.left,top:c.top,width:s[t].remove.width,height:s[t].remove.heigh}),c.left=c.left+s[t].remove.width+5,s[t].remove.heigh>this.maxQuestionLabelHeight&&(this.maxQuestionLabelHeight=s[t].remove.heigh)),this.cropperService.fillColor("#ffffff",n[s[t].remove.pageIndex],s[t].remove.left,s[t].remove.top,s[t].remove.width,s[t].remove.heigh),i.question.urlExcludeLabelOnly=1==d.length?this.cropperService.getSingleImgData(d[0],n):this.cropperService.getScatteredImgData(d,n),i.question.remove.x=s[t].remove.left-d[0].left,i.question.remove.y=s[t].remove.top-d[0].top,i.question.remove.width=s[t].remove.width,i.question.remove.height=s[t].remove.heigh,s[t].answers.length>0?s[t].answers.forEach(t=>{let s={label:t.label,posit:{left:0,top:0,locate:0},url:"",x:t.positions[0].left-d[0].left,y:t.positions[0].top-d[0].top,width:1,height:1,remove:{x:t.remove.left-d[0].left,y:t.remove.top-d[0].top,xAns:t.remove.left-t.positions[0].left,yAns:t.remove.top-t.positions[0].top,width:t.remove.width,height:t.remove.heigh,url:this.cropperService.getSingleImgData(t.remove,n),left:0,top:0}};if(d.length>1&&d[0].pageIndex!==t.remove.pageIndex&&(s.remove.y=t.remove.top-d[1].top+d[0].heigh),this.cropperService.fillColor("#ffffff",n[t.remove.pageIndex],t.remove.left,t.remove.top,t.remove.width,t.remove.heigh),d.length>1){for(let n=0;n<d.length;n++)if(d[n].pageIndex==t.positions[0].pageIndex){s.y=0==n?t.positions[0].top-d[n].top:t.positions[0].top-d[n].top+d[0].heigh;break}}if(t.isCorrect&&(i.tempData.answerResult=[t.label]),1==t.positions.length)s.url=this.cropperService.getSingleImgData(t.positions[0],n),s.width=t.positions[0].width,s.height=t.positions[0].heigh;else{s.url=this.cropperService.getScatteredImgData(t.positions,n);let i=t.positions.filter(t=>!t.inactive);s.width=this.cropperService.maxWidthTo(i.length,t.positions),s.height=this.cropperService.sumHighTo(i.length,t.positions)}i.answers.push(s),t.positions.forEach(t=>{this.cropperService.fillColor("#ffffff",n[t.pageIndex],t.left,t.top,t.width,t.heigh)})}):s[t].strAns&&void 0!==s[t].strAns?(i.tempData.answerType=4,i.tempData.answerResult.push(s[t].strAns||"")):i.tempData.answerType=3;let u=s[t].help;if(u&&(u.remove&&this.cropperService.fillColor("#ffffff",n[u.remove.pageIndex],u.remove.left,u.remove.top,u.remove.width,u.remove.heigh),u.positions&&u.positions.length>0&&(i.help.url=this.cropperService.getScatteredImgData(u.positions,n))),1==d.length){var x=d[0];if(i.answers.length){var[g]=i.answers;x.heigh=g.y}i.question.url=this.cropperService.getSingleImgData(x,n),i.question.width=x.width,i.question.height=x.heigh}else{i.question.url=this.cropperService.getScatteredImgData(d,n);let t=d.filter(t=>!t.inactive);i.question.width=this.cropperService.maxWidthTo(t.length,d),i.question.height=this.cropperService.sumHighTo(t.length,d)}this.questionList.push(i)}}for(let t=0;t<this.questionList.length;t++)this.questionList[t].tempData.point=this.totalNumberQuestion?Number(this.totalPoint/this.totalNumberQuestion):0,this.questionList[t].index=t;let f=0;for(let t=0;t<this.groupLengths.length;t++)this.firstInGroupIndexes.push(f+this.groupLengths[t]),f+=this.groupLengths[t];this.completeCropper()}generateIdRequired(t){let s="z",n="abcdefghijklmnopqrstuvwxyz0123456789",i=n.length;for(let r=0;r<t;r++)s+=n.charAt(Math.floor(Math.random()*i));return s}createElementImage(t){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;var n="";return s&&(n=' style="width:'.concat((100*s[1].width/s[0].width).toFixed(2),'%"')),t?'<p><img class="quill-image" src="'.concat(t,'"').concat(n,"/></p>"):""}completeCropper(){let t=[],s=[],n=this.quizId,i=(10/this.questionList.filter(t=>t.tempData.isSelect&&t.answers.length).length).toFixed(2);console.log({groups:t,questions:s=this.questionList.map(s=>{(!s.group||t.length+1!=s.group)&&(t.length||s.group)||t.push({id:this.generateIdRequired(7),quizId:n,questions:[],content:this.createElementImage(s.groupUrl),title:"",audios:[]});let r=t[t.length-1],l={id:this.generateIdRequired(7),content:this.createElementImage(s.question.url),quizId:n,groupId:r.id,point:s.tempData.isSelect&&s.answers.length?i:0,label:"C\xe2u",number:s.question.label,type:s.answers.length?"TN":"TL",options:s.answers.map(t=>({text:this.createElementImage(t.url,[s.question,t]),label:t.label})),explain:"",keys:s.tempData.answerResult||[],level:"",shuffle:!!s.isFixAns};return r.questions.push(l.id),l})}),this.callback({status:"done",data:{groups:t,questions:s,quizId:this.quizId}})}parsePdf(t){let s=new b;s.loadPdf(t,t=>{let n=t.length,r=[],l=[],a=document.createElement("div");a.id="hiddenWrapper",a.style.width="1px",a.style.height="1px",a.style.overflow="hidden",a.style.opacity="0",a.style.zIndex="-9999",a.style.position="fixed",a.style.top="0",a.style.left="0",document.body.appendChild(a);let h=document.createElement("div"),c="canvasWrapper";h.id=c,a.appendChild(h);let d=new Date().getTime(),u=[];s.render(t,c,i.PdfConst.RENDER_SCALE,(s,i,a)=>{if(null!=s&&(r[i]=s,l[i]=a),u.push(1),this.updateStatusCallback&&this.updateStatusCallback("Rendering: ".concat(u.length,"/").concat(n)),u.length==n){let s=new Date().getTime();this.updateStatusCallback&&this.updateStatusCallback("Render done: "+(s-d)/1e3+" secs"),this.startAnalyze(r,l,t)}})})}startAnalyze(t,s,n){let r=n.length,a=[],h=[],c=[],u=[],x=new b,g=new Date().getTime();for(let f=0;f<r;f++){let v=f,b=x.getImages(n[f],v);for(let t of b)u.push(t);n[f].getTextContent().then(n=>{for(let t of b)n.items.push(this.imgToTextObj(t,n.items.length>0?n.items[0].fontName:""));var f,E=x.getLines(n,v,t[v],s[v]);if(h=h.concat(E),c[v]=n.styles,a.push(1),a.length==r){h.sort((t,s)=>1e7*t.pageIndex+(t.transform.length>0?t.transform[5]:0)-(1e7*s.pageIndex+(s.transform.length>0?s.transform[5]:0))),x.findAndSplitQuestAnsLine(h,c,t),""!=i.PdfConst.DRAW_RESULT&&console.log(h);let s=this.findEntityPos(h,c,t,x.imageCache,0),n=!1;for(let t of s)if(t.type==l.TYPE_NAME){n=!0;break}if(n||(s=this.findEntityPos(h,c,t,x.imageCache,1)),0==s.length)return void(this.onCompleteCallback&&this.onCompleteCallback([],t));let r=s[0].type==p.TYPE_NAME,a=r?JSON.parse(s[0].str):null,v=new Map,b=new Map;if(r){for(let t of a.main)v.set(t.num,t.str);for(let t of a.sub)b.set(t.num,t.str)}let E=this.getQuestionInfo(s,h,t,v);for(let t of(E.forEach(t=>{if(!v.has(t.num)&&!b.has(t.num)&&t.help&&t.help.text){let s=d.getAnsFromHelp(t.help.text);""!=s&&b.set(t.num,s)}}),E)){if(!t.isGroup&&0==t.answers.length&&v.has(t.num)){let s={pageIndex:t.remove.pageIndex,top:t.remove.top-1,left:t.remove.left-1,width:1,heigh:1};for(let n of["A","B","C","D"]){let i={label:n,remove:s,positions:[s]};v.get(t.num)==n&&(i.isCorrect=!0),t.answers.push(i)}t.isFixAns=!0}if(!t.isGroup&&0==t.answers.length&&!v.has(t.num)&&b.has(t.num)&&(t.strAns=b.get(t.num)),!t.isGroup&&t.answers.length>0&&!v.has(t.num)&&b.has(t.num))for(let s of t.answers)s.label==(null===(f=b.get(t.num))||void 0===f?void 0:f.toUpperCase().substring(0,1))&&(s.isCorrect=!0)}let T=new Date().getTime();this.updateStatusCallback&&this.updateStatusCallback("Analyze done: "+(T-g)/1e3+" secs"),this.showOnCanvas(E,s,h,t,u,i.PdfConst.DRAW_RESULT),this.onCompleteCallback&&this.onCompleteCallback(E,t)}})}}imgToTextObj(t,s){return{str:"img",fontName:s,width:t.paintWidth,height:t.paintHeight,transform:[-999,0,0,0,-t.left,-t.top-t.paintHeight]}}findEntityPos(t,s,n,i,r){let f=[],b=!1;var E=[{parser:new a,on:[],off:[]},{parser:new l(r),on:[3,4],off:[6]},{parser:new h,on:[3,6],off:[]},{parser:new c(!1),on:[6,8],off:[0,2]},{parser:new d(!1),on:[6,8],off:[0,2,4]},{parser:new u,on:[],off:[8]},{parser:new p(!1,t=>{for(let s of t)f.unshift(s)}),on:[],off:[2]},{parser:new x,on:[],off:[]},{parser:new g(!1,t=>{if(0!=t.length){if(f.length>0&&f[0].type==p.TYPE_NAME){let s=JSON.parse(t[0].str),n=JSON.parse(f[0].str);n.sub=s.sub,f[0].str=JSON.stringify(n)}else t[0].type=p.TYPE_NAME,f.unshift(t[0])}}),on:[],off:[2]}],T=[8,0,1,2,3,4,5,6,7],C=null;let I=0,w="";for(let i of t){for(let r of((I==t.length-1||i.pageIndex<t[I+1].pageIndex)&&(i.isLastLine=!0),T)){let t=E[r];var A=t.parser.process(f,i,I,C,s[i.pageIndex],n[i.pageIndex]);if(A.length>0){for(let t of A){if(t.type!=h.TYPE_NAME&&t.type!=x.TYPE_NAME&&(w=""),t.type==h.TYPE_NAME){if(!"ABCDEFGH".startsWith(w+t.str))continue;w+=t.str;for(let t=f.length-1;t>=0&&f[t].type==a.TYPE_NAME;t--)f.splice(t,1)}t.type==x.TYPE_NAME&&(i.isFooter=!0),t.type==d.TYPE_NAME&&(b=!0),t.type==u.TYPE_NAME&&b&&E[5].parser.off(),f.push(t)}for(let s of t.on)E[s].parser.on();for(let s of t.off)E[s].parser.off();break}}C=i,I++}for(let t of E)t.parser.off();return f.forEach(s=>{if(!t[s.lineIndex].top){let n=v.getTopLine(i[s.pageIndex],s.lineIndex,t);t[s.lineIndex].top=n[0],1!=s.isIntersec&&(s.isIntersec=n[1])}}),f.forEach(s=>{if(!t[s.lineIndex].bottom){let n=v.getBottomLine(i[s.pageIndex],s.lineIndex,t);t[s.lineIndex].bottom=n[0],1!=s.isIntersec&&(s.isIntersec=n[0])}}),f}showOnCanvas(t,s,n,r,g,f){let b=new Date().getTime(),E=new Map([["A","rgba(18, 0, 255, 0.4)"],["B","rgba(0, 158, 34, 0.4)"],["C","rgba(50, 50, 50, 0.4)"],["D","rgba(132, 0, 137, 0.4)"],["E","rgba(132, 0, 137, 0.4)"],["F","rgba(132, 0, 137, 0.4)"],["G","rgba(132, 0, 137, 0.4)"],["H","rgba(132, 0, 137, 0.4)"]]),T=new Map([[l.TYPE_NAME,"red"],[h.TYPE_NAME,"blue"],[c.TYPE_NAME,"gray"],[p.TYPE_NAME,"green"],[d.TYPE_NAME,"orange"],[u.TYPE_NAME,"pink"],[x.TYPE_NAME,"yellow"],[a.TYPE_NAME,"black"]]);if(f.indexOf("quest")>=0)for(let s of t){for(let t of s.positions)v.drawBox(r[t.pageIndex],s.isGroup?"black":"red",t);for(let t of(v.drawBox(r[s.remove.pageIndex],"yellow",s.remove),s.answers)){for(let s of t.positions)v.drawBox(r[s.pageIndex],E.get(t.label)+"",s,!0);v.drawBox(r[t.remove.pageIndex],"yellow",t.remove),t.isCorrect&&v.drawPoint(r[t.positions[0].pageIndex],"green",t.positions[0])}if(s.help){for(let t of s.help.positions)v.drawBox(r[t.pageIndex],"orange",t);s.help.remove&&v.drawBox(r[s.help.remove.pageIndex],"yellow",s.help.remove)}}if(f.indexOf("line")>=0)for(let t of n)v.drawBox2(r[t.pageIndex],t.height<i.PdfConst.LINE_SMALL_HEIGHT?"red":"rgba(50, 58, 168, 0.4)",t.width,t.height,t.transform);if(f.indexOf("txt")>=0)for(let t of n)for(let s of t.textObjs)""!=s.str.trim()&&v.drawBox2(r[t.pageIndex],t.height<i.PdfConst.LINE_SMALL_HEIGHT?"red":"rgba(132, 0, 137, 0.2)",s.width,s.height,s.transform);if(f.indexOf("img")>=0)for(let t of g)v.drawBox2(r[t.pageIndex],"green",t.paintWidth,t.paintHeight,[0,0,0,0,-t.left,-t.top-t.paintHeight]);if(f.indexOf("pos")>=0)for(let t of s){let s={top:t.transform[5],left:t.transform[4],width:0,heigh:0,pageIndex:t.pageIndex};v.drawPoint(r[t.pageIndex],T.get(t.type)+"",s)}let C=new Date().getTime();this.updateStatusCallback&&this.updateStatusCallback("Draw done: "+(C-b)/1e3+" secs")}getQuestionInfo(t,s,n,r){if(0==t.length)return[];let p=0,g=[],f=new Map,v="",b=!1,E=!1,T=0;for(let C of(t.forEach((n,i)=>{i>0&&null==t[i-1].text&&(t[i-1].text=s.slice(t[i-1].lineIndex,n.lineIndex)),i==t.length-1&&(t[i].text=s.slice(t[i].lineIndex,s.length))}),t.forEach(C=>{let I=":"+C.type;b||C.type!=c.TYPE_NAME&&C.type!=d.TYPE_NAME||(b=!0);let w=null;for(let s=p+1;s<t.length;s++)if((C.type!=l.TYPE_NAME||t[s].type!=h.TYPE_NAME)&&t[s].type!=x.TYPE_NAME){w=t[s];break}let A=n[C.pageIndex].canvas.height-20;if(b||C.type!=a.TYPE_NAME||(T++,g.push({num:T,answers:[],remove:a.getRemoveBox(C,s),positions:a.getBoxes(C,s,w,A),isGroup:!0,text:C.text})),b||C.type!=l.TYPE_NAME||g.push({num:+C.str,answers:[],remove:l.getRemoveBox(C,s),positions:l.getBoxes(C,s,w,A),group:T,text:C.text}),!b&&C.type==h.TYPE_NAME&&g.length>0){let t=g[g.length-1].num,n={label:C.str,remove:h.getRemoveBox(C,s),positions:h.getBoxes(C,s,w,A)};r.size>0&&r.get(t)==n.label&&(n.isCorrect=!0),g[g.length-1].answers.push(n);let l=s[C.lineIndex].strLine.replace(/\|/g,"").trim().match(i.PdfConst.MULTIPLE_ANS_PATTERN.join("|"));null!=l&&l.length>0&&(g[g.length-1].isFixAns=!0),1==C.isIntersec&&(g[g.length-1].isFixAns=!0)}if(!E&&C.type==u.TYPE_NAME&&1==g.length&&v.endsWith(":".concat(l.TYPE_NAME,":").concat(h.TYPE_NAME))&&(E=!0),C.type==u.TYPE_NAME&&E){let t=g[g.length-1].num;f.set(t,{num:t,positions:u.getBoxes(C,s,w,A),text:C.text})}if(C.type!=u.TYPE_NAME||E||(f.clear(),b=!0),b&&C.type==l.TYPE_NAME){let t=+C.str;f.get(t)||f.set(t,{num:t,positions:l.getBoxes(C,s,w,A),remove:l.getRemoveBox(C,s),text:C.text})}v.endsWith(I)||C.type==x.TYPE_NAME||(v+=I),p++}),g))C.isGroup||(C.help=f.get(C.num),1==C.answers.length&&(C.answers=[]));return g}constructor(t,s){var n,r,l;this.cropperService=new f,this.labelHolderSize={width:3500,height:3500},this.totalPoint=10,this.quizId=t,this.callback=s;let a={RENDER_SCALE:2,LINE_SMALL_HEIGHT:8,SPLIT_MARGIN:3,INTERSEC_MARGIN:10,LINE_MAGIN:2,MARGIN_LEFT:2,ENABLE_IMAGE_PROCESS:!0,STEP_SIZE:3,CROP_FULL_WIDTH:!0,OVERLAP:.5,QUESTION_PATTERN:["(^c\xe2u\\s*\\d{1,4}[^0-9])","(^câu\\s*\\d{1,4}[^0-9])","(^c\xa9u\\s*\\d{1,4}[^0-9])","(^ca‚u\\s*\\d{1,4}[^0-9])","(^b\xe0i\\s*\\d{1,4}[^0-9])","(^bài\\s*\\d{1,4}[^0-9])","(^cau\\s*\\d{1,4}[^0-9])","(^bai\\s*\\d{1,4}[^0-9])","(^question\\s*\\d{1,4}[^0-9])","(^questions\\s*\\d{1,4}[^0-9])","(^\\[\\d{1,4}\\][^0-9])","(^\\d+\\s*\\(nb\\))","(^\\d+\\s*\\(th\\))","(^\\d+\\s*\\(vd\\))","(^\\d+\\s*\\(vdc\\))","(^c\xe2u\\s*\\d{1,4}[\\s\\.:]*$)","(^câu\\s*\\d{1,4}[\\s\\.:]*$)","(^c\xa9u\\s*\\d{1,4}[\\s\\.:]*$)","(^ca‚u\\s*\\d{1,4}[\\s\\.:]*$)","(^b\xe0i\\s*\\d{1,4}[\\s\\.:]*$)","(^bài\\s*\\d{1,4}[\\s\\.:]*$)","(^cau\\s*\\d{1,4}[\\s\\.:]*$)","(^bai\\s*\\d{1,4}[\\s\\.:]*$)","(^questions\\s*\\d{1,4}[\\s\\.:]*$)","(^question\\s*\\d{1,4}[\\s\\.:]*$)"],QUESTION_PATTERN2:["(^(\\d+\\s*\\.)\\s*[\\.0-9])","(^(\\d+\\s*\\.)\\s*\\(\\s*\\d+\\s*\\))","(^(\\d+\\s*\\.)\\s*[^\\s]\\s*[^\\s0-9])","(^\\d+\\s*\\.\\s*$)"],BREAK_LINE_PATTERN:["(^C\xe2u\\s*\\d+\\s*[:\\.]\\s*[Aa]\\s*\\.)","(^C\xa9u\\s*\\d+\\s*[:\\.]\\s*[Aa]\\s*\\.)","(^B\xe0i\\s*\\d+\\s*[:\\.]\\s*[Aa]\\s*\\.)","(^Cau\\s*\\d+\\s*[:\\.]\\s*[Aa]\\s*\\.)","(^Bai\\s*\\d+\\s*[:\\.]\\s*[Aa]\\s*\\.)","(^Question\\s*\\d+\\s*[:\\.]\\s*[Aa]\\s*\\.)","(^\\d+\\s*[:\\.]\\s*[Aa]\\s*\\.)"],SECTION_PATTERN_LOWER:["(^mark\\s*the\\s*letter)","(^read\\s*the\\s*follow)","(^reading\\s*the\\s*follow)","(^read\\s*the\\s*text)","(^read\\s*the\\s*passage)","(^read\\s*the\\s*paragraph)","(^read\\s*and\\s*choose)","(^put\\s*these\\s*word)","(^supply\\s*the\\s*correct)","(^make\\s*questions?\\s*for)","(^fill\\s*in\\s*the\\s*blank)","(^fill\\s*in\\s*each\\s*numbered)","(write\\s*the\\s*months\\s*in\\s*english)","(write\\s*the\\s*telephone\\s*numbers\\s*in\\s*english)","(^which\\s*of\\s*the\\s*following)","(^choose\\s*the\\s*suitable\\s*word)","(^choose\\s*the\\s*word)","(^choose\\s*the\\s*option)","(^choose\\s*the\\s*item\\s*among)","(^choose\\s*the\\s*underlined\\s*word)","(^combine\\s*two\\s*sentences)","(^each\\s*of\\s*the\\s*following)","(^finish\\s*the\\s*second\\s*sentence)","(^identify\\s*the\\s*underlined)","(^identify\\s*a\\s*mistake)","(^indicate\\s*the\\s*word)","(^indicate\\s*the\\s*correct)","(^indicate\\s*the\\s*sentence)","(^indicate\\s*the\\s*underlined)","(^circle\\s*the\\s*underlined)","(^circle\\s*the\\s*word\\s*whose\\s*underlined)","(^choose\\s*the\\s*underlined)","(^\\*?find\\s*the\\s*word)","(^find\\s*a\\s*mistake)","(^fill\\s*the\\s*circle)","(^listen\\s*to.*conversation)","(^there\\s*are.*blanks\\s*in\\s*the\\s*passage\\s*below)","(^listen\\s*to\\s*the\\s*recording)","(^listen\\s*and\\s*circle)","(^listen\\s*again\\s*and\\s*choose)","(^\\*?listen\\s*and\\s*complete)","(^\\*?choose\\s*the\\s*best)","(^choose\\s*the\\s*correct)","(^put\\s*in\\s*the\\s*correct)","(^complete\\s*the\\s*second\\s*sentence)","(^complete\\s*the\\s*sentences)","(^give\\s*the\\s*correct\\s*form)","(^mark\\s*a,\\s*b,)","(^circle\\s*the\\s*letter)","(^you\\s*will\\s*hear)","(^blacken\\s*the\\s*letter)","(^đọc\\s*đoạn\\s*tr\xedch)","(^dựa\\s*v\xe0o\\s*th\xf4ng\\s*tin\\s*dưới\\s*đ\xe2y)","(^dựa\\s*v\xe0o\\s*c\xe1c\\s*th\xf4ng\\s*tin\\s*được\\s*cung\\s*cấp\\s*dưới\\s*đ\xe2y)","(^section\\s*[0-9abcdefghivx]+)","(^part[^a-z]+[0-9abcdefghivx]+\\s*[\\.:\\-])","(^phần\\s*[0-9abcdefivx]+[\\.:])","(^nh\xf3m\\s*[0-9abcdefivx]+[\\.:])","(^chương\\s*[0-9abcdefivx]+[\\.:])","(^questions?\\s*\\d+\\s*[\\–\\-to]+\\s*\\d+)","(^passage\\s*[0-9abcdefghivx]+)","(^use\\s*the\\s*word\\s*given\\s*in\\s*capitals)","(^tự\\s*luận)"],SECTION_PATTERN_NORMAL:["(^[IVX]+\\s*[\\.\\-\\–]\\s*[A-Z\xc0Ả\xc3\xc1ẠĂẰẲẴẮẶ\xc2ẦẨẪẤẬĐ\xc8ẺẼ\xc9Ẹ\xcaỀỂỄẾỆ\xccỈĨ\xcdỊ\xd2Ỏ\xd5\xd3Ọ\xd4ỒỔỖỐỘƠỜỞỠỚỢ\xd9ỦŨ\xdaỤƯỪỬỮỨỰỲỶỸ\xddỴ]+)","(^[\\d]+\\.[\\d]+\\.[\\d]*\\.*\\s*[A-Z\xc0Ả\xc3\xc1ẠĂẰẲẴẮẶ\xc2ẦẨẪẤẬĐ\xc8ẺẼ\xc9Ẹ\xcaỀỂỄẾỆ\xccỈĨ\xcdỊ\xd2Ỏ\xd5\xd3Ọ\xd4ỒỔỖỐỘƠỜỞỠỚỢ\xd9ỦŨ\xdaỤƯỪỬỮỨỰỲỶỸ\xddỴ]+)","(^[IVX]+\\s*[\\.:]\\s*$)"],KICK_PATTERN:["(^Chọn\\s*[ABВCDEFGHIJK]+)","(^Chon\\s*[ABВCDEFGHIJK]+)"],TVCN_CHAR:[["Α","A"],["В","B"]],HET_PATTERN:["(HẾT)","(H\xcáT)","(HET)","(\\-\\-HT\\-\\-)","(THE\\s*END)","(The\\s*end[^a-z0-9]*$)","(^[^A-Za-z]*Hết[^A-Za-z]*)$"],DAPAN_PATTERN:["(\xc1P \xc1N)","(\xc1P \xc1)","(\xc1P\xc1N)","(ÁP ÁN)","(BẢNG\xc1\xc1)","(KHO\xc1\\s*C\xc2U\\s*TRẮC\\s*NGHIỆM)","(ÁPÁN)","(ANSWER KEYS)","(^KEYS$)","(Bảng\\s*đ\xe1p\\s*\xe1n)","(Đ\xe1p\\s*\xe1n\\s*v\xe0\\s*hướng)","(Dap\\s*an\\s*va\\s*huong)","(Đ\xe1p\\s*\xe1n\\s*[.:]\\s*$)","(Đ\xe1p\\s*\xe1n\\s*$)"],HUONGDAN_PATTERN:["(HƯỚNG\\s*DẪN)","(ƯỚNG\\s*DẪN\\s*GIẢI\\s*CHI)","(GIẢI\\s*TH\xcdCH\\s*CHI\\s*TIẾT)","(Hướng\\s*dẫn\\s*giải)","(Lời\\s*giải)","(LỜI\\s*GIẢI)","(GIẢI\\s*CHI\\s*TIẾT)","(HD:)","(GLOSSARY)"],MULTIPLE_ANS_PATTERN:["([ABCDEFGH]\\s*v\xe0\\s*[ABCDEFGH]\\s*đều)","(Cả\\s*[ABCDEFGH]\\s*v\xe0\\s*[ABCDEFGH])","(Cả\\s*[ABCDEFGH]\\s*,\\s*[ABCDEFGH])","(Cả\\s*3\\s*đ\xe1p\\s*\xe1n)","(Cả\\s*đ\xe1p\\s*\xe1n)","(Tất\\s*cả\\s*đ\xe1p\\s*\xe1n)","(Kết\\s*quả\\s*kh\xe1c)","(Đ\xe1p\\s*\xe1n\\s*kh\xe1c)","(Đ\xe1p\\s*\xe1n\\s*[ABCDEFGH]\\s*v\xe0\\s*[ABCDEFGH])","(Tất\\s*cả\\s*đều)"],DRAW_RESULT:"",SKIP_CHAR:["","√","p","(",")","[","]","{","}",""],FOOTER_PATTERN:["(trang\\s*\\d+)","(Page\\s*\\d+)","(Trang\\s*\\d+)","(TRANG\\s*\\d+)","(^\\d{1,4}$)","(^[\\-\\s]*\\d{1,4}[\\-\\s]*$)"],HELP_ANS_PATTERN:["([\\s\\.]*Chọn\\s*([A-K]))","([\\d\\s\\.:]*Đ\xe1p\\s*\xe1n\\s*([A-K]))","([\\d\\s\\.:]*Đ\xe1p\\s*\xe1n\\s*l\xe0\\s*([A-K]))","([\\d\\s\\.:]*Chọn\\s*đ\xe1p\\s*\xe1n\\s*([A-K]))"],RES_ANS_PATTERN:["(\\d+[.-][^|0-9])"],STRANS_SPLIT:"|/\\"};i.PdfConst.RENDER_SCALE=a.RENDER_SCALE,i.PdfConst.LINE_SMALL_HEIGHT=a.LINE_SMALL_HEIGHT*i.PdfConst.RENDER_SCALE,i.PdfConst.SPLIT_MARGIN=a.SPLIT_MARGIN*i.PdfConst.RENDER_SCALE,i.PdfConst.INTERSEC_MARGIN=a.INTERSEC_MARGIN*i.PdfConst.RENDER_SCALE,i.PdfConst.LINE_MAGIN=a.LINE_MAGIN*i.PdfConst.RENDER_SCALE,i.PdfConst.MARGIN_LEFT=a.MARGIN_LEFT*i.PdfConst.RENDER_SCALE,i.PdfConst.ENABLE_IMAGE_PROCESS=a.ENABLE_IMAGE_PROCESS,i.PdfConst.STEP_SIZE=a.STEP_SIZE,i.PdfConst.CROP_FULL_WIDTH=a.CROP_FULL_WIDTH,i.PdfConst.OVERLAP=a.OVERLAP,i.PdfConst.QUESTION_PATTERN=a.QUESTION_PATTERN,i.PdfConst.QUESTION_PATTERN2=a.QUESTION_PATTERN2,i.PdfConst.BREAK_LINE_PATTERN=a.BREAK_LINE_PATTERN,i.PdfConst.SECTION_PATTERN_LOWER=a.SECTION_PATTERN_LOWER,i.PdfConst.SECTION_PATTERN_NORMAL=a.SECTION_PATTERN_NORMAL,i.PdfConst.KICK_PATTERN=a.KICK_PATTERN,i.PdfConst.TVCN_CHAR=a.TVCN_CHAR,i.PdfConst.HET_PATTERN=a.HET_PATTERN,i.PdfConst.DAPAN_PATTERN=a.DAPAN_PATTERN,i.PdfConst.HUONGDAN_PATTERN=a.HUONGDAN_PATTERN,i.PdfConst.MULTIPLE_ANS_PATTERN=a.MULTIPLE_ANS_PATTERN,i.PdfConst.DRAW_RESULT=a.DRAW_RESULT,i.PdfConst.SKIP_CHAR=a.SKIP_CHAR,i.PdfConst.FOOTER_PATTERN=null!==(n=a.FOOTER_PATTERN)&&void 0!==n?n:["(trang\\s*\\d+)","(Page\\s*\\d+)","(Trang\\s*\\d+)","(TRANG\\s*\\d+)","(^\\d{1,4}$)"],i.PdfConst.HELP_ANS_PATTERN=null!==(r=a.HELP_ANS_PATTERN)&&void 0!==r?r:["([\\s\\.]*Chọn\\s*([ABCDEFGH]))"],i.PdfConst.ANS_PATTERN=null!==(l=a.ANS_PATTERN)&&void 0!==l?l:["([\\s\\|\\.]+[ABCDEFGHIJK][\\s\\|]*[\\.\\)])"]}}},6591:function(t,s,n){"use strict";Object.defineProperty(s,"__esModule",{value:!0});let i=n(8754),r=i._(n(6781)),l=i._(n(9716)),a=(t,s)=>{var n=document.createElement("script");n.type="text/javascript",n.src=t,n.onload=s,document.head.appendChild(n)},h=(t,s)=>{var n=0;!function i(){n<t.length?a(t[n],function(){n++,i()}):"function"==typeof s&&s()}()},c=(t,s)=>{let n=document.createElement("input");n.setAttribute("type","file"),n.setAttribute("accept",".pdf,.docx"),n.click(),n.onchange=async()=>{let[i]=n.files;if(i){s({status:"loading",data:{status:"Đang xử l\xfd tệp tin"}});try{i.name.endsWith(".docx")?h(["/scripts/docx.js","/scripts/sprintf.min.js","/scripts/bundle.js","/scripts/wmf.v1.js","/scripts/FromEMF.f1.js","/scripts/ToContext2D.f1.js","/scripts/UDOC.f1.js","/scripts/mathml2latex.js"],function(){let n=new r.default(t,s);n.parseDocx(i)}):i.name.endsWith(".pdf")?h(["/scripts/pdf.js","/scripts/pdf.worker.js"],function(){let n=new l.default(t,s);n.parsePdf(i)}):s({error:"Định dạng kh\xf4ng hỗ trợ. Vui l\xf2ng sử dụng tập tin định dạng .pdf hoặc .docx"})}catch(t){console.error("Error uploading image:",t),s({error:"Error uploading image:"})}}}};t.exports={ImportFile:c}},8232:function(t,s,n){"use strict";var i=n(5893),r=n(7294),l=n(1903);let a=t=>(t||"").toLowerCase().split(" ").map(function(t){return t.replace(t.charAt(0),t.charAt(0).toUpperCase())}).join(" "),h=t=>{let s=Object.fromEntries(Object.entries(t).filter(t=>{let[s]=t;return!["onSearch","capitalize","uppercase","timeout"].includes(s)})),[n,h]=(0,r.useState)(t.value||""),c=(0,r.useRef)(null),d=s=>{var{value:n}=s.target;n=t.uppercase?(n||"").toLocaleUpperCase():n||"",h(n=t.capitalize?a(n||""):n||""),clearTimeout(c.current),c.current=setTimeout(()=>{t.onChange&&t.onChange(n)},t.timeout||500)};return(0,r.useEffect)(()=>()=>{clearTimeout(c.current)},[]),(0,r.useEffect)(()=>{t.value!=n&&h(t.value||"")},[t.value]),(0,i.jsx)(l.Z,{...s,onChange:d,value:n})};s.Z=h}},function(t){t.O(0,[327,1,253,774,888,179],function(){return t(t.s=4264)}),_N_E=t.O()}]);