(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[871],{5603:function(t,n,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/p/[slug]",function(){return s(1744)}])},1744:function(t,n,s){"use strict";s.r(n),s.d(n,{default:function(){return nY}});var i=s(5893),r=s(1163),l=s(7294),a=s(8305),c=s(6822),h=s(5861),d=s(4386),u=s(3321),x=s(3946),p=s(1649),f=s(2078),g=s(131),v=s(7052),b=s(7715),j=s.n(b),y=s(5591),C=s(1674),w=s(9878),T=s(1117),I=s(7274);let E=async t=>{try{let n=new FormData;n.append("image",t);let{data:s}=await I.default.post("/uploads",n,{headers:{"Content-Type":"multipart/form-data"}}),{error:i,url:r}=s;if(i)return await Z(n);return s}catch(t){return console.log("uploadImage",t),{error:"Lỗi uploadImage"}}},Z=async t=>{try{let s=["3dc71c29dd62dd5","d7a0e7522c8cb79","0f8d50b5b4afbcc"];var n=new Headers;n.append("Authorization","Client-ID "+s[Math.floor(Math.random()*s.length)]);let i=await fetch("https://api.imgur.com/3/upload",{method:"POST",headers:n,body:t,redirect:"follow"}),r=await i.json();return{url:r.data.link}}catch(t){return console.log("uploadImgur",t),{error:"Tải h\xecnh ảnh thất bại"}}};var A=s(6455),P=s.n(A),S=s(6501),N=s(6886),k=s(8262),_=s(948),L=s(6628),M=s(9581),R=s(1425),O=s(1903),H=s(7109),z=s(6485),B=s.n(z);let q=t=>t&&("TEXTAREA"===t.nodeName||"INPUT"===t.nodeName);var F=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=(0,l.useRef)(null),s=()=>{t.onSuccess&&t.onSuccess(),t.selectOnCopy&&q(n.current)&&n.current.select()},i=()=>{t.onError&&t.onError();let s=!1!==t.selectOnError;s&&q(n.current)&&n.current.select()},r=t=>{B()(t).then(s).catch(i)},a=(0,l.useCallback)(t=>{"string"==typeof t?r(t):n.current&&r(n.current.value)},[]);return{copy:a,target:n}};let G=(0,_.ZP)(x.Z)(t=>{let{theme:n}=t;return{top:0,right:0,color:"grey.500",position:"absolute",boxShadow:n.shadows[2],transform:"translate(10px, -10px)",borderRadius:n.shape.borderRadius,backgroundColor:"".concat(n.palette.background.paper," !important"),transition:"transform 0.25s ease-in-out, box-shadow 0.25s ease-in-out","&:hover":{transform:"translate(7px, -5px)"}}}),W=(0,l.forwardRef)(function(t,n){return(0,i.jsx)(L.Z,{ref:n,...t})}),Y=t=>{let{show:n,setShow:s,data:r}=t,l=F(),a=()=>{s(!1)},d=t=>()=>{l.copy(t),S.ZP.success("Đ\xe3 sao ch\xe9p th\xe0nh c\xf4ng!",{duration:3e3})};return(0,i.jsxs)(k.Z,{fullWidth:!0,open:n,maxWidth:"sm",scroll:"body",onClose:a,onBackdropClick:a,TransitionComponent:W,sx:{"& .MuiDialog-paper":{overflow:"visible"}},children:[(0,i.jsxs)(M.Z,{sx:{pb:t=>"".concat(t.spacing(8)," !important"),px:t=>["".concat(t.spacing(5)," !important"),"".concat(t.spacing(15)," !important")],pt:t=>["".concat(t.spacing(8)," !important"),"".concat(t.spacing(12.5)," !important")]},children:[(0,i.jsx)(G,{onClick:a,children:(0,i.jsx)(w.Z,{icon:"tabler:x",fontSize:"1.25rem"})}),(0,i.jsxs)(c.Z,{sx:{mb:4,textAlign:"center"},children:[(0,i.jsx)(h.Z,{variant:"h3",sx:{mb:3},children:"Cập nhật th\xe0nh c\xf4ng \uD83C\uDF89"}),(0,i.jsx)(h.Z,{sx:{color:"text.secondary"},children:"Copy link b\xean dưới v\xe0 gửi cho học sinh. Học sinh truy cập link để l\xe0m b\xe0i v\xe0 nộp b\xe0i."})]}),(0,i.jsxs)(N.ZP,{container:!0,spacing:6,children:[(0,i.jsx)(N.ZP,{item:!0,xs:12,children:(0,i.jsx)(O.Z,{label:"Link đề thi",fullWidth:!0,sx:{m:1},InputProps:{endAdornment:(0,i.jsx)(H.Z,{position:"end",children:(0,i.jsx)(u.Z,{variant:"contained",endIcon:(0,i.jsx)(w.Z,{icon:"tabler:copy"}),onClick:d((null==r?void 0:r.url)||""),children:"Sao ch\xe9p"})}),readOnly:!0},InputLabelProps:{shrink:!0},variant:"outlined",value:(null==r?void 0:r.url)||""})}),(0,i.jsx)(N.ZP,{item:!0,xs:12,children:(0,i.jsx)(O.Z,{label:"M\xe3 nh\xfang Website",fullWidth:!0,sx:{m:1},InputLabelProps:{shrink:!0},InputProps:{endAdornment:(0,i.jsx)(H.Z,{position:"end",children:(0,i.jsx)(u.Z,{variant:"contained",endIcon:(0,i.jsx)(w.Z,{icon:"tabler:copy"}),color:"success",onClick:d('<iframe width="100%" height="900" src="'.concat(null==r?void 0:r.url,'"  title="').concat(null==r?void 0:r.title,'" frameborder="0" allow="accelerometer;autoplay;clipboard-write;encrypted-media; gyroscope; picture-in-picture" allowfullscreen> </iframe>')),children:"Sao ch\xe9p"})}),readOnly:!0},variant:"outlined",value:'<iframe width="100%" height="900" src="'.concat(null==r?void 0:r.url,'"  title="').concat(null==r?void 0:r.title,'" frameborder="0" allow="accelerometer;autoplay;clipboard-write;encrypted-media; gyroscope; picture-in-picture" allowfullscreen> </iframe>')})})]})]}),(0,i.jsx)(R.Z,{sx:{justifyContent:"center",px:t=>["".concat(t.spacing(5)," !important"),"".concat(t.spacing(15)," !important")],pb:t=>["".concat(t.spacing(8)," !important"),"".concat(t.spacing(12.5)," !important")]},children:(0,i.jsx)(u.Z,{variant:"contained",sx:{mr:1},onClick:a,children:"OK"})})]})},U=t=>j().gzipSync(JSON.stringify(t)).toString("base64"),$=t=>{if(t){var n=document.getElementById(t);if(n){var s=n.getBoundingClientRect().top+window.pageYOffset;window.scrollTo({top:s-100,behavior:"smooth"})}}},V=()=>{let t=(0,p.v9)(t=>t.quiz),n=(0,p.I0)(),s=(0,r.useRouter)(),[a,b]=(0,l.useState)(!1),[j,Z]=(0,l.useState)({}),[A,S]=(0,l.useState)(!1),N=(0,l.useRef)(null),k=()=>{n((0,f.z)({status:"settings",data:{}}))};(0,l.useEffect)(()=>{A&&L()},[A]);let _=t=>{let n=s.asPath.split("?")[0],i=new URLSearchParams(t).toString(),r="".concat(n,"?").concat(i);s.replace(r,void 0,{shallow:!0})},L=()=>{n((0,v.V)({status:"Đang xử l\xfd...."}));let i=t.groups.filter(n=>t.quizs.flatMap(t=>t.groups).includes(n.id)),r=t.questions.filter(t=>i.flatMap(t=>t.questions).includes(t.id)).map(t=>"TL"==t.type?{...t,options:[]}:t);new T.Image(r).start(async r=>{var l,a,c,h,d;let{error:u,success:x}=r;if(u||!x.length)return n((0,v.V)({status:""})),S(!1),P().fire({icon:"error",title:"Oppss...",html:"Vui l\xf2ng thử lại sau!"+u});let p=t=>{for(var n=t.split(","),s=n[0].match(/:(.*?);/),i=atob(n[1]),r=i.length,l=new Uint8Array(r);r--;)l[r]=i.charCodeAt(r);let a=s&&s.length>0?s[1]:"png";return new File([l],"hinhanh.".concat(a.split("/")[1]),{type:a})},f=async t=>{let n=[];for(let s=0;s<t.length;s+=3){let i=t.slice(s,s+3);n.push(i)}let s=[];for(let t=0;t<n.length;t++){let i=n[t],r=i.map(async t=>{let n;let s=[],i=t.content||"",r=/<img.*?src="(data:image\/[^;]+;base64,.*?)".*?>/g;for(;n=r.exec(i);){let t=n[1],i=await E(p(t));s.push((null==i?void 0:i.url)||t)}let l=i.replace(r,(t,n)=>{let i=s.shift();return'<img src="'.concat(i,'" >')});return{...t,content:l}}),l=await Promise.all(r);s.push(...l)}return s},j=t=>{let n=document.createElement("div");n.innerHTML=t||"";let s=n.getElementsByClassName("ql-formula");for(let t=s.length-1;t>=0;t--){let n=s[t];n.innerHTML=""}let i=n.getElementsByTagName("img");for(let t=0;t<i.length;t++){let n=i[t];n.src.startsWith("data:image/")&&(n.src="")}return n.innerHTML},C=async t=>{let n;if(!t)return"";let s=/<img.*?src="(data:image\/[^;]+;base64,.*?)".*?>/g,i=[];for(;n=s.exec(t);){let t=n[1],s=await E(p(t));i.push((null==s?void 0:s.url)||t)}let r=t.replace(s,(t,n)=>{let s=i.shift();return'<img src="'.concat(s,'" >')});return r},w=await C((null===(l=t.settings)||void 0===l?void 0:l.subtitle)||""),A=t=>new Promise(n=>{var s=new XMLHttpRequest;s.open("GET",t,!0),s.responseType="blob",s.onload=function(){if(200===s.status){var t=s.response,i=t.type;n(new File([t],"audio_file.mp3",{type:i}))}},s.send()}),N=async t=>{let n=[];for(var s=0;s<t.length;s++){var i=t[s];if(null==i?void 0:null===(r=i.audios)||void 0===r?void 0:r.length){for(var r,l,a=[],c=0;c<(null==i?void 0:null===(l=i.audios)||void 0===l?void 0:l.length);c++){var h=null==i?void 0:i.audios[c];if((null==h?void 0:h.type)=="audio"&&/^blob\:/i.test(null==h?void 0:h.src)){var{url:d}=await E(await A(null==h?void 0:h.src));a.push({...h,src:d})}else a.push(h)}n.push({...i,audios:a})}else n.push(i)}return n},k=await N(await f(i));x=await N(x),n((0,g.Be)({groups:k})),n((0,g.QV)({questions:x})),n((0,g.kQ)({subtitle:w})),n((0,g.kQ)({subtitle:w}));let L=x.map(t=>({...t,content:j(t.content||""),explain:j(t.explain||""),options:(t.options||[]).map(t=>({...t,text:j(t.text)}))})),M={...t.settings,subtitle:w,parent:(null==s?void 0:null===(a=s.query)||void 0===a?void 0:a.parent)||"",id:(null==t?void 0:null===(c=t.settings)||void 0===c?void 0:c.id)||(null==s?void 0:null===(h=s.query)||void 0===h?void 0:h.id)||""},R={questions:[...null==t?void 0:null===(d=t.quizs)||void 0===d?void 0:d.map(t=>({quizs:U(t),id:t.id,v:T.Version})),...null==k?void 0:k.map(t=>({groups:U(t),id:t.id,quizId:t.quizId,v:T.Version})),...null==L?void 0:L.map(t=>({questions:U(t),id:t.id,quizId:t.quizId,groupId:t.groupId,level:t.level,shuffle:t.shuffle,v:T.Version}))],settings:[{settings:U({...M,collects:void 0,students:void 0}),v:T.Version},...((null==M?void 0:M.collects)||[]).map(t=>({collects:U(t),v:T.Version})),...((null==M?void 0:M.students)||[]).map(t=>({students:U(t),v:T.Version,username:(null==t?void 0:t.username)||t}))],results:{...M,students:void 0,quizType:(null==L?void 0:L.filter(t=>"TL"==t.type).length)?"Hỗn hợp":"Trắc nghiệm",numberQuestions:Math.max(...null==k?void 0:k.map(t=>t.questions.length))}};n((0,v.V)({status:"Đang lưu"}));let O=(await I.default.post("/quizs",R)).data;if(O.error)return n((0,v.V)({status:""})),S(!1),P().fire({icon:"error",title:"Oops...",text:O.error,footer:'<a href="#">Why do I have this issue?</a>'});n((0,g.kQ)({id:O.id})),n((0,g.kQ)({url:O.url})),(0,y.JG)(O.parent?"/exams/".concat(O.parent):"/exams",O,{revalidate:!1,populateCache:(t,n)=>s.query.id?(n||[]).map(t=>t.id==s.query.id?O:t):[...n||[],t]}),n((0,v.V)({status:""})),b(!0),Z(O),S(!1),_({parent:O.parent,id:O.id})})},M=()=>{N.current.postMessage({action:"checkErrorCreate",payload:t})},R=async()=>{try{var t,i;let{id:r="",parent:l=""}=s.query;if(!r){n((0,g._e)({quizs:[],groups:[],questions:[],settings:{collects:[{label:"Họ v\xe0 t\xean"},{label:"Lớp"}],students:[],title:""}})),n((0,g.BT)()),n((0,v.V)({status:""}));return}let a=(await (0,I.default)("/quizs/".concat(r,"/details?parent=").concat(l))).data;if(null==a?void 0:a.error){P().fire({icon:"error",title:"Oops...",text:a.error,footer:'<a href="#">Why do I have this issue?</a>'}),n((0,v.V)({status:""})),s.push("/p/create.html");return}if(!((null==a?void 0:a.questions.length)&&(null==a?void 0:a.settings.length)&&(null==a?void 0:null===(t=a.results)||void 0===t?void 0:t.sheetId))){n((0,v.V)({status:"Đang đồng bộ dữ liệu đề thi..."}));let{data:t}=await I.default.post("/quizs/".concat(r,"/sync?parent=").concat(l));if(t.error)return s.push("/"),P().fire({icon:"error",title:"Oops...",text:t.error,footer:'<a href="#">Why do I have this issue?</a>'});n((0,v.V)({status:"Đang đồng bộ dữ liệu b\xe0i l\xe0m..."}));let{data:i}=await I.default.post("/leaderboard/".concat(r,"/sync?parent=").concat(l));if(i.error)return P().fire({icon:"error",title:"Oops...",text:i.error,footer:'<a href="#">Why do I have this issue?</a>'});return R()}return null==N?void 0:null===(i=N.current)||void 0===i?void 0:i.postMessage({action:"fetchCreate",payload:a})}catch(t){return console.log("fetchData",t),P().fire({icon:"error",title:"Oops...",text:"Vui l\xf2ng li\xean hệ Admin để được hỗ trợ",footer:'<a href="#">Why do I have this issue?</a>'})}};return(0,l.useEffect)(()=>(n((0,v.V)({status:"Đang tải..."})),s.isReady&&(N.current&&N.current.terminate(),fetch("".concat(C.default.assetPrefix,"/scripts/worker.js")).then(t=>t.blob()).then(t=>{N.current=new Worker(URL.createObjectURL(t)),N.current.onmessage=async t=>{let{action:s="",payload:i=null}=t.data;switch(s){case"fetchCreate":n((0,g._e)(i)),setTimeout(()=>{n((0,v.V)({status:""}))},500);break;case"checkErrorCreate":let{errors:r,warnings:l}=i;if(r.length)return $(r[0].id),P().fire({icon:"error",title:"Oops...",text:r[0].text,footer:'<a href="#">Why do I have this issue?</a>'});l.length?P().fire({title:"Ch\xfa \xfd",html:'<p>Hệ thống ph\xe1t hiện một số vấn đề sau, bạn h\xe3y kiểm tra lại n\xf3 trước khi lưu đề thi.</p><ul style=" text-align: left; ">'.concat(l.map(t=>"<li>".concat(t,"</li>")).join(""),"</ul>"),icon:"warning",showCancelButton:!0,confirmButtonText:"Vẫn lưu",cancelButtonText:"Huỷ"}).then(t=>{t.isConfirmed&&S(!0)}):S(!0)}},R()})),()=>{N.current&&N.current.terminate(),n((0,v.V)({status:""}))}),[s]),(0,l.useEffect)(()=>()=>{n((0,v.V)({status:""}))},[]),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(c.Z,{sx:{width:"100%",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,i.jsx)(c.Z,{className:"actions-left",sx:{mr:2,display:"flex",alignItems:"center"},children:(0,i.jsx)(h.Z,{variant:"h5",sx:{cursor:"text",overflow:"hidden",textOverflow:"ellipsis",lineHeight:1.5,maxHeight:"3rem"},onClick:k,children:t.settings.title})}),(0,i.jsxs)(c.Z,{className:"actions-right",sx:{display:"flex",alignItems:"center"},children:[(0,i.jsx)(d.Z,{title:"Chỉnh sửa c\xe0i đặt",children:(0,i.jsx)(x.Z,{color:"inherit",sx:{mr:1},onClick:k,children:(0,i.jsx)(w.Z,{fontSize:"1.5rem",icon:"tabler:settings-filled"})})}),(0,i.jsx)(u.Z,{variant:"contained",color:"success",startIcon:(0,i.jsx)(w.Z,{icon:"tabler:device-floppy"}),onClick:M,children:(0,i.jsx)(h.Z,{variant:"body",children:"LƯU"})})]}),(0,i.jsx)(Y,{show:a,setShow:b,data:j})]}),(0,i.jsx)(c.Z,{sx:{position:"fixed",bottom:15,right:"3.85rem",zIndex:1031},children:(0,i.jsx)(u.Z,{variant:"contained",startIcon:(0,i.jsx)(w.Z,{icon:"tabler:device-floppy"}),onClick:M,color:"error",sx:{boxShadow:"0 1px 20px 1px #EA5455!important",":hover":{boxShadow:"none!important"}},children:"LƯU ĐỀ THI"})})]})};var Q=s(9770),K=s(4267),X=s(8445);let J=t=>(t||"").toLowerCase().split(" ").map(function(t){return t.replace(t.charAt(0),t.charAt(0).toUpperCase())}).join(" "),ee=t=>{let n=Object.fromEntries(Object.entries(t).filter(t=>{let[n]=t;return!["onSearch","capitalize","uppercase","timeout"].includes(n)})),[s,r]=(0,l.useState)(t.value||""),a=(0,l.useRef)(null),c=n=>{var{value:s}=n.target;s=t.uppercase?(s||"").toLocaleUpperCase():s||"",r(s=t.capitalize?J(s||""):s||""),clearTimeout(a.current),a.current=setTimeout(()=>{t.onChange&&t.onChange(s)},t.timeout||500)};return(0,l.useEffect)(()=>()=>{clearTimeout(a.current)},[]),(0,l.useEffect)(()=>{t.value!=s&&r(t.value||"")},[t.value]),(0,i.jsx)(O.Z,{...n,onChange:c,value:s})},et=t=>{let{parent:n="",goBack:s,onSearch:r,onChange:l}=t,a=()=>{l({title:"Th\xeam Nh\xf3m/Khối mới",parent:n,text:"",type:"classes"})},d=()=>{l({title:"Th\xeam Lớp mới",parent:n,text:"",type:"class",year:new Date().getFullYear()})};return(0,i.jsxs)("div",{children:[(0,i.jsx)(X.Z,{title:(0,i.jsx)(h.Z,{variant:"h4",children:"QUẢN L\xdd NH\xd3M/LỚP HỌC"})}),(0,i.jsx)(K.Z,{children:(0,i.jsxs)(c.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap"},children:[(0,i.jsx)(c.Z,{children:(0,i.jsx)(u.Z,{variant:"text",startIcon:(0,i.jsx)(w.Z,{icon:"tabler:chevron-left"}),color:"success",onClick:s,children:"Quay lại"})}),(0,i.jsxs)(c.Z,{children:[(0,i.jsx)(ee,{size:"small",sx:{mr:1},placeholder:"Nhập t\xean lớp...",InputProps:{startAdornment:(0,i.jsx)(H.Z,{position:"start",children:(0,i.jsx)(w.Z,{icon:"tabler:search"})})},onChange:r}),(0,i.jsx)(u.Z,{variant:"tonal",endIcon:(0,i.jsx)(w.Z,{icon:"tabler:folder-plus"}),sx:{mr:1},onClick:a,children:"TẠO NH\xd3M/KHỐI MỚI"}),(0,i.jsx)(u.Z,{variant:"contained",endIcon:(0,i.jsx)(w.Z,{icon:"tabler:clipboard-plus"}),onClick:d,children:"TẠO LỚP MỚI"})]})]})})]})};var en=l.memo(et),es=s(2275),ei=s(410),er=s(8885),el=s(9334),ea=s(8333),eo=s(8972);let ec=[{flex:.25,minWidth:290,field:"title",headerName:"KHỐI/LỚP",renderCell:t=>{let{row:n}=t;return(0,i.jsxs)(c.Z,{sx:{display:"flex",alignItems:"center"},children:["class"==n.type?(0,i.jsx)(ei.Z,{sx:{mr:3,fontSize:".8rem",width:"2rem",height:"2rem"},src:n.cover,children:(0,i.jsx)(w.Z,{icon:"tabler:list-check"})}):(0,i.jsx)(ei.Z,{skin:"light",sx:{mr:3,fontSize:".8rem",width:"2rem",height:"2rem"},src:n.cover,children:(0,i.jsx)(w.Z,{icon:"tabler:users-group"})}),(0,i.jsx)(h.Z,{noWrap:!0,variant:"body1",sx:{color:"text.primary",fontWeight:600},children:n.title})]})}},{flex:.25,minWidth:290,field:"updateAt",headerName:"CẬP NHẬT L\xdaC",renderCell:t=>{let{row:n}=t;return(0,i.jsx)(h.Z,{noWrap:!0,variant:"body2",sx:{color:"text.primary"},children:n.updateAt||n.createAt})}}],eh=t=>{let{rows:n,onChange:s,onLoading:a}=t,c=(0,r.useRouter)(),[h,d]=(0,l.useState)({}),[u,x]=(0,l.useState)(null),p=t=>{"classes"==t.type?c.push("?parent="+t.id):c.push("/p/view-classes.html?classes="+t.id)},f=t=>()=>{switch(x(null),t){case"rename":s({...h,title:"Chỉnh sửa th\xf4ng tin",text:h.title});break;case"remove":P().fire({title:"X\xf3a Nh\xf3m/Khối ".concat(h.title,"?"),text:"Sau khi x\xf3a nh\xf3m/khối n\xe0y c\xe1c nh\xf3m/khối/lớp b\xean trong nh\xf3m/khối sẽ được di chuyển th\xe0nh nh\xf3m/khối c\xf9ng cấp với nh\xf3m/khối hiện tại.",icon:"warning",showCancelButton:!0,confirmButtonText:"Đ\xfang. X\xf3a đi.",cancelButtonText:"Hủy"}).then(async t=>{if(t.isConfirmed){a(!0);let t=(await I.default.delete("/classes/"+h.id)).data;a(!1);let{error:n,message:s}=t||{};if(n)return P().fire({position:"top-end",icon:"error",title:n,showConfirmButton:!1,timer:1500});s&&((0,y.JG)(h.parent?"/classes/".concat(h.parent):"/classes",h,{revalidate:!1,populateCache:(t,n)=>{let s=n.filter(n=>n.id!==t.id);return[...s]}}),P().fire({position:"top-end",icon:"success",title:s,showConfirmButton:!1,timer:1500}))}})}},g={classes:[{text:"Chia sẻ",icon:"tabler:user-plus",onClick:f("share"),divider:!0},{text:"Đổi t\xean",icon:"tabler:pencil",onClick:f("rename")},{text:"X\xf3a",icon:"tabler:trash-filled",onClick:f("remove")}],class:[{text:"Đổi t\xean",icon:"tabler:pencil",onClick:f("rename")},{text:"X\xf3a",icon:"tabler:trash-filled",onClick:f("remove")}]},v=t=>{t.preventDefault();var[s]=n.filter(n=>n.id==t.currentTarget.getAttribute("data-id"));d(s),x(null===u?{mouseX:t.clientX-2,mouseY:t.clientY-4}:null)};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(es._,{autoHeight:!0,rows:n,columns:ec,initialState:{pagination:{paginationModel:{pageSize:15}}},pageSizeOptions:[15,25,50],slotProps:{row:{onContextMenu:v,style:{cursor:"context-menu"}}},disableRowSelectionOnClick:!0,onRowClick:t=>p(t.row)}),(0,i.jsx)(ea.Z,{open:null!==u,onClose:t=>x(null),anchorReference:"anchorPosition",anchorPosition:null!==u?{top:u.mouseY,left:u.mouseX}:void 0,slotProps:{root:{onContextMenu:t=>{t.preventDefault(),x(null)}}},children:(g[h.type]||[]).map((t,n)=>(0,i.jsxs)(eo.Z,{onClick:t.onClick,divider:t.divider,children:[(0,i.jsx)(er.Z,{children:(0,i.jsx)(w.Z,{icon:t.icon,fontSize:16})}),(0,i.jsx)(el.Z,{primary:t.text})]},n))})]})},ed=(0,_.ZP)(x.Z)(t=>{let{theme:n}=t;return{top:0,right:0,color:"grey.500",position:"absolute",boxShadow:n.shadows[2],transform:"translate(10px, -10px)",borderRadius:n.shape.borderRadius,backgroundColor:"".concat(n.palette.background.paper," !important"),transition:"transform 0.25s ease-in-out, box-shadow 0.25s ease-in-out","&:hover":{transform:"translate(7px, -5px)"}}}),eu=()=>{let t=new Date().getFullYear();return Array(10).fill(0).map((n,s)=>s+t-3)},ex=(0,l.forwardRef)(function(t,n){return(0,i.jsx)(L.Z,{ref:n,...t})}),ep=t=>{let{popup:n,onChange:s,onLoading:r}=t,[a,d]=(0,l.useState)(n||{}),x=()=>{s(null)},p=async()=>{let{title:t,...s}=a;if(!s.text.trim()||s.text.trim()===n.text.trim())return;r(!0);let i=(await I.default.post("/classes",s)).data;if(r(!1),i.error)return P().fire({icon:"error",title:"Oops...",text:i.error});(0,y.JG)(i.parent?"/classes/".concat(i.parent):"/classes",i,{revalidate:!1,populateCache:(t,n)=>{let s=[...n],i=n.findIndex(n=>n.id===t.id);return i>=0?s[i]=t:s.push(t),[...s]}}),x()};return(0,l.useEffect)(()=>{d(n||{})},[n]),(0,i.jsxs)(k.Z,{fullWidth:!0,open:!!n,maxWidth:"sm",scroll:"body",TransitionComponent:ex,sx:{"& .MuiDialog-paper":{overflow:"visible"}},children:[(0,i.jsxs)(M.Z,{sx:{pb:t=>"".concat(t.spacing(2)," !important"),px:t=>["".concat(t.spacing(5)," !important"),"".concat(t.spacing(5)," !important")]},children:[(0,i.jsx)(ed,{onClick:x,children:(0,i.jsx)(w.Z,{icon:"tabler:x",fontSize:"1.25rem"})}),(0,i.jsxs)(c.Z,{sx:{mb:2,textAlign:"left"},children:[(0,i.jsx)(h.Z,{variant:"h4",sx:{mb:3},children:a.title}),(0,i.jsx)(h.Z,{variant:"body",sx:{mb:3},children:"Bạn c\xf3 thể dễ d\xe0ng quản l\xfd c\xe1c lớp học của m\xecnh theo từng khối hoặc nh\xf3m một c\xe1ch dễ d\xe0ng hơn."})]}),(0,i.jsxs)(M.Z,{sx:{paddingX:"0!important"},children:["classes"===a.type?(0,i.jsx)(ee,{value:a.text,onChange:t=>d({...a,text:t}),fullWidth:!0,placeholder:"Vui l\xf2ng nhập t\xean Nh\xf3m/Kh\xf4i",label:"T\xean Nh\xf3m/Khối"}):null,"class"===a.type?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(ee,{value:a.text,onChange:t=>d({...a,text:t}),fullWidth:!0,placeholder:"Vui l\xf2ng nhập t\xean lớp",label:"T\xean lớp"}),(0,i.jsx)(ee,{select:!0,fullWidth:!0,label:"Năm học",sx:{mt:5},value:a.year||new Date().getFullYear(),onChange:t=>d({...a,year:t}),children:eu().map(t=>(0,i.jsxs)(eo.Z,{value:t,children:[t," - ",t+1]},t))})]}):null]})]}),(0,i.jsxs)(R.Z,{sx:{justifyContent:"center",px:t=>["".concat(t.spacing(5)," !important"),"".concat(t.spacing(5)," !important")],pb:t=>["".concat(t.spacing(5)," !important"),"".concat(t.spacing(5)," !important")]},children:[(0,i.jsx)(u.Z,{variant:"tonal",color:"secondary",onClick:x,children:"Hủy"}),(0,i.jsx)(u.Z,{variant:"contained",sx:{mr:1},onClick:p,children:"Lưu"})]})]})};var em=s(4808),ef=s(8456);let eg=t=>{let{open:n}=t;return(0,i.jsxs)(em.Z,{sx:{color:"#fff",zIndex:1301,display:"flex",flexDirection:"column"},open:n,children:[(0,i.jsx)(ef.Z,{color:"inherit"}),(0,i.jsx)(h.Z,{variant:"h5",sx:{color:"#fff",zIndex:t=>t.zIndex.drawer+1,mt:3},children:"VUI L\xd2NG ĐỢI"})]})},ev=async t=>{try{return(await I.default.get(t)).data}catch(t){throw t}},eb=()=>{var t;let n=(0,r.useRouter)(),[s,a]=(0,l.useState)(""),[h,d]=(0,l.useState)(!1),[u,x]=(0,l.useState)(null),{parent:p}=n.query,{data:f,isLoading:g}=(0,Q.Z)(n.isReady?p?"/classes/".concat(p):"/classes":null,ev);return(0,i.jsxs)(c.Z,{children:[(0,i.jsx)(en,{parent:p||"",goBack:()=>n.back(),onSearch:t=>a(t),onChange:t=>x(t)}),(0,i.jsx)(eh,{rows:null===(t=f||[])||void 0===t?void 0:t.filter(t=>null==t?void 0:t.title.includes(s)),onLoading:t=>d(t),onChange:t=>x(t)}),(0,i.jsx)(eg,{open:g||h}),(0,i.jsx)(ep,{popup:u,onChange:t=>x(t),onLoading:t=>d(t)})]})};var ej=s(1664),ey=s.n(ej);let eC=t=>{let{parent:n="",goBack:s,onSearch:r,onChange:l,syncExams:a}=t,p=()=>{l({title:"Th\xeam thư mục mới",parent:n,text:""})};return(0,i.jsxs)("div",{children:[(0,i.jsx)(X.Z,{title:(0,i.jsx)(h.Z,{variant:"h4",children:"QUẢN L\xdd ĐỀ THI"})}),(0,i.jsx)(K.Z,{sx:{px:{xs:2,md:4}},children:(0,i.jsxs)(c.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"no-wrap"},children:[(0,i.jsx)(c.Z,{children:(0,i.jsx)(d.Z,{title:"Quay lại",children:(0,i.jsx)(u.Z,{variant:"text",startIcon:(0,i.jsx)(w.Z,{icon:"tabler:chevron-left"}),color:"success",onClick:s,children:(0,i.jsx)(h.Z,{variant:"body2",sx:{display:{sm:"block",xs:"none"}},children:"Quay lại"})})})}),(0,i.jsxs)(c.Z,{sx:{display:"flex",alignItems:"center"},children:[(0,i.jsx)(ee,{size:"small",sx:{mr:1},placeholder:"Nhập t\xean đề thi...",InputProps:{startAdornment:(0,i.jsx)(H.Z,{position:"start",children:(0,i.jsx)(w.Z,{icon:"tabler:search"})})},onChange:r}),(0,i.jsx)(d.Z,{title:"Tạo thư mục mới",children:(0,i.jsx)(u.Z,{variant:"tonal",endIcon:(0,i.jsx)(w.Z,{icon:"tabler:folder-plus"}),sx:{span:{mx:{xs:0,sm:1}},px:{xs:1,sm:3},mr:1,flexGrow:1},onClick:p,children:(0,i.jsx)(h.Z,{variant:"body2",sx:{display:{sm:"block",xs:"none"}},children:"Tạo thư mục mới"})})}),(0,i.jsx)(d.Z,{title:" TẠO ĐỀ MỚI",children:(0,i.jsx)(u.Z,{variant:"contained",endIcon:(0,i.jsx)(w.Z,{icon:"tabler:clipboard-plus"}),component:ey(),href:"/p/create.html?parent="+n,sx:{span:{mx:{xs:0,sm:1}},px:{xs:1,sm:3}},children:(0,i.jsx)(h.Z,{variant:"body2",sx:{display:{sm:"block",xs:"none"},color:"white"},children:"TẠO ĐỀ MỚI"})})}),(0,i.jsx)(d.Z,{title:"Đồng bộ đề thi",children:(0,i.jsx)(x.Z,{sx:{ml:1},color:"primary",onClick:a,children:(0,i.jsx)(w.Z,{icon:"tabler:refresh"})})})]})]})}),(0,i.jsx)(c.Z,{sx:{position:"fixed",bottom:15,right:"3.75rem",zIndex:1031},children:(0,i.jsx)(u.Z,{variant:"contained",startIcon:(0,i.jsx)(w.Z,{icon:"tabler:plus"}),component:ey(),href:"/p/create.html?parent="+n,color:"error",sx:{boxShadow:"0 1px 20px 1px #EA5455!important",":hover":{boxShadow:"none!important"}},children:"TẠO ĐỀ MỚI"})})]})};var ew=l.memo(eC),eT=s(7484),eI=s.n(eT);let eE=[{flex:.25,minWidth:290,field:"title",headerName:"T\xcaN ĐỀ THI/THƯ MỤC",renderCell:t=>{let{row:n}=t;return(0,i.jsxs)(c.Z,{sx:{display:"flex",alignItems:"center"},children:["folder"==n.type?(0,i.jsx)(ei.Z,{sx:{mr:3,fontSize:".8rem",width:"2rem",height:"2rem"},src:n.cover,children:(0,i.jsx)(w.Z,{icon:"tabler:folder-filled"})}):(0,i.jsx)(ei.Z,{skin:"light",sx:{mr:3,fontSize:".8rem",width:"2rem",height:"2rem"},src:n.cover,children:(0,i.jsx)(w.Z,{icon:"tabler:clipboard"})}),(0,i.jsx)(h.Z,{noWrap:!0,variant:"body1",sx:{color:"text.primary",fontWeight:600},children:n.title})]})}},{flex:.25,minWidth:290,field:"updateAt",headerName:"CẬP NHẬT L\xdaC",renderCell:t=>{let{row:n}=t;return(0,i.jsx)(h.Z,{noWrap:!0,variant:"body2",sx:{color:"text.primary"},children:eI()(n.updateAt||n.createAt).format("HH:mm DD/MM/YYYY")})}}],eZ=t=>{let{rows:n,onChange:s,onLoading:a}=t,c=(0,r.useRouter)(),h=F(),[d,u]=(0,l.useState)({}),[x,p]=(0,l.useState)(null),f=t=>"folder"==t.type?c.push({pathname:"/p/exams.html",query:{parent:t.id}}):c.push("/p/create.html?parent=".concat(t.parent,"&id=").concat(t.id)),g=t=>()=>{switch(p(null),t){case"rename":s({...d,title:"Đổi t\xean thư mục",text:d.title});break;case"remove":P().fire({title:"X\xf3a thư mục ".concat(d.title,"?"),text:"Sau khi x\xf3a thư mục n\xe0y c\xe1c thư mục, đề thi b\xean trong thư mục sẽ được di chuyển th\xe0nh thư mục c\xf9ng cấp với thư mục hiện tại.",icon:"warning",showCancelButton:!0,confirmButtonText:"Đ\xfang. X\xf3a đi.",cancelButtonText:"Hủy"}).then(async t=>{if(t.isConfirmed){a(!0);let t=(await I.default.delete("/exams/"+d.id)).data;a(!1);let{error:n,message:s}=t||{};if(n)return P().fire({position:"top-end",icon:"error",title:n,showConfirmButton:!1,timer:1500});s&&((0,y.JG)(d.parent?"/exams/".concat(d.parent):"/exams",d,{revalidate:!1,populateCache:(t,n)=>{let s=n.filter(n=>n.id!==t.id);return[...s]}}),S.ZP.success(s,{duration:2e3}))}});break;case"copy":h.copy(d.url),S.ZP.success("Đ\xe3 sao ch\xe9p th\xe0nh c\xf4ng!",{duration:2e3});break;case"delete":P().fire({title:"X\xf3a đề thi ".concat(d.title,"?"),text:"Sau khi xo\xe1 đề thi n\xe0y. Bạn sẽ kh\xf4ng thể kh\xf4i phục n\xf3. H\xe3y c\xe2n nhắc lựa chọn n\xe0y.",icon:"warning",showCancelButton:!0,confirmButtonText:"Đ\xfang. X\xf3a đi.",cancelButtonText:"Hủy"}).then(async t=>{if(t.isConfirmed){a(!0);let t=(await I.default.delete("/quizs/".concat(d.id,"?parent=").concat(d.parent))).data;a(!1);let{error:n,message:s}=t||{};if(n)return P().fire({position:"top-end",icon:"error",title:n,showConfirmButton:!1,timer:1500});s&&((0,y.JG)(d.parent?"/exams/".concat(d.parent):"/exams",d,{revalidate:!1,populateCache:(t,n)=>{let s=n.filter(n=>n.id!==t.id);return[...s]}}),S.ZP.success(s,{duration:2e3}))}});break;case"leaderboard":case"statistic":case"realtime":case"create":c.push("/p/".concat(t,".html?parent=").concat(d.parent,"&id=").concat(d.id));break;case"view":let n=window.open(d.url,"_blank");n.focus()}},v={folder:[{text:"Chia sẻ",icon:"tabler:user-plus",onClick:g("share"),divider:!0},{text:"Đổi t\xean",icon:"tabler:pencil",onClick:g("rename")},{text:"X\xf3a",icon:"tabler:trash-filled",onClick:g("remove")}],quiz:[{text:"Xem đề thi",icon:"tabler:eye",onClick:g("view")},{text:"Sao ch\xe9p link",icon:"tabler:link",onClick:g("copy")},{text:"Chỉnh sửa",icon:"tabler:pencil-minus",onClick:g("create"),divider:!0},{text:"Bảng điểm",icon:"tabler:report-analytics",onClick:g("leaderboard")},{text:"Thống k\xea",icon:"tabler:chart-histogram",onClick:g("statistic")},{text:"Gi\xe1m s\xe1t thi",icon:"tabler:user-scan",onClick:g("realtime"),divider:!0},{text:"X\xf3a",icon:"tabler:trash-filled",onClick:g("delete")}]},b=t=>{t.preventDefault();var[s]=n.filter(n=>n.id==t.currentTarget.getAttribute("data-id"));u(s),p(null===x?{mouseX:t.clientX-2,mouseY:t.clientY-4}:null)};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(es._,{autoHeight:!0,rows:n,columns:eE,initialState:{pagination:{paginationModel:{pageSize:15}}},pageSizeOptions:[15,25,50],slotProps:{row:{onContextMenu:b,style:{cursor:"context-menu"}}},disableRowSelectionOnClick:!0,onRowClick:t=>f(t.row)}),(0,i.jsx)(ea.Z,{open:null!==x,onClose:t=>p(null),anchorReference:"anchorPosition",anchorPosition:null!==x?{top:x.mouseY,left:x.mouseX}:void 0,slotProps:{root:{onContextMenu:t=>{t.preventDefault(),p(null)}}},children:(v[d.type]||[]).map((t,n)=>(0,i.jsxs)(eo.Z,{onClick:t.onClick,divider:t.divider,children:[(0,i.jsx)(er.Z,{children:(0,i.jsx)(w.Z,{icon:t.icon,fontSize:16})}),(0,i.jsx)(el.Z,{primary:t.text})]},n))})]})},eA=(0,_.ZP)(x.Z)(t=>{let{theme:n}=t;return{top:0,right:0,color:"grey.500",position:"absolute",boxShadow:n.shadows[2],transform:"translate(10px, -10px)",borderRadius:n.shape.borderRadius,backgroundColor:"".concat(n.palette.background.paper," !important"),transition:"transform 0.25s ease-in-out, box-shadow 0.25s ease-in-out","&:hover":{transform:"translate(7px, -5px)"}}}),eP=(0,l.forwardRef)(function(t,n){return(0,i.jsx)(L.Z,{ref:n,...t})}),eS=t=>{let{popup:n,onChange:s,onLoading:r}=t,[a,d]=(0,l.useState)(n||{}),x=()=>{s(null)},p=async()=>{let{title:t,...s}=a;if(!s.text.trim()||s.text.trim()===n.text.trim())return;r(!0);let i=(await I.default.post("/exams",s)).data;if(r(!1),i.error)return P().fire({icon:"error",title:"Oops...",text:i.error});S.ZP.success("Cập nhật th\xe0nh c\xf4ng!",{duration:2e3}),(0,y.JG)(i.parent?"/exams/".concat(i.parent):"/exams",i,{revalidate:!1,populateCache:(t,n)=>{let s=[...n],i=n.findIndex(n=>n.id===t.id);return i>=0?s[i]=t:s.push(t),[...s]}}),x()};return(0,l.useEffect)(()=>{d(n||{})},[n]),(0,i.jsxs)(k.Z,{fullWidth:!0,open:!!n,maxWidth:"sm",scroll:"body",TransitionComponent:eP,sx:{"& .MuiDialog-paper":{overflow:"visible"}},children:[(0,i.jsxs)(M.Z,{sx:{pb:t=>"".concat(t.spacing(2)," !important"),px:t=>["".concat(t.spacing(5)," !important"),"".concat(t.spacing(5)," !important")]},children:[(0,i.jsx)(eA,{onClick:x,children:(0,i.jsx)(w.Z,{icon:"tabler:x",fontSize:"1.25rem"})}),(0,i.jsxs)(c.Z,{sx:{mb:3,textAlign:"left"},children:[(0,i.jsx)(h.Z,{variant:"h4",sx:{mb:3},children:null==a?void 0:a.title}),(0,i.jsx)(h.Z,{variant:"body",sx:{mb:3},children:"Bạn c\xf3 thể dễ d\xe0ng quản l\xfd đề thi, b\xe0i tập của m\xecnh theo từng thư mục, chuy\xean đề một c\xe1ch dễ d\xe0ng hơn."})]}),(0,i.jsx)(M.Z,{sx:{paddingX:"0!important"},children:(0,i.jsx)(ee,{value:(null==a?void 0:a.text)||"",onChange:t=>d({...a,text:t}),fullWidth:!0,placeholder:"Vui l\xf2ng nhập t\xean thư mục",label:"T\xean thư mục"})})]}),(0,i.jsxs)(R.Z,{sx:{justifyContent:"center",px:t=>["".concat(t.spacing(5)," !important"),"".concat(t.spacing(5)," !important")],pb:t=>["".concat(t.spacing(5)," !important"),"".concat(t.spacing(5)," !important")]},children:[(0,i.jsx)(u.Z,{variant:"tonal",color:"secondary",onClick:x,children:"Hủy"}),(0,i.jsx)(u.Z,{variant:"contained",sx:{mr:1},onClick:p,children:"Lưu"})]})]})};var eN=s(9008),ek=s.n(eN);let e_=async t=>{try{return(await I.default.get(t)).data}catch(t){throw t}},eL=()=>{var t;let n=(0,r.useRouter)(),[s,a]=(0,l.useState)(""),[h,d]=(0,l.useState)(!1),[u,x]=(0,l.useState)(null),{parent:p}=n.query,{data:f,isLoading:g}=(0,Q.Z)(n.isReady?p?"/exams/".concat(p):"/exams":null,e_);if(f&&f.error)return(0,i.jsx)(i.Fragment,{});let v=async()=>{P().fire({title:"Đồng bộ dữ liệu",text:"Chức năng n\xe0y sẽ đồng bộ lại dữ liệu đề thi m\xe0 bạn đ\xe3 tạo ở phi\xean bản trước. Bạn c\xf3 muốn đồng bộ kh\xf4ng?",icon:"warning",showCancelButton:!0,confirmButtonText:"Đồng bộ ngay",cancelButtonText:"Hủy"}).then(async t=>{if(t.isConfirmed){d(!0);let{data:t}=await I.default.get("/exams/sync");if(d(!1),t.error)return P().fire({icon:"success",title:"Xảy ra lỗi",text:t.error});window.location.reload()}})};return(0,i.jsxs)(c.Z,{children:[(0,i.jsx)(ek(),{children:(0,i.jsx)("title",{children:"Quản l\xfd đề thi - C\xf4ng cụ tạo đề thi online miễn ph\xed"})}),(0,i.jsx)(ew,{parent:p||"",goBack:()=>n.back(),onSearch:t=>a(t),onChange:t=>x(t),syncExams:v}),(0,i.jsx)(eZ,{rows:null===(t=f||[])||void 0===t?void 0:t.filter(t=>null==t?void 0:t.title.includes(s)),onLoading:t=>d(t),onChange:t=>x(t)}),(0,i.jsx)(eg,{open:g||h}),(0,i.jsx)(eS,{popup:u,onChange:t=>x(t),onLoading:t=>d(t)})]})};var eM=s(6242),eR=s(5152),eO=s.n(eR);let eH=eO()(()=>Promise.all([s.e(814),s.e(229)]).then(s.bind(s,7229)),{loadableGenerated:{webpack:()=>[7229]},ssr:!1}),eD=(t,n)=>{let s={};return t.forEach(t=>{s[t.number]||(s[t.number]=Array(21).fill(0)),s.total||(s.total=Array(21).fill(0));var i=Math.floor(t.point/n*20);s[t.number][i]++,s.total[i]++}),Object.keys(s).map((t,n)=>({name:"total"==t?"Tất cả":"Đề số ".concat(n+1),data:s[t]}))},ez=t=>{let{results:n,maxPoint:s=10}=t,r=eD(n,s),l={chart:{height:300,type:"area"},dataLabels:{enabled:!1},stroke:{curve:"smooth"},xaxis:{categories:Array.from({length:21},(t,n)=>">="+parseFloat(n*(s/20)).toFixed(2))},yaxis:{title:{text:"Số b\xe0i l\xe0m"}},scales:{x:{beginAtZero:!0}}};return(0,i.jsxs)(eM.Z,{sx:{mb:5},children:[(0,i.jsx)(X.Z,{title:"Phổ điểm",sx:{flexDirection:["column","row"],alignItems:["flex-start","center"],"& .MuiCardHeader-action":{mb:0},"& .MuiCardHeader-content":{mb:[2,0]}},action:(0,i.jsx)(c.Z,{sx:{display:"flex",alignItems:"center"}})}),(0,i.jsx)(K.Z,{children:(0,i.jsx)(eH,{height:450,options:l,series:r})})]})};var eB=l.memo(ez),eq=s(6476),eF=s(178),eG=s.n(eF),eW=s(9387),eY=s.n(eW);eI().extend(eG()),eI().extend(eY()),eI().tz.setDefault("Asia/Ho_Chi_Minh");var eU=eI();let e$=t=>Math.floor(t/36e5).toString().padStart(2,"0")+":"+Math.floor((t%=36e5)/6e4).toString().padStart(2,"0")+":"+Math.floor((t%=6e4)/1e3).toString().padStart(2,"0"),eV=t=>{let{results:n,labelColumn:s,handleClick:r}=t,[a,u]=(0,l.useState)([]),[p,f]=(0,l.useState)(""),[g,v]=(0,l.useState)({page:0,pageSize:25}),[b,j]=(0,l.useState)([]);(0,l.useEffect)(()=>{u(n)},[n]),(0,l.useEffect)(()=>{j(Object.keys(s))},[s]);let y=t=>{f(t)},C=[{flex:.1,minWidth:160,sortable:!1,field:"actions",headerName:"",renderCell:t=>{let{row:n}=t;return(0,i.jsxs)(c.Z,{sx:{display:"flex",alignItems:"center"},children:[(0,i.jsx)(d.Z,{title:"Xem b\xe0i l\xe0m",children:(0,i.jsx)(x.Z,{size:"small",sx:{color:"primary.main"},onClick:r(n.id,"view"),children:(0,i.jsx)(w.Z,{icon:"tabler:eye"})})}),(0,i.jsx)(d.Z,{title:"Lịch sử b\xe0i l\xe0m",children:(0,i.jsx)(x.Z,{size:"small",sx:{color:"success.main"},onClick:r(n.id,"history"),children:(0,i.jsx)(w.Z,{icon:"tabler:mist"})})}),(0,i.jsx)(d.Z,{title:"X\xf3a b\xe0i l\xe0m",children:(0,i.jsx)(x.Z,{size:"small",sx:{color:"error.main"},onClick:r(n,"remove"),children:(0,i.jsx)(w.Z,{icon:"tabler:circle-x"})})})]})}},{flex:.175,minWidth:110,field:"rank",headerName:"Xếp hạng",renderCell:t=>(0,i.jsx)(h.Z,{variant:"body2",sx:{color:"text.primary"},children:t.row.rank})},{flex:.175,minWidth:110,field:"point",headerName:"Điểm",renderCell:t=>(0,i.jsx)(h.Z,{variant:"body2",sx:{color:"text.primary"},children:parseFloat(t.row.point).toFixed(2)})},...b.map(t=>({flex:1,minWidth:250,field:t,headerName:t,renderCell:n=>(0,i.jsx)(h.Z,{variant:"body2",sx:{color:"text.primary"},children:n.row[t]})})),{flex:.175,minWidth:110,field:"right",headerName:"Số c\xe2u đ\xfang",renderCell:t=>(0,i.jsx)(h.Z,{variant:"body2",sx:{color:"text.primary"},children:t.row.right})},{flex:.175,minWidth:110,field:"number",headerName:"Đề số",renderCell:t=>(0,i.jsx)(h.Z,{variant:"body2",sx:{color:"text.primary"},children:t.row.number})},{flex:.175,minWidth:110,field:"retake",headerName:"Lần l\xe0m",renderCell:t=>(0,i.jsx)(h.Z,{variant:"body2",sx:{color:"text.primary"},children:t.row.retake})},{flex:.175,minWidth:110,field:"time",headerName:"Thời gian l\xe0m b\xe0i",renderCell:t=>(0,i.jsx)(h.Z,{variant:"body",sx:{color:"text.primary"},children:e$(t.row.time)})},{flex:.175,minWidth:180,field:"startAt",headerName:"Bắt đầu l\xfac",renderCell:t=>(0,i.jsx)(h.Z,{variant:"body2",sx:{color:"text.primary"},children:eU(t.row.startAt).format("HH:mm:ss DD/MM/YYYY")})},{flex:.175,minWidth:180,field:"submitAt",headerName:"Nộp b\xe0i l\xfac",renderCell:t=>(0,i.jsx)(h.Z,{variant:"body2",sx:{color:"text.primary"},children:eU(t.row.submitAt).format("HH:mm:ss DD/MM/YYYY")})},{flex:.175,minWidth:350,field:"link",headerName:"Link b\xe0i l\xe0m",renderCell:t=>(0,i.jsx)(h.Z,{variant:"body2",sx:{color:"text.primary"},children:(0,i.jsx)("a",{href:t.row.link,target:"_blank",style:{textDecoration:"none"},children:t.row.link})})},{flex:.175,minWidth:150,field:"hidden",headerName:"Số lần chuyển tabs",renderCell:t=>(0,i.jsx)(h.Z,{variant:"body2",sx:{color:"text.primary"},children:t.row.hidden})},{flex:.175,minWidth:150,field:"left",headerName:"Số lần chuột tr\xe1i",renderCell:t=>(0,i.jsx)(h.Z,{variant:"body2",sx:{color:"text.primary"},children:t.row.left})},{flex:.175,minWidth:150,field:"menu",headerName:"Số lần chuột phải",renderCell:t=>(0,i.jsx)(h.Z,{variant:"body2",sx:{color:"text.primary"},children:t.row.menu})},{flex:.175,minWidth:150,field:"offline",headerName:"Số lần Offline",renderCell:t=>(0,i.jsx)(h.Z,{variant:"body2",sx:{color:"text.primary"},children:t.row.offline})},{flex:.175,minWidth:150,field:"devices",headerName:"Thiết bị",renderCell:t=>(0,i.jsx)(h.Z,{variant:"body2",sx:{color:"text.primary"},children:t.row.devices.join(", ")})},{flex:.175,minWidth:150,field:"ip",headerName:"Địa chỉ IP",renderCell:t=>(0,i.jsx)(h.Z,{variant:"body2",sx:{color:"text.primary"},children:t.row.ip.join(", ")})}];return(0,i.jsxs)(eM.Z,{children:[(0,i.jsx)(X.Z,{title:"Bảng điểm"}),(0,i.jsx)(es._,{autoHeight:!0,pagination:!0,rows:a,disableColumnFilter:!0,disableColumnMenu:!0,columns:C,pageSizeOptions:[25,50,100],paginationModel:g,onPaginationModelChange:v,slotProps:{baseButton:{size:"medium",variant:"tonal"},toolbar:{value:p,clearSearch:()=>y(""),onChange:t=>y(t.target.value)}}})]})};var eQ=l.memo(eV),eK=s(7533),eX=s(7494),eJ=s(7413),e0=s(2162),e1=s(9601),e2=s(1221),e5=s(6599);let e4=(0,_.ZP)(e5.Z)({"& .MuiTimelineItem-root":{width:"100%","&:before":{display:"none"}}}),e3=(0,_.ZP)(c.Z)(t=>{let{theme:n}=t;return{display:"flex",alignItems:"center",padding:n.spacing(3),justifyContent:"space-between",backgroundColor:"#F8F8F8"}}),e9=t=>{var n,s,r,l;let{details:a,handleClose:d,handleClick:p}=t;return(0,i.jsxs)(eK.ZP,{open:!0,anchor:"right",variant:"temporary",onClose:d,ModalProps:{keepMounted:!0},sx:{"& .MuiDrawer-paper":{width:{md:"50%",xs:"95%"}}},children:[(0,i.jsxs)(e3,{children:[(0,i.jsxs)(h.Z,{variant:"h5",children:["Lịch sử l\xe0m b\xe0i của: ",null==a?void 0:null===(n=a.payload)||void 0===n?void 0:n.student]}),(0,i.jsx)(x.Z,{size:"small",onClick:d,sx:{p:"0.438rem",borderRadius:1,color:"text.primary",backgroundColor:"action.selected","&:hover":{backgroundColor:t=>"rgba(".concat(t.palette.customColors.main,", 0.16)")}},children:(0,i.jsx)(w.Z,{icon:"tabler:x",fontSize:"1.125rem"})})]}),(0,i.jsx)(c.Z,{sx:{mt:3,px:3},children:(0,i.jsx)(e4,{children:null==a?void 0:null===(s=a.payload)||void 0===s?void 0:null===(r=s.logs)||void 0===r?void 0:r.map((t,n)=>(0,i.jsxs)(eJ.Z,{children:[(0,i.jsxs)(e1.Z,{children:[(0,i.jsx)(eX.Z,{color:"error"}),(0,i.jsx)(e2.Z,{})]}),(0,i.jsxs)(e0.Z,{sx:{"& svg":{verticalAlign:"bottom",mx:4}},children:[(0,i.jsx)(c.Z,{sx:{mb:2,display:"flex",flexWrap:"wrap",alignItems:"center",justifyContent:"space-between"},children:(0,i.jsx)(h.Z,{sx:{mr:2},variant:"h5",dangerouslySetInnerHTML:{__html:t.text}})}),(0,i.jsx)(c.Z,{children:(0,i.jsx)(h.Z,{variant:"body",sx:{color:"text.disabled"},children:eI()(t.t).format("HH:mm:ss DD/MM/YYYY")})})]})]},n))})}),(0,i.jsx)(e3,{sx:{justifyContent:"flex-end"},children:(0,i.jsx)(u.Z,{onClick:p(null==a?void 0:null===(l=a.payload)||void 0===l?void 0:l.id,"view"),variant:"contained",startIcon:(0,i.jsx)(w.Z,{icon:"tabler:eye"}),children:"Chi tiết b\xe0i l\xe0m"})})]})};var e6=l.memo(e9),e8=s(7720),e7=s(8462),te=s(9294),tt=s(1008);s(8594);var ts=s(5600);let ti=()=>{let t=document.querySelectorAll(".quill-image");t.forEach(t=>{try{let{link:n,data:s}=JSON.parse(t.getAttribute("data-value")),i=document.createElement("canvas"),r=i.getContext("2d"),l=new Image;l.src=n,l.crossOrigin="anonymous",l.onload=function(){i.width=s.width,i.height=s.height,r.drawImage(l,s.x,s.y,s.width,s.height,0,0,s.width,s.height),t.setAttribute("src",i.toDataURL("image/png"))}}catch(t){console.log(t.message)}})},tr=()=>{let t=document.querySelectorAll(".ql-formula");t.forEach(t=>{try{let n=t.getAttribute("data-value");n&&(t.innerHTML=tt.Z.renderToString(n,{throwOnError:!1}))}catch(t){console.log(t.message)}})},tl=t=>{var n,s,r;let{details:a,updatePoint:d}=t;return(0,l.useEffect)(()=>{a&&(ti(),tr())},[a]),null==a?void 0:null===(n=a.payload)||void 0===n?void 0:null===(s=n.details)||void 0===s?void 0:null===(r=s.groups)||void 0===r?void 0:r.map(t=>{var n,s,r,l;return(0,i.jsxs)(eM.Z,{sx:{mt:10,background:"unset"},children:[t.content&&(null==a?void 0:null===(n=a.payload)||void 0===n?void 0:null===(s=n.details)||void 0===s?void 0:s.groups.length)>1?(0,i.jsx)(K.Z,{dangerouslySetInnerHTML:{__html:t.content}}):null,(0,i.jsx)(K.Z,{sx:{padding:0,":last-of-type":{pb:0}},children:null==a?void 0:null===(r=a.payload)||void 0===r?void 0:null===(l=r.details)||void 0===l?void 0:l.questions.filter(n=>n.groupId==t.id).map((t,n)=>{var s,r;return(0,i.jsxs)(eM.Z,{sx:{mb:5,":last-of-type":{mb:0}},id:t.id,children:[(0,i.jsx)(X.Z,{title:(0,i.jsxs)(h.Z,{variant:"body",sx:{fontWeight:700,color:"primary.main",fontSize:"1.3rem"},children:[t.label||"C\xe2u"," ",t.numberUser," (",t.label||"C\xe2u"," ",t.number,")."]}),action:(0,i.jsxs)(c.Z,{sx:{display:"flex",alignItems:"center"},children:[["TN","HK"].includes(t.type)?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(ts.Z,{rounded:!0,label:"Đ\xe1p \xe1n đ\xfang: "+(null==t?void 0:null===(s=t.options)||void 0===s?void 0:s.map((t,n)=>(null==t?void 0:t.keys)?"".concat(String.fromCharCode(65+n)," (").concat(String.fromCharCode(65+t.postion),")"):"").filter(t=>t).join(", ")),skin:"light",color:"success"}),(0,i.jsx)(ts.Z,{rounded:!0,label:"Đ\xe3 chọn: "+((null==t?void 0:t.answers)?null==t?void 0:null===(r=t.answers)||void 0===r?void 0:r.map(n=>{var s=null==t?void 0:t.options[n];return"".concat(String.fromCharCode(65+n)," (").concat(String.fromCharCode(65+s.postion),")")}).join(", "):""),skin:"light",color:t.isTrue?"success":"error",sx:{mx:1}})]}):null,["TL"].includes(t.type)?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(ts.Z,{rounded:!0,label:"GV chấm:",skin:"light",color:"info"}),(0,i.jsx)(ee,{type:"number",size:"small",sx:{width:"auto",maxWidth:"8rem",mx:2},value:t.teacher||0,InputProps:{inputProps:{min:0,max:parseFloat(t.maxPoint),step:.01},endAdornment:(0,i.jsx)(H.Z,{position:"end",children:"điểm"})},onChange:n=>d(t.id,{teacher:n}),timeout:300}),(0,i.jsx)(ts.Z,{rounded:!0,label:"Tối đa: ".concat(parseFloat(t.maxPoint).toFixed(2)," điểm"),skin:"light",color:"success"})]}):(0,i.jsx)(h.Z,{variant:"body",sx:{fontWeight:700,color:t.isTrue?"success.main":"error.main"},children:-1==t.point?"":parseFloat(t.point).toFixed(2)+" điểm"})]}),sx:{paddingY:3}}),(0,i.jsx)(K.Z,{dangerouslySetInnerHTML:{__html:t.content},sx:{" p":{m:0},py:0}}),(0,i.jsx)(K.Z,{sx:{px:1,mt:3},children:(0,i.jsxs)(e7.Z,{disablePadding:!0,children:[["TN","HK"].includes(t.type)?t.options.map((t,n)=>(0,i.jsxs)(te.ZP,{sx:{borderRadius:1,mb:1,border:"1px solid #b2b2b299"},user:t.user||"",children:[(0,i.jsx)(er.Z,{children:(0,i.jsxs)(ei.Z,{skin:(null==t?void 0:t.user)?"static":"light",sx:{fontWeight:600},children:[String.fromCharCode(65+n)," (",String.fromCharCode(65+t.postion),")"]})}),(0,i.jsx)(c.Z,{dangerouslySetInnerHTML:{__html:t.text},sx:{" p":{m:0},flexGrow:1}})]},n)):null,"TF"==t.type?t.options.map((t,n)=>(0,i.jsxs)(te.ZP,{divider:!0,sx:{gap:1,cursor:"default",paddingX:2},children:[(0,i.jsx)(ei.Z,{skin:"light",user:(null==t?void 0:t.user[0])||"",children:"Đ"}),(0,i.jsx)(ei.Z,{skin:"light",user:(null==t?void 0:t.user[1])||"",children:"S"}),(0,i.jsxs)(ei.Z,{skin:"light",color:"secondary",sx:{fontWeight:600},children:[String.fromCharCode(97+n)," (",String.fromCharCode(97+(null==t?void 0:t.postion)),")"]}),(0,i.jsx)(c.Z,{dangerouslySetInnerHTML:{__html:t.text},sx:{" p":{m:0},flexGrow:1}})]},n)):null]})}),"TL"==t.type?(0,i.jsxs)(K.Z,{sx:{px:2},children:[(0,i.jsx)(e8.Z,{sx:{fontWeight:600},children:"B\xe0i l\xe0m của học sinh"}),(0,i.jsx)(c.Z,{dangerouslySetInnerHTML:{__html:((null==t?void 0:t.answers)||[])[0]||""},sx:{" p":{m:0}}})]}):null,"DT"==t.type?(0,i.jsx)(K.Z,{sx:{px:2},children:(0,i.jsxs)(N.ZP,{container:!0,spacing:3,children:[(0,i.jsxs)(N.ZP,{item:!0,xs:12,md:6,children:[(0,i.jsx)(e8.Z,{sx:{fontWeight:600},children:"Đ\xe1p \xe1n của học sinh"}),(0,i.jsx)(c.Z,{dangerouslySetInnerHTML:{__html:((null==t?void 0:t.answers)||[])[0]||""},sx:{" p":{m:0}}})]}),(0,i.jsx)(N.ZP,{item:!0,xs:12,md:6,sx:{color:"success.main"},children:t.options.length?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e8.Z,{sx:{fontWeight:600},children:"Đ\xe1p \xe1n đ\xfang"}),t.options.map((t,n)=>(0,i.jsxs)(h.Z,{variant:"body",children:[t.text," |"," "]},n))]}):null})]})}):null]},t.id)})})]},t.id)})};var ta=l.memo(tl),to=s(3395);let tc=t=>Math.floor(t/36e5).toString().padStart(2,"0")+":"+Math.floor((t%=36e5)/6e4).toString().padStart(2,"0")+":"+Math.floor((t%=6e4)/1e3).toString().padStart(2,"0"),th=t=>{var n,s,r;let{details:a}=t,{points:c}=null==a?void 0:null===(n=a.payload)||void 0===n?void 0:n.overview,{overview:h}=null==a?void 0:a.payload,{collects:d=[]}=null==a?void 0:null===(s=a.payload)||void 0===s?void 0:s.details,u=null==a?void 0:null===(r=a.payload)||void 0===r?void 0:r.Username,[x,p]=(0,l.useState)(0);return(0,l.useEffect)(()=>{var t,n,s;let i=null==a?void 0:null===(t=a.payload)||void 0===t?void 0:null===(n=t.details)||void 0===n?void 0:null===(s=n.questions)||void 0===s?void 0:s.reduce((t,n)=>t+=parseFloat(n.teacher||n.point),0);p(i||0)},[a]),(0,i.jsxs)(N.ZP,{container:!0,spacing:3,sx:{px:3},children:[(0,i.jsxs)(N.ZP,{item:!0,xs:12,md:4,children:[(0,i.jsx)(e8.Z,{children:"ĐIỂM"}),(0,i.jsx)(eH,{series:[parseFloat(100*x/c||0).toFixed(2)],options:{chart:{height:300,type:"radialBar",sparkline:{enabled:!0}},colors:["#51e5a8"],plotOptions:{radialBar:{offsetY:-10,startAngle:-150,endAngle:150,hollow:{margin:0,size:"75%"},track:{background:"#ebe9f1",strokeWidth:"50%",margin:0},dataLabels:{show:!0,name:{show:!1,color:"#5e5873",fontSize:"2.86rem"},value:{formatter:t=>parseFloat(t*c/100||0).toFixed(2),color:"#5e5873",fontSize:"2.86rem",show:!0}}}},fill:{type:"gradient",gradient:{shade:"dark",type:"horizontal",shadeIntensity:.5,gradientToColors:["#51e5a8"],inverseColors:!0,opacityFrom:1,opacityTo:1,stops:[0,100]}},stroke:{lineCap:"round"},labels:[""],grid:{padding:{bottom:30}}},type:"radialBar",height:300})]}),(0,i.jsxs)(N.ZP,{item:!0,xs:12,md:4,children:[u?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e8.Z,{sx:{mt:2},children:"TH\xd4NG TIN TH\xcd SINH"}),(0,i.jsxs)(e7.Z,{children:[(0,i.jsx)(te.ZP,{disablePadding:!0,children:(0,i.jsxs)(er.Z,{sx:{alignItems:"center",color:"primary.main"},children:[(0,i.jsx)(w.Z,{icon:"tabler:user-bolt",fontSize:20}),(0,i.jsxs)(el.Z,{sx:{fontWeight:600,ml:1},disableTypography:!0,children:["Họ v\xe0 t\xean: ",null==u?void 0:u.fullname]})]})}),(0,i.jsx)(te.ZP,{disablePadding:!0,children:(0,i.jsxs)(er.Z,{sx:{alignItems:"center",color:"primary.main"},children:[(0,i.jsx)(w.Z,{icon:"tabler:cash-banknote",fontSize:20}),(0,i.jsxs)(el.Z,{sx:{fontWeight:600,ml:1},disableTypography:!0,children:["Lớp: ",null==u?void 0:u.classes]})]})}),(0,i.jsx)(te.ZP,{disablePadding:!0,children:(0,i.jsxs)(er.Z,{sx:{alignItems:"center",color:"primary.main"},children:[(0,i.jsx)(w.Z,{icon:"tabler:school",fontSize:20}),(0,i.jsxs)(el.Z,{sx:{fontWeight:600,ml:1},disableTypography:!0,children:["Trường: ",null==u?void 0:u.school]})]})})]})]}):null,d.length?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e8.Z,{children:"TH\xd4NG TIN THU THẬP"}),(0,i.jsx)(e7.Z,{children:d.map((t,n)=>(0,i.jsx)(te.ZP,{disablePadding:!0,children:(0,i.jsxs)(er.Z,{sx:{alignItems:"center",color:"primary.main"},children:[(0,i.jsx)(w.Z,{icon:"tabler:point",fontSize:20}),(0,i.jsxs)(el.Z,{sx:{fontWeight:600,ml:1},disableTypography:!0,children:[null==t?void 0:t.label,": ",null==t?void 0:t.value]})]})},n))})]}):null]}),(0,i.jsxs)(N.ZP,{item:!0,xs:12,md:4,children:[(0,i.jsx)(e8.Z,{children:"TH\xd4NG TIN B\xc0I THI"}),(0,i.jsxs)(e7.Z,{children:[(0,i.jsx)(te.ZP,{disablePadding:!0,children:(0,i.jsxs)(er.Z,{sx:{alignItems:"center",color:"warning.main"},children:[(0,i.jsx)(w.Z,{icon:"tabler:clock",fontSize:20}),(0,i.jsx)(el.Z,{sx:{fontWeight:600,ml:1},disableTypography:!0,children:"Thời gian l\xe0m b\xe0i:"}),(0,i.jsx)(to.Z,{sx:{fontWeight:600,fontSize:"1.2rem"},children:tc(h.time)})]})}),(0,i.jsx)(te.ZP,{disablePadding:!0,children:(0,i.jsxs)(er.Z,{sx:{alignItems:"center"},children:[(0,i.jsx)(w.Z,{icon:"tabler:clock",fontSize:20}),(0,i.jsx)(el.Z,{sx:{fontWeight:600,ml:1},disableTypography:!0,children:"Bắt đầu l\xfac:"}),(0,i.jsx)(to.Z,{sx:{fontWeight:600,fontSize:"1.2rem"},children:eI()(h.startAt).format("HH:mm:ss DD/MM/YYYY")})]})}),(0,i.jsx)(te.ZP,{disablePadding:!0,children:(0,i.jsxs)(er.Z,{sx:{alignItems:"center"},children:[(0,i.jsx)(w.Z,{icon:"tabler:clock",fontSize:20}),(0,i.jsx)(el.Z,{sx:{fontWeight:600,ml:1},disableTypography:!0,children:"Nộp b\xe0i l\xfac:"}),(0,i.jsx)(to.Z,{sx:{fontWeight:600,fontSize:"1.2rem"},children:eI()(h.submitAt).format("HH:mm:ss DD/MM/YYYY")})]})}),(0,i.jsx)(te.ZP,{disablePadding:!0,children:(0,i.jsxs)(er.Z,{sx:{alignItems:"center",color:"success.main"},children:[(0,i.jsx)(w.Z,{icon:"tabler:circle-check",fontSize:20}),(0,i.jsx)(el.Z,{sx:{fontWeight:600,ml:1},disableTypography:!0,children:"Số c\xe2u trắc nghiệm đ\xfang"}),(0,i.jsx)(to.Z,{sx:{fontWeight:600,fontSize:"1.2rem"},children:h.right})]})}),(0,i.jsx)(te.ZP,{disablePadding:!0,children:(0,i.jsxs)(er.Z,{sx:{alignItems:"center",color:"error.main"},children:[(0,i.jsx)(w.Z,{icon:"tabler:circle-x",fontSize:20}),(0,i.jsx)(el.Z,{sx:{fontWeight:600,ml:1},disableTypography:!0,children:"Số c\xe2u trắc nghiệm sai"}),(0,i.jsx)(to.Z,{sx:{fontWeight:600,fontSize:"1.2rem"},children:h.error})]})}),(0,i.jsx)(te.ZP,{disablePadding:!0,children:(0,i.jsxs)(er.Z,{sx:{alignItems:"center"},children:[(0,i.jsx)(w.Z,{icon:"tabler:sum",fontSize:20}),(0,i.jsx)(el.Z,{sx:{fontWeight:600,ml:1},disableTypography:!0,children:"Tổng số c\xe2u hỏi trong đề"}),(0,i.jsx)(to.Z,{sx:{fontWeight:600,fontSize:"1.2rem"},children:h.total})]})}),(0,i.jsx)(te.ZP,{disablePadding:!0,children:(0,i.jsxs)(er.Z,{sx:{alignItems:"center"},children:[(0,i.jsx)(w.Z,{icon:"tabler:sum",fontSize:20}),(0,i.jsx)(el.Z,{sx:{fontWeight:600,ml:1},disableTypography:!0,children:"Đề số"}),(0,i.jsx)(to.Z,{sx:{fontWeight:600,fontSize:"1.2rem"},children:h.number})]})}),(0,i.jsx)(te.ZP,{disablePadding:!0,children:(0,i.jsxs)(er.Z,{sx:{alignItems:"center"},children:[(0,i.jsx)(w.Z,{icon:"tabler:sum",fontSize:20}),(0,i.jsx)(el.Z,{sx:{fontWeight:600,ml:1,a:{textDecoration:"none"}},disableTypography:!0,children:"Link b\xe0i l\xe0m:"}),(0,i.jsx)(to.Z,{sx:{fontWeight:600,fontSize:"1.2rem",a:{textDecoration:"none"}},children:(0,i.jsx)("a",{href:h.link,target:"_blank",children:"Click để xem"})})]})})]})]})]})},td=(0,_.ZP)(c.Z)(t=>{let{theme:n}=t;return{display:"flex",alignItems:"center",padding:n.spacing(3),justifyContent:"space-between",backgroundColor:"#F8F8F8"}}),tu=t=>{var n,s,r,a;let{details:d,handleClose:p,handleClick:f,saveResults:g}=t,[v,b]=(0,l.useState)(d);(0,l.useEffect)(()=>{var t;b(d),sessionStorage.removeItem("results_"+(null==d?void 0:null===(t=d.payload)||void 0===t?void 0:t.id))},[d]);let j=(t,n)=>{var s,i;let r=JSON.parse(sessionStorage.getItem("results_"+(null==v?void 0:null===(s=v.payload)||void 0===s?void 0:s.id))||"{}");sessionStorage.setItem("results_"+(null==v?void 0:null===(i=v.payload)||void 0===i?void 0:i.id),JSON.stringify({...r,comments:{...(null==r?void 0:r.comments)||{},[t]:n}})),b(s=>{var i,r,l;return{...s,payload:{...s.payload,details:{...null==s?void 0:null===(i=s.payload)||void 0===i?void 0:i.details,comments:{...null==s?void 0:null===(r=s.payload)||void 0===r?void 0:null===(l=r.details)||void 0===l?void 0:l.comments,[t]:n}}}}})},y=(t,n)=>{var s;let{teacher:i}=n,r=JSON.parse(sessionStorage.getItem("results_"+(null==v?void 0:null===(s=v.payload)||void 0===s?void 0:s.id))||"{}");b(n=>{var s,l,a,c;return{...n,payload:{...n.payload,details:{...null==n?void 0:null===(s=n.payload)||void 0===s?void 0:s.details,questions:null==n?void 0:null===(l=n.payload)||void 0===l?void 0:null===(a=l.details)||void 0===a?void 0:null===(c=a.questions)||void 0===c?void 0:c.map(n=>{if(n.id==t){var s;return sessionStorage.setItem("results_"+(null==v?void 0:null===(s=v.payload)||void 0===s?void 0:s.id),JSON.stringify({...r,points:{...(null==r?void 0:r.points)||{},[t]:Math.min(i,n.maxPoint)}})),{...n,teacher:Math.min(i,n.maxPoint)}}return n})}}}})},C=()=>{try{var t,n;let{comments:s={},points:i={}}=JSON.parse(sessionStorage.getItem("results_"+(null==v?void 0:null===(t=v.payload)||void 0===t?void 0:t.id))||"{}");Object.keys(s).length||Object.keys(i).length?g(null==v?void 0:null===(n=v.payload)||void 0===n?void 0:n.id):P().fire("Bạn chưa chỉnh sửa g\xec","","info")}catch(t){}},T=()=>{var t;let{comments:n={},points:s={}}=JSON.parse(sessionStorage.getItem("results_"+(null==v?void 0:null===(t=v.payload)||void 0===t?void 0:t.id))||"{}");Object.keys(n).length||Object.keys(s).length?P().fire({icon:"warning",title:"Ch\xfa \xfd",html:'Bạn chưa lưu kết quả chấm điểm của b\xe0i l\xe0m n\xe0y. Vui l\xf2ng nhấn <b style="color:red">Lưu b\xe0i l\xe0m</b> trước khi tho\xe1t.',showCancelButton:!0,cancelButtonText:"Đ\xe3 hiểu",cancelButtonColor:"#d33",confirmButtonText:"Kh\xf4ng lưu"}).then(t=>{if(t.isConfirmed){var n;sessionStorage.removeItem("results_"+(null==v?void 0:null===(n=v.payload)||void 0===n?void 0:n.id)),p()}}):p()},I=()=>{var t,n;let{comments:s={},points:i={}}=JSON.parse(sessionStorage.getItem("results_"+(null==v?void 0:null===(t=v.payload)||void 0===t?void 0:t.id))||"{}");Object.keys(s).length||Object.keys(i).length?P().fire({icon:"warning",title:"Ch\xfa \xfd",html:'Bạn chưa lưu kết quả chấm điểm của b\xe0i l\xe0m n\xe0y. Vui l\xf2ng nhấn <b style="color:red">Lưu b\xe0i l\xe0m</b> trước khi tho\xe1t.',showCancelButton:!0,cancelButtonText:"Đ\xe3 hiểu",cancelButtonColor:"#d33",confirmButtonText:"Kh\xf4ng lưu"}).then(t=>{if(t.isConfirmed){var n,s;sessionStorage.removeItem("results_"+(null==v?void 0:null===(n=v.payload)||void 0===n?void 0:n.id)),f(null==v?void 0:null===(s=v.payload)||void 0===s?void 0:s.id,"history")}}):(console.log("handleClick"),f(null==v?void 0:null===(n=v.payload)||void 0===n?void 0:n.id,"history")())};return(0,i.jsxs)(eK.ZP,{open:!0,anchor:"right",variant:"temporary",onClose:T,ModalProps:{keepMounted:!0},sx:{"& .MuiDrawer-paper":{width:"80%"}},children:[(0,i.jsxs)(td,{children:[(0,i.jsxs)(h.Z,{variant:"h5",children:["B\xe0i l\xe0m của: ",null==v?void 0:null===(n=v.payload)||void 0===n?void 0:n.student]}),(0,i.jsx)(x.Z,{size:"small",onClick:T,sx:{p:"0.438rem",borderRadius:1,color:"text.primary",backgroundColor:"action.selected","&:hover":{backgroundColor:t=>"rgba(".concat(t.palette.customColors.main,", 0.16)")}},children:(0,i.jsx)(w.Z,{icon:"tabler:x",fontSize:"1.125rem"})})]}),(0,i.jsxs)(c.Z,{sx:{mt:3},children:[(0,i.jsx)(th,{details:v}),(0,i.jsxs)(c.Z,{sx:{px:3},children:[(0,i.jsx)(e8.Z,{children:"NHẬN X\xc9T CỦA GI\xc1O VI\xcaN"}),(0,i.jsx)(ee,{fullWidth:!0,multiline:!0,minRows:3,value:((null==v?void 0:null===(s=v.payload)||void 0===s?void 0:null===(r=s.details)||void 0===r?void 0:r.comments)||{})[null==v?void 0:null===(a=v.payload)||void 0===a?void 0:a.id]||"",onChange:t=>{var n;return j(null==v?void 0:null===(n=v.payload)||void 0===n?void 0:n.id,t)}})]}),(0,i.jsxs)(c.Z,{sx:{px:3},children:[(0,i.jsx)(e8.Z,{children:"CHI TIẾT B\xc0I L\xc0M"}),(0,i.jsx)(ta,{details:v,updatePoint:y})]})]}),(0,i.jsxs)(td,{sx:{justifyContent:"flex-end"},children:[(0,i.jsx)(u.Z,{onClick:I,variant:"contained",color:"success",startIcon:(0,i.jsx)(w.Z,{icon:"tabler:mist"}),children:"Lịch sử b\xe0i l\xe0m"}),(0,i.jsx)(u.Z,{onClick:C,variant:"contained",startIcon:(0,i.jsx)(w.Z,{icon:"tabler:device-floppy"}),sx:{ml:2},children:"Lưu b\xe0i l\xe0m"})]})]})},tx=t=>{let{details:n,handleClose:s,handleClick:r,saveResults:l}=t;return"history"==n.open?(0,i.jsx)(e6,{details:n,handleClose:s,handleClick:r}):"view"==n.open?(0,i.jsx)(tu,{details:n,handleClose:s,handleClick:r,saveResults:l}):null};var tp=l.memo(tx);let tm=()=>{var t,n,s,a,u,f,g;let b=(0,r.useRouter)(),j=(0,p.I0)(),[y,T]=(0,l.useState)({exams:null,results:[],labels:[],time:null}),[E,Z]=(0,l.useState)({open:!1,payload:{}}),A=(0,l.useRef)(null);(0,l.useEffect)(()=>{j((0,v.V)({status:"Đang tải..."})),A.current&&A.current.terminate(),fetch("".concat(C.default.assetPrefix,"/scripts/worker.js")).then(t=>t.blob()).then(t=>{A.current=new Worker(URL.createObjectURL(t)),A.current.onmessage=async t=>{let{action:n="",payload:s=null}=t.data;switch(console.log(s),n){case"fetchLeaderboard":T(s),j((0,v.V)({status:""}));break;case"viewDetails":Z({open:"view",payload:s});break;case"historyDetails":Z({open:"history",payload:s});break;case"updateRealtime":T(t=>({...t,...s}))}}});let t=async()=>{try{let{parent:t="",id:n=""}=b.query;if(!n)return b.push("/");await I.default.get("/leaderboard/".concat(n,"/timeout"));let{data:s}=await I.default.get("/quizs/".concat(n,"/details?parent=").concat(t)),{data:i}=await I.default.post("/leaderboard/".concat(n,"/sync?parent=").concat(t));if((null==s?void 0:s.error)||(null==i?void 0:i.error))return P().fire({icon:"error",title:"Oops...",text:(null==s?void 0:s.error)||(null==i?void 0:i.error),footer:'<a href="#">Tại sao t\xf4i gặp th\xf4ng b\xe1o n\xe0y?</a>'}),b.push("/");A.current.postMessage({action:"fetchLeaderboard",payload:{response:s,results:i}})}catch(t){console.log("fetchData",t.message)}};return b.isReady&&t(),()=>{A.current&&A.current.terminate(),j((0,v.V)({status:""}))}},[b,j]);let S=(t,n)=>()=>{switch(n){case"remove":P().fire({title:"Bạn chắc chứ?",html:'<p>Bạn đang muốn xo\xe1 b\xe0i l\xe0m của th\xed sinh: <b style="color:red">'.concat((null==t?void 0:t.student)||(null==t?void 0:t.id),"</b>?</p>"),icon:"warning",showCancelButton:!0,confirmButtonText:"V\xe2ng. X\xf3a đi!",cancelButtonText:"Hủy"}).then(async n=>{if(n.isConfirmed){var s;j((0,v.V)({status:"Vui l\xf2ng đợi..."}));let{data:{error:n,text:i,time:r}}=await I.default.delete("/leaderboard/".concat(null===(s=b.query)||void 0===s?void 0:s.id,"?resultId=").concat(null==t?void 0:t.id));if(j((0,v.V)({status:""})),n)return P().fire(n,"","error");P().fire(i,"","success"),A.current.postMessage({action:"currentRealtime",payload:{...y,results:y.results.filter(n=>n.ResultId!=(null==t?void 0:t.id)),time:r}})}});break;case"view":A.current.postMessage({action:"viewDetails",payload:{id:t,leaderboard:y}});break;case"download":break;case"history":A.current.postMessage({action:"historyDetails",payload:{id:t,leaderboard:y}})}},N=async t=>{try{let{comments:n={},points:s={}}=JSON.parse(sessionStorage.getItem("results_"+t)||"{}");if(Object.keys(n).length||Object.keys(s).length){let{id:i=""}=b.query;j((0,v.V)({status:"Đang lưu"}));let{data:r}=await I.default.post("/leaderboard/".concat(i,"?resultId=").concat(t),{comments:n,points:s});if(j((0,v.V)({status:""})),r.error)return P().fire("Xảy ra lỗi!",r.error,"error");P().fire({icon:"success",title:"Đ\xe3 lưu",timer:1500}),sessionStorage.removeItem("results_"+t),A.current.postMessage({action:"updateResult",payload:{results:{...r,id:t},leaderboard:y}}),Z({open:!1})}}catch(t){console.log("saveResults",t.message)}};return(0,i.jsxs)(c.Z,{children:[(0,i.jsx)(ek(),{children:(0,i.jsxs)("title",{children:["Bảng điểm - ",(null==y?void 0:null===(t=y.exams)||void 0===t?void 0:null===(n=t.settings)||void 0===n?void 0:n.title)||"..."]})}),(0,i.jsx)(eM.Z,{className:"header-leaderboard",sx:{mb:5,color:"white"},children:(0,i.jsx)(X.Z,{title:(0,i.jsxs)(h.Z,{variant:"h5",component:ey(),href:"/p/create.html?parent=".concat(b.query.parent,"&id=").concat(b.query.id),sx:{color:"white",textDecoration:"none"},children:["BẢNG ĐIỂM - ",(null==y?void 0:null===(s=y.exams)||void 0===s?void 0:null===(a=s.settings)||void 0===a?void 0:a.title)||"..."]}),avatar:(0,i.jsx)(w.Z,{icon:"tabler:checkup-list",fontSize:"1.125rem"}),action:(0,i.jsxs)(c.Z,{sx:{display:"flex",alignItems:"center",color:"white"},children:[(0,i.jsx)(d.Z,{title:"Chỉnh sửa",children:(0,i.jsx)(x.Z,{sx:{color:"white"},component:ey(),href:"/p/create.html?parent=".concat(b.query.parent,"&id=").concat(b.query.id),children:(0,i.jsx)(w.Z,{icon:"tabler:edit",fontSize:20})})}),(0,i.jsx)(d.Z,{title:"Gi\xe1m s\xe1t",children:(0,i.jsx)(x.Z,{sx:{color:"white"},component:ey(),href:"/p/realtime.html?parent=".concat(b.query.parent,"&id=").concat(b.query.id),children:(0,i.jsx)(w.Z,{icon:"tabler:camera-bolt",fontSize:20})})}),(0,i.jsx)(d.Z,{title:"Xem đề thi",children:(0,i.jsx)(x.Z,{sx:{color:"white"},component:ey(),href:null!==(g=null==y?void 0:null===(u=y.exams)||void 0===u?void 0:null===(f=u.settings)||void 0===f?void 0:f.url)&&void 0!==g?g:"#",target:"_blank",children:(0,i.jsx)(w.Z,{icon:"tabler:eye",fontSize:20})})})]}),subheader:(0,i.jsxs)(h.Z,{sx:{color:"white"},variant:"body2",children:["(Cập nhật l\xfac ",eU(null==y?void 0:y.time).format("HH:mm:ss DD/MM/YYYY"),")"]}),sx:{py:{xs:2,md:5}}})}),(0,i.jsx)(eB,{results:y.results.map(t=>{var n,s;return{point:null==t?void 0:null===(n=t.overview)||void 0===n?void 0:n.point,number:null==t?void 0:null===(s=t.overview)||void 0===s?void 0:s.number}}),maxPoint:10}),(0,i.jsx)(eQ,{results:y.results.map(t=>({...t.overview,id:t.ResultId})).sort((t,n)=>n.point!==t.point?n.point-t.point:n.time!==t.time?t.time-n.time:t.startAt-n.startAt).map((t,n)=>({...t,rank:n+1})),labelColumn:y.labels,handleClick:S}),(0,i.jsx)(tp,{details:E,handleClose:()=>{Z({open:!1})},handleClick:S,saveResults:N})]})},tf=t=>{let{sx:n,icon:s,stats:r,title:l,avatarSize:a=42,iconSize:d="1.625rem",avatarColor:u="primary"}=t;return(0,i.jsx)(eM.Z,{sx:{...n},children:(0,i.jsxs)(K.Z,{sx:{gap:3,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,i.jsxs)(c.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-start"},children:[(0,i.jsx)(h.Z,{variant:"h5",sx:{mb:.5},children:r}),(0,i.jsx)(h.Z,{variant:"body2",children:l})]}),(0,i.jsx)(ei.Z,{skin:"light",color:u,sx:{width:a,height:a},children:(0,i.jsx)(w.Z,{icon:s,fontSize:d})})]})})},tg=t=>{let{statistic:n}=t,s=[{stats:null==n?void 0:n.total,icon:"tabler:list-check",title:"Số b\xe0i l\xe0m"},{stats:null==n?void 0:n.students,icon:"tabler:users",title:"Số học sinh",avatarColor:"success"},{stats:null==n?void 0:n.points,avatarColor:"error",title:"Điểm trung b\xecnh",icon:"tabler:circle-check"},{stats:null==n?void 0:n.times,title:"Thời gian trung b\xecnh",avatarColor:"warning",icon:"tabler:clock"}];return(0,i.jsx)(N.ZP,{container:!0,spacing:6,children:s.map((t,n)=>(0,i.jsx)(N.ZP,{item:!0,xs:12,md:3,children:(0,i.jsx)(tf,{...t})},n))})};var tv=(0,l.memo)(tg),tb=s(6901),tj=s(1964),ty=s.n(tj);(0,_.ZP)(c.Z)(t=>{let{theme:n}=t;return{display:"flex",alignItems:"center",padding:n.spacing(2.5),boxShadow:n.shadows[1],justifyContent:"space-between",borderRadius:n.shape.borderRadius,backgroundColor:n.palette.background.paper}}),(0,_.ZP)(c.Z)(t=>{let{theme:n}=t;return{padding:n.spacing(0,5,5),marginTop:5}});let tC=(0,_.ZP)(ty())(t=>{let{theme:n}=t;return{padding:n.spacing(5)}}),tw=t=>{let{logs:n}=t;(0,l.useEffect)(()=>{r()},[n]);let s=(0,l.useRef)(null),r=()=>{s.current&&(s.current._container.scrollTop=s.current._container.scrollHeight)},a=(0,l.useMemo)(()=>n.map((t,n)=>(0,i.jsxs)(c.Z,{sx:{display:"flex",flexDirection:t.admin?"row-reverse":"row",alignItems:"center",mb:2},children:[(0,i.jsx)(ei.Z,{children:t.admin?"GV":t.label}),(0,i.jsxs)(tb.Z,{severity:"success",icon:!1,sx:{mr:t.admin?2:void 0,ml:t.admin?void 0:2},children:[(0,i.jsx)(h.Z,{variant:"h6",sx:{fontWeight:600},dangerouslySetInnerHTML:{__html:t.text}}),(0,i.jsx)("div",{style:{textAlign:t.admin?"right":"left"},children:(0,i.jsx)(h.Z,{variant:"body",sx:{fontSize:"0.75rem"},children:eI()(t.t).format("HH:mm:ss DD/MM/YYYY")})})]})]},t.id+n)),[n]);return(0,i.jsxs)(eM.Z,{children:[(0,i.jsx)(X.Z,{title:(0,i.jsx)(h.Z,{variant:"h4",children:"Nhật k\xfd hoạt động"})}),(0,i.jsx)(c.Z,{sx:{flexGrow:1,height:"100%",backgroundColor:"action.hover"},children:(0,i.jsx)(tC,{ref:s,children:(0,i.jsx)(c.Z,{sx:{height:"50vh"},children:a})})})]})};var tT=(0,l.memo)(tw),tI=s(8987),tE=s(8619);let tZ=t=>Math.floor(t/36e5).toString().padStart(2,"0")+":"+Math.floor((t%=36e5)/6e4).toString().padStart(2,"0")+":"+Math.floor((t%=6e4)/1e3).toString().padStart(2,"0"),tA=(0,_.ZP)(ty())(t=>{let{theme:n}=t;return{padding:n.spacing(5)}}),tP=t=>{let{students:n,handleClick:s}=t,[r,a]=(0,l.useState)(null),[d,u]=(0,l.useState)(null),[x,p]=(0,l.useState)(new Date().getTime()),f=()=>{a(null)},g=t=>n=>{a(n.currentTarget),u(t)},v=t=>n=>{s(d.id,t),a(null),u(null)};(0,l.useEffect)(()=>{let t=setInterval(()=>{p(new Date().getTime())},1e3);return()=>{clearInterval(t)}},[n]);let b=(0,l.useRef)(null);return(0,i.jsxs)(eM.Z,{children:[(0,i.jsx)(X.Z,{title:(0,i.jsxs)(h.Z,{variant:"h4",children:["Học sinh đang l\xe0m (",n.length,")"]})}),(0,i.jsx)(c.Z,{sx:{flexGrow:1,height:"100%",backgroundColor:"action.hover"},children:(0,i.jsx)(tA,{ref:b,children:(0,i.jsx)(c.Z,{sx:{height:"62vh"},children:(0,i.jsx)(e7.Z,{children:n.map(t=>(0,i.jsx)(te.ZP,{disablePadding:!0,divider:!0,onClick:g(t),children:(0,i.jsxs)(tE.Z,{children:[(0,i.jsx)(tI.Z,{children:(0,i.jsx)(ei.Z,{color:null==t?void 0:t.color,children:t.label})}),(0,i.jsx)(el.Z,{children:t.student}),(0,i.jsxs)(to.Z,{sx:{textAlign:"center"},children:[(0,i.jsxs)(h.Z,{children:["Đ\xe3 l\xe0m ",t.taked]}),(0,i.jsx)(h.Z,{color:"error",fontWeight:600,children:tZ(x-t.startAt)})]})]})},t.id))})})})}),(null==n?void 0:n.length)?(0,i.jsx)(ea.Z,{anchorEl:r,keepMounted:!0,open:!!r,onClose:f,children:[{action:"alert",title:"Nhắc nhở quay lại b\xe0i thi",icon:"tabler:bell-plus",show:!1},{action:"message",title:"Gửi lời nhắn ri\xeang",icon:"tabler:message-chatbot",show:!1},{action:"cancel",title:"Buộc dừng b\xe0i thi",icon:"tabler:user-cancel",show:!0}].map(t=>!t.show&&(null==d?void 0:d.status)!="offline"||t.show?(0,i.jsxs)(eo.Z,{onClick:v(t.action),children:[(0,i.jsx)(er.Z,{children:(0,i.jsx)(w.Z,{icon:t.icon,fontSize:20})}),(0,i.jsx)(el.Z,{children:t.title})]},t.action):null)}):null]})};var tS=(0,l.memo)(tP);let tN=()=>{var t,n,s,a,u,f,g;let b=(0,r.useRouter)(),j=(0,p.I0)(),y=(0,l.useRef)(null),T=(0,l.useRef)(null),[E,Z]=(0,l.useState)({exams:null,results:[],labels:[],time:null}),[A,S]=(0,l.useState)({}),[k,_]=(0,l.useState)([]),[L,M]=(0,l.useState)([]),[R,O]=(0,l.useState)(null);(0,l.useEffect)(()=>{let t=setInterval(()=>{O(eU().format("HH:mm:ss DD/MM/YYYY"))},1e3);return()=>{clearInterval(t)}},[]),(0,l.useEffect)(()=>{(null==E?void 0:E.currents)&&y.current.postMessage({action:"currentRealtime",payload:E}),(null==E?void 0:E.logs)&&y.current.postMessage({action:"logsRealtime",payload:E}),(null==E?void 0:E.events)&&y.current.postMessage({action:"eventsRealtime",payload:E})},[E]),(0,l.useEffect)(()=>{j((0,v.V)({status:"Đang tải..."}));let t=async()=>{try{let{parent:t="",id:n=""}=b.query;if(!n)return b.push("/");await I.default.get("/leaderboard/".concat(n,"/timeout"));let{data:s}=await I.default.get("/quizs/".concat(n,"/details?parent=").concat(t)),{data:i}=await I.default.post("/leaderboard/".concat(n,"/sync?parent=").concat(t));if((null==s?void 0:s.error)||(null==i?void 0:i.error))return P().fire({icon:"error",title:"Oops...",text:(null==s?void 0:s.error)||(null==i?void 0:i.error),footer:'<a href="#">Tại sao t\xf4i gặp th\xf4ng b\xe1o n\xe0y?</a>'}),b.push("/");y.current.postMessage({action:"fetchRealtime",payload:{response:s,results:i}})}catch(t){console.log("fetchData",t.message)}},n=()=>{T.current&&T.current.close();let{parent:t="",id:n=""}=b.query,s="".concat("wss://cloud.taodethi.xyz","/socket?id=").concat(n,"&accessToken=").concat(localStorage.getItem("accessToken")||"");T.current=new WebSocket(s),T.current.onopen=()=>{console.log("Connected Socket")},T.current.onclose=t=>{console.log("Disconnected from server",t)},T.current.onerror=t=>{console.error("WebSocket error:",t)},T.current.onmessage=t=>{try{let{action:n,payload:s,ResultId:i,time:r}=JSON.parse(t.data);switch(n){case"current":Z(t=>({...t,currents:s}));break;case"visible":case"hidden":case"online":case"offline":Z(t=>({...t,logs:{payload:s,ResultId:i,time:r,action:n}}));break;case"submit":case"start":case"answers":Z(t=>({...t,events:{payload:s,ResultId:i,time:r,action:n}}))}}catch(t){console.log("onmessage",t.message)}}};return b.isReady&&(y.current&&y.current.terminate(),fetch("".concat(C.default.assetPrefix,"/scripts/worker.js")).then(t=>t.blob()).then(t=>{y.current=new Worker(URL.createObjectURL(t)),y.current.onmessage=async t=>{let{action:s="",payload:i=null}=t.data;switch(s){case"fetchLeaderboard":Z(i),n(),j((0,v.V)({status:""}));break;case"logsRealtime":_(i);break;case"statistic":S(i);break;case"studentsRealtime":M(i);break;case"updateRealtime":Z(t=>({...t,...i,currents:void 0,logs:void 0,events:void 0}))}}}),t()),()=>{y.current&&y.current.terminate(),T.current&&T.current.close(),j((0,v.V)({status:""}))}},[b]);let H=(t,n)=>{let s=L.find(n=>t==n.id);if(!s)return P().fire({icon:"error",title:"Oppss...",html:"Kh\xf4ng t\xecm thấy th\xf4ng tin"});switch(n){case"alert":P().fire({icon:"warning",title:"Ch\xfa \xfd",html:'Bạn muốn nhắc nhở bạn <b style="color:red">'.concat(s.student,"</b> quay lại l\xe0m b\xe0i thi ngay?"),showCancelButton:!0,cancelButtonText:"Hủy",cancelButtonColor:"#d33",confirmButtonText:"Đ\xfang vậy"}).then(t=>{if(t.isConfirmed){var n,i;(null==T?void 0:null===(n=T.current)||void 0===n?void 0:n.readyState)===WebSocket.OPEN?(null==T||null===(i=T.current)||void 0===i||i.send(JSON.stringify({action:"alert",payload:{clientId:s.clientId,resultId:s.id}})),P().fire("Đ\xe3 gửi!","","success")):P().fire("Vui l\xf2ng kết nối mạng","","error")}});break;case"message":P().fire({html:'Gửi lời nhắn đến bạn <b style="color:red">'.concat(s.student,"</b>"),input:"text",inputAttributes:{autocapitalize:"off"},showCancelButton:!0,confirmButtonText:"Gửi ngay",showLoaderOnConfirm:!0,preConfirm:async t=>{if(!t.toString().trim())return P().showValidationMessage("Vui l\xf2ng nhập nội dung")},allowOutsideClick:()=>!P().isLoading()}).then(t=>{if(t.isConfirmed){var n,i;(null==T?void 0:null===(n=T.current)||void 0===n?void 0:n.readyState)===WebSocket.OPEN?(null==T||null===(i=T.current)||void 0===i||i.send(JSON.stringify({action:"message",payload:{clientId:s.clientId,resultId:s.id,message:t.value}})),P().fire("Đ\xe3 gửi!","","success")):P().fire("Vui l\xf2ng kết nối mạng","","error")}});break;case"cancel":P().fire({icon:"warning",title:"Kết th\xfac b\xe0i thi",html:'Bạn muốn Kết th\xfac b\xe0i thi của th\xed sinh <b style="color:red">'.concat(s.student,"</b>?"),showCancelButton:!0,cancelButtonText:"Hủy",cancelButtonColor:"#d33",confirmButtonText:"Đ\xfang vậy"}).then(t=>{if(t.isConfirmed){var n,i;(null==T?void 0:null===(n=T.current)||void 0===n?void 0:n.readyState)===WebSocket.OPEN?(null==T||null===(i=T.current)||void 0===i||i.send(JSON.stringify({action:"cancel",payload:{clientId:s.clientId,resultId:s.id,userToken:s.userToken}})),P().fire("Đ\xe3 gửi!","","success")):P().fire("Vui l\xf2ng kết nối mạng","","error")}})}};return(0,i.jsxs)(c.Z,{children:[(0,i.jsx)(ek(),{children:(0,i.jsxs)("title",{children:["Gi\xe1m s\xe1t - ",(null==E?void 0:null===(t=E.exams)||void 0===t?void 0:null===(n=t.settings)||void 0===n?void 0:n.title)||"..."]})}),(0,i.jsx)(eM.Z,{className:"header-realtime",sx:{mb:5,color:"white"},children:(0,i.jsx)(X.Z,{title:(0,i.jsxs)(h.Z,{variant:"h5",component:ey(),href:"/p/create.html?parent=".concat(b.query.parent,"&id=").concat(b.query.id),sx:{color:"white",textDecoration:"none"},children:["GI\xc1M S\xc1T - ",(null==E?void 0:null===(s=E.exams)||void 0===s?void 0:null===(a=s.settings)||void 0===a?void 0:a.title)||"..."]}),avatar:(0,i.jsx)(w.Z,{icon:"tabler:camera-bolt",fontSize:"1.125rem"}),action:(0,i.jsxs)(c.Z,{sx:{display:"flex",alignItems:"center",color:"white"},children:[(0,i.jsx)(d.Z,{title:"Chỉnh sửa",children:(0,i.jsx)(x.Z,{sx:{color:"white"},component:ey(),href:"/p/create.html?parent=".concat(b.query.parent,"&id=").concat(b.query.id),children:(0,i.jsx)(w.Z,{icon:"tabler:edit",fontSize:20})})}),(0,i.jsx)(d.Z,{title:"Bảng điểm",children:(0,i.jsx)(x.Z,{sx:{color:"white"},component:ey(),href:"/p/leaderboard.html?parent=".concat(b.query.parent,"&id=").concat(b.query.id),children:(0,i.jsx)(w.Z,{icon:"tabler:checkup-list",fontSize:20})})}),(0,i.jsx)(d.Z,{title:"Xem đề thi",children:(0,i.jsx)(x.Z,{sx:{color:"white"},component:ey(),href:null!==(g=null==E?void 0:null===(u=E.exams)||void 0===u?void 0:null===(f=u.settings)||void 0===f?void 0:f.url)&&void 0!==g?g:"#",target:"_blank",children:(0,i.jsx)(w.Z,{icon:"tabler:eye",fontSize:20})})})]}),subheader:(0,i.jsxs)(h.Z,{sx:{color:"white"},variant:"body2",children:["(Cập nhật l\xfac ",R,")"]}),sx:{py:{xs:2,md:5}}})}),(0,i.jsx)(tv,{statistic:A}),(0,i.jsxs)(N.ZP,{container:!0,spacing:3,sx:{mt:3},children:[(0,i.jsx)(N.ZP,{item:!0,xs:12,md:6,children:(0,i.jsx)(tT,{logs:k})}),(0,i.jsx)(N.ZP,{item:!0,xs:12,md:6,children:(0,i.jsx)(tS,{students:L,handleClick:H})})]})]})},tk=()=>{},t_=(0,_.ZP)(c.Z)(t=>{let{theme:n}=t;return{display:"flex",alignItems:"center",padding:n.spacing(6),justifyContent:"space-between"}}),tL=t=>{let{open:n,toggle:s}=t;return(0,i.jsxs)(eK.ZP,{open:n,anchor:"right",variant:"temporary",ModalProps:{keepMounted:!0},sx:{"& .MuiDrawer-paper":{width:{xs:300,sm:400}}},children:[(0,i.jsxs)(t_,{children:[(0,i.jsx)(h.Z,{variant:"h5",children:"Add User"}),(0,i.jsx)(x.Z,{size:"small",sx:{p:"0.438rem",borderRadius:1,color:"text.primary",backgroundColor:"action.selected","&:hover":{backgroundColor:t=>"rgba(".concat(t.palette.customColors.main,", 0.16)")}},children:(0,i.jsx)(w.Z,{icon:"tabler:x",fontSize:"1.125rem"})})]}),(0,i.jsx)(c.Z,{sx:{p:t=>t.spacing(0,6,6)}})]})},tM=t=>{let{handleFilter:n,toggle:s,value:r}=t;return(0,i.jsxs)(c.Z,{sx:{py:4,px:6,rowGap:2,columnGap:4,display:"flex",flexWrap:"wrap",alignItems:"center",justifyContent:"space-between"},children:[(0,i.jsx)(u.Z,{color:"secondary",variant:"tonal",startIcon:(0,i.jsx)(w.Z,{icon:"tabler:upload"}),children:"Export"}),(0,i.jsxs)(c.Z,{sx:{rowGap:2,display:"flex",flexWrap:"wrap",alignItems:"center"},children:[(0,i.jsx)(eq.Z,{value:r,sx:{mr:4},placeholder:"Search User",onChange:t=>n(t.target.value)}),(0,i.jsxs)(u.Z,{onClick:s,variant:"contained",sx:{"& svg":{mr:2}},children:[(0,i.jsx)(w.Z,{fontSize:"1.125rem",icon:"tabler:plus"}),"Add New User"]})]})]})};var tR=s(2470);let tO=async t=>{try{return(await I.default.get(t)).data}catch(t){throw t}},tH=t=>t.avatar?(0,i.jsx)(ei.Z,{src:t.avatar,sx:{mr:2.5,width:38,height:38}}):(0,i.jsx)(ei.Z,{skin:"light",color:t.avatarColor,sx:{mr:2.5,width:38,height:38,fontWeight:500,fontSize:t=>t.typography.body1.fontSize},children:(0,tR.Q)(t.name?t.name:"John Doe").substr(-3)}),tD=[{flex:.25,minWidth:280,field:"name",headerName:"Họ v\xe0 t\xean",renderCell:t=>{let{row:n}=t,{name:s,phone:r}=n;return(0,i.jsxs)(c.Z,{sx:{display:"flex",alignItems:"center"},children:[tH(n),(0,i.jsxs)(c.Z,{sx:{display:"flex",alignItems:"flex-start",flexDirection:"column"},children:[(0,i.jsx)(h.Z,{noWrap:!0,component:ey(),href:"#",sx:{fontWeight:500,textDecoration:"none",color:"text.secondary","&:hover":{color:"primary.main"}},children:s}),(0,i.jsx)(h.Z,{noWrap:!0,variant:"body2",sx:{color:"text.disabled"},children:r})]})]})}},{flex:.15,minWidth:120,headerName:"Số b\xe1o danh",field:"sbd",renderCell:t=>{let{row:n}=t;return(0,i.jsx)(h.Z,{noWrap:!0,sx:{fontWeight:500,color:"text.secondary",textTransform:"capitalize"},children:n.sbd})}},{flex:.15,minWidth:120,headerName:"Giới t\xednh",field:"sex",renderCell:t=>{let{row:n}=t;return(0,i.jsx)(h.Z,{noWrap:!0,sx:{fontWeight:500,color:"text.secondary",textTransform:"capitalize"},children:n.sex})}},{flex:.15,minWidth:120,headerName:"Ng\xe0y sinh",field:"birthday",renderCell:t=>{let{row:n}=t;return(0,i.jsx)(h.Z,{noWrap:!0,sx:{fontWeight:500,color:"text.secondary",textTransform:"capitalize"},children:n.birthday})}},{flex:.1,minWidth:100,sortable:!1,field:"id",headerName:"",renderCell:t=>{let{row:n}=t;return(0,i.jsxs)(c.Z,{children:[(0,i.jsx)(d.Z,{title:"Sửa",children:(0,i.jsx)(x.Z,{children:(0,i.jsx)(w.Z,{icon:"tabler:pencil-minus"})})}),(0,i.jsx)(d.Z,{title:"Xo\xe1",children:(0,i.jsx)(x.Z,{color:"error",children:(0,i.jsx)(w.Z,{icon:"tabler:trash-filled"})})})]})}}],tz=()=>{let t=(0,r.useRouter)(),[n,s]=(0,l.useState)(""),{classes:a}=t.query,{data:c,error:h,isLoading:d}=(0,Q.Z)(t.isReady&&a?"/classes/class/".concat(a,"/view"):null,tO);t.isReady&&!a&&t.push("/p/classes.html");let[u,x]=(0,l.useState)(!1),[p,f]=(0,l.useState)(""),g=()=>x(!u),v=(0,l.useCallback)(t=>{f(t)},[]);return d?(0,i.jsx)(i.Fragment,{children:"Đảng tải"}):(0,i.jsxs)(N.ZP,{container:!0,spacing:6.5,children:[(0,i.jsxs)(N.ZP,{item:!0,xs:12,children:[(0,i.jsx)(tM,{value:p,handleFilter:v,toggle:g}),(0,i.jsx)(es._,{autoHeight:!0,rows:c||[],columns:tD,initialState:{pagination:{paginationModel:{pageSize:15}}},pageSizeOptions:[15,25,50],disableRowSelectionOnClick:!0})]}),(0,i.jsx)(tL,{open:u,toggle:g})]})};var tB=s(7922),tq=s(8756);let tF=t=>{let{children:n,option:s}=t;return s.href?(0,i.jsx)(c.Z,{component:ey(),href:s.href,...s.linkProps,sx:{px:4,py:1.5,width:"100%",display:"flex",color:"inherit",alignItems:"center",textDecoration:"none"},children:n}):(0,i.jsx)(i.Fragment,{children:n})},tG=t=>{let{icon:n,options:s,menuProps:r,iconProps:a,leftAlignMenu:c,iconButtonProps:h}=t,[d,u]=(0,l.useState)(null),{settings:p}=(0,tq.r)(),{direction:f}=p,g=t=>{u(t.currentTarget)},v=()=>{u(null)};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(x.Z,{"aria-haspopup":"true",onClick:g,...h,children:n||(0,i.jsx)(w.Z,{icon:"tabler:dots-vertical",...a})}),(0,i.jsx)(ea.Z,{keepMounted:!0,anchorEl:d,onClose:v,open:!!d,...!c&&{anchorOrigin:{vertical:"bottom",horizontal:"ltr"===f?"right":"left"},transformOrigin:{vertical:"top",horizontal:"ltr"===f?"right":"left"}},...r,children:s.map((t,n)=>"string"==typeof t?(0,i.jsx)(eo.Z,{onClick:v,children:t},n):"divider"in t?t.divider&&(0,i.jsx)(e8.Z,{...t.dividerProps},n):(0,i.jsx)(eo.Z,{...t.menuItemProps,...t.href&&{sx:{p:0}},onClick:n=>{v(),t.menuItemProps&&t.menuItemProps.onClick&&t.menuItemProps.onClick(n)},children:(0,i.jsxs)(tF,{option:t,children:[t.icon?t.icon:null,t.text]})},n))})]})};var tW=s(7918);let tY=t=>isNaN(parseFloat(t))?0:parseFloat(t).toFixed(2);var tU=t=>{let{questionId:n}=t,s=(0,p.v9)(t=>t.quiz.questions.find(t=>t.id==n)),r=(0,p.I0)(),a=t=>{r((0,g.Ds)({id:n,...t}))},[c,h]=(0,l.useState)(!1),[u,x]=(0,l.useState)(!1),f=t=>()=>{r((0,g.Zw)({questionId:n,type:"point",value:s.point||0,list:t})),x(!1)},v=()=>{h(!0),x(!1)};return c?(0,i.jsx)(ee,{type:"number",size:"small",sx:{width:"auto",maxWidth:"8rem"},value:s.point||0,InputProps:{inputProps:{min:0,max:10,step:.01},endAdornment:(0,i.jsx)(H.Z,{position:"end",children:"điểm"})},onMouseLeave:()=>h(!1),onChange:t=>a({point:t}),timeout:300}):(0,i.jsx)(d.Z,{open:u,onOpen:()=>x(!0),onClose:()=>x(!1),title:(0,i.jsxs)(e7.Z,{component:"div",children:[(0,i.jsx)(te.ZP,{disablePadding:!0,children:(0,i.jsx)(tE.Z,{sx:{paddingX:1},onClick:v,children:(0,i.jsx)(el.Z,{disableTypography:!0,sx:{fontSize:".75rem",textAlign:"center"},children:"Click để sửa điểm"})})}),(0,i.jsx)(te.ZP,{disablePadding:!0,children:(0,i.jsx)(tE.Z,{sx:{paddingX:1},onClick:f("group"),children:(0,i.jsx)(el.Z,{disableTypography:!0,sx:{fontSize:".75rem"},children:"\xc1p dụng cho c\xe2u c\xf2n lại trong nh\xf3m"})})}),(0,i.jsx)(te.ZP,{disablePadding:!0,children:(0,i.jsx)(tE.Z,{sx:{paddingX:1},onClick:f("exam"),children:(0,i.jsx)(el.Z,{disableTypography:!0,sx:{fontSize:".75rem"},children:"\xc1p dụng cho c\xe2u c\xf2n lại trong đề thi"})})})]}),arrow:!0,children:(0,i.jsx)(tW.Z,{variant:"outlined",label:tY(s.point)+" điểm",skin:"light",color:"primary",sx:{cursor:"pointer"},onClick:v})})},t$=s(7435),tV=t=>{let{questionId:n}=t,s=(0,p.v9)(t=>t.quiz.questions.find(t=>t.id==n)),r=(0,p.I0)(),a=t=>{r((0,g.Ds)({id:n,...t}))},[c,h]=(0,l.useState)(!1);return c?(0,i.jsxs)(t$.Z,{spacing:2,onMouseLeave:()=>{h(!1)},children:[(0,i.jsx)(ee,{label:"Nh\xe3n",size:"small",value:s.label,onChange:t=>a({label:t.trim()}),sx:{maxWidth:"15rem"},timeout:100}),(0,i.jsx)(ee,{label:"STT",type:"number",size:"small",value:s.number,InputProps:{inputProps:{min:1}},sx:{maxWidth:"15rem"},onChange:t=>a({number:t}),timeout:300})]}):(0,i.jsx)(d.Z,{title:"Click để sửa số thứ tự c\xe2u",children:(0,i.jsx)(tW.Z,{label:"".concat(s.label||"C\xe2u"," ").concat(s.number),color:"primary",onClick:()=>h(!0)})})};let tQ=eO()(()=>Promise.all([s.e(446),s.e(937),s.e(828),s.e(931)]).then(s.bind(s,4931)).then(t=>t.default),{loadableGenerated:{webpack:()=>[4931]},ssr:!1,loading:()=>(0,i.jsx)(c.Z,{sx:{textAlign:"center"},children:(0,i.jsx)(ef.Z,{})})}),tK=t=>(0,i.jsx)("div",{children:(0,i.jsx)(tQ,{...t})});var tX=l.memo(tK);let tJ={mouseX:null,mouseY:null},t0=t=>{let{children:n,onClick:s}=t,[r,a]=(0,l.useState)(tJ),c=t=>{t.preventDefault(),a({mouseX:t.clientX-2,mouseY:t.clientY-4})},h=()=>{s({index:n.key,type:"remove"}),d()},d=()=>{a(tJ)};return(0,i.jsxs)("div",{onContextMenu:c,style:{cursor:"context-menu"},children:[n,(0,i.jsx)(ea.Z,{keepMounted:!0,onClose:d,open:null!==r.mouseY,anchorReference:"anchorPosition",anchorPosition:null!==r.mouseY&&null!==r.mouseX?{top:r.mouseY,left:r.mouseX}:void 0,children:(0,i.jsxs)(eo.Z,{onClick:h,children:[(0,i.jsx)(er.Z,{children:(0,i.jsx)(w.Z,{icon:"tabler:circle-x",fontSize:20})}),(0,i.jsx)(el.Z,{primary:"X\xf3a đ\xe1p \xe1n n\xe0y"})]})})]})},t1=t=>{let{question:n,onChange:s}=t,{type:r,options:a=[],settings:h={},id:g}=n,[v,b]=(0,l.useState)(!1),[j,y]=(0,l.useState)(""),[C,T]=(0,l.useState)(a),I=(0,p.I0)(),E=function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return()=>{switch(r){case"TN":T(n=>n.map((n,s)=>({...n,keys:s===t})));break;case"HK":T(n=>n.map((n,s)=>({...n,keys:s===t?!n.keys:n.keys})));break;case"TF":T(s=>s.map((s,i)=>({...s,keys:i===t?n:s.keys})))}}},Z=()=>{let t={text:"",keys:""};T(n=>[...n,t])},A=()=>{T(t=>[...t,...j.split("\n").map(t=>({text:t.trim(),keys:""})).filter(t=>t.text)]),y(""),b(!1)},P=t=>{let{index:n,type:s}=t;"remove"===s&&T(t=>{var s=[...t];return s.splice(parseInt(n),1),s})},S=()=>{I((0,f.z)({status:"options",data:{questionId:g,title:"CẤU H\xccNH NHẬN DIỆN Đ\xc1P \xc1N ĐIỀN TỪ",...h}}))},N=(0,l.useMemo)(()=>C.map((t,n)=>{let s=t=>{T(s=>s.map((s,i)=>({...s,text:i===n?t:s.text})))};return(0,i.jsx)(t0,{onClick:P,children:(0,i.jsx)(te.ZP,{disablePadding:!0,sx:{borderRadius:1,mb:1,border:"1px solid #b2b2b299"},children:(0,i.jsxs)(tE.Z,{sx:{paddingX:1.25,borderRadius:1},user:"TF"!==r&t.keys?"right":"",children:["TF"==r?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(ei.Z,{skin:"light",color:"success",sx:{mr:1},user:"T"==t.keys?"right":"",onClick:E(n,"T"),children:"Đ"}),(0,i.jsx)(ei.Z,{skin:"light",user:"F"==t.keys?"right":"",color:"success",sx:{mr:1},onClick:E(n,"F"),children:"S"}),(0,i.jsx)(ei.Z,{skin:"light",sx:{mr:1},children:String.fromCharCode(97+n)})]}):(0,i.jsx)(tI.Z,{sx:{mr:1.25},onClick:E(n),children:(0,i.jsx)(ei.Z,{skin:t.keys?"light-static":"light",sx:{fontWeight:600},children:"MN|DT".includes(r)?n+1:String.fromCharCode(65+n)})}),(0,i.jsx)(el.Z,{disableTypography:!0,sx:{justifyItems:"center"},children:"DT"==r?(0,i.jsx)(ee,{placeholder:"Vui l\xf2ng nhập danh s\xe1ch đ\xe1p \xe1n cần th\xeam",fullWidth:!0,value:t.text||"",onChange:s}):(0,i.jsx)(tX,{content:t.text||"",onChange:s})})]})},n)},n)}),[C,r]);return((0,l.useEffect)(()=>{JSON.stringify(a)!==JSON.stringify(C)&&s({options:C})},[C,a]),(0,l.useEffect)(()=>{JSON.stringify(a)!==JSON.stringify(C)&&T(a)},[]),"TN|HK|MN|DT|TF".includes(r))?(0,i.jsxs)(c.Z,{sx:{mb:2},children:[(0,i.jsxs)(c.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,i.jsx)(e8.Z,{sx:{flexGrow:"1"},children:"DANH S\xc1CH Đ\xc1P \xc1N"}),"DT".includes(r)?(0,i.jsx)(d.Z,{title:"C\xe0i đặt nhận diện đ\xe1p \xe1n",children:(0,i.jsx)(x.Z,{size:"small",sx:{ml:1},onClick:S,children:(0,i.jsx)(w.Z,{icon:"tabler:settings-check",fontSize:20})})}):null]}),(0,i.jsx)(e7.Z,{children:N}),(0,i.jsxs)(c.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[(0,i.jsx)(u.Z,{variant:"contained",size:"small",color:"success",onClick:Z,children:"Th\xeam đ\xe1p \xe1n"}),(0,i.jsx)(u.Z,{variant:"tonal",size:"small",onClick:()=>b(!0),children:"Th\xeam nhanh"})]}),v?(0,i.jsxs)(c.Z,{children:[(0,i.jsx)(ee,{placeholder:"Vui l\xf2ng nhập danh s\xe1ch đ\xe1p \xe1n cần th\xeam",helperText:"* Lưu \xfd mỗi đ\xe1p \xe1n chỉ tr\xean một d\xf2ng",fullWidth:!0,minRows:3,multiline:!0,value:j,onChange:t=>y(t)}),(0,i.jsxs)(c.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"flex-end",mb:2},children:[(0,i.jsx)(u.Z,{variant:"tonal",size:"small",onClick:()=>{b(!1),y("")},sx:{mr:1},children:"Hủy"}),(0,i.jsx)(u.Z,{variant:"contained",size:"small",onClick:A,children:"X\xe1c nhận"})]})]}):null]}):null};var t2=l.memo(t1),t5=s(5438),t4=s(2852),t3=l.memo(function(t){let{videoId:n}=t;return(0,i.jsx)("div",{style:{position:"relative",paddingBottom:"56.25%",height:0,overflow:"hidden"},children:(0,i.jsx)("iframe",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%"},src:"https://www.youtube.com/embed/".concat((t=>{let n=t.match(/^(?:https?:\/\/)?(?:www\.)?youtu\.?be(?:\.com)?\/(?:watch\?v=|embed\/|v\/|youtu\.be\/|youtube\.com\/(?:c\/|v\/|u\/\w+\/|embed\/|watch\?v=|shorts\/))([\w-]{11})(?:[?&].*|$)/);return n?n[1]:null})(n)),title:"YouTube video player",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",frameBorder:"0",allowFullScreen:!0})})}),t9=l.memo(t=>{let{audio:n,onChange:s}=t,[r,a]=(0,l.useState)(""),{type:h,src:p}=n||{},f=t=>{let i=t.target.files[0];if(i){if("audio/mp3"===i.type||"audio/wav"===i.type||"audio/mpeg"===i.type||"audio/ogg"===i.type){let t=URL.createObjectURL(i);s({...n,src:t,type:"audio"})}else P().fire({icon:"error",title:"Oops...",text:"Chọn một file \xe2m thanh MP3 hoặc WAV."})}},g=t=>{let n=t.match(/^(?:https?:\/\/)?(?:www\.)?youtu\.?be(?:\.com)?\/(?:watch\?v=|embed\/|v\/|youtu\.be\/|youtube\.com\/(?:c\/|v\/|u\/\w+\/|embed\/|watch\?v=|shorts\/))([\w-]{11})(?:[?&].*|$)/);return n?n[1]:null},v=()=>{let t=g(r);t?(b({...n,src:r,type:"youtube"}),a("")):console.log("URL kh\xf4ng hợp lệ hoặc kh\xf4ng phải l\xe0 URL của video YouTube.")},b=t=>{s({...n,...t})};return(0,i.jsxs)(c.Z,{sx:{mb:2},children:[(0,i.jsxs)(c.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,i.jsxs)(u.Z,{variant:"tonal",fullWidth:!0,component:"label",sx:{mr:2},endIcon:(0,i.jsx)(w.Z,{icon:"tabler:headphones-filled"}),children:["Đ\xednh k\xe8m file \xe2m thanh",(0,i.jsx)("input",{type:"file",accept:".mp3, .wav,.mpeg, .ogg",hidden:!0,onChange:f})]}),(0,i.jsx)(u.Z,{variant:"tonal",fullWidth:!0,color:"success",endIcon:(0,i.jsx)(w.Z,{icon:"tabler:brand-youtube-filled"}),onClick:()=>{s({...n,type:"youtube",src:""})},children:"Đ\xednh k\xe8m video youtube"})]}),"youtube"!=h||p?null:(0,i.jsxs)(c.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",marginY:3},children:[(0,i.jsx)(O.Z,{size:"small",fullWidth:!0,variant:"outlined",label:"Link youtube",placeholder:"https://www.youtube.com/watch?v=TAODETHI",sx:{mr:2},color:"success",value:r,onChange:t=>a(t.target.value)}),(0,i.jsx)(u.Z,{variant:"outlined",color:"success",endIcon:(0,i.jsx)(w.Z,{icon:"tabler:square-rounded-plus-filled"}),onClick:v,children:"Th\xeam"})]}),"youtube"==h&&p?(0,i.jsx)(c.Z,{sx:{marginY:3},children:(0,i.jsx)(t3,{videoId:p})}):null,"audio"==h&&p?(0,i.jsx)(c.Z,{sx:{marginY:3},children:(0,i.jsx)("audio",{controls:!0,controlsList:"nodownload",preload:"metadata",src:p,style:{width:"100%"}})}):null,p?(0,i.jsxs)(e7.Z,{subheader:(0,i.jsx)(t5.Z,{children:"C\xe0i đặt Tệp đ\xednh k\xe8m"}),children:[(0,i.jsxs)(tE.Z,{divider:!0,onClick:()=>b({download:!n.download}),children:[(0,i.jsx)(tI.Z,{children:(0,i.jsx)(w.Z,{icon:"tabler:download",fontSize:20})}),(0,i.jsxs)(el.Z,{children:["Cho ph\xe9p tải file xuống",(0,i.jsx)(d.Z,{title:"Người nghe c\xf3 thể tải tập tin n\xe0y xuống m\xe1y t\xednh, điện thoại",children:(0,i.jsx)(x.Z,{size:"small",children:(0,i.jsx)(w.Z,{icon:"tabler:info-square-rounded",fontSize:20})})})]}),(0,i.jsx)(to.Z,{children:(0,i.jsx)(t4.Z,{edge:"end",checked:n.download||!1})})]}),(0,i.jsxs)(tE.Z,{divider:!0,onClick:()=>b({next:!n.next}),children:[(0,i.jsx)(tI.Z,{children:(0,i.jsx)(w.Z,{icon:"tabler:player-track-next",fontSize:20})}),(0,i.jsxs)(el.Z,{children:["Cho ph\xe9p tua file nghe, video",(0,i.jsx)(d.Z,{title:"Người nghe c\xf3 thể tua để nghe trước tập tin \xe2m thanh hoặc video",children:(0,i.jsx)(x.Z,{size:"small",children:(0,i.jsx)(w.Z,{icon:"tabler:info-square-rounded",fontSize:20})})})]}),(0,i.jsx)(to.Z,{children:(0,i.jsx)(t4.Z,{edge:"end",checked:n.next||!1})})]}),(0,i.jsxs)(tE.Z,{divider:!0,onClick:()=>b({speed:!n.speed}),children:[(0,i.jsx)(tI.Z,{children:(0,i.jsx)(w.Z,{icon:"tabler:brand-speedtest",fontSize:20})}),(0,i.jsxs)(el.Z,{children:["Cho ph\xe9p tăng, giảm tốc độ nghe",(0,i.jsx)(d.Z,{title:"Người nghe c\xf3 thể tăng tốc độ l\xean 2x hoặc x\xf3a 0.5x khi nghhe",children:(0,i.jsx)(x.Z,{size:"small",children:(0,i.jsx)(w.Z,{icon:"tabler:info-square-rounded",fontSize:20})})})]}),(0,i.jsx)(to.Z,{children:(0,i.jsx)(t4.Z,{edge:"end",checked:n.speed||!1})})]})]}):null]})});let t6=t=>{let{options:n=[],label:s="",questionId:r,onChange:a,value:c="",type:h="level"}=t,[u,x]=(0,l.useState)(!1),f=(0,p.I0)(),v=t=>()=>{f((0,g.Zw)({questionId:r,type:h,value:c,list:t})),x(!1)};return(0,i.jsx)(d.Z,{open:u,title:(0,i.jsxs)(e7.Z,{component:"div",children:[(0,i.jsx)(te.ZP,{disablePadding:!0,children:(0,i.jsx)(tE.Z,{sx:{paddingX:1},onClick:v("group"),children:(0,i.jsx)(el.Z,{disableTypography:!0,sx:{fontSize:".75rem"},children:"\xc1p dụng cho c\xe2u c\xf2n lại trong nh\xf3m"})})}),(0,i.jsx)(te.ZP,{disablePadding:!0,children:(0,i.jsx)(tE.Z,{sx:{paddingX:1},onClick:v("exam"),children:(0,i.jsx)(el.Z,{disableTypography:!0,sx:{fontSize:".75rem"},children:"\xc1p dụng cho c\xe2u c\xf2n lại trong đề thi"})})})]}),placement:"top",arrow:!0,onOpen:()=>x(!0),onClose:()=>x(!1),children:(0,i.jsx)(O.Z,{select:!0,label:s,size:"small",sx:{mr:1},value:c||"",onChange:t=>a(t.target.value),children:n.map(t=>(0,i.jsx)(eo.Z,{value:t.key,children:t.title},t.key))})})};var t8=l.memo(t6);let t7=[{key:"TN",title:"Trắc nghiệm"},{key:"TF",title:"Trắc nghiệm đ\xfang sai"},{key:"HK",title:"Nhiều lựa chọn"},{key:"DT",title:"Điền từ"},{key:"TL",title:"Tự luận"}],ne=[{key:"NB",title:"Nhận biết"},{key:"TH",title:"Th\xf4ng hiểu"},{key:"VD",title:"Vận dụng"},{key:"VDC",title:"Vận dụng cao"}],nt=t=>{let{questionId:n}=t,s=(0,p.v9)(t=>t.quiz.questions.find(t=>t.id==n)),[r,a]=(0,l.useState)(s),[f,v]=(0,l.useState)(!1),b=(0,p.I0)(),j=t=>{a(n=>({...n,...t}))},y=()=>{b((0,g.cN)({questionId:n}))},C=()=>{P().fire({title:"X\xf3a ".concat(r.label," ").concat(r.number),text:"Bạn đang thực hiện lệnh x\xf3a c\xe2u hỏi. Bạn c\xf3 muốn tiếp tục kh\xf4ng?",icon:"warning",showCancelButton:!0,confirmButtonText:"Đ\xfang. X\xf3a đi.",cancelButtonText:"Hủy"}).then(t=>{t.isConfirmed&&(b((0,g.dA)(n)),P().fire({position:"top-end",icon:"success",title:"Đ\xe3 x\xf3a c\xe2u hỏi",showConfirmButton:!1,timer:1500}))})},T=t=>n=>{let s=!r.audios&&Array.isArray(r.audios)?[...r.audios]:[{}];s[t]=n,j({audios:s})};(0,l.useEffect)(()=>{JSON.stringify(r)!==JSON.stringify(s)&&a(s)},[s]);let I=[{icon:(0,i.jsx)(w.Z,{icon:"tabler:circle-x"}),text:"X\xf3a c\xe2u hỏi n\xe0y",menuItemProps:{sx:{"& svg":{mr:2},color:"error.main"},onClick:C}}],E=(0,l.useCallback)(()=>{v(!0)},[]),Z=(0,l.useCallback)(()=>{v(!1)},[]);return((0,l.useEffect)(()=>{JSON.stringify(r)!==JSON.stringify(s)&&b((0,g.Ds)(r))},[r]),r)?(0,i.jsxs)("div",{onMouseEnter:E,onMouseLeave:Z,id:n,children:[(0,i.jsxs)(eM.Z,{sx:{mb:2},children:[(0,i.jsx)(X.Z,{title:(0,i.jsx)(tV,{questionId:n}),sx:{paddingY:2,overflowX:"auto",px:{xs:2,md:4}},action:(0,i.jsxs)(c.Z,{sx:{display:"flex",alignItems:"center"},children:[(0,i.jsx)(tU,{questionId:n}),(0,i.jsx)(d.Z,{title:"Th\xeam file nghe",children:(0,i.jsx)(x.Z,{size:"small",sx:{mr:1,ml:1,background:(r.audios||"").length?"#7367f0":"",color:(r.audios||"").length?"#fff":""},onClick:()=>{(r.audios||"").length?j({audios:[]}):j({audios:[{}]})},children:(0,i.jsx)(w.Z,{icon:(r.audios||"").length?"tabler:headphones-filled":"tabler:headphones-off",fontSize:20})})}),(0,i.jsx)(d.Z,{title:"Cố định đ\xe1p \xe1n",children:(0,i.jsx)(x.Z,{size:"small",sx:{mr:1,background:r.shuffle?"#7367f0":"",color:r.shuffle?"#fff":""},onClick:()=>j({shuffle:!r.shuffle}),children:(0,i.jsx)(w.Z,{icon:r.shuffle?"tabler:pin-filled":"tabler:pinned-off",fontSize:20})})}),(0,i.jsx)(t8,{label:"Loại c\xe2u hỏi",type:"type",questionId:n,value:r.type||"TN",options:t7,onChange:t=>j({type:t})}),(0,i.jsx)(t8,{label:"Mức độ",type:"level",questionId:n,value:r.level||"",options:ne,onChange:t=>j({level:t})}),(0,i.jsx)(tG,{options:I,iconButtonProps:{size:"small",sx:{color:"text.disabled"}}})]})}),(0,i.jsx)(e8.Z,{}),(0,i.jsxs)(K.Z,{sx:{px:{xs:2,md:4}},children:[r.audios&&r.audios.length?(0,i.jsx)(tb.Z,{severity:"warning",icon:!1,sx:{".MuiAlert-message":{width:"100%",overflow:"unset"},mt:3,".MuiListSubheader-root":{backgroundColor:"inherit"}},children:Array.isArray(r.audios)?r.audios.map((t,n)=>(0,i.jsx)(t9,{audio:t,onChange:T(n)},n)):null}):null,(0,i.jsx)(c.Z,{sx:{paddingY:3},children:(0,i.jsx)(tX,{content:r.content,onChange:t=>j({content:t})})}),(0,i.jsx)(t2,{question:r,onChange:j}),(0,i.jsxs)(tb.Z,{severity:"info",icon:!1,sx:{".MuiAlert-message":{width:"100%",overflow:"unset"}},children:[(0,i.jsx)(e8.Z,{children:"HƯỚNG DẪN GIẢI"}),(0,i.jsx)(c.Z,{children:(0,i.jsx)(tX,{content:r.explain||"",onChange:t=>j({explain:t})})})]})]})]}),(0,i.jsx)(c.Z,{sx:{mb:3,textAlign:"-webkit-center",height:"1.5rem"},children:f?(0,i.jsx)(e8.Z,{sx:{width:"75%"},children:(0,i.jsx)(u.Z,{variant:"tonal",size:"small",startIcon:(0,i.jsx)(w.Z,{icon:"tabler:plus"}),onClick:y,children:"Th\xeam c\xe2u hỏi"})}):null})]}):(0,i.jsx)(eM.Z,{sx:{mb:2,background:"#e91e1ec9"},children:(0,i.jsx)(X.Z,{title:(0,i.jsx)(h.Z,{sx:{textAlign:"center",color:"#fff"},variant:"h5",children:"C\xe2u hỏi kh\xf4ng tồn tại"})})})};var nn=l.memo(nt);let ns=t=>t.reduce((t,n)=>{let s=parseFloat(n.point);return isNaN(s)?t:t+s},0);var ni=t=>{let{groupId:n}=t,s=(0,p.v9)(t=>t.quiz.questions.filter(t=>t.groupId==n));return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(ts.Z,{rounded:!0,label:"".concat(s.length," c\xe2u"),skin:"light",color:"primary",size:"small",sx:{mr:1,width:"100%"}}),(0,i.jsx)(ts.Z,{rounded:!0,label:"".concat(ns(s).toFixed(2)," điểm"),skin:"light",color:"error",size:"small",sx:{width:"100%"}})]})};let nr=t=>{var n,s;let{groupId:r,isOne:a}=t,{questions:h,random:v,content:b,...j}=(0,p.v9)(t=>t.quiz.groups.find(t=>t.id==r)),y=(0,p.I0)(),[C,T]=(0,l.useState)(!0),I=(0,l.useMemo)(()=>h.map(t=>(0,i.jsx)(nn,{questionId:t},t)),[h]),E=()=>{y((0,g.xL)({groupId:r}))},Z=()=>{y((0,g.mD)({id:r,random:!v}))},A=()=>{y((0,f.z)({status:"group",data:{...j,random:v,title:"CẤU H\xccNH NH\xd3M C\xc2U HỎI"}}))},S=t=>{y((0,g.mD)({id:r,content:t}))},N=()=>{P().fire({title:"X\xf3a nh\xf3m c\xe2u hỏi?",text:"Bạn đang thực hiện lệnh x\xf3a nh\xf3m c\xe2u hỏi n\xe0y. Bạn c\xf3 muốn tiếp tục kh\xf4ng?",icon:"warning",showCancelButton:!0,confirmButtonText:"Đ\xfang. X\xf3a đi.",cancelButtonText:"Hủy"}).then(t=>{t.isConfirmed&&(y((0,g.BN)({groupId:r})),P().fire({position:"top-end",icon:"success",title:"Đ\xe3 x\xf3a th\xe0nh c\xf4ng",showConfirmButton:!1,timer:1500}))})},k=[{icon:(0,i.jsx)(w.Z,{icon:"tabler:circle-x"}),text:"X\xf3a nh\xf3m c\xe2u hỏi n\xe0y",menuItemProps:{sx:{"& svg":{mr:2},color:"error.main"},onClick:N}}];return a?(0,i.jsxs)(K.Z,{sx:{paddingX:0,mt:3},id:r,children:[I,(null==I?void 0:I.length)?null:(0,i.jsx)(u.Z,{variant:"outlined",endIcon:(0,i.jsx)(w.Z,{icon:"tabler:help-octagon"}),fullWidth:!0,sx:{mb:2},onClick:E,children:"TH\xcaM C\xc2U HỎI"})]}):(0,i.jsxs)(c.Z,{children:[(0,i.jsxs)(eM.Z,{className:"header-group",sx:{border:0,boxShadow:0,mb:2.5},id:r,children:[(0,i.jsx)(X.Z,{sx:{paddingY:1,alignItems:"center"},avatar:(0,i.jsx)(w.Z,{icon:"tabler:clipboard-list"}),action:(0,i.jsxs)(c.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,i.jsx)(d.Z,{title:"Th\xeam file nghe cho nh\xf3m c\xe2u hỏi",children:(0,i.jsx)(x.Z,{size:"small",sx:{color:"text.secondary",background:(null==j?void 0:null===(n=j.audios)||void 0===n?void 0:n.length)?"#7367f0":"",color:(null==j?void 0:null===(s=j.audios)||void 0===s?void 0:s.length)?"#fff":""},onClick:A,children:(0,i.jsx)(w.Z,{icon:"tabler:headphones-filled",fontSize:20})})}),(0,i.jsx)(d.Z,{title:"Cố định c\xe2u hỏi trong nh\xf3m",children:(0,i.jsx)(x.Z,{size:"small",sx:{mx:1,background:v?"#7367f0":"",color:v?"#fff":""},onClick:Z,children:(0,i.jsx)(w.Z,{icon:v?"tabler:pinned-filled":"tabler:pinned",fontSize:20})})}),(0,i.jsx)(ni,{groupId:r}),(0,i.jsx)(d.Z,{title:"Cấu h\xecnh nh\xf3m c\xe2u hỏi",children:(0,i.jsx)(x.Z,{size:"small",sx:{color:"text.secondary"},onClick:A,children:(0,i.jsx)(w.Z,{icon:"tabler:settings-share",fontSize:20})})}),(0,i.jsx)(tG,{options:k,iconButtonProps:{size:"small",sx:{color:"text.disabled"}}}),(0,i.jsx)(d.Z,{title:"Ẩn/Hiện chi tiết",children:(0,i.jsx)(x.Z,{size:"small","aria-label":"collapse",sx:{mr:2,color:"text.secondary"},onClick:()=>T(!C),children:(0,i.jsx)(w.Z,{fontSize:20,icon:C?"tabler:chevron-up":"tabler:chevron-down"})})})]})}),(0,i.jsx)(K.Z,{sx:{p:t=>"".concat(t.spacing(4,3,4)," !important")},children:(0,i.jsx)(tX,{content:b||"",sx:{marginY:5},onChange:S})})]}),(0,i.jsx)(tB.Z,{in:C,children:(0,i.jsxs)(K.Z,{sx:{paddingX:0,mt:3},children:[I,(null==I?void 0:I.length)?null:(0,i.jsx)(u.Z,{variant:"outlined",endIcon:(0,i.jsx)(w.Z,{icon:"tabler:help-octagon"}),fullWidth:!0,sx:{mb:2},onClick:E,children:"TH\xcaM C\xc2U HỎI"})]})})]})},nl=t=>t.reduce((t,n)=>{let s=parseFloat(n.point);return isNaN(s)?t:t+s},0);var na=t=>{let{quizId:n}=t,s=(0,p.v9)(t=>t.quiz.questions.filter(t=>t.quizId==n));return(0,i.jsxs)(c.Z,{sx:{display:"flex",alignItems:"center",flexFlow:"column",mr:1},children:[(0,i.jsx)(ts.Z,{rounded:!0,label:"".concat(s.length," c\xe2u"),skin:"light",color:"primary",size:"small",sx:{mb:1,width:"100%"}}),(0,i.jsx)(ts.Z,{rounded:!0,label:"".concat(nl(s).toFixed(2)," điểm"),skin:"light",color:"success",size:"small",sx:{width:"100%"}})]})},no=s(6591);let nc=t=>{let{quizId:n}=t;return(0,i.jsx)(eK.ZP,{open:!!n,sx:{zIndex:1301},anchor:"right",children:"hihi"})},nh=t=>{let{quizId:n}=t,[s,r]=(0,l.useState)(!0),[a,h]=(0,l.useState)(!1),[f,b]=(0,l.useState)(""),j=(0,p.v9)(t=>t.quiz.quizs.find(t=>t.id==n)),y=(0,p.v9)(t=>t.quiz.questions.filter(t=>t.quizId==n)).length,C=(0,p.I0)(),T=()=>{C((0,g.Rp)({quizId:n}))},I=(0,l.useMemo)(()=>j.groups.map(t=>(0,i.jsx)(nr,{groupId:t,isOne:1==j.groups.length},t)),[j.groups]),E=()=>{(0,no.ImportFile)(n,t=>{let{status:n,data:s,error:i}=t;if(i)return C((0,v.V)({status:""})),P().fire({icon:"error",title:"Oops...",text:i});switch(n){case"done":C((0,g.l$)(s)),C((0,v.V)({status:""}));break;case"loading":C((0,v.V)(s))}})},Z=()=>{y?P().fire({title:"Thay đổi c\xe2u hỏi Đề số ".concat(j.number),html:"Khi bạn thay đổi dữ liệu c\xe2u hỏi của đề thi số ".concat(j.number,", nếu đ\xe3 c\xf3 học sinh l\xe0m b\xe0i th\xec dữ liệu b\xe0i l\xe0m của học sinh đ\xf3 sẽ kh\xf4ng được lưu v\xe0 t\xednh l\xe0 0 điểm. Để đảm bảo kh\xf4ng ảnh hưởng để kết quả của học sinh, chỉ chỉ c\xf3 thể chỉnh sửa ngay tại c\xe2u hỏi đ\xf3. Bạn c\xf3 muốn tiếp tục kh\xf4ng?"),icon:"warning",showCancelButton:!0,confirmButtonText:"Tiếp tục",cancelButtonText:"Hủy"}).then(t=>{t.isConfirmed&&E()}):E()},A=()=>{P().fire({title:"X\xf3a Đề số ".concat(j.number),text:"Bạn đang thực hiện lệnh x\xf3a đề thi. Bạn c\xf3 muốn tiếp tục kh\xf4ng?",icon:"warning",showCancelButton:!0,confirmButtonText:"Đ\xfang. X\xf3a đi.",cancelButtonText:"Hủy"}).then(t=>{t.isConfirmed&&(C((0,g.GE)({quizId:n})),P().fire({position:"top-end",icon:"success",title:"Đ\xe3 x\xf3a th\xe0nh c\xf4ng",showConfirmButton:!1,timer:1500}))})},S=()=>{C((0,g.QT)({quizId:n}))},N=[{icon:(0,i.jsx)(w.Z,{icon:"tabler:list-numbers"}),text:"Đ\xe1nh lại số thứ tự c\xe2u hỏi",menuItemProps:{sx:{"& svg":{mr:2}},onClick:S}},{icon:(0,i.jsx)(w.Z,{icon:"tabler:file-type-docx"}),text:"Nhập c\xe2u hỏi từ tập tin .pdf, .docx",menuItemProps:{sx:{"& svg":{mr:2}},onClick:Z}},{icon:(0,i.jsx)(w.Z,{icon:"tabler:circle-x"}),text:"X\xf3a đề thi n\xe0y",menuItemProps:{sx:{"& svg":{mr:2},color:"error.main"},onClick:A}}];return(0,i.jsxs)("div",{style:{marginBottom:10},className:a?"card-fullscreen":"",id:j.id,children:[(0,i.jsx)(X.Z,{className:"header-exam",sx:{paddingY:3,borderRadius:"0.5rem","span, svg":{color:"#fff"}},title:"Đề số "+j.number,action:(0,i.jsxs)(c.Z,{sx:{display:"flex",alignItems:"center"},children:[(0,i.jsx)(d.Z,{title:"Nhập c\xe2u hỏi từ tập tin .pdf, .docx",children:(0,i.jsx)(x.Z,{size:"small",sx:{color:"text.secondary"},onClick:Z,children:(0,i.jsx)(w.Z,{icon:"tabler:upload",fontSize:20})})}),(0,i.jsx)(na,{quizId:n}),(0,i.jsx)(d.Z,{title:a?"Thu nhỏ m\xe0n h\xecnh đề thi số "+j.number:"Mở rộng m\xe0n h\xecnh đề thi số "+j.number,children:(0,i.jsx)(x.Z,{size:"small",sx:{color:"text.secondary"},onClick:()=>h(!a),children:(0,i.jsx)(w.Z,{icon:a?"tabler:arrows-minimize":"tabler:arrows-maximize",fontSize:20})})}),(0,i.jsx)(tG,{options:N,iconButtonProps:{size:"small",sx:{color:"text.disabled"}}}),(0,i.jsx)(d.Z,{title:s?"Ẩn chi tiết đề thi số "+j.number:"Hiển thị chi tiết đề thi số "+j.number,children:(0,i.jsx)(x.Z,{size:"small","aria-label":"collapse",sx:{mr:2,color:"text.secondary"},onClick:()=>r(!s),children:(0,i.jsx)(w.Z,{fontSize:20,icon:s?"tabler:chevron-up":"tabler:chevron-down"})})})]})}),(0,i.jsx)(tB.Z,{in:s,children:(0,i.jsxs)(K.Z,{sx:{paddingX:0,mt:3},children:[I,(0,i.jsx)(u.Z,{variant:"tonal",endIcon:(0,i.jsx)(w.Z,{icon:"tabler:square-rounded-plus"}),fullWidth:!0,sx:{mb:2},color:"success",onClick:T,children:"TH\xcaM NH\xd3M C\xc2U HỎI"})]})}),(0,i.jsx)(nc,{quizId:f})]})},nd=()=>{let t=(0,p.v9)(t=>t.quiz.quizs),n=(0,p.I0)(),s=()=>{n((0,g.BT)())};return(0,i.jsxs)(i.Fragment,{children:[t.map(t=>(0,i.jsx)(nh,{quizId:t.id},t.id)),(0,i.jsx)(u.Z,{variant:"contained",endIcon:(0,i.jsx)(w.Z,{icon:"tabler:clipboard-plus"}),fullWidth:!0,sx:{mt:3},onClick:s,children:"TH\xcaM ĐỀ THI"})]})};var nu=s(4054),nx=s(3841),np=s(7709);let nm=()=>{var t,n;let s=(0,p.v9)(t=>t.quiz.settings),[a,d]=(0,l.useState)(!1),u=(0,p.I0)(),v=(0,r.useRouter)(),b=F(),j=()=>{if(a)return;let t=document.createElement("input");t.setAttribute("type","file"),t.setAttribute("accept","image/*"),t.click(),t.onchange=async()=>{let[n]=t.files;if(n){d(!0);let t=s.cover||"https://i.imgur.com/dKZNJGk.png",i=URL.createObjectURL(n);y({cover:i});let{error:r,url:l}=await E(n);d(!1),r&&(y({cover:t}),P().fire({icon:"error",title:"C\xf3 lỗi khi thay đổi ảnh b\xeca"})),l&&y({cover:l})}}},y=t=>{u((0,g.kQ)(t))},C=t=>()=>{t&&v.push({pathname:t,query:v.query})},T=()=>{u((0,f.z)({status:"settings",data:{}}))},I=t=>{b.copy(t),S.ZP.success("Đ\xe3 sao ch\xe9p",{duration:2e3})};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(eM.Z,{sx:{background:"#b1b1b11f",mb:3},children:(0,i.jsx)(K.Z,{sx:{padding:".5rem!important"},children:(0,i.jsxs)(e7.Z,{component:"div",sx:{p:0},children:[(0,i.jsx)(te.ZP,{disablePadding:!0,children:(0,i.jsxs)(tE.Z,{sx:{display:"flex",flexDirection:"column"},onClick:j,children:[a?(0,i.jsxs)(c.Z,{style:{position:"relative"},children:[(0,i.jsx)("img",{src:null!==(t=null==s?void 0:s.cover)&&void 0!==t?t:"https://i.imgur.com/dKZNJGk.png",style:{maxWidth:"100%",filter:"blur(5px)"}}),(0,i.jsx)(ef.Z,{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}})]}):(0,i.jsx)("img",{src:null!==(n=null==s?void 0:s.cover)&&void 0!==n?n:"https://i.imgur.com/dKZNJGk.png",style:{maxWidth:"100%"}}),(0,i.jsx)(el.Z,{primary:"Click để thay đổi ảnh b\xeca"})]})}),(0,i.jsx)(te.ZP,{disablePadding:!0,children:(0,i.jsx)(ee,{fullWidth:!0,label:"T\xean đề thi",value:s.title,onChange:t=>y({title:t})})}),(0,i.jsx)(te.ZP,{disablePadding:!0,children:(0,i.jsxs)(c.Z,{sx:{width:"100%"},children:[(0,i.jsx)(h.Z,{variant:"h6",sx:{marginY:2},children:"Giới thiệu về đề thi"}),(0,i.jsx)(tX,{content:s.subtitle,sx:{minHeight:"5rem"},theme:"snow",inline:!0,onChange:t=>y({subtitle:t})})]})})]})})}),(null==s?void 0:s.url)?(0,i.jsx)(eM.Z,{sx:{mb:3},children:(0,i.jsx)(K.Z,{sx:{p:"0.75rem!important"},children:(0,i.jsxs)(nu.Z,{fullWidth:!0,variant:"outlined",children:[(0,i.jsx)(nx.Z,{children:"Link đề thi"}),(0,i.jsx)(np.Z,{value:(null==s?void 0:s.url)||"",disabled:!0,endAdornment:(0,i.jsx)(H.Z,{position:"end",children:(0,i.jsx)(x.Z,{edge:"end",onClick:()=>I(null==s?void 0:s.url),sx:{color:"success.main"},children:(0,i.jsx)(w.Z,{icon:"tabler:copy",fontSize:20})})}),label:"Link đề thi"})]})})}):null,(0,i.jsx)(eM.Z,{className:"menu-settings",children:(0,i.jsx)(K.Z,{sx:{padding:".5rem!important"},children:(0,i.jsxs)(e7.Z,{component:"div",sx:{p:0,color:"#fff"},children:[(0,i.jsx)(te.ZP,{disablePadding:!0,onClick:T,children:(0,i.jsxs)(tE.Z,{children:[(0,i.jsx)(er.Z,{sx:{color:"#fff"},children:(0,i.jsx)(w.Z,{icon:"tabler:settings",fontSize:20})}),(0,i.jsx)(el.Z,{primary:"C\xe0i đặt b\xe0i l\xe0m online",disableTypography:!0})]})}),(null==s?void 0:s.url)?(0,i.jsx)(te.ZP,{disablePadding:!0,onClick:C("/p/leaderboard.html"),children:(0,i.jsxs)(tE.Z,{children:[(0,i.jsx)(er.Z,{sx:{color:"#fff"},children:(0,i.jsx)(w.Z,{icon:"tabler:checkup-list",fontSize:20})}),(0,i.jsx)(el.Z,{primary:"Bảng điểm",disableTypography:!0})]})}):null,(null==s?void 0:s.url)?(0,i.jsx)(te.ZP,{disablePadding:!0,onClick:C("/p/realtime.html"),children:(0,i.jsxs)(tE.Z,{children:[(0,i.jsx)(er.Z,{sx:{color:"#fff"},children:(0,i.jsx)(w.Z,{icon:"tabler:camera-bolt",fontSize:20})}),(0,i.jsx)(el.Z,{primary:"Gi\xe1m s\xe1t thời gian thực",disableTypography:!0})]})}):null]})})})]})};var nf=function(t){let{videoId:n}=t;return(0,i.jsx)("div",{style:{position:"relative",paddingBottom:"56.25%",height:0,overflow:"hidden"},children:(0,i.jsx)("iframe",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%"},src:"https://www.youtube.com/embed/".concat((t=>{let n=t.match(/^(?:https?:\/\/)?(?:www\.)?youtu\.?be(?:\.com)?\/(?:watch\?v=|embed\/|v\/|youtu\.be\/|youtube\.com\/(?:c\/|v\/|u\/\w+\/|embed\/|watch\?v=|shorts\/))([\w-]{11})(?:[?&].*|$)/);return n?n[1]:null})(n)),title:"YouTube video player",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",frameBorder:"0",allowFullScreen:!0})})},ng=t=>{let{audio:n,onChange:s}=t,[r,a]=(0,l.useState)(""),{type:h,src:p}=n||{},f=t=>{let i=t.target.files[0];if(i){if("audio/mp3"===i.type||"audio/wav"===i.type||"audio/mpeg"===i.type||"audio/ogg"===i.type){let t=URL.createObjectURL(i);s({...n,src:t,type:"audio"})}else P().fire({icon:"error",title:"Oops...",text:"Chọn một file \xe2m thanh MP3 hoặc WAV."})}},g=t=>{let n=t.match(/^(?:https?:\/\/)?(?:www\.)?youtu\.?be(?:\.com)?\/(?:watch\?v=|embed\/|v\/|youtu\.be\/|youtube\.com\/(?:c\/|v\/|u\/\w+\/|embed\/|watch\?v=|shorts\/))([\w-]{11})(?:[?&].*|$)/);return n?n[1]:null},v=()=>{let t=g(r);t?(b({...n,src:r,type:"youtube"}),a("")):console.log("URL kh\xf4ng hợp lệ hoặc kh\xf4ng phải l\xe0 URL của video YouTube.")},b=t=>{s({...n,...t})};return(0,i.jsxs)(c.Z,{sx:{mb:2},children:[(0,i.jsxs)(c.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,i.jsxs)(u.Z,{variant:"tonal",fullWidth:!0,component:"label",sx:{mr:2},endIcon:(0,i.jsx)(w.Z,{icon:"tabler:headphones-filled"}),children:["Đ\xednh k\xe8m file \xe2m thanh",(0,i.jsx)("input",{type:"file",accept:".mp3, .wav,.mpeg, .ogg",hidden:!0,onChange:f})]}),(0,i.jsx)(u.Z,{variant:"tonal",fullWidth:!0,color:"success",endIcon:(0,i.jsx)(w.Z,{icon:"tabler:brand-youtube-filled"}),onClick:()=>{s({...n,type:"youtube",src:""})},children:"Đ\xednh k\xe8m video youtube"})]}),"youtube"!=h||p?null:(0,i.jsxs)(c.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",marginY:3},children:[(0,i.jsx)(O.Z,{size:"small",fullWidth:!0,variant:"outlined",label:"Link youtube",placeholder:"https://www.youtube.com/watch?v=TAODETHI",sx:{mr:2},color:"success",value:r,onChange:t=>a(t.target.value)}),(0,i.jsx)(u.Z,{variant:"outlined",color:"success",endIcon:(0,i.jsx)(w.Z,{icon:"tabler:square-rounded-plus-filled"}),onClick:v,children:"Th\xeam"})]}),"youtube"==h&&p?(0,i.jsx)(c.Z,{sx:{marginY:3},children:(0,i.jsx)(nf,{videoId:p})}):null,"audio"==h&&p?(0,i.jsx)(c.Z,{sx:{marginY:3},children:(0,i.jsx)("audio",{controls:!0,controlsList:"nodownload",preload:"metadata",src:p,style:{width:"100%"}})}):null,p?(0,i.jsxs)(e7.Z,{subheader:(0,i.jsx)(t5.Z,{children:"C\xe0i đặt Tệp đ\xednh k\xe8m"}),children:[(0,i.jsxs)(tE.Z,{divider:!0,onClick:()=>b({download:!n.download}),children:[(0,i.jsx)(tI.Z,{children:(0,i.jsx)(w.Z,{icon:"tabler:download",fontSize:20})}),(0,i.jsxs)(el.Z,{children:["Cho ph\xe9p tải file xuống",(0,i.jsx)(d.Z,{title:"Người nghe c\xf3 thể tải tập tin n\xe0y xuống m\xe1y t\xednh, điện thoại",children:(0,i.jsx)(x.Z,{size:"small",children:(0,i.jsx)(w.Z,{icon:"tabler:info-square-rounded",fontSize:20})})})]}),(0,i.jsx)(to.Z,{children:(0,i.jsx)(t4.Z,{edge:"end",checked:n.download||!1})})]}),(0,i.jsxs)(tE.Z,{divider:!0,onClick:()=>b({next:!n.next}),children:[(0,i.jsx)(tI.Z,{children:(0,i.jsx)(w.Z,{icon:"tabler:player-track-next",fontSize:20})}),(0,i.jsxs)(el.Z,{children:["Cho ph\xe9p tua file nghe, video",(0,i.jsx)(d.Z,{title:"Người nghe c\xf3 thể tua để nghe trước tập tin \xe2m thanh hoặc video",children:(0,i.jsx)(x.Z,{size:"small",children:(0,i.jsx)(w.Z,{icon:"tabler:info-square-rounded",fontSize:20})})})]}),(0,i.jsx)(to.Z,{children:(0,i.jsx)(t4.Z,{edge:"end",checked:n.next||!1})})]}),(0,i.jsxs)(tE.Z,{divider:!0,onClick:()=>b({speed:!n.speed}),children:[(0,i.jsx)(tI.Z,{children:(0,i.jsx)(w.Z,{icon:"tabler:brand-speedtest",fontSize:20})}),(0,i.jsxs)(el.Z,{children:["Cho ph\xe9p tăng, giảm tốc độ nghe",(0,i.jsx)(d.Z,{title:"Người nghe c\xf3 thể tăng tốc độ l\xean 2x hoặc x\xf3a 0.5x khi nghhe",children:(0,i.jsx)(x.Z,{size:"small",children:(0,i.jsx)(w.Z,{icon:"tabler:info-square-rounded",fontSize:20})})})]}),(0,i.jsx)(to.Z,{children:(0,i.jsx)(t4.Z,{edge:"end",checked:n.speed||!1})})]})]}):null]})};let nv=(0,_.ZP)(x.Z)(t=>{let{theme:n}=t;return{top:0,right:0,color:"grey.500",position:"absolute",boxShadow:n.shadows[2],transform:"translate(10px, -10px)",borderRadius:n.shape.borderRadius,backgroundColor:"".concat(n.palette.background.paper," !important"),transition:"transform 0.25s ease-in-out, box-shadow 0.25s ease-in-out","&:hover":{transform:"translate(7px, -5px)"}}}),nb=[{key:"random",title:"Cố định c\xe2u hỏi trong nh\xf3m",icon:"tabler:arrows-shuffle",subtitle:"Thứ tự c\xe2u hỏi trong nh\xf3m sẽ được cố định. Kh\xf4ng thay đổi d\xf9 c\xf3 bật chế độ trộn c\xe2u hỏi."},{key:"order",title:"Đ\xe1nh lại thứ tự c\xe2u",icon:"tabler:list-numbers",subtitle:"Thứ tự c\xe2u hỏi sẽ đ\xe1nh lại từ c\xe2u 1"}];var nj=()=>{let t=(0,p.v9)(t=>t.popup.data),n=(0,p.I0)(),[s,r]=(0,l.useState)(t),a=()=>{n((0,f.z)({status:""}))},v=t=>()=>{r({...s,...t})},b=()=>{let{title:t,...i}=s;n((0,g.mD)(i)),a()},j=t=>n=>{let i=!s.audios&&Array.isArray(s.audios)?[...s.audios]:[{}];i[t]=n,v({audios:i})()};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(M.Z,{sx:{pb:t=>"".concat(t.spacing(8)," !important"),px:t=>["".concat(t.spacing(5)," !important"),"".concat(t.spacing(15)," !important")],pt:t=>["".concat(t.spacing(8)," !important"),"".concat(t.spacing(12.5)," !important")]},children:[(0,i.jsx)(nv,{onClick:a,children:(0,i.jsx)(w.Z,{icon:"tabler:x",fontSize:"1.25rem"})}),(0,i.jsx)(c.Z,{sx:{mb:5,textAlign:"center"},children:(0,i.jsx)(h.Z,{variant:"h5",sx:{mb:3},children:s.title})}),s.audios&&0!=s.audios.length?null:(0,i.jsx)(ng,{audio:{},onChange:j(0)}),Array.isArray(s.audios)?s.audios.map((t,n)=>(0,i.jsx)(ng,{audio:t,onChange:j(n)},n)):null,(0,i.jsx)(e7.Z,{subheader:(0,i.jsx)(t5.Z,{children:"C\xe0i đặt kh\xe1c"}),children:nb.map(t=>(0,i.jsxs)(tE.Z,{onClick:v({[t.key]:!s[t.key]}),divider:!0,children:[(0,i.jsx)(tI.Z,{children:(0,i.jsx)(w.Z,{icon:t.icon,fontSize:20})}),(0,i.jsxs)(el.Z,{children:[t.title,(0,i.jsx)(d.Z,{title:t.subtitle,children:(0,i.jsx)(x.Z,{size:"small",children:(0,i.jsx)(w.Z,{icon:"tabler:info-square-rounded",fontSize:20})})})]}),(0,i.jsx)(to.Z,{children:(0,i.jsx)(t4.Z,{edge:"end",checked:s[t.key]||!1})})]},t.key))})]}),(0,i.jsxs)(R.Z,{sx:{justifyContent:"center",px:t=>["".concat(t.spacing(5)," !important"),"".concat(t.spacing(15)," !important")],pb:t=>["".concat(t.spacing(8)," !important"),"".concat(t.spacing(12.5)," !important")]},children:[(0,i.jsx)(u.Z,{variant:"tonal",color:"secondary",onClick:a,children:"Hủy"}),(0,i.jsx)(u.Z,{variant:"contained",sx:{mr:1},onClick:b,children:"Lưu"})]})]})};let ny=(0,_.ZP)(x.Z)(t=>{let{theme:n}=t;return{top:0,right:0,color:"grey.500",position:"absolute",boxShadow:n.shadows[2],transform:"translate(10px, -10px)",borderRadius:n.shape.borderRadius,backgroundColor:"".concat(n.palette.background.paper," !important"),transition:"transform 0.25s ease-in-out, box-shadow 0.25s ease-in-out","&:hover":{transform:"translate(7px, -5px)"}}}),nC=[{key:"upper",title:"Bỏ qua chữ hoa",icon:"tabler:letter-case-lower",subtitle:'"Đ\xe1p \xe1n" th\xe0nh "đ\xe1p \xe1n"'},{key:"sign",title:"Bỏ qua dấu c\xe2u",icon:"tabler:bolt",subtitle:'"Đ\xe1p \xe1n" th\xe0nh "dap an"'},{key:"space",title:"Bỏ qua dấu c\xe1ch",icon:"tabler:separator-vertical",subtitle:'"Đ\xe1p \xe1n" th\xe0nh "Đ\xe1p\xe1n"'}];var nw=()=>{let t=(0,p.v9)(t=>t.popup.data),n=(0,p.I0)(),[s,r]=(0,l.useState)(t),a=()=>{n((0,f.z)({status:""}))},v=t=>()=>{r({...s,...t})},b=()=>{let{questionId:t,title:i,...r}=s;n((0,g.Ds)({id:t,settings:r})),a()},j=()=>{let{questionId:t,title:i,...r}=s;n((0,g.Zw)({questionId:t,type:"settings",value:r,list:"exam"})),a()};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(M.Z,{sx:{pb:t=>"".concat(t.spacing(8)," !important"),px:t=>["".concat(t.spacing(5)," !important"),"".concat(t.spacing(15)," !important")],pt:t=>["".concat(t.spacing(8)," !important"),"".concat(t.spacing(12.5)," !important")]},children:[(0,i.jsx)(ny,{onClick:a,children:(0,i.jsx)(w.Z,{icon:"tabler:x",fontSize:"1.25rem"})}),(0,i.jsx)(c.Z,{sx:{mb:5,textAlign:"center"},children:(0,i.jsx)(h.Z,{variant:"h5",sx:{mb:3},children:s.title})}),(0,i.jsx)(e7.Z,{subheader:(0,i.jsx)(t5.Z,{children:"C\xe0i đặt"}),children:nC.map(t=>(0,i.jsxs)(tE.Z,{onClick:v({[t.key]:!s[t.key]}),divider:!0,children:[(0,i.jsx)(tI.Z,{children:(0,i.jsx)(w.Z,{icon:t.icon,fontSize:20})}),(0,i.jsxs)(el.Z,{children:[t.title,(0,i.jsx)(d.Z,{title:t.subtitle,children:(0,i.jsx)(x.Z,{size:"small",children:(0,i.jsx)(w.Z,{icon:"tabler:info-square-rounded",fontSize:20})})})]}),(0,i.jsx)(to.Z,{children:(0,i.jsx)(t4.Z,{edge:"end",checked:s[t.key]||!1})})]},t.key))})]}),(0,i.jsxs)(R.Z,{sx:{justifyContent:"center",px:t=>["".concat(t.spacing(5)," !important"),"".concat(t.spacing(15)," !important")],pb:t=>["".concat(t.spacing(8)," !important"),"".concat(t.spacing(12.5)," !important")]},children:[(0,i.jsx)(u.Z,{variant:"tonal",color:"secondary",onClick:a,children:"Hủy"}),(0,i.jsx)(u.Z,{variant:"contained",sx:{mr:1},onClick:b,children:"Lưu"}),(0,i.jsx)(u.Z,{variant:"contained",sx:{mr:1},onClick:j,color:"success",children:"\xc1p dụng cho c\xe1c c\xe2u c\xf2n lại"})]})]})},nT=()=>"hi",nI=s(9033);let nE=t=>{let{data:n,icon:s,name:r,selected:l,gridProps:a,iconProps:d,handleChange:u,color:x="primary"}=t,{title:p,value:f,content:g}=n;return n?(0,i.jsx)(N.ZP,{item:!0,...a,children:(0,i.jsxs)(c.Z,{onClick:()=>u(f),sx:{p:4,height:"100%",display:"flex",borderRadius:1,cursor:"pointer",position:"relative",alignItems:"center",flexDirection:"column",border:t=>"1px solid ".concat(t.palette.divider),...l===f?{borderColor:"".concat(x,".main"),"& svg":{color:t=>"".concat(t.palette.primary.main," !important")}}:{"&:hover":{borderColor:t=>"rgba(".concat(t.palette.customColors.main,", 0.25)")}}},children:[s?(0,i.jsx)(w.Z,{icon:s,...d}):null,p?"string"==typeof p?(0,i.jsx)(h.Z,{variant:"h6",sx:{...g?{mb:2}:{my:"auto"}},children:p}):p:null,g?"string"==typeof g?(0,i.jsx)(h.Z,{variant:"body2",sx:{my:"auto",textAlign:"center"},children:g}):g:null,(0,i.jsx)(nI.Z,{name:r,size:"small",color:x,value:f,onChange:u,checked:l===f,sx:{mb:-2,...!s&&!p&&!g&&{mt:-2}}})]})}):null};var nZ=s(3416);let nA=(0,nZ.kP)("ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz-",8),nP={fullname:"",classes:"",school:"",username:"",password:""},nS=t=>{let{students:n=[],onChange:s}=t,[r,a]=(0,l.useState)(!1),[h,d]=(0,l.useState)(nP),[p,f]=(0,l.useState)(n),g=()=>{let{fullname:t,username:n,password:s,id:i}=h;if(!t.trim())return P().fire({icon:"error",title:"Oops...",text:"Vui l\xf2ng nhập th\xf4ng tin Họ v\xe0 t\xean"});if(!n.trim())return P().fire({icon:"error",title:"Oops...",text:"Vui l\xf2ng nhập th\xf4ng tin T\xean đăng nhập"});if(!s.trim())return P().fire({icon:"error",title:"Oops...",text:"Vui l\xf2ng nhập th\xf4ng tin Mật khẩu"});if(p.find(t=>t.id!==i&&t.username.trim()===n.trim()&&t.password.trim()===s.trim()))return P().fire({icon:"error",title:"Oops...",text:"Th\xf4ng tin đăng nhập đ\xe3 tồn tại. Vui l\xf2ng kiểm tra lại!"});if(i){if(0===p.length)return;f(t=>t.map(t=>t.id===i?{...t,...h}:t))}else f(t=>[{...h,id:nA()},...t]);a(!1)},v=t=>()=>{0!==p.length&&f(n=>{let s=n.findIndex(n=>n.id===t.id);return[...p.slice(0,s),...p.slice(s+1)]})};return(0,l.useEffect)(()=>{s&&s(p)},[p]),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(tb.Z,{severity:"info",color:"info",sx:{mt:3},icon:!1,children:"Gi\xe1o vi\xean sẽ tạo t\xean đăng nhập v\xe0 mật khẩu để học sinh điền th\xf4ng tin v\xe0o mới l\xe0m b\xe0i thi. Học sinh kh\xf4ng cần phải c\xf3 t\xe0i khoản tr\xean hệ thống."}),(0,i.jsxs)(c.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mt:3},children:[(0,i.jsx)("div",{}),(0,i.jsx)(u.Z,{variant:"contained",startIcon:(0,i.jsx)(w.Z,{icon:"tabler:plus"}),onClick:()=>{a(!0),d(nP)},children:"Th\xeam học sinh"})]}),(0,i.jsx)(es._,{rows:p.map((t,n)=>({...t,num:n+1})),columns:[{field:"num",headerName:"STT",maxWidth:50},{field:"fullname",headerName:"Họ v\xe0 t\xean",flex:.8,minWidth:200},{field:"classes",headerName:"Lớp",minWidth:80},{field:"school",headerName:"Trường",minWidth:130},{field:"username",headerName:"T\xean đăng nhập",minWidth:150},{field:"password",headerName:"Mật khẩu",minWidth:120},{field:"id",headerName:"H\xe0nh động",renderCell:t=>(0,i.jsxs)("div",{children:[(0,i.jsx)(x.Z,{size:"small",onClick:()=>{a(!0),d(t.row)},children:(0,i.jsx)(w.Z,{icon:"tabler:pencil-minus"})}),(0,i.jsx)(x.Z,{size:"small",color:"error",onClick:v(t.row),children:(0,i.jsx)(w.Z,{icon:"tabler:trash"})})]})}],autoHeight:!0,initialState:{pagination:{paginationModel:{pageSize:5}}},pageSizeOptions:[5,10,30,50]}),(0,i.jsx)(eK.ZP,{open:r,sx:{zIndex:1301},anchor:"right",children:(0,i.jsxs)(c.Z,{sx:{p:2,minWidth:350},children:[(0,i.jsx)(tb.Z,{severity:"success",children:"Th\xf4ng tin học sinh"}),(0,i.jsx)(ee,{fullWidth:!0,sx:{mt:3},label:"Họ v\xe0 t\xean",helperText:"Th\xf4ng tin bắt buộc",required:!0,value:h.fullname||"",onChange:t=>d({...h,fullname:t.trim()})}),(0,i.jsx)(ee,{fullWidth:!0,sx:{mt:3},label:"Lớp",value:h.classes||"",onChange:t=>d({...h,classes:t.trim()})}),(0,i.jsx)(ee,{fullWidth:!0,sx:{mt:3},label:"Trường",value:h.school||"",onChange:t=>d({...h,school:t.trim()})}),(0,i.jsx)(ee,{fullWidth:!0,sx:{mt:3},label:"T\xean đăng nhập",helperText:"Th\xf4ng tin bắt buộc",required:!0,value:h.username||"",onChange:t=>d({...h,username:t.trim()})}),(0,i.jsx)(ee,{fullWidth:!0,sx:{mt:3},label:"Mật khẩu",helperText:"Th\xf4ng tin bắt buộc",required:!0,value:h.password||"",onChange:t=>d({...h,password:t.trim()})}),(0,i.jsxs)(c.Z,{sx:{mt:3,textAlign:"center"},children:[(0,i.jsx)(u.Z,{sx:{mr:2},variant:"tonal",color:"error",onClick:()=>a(!1),children:"Hủy"}),(0,i.jsx)(u.Z,{variant:"contained",onClick:g,children:"Lưu"})]})]})})]})},nN=()=>(0,i.jsx)(tb.Z,{sx:{mt:3},icon:!1,children:"Ai cũng c\xf3 thể xem v\xe0 l\xe0m đề thi n\xe0y. Phần thu thập th\xf4ng tin y\xeau cầu tối thiểu phải c\xf3 1 trường th\xf4ng tin."}),nk=async t=>{try{return(await I.default.get(t)).data}catch(t){throw t}},n_=t=>{let{students:n=[],onChange:s}=t,{data:r,error:a,isLoading:h}=(0,Q.Z)("/classes/class",nk),[d,u]=(0,l.useState)(n);return((0,l.useEffect)(()=>{s&&s(d)},[d]),a)?(0,i.jsx)(tb.Z,{sx:{mt:3},severity:"error",icon:!1,children:a.response.data.error}):h?(0,i.jsx)(c.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"center",marginY:10},children:(0,i.jsx)(ef.Z,{})}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(tb.Z,{sx:{mt:3},severity:"warning",icon:!1,children:"Chỉ những t\xe0i khoản của học sinh trong lớp học mới được quyền l\xe0m đề thi n\xe0y"}),(0,i.jsx)(es._,{rows:r.map((t,n)=>({...t,num:n+1})),columns:[{field:"num",headerName:"STT",maxWidth:80},{field:"title",headerName:"Lớp học",width:250},{field:"total",headerName:"Số học sinh",width:150}],autoHeight:!0,checkboxSelection:!0,initialState:{pagination:{paginationModel:{pageSize:10}}},pageSizeOptions:[10,30,50],onRowSelectionModelChange:t=>{u(t)},rowSelectionModel:d})]})};(0,nZ.kP)("ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz-",8);let nL=t=>{let{students:n=[],onChange:s}=t,[r,a]=(0,l.useState)([{id:"fasf",title:"12A1",total:12,select:4},{id:"\xe2cv",title:"12A2",total:12,select:4},{id:"ewg",title:"12A4",total:12,select:4},{id:"SEWEG",title:"12A3",total:12,select:4},{id:"REBB",title:"12A1",total:12,select:4},{id:"dbb",title:"12A5",total:12,select:4}]),[p,f]=(0,l.useState)(!1),[g,v]=(0,l.useState)(""),[b,j]=(0,l.useState)(n);return(0,l.useEffect)(()=>{s&&s(b)},[b]),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(tb.Z,{sx:{mt:3},severity:"error",icon:!1,children:"Chỉ những t\xe0i khoản của học sinh được chọn mới được quyền l\xe0m đề thi n\xe0y"}),(0,i.jsx)(es._,{rows:r.filter(t=>t.title.toLowerCase().includes(g.toLowerCase())).map((t,n)=>({...t,num:n+1})),columns:[{field:"num",headerName:"STT",maxWidth:80},{field:"title",headerName:"Lớp học",width:250},{field:"total",headerName:"Số học sinh",width:150},{field:"select",headerName:"Đ\xe3 chọn",width:100},{field:"id",headerName:"",renderCell:t=>(0,i.jsx)(d.Z,{title:"Chọn học sinh",arrow:!0,children:(0,i.jsx)(x.Z,{size:"small",onClick:()=>{f(!0)},children:(0,i.jsx)(w.Z,{icon:"tabler:user-plus"})})})}],autoHeight:!0,initialState:{pagination:{paginationModel:{pageSize:10}}},pageSizeOptions:[10,30,50]}),(0,i.jsx)(eK.ZP,{open:p,sx:{zIndex:1301},anchor:"right",children:(0,i.jsxs)(c.Z,{children:[(0,i.jsx)(h.Z,{variant:"h4",sx:{m:2},children:"Lớp 125"}),(0,i.jsx)(es._,{rows:r.filter(t=>t.title.toLowerCase().includes(g.toLowerCase())).map((t,n)=>({...t,num:n+1})),columns:[{field:"num",headerName:"STT",maxWidth:80},{field:"title",headerName:"Họ v\xe0 t\xean",width:300}],autoHeight:!0,initialState:{pagination:{paginationModel:{pageSize:10}}},pageSizeOptions:[10,30,50],checkboxSelection:!0,onRowSelectionModelChange:t=>{j(t)},rowSelectionModel:b}),(0,i.jsxs)(c.Z,{sx:{mt:3,textAlign:"center"},children:[(0,i.jsx)(u.Z,{sx:{mr:2},variant:"tonal",color:"error",onClick:()=>f(!1),children:"Hủy"}),(0,i.jsx)(u.Z,{variant:"contained",children:"Lưu"})]})]})})]})},nM=[{value:"all",title:"Tất cả mọi người",isSelected:!0,icon:"tabler:world"},{value:"list",title:"Giao theo danh s\xe1ch",icon:"tabler:list-check"}],nR=t=>{let{accept:n,onChange:s,students:r=[]}=t,l=t=>{s(t)};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(N.ZP,{container:!0,spacing:4,children:nM.map((t,s)=>(0,i.jsx)(nE,{data:t,selected:n||"all",icon:t.icon,handleChange:t=>l({accept:"string"==typeof t?t:t.target.value,students:[]}),gridProps:{sm:6,xs:12},iconProps:{fontSize:"1.75rem",style:{marginBottom:8}}},s))}),"all"==n?(0,i.jsx)(nN,{onChange:t=>l({students:t}),students:r}):null,"classes"==n?(0,i.jsx)(n_,{onChange:t=>l({students:t}),students:r}):null,"student"==n?(0,i.jsx)(nL,{onChange:t=>l({students:t}),students:r}):null,"list"==n?(0,i.jsx)(nS,{onChange:t=>l({students:t}),students:r}):null]})};var nO=()=>{let t=(0,p.v9)(t=>t.quiz.settings),n=(0,p.I0)(),[s,r]=(0,l.useState)(t),[a,d]=(0,l.useState)(!1),v=()=>{n((0,f.z)({status:""}))},b=()=>{let{accept:t="all",collects:i=[],students:r=[]}=s;switch(t){case"all":if(!i.length)return P().fire({icon:"error",title:"Oops...",text:"Phần TH\xd4NG TIN CẦN THU THẬP phải c\xf3 tối thiểu 01 trường th\xf4ng tin"});break;case"classes":if(!r.length)return P().fire({icon:"error",title:"Oops...",text:"Vui l\xf2ng chọn tối thiểu 1 lớp học để giao b\xe0i"});break;case"student":if(!r.length)return P().fire({icon:"error",title:"Oops...",text:"Vui l\xf2ng chọn tối thiểu 1 học sinh để giao b\xe0i"});break;case"list":if(!r.length)return P().fire({icon:"error",title:"Oops...",text:"Vui l\xf2ng th\xeam tối thiểu 1 học sinh để giao b\xe0i"})}if(i.filter(t=>!t.label.trim()).length)return P().fire({icon:"error",title:"Oops...",text:"Phần TH\xd4NG TIN THU THẬP chưa nhập đầy đủ c\xe1c trường th\xf4ng tin"});n((0,g.kQ)(s)),v()},j=t=>{r(n=>({...n,...t}))},y=()=>{if(a)return;let t=document.createElement("input");t.setAttribute("type","file"),t.setAttribute("accept","image/*"),t.click(),t.onchange=async()=>{let[n]=t.files;if(n){d(!0);let t=s.cover||"https://i.imgur.com/dKZNJGk.png",i=URL.createObjectURL(n);j({cover:i});let{error:r,url:l}=await E(n);d(!1),r&&(j({cover:t}),P().fire({icon:"error",title:"C\xf3 lỗi khi thay đổi ảnh b\xeca"})),l&&j({cover:l})}}};return(0,i.jsxs)(M.Z,{sx:{paddingX:"0!important"},children:[(0,i.jsx)(e8.Z,{sx:{marginY:3},children:(0,i.jsx)(ts.Z,{label:"TH\xd4NG TIN CƠ BẢN",skin:"light",color:"primary"})}),(0,i.jsxs)(N.ZP,{container:!0,spacing:3,children:[(0,i.jsxs)(N.ZP,{item:!0,xs:12,md:8,children:[(0,i.jsx)(c.Z,{children:(0,i.jsx)(ee,{label:"T\xean đề thi",fullWidth:!0,value:s.title||"",onChange:t=>j({title:t})})}),(0,i.jsxs)(c.Z,{sx:{mt:2},children:[(0,i.jsx)(h.Z,{variant:"h6",sx:{marginY:2},children:"Giới thiệu về đề thi"}),(0,i.jsx)(tX,{content:s.subtitle,sx:{minHeight:"5rem"},theme:"snow",inline:!0,onChange:t=>j({subtitle:t})})]})]}),(0,i.jsx)(N.ZP,{item:!0,xs:12,md:4,children:(0,i.jsxs)(c.Z,{onClick:y,sx:{display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",cursor:"pointer"},children:[a?(0,i.jsxs)(c.Z,{style:{position:"relative"},children:[(0,i.jsx)("img",{src:s.cover||"https://i.imgur.com/dKZNJGk.png",style:{maxWidth:"100%",filter:"blur(5px)"}}),(0,i.jsx)(ef.Z,{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}})]}):(0,i.jsx)("img",{src:s.cover||"https://i.imgur.com/dKZNJGk.png",style:{maxWidth:"100%"}}),(0,i.jsx)("span",{children:"Click để thay đổi ảnh b\xeca "})]})})]}),(0,i.jsx)(e8.Z,{sx:{marginY:3},children:(0,i.jsx)(ts.Z,{label:"CHUNG",skin:"light",color:"primary"})}),(0,i.jsxs)(N.ZP,{container:!0,spacing:3,children:[(0,i.jsx)(N.ZP,{item:!0,xs:12,md:6,children:(0,i.jsx)(ee,{label:"Thời gian l\xe0m b\xe0i",fullWidth:!0,type:"number",placeholder:"90",InputProps:{endAdornment:(0,i.jsx)(H.Z,{position:"end",children:"ph\xfat"}),inputProps:{min:0,step:1}},value:s.timeout||"90",onChange:t=>j({timeout:t})})}),(0,i.jsx)(N.ZP,{item:!0,xs:12,md:6,children:(0,i.jsx)(ee,{label:"Số lần l\xe0m",type:"number",placeholder:"0",fullWidth:!0,helperText:"Số lần mỗi học sinh c\xf3 thể l\xe0m b\xe0i. 0 để kh\xf4ng giới hạn.",InputProps:{inputProps:{min:0,step:1}},value:s.retake||"0",onChange:t=>j({retake:t})})}),(0,i.jsx)(N.ZP,{item:!0,xs:12,md:6,children:(0,i.jsx)(ee,{label:"Thời gian bắt đầu",fullWidth:!0,InputLabelProps:{shrink:!0},type:"datetime-local",helperText:"Học sinh chỉ c\xf3 thể l\xe0m b\xe0i kể từ thời điểm bắt đầu",value:s.startTime||"",onChange:t=>j({startTime:t})})}),(0,i.jsx)(N.ZP,{item:!0,xs:12,md:6,children:(0,i.jsx)(ee,{label:"Thời gian hết hạn",fullWidth:!0,InputLabelProps:{shrink:!0},type:"datetime-local",helperText:"Qu\xe1 thời gian n\xe0y học sinh sẽ kh\xf4ng thể bắt đ\xe2u l\xe0m b\xe0i",value:s.endTime||"",onChange:t=>j({endTime:t})})})]}),(0,i.jsx)(e8.Z,{sx:{marginY:3},children:(0,i.jsx)(ts.Z,{label:"BẢO MẬT",skin:"light",color:"warning"})}),(0,i.jsxs)(N.ZP,{container:!0,spacing:3,children:[(0,i.jsx)(N.ZP,{item:!0,xs:12,md:6,children:(0,i.jsx)(ee,{label:"Mật khẩu đề thi",fullWidth:!0,helperText:"Y\xeau cầu học sinh nhập đ\xfang mật khẩu mới c\xf3 thể bắt đầu l\xe0m b\xe0i",value:s.password||"",onChange:t=>j({password:t})})}),(0,i.jsx)(N.ZP,{item:!0,xs:12,md:6,children:(0,i.jsxs)(ee,{select:!0,label:"Tự động nộp b\xe0i khi chuyển tabs",fullWidth:!0,helperText:"Hệ thống sẽ tự động nộp b\xe0i l\xe0m khi học sinh chuyển tab kh\xe1c",value:s.tabs||"10",onChange:t=>j({tabs:t}),children:[(0,i.jsx)(eo.Z,{value:"0",children:"Kh\xf4ng"}),(0,i.jsx)(eo.Z,{value:"3",children:"Sau 3 gi\xe2y"}),(0,i.jsx)(eo.Z,{value:"5",children:"Sau 5 gi\xe2y"}),(0,i.jsx)(eo.Z,{value:"7",children:"Sau 7 gi\xe2y"}),(0,i.jsx)(eo.Z,{value:"10",children:"Sau 10 gi\xe2y"}),(0,i.jsx)(eo.Z,{value:"15",children:"Sau 15 gi\xe2y"}),(0,i.jsx)(eo.Z,{value:"30",children:"Sau 30 gi\xe2y"}),(0,i.jsx)(eo.Z,{value:"60",children:"Sau 60 gi\xe2y"})]})})]}),(0,i.jsx)(e8.Z,{sx:{marginY:3},children:(0,i.jsx)(ts.Z,{label:"C\xc2U HỎI V\xc0 TRẢ LỜI",skin:"light",color:"info"})}),(0,i.jsxs)(N.ZP,{container:!0,spacing:3,children:[(0,i.jsx)(N.ZP,{item:!0,xs:12,md:6,children:(0,i.jsxs)(ee,{select:!0,label:"Chế độ hiển thị c\xe2u hỏi",fullWidth:!0,value:s.showQuestions||"A",onChange:t=>j({showQuestions:t}),children:[(0,i.jsx)(eo.Z,{value:"A",children:"Hiện to\xe0n bộ c\xe2u hỏi"}),(0,i.jsx)(eo.Z,{value:"Q",children:"Hiện theo từng c\xe2u hỏi"})]})}),(0,i.jsx)(N.ZP,{item:!0,xs:12,md:6,children:(0,i.jsxs)(ee,{select:!0,label:"Bắt buộc l\xe0m tất cả c\xe1c c\xe2u hỏi",fullWidth:!0,value:s.require||"T",onChange:t=>j({require:t}),children:[(0,i.jsx)(eo.Z,{value:"T",children:"Phải l\xe0m hết mới cho nộp b\xe0i"}),(0,i.jsx)(eo.Z,{value:"F",children:"Kh\xf4ng cần phải l\xe0m hết"})]})}),(0,i.jsx)(N.ZP,{item:!0,xs:12,md:6,children:(0,i.jsxs)(ee,{select:!0,label:"Chế độ đảo c\xe2u hỏi",fullWidth:!0,helperText:"C\xe1c nh\xf3m c\xe2u hỏi đ\xe3 cố định th\xec hệ thống sẽ kh\xf4ng đảo c\xe2u hỏi nh\xf3m đ\xf3",value:s.randomQuestion||"N",onChange:t=>j({randomQuestion:t}),children:[(0,i.jsx)(eo.Z,{value:"N",children:"Kh\xf4ng đảo c\xe2u hỏi"}),(0,i.jsx)(eo.Z,{value:"E",children:"Đảo to\xe0n bộ đề thi"})]})}),(0,i.jsx)(N.ZP,{item:!0,xs:12,md:6,children:(0,i.jsxs)(ee,{select:!0,label:"Chế độ đảo đ\xe1p \xe1n",fullWidth:!0,helperText:"C\xe1c c\xe2u hỏi đ\xe3 cố định đ\xe1p \xe1n th\xec hệ thống sẽ kh\xf4ng đảo đ\xe1p \xe1n c\xe2u hỏi đ\xf3",value:s.randomAnswer||"F",onChange:t=>j({randomAnswer:t}),children:[(0,i.jsx)(eo.Z,{value:"F",children:"Kh\xf4ng đảo đ\xe1p \xe1n"}),(0,i.jsx)(eo.Z,{value:"T",children:"C\xf3 đảo đ\xe1p \xe1n"})]})}),(0,i.jsx)(N.ZP,{item:!0,xs:12,md:6,children:(0,i.jsxs)(ee,{select:!0,label:"Chế độ hiển thị b\xe0i l\xe0m",fullWidth:!0,value:s.showResult||"F",onChange:t=>j({showResult:t}),children:[(0,i.jsx)(eo.Z,{value:"N",children:"Kh\xf4ng hiển thị"}),(0,i.jsx)(eo.Z,{value:"F",children:"Ngay sau khi nộp b\xe0i"})]})}),(0,i.jsx)(N.ZP,{item:!0,xs:12,md:6,children:(0,i.jsxs)(ee,{select:!0,label:"Chế độ hiển thị điểm",fullWidth:!0,value:s.showPoint||"F",onChange:t=>j({showPoint:t}),children:[(0,i.jsx)(eo.Z,{value:"N",children:"Kh\xf4ng hiển thị"}),(0,i.jsx)(eo.Z,{value:"F",children:"Ngay sau khi nộp b\xe0i"})]})}),(0,i.jsx)(N.ZP,{item:!0,xs:12,md:6,children:(0,i.jsxs)(ee,{select:!0,label:"Chế độ hiển thị đ\xe1p \xe1n đ\xfang",fullWidth:!0,value:s.showKey||"F",onChange:t=>j({showKey:t}),children:[(0,i.jsx)(eo.Z,{value:"A",children:"Lu\xf4n hiển thị"}),(0,i.jsx)(eo.Z,{value:"T",children:"Chỉ c\xe2u đ\xfang"}),(0,i.jsx)(eo.Z,{value:"F",children:"Chỉ c\xe2u sai"}),(0,i.jsx)(eo.Z,{value:"H",children:"Lu\xf4n ẩn"})]})}),(0,i.jsx)(N.ZP,{item:!0,xs:12,md:6,children:(0,i.jsxs)(ee,{select:!0,label:"Chế độ hiển thị hướng dẫn giải",fullWidth:!0,value:s.showExplain||"A",onChange:t=>j({showExplain:t}),children:[(0,i.jsx)(eo.Z,{value:"A",children:"Lu\xf4n hiển thị"}),(0,i.jsx)(eo.Z,{value:"T",children:"Chỉ c\xe2u đ\xfang"}),(0,i.jsx)(eo.Z,{value:"F",children:"Chỉ c\xe2u sai"}),(0,i.jsx)(eo.Z,{value:"H",children:"Lu\xf4n ẩn"})]})})]}),(0,i.jsx)(e8.Z,{sx:{marginY:3},children:(0,i.jsx)(ts.Z,{label:"AI C\xd3 THỂ L\xc0M?",skin:"light",color:"success"})}),(0,i.jsx)(nR,{accept:s.accept,onChange:j,students:s.students}),(0,i.jsx)(e8.Z,{sx:{marginY:3},children:(0,i.jsx)(ts.Z,{label:"TH\xd4NG TIN CẦN THU THẬP",skin:"light",color:"success"})}),(0,i.jsxs)(c.Z,{children:[(0,i.jsx)(e7.Z,{children:(s.collects||[]).map((t,n)=>(0,i.jsxs)(te.ZP,{disablePadding:!0,sx:{paddingY:1},children:[(0,i.jsx)(ee,{fullWidth:!0,size:"small",sx:{mr:2},InputProps:{startAdornment:(0,i.jsxs)(H.Z,{position:"start",children:["Th\xf4ng tin ",n+1]})},value:t.label,placeholder:"Nhập th\xf4ng tin cần thu thập",onChange:t=>j({collects:s.collects.map((s,i)=>i==n?{...s,label:t}:s)})}),(0,i.jsx)(to.Z,{children:(0,i.jsx)(x.Z,{color:"error",onClick:()=>j({collects:s.collects.filter((t,s)=>s!=n)}),children:(0,i.jsx)(w.Z,{icon:"tabler:trash"})})})]},n))}),(0,i.jsx)(u.Z,{variant:"contained",startIcon:(0,i.jsx)(w.Z,{icon:"tabler:plus"}),onClick:()=>j({collects:s.collects?[...s.collects,{label:""}]:[{label:""}]}),children:"Th\xeam th\xf4ng tin"})]}),(0,i.jsxs)(c.Z,{sx:{mt:5,textAlign:"center"},children:[(0,i.jsx)(u.Z,{sx:{mr:2},variant:"tonal",color:"error",onClick:v,children:"Hủy"}),(0,i.jsx)(u.Z,{variant:"contained",onClick:b,children:"Lưu"})]})]})};let nH=(0,_.ZP)(x.Z)(t=>{let{theme:n}=t;return{top:0,right:0,color:"grey.500",position:"absolute",boxShadow:n.shadows[2],transform:"translate(10px, -10px)",borderRadius:n.shape.borderRadius,backgroundColor:"".concat(n.palette.background.paper," !important"),transition:"transform 0.25s ease-in-out, box-shadow 0.25s ease-in-out","&:hover":{transform:"translate(7px, -5px)"}}});var nD=()=>{let t=(0,p.v9)(t=>t.popup.data),n=(0,p.I0)(),[s,r]=(0,l.useState)(t),a=()=>{n((0,f.z)({status:""}))};return(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)(M.Z,{sx:{background:"#f8f7fa",pb:t=>"".concat(t.spacing(8)," !important"),px:t=>["".concat(t.spacing(5)," !important"),"".concat(t.spacing(15)," !important")],pt:t=>["".concat(t.spacing(8)," !important"),"".concat(t.spacing(12.5)," !important")]},children:[(0,i.jsx)(nH,{onClick:a,children:(0,i.jsx)(w.Z,{icon:"tabler:x",fontSize:"1.25rem"})}),(0,i.jsx)(nO,{})]})})};let nz=(0,l.forwardRef)(function(t,n){return(0,i.jsx)(L.Z,{ref:n,...t})}),nB=eO()(()=>Promise.all([s.e(117),s.e(141)]).then(s.bind(s,5141)),{loadableGenerated:{webpack:()=>[5141]},ssr:!1}),nq=t=>{let{type:n}=t;switch(n){case"quiz":return(0,i.jsx)(nT,{});case"group":return(0,i.jsx)(nj,{});case"options":return(0,i.jsx)(nw,{});case"math":return(0,i.jsx)(nB,{});case"settings":return(0,i.jsx)(nD,{})}return null},nF=()=>{let{status:t,data:n}=(0,p.v9)(t=>t.popup);return(0,i.jsx)(k.Z,{fullWidth:!0,open:!!t,maxWidth:"md",scroll:"body",TransitionComponent:nz,sx:{"& .MuiDialog-paper":{overflow:"visible"}},children:(0,i.jsx)(nq,{type:t})})},nG=()=>(0,i.jsxs)(N.ZP,{container:!0,spacing:3,children:[(0,i.jsx)(N.ZP,{item:!0,xs:12,md:4,children:(0,i.jsx)(nm,{})}),(0,i.jsx)(N.ZP,{item:!0,xs:12,md:8,children:(0,i.jsx)(nd,{})}),(0,i.jsx)(nF,{})]});nG.layout="hi";let nW=()=>{let t=(0,r.useRouter)(),[n,s]=(0,l.useState)("");return((0,l.useEffect)(()=>{s(t.query.slug)},[t.query]),"classes.html"==n)?(0,i.jsx)(eb,{}):"exams.html"==n?(0,i.jsx)(eL,{}):"leaderboard.html"==n?(0,i.jsx)(tm,{}):"realtime.html"==n?(0,i.jsx)(tN,{}):"statistic.html"==n?(0,i.jsx)(tk,{}):"view-classes.html"==n?(0,i.jsx)(tz,{}):"create.html"==n?(0,i.jsx)(nG,{}):(0,i.jsx)(i.Fragment,{})};nW.getLayout=t=>(0,i.jsx)(a.Z,{customAppBar:(0,i.jsx)(V,{}),children:t});var nY=nW},1117:function(t,n,s){"use strict";Object.defineProperty(n,"__esModule",{value:!0});let i=s(8754),r=i._(s(7274));class l{static load(t){Object.assign(this,t)}}l.RENDER_SCALE=2,l.LINE_SMALL_HEIGHT=7*l.RENDER_SCALE,l.SPLIT_MARGIN=3*l.RENDER_SCALE,l.INTERSEC_MARGIN=20*l.RENDER_SCALE,l.LINE_MARGIN=2*l.RENDER_SCALE,l.MARGIN_LEFT=2*l.RENDER_SCALE,l.ENABLE_IMAGE_PROCESS=!0,l.STEP_SIZE=2,l.CROP_FULL_WIDTH=!0,l.OVERLAP=.5,l.QUESTION_PATTERN=[],l.QUESTION_PATTERN2=[],l.BREAK_LINE_PATTERN=[],l.SECTION_PATTERN_LOWER=[],l.SECTION_PATTERN_NORMAL=[],l.KICK_PATTERN=[],l.TVCN_CHAR=[],l.HET_PATTERN=[],l.DAPAN_PATTERN=[],l.HUONGDAN_PATTERN=[],l.MULTIPLE_ANS_PATTERN=[],l.DRAW_RESULT="",l.SKIP_CHAR=[],l.FOOTER_PATTERN=[],l.HELP_ANS_PATTERN=[],l.RES_ANS_PATTERN=[];class a{}a.RENDER_SCALE=2,a.LINE_SMALL_HEIGHT=7*a.RENDER_SCALE,a.SPLIT_MARGIN=3*a.RENDER_SCALE,a.INTERSEC_MARGIN=20*a.RENDER_SCALE,a.LINE_MAGIN=2*a.RENDER_SCALE,a.MARGIN_LEFT=2*a.RENDER_SCALE,a.ENABLE_IMAGE_PROCESS=!0,a.STEP_SIZE=2,a.CROP_FULL_WIDTH=!0,a.OVERLAP=.5,a.QUESTION_PATTERN=[],a.QUESTION_PATTERN2=[],a.BREAK_LINE_PATTERN=[],a.SECTION_PATTERN_LOWER=[],a.SECTION_PATTERN_NORMAL=[],a.KICK_PATTERN=[],a.TVCN_CHAR=[],a.HET_PATTERN=[],a.DAPAN_PATTERN=[],a.HUONGDAN_PATTERN=[],a.MULTIPLE_ANS_PATTERN=[],a.DRAW_RESULT="",a.SKIP_CHAR=[],a.FOOTER_PATTERN=[],a.HELP_ANS_PATTERN=[],a.ANS_PATTERN=[];class c{addTask(t,n,s,i){var r=s||[];if(!this.is_runner){let s=()=>new Promise(s=>{this.wrap_counter++,this.actionLogItem&&this.all_tasks>0&&this.actionLogItem.function.call({},this.wrap_counter_done,this.all_tasks,...this.actionLogItem.params?this.actionLogItem.params:[],i),n.call(t,...r).then(t=>{this.wrap_counter_done++,s({status:!0,value:t})}).catch(t=>{this.wrap_counter_done++,s({status:!1,error:t})})});this.all_tasks++;let l=[];if(this.tasks.length>0?l=this.tasks[this.tasks.length-1]:this.tasks.push(l),l.length<this.limit_one_process)l.push({task:s,name:i});else{let t=[];t.push({task:s,name:i}),this.tasks.push(t)}}}start(){return new Promise(t=>{0===this.tasks.length&&(this.clear(),t({datas:[],errs:[]})),this.result_common={datas:[],errs:[]},this.task_runner_index=-1,this.count_task_root_done=0,this.count_task_item_done=0,this.is_runner=!0,this.runnerItem(t)})}restart(){this.result_common={datas:[],errs:[]},this.clear()}clear(){this.count_task_root_done=0,this.count_task_item_done=0,this.tasks=[],this.all_tasks=0,this.task_runner_index=-1,this.wrap_counter=0,this.wrap_counter_done=0,this.is_runner=!1}runnerItem(t){this.task_runner_index++,this.task_runner=this.tasks[this.task_runner_index],this.task_runner&&this.task_runner.length>0?Promise.all(this.task_runner.map(t=>t.task.call(this))).then(n=>{this.count_task_root_done++,n.forEach(t=>{this.count_task_item_done++,t.status&&t.value?this.result_common.datas.push(t.value):t.error&&this.result_common.errs.push(t.error)}),this.result_common.errs.length>0&&this.endWithError&&(this.is_runner=!1,this.clear(),t(this.result_common)),this.count_task_item_done===this.all_tasks?(this.is_runner=!1,this.clear(),t(this.result_common)):setTimeout(()=>{this.runnerItem(t)},this.delay_time)}):(this.is_runner=!1,this.count_task_root_done++,this.clear(),t(this.result_common))}constructor(t,n,s,i){this.tasks=[],this.count_task_root_done=0,this.task_runner=[],this.task_runner_index=-1,this.all_tasks=0,this.count_task_item_done=0,this.is_runner=!1,this.wrap_counter=0,this.wrap_counter_done=0,this.limit_one_process=t,this.result_common={datas:[],errs:[]},this.actionLogItem=n,this.delay_time=s||1e3,this.endWithError=null!=i&&i}}t.exports={Constants:l,Utils:class{static capitalizeFirstLetter(t){return t.charAt(0).toUpperCase()+t.slice(1)}static tagLang(t){let n=new Map([["EASY","NB"],["MEDIUM","TH"],["HARD","VD"],["HARDEST","VDC"],["MC","TN"],["FB","ĐT"],["ES","TL"]]);return n.has(t)?n.get(t):t}static parseInclude(t){let n=t.split("=>"),s=n.length>1?n[1]:-1,i=n[0].replace(/\[@([CTQGK][\-\d]+):(:(user[_0-9]*)\-)?[^\]]*\]/g,"$1:$3").replace(/\[@(F:[^\]]*)\]/g,"$1").replace(/\[[^\]\d]+(\d+)[^\]\d]+\]/g,"$1").replace(/\[[^\]]+\]/g,""),r=[],l=[],a=[],c=[],h=[],d=[],u=[],x=s;for(let t of i.split(".")){if(/^\d*$/.test(t)){x=+t;continue}for(let n of t.split(",")){let t=n.split(":"),s=t[0].trim(),i=t[1]||"";if(/^G[\-\d]+$/.test(s))d.push(+s.substring(1));else if(/^Q[\-\d]+$/.test(s))l.push(+s.substring(1)),u.push({type:"QUEST",id:+s.substring(1)});else if(/^C[\-\d]+$/.test(s)){let t=+s.substring(1);a.push(t),u.push({type:""!==i?"SHARE":"CATEGORY",id:t})}else if(/^K[\-\d]+$/.test(s)){let t=+s.substring(1);c.push(t),u.push({type:""!==i?"SHARE":"KNOWLEDGE",id:t})}else if(/^T[\-\d]+$/.test(s))r.push(+s.substring(1)),u.push({type:"EXAM",id:+s.substring(1),groupIds:d});else if(/^F:/.test(n.trim())){let t=n.trim().substring(2);h.push(langMap.has(t)?langMap.get(t):t)}}if(u.length>0){if(h.length>0){let t=h.filter(t=>["TL","ES","MC","FB"].indexOf(t)>=0).map(t=>"TL"===t||"ES"===t?3:"MC"===t||"FB"===t?1:4);for(let n of u)n.tags=h.filter(t=>0>["TL","TN","ĐT","ES","MC","FB"].indexOf(t)),n.answerTypes=t}break}}return l.length>0&&(x=l.length),{paths:u,shareTypes:a.concat(c).concat(l),catId:a,examId:r,tag:h,groupId:d,questId:l,getNum:x,idx:s}}static getNumberFromStr(t){let n=t.match(/(\d+)/);return n?n[0]:""}static removeAccents(t){for(let n of["a\xe0ả\xe3\xe1ạăằẳẵắặ\xe2ầẩẫấậ","A\xc0Ả\xc3\xc1ẠĂẰẲẴẮẶ\xc2ẦẨẪẤẬ","dđ","DĐ","e\xe8ẻẽ\xe9ẹ\xeaềểễếệ","E\xc8ẺẼ\xc9Ẹ\xcaỀỂỄẾỆ","i\xecỉĩ\xedị","I\xccỈĨ\xcdỊ","o\xf2ỏ\xf5\xf3ọ\xf4ồổỗốộơờởỡớợ","O\xd2Ỏ\xd5\xd3Ọ\xd4ỒỔỖỐỘƠỜỞỠỚỢ","u\xf9ủũ\xfaụưừửữứự","U\xd9ỦŨ\xdaỤƯỪỬỮỨỰ","yỳỷỹ\xfdỵ","YỲỶỸ\xddỴ"]){let s=RegExp("["+n.substring(1)+"]","g");t=t.replace(s,n[0])}return t}static zeroPad(t,n){return(Array(t=t||2).join("0")+n).slice(-1*t)}},PdfConst:new a,Task:c,Image:class{cssStringToJSON(t){for(var n={},s=t.split(";"),i=0;i<s.length;i++){var r=s[i].split(":");if(2===r.length){var l=r[0].trim(),a=r[1].trim();n[l]=a}}return n}getStyle(t){let n=t.match(/style="([^"]*)"/);return n?n[1]:""}cropImage(){}start(t){this.callback=t,this.questions.forEach(t=>{var n,s,i;(null===(n=t.content)||void 0===n?void 0:n.includes("<img "))&&this.replaceImage(t,"content"),(null===(s=t.explain)||void 0===s?void 0:s.includes("<img "))&&this.replaceImage(t,"explain"),(null===(i=t.options)||void 0===i?void 0:i.find(t=>t.text.includes("<img ")))&&this.replaceImage(t,"options")}),this.imageMaps.forEach(t=>{this.taskConvertBase64ToCanvas.addTask(this,this.startConvertCanvas,[t])}),this.taskConvertBase64ToCanvas.start().then(t=>{if(t.errs.length>0)this.callback({error:t.errs});else{let n=0,s=[],i=()=>{let t=document.createElement("canvas");t.width=this.sizeDefaultCanvas,t.height=this.sizeDefaultCanvas;let n=t.getContext("2d");n&&(n.fillStyle="white",n.fillRect(0,0,this.sizeDefaultCanvas,this.sizeDefaultCanvas)),s.push({cdn:"",cX:0,cY:0,canvas:t,imgs:[]})};i(),t.datas.forEach((t,r)=>{var l=s[s.length-1];l.cX+t.canvas.width+4>this.sizeDefaultCanvas?(l.cX=4,l.cY+=n+4,n=0):l.cX+=4,l.cY+t.canvas.height>this.sizeDefaultCanvas&&(i(),l=s[s.length-1]);var a=l.canvas.getContext("2d");l.imgs.push({x:l.cX,y:l.cY,width:t.canvas.width,height:t.canvas.height,index:r,style:this.getStyle(t.base),url:t.canvas.toDataURL("image/png",1)}),null==a||a.drawImage(t.canvas,0,0,t.canvas.width,t.canvas.height,l.cX,l.cY,t.canvas.width,t.canvas.height),l.cX+=t.canvas.width,n=n<t.canvas.height?t.canvas.height:n}),s[0].imgs.length>0?(s.forEach(t=>{this.taskUploadImage.addTask(this,this.startUploadFile,[t])}),this.taskUploadImage.start().then(n=>{n.errs.length>0?this.callback({error:n.errs}):(n.datas.forEach(n=>{n.imgs.forEach(s=>{let i=t.datas[s.index];if(i){let t={link:n.cdn,data:{x:s.x,y:s.y,width:s.width,height:s.height,style:s.style}};i.objs.forEach(n=>{let r='<img class="quill-image"  data-value=\''.concat(JSON.stringify(t),"' style=\"").concat(s.style,'"/>');"options"===i.path?n[i.path]=n[i.path].map(t=>({...t,text:t.text.replace(i.base,r)})):n[i.path]=n[i.path].replace(i.base,r)})}})}),this.callback({success:this.questions}))})):this.callback({success:this.questions})}})}replaceImage(t,n){var s=t[n];"options"==n&&(s=t[n].map(t=>t.text).join(""));let i=s.matchAll(this.pattern_image);for(;;){let s=i.next();if(s.done)break;let[r]=s.value,[,l,a]=r.match(/data-value=(?:"([^"]*)"|'([^']*)')/)||[];l||a||this.imageMaps.push({base:r,data:null,objs:[t],path:n,canvas:document.createElement("canvas")})}}startConvertCanvas(t){return new Promise((n,s)=>{let i=new Image;i.crossOrigin="anonymous",i.onload=()=>{var s;let r=1;if(i.width>this.sizeDefaultCanvas&&(r=this.sizeDefaultCanvas/i.width),i.height>this.sizeDefaultCanvas){let t=this.sizeDefaultCanvas/i.height;t<r&&(r=t)}t.canvas.width=i.width*r,t.canvas.height=i.height*r,null===(s=t.canvas.getContext("2d"))||void 0===s||s.drawImage(i,0,0,i.width,i.height,0,0,t.canvas.width,t.canvas.height),n(t)},i.onerror=()=>{t.canvas.width=1,t.canvas.height=1;let s=t.canvas.getContext("2d");s&&(s.fillStyle="white",s.fillRect(0,0,1,1)),n(t)};let r=this.pattern_base64.exec(t.base);null!=r?i.src=r[0]:s(Error("lỗi regex"))})}startUploadFile(t){return new Promise(async(n,s)=>{let i=new FormData;i.append("image",this.dataURLtoFile(t.canvas.toDataURL("image/png",1)));let{data:l}=await r.default.post("/uploads",i,{headers:{"Content-Type":"multipart/form-data"}}),{error:a,url:c}=l;if(a)return n({...t,cdn:await this.canvasToBlobURL(t.canvas,"image/png",1)||""});n({...t,cdn:c})})}canvasToBlobURL(t,n,s){return new Promise(function(i,r){t.toBlob(function(t){t?i(URL.createObjectURL(t)):r("Kh\xf4ng thể chuyển đổi canvas th\xe0nh blob.")},n,s)})}dataURLtoFile(t){let n=this.getFileName(t);for(var s=t.split(","),i=s[0].match(/:(.*?);/),r=atob(s[1]),l=r.length,a=new Uint8Array(l);l--;)a[l]=r.charCodeAt(l);return new File([a],n,{type:i&&i.length>0?i[1]:"png"})}getFileName(t){var n=t.split("").reverse().join(""),s=n.indexOf(";"),i=n.indexOf("/",s);return n.substring(s,i).split("").reverse().join("")}constructor(t){this.questions=JSON.parse(JSON.stringify(t)),this.callback=()=>{},this.sizeDefaultCanvas=1100,this.actionRunAfterConvert=[],this.imageMaps=[],this.pattern_base64=/data:image[^"'\\]+/i,this.pattern_image=/<img[^>]+data:image[^>]+>/g,this.taskConvertBase64ToCanvas=new c(50,{function:(t,n)=>{this.callbackBase64ToCanvas&&this.callbackBase64ToCanvas(t,n)}}),this.taskUploadImage=new c(3,{function:(t,n)=>{this.callbackUploadImage&&this.callbackUploadImage(t,n)}})}},Version:"test"}},6781:function(t,n,s){"use strict";Object.defineProperty(n,"__esModule",{value:!0});let i=s(1117),r=t=>{let n="z",s="abcdefghijklmnopqrstuvwxyz0123456789",i=s.length;for(let r=0;r<t;r++)n+=s.charAt(Math.floor(Math.random()*i));return n};class l{readFileInputEventAsArrayBuffer(t,n){var s=new FileReader;s.onload=function(t){n(t.target.result)},s.readAsArrayBuffer(t)}handleFileSelect(t,n,s){let r=this,l=(t,n)=>{s&&s(t,n,"lang_auto_cong_thuc")},a=new i.Task(30,{function:s?(t,n)=>{s&&s(t,n,"lang_auto_image")}:()=>{}});this.readFileInputEventAsArrayBuffer(t,function(t){console.log("start readDocx"),taodethiDocx.readDocx(t,l).then(function(t){for(let n of t.data)"img"==n.type&&("image/x-wmf"==n.contentType||"image/x-emf"==n.contentType?a.addTask(r,r.convert,[n]):n.value="data:"+n.contentType+";base64, "+n.value,!n.cssStyle&&n.height&&n.width&&"EMU"==n.measureUnit)&&(n.cssStyle="width:".concat(+n.width/12700,"pt;height:").concat(+n.height/12700,"pt;margin-top:0px;"));a.start().then(()=>{let s=new Map,i=0;for(let n of t.data)"img"==n.type&&n.cropInfo&&s.set(i,1),i++;if(n&&0==s.size)n(t);else for(let l of(i=0,t.data)){if("img"==l.type&&l.cropInfo){let a=i,c=document.createElement("img");c.src=l.value,c.onload=()=>{r.cropImage(l,c),s.delete(a),0==s.size&&n&&n(t)},c.onerror=()=>{s.delete(a),0==s.size&&n&&n(t)}}i++}})})})}convert(t){return new Promise(n=>{if("image/x-wmf"==t.contentType)t.value=this.wmf.toPNG("data:"+t.contentType+";base64, "+t.value),n();else{let i=new ToContext2D(0,1),r=this.decodeBase64(t.value);try{FromEMF.Parse(r,i)}catch(t){}var s=this.scaleCanvas(i.canvas,200,200);t.value=s.toDataURL(),n()}})}decodeBase64(t){return Uint8Array.from(atob(t),function(t){return t.charCodeAt(0)})}scaleCanvas(t,n,s){var i;let r=document.createElement("canvas");return r.width=n,r.height=s,null===(i=r.getContext("2d"))||void 0===i||i.drawImage(t,0,0,t.width,t.height,0,0,n,s),r}cropImage(t,n){var s;if(!t.cropInfo)return;let i=t.cropInfo.left?+t.cropInfo.left:0,r=t.cropInfo.top?+t.cropInfo.top:0,l=t.cropInfo.right?+t.cropInfo.right:0,a=t.cropInfo.bottom?+t.cropInfo.bottom:0;if(i+r+l+a==0)return;let c=n.width,h=n.height,d=i*c/1e5,u=r*h/1e5,x=c-l*c/1e5-d,p=h-a*h/1e5-u,f=document.createElement("canvas");f.width=x,f.height=p,null===(s=f.getContext("2d"))||void 0===s||s.drawImage(n,d,u,x,p,0,0,x,p),t.value=f.toDataURL()}constructor(t){this.wmf=new WMFConverter}}class a{process(t){let n=["(^c\xe2u\\s*\\d{1,4}[^0-9])","(^câu\\s*\\d{1,4}[^0-9])","(^c\xa9u\\s*\\d{1,4}[^0-9])","(^ca‚u\\s*\\d{1,4}[^0-9])","(^b\xe0i\\s*\\d{1,4}[^0-9])","(^bài\\s*\\d{1,4}[^0-9])","(^cau\\s*\\d{1,4}[^0-9])","(^bai\\s*\\d{1,4}[^0-9])","(^question\\s*\\d{1,4}[^0-9])","(^questions\\s*\\d{1,4}[^0-9])","(^\\[\\d{1,4}\\][^0-9])","(^\\d+\\s*\\(nb\\))","(^\\d+\\s*\\(th\\))","(^\\d+\\s*\\(vd\\))","(^\\d+\\s*\\(vdc\\))","(^c\xe2u\\s*\\d{1,4}[\\s\\.:]*$)","(^câu\\s*\\d{1,4}[\\s\\.:]*$)","(^c\xa9u\\s*\\d{1,4}[\\s\\.:]*$)","(^ca‚u\\s*\\d{1,4}[\\s\\.:]*$)","(^b\xe0i\\s*\\d{1,4}[\\s\\.:]*$)","(^bài\\s*\\d{1,4}[\\s\\.:]*$)","(^cau\\s*\\d{1,4}[\\s\\.:]*$)","(^bai\\s*\\d{1,4}[\\s\\.:]*$)","(^questions\\s*\\d{1,4}[\\s\\.:]*$)","(^question\\s*\\d{1,4}[\\s\\.:]*$)"],s=["(^(\\d+\\s*\\.)\\s*[\\.0-9])","(^(\\d+\\s*\\.)\\s*\\(\\s*\\d+\\s*\\))","(^(\\d+\\s*\\.)\\s*[^\\s]\\s*[^\\s0-9])","(^\\d+\\s*\\.\\s*$)"],r=["(HƯỚNG\\s*DẪN)","(ƯỚNG\\s*DẪN\\s*GIẢI\\s*CHI)","(GIẢI\\s*TH\xcdCH\\s*CHI\\s*TIẾT)","(Hướng\\s*dẫn\\s*giải)","(Lời\\s*giải)","(LỜI\\s*GIẢI)","(GIẢI\\s*CHI\\s*TIẾT)","(HD:)","(GLOSSARY)"],l=0,a=[],c=[];for(let h of t){let t=this.do(h,n,s);null!=t?(a.push({idx:l,val:i.Utils.capitalizeFirstLetter(t.olabel)}),c.push("q")):null!=(t=this.match(h,r))&&c.push("h"),l++}if(c.join("-").startsWith("q-h-q-h")){let n=1;for(let s of a)t[s.idx]=t[s.idx].replace(s.val,s.val.replace(/\d+/g,n+"")),n++}}do(t,n,s){let i=this.matchPos(t,n,s);if(i.value){let n=null;for(let t=i.value.length-1;t>=0;t--)if(i.value[t]){n=i.value[t];break}if(null==n)return null;let s=t.replace(/\|/g,"").toLowerCase().indexOf(n),r=s,l="",a=t.toLowerCase();for((n.endsWith("(")||n.endsWith("["))&&(n=n.substring(0,n.length-1));r<a.length&&("|"!=a[r]&&(l+=a[r]),r++,l!=n););return{pos:[s,r],olabel:n}}return null}matchPos(t,n,s){let i=t.replace(/\|/g,"").toLowerCase().trim(),r=n.join("|"),l=i.matchAll(r).next();return l.value||(r=s.join("|"),l=i.matchAll(r).next()),l}match(t,n){let s=t.replace(/\|/g,"").trim().match(n.join("|"));return null!=s&&s.length>0?{pos:[0,0],olabel:""}:null}}class c{process(t){let n=/^\s*#(\d)\s*\[[A-Z0-9\-\[\]\$!:b]+\]/g,s=["NB","TH","VD","VDC"],i=0,r=!1,l=1;for(let a of t){let c=a.matchAll(n).next();if(!c.done){let n=+c.value[1]-1;n<s.length&&(t[i]=a.replace(c.value[0],"C\xe2u ".concat(l++,". (").concat(s[n],")"))),r=!0}r&&"GY"==a.trim()&&(t[i]="Lời giải"),i++}}}class h{setApiService(t){this.apiService=t}setSingleMode(t){this.singleMode=t}setLines(t){this._lines=t}parse(t){return this._lstQuest=this.exParser.parse(this._lines,t,!1),this._lstQuest}constructor(t){this.conf=t,this._lstQuest=[],this._lines=[],this.singleMode=!1,this.exParser=new d(t),this.apiService=null}}class d{parse(t,n,s){var r,l,a,c,h,d,u,x,p,f,g,v;let Z=this.findItems(t,s),A=new Map,P=[],S=null,N=0,k="main",_=0,L=0,M=[],R=!0,O=new Map;for(let n=0;n<Z.length;n++){let s=Z[n],f=n==Z.length-1?void 0:Z[n+1],g=this.getPartInfo(t,s,f);if(this.loadText(t,g),s.type==j.TYPE_NAME&&"main"==k&&(N++,P.push({label:N,parts:g,answers:[],isGroup:!0})),s.type==y.TYPE_NAME){if(f&&f.type==C.TYPE_NAME&&f.pos[2]>0){let i;for(let t=n+1;t<Z.length;t++)if(Z[t].type!=C.TYPE_NAME){i=Z[t];break}g=this.getPartInfo(t,s,i),this.loadText(t,g)}let i=s.label?+s.label:0,r=A.get(i);r&&"main"!=k?(r.help=g,S=r):"main"==k&&(r={label:i,olabel:s.olabel,answers:[],parts:g},N>0&&(r.group=N),A.set(i,r),P.push(r),S=r)}if(s.type==C.TYPE_NAME&&S){let n=!1;if(g.length>0){let s=t[g[0].lineIdx].replace(/\|/g,"").trim().match(i.Constants.MULTIPLE_ANS_PATTERN.join("|"));null!=s&&s.length>0&&(n=!0)}let l=""==s.olabel;s.pos[2]>0&&((g=[g[0]])[0].e=s.pos[2],this.loadText(t,g),l=!0);let a={label:null!==(r=s.label)&&void 0!==r?r:"",isCorrect:"*"==s.extInfo,parts:l?[g[0]]:g,isInline:l,olabel:s.olabel};S.answers.push(a),S.isFixAns=l||n}if(s.type==E.TYPE_NAME){if(s.label&&/\.\d*$/.test(s.label)){let t=s.label.split("."),n=+t[t.length-1],i=null!==(l=g[0].text)&&void 0!==l?l:"",r=null!==(a=O.get(i))&&void 0!==a?a:-1;if(r++,O.set(i,r),0==n){N++;let t=i+"=>"+r+"-0",n=[];n.push(...g),n[0]={lineIdx:g[0].lineIdx,s:0,b:0,text:t},P.push({label:N,parts:n,answers:[],isGroup:!0});continue}let h=S?S.label:0,d=0;for(let t=0;t<n;t++){d++;let n=i+"=>"+r+"-"+t,s=[];s.push(...g),s[0]={lineIdx:g[0].lineIdx,s:0,b:0,text:n};let l={label:h+d,olabel:S?null===(c=S.olabel)||void 0===c?void 0:c.replace(/\d+/,h+d+""):this.DEF_QUEST_NAME+(h+d)+".",answers:[],parts:s};A.set(l.label,l),P.push(l),S=l}}else if(s.label&&/\.Q\d+(,Q\d+)*$/.test(s.label)){let t=s.label.split(".").pop(),n=null!==(h=null==t?void 0:t.split(",").length)&&void 0!==h?h:0;for(let t=0;t<n;t++){let n={lineIdx:g[0].lineIdx,s:0,b:0,text:g[0].text+"=>0-"+t},s=S?S.label:0,i={label:s+1,olabel:S?null===(d=S.olabel)||void 0===d?void 0:d.replace(/\d+/,s+1+""):this.DEF_QUEST_NAME+(s+1)+".",answers:[],parts:[n]};A.set(i.label,i),P.push(i),S=i}}}s.type==I.TYPE_NAME&&S&&(g.splice(0,1),f&&f.type==y.TYPE_NAME&&f.label&&!A.has(+f.label)||!f||f.type==j.TYPE_NAME?"main"==k&&(S.help=g):"main"==k&&(k="info",_=null!==(u=s.lineIdx)&&void 0!==u?u:0),_>0&&0==L&&(L=null!==(x=s.lineIdx)&&void 0!==x?x:0)),(s.type==w.TYPE_NAME||s.type==T.TYPE_NAME)&&(k="info",_=null!==(p=s.lineIdx)&&void 0!==p?p:0),s.type==b.TYPE_NAME&&R&&M.push(s),s.type!=b.TYPE_NAME&&M.length>0&&(R=!1)}let H=new b,z=H.getAnsMC(t,M),B=new Map;if(_>0){let n=L>0?t.slice(_,L):t.slice(_);B=H.getAnsStr(n)}for(let n of P){if(n.isGroup)continue;let s=null!==(f=z.get(n.label))&&void 0!==f?f:"",i=null!==(g=B.get(n.label))&&void 0!==g?g:"",r="";if(n.help&&(r=null!==(v=H.getAnsFromHelp(n.help,t))&&void 0!==v?v:""),n.answers.length>0){if(0==n.answers.filter(t=>t.isCorrect).length){let t=s;for(let s of(""==t.trim()&&(t=r),""==t.trim()&&(t=i),n.answers))/^[A-H,\s]+$/.test(t)&&t.indexOf(s.label)>=0&&(s.isCorrect=!0)}}else n.strAns=i;n.answers.filter(t=>{var n,s;return(null==t?void 0:null===(n=t.answers)||void 0===n?void 0:null===(s=n.label)||void 0===s?void 0:s.charCodeAt(0))>=97}).length&&(n.strAns=i)}return P}cleanRes(t){for(let n of t){for(let t=n.parts.length-1;t>=0;t--)""==n.parts[t].text&&n.parts.splice(t,1);for(let t of n.answers)for(let n=t.parts.length-1;n>=0;n--)""==t.parts[n].text&&t.parts.splice(n,1);if(n.help)for(let t=n.help.length-1;t>=0;t--)""==n.help[t].text&&n.help.splice(t,1)}}getPartInfo(t,n,s){var i,r;let l=null!==(i=n.lineIdx)&&void 0!==i?i:0,a=null!==(r=null==s?void 0:s.lineIdx)&&void 0!==r?r:t.length-1;if(l==a)return s?[{lineIdx:l,b:n.pos[0],s:n.pos[1],e:null==s?void 0:s.pos[0]}]:[{lineIdx:l,b:n.pos[0],s:n.pos[1]}];{let i=[];i.push({lineIdx:l,b:n.pos[0],s:n.pos[1]});for(let t=l+1;t<a;t++)i.push({lineIdx:t,b:0,s:0});if(s){let n=null==s?void 0:s.pos[0];""!=t[a].substring(0,n).replace(/\|/g,"").trim()&&i.push({lineIdx:a,b:0,s:0,e:n})}else i.push({lineIdx:a,b:0,s:0});return i}}loadText(t,n){for(let s of n)s.text=t[s.lineIdx].substring(s.s,s.e)}findItems(t,n){let s=["remove:q-s-a => 1","remove:s-s => 0","remove:h-h => 0","remove:h-a => 0","rmdup:a-a => void","remove:s-a:.+\\-[^A] => 0","remove:a-a:A\\-[^B] => 0","remove:a-a:B\\-[^C] => 0","remove:a-a:C\\-[^D] => 0","remove:a-a:D\\-[^E] => 0","remove:a-a:E\\-[^F] => 0","same:q:QUESTION_PATTERN,QUESTION_PATTERN2 => void"];n&&(s=["remove:q-s-a => 1","remove:s-s => 0","remove:h-h => 0","remove:h-a => 0","remove:q-a:\\d+\\-[^A] => 0","remove:s-a:.+\\-[^A] => 0","remove:a-a:A\\-[^AB] => 0","remove:a-a:B\\-[^ABCD] => 0","remove:a-a:C\\-[^ACDE] => 0","remove:a-a:D\\-[^ADEF] => 0","remove:a-a:E\\-[^AEF] => 0","same:a: => void","same:q:QUESTION_PATTERN,QUESTION_PATTERN2 => void"]);let i=[new x,new p,new f,new g],r=[{parser:new b,also:[2]},{parser:new j,from:[0],to:[1],also:[3]},{parser:new y,from:[0],to:[1],also:[3]},{parser:new C},{parser:new w,to:[2]},{parser:new T,to:[2],also:[6]},{parser:new I},{parser:new E,from:[0],to:[1]}],l=[{name:"start",expect:[1,2,7]},{name:"main",expect:[1,2,3,4,5,6,7]},{name:"info",expect:[0,1,2,6]}],a=l[0],c=[],h=0;for(let n of t)if(""!=n){for(let t of a.expect){let s=r[t],i=s.parser.parse(n);if(i.length>0){if(i.forEach(t=>t.lineIdx=h),c.push(...i),s.parser.TYPE==I.TYPE_NAME){let t=c.filter(t=>t.type==y.TYPE_NAME).length,n=c.filter(t=>t.type==I.TYPE_NAME).length,s=c.filter(t=>t.type==T.TYPE_NAME).length;if(a.name==l[1].name&&t>1&&0==n){a=l[2];let t=l[2].expect.indexOf(6);t>=0&&l[2].expect.splice(t,1)}else if(a.name==l[2].name){s>0&&r[0].parser.off();let t=l[2].expect.indexOf(6);t>=0&&l[2].expect.splice(t,1)}}if(s.to){let t=0;for(let n of s.to)(s.from&&l[s.from[t]]==a||!s.from)&&(a=l[n]),t++}if(s.also)for(let t of s.also){let s=c[c.length-1].pos[1],i=r[t].parser.parse(n.substring(s));i.length>0&&(i.forEach(t=>{t.lineIdx=h;for(let n=0;n<t.pos.length;n++)t.pos[n]=t.pos[n]+s}),c.push(...i))}break}}h++}else h++;let d=[];for(let t of s)for(let n of i){let s=n.load(t);if(s){d.push(s);break}}let u=0;for(;u<c.length;){for(let t of d){let n=c.length;if(t.run(c,u)){let t=n-c.length;t>0&&(u-=t+1);break}}u++}return c}constructor(t){this.DEF_QUEST_NAME="c\xe2u ",i.Constants.load(t)}}class u{checkVal(t,n){var s;if(""==this.valPattern)return!0;let i=[];for(let r=Math.ceil(this.pattern.length/2);r>0;r--)i.push(null===(s=t[n-r+1].label)||void 0===s?void 0:s.trim());let r=i.join("-");return new RegExp(this.valPattern).test(r)}getStack(t,n){let s="",i=n-10>=0?n-10:0;for(;i<=n;i++)s+="-"+t[i].type[0];return s}constructor(t,n){if(this.TYPE="",this.pattern="",this.valPattern="",this.data=[],this.TYPE=n,!t.startsWith(this.TYPE))return;let s=t.substring(this.TYPE.length).split("=>"),i=s[0].split(":");this.pattern=i[0].trim(),this.valPattern=i.length>1?i[1].trim():"",this.data=s[1].split(",").map(t=>t.trim())}}class x extends u{load(t){let n=new x(t);return""!=n.pattern?n:null}run(t,n){if(""==this.pattern)return!1;if(this.getStack(t,n).endsWith(this.pattern)&&this.checkVal(t,n)){for(let s of this.data)t.splice(n-+s,1);return!0}return!1}constructor(t){super(null!=t?t:"","remove:")}}class p extends u{load(t){let n=new p(t);return""!=n.pattern?n:null}run(t,n){if(""==this.pattern)return!1;if(this.getStack(t,n).endsWith(this.pattern)&&this.checkVal(t,n)){for(let s of this.data){let i=s.split(":"),r=n-+i[0],l=t[r].label;t[r].label=i[1],t[r].err=l+" -> "+i[1]}return!0}return!1}constructor(t){super(null!=t?t:"","modify:")}}class f extends u{load(t){let n=new f(t);return""!=n.pattern?n:null}run(t,n){var s,r,l;if(""==this.pattern)return!1;let a=t[n];if(a.type[0]!=this.pattern)return!1;let c=[],h=[],d="";for(let s=0;s<n;s++){let n=t[s];(n.type==w.TYPE_NAME||n.type==T.TYPE_NAME)&&(d="da"),n.type==I.TYPE_NAME&&"da"==d&&(d="hd")}if("da"==d)return!1;for(let s=n-1;s>=0;s--){let n=t[s];if(n.type==w.TYPE_NAME||n.type==T.TYPE_NAME||"hd"==d&&n.type==I.TYPE_NAME||(n.type[0]==this.pattern&&n.olabel&&(c.push(n.olabel),h.push(n.label)),2==c.length))break}if(c.length>=1){let d=c[0],u=2==c.length?c[1]:d,x=null!==(s=a.olabel)&&void 0!==s?s:"";if("a"==this.pattern&&(""==d&&(d="."),""==u&&(u="."),""==x&&(x=".")),""==this.valPattern){if(d==u&&x!=d)return t.splice(n,1),!0}else for(let s of this.valPattern.split(",")){let c=s.trim(),p=new RegExp(i.Constants[c].join("|"));if(p.test(d)&&p.test(u)&&!p.test(x)&&+(null!==(r=h[0])&&void 0!==r?r:"0")+1!=+(null!==(l=a.label)&&void 0!==l?l:"0"))return t.splice(n,1),!0}}return!1}constructor(t){super(null!=t?t:"","same:")}}class g extends u{load(t){let n=new g(t);return""!=n.pattern?n:null}run(t,n){var s,i;if(""==this.pattern)return!1;if(this.getStack(t,n).endsWith(this.pattern)){let r=null!==(s=t[n].score)&&void 0!==s?s:0,l=null!==(i=t[n-1].score)&&void 0!==i?i:0;if(t[n].label==t[n-1].label)return t.splice(r>l?n-1:n,1),!0}return!1}constructor(t){super(null!=t?t:"","rmdup:")}}class v{on(){this.isOn=!0}off(){this.isOn=!1}parse(t){return this.isOn?this.do(t):[]}match(t,n){let s=t.replace(/\|/g,"").trim().match(n.join("|"));return null!=s&&s.length>0?[{type:this.TYPE,pos:[0,0]}]:[]}constructor(){this.isOn=!0,this.TYPE="default"}}class b extends v{do(t){let n=this.cleanLine(t);return/^[0-9ABCDEFGHabcdefghĐS]+$/g.test(n)&&n.length>=2?[{type:b.TYPE_NAME,pos:[0,0]}]:[]}cleanLine(t){let n=t;for(let t of(n=(n=n.replaceAll(/\[![!iucsbp]+:\$(([^$]|\$[^\]])+)\$\]/g,"$1")).replaceAll(/\[![!iucsbp]+:!!\]/g,""),[/\|/g,/[\s.\-:,;![\]@*$()\u2013]+/g,/C\xe2u/g,/\u0110\xe1p\xe1n/g,/\u0110\/A/g,/Question/g,/Questions/g,/question/g,/questions/g]))n=n.replaceAll(t,"");return n.replaceAll("\\n"," ")}getAnsMC(t,n){var s;let i=[];for(let r of n)i.push(t[null!==(s=r.lineIdx)&&void 0!==s?s:0]);let r=i.join(""),l=this.cleanLine(r),a=this.getResultMC(l.toUpperCase()),c=new Map;for(let t of a)c.set(t.num,t.str);return c}getAnsStr(t){let n=t.join("\n");n=(n=(n=n.replaceAll(/\[![!iucsbp]+:\$(([^$]|\$[^\]])+)\$\]/g,"$1")).replaceAll(/\[![!iucsbp]+:!!\]/g,"")).replaceAll("[*","").replaceAll("*]","");let s=this.getResultStr(n),i=new Map;for(let t of s)i.set(t.num,t.str);return i}getAnsFromHelp(t,n){let s=[];for(let i of t){let t=n[i.lineIdx];t=(t=t.replaceAll(/\[![!iucsbp]+:\$(([^$]|\$[^\]])+)\$\]/g,"$1")).replaceAll(/\[![!iucsbp]+:!!\]/g,""),s.push(t)}let r=0;for(let n of s){let s=n.trim().match(i.Constants.HELP_ANS_PATTERN.join("|"));if(null!=s){for(let n of s)if(null!=n&&1==n.length)return t.splice(r,1),n}r++}return""}getResultStr(t){let n=[],s=t.replace(/\n/g,"\n"),r=i.Constants.QUESTION_PATTERN.join("|").replace(/\(\^/g,"("),l=s.matchAll(RegExp(r,"ig"));for(;;){let t=l.next();if(t.done)break;let n=t.value[0],r=i.Utils.getNumberFromStr(n);s=s.replace(n,r+".")}let a,c=i.Constants.RES_ANS_PATTERN.length>0?RegExp(i.Constants.RES_ANS_PATTERN.join("|"),"g"):/\d+[.-][^|0-9]/g,h=s.matchAll(c),d=-1;for(;;){let t=h.next();if(t.done)break;if(-1==d)d=t.value.index,a=t;else{let i=s.substr(d,t.value.index-d);n.push(this.toAns(i,a)),d=t.value.index,a=t}}if(d>=0&&a){let t=s.substr(d);n.push(this.toAns(t,a))}return n}toAns(t,n){let s=n.value[0].length-1;return{num:+n.value[0].substr(0,s-1),str:t.substring(s).replace(/\s+/g," ").trim()}}getResultMC(t){let n=[],s="",i=[],r=!1;for(let n=0;n<t.length;n++){let l=t.charCodeAt(n),a=l>=65&&l<=72;if(a&&""==s)return[];a!=r&&(i.push(s),s=""),r=a,s+=t[n]}""!=s&&i.push(s);for(let t=1;t<i.length;t+=2){let s=0,r=Math.floor(i[t-1].length/i[t].length),l=+i[t-1].substring(s,r),a=l,c=!1;for(let h=0;h<i[t].length;h++){if(h>=i[t-1].length||(l=+i[t-1].substring(s,s+r))!=a){c=!0;break}n.push({num:l,str:i[t][h]}),s+=r,r=(a=l+1).toString().length}if(c){n=[];break}}if(0==n.length)for(let t=1;t<i.length;t+=2){let s=+i[t-1];if(t>1&&s!=n[n.length-1].num+1)return[];n.push({num:s,str:i[t]})}return n}constructor(t){super(),this.TYPE=b.TYPE_NAME,null!=t&&(this.isOn=t)}}b.TYPE_NAME="chitietdapan";class j extends v{do(t){let n=t.replace(/\|/g,""),s=(n=n.replaceAll(/\[![!ibuc]+:\$(([^\$]|\$[^\]])+)\$\]/g,"$1")).toLowerCase().trim().match(i.Constants.SECTION_PATTERN_LOWER.join("|")),r=null!=s&&s.length>0;return r||(r=null!=(s=n.trim().match(i.Constants.SECTION_PATTERN_NORMAL.join("|")))&&s.length>0),r&&s?[{type:this.TYPE,pos:[0,0],label:n}]:[]}constructor(t){super(),null!=t&&(this.isOn=t),this.TYPE="section",this.TYPE_NAME=this.TYPE}}j.TYPE_NAME="section";class y extends v{do(t){let n=this.matchPos(t);if(n.value){let s=null;for(let t=n.value.length-1;t>=0;t--)if(n.value[t]){s=n.value[t];break}if(null==s)return[];let i=t.replace(/\|/g,"").toLowerCase().indexOf(s),r=i,l="",a=t.toLowerCase();for((s.endsWith("(")||s.endsWith("["))&&(s=s.substring(0,s.length-1));r<a.length&&("|"!=a[r]&&(l+=a[r]),r++,l!=s););let c={type:this.TYPE,pos:[i,r]};return c.label=this.getNumberFromStr(t.substring(c.pos[0],c.pos[1])),c.olabel=s,[c]}return[]}matchPos(t){let n=t.replace(/\|/g,"").toLowerCase().trim(),s=i.Constants.QUESTION_PATTERN.join("|"),r=n.matchAll(s).next();return r.value||(s=i.Constants.QUESTION_PATTERN2.join("|"),r=n.matchAll(s).next()),r}getNumberFromStr(t){let n=t.match(/(\d+)/);return n?n[0]:""}constructor(t){super(),null!=t&&(this.isOn=t),this.TYPE=y.TYPE_NAME}}y.TYPE_NAME="question";class C extends v{do(t){let n=[],s="|"+t,i=/([\s|.\]]+\*?[A-H][\s|]*[.)]|[a-h]\))/g,r=this.matchPos(s,i,!1);0==r.length&&(r=this.matchPos(s,i,!0));let l=!1;0==r.length&&/^\|?\s*\*?[A-H\s|]+$/g.test(s)&&(l=!0,r=this.matchPos(s,/\*?[A-H]/g,!1));let a=!1;if(0==r.length&&(l=!0,a=!0,r=this.matchPos(s,/\[\*?[A-H]:[^\]]+\]/g,!1)),r.length>0)for(let i of r){let r=i.index+i.value.length-1,c=-9999,h=i.value.replace(/\*?[\sA-H|]/g,"");a&&(c=i.index+i.value.length-2,i.index=i.index+1,r=i.index+1+(i.value.startsWith("[*")?1:0),h=".");let d={type:this.TYPE,pos:[i.index-1,r,c]},u=t.substring(d.pos[0]);(l||/^\|?\s*\*?[A-Himg\s|.]+$/g.test(s)||u.trim()!=i.value.trim())&&(d.label=t.substring(d.pos[0],d.pos[0]+1),"*"==d.label&&(d.label=t.substring(d.pos[0]+1,d.pos[0]+2),d.extInfo="*"),d.olabel=h,d.score=1,""==t.substring(0,d.pos[0]).replace(/[\s|]/g,"")&&(d.score=2),n.push(d))}return n}matchPos(t,n,s){let i=s?t.toUpperCase():t,r=/[\s|.\]]/,l=i.matchAll(n),a=[];for(;;){let t=l.next();if(t.done)break;let n=0;for(let s=t.value.index;s<i.length&&r.test(i[s]);s++)n++;let s=t.value[0].substr(n,1),c=/[[(]\s*(VD|TH|NB|VDC|EASY|MEDIUM|HARD|HARDEST)\s*[\d.]*\s*[)\]]\s*[:.]?/g,h=/\[![a-z]+:\$\s*\$\]/g;("A"!=s||i.replace(/\|/g,"").replace(/\[!info:\d+\]/g,"").replace(c,"").replace(h,"").trim().startsWith("A"))&&("*A"!=s||i.replace(/\|/g,"").replace(/\[!info:\d+\]/g,"").replace(c,"").replace(h,"").trim().startsWith("*A"))&&a.push({value:t.value[0].substr(n),index:t.value.index+n})}return a}constructor(t){super(),null!=t&&(this.isOn=t),this.TYPE=C.TYPE_NAME}}C.TYPE_NAME="answer";class w extends v{do(t){return this.match(t,i.Constants.HET_PATTERN)}constructor(t){super(),null!=t&&(this.isOn=t),this.TYPE=w.TYPE_NAME}}w.TYPE_NAME="end";class T extends v{do(t){return this.match(t,i.Constants.DAPAN_PATTERN)}static getAnsFromHelp(t){for(let n of t){let t=n.replace(/\|/g,"").trim().match(i.Constants.HELP_ANS_PATTERN.join("|"));if(null!=t){for(let n of t)if(null!=n&&1==n.length)return n}}return""}constructor(t){super(),null!=t&&(this.isOn=t),this.TYPE=T.TYPE_NAME}}T.TYPE_NAME="dapan";class I extends v{do(t){return this.match(t,i.Constants.HUONGDAN_PATTERN)}constructor(t){super(),null!=t&&(this.isOn=t),this.TYPE=I.TYPE_NAME}}I.TYPE_NAME="huongdan";class E extends v{do(t){let n=t.replace(/\|/g,"").trim();if(/^\[@[^!\]]+\]([\.,]\[[^\]!]+\])*$/.test(n)){let t=n;return t=t.replaceAll(/\[@([CTQG]\d+):[^\]]*\]/g,"$1").replaceAll(/\[@(F:[^\]]*)\]/g,"$1").replaceAll(/\[[^\]\d]+(\d+)[^\]\d]+\]/g,"$1").replaceAll(/\[[^\]]+\]/g,""),[{type:this.TYPE,pos:[0,0],label:"@@."+t}]}return[]}constructor(t){super(),null!=t&&(this.isOn=t),this.TYPE=E.TYPE_NAME}}E.TYPE_NAME="include";class Z{setCallback(t){}setApiCache(t){}setLoadingManager(t){this.loadingManager=t}loadImage(t,n){return new Promise((s,i)=>{let l=r(10);this.loadingManager.set(l,t),(0,o.dr)(t,n).then(t=>{s(t),this.loadingManager.delete(l)}).catch(()=>{this.loadingManager.delete(l),i(Error())})})}loadImageToBase64(t,n){return new Promise((s,i)=>{let l=new Image;l.crossOrigin="anonymous",l.setAttribute("count","1");let a=r(10);this.loadingManager.set(a,t),l.onload=()=>{var t;let n=document.createElement("canvas");n.width=l.width,n.height=l.height,null===(t=n.getContext("2d"))||void 0===t||t.drawImage(l,0,0,l.width,l.height,0,0,n.width,n.height);let i=this.isCropImage?e.rj.cropCanvas(n):n;s("<img id='".concat(a,"' class='img-docx' alt='error...' src='").concat(i.toDataURL(),"' style='width: ").concat(i.width*this.ratioImage,"px;height: auto'>")),this.loadingManager.delete(a)},l.onerror=()=>{this.loadingManager.delete(a);let s=l.getAttribute("count");s&&1==Number(s)?(l.src=n.getMyCdn(t),l.setAttribute("count","2")):s&&5>Number(s)?(l.setAttribute("count",s+1),l.src=n.getRawCdnLink(t)+"?t="+new Date().getTime()):i(Error())},l.src=n.getRawCdnLink(t)})}constructor(){this.isCropImage=!0,this.loadingManager=new Map,this.ratioImage=.65}}class A extends Z{render(t,n,s){if(t.trim().startsWith("[@"))return t;let i=t,r=this.chemBase.join("|"),l=RegExp("(?:[\\s,.:;\"'=–\\-\\/\\+\\?<>]|^)\\(?\\d*(".concat(r,")+\\d*(").concat(r,"|\\d+|\\(|\\))*(?:(?=[\\s,.:;\"'=–\\-\\/\\+\\?<>])|\\(\\w+\\)|$)"),"g"),a=i.matchAll(l),c=[];for(;;){let t=a.next();if(t.done)break;let n=0==t.value.index?t.value[0]:t.value[0].substring(1);n.replace("(","").replace(")","").length<=1||c.push({s:0==t.value.index?0:t.value.index+1,len:n.length,val:this.autoFormat(n)})}if(c.sort((t,n)=>t.s>n.s?-1:1),c.filter(t=>/\d+/.test(t.val)).length>0)for(let t of c)i=i.substring(0,t.s)+"\\("+t.val+"\\)"+i.substring(t.s+t.len);return i}autoFormat(t){return t.replaceAll(/([^\(])(\d+)/g,"$1_{$2}")}constructor(){super(...arguments),this.chemBase=["H","He","Li","Be","B","C","N","O","F","Ne","Na","Mg","Al","Si","P","S","Cl","Ar","K","Ca","Sc","Ti","V","Cr","Mn","Fe","Co","Ni","Cu","Zn","Ga","Ge","As","Se","Br","Kr","Rb","Sr","Y","Zr","Nb","Mo","Tc","Ru","Rh","Pd","Ag","Cd","In","Sn","Sb","Te","I","Xe","Cs","Ba","La","Ce","Pr","Nd","Pm","Sm","Eu","Gd","Tb","Dy","Ho","Er","Tm","Yb","Lu","Hf","Ta","W","Re","Os","Ir","Pt","Au","Hg","Tl","Pb","Bi","Po","At","Rn","Fr","Ra","Ac","Th","Pa","U","Np","Pu","Am","Cm","Bk","Cf","Es","Fm","Md","No","Lr","Rf","Db","Sg","Bh","Hs","Mt","Ds","Rg","Cn","Nh","Fl","Mc","Lv","Ts","Og"]}}class P extends Z{render(t,n,s){if(0>t.indexOf("[img:"))return t;let i=t,l=i.matchAll(/\[img:\$[a-zA-Z0-9_]+\$\]/g);for(;;){let t=l.next();if(t.done)break;let s=t.value[0],c=s.replace("[img:$","").replace("$]","");if(n){let t=n.find(t=>t.id===c);if(t){var a;let n=document.createElement("img");n.id=c,n.classList.add(0===c.indexOf("af")?"qv_full_a_img":0===c.indexOf("f")?"qv_full_img":"qv_img"),n.crossOrigin="anonymous",n.style.cssText=null!==(a=t.cssStyle)&&void 0!==a?a:"";let l=r(10),h=t.link;n.classList.add("quill-image"),this.loadingManager.set(l,h),n.onload=()=>{this.loadingManager.delete(l)},n.onerror=()=>{this.loadingManager.delete(l)},n.src=h,i=i.replace(s,n.outerHTML)}}}return i}cssStringToJSON(t){for(var n={},s=t.split(";"),i=0;i<s.length;i++){var r=s[i].split(":");if(2===r.length){var l=r[0].trim(),a=r[1].trim();n[l]=a}}return n}constructor(t){super(),this.cdnService=t}}class S extends Z{render(t,n,s){let i=t,r=i.matchAll(/\[\*?[A-H]:[^\]]+\]/g);for(;;){let t=r.next();if(t.done)break;let n=t.value[0],s=n.substring(1,n.length-1).split(":");2==s[0].length&&(s[0]=s[0].substring(1)),i=i.replace(n,"<span class=\"qv_string_eng_ans\" style='cursor: pointer;padding: 0 5px;font-weight: bold;text-decoration: underline;position: relative;height: 40px;display: inline-block;'>".concat(s[1]," <span style='position: absolute;top: 20px;left: 45%;'>").concat(s[0],"</span></span>"))}return i}revert(t,n){let s=t;return(s=s.replaceAll(/<span class="qv_string_eng_ans"[^>]+>([^><]+)<span[^>]+>([^><]+)<\/span><\/span>/g,"[$2:$1]")).replace("["+n+":","[*"+n+":")}}class N extends Z{trimWithBr(t){for(t=t.trim();/^<br>|<br>$/.test(t);)t=t.replace(/^<br>|<br>$/,"").trim();return t}render(t){let n=t,s=n.split("<br>"),i=0,r=/\[![!aibucsbphl]+:!!\]/;for(let t of s){if(r.test(t)){let n=t.split(":!!]")[0].split("["),l=n[n.length-1].split(":")[0];s[i]=t.startsWith("[*")?"[* ["+l+":$"+t.replace(r,"$]").substring(2):"["+l+":$"+t.replace(r,"$]")}i++}let l=(n=(n=s.join("<br>")).replaceAll(/\[![!aibucsbphl]+:\$\$\]/g,"")).matchAll(/\[![!aibucsbphl]+:\$(([^\$]|\$[^\]])+)\$\]/g);for(;;){let t=l.next();if(t.done)break;let s=t.value[0],i=t.value[1],r=s.split(":")[0].split("!");r.shift(),r.filter(t=>"a"==t).length>0&&(i=i.toUpperCase());for(let t=r.length-1;t>=0;t--){let n=r[t];i="hl"==n||"cl"==n?i:"<".concat(n,">").concat(i,"</").concat(n,">")}n=n.replace(s,i)}return this.trimWithBr(n)}}class k extends Z{render(t,n,s){let i=t;for(let t of[[/([^<])-+([^\-><]+)-+>/g,"$1\\( \\xrightarrow[]{$2} \\)"],[/<-+([^\-><]+)-+([^>])/g,"\\( \\xleftarrow[]{$1} \\)$2"],[/([^<])--+>/g,"$1\\( \\longrightarrow \\)"],[/<--+([^>])/g,"\\( \\longleftarrow \\)$1"],[/<-+>/g,"\\( \\longleftrightarrow \\)"],[/([^<])->/g,"$1\\( \\rightarrow \\)"],[/<-([^>])/g,"\\( \\leftarrow \\)$1"]])i=i.replaceAll(t[0],t[1]);return i}}class _ extends Z{render(t,n,s){let i=t.split("<br>"),r=[],l=[];for(let t of i)if(t.trim().startsWith("[*")&&t.trim().endsWith("*]")){let n=t.replaceAll("\\n","<br>").replaceAll("[*","<tr><td>").replaceAll("*]","</td></tr>");n=n.replaceAll("|","</td><td>"),l.push(n)}else l.length>0&&(r.push('<table class="q-table">'+l.join("")+"</table>"),l=[]),r.push(t);return l.length>0&&r.push('<table class="q-table">'+l.join("")+"</table>"),r.join("<br>")}}class L extends Z{render(t,n,s){return this.bypassChild(t).replaceAll(/\\\)\s*\\\(/g,"")}bypassChild(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"\\(",s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"\\)";if(n.length!==s.length)return"";let i=[],r=0;for(;;){let s=t.indexOf(n,r);if(-1===s)break;i.push("s_"+s),r=s+1}for(r=0;;){let n=t.indexOf(s,r);if(-1===n)break;i.push("e_"+n),r=n+1}i.sort(function(t,n){return parseInt(t.substr(2))-parseInt(n.substring(2))});let l=[],a=[];return i.forEach(t=>{if("s"===t.substring(0,1))l.push(parseInt(t.substring(2)));else if(1==l.length)l=[];else{let n=l.pop();if(n){let s=parseInt(t.substring(2));a.push(n),a.push(s)}}}),a.sort(function(t,n){return t-n}).reverse().forEach(s=>{t=t.substring(0,s)+t.substring(s+n.length)}),t}}class M extends Z{getSimilar(t,n,s){var i;let r=fe.G.generateIdRequired(10);return this.loadingManager.set(r,t),null===(i=this.discoveryService)||void 0===i||i.apiDiscoveryQuestionsInfoPost({text:t,maxRate:.99}).subscribe(t=>{let n=[];1===t.success&&t.data&&t.data.objs&&t.data.objs.length>0&&(n=t.data.objs),this.apiCallbackCache=new Map;let s=0;for(let t of n){let t={i:s,call:this.callBack,err:this.onError};s++;let n=this.apiCallbackCache.get(r);n?n.push(t):this.apiCallbackCache.set(r,[t])}0==n.length&&this.onError&&this.onError("NO_DATA"),setTimeout(()=>{this.processApiResponse(n,r,!1)},400),this.loadingManager.delete(r)}),"Loading...|0"}render(t,n,s){var r,l,a,c;let h=t.split("<br>")[0].trim(),d=h.split("=>"),u=d.length>1?+d[1].split("-")[1]:0,x=d.length>1?+d[1].split("-")[0]:0;if(!this.callBack||!/^\[@[CTGK][\-\d]+:[^\]]+\]([\.,]\[[^\]]+\])+$/.test(d[0].trim())&&!/^\[@Q[\-\d]+:[^\]]+\](\s*,\s*\[@Q[\-\d]+:[^\]]+\])*$/.test(d[0].trim()))return t;let p=d[0]+"=>"+x,f=i.Utils.parseInclude(h);if(this.apiDataCache){let t=this.apiDataCache.get(h);if(t&&this.callBack)return setTimeout(()=>{t&&this.callBack&&this.callBack(t)},50),"Loading...|"+f.questId.join(",")}if(this.apiCallbackCache){let t={i:u,call:this.callBack,err:this.onError},n=this.apiCallbackCache.get(p);if(n)return n.push(t),"Loading...|"+f.questId.join(",");this.apiCallbackCache.set(p,[t])}let g=this.loadedQuestIds&&0==f.questId.length?this.loadedQuestIds:[],v=!1;0==f.getNum&&f.groupId.length>0&&(v=!0,f.getNum=1,g=f.questId.length>0?g:[]),this.getOne&&f.getNum&&f.getNum>1&&(f.getNum=1);let b=fe.G.generateIdRequired(10),j=null===(r=this.matrixData)||void 0===r?void 0:r.filter(t=>t.key==p)[0];if(j)setTimeout(()=>{var t;this.processApiResponse(null!==(t=null==j?void 0:j.questions)&&void 0!==t?t:[],p,v)},400);else{this.loadingManager.set(b,h);let t={exceptQuestionIds:g,matrix:[]};null===(l=t.matrix)||void 0===l||l.push({number:f.getNum,key:p,paths:f.paths.map(t=>({type:t.type,id:t.id,groupIds:t.groupIds,tags:t.tags,answerTypes:t.answerTypes}))});let n=(null===(a=t.matrix)||void 0===a?void 0:a.filter(t=>{var n;return null!==(c=null===(n=t.paths)||void 0===n?void 0:n.filter(t=>"KNOWLEDGE"==t.type).length)&&void 0!==c&&c}).length)?null==s?void 0:s.apiQuestionsMatrixGlobalPost(t):null==s?void 0:s.apiQuestionsMatrixPost(t);n&&n.subscribe(t=>{let n=[];1===t.success&&t.data&&t.data[0]&&t.data[0].questions&&t.data[0].questions.length>0&&(n=t.data[0].questions),setTimeout(()=>{this.processApiResponse(n,p,v)},400),this.loadingManager.delete(b)})}return"Loading...|"+f.questId}setGetOne(t){this.getOne=t}processApiResponse(t,n,s){var i,r,l,a,c,h;let d=null!=t?t:[],u=null===(i=this.apiCallbackCache)||void 0===i?void 0:i.get(n);if(u)for(let t of u){let i=this.getOne?0:t.i;if(d.length<=i){t.err&&t.err(this.trans.err_empty_quest);continue}let r=d[i],u=this.commonService.willDeleteParseJson(null!==(l=r.content)&&void 0!==l?l:"[]"),x={type:"bank",sourceId:r.id};if(u&&u.length>0&&u[0].vMetaEditor&&(x.heightLabel=u[0].vMetaEditor.heightLabel),s){let s=this.commonService.willDeleteParseJson(r.content||"[]"),i="",l={renderedStr:i,label:"",quest:{label:0,isGroup:!0,parts:[],answers:[]},answers:[],isFixGroup:"1"===r.groupType,meta:x};if(1==r.isImage&&s[0].groupUrl){let n=fe.G.generateIdRequired(10);this.loadingManager.set(n,s[0].groupUrl),this.loadImage(s[0].groupUrl,this.cdnService).then(s=>{var i;let r=document.createElement("canvas");r.width=s.width,r.height=s.height,null===(i=r.getContext("2d"))||void 0===i||i.drawImage(s,0,0,s.width,s.height);let a=document.createElement("img");a.src=r.toDataURL(),a.classList.add("qv_img-group-content"),l.renderedStr=a.outerHTML,t.call(l),this.loadingManager.delete(n)}).catch(s=>{l.renderedStr="Load image error",t.call(l),this.loadingManager.delete(n)})}else i=null!==(a=s[0].groupContent)&&void 0!==a?a:"",l.renderedStr=i,t.call(l);this.apiDataCache&&this.apiDataCache.set(n+"-"+t.i,l);continue}let p=4==r.answerType&&r.answerResult?this.commonService.willDeleteParseJson(r.answerResult):[],f="text";if(1===r.isImage&&(f=this.commonService.willDeleteParseJson(r.content||"")[0].url?"image":f),"image"===f){let s=this.commonService.willDeleteParseJson(r.content||""),i=s[0].metaData,l={renderedStr:"",label:"",attachments:r.attachments,quest:{isFixAns:1==r.isFixAns,label:0,parts:[],answers:i&&i.answers?i.answers.map(t=>{var n;return{label:t.label,isCorrect:-1!==(null===(n=r.answerResult)||void 0===n?void 0:n.indexOf(t.label)),parts:[]}}):(null!==(h=this.commonService.willDeleteParseJson(null!==(c=r.answerConfig)&&void 0!==c?c:"").answer)&&void 0!==h?h:[]).map(t=>{var n;return{label:t,isCorrect:-1!==(null===(n=r.answerResult)||void 0===n?void 0:n.indexOf(t)),parts:[]}})},strAns:p.length>0?p:void 0,answers:[],v:i?"pdf-2-0":"pdf-1-0",id:r.id,meta:x};l.originCorrectAns=l.quest.answers.filter(t=>t.isCorrect).map(t=>t.label).join(),r.tags&&(l.tag=r.tags.map(t=>({id:t.id,code:t.code,viName:t.viName,enName:t.enName})));let a=fe.G.generateIdRequired(10);this.loadingManager.set(a,s[0].url),this.loadImage(s[0].url,this.cdnService).then(i=>{this.processImageQuestion(i,s,l),r.answerMedia?this.loadImageToBase64(r.answerMedia,this.cdnService).then(n=>{l.helpRenderedStr=n,t.call(l)}):t.call(l),this.apiDataCache&&this.apiDataCache.set(n+"-"+t.i,l),this.loadingManager.delete(a)}).catch(n=>{l.renderedStr="Load image error",t.call(l),this.loadingManager.delete(a)})}else{let s=this.commonService.willDeleteParseJson(r.content||"[]"),i=this.commonService.willDeleteParseJson(r.answerConfig||"[]"),l={renderedStr:"",label:"",attachments:r.attachments,quest:{isFixAns:1==r.isFixAns,label:0,parts:[],answers:i?i.map(t=>{var n;return{label:t.key,isCorrect:-1!==(null===(n=r.answerResult)||void 0===n?void 0:n.indexOf(t.key)),parts:[]}}):[]},strAns:p.length>0?p:void 0,answers:[],v:"docx",id:r.id,meta:x};l.originCorrectAns=l.quest.answers.filter(t=>t.isCorrect).map(t=>t.label).join(),s.length>0&&(l.renderedStr=s[0].content),r.answerMedia&&(l.helpRenderedStr=r.answerMedia),r.tags&&(l.tag=r.tags.map(t=>({id:t.id,code:t.code,viName:t.viName,enName:t.enName}))),l.answers=l.quest.answers.map((t,n)=>({renderedStr:i[n].content,ans:t})),this.apiDataCache&&this.apiDataCache.set(n+"-"+t.i,l),t.call(l)}}null===(r=this.apiCallbackCache)||void 0===r||r.delete(n)}setCallback(t){this.callBack=t}setApiCache(t){this.apiCallbackCache=t}processImageQuestion(t,n,s){let i=n[0].metaData;if(i){let n={x:0,y:0,w:i.question.width,h:i.question.height},r=i.question.height;i.answers&&i.answers.forEach((i,l)=>{let a="";if(1!==i.width||1!==i.height){let s=this.cropImageWithPos({x:i.x,y:i.y,w:i.width,h:i.height},{x:i.remove.x,y:i.remove.y,w:i.remove.width,h:i.remove.height},t);s.classList.add("qv_ats_image"),r>i.y&&(n.h=i.y,r=i.y),a=s.outerHTML}s.answers.push({renderedStr:a,ans:s.quest.answers[l]})}),n.h<5&&(n.h=1,n.h=1);let l=this.cropImageWithPos(n,{x:i.question.remove.x,y:i.question.remove.y,w:i.question.remove.width,h:i.question.remove.height},t,!0);l.classList.add("qv_qts_image"),s.renderedStr=l.outerHTML,s.meta&&(s.meta.heightLabel=this.calculateHeightLabel(t,i.question.remove))}else s.renderedStr=t.outerHTML}cropImageWithPos(t,n,s,i,r){let l=document.createElement("canvas");l.width=t.w,l.height=t.h;let a=l.getContext("2d"),c=document.createElement("img");null==a||a.drawImage(s,t.x,t.y,t.w,t.h,0,0,t.w,t.h),a&&(a.fillStyle="#fff"),null==a||a.fillRect(n.x-t.x,n.y-t.y,n.w,n.h);let h=tn.rj.cropCanvas(l,void 0);return r?h:(c.src=h.toDataURL(),c.style.width=h.width*this.ratioImage+"px",c)}calculateHeightLabel(t,n){return this.cropImageWithPos({x:n.x,y:n.y,w:n.width,h:n.height},{x:0,y:0,w:0,h:0},t,!1,!0).height}constructor(t,n,s,i,r,l,a,c,h,d){super(),this.cdnService=t,this.commonService=n,this.callBack=s,this.apiCallbackCache=i,this.editor=r,this.onError=l,this.loadedQuestIds=a,this.apiDataCache=c,this.matrixData=h,this.discoveryService=d,this.getOne=!1,this.trans={err_empty_quest:""},this.trans.err_empty_quest="lang_auto_khong_tai_duoc_cau_hoi_tu_ngan_hang"}}class R extends Z{render(t,n,s,i){if(0>t.indexOf("@[]"))return i&&i(),t;let r,l=/@\[\]\{[^@]+\}@\[\]/g,a=t,c=new Map;for(;null!==(r=l.exec(t));){var h;let t=r[0],n=t.split("@[]")[1],s=this.commonService.willDeleteParseJson(n),i=s.link,l=m.G.generateIdRequired(10);a=a.replace(t,"<div id='".concat(l,"' class='img-docx skeleton-box-loading' style='width: ").concat(s.data.width*this.ratioImage,"px;height: ").concat(s.data.height*this.ratioImage,"px'></div>")),c.has(i)?null===(h=c.get(i))||void 0===h||h.push({id:l,data:s.data}):c.set(i,[{id:l,data:s.data}])}return this.startLoadImage(c).then(()=>{i&&i()}).catch(t=>{this.callbackFall&&this.callbackFall(t)}),a}startLoadImage(t){return new Promise((n,s)=>{var i=0;t.size>0?t.forEach((r,l)=>{this.loadImage(l,this.cdnService).then(l=>{if(this.processImageQuestion(l,r,s),this.loadingManager.delete(l.id),this.callBack)for(let t of r)this.callBack(t.id,t.renderStr);++i===t.size&&n()}).catch(()=>{let t=l.split("/");s(new O("LOAD_IMAGE",[t[t.length-1]],"lang_testbank_render_cant_download_the_image"))})}):n()})}processImageQuestion(t,n,s){n.forEach(n=>{try{var i;let s=document.createElement("canvas");n.data.width=-1===n.data.width?t.width:n.data.width,n.data.height=-1===n.data.height?t.height:n.data.height,s.width=n.data.width,s.height=n.data.height,null===(i=s.getContext("2d"))||void 0===i||i.drawImage(t,n.data.x,n.data.y,n.data.width,n.data.height,0,0,s.width,s.height);let r=this.isCropImage?e.rj.cropCanvas(s):s;r=this.isCanvasEmpty(r)?s:r,n.renderStr="<img id='".concat(n.id,"' class='img-docx' alt='error...' src='").concat(r.toDataURL(),"' style='width: ").concat(r.width*this.ratioImage,"px;height: auto'>")}catch(i){let n=t.src;return void s(new O("CROP_IMAGE",[n[n.length-1]],"Kh\xf4ng cắt được nội dung trong h\xecnh ảnh"))}})}isCanvasEmpty(t){let n=document.createElement("canvas");return n.width=t.width,n.height=t.height,t.toDataURL()===n.toDataURL()}constructor(t,n,s,i,r){super(),this.cdnService=t,this.commonService=n,this.configRenderService=s,this.callBack=i,this.callbackFall=r}}class O{constructor(t,n,s,i){this.type=t,this.data=n,this.message=s,this.questionNumber=i}}class H extends Z{convertMath(t){var n=t.replace(/\>(log|tan)\</g,">\\$1<").replace(//g,"");return document.createElement("span").innerHTML=t,MathML2LaTeX.convert(n)}render(t,n,s){let i=t,r=i.matchAll(/\[!m:\$(([^\]]|[^\$]\])+)\$\]/g);for(;;){let t=r.next();if(t.done)break;let n=t.value[0],s=t.value[1],l=this.mathMap.get(s),a="",c=document.createElement("span");c.classList.add("ql-formula"),c.setAttribute("data-value",this.convertMath(l.str)),a=c.outerHTML,i=i.replace(n,a)}return i}constructor(t){super(),this.mathMap=t}}t.exports=class{parseDocx(t){this.getLstQuestWithFile(t,[]).then(t=>{this.convertDocx(t)})}convertDocx(t){let{lstQuest:n}=t,s=[],i=[];n.forEach((t,n)=>{let{quest:l}=t;if(l.isGroup)s.push({id:r(7),quizId:this.quizId,questions:[],content:t.renderedStr,title:"",audios:[]});else{var a,c;s.length||l.group||s.push({id:r(7),quizId:this.quizId,questions:[],content:"",title:"",audios:[]});let n=s[l.group-1||0],h={id:r(7),content:"<p>".concat(t.renderedStr,"</p>"),quizId:this.quizId,groupId:n.id,label:"C\xe2u",number:l.label,type:1==t.type?"TN":"TL",options:t.answers.map(t=>({text:"<p>".concat(t.renderedStr,"</p>"),keys:t.ans.isCorrect})),explain:"<p>".concat(t.helpRenderedStr||"","</p>"),level:t.tag,shuffle:!!l.isFixAns};t.answers.filter(t=>t.ans.isCorrect).length>1&&(h.type="HK"),t.answers.filter(t=>{var n;return(null===(n=t.ans.label)||void 0===n?void 0:n.charCodeAt(0))>=97}).length&&(h.type="TF"),/(^\d.*\d$|^\d$)/g.test(null==t?void 0:null===(a=t.helpRenderedStr)||void 0===a?void 0:a.trim())&&(h.type="DT",h.explain="",h.options=[{text:null==t?void 0:null===(c=t.helpRenderedStr)||void 0===c?void 0:c.trim()}]),n.questions.push(h.id),i.push(h)}}),i=i.map((t,n,s)=>{var r=0;return"TF"==t.type&&(r=1),"TN"==t.type&&(r=.25),"DT"==t.type&&(18==s.filter(t=>"TN"==t.type).length&&(r=.25),12==s.filter(t=>"TN"==t.type).length&&(r=.5)),i.length===s.filter(t=>"TN"==t.type).length&&(r=(10/i.length).toFixed(2)),{...t,point:r}}),this.callback({status:"done",data:{groups:s,questions:i,quizId:this.quizId}})}getLstQuestWithFile(t,n,s){return new Promise((r,d)=>{let u=new l,x=[],p=new Map,f=[],g=[],v=1;u.handleFileSelect(t,t=>{for(let n of t.data)if("img"==n.type)x.push({id:n.key,link:n.value,cssStyle:n.cssStyle}),n.cssStyle&&n.cssStyle.split(";").length>2&&f.push(["^\\[img:\\$".concat(n.key,"\\$\\]"),"[img:$".concat(n.key,"$]\n")]);else if("mathml"==n.type){let t=+n.key.split("_")[1];p.set(n.key,{id:t,str:n.value,raw:n.docx,lineIdx:0,startCol:0,endCol:0}),t>v&&(v=t)}for(let n of(v++,t.lines)){if(0==n.length)continue;let t="";for(let s of(t=Array.isArray(n[0])&&Array.isArray(n[n.length-1])&&Array.isArray(n[Math.floor(n.length/2)])?"[* "+n.map(t=>t.map(t=>t.join("").replaceAll("\n","\\n")).join("\\n")).join(" | ")+" *]":n.join(""),f))t=t.replaceAll(RegExp(s[0],"g"),s[1]);for(let n of t.split("\n"))g.push(n)}new c().process(g);let l=this.processStyle(g);this.processMath(l,p),new a().process(l);let d=new h(this.cropPdfParams);d.setLines(l);let u=d.parse(),b=new i.Task(8);for(let t=0;t<u.length;t++)b.addTask(this,this.renderQuest,[n,p,x,u[t],t,s]);b.start().then(t=>{setTimeout(()=>{r({lstQuest:n,mathMap:p,images:x})},10*x.length)})})})}processLevel(t){let n=/^\s*#(\d)\s*\[[A-Z0-9\-\[\]\$!:b]+\]/g,s=["NB","TH","VD","VDC"],i=0,r=!1,l=1;for(let a of t){let c=a.matchAll(n).next();if(!c.done){let n=+c.value[1]-1;n<s.length&&(t[i]=a.replace(c.value[0],"C\xe2u ".concat(l++,". (").concat(s[n],")"))),r=!0}r&&"GY"==a.trim()&&(t[i]="Lời giải"),i++}}hasStyleAns(t,n,s){if(!n)return"";for(let t of s.filter(t=>t.lineIdx==n.lineIdx&&t.s<=n.b&&t.e>=n.b))if(t.style.indexOf("!u")>=0||t.style.indexOf("!b")>=0||t.style.indexOf("!hl")>=0)return t.style;return""}applyStyle(t,n,s){for(let r=n.length-1;r>=0;r--){let l=n[r],a=s.filter(t=>t.lineIdx==l.lineIdx&&t.e>=l.s);for(let n=a.length-1;n>=0;n--){var i;let s=a[n].s>=l.s?a[n].s:l.s,r=a[n].e<=(null!==(i=l.e)&&void 0!==i?i:9999999)?a[n].e:l.e,c=a[n].style.replaceAll("!hl","");if(s<r&&""!=c){let n=t[l.lineIdx],i=n.substring(s,r);""!=i.trim()&&(t[l.lineIdx]=n.substring(0,s)+"["+c+":$"+i+"$]"+n.substring(r))}}}}processUnderlineAns(t){let n=/\[[!bihl]*[!u]+[!bihl]*:\$(([^\$]|\$[^\]])+)\$\]/g,s=0,i=[];for(let r of t){if(/^[ABCD\.\s\t\*]+$/.test(r)&&""!=r.trim()&&s>0){let l=r,a=(l=l.replaceAll(/[\s\t\.]+/g,"")).indexOf("*"),c=0;if(l=l.replaceAll(/[\*]+/g,""),"ABCDEFGH".indexOf(l)>=0){let r=t[s-1].match(n);if(r&&l.length==r.length){for(let n of r)t[s-1]=t[s-1].replace(n,n.replace(/\[[!bihl]*[!u]+[!bihl]*:\$/g,"[".concat(a==c?"*":"").concat(l.substring(0,1),":")).replace("$]","]")),i[i.length-1]=t[s-1],l=l.substring(1),c++;s++;continue}}}i.push(r),s++}return i}processStyle(t){var n;let s=/\[![!ibuchl]+:\$(([^\$]|\$[^\]])+)\$\]/g,i=/^\s*\[\*\s*[AC]\.[^\|]+\|\s*[BD]\..*\*\]\s*$/g,r=[],l=0;for(let n of t){if(i.test(t[l].replaceAll(s,"$1"))&&(t[l]=t[l].replaceAll("[*","").replaceAll("*]","").replaceAll("|"," ").trim(),n=t[l]),n){let i,a=n.matchAll(s),c=0;for(;;){let t=a.next();if(t.done)break;let n=t.value[0],s=n.indexOf(":"),h=n.substring(1,s),d=t.value.index-c,u=d+t.value[1].length;i&&d==i.e&&i.style==h?i.e=u:(i={lineIdx:l,s:d,e:u,style:h},r.push(i)),c+=s+4}t[l]=n.replaceAll(s,"$1")}l++}let a=new h(this.cropPdfParams);a.setLines(t);let c=a.parse(),d=[],u=new Map,x=0;for(let n of c){for(let t of(x++,n.parts))d.push(t);for(let s of n.answers){let i=this.hasStyleAns(t,s.parts[0],r);for(let t of(""!=i&&u.set("".concat(n.label,"-").concat(n.group,"-").concat(s.label,"-").concat(x),i),s.parts))d.push(t)}}for(let t of c)if(t.help)for(let n of t.help)d.push(n);this.applyStyle(t,d,r),a.setLines(t);let p=[];for(let t of(x=0,c=null!==(n=a.parse())&&void 0!==n?n:[])){x++;let n=new Map;if(!(t.answers.filter(t=>t.isCorrect).length>0)){for(let s of t.answers){let i=u.get("".concat(t.label,"-").concat(t.group,"-").concat(s.label,"-").concat(x));i&&""!=i&&n.set(i,n.has(i)?void 0:s.parts[0])}for(let t of n)if(t[1]){p.push(t[1]);break}}}for(let n=p.length-1;n>=0;n--){let s=p[n];t[s.lineIdx]=t[s.lineIdx].substring(0,s.b)+"*"+t[s.lineIdx].substring(s.b)}return t=this.processUnderlineAns(t),c.length>0?t.slice(c[0].parts[0].lineIdx):t}processMath(t,n){let s=0;for(let i of t){let t=i.matchAll(this.MATH_PAT);for(;;){let i=t.next();if(i.done)break;let r=i.value[0],l=n.get(i.value[1]);l&&(l.lineIdx=s+1,l.startCol=i.value.index+1,l.endCol=l.startCol+r.length)}s++}}getLoadedIds(t){var n;return t.filter(t=>t.id&&t.id>0).map(t=>null!==(n=t.id)&&void 0!==n?n:0)}getIncludeIds(t,n){return[]}renderStr(t,n,s,i,r,l,a,c){let h=!(arguments.length>8)||void 0===arguments[8]||arguments[8],d=h?i.replaceAll(/<([\/!a-zA-Z])/g,"&lt;$1").replaceAll(/&lt;([ubi])>/g,"<$1>").replaceAll(/&lt;[\/]([ubi])>/g,"</$1>").replaceAll("&lt;br>","<br>").replaceAll("<&lt;","&lt;&lt;").replaceAll("<&lt;","&lt;&lt;").replaceAll("<&lt;","&lt;&lt;"):i,u=[new A,new P(this.cdnService),new S,new N,new k,new _,new H(n),new L,new R(this.cdnService,this.commonService,this.configRenderService,l),new M(this.cdnService,this.commonService,a,this.apiCallbackCache,this.aztEditor,c,this.getIncludeIds(t),this.apiDataCache,this.matrixLoadedData)];for(let t of("link"==r&&(u=[new R(this.cdnService,this.commonService,this.configRenderService,l)]),"help"==r&&u.pop(),u))t.setLoadingManager(this.loadingManager),d=t.render(d,s,this.questionService);return d}upperFirst(t){return t?t.charAt(0).toUpperCase()+t.slice(1):""}parseExtra(t){if(t.startsWith("[@"))return{val:"",idx:0,id:t};let n=t.matchAll(/\[!info:\d+\]/g),s="",i=0;for(;;){let t=n.next();if(t.done)break;s=t.value[0],i=t.value.index;break}if(""==s)return{val:"",idx:0,id:"0"};let r=s.replace("[!info:","").replace("]","").trim();return{val:s,idx:i,id:r}}fillImg(t,n,s,i){let r=RegExp("<div id='"+s+"'[^>]+></div>","g"),l=t[n];for(let t of(l.renderedStr=l.renderedStr.replace(r,null!=i?i:""),l.answers))t.renderedStr=t.renderedStr.replace(r,null!=i?i:"");l.helpRenderedStr&&(l.helpRenderedStr=l.helpRenderedStr.replace(r,null!=i?i:""))}fillError(t,n,s){t[n].err="<span style='color:red'>".concat(s,"</span>")}parseTag(t){let n=t.trim(),s=n.matchAll(/^(\[!info:\d+\]\s*)?(\[[iubchl!]+:\$\s*)?[\[\(]\s*(VD|TH|NB|VDC|EASY|MEDIUM|HARD|HARDEST)\s*[\d\.]*\s*[\)\]]/g).next();return s.done?["",n]:(n=n.replace(/[\[\(]\s*(VD|TH|NB|VDC|EASY|MEDIUM|HARD|HARDEST)\s*[\d\.]*\s*[\)\]]\s*[:.]?/g," "),[s.value[3],n])}renderQuest(t,n,s,i,r,l){return new Promise(a=>{var c,h,d,u;let x=3;i.answers.length>0&&(x=1),0==i.answers.length&&i.strAns&&(x=4);let p=(n,s)=>{console.log("nvanh fill image ",t.length,n,s),this.fillImg(t,r,n,s)},f=t=>{console.log("nvanh fill quest ",r,t)},g=n=>{this.fillError(t,r,n)},v=i.parts.map(t=>null!==(c=t.text)&&void 0!==c?c:"").join("<br>").trim(),b=this.parseExtra(v),j=this.parseTag(v);""!=j[0]?v=j[1]:i.help&&i.help.length>0&&(j=this.parseTag(null!==(h=i.help[0].text)&&void 0!==h?h:"")),""!=b.val&&(v=v.substring(0,b.idx)+v.substring(b.idx+b.val.length));let y=i.help?i.help.map(t=>null!==(d=t.text)&&void 0!==d?d:"").join("<br>").trim():void 0,C={renderedStr:this.renderStr(t,n,s,v,"full",p,f,g),quest:i,type:x,tag:j[0]||"",strAns:i.strAns?i.strAns.split(/[\|]/).map(t=>t.trim()):void 0,label:this.upperFirst(null!==(u=i.olabel)&&void 0!==u?u:""),helpRenderedStr:y?this.renderStr(t,n,s,y,"full",p,f,g):void 0,answers:i.answers.map(i=>{var r;let l=i.parts.map(t=>null!==(r=t.text)&&void 0!==r?r:"").join("<br>").trim();return{renderedStr:this.renderStr(t,n,s,l,"full",p,f,g),ans:i}})};if(C.renderedStr.startsWith("Loading...|")){let t=C.renderedStr.split("|");if(0>t[1].indexOf(",")){let n=+t[1];n>0&&(C.id=n)}C.renderedStr=t[0]}t[r]=C,l&&l(C),a(C)})}constructor(t,n){this.quizId=t,this.callback=n,this.loadingManager=new Map,this.MATH_PAT=/\[!m:\$([^\$\]]+)\$\]/g,this.cropPdfParams={RENDER_SCALE:2,LINE_SMALL_HEIGHT:8,SPLIT_MARGIN:3,INTERSEC_MARGIN:10,LINE_MAGIN:2,MARGIN_LEFT:2,ENABLE_IMAGE_PROCESS:!0,STEP_SIZE:3,CROP_FULL_WIDTH:!0,OVERLAP:.5,QUESTION_PATTERN:["(^c\xe2u\\s*\\d{1,4}[^0-9])","(^câu\\s*\\d{1,4}[^0-9])","(^c\xa9u\\s*\\d{1,4}[^0-9])","(^ca‚u\\s*\\d{1,4}[^0-9])","(^b\xe0i\\s*\\d{1,4}[^0-9])","(^bài\\s*\\d{1,4}[^0-9])","(^cau\\s*\\d{1,4}[^0-9])","(^bai\\s*\\d{1,4}[^0-9])","(^question\\s*\\d{1,4}[^0-9])","(^questions\\s*\\d{1,4}[^0-9])","(^\\[\\d{1,4}\\][^0-9])","(^\\d+\\s*\\(nb\\))","(^\\d+\\s*\\(th\\))","(^\\d+\\s*\\(vd\\))","(^\\d+\\s*\\(vdc\\))","(^c\xe2u\\s*\\d{1,4}[\\s\\.:]*$)","(^câu\\s*\\d{1,4}[\\s\\.:]*$)","(^c\xa9u\\s*\\d{1,4}[\\s\\.:]*$)","(^ca‚u\\s*\\d{1,4}[\\s\\.:]*$)","(^b\xe0i\\s*\\d{1,4}[\\s\\.:]*$)","(^bài\\s*\\d{1,4}[\\s\\.:]*$)","(^cau\\s*\\d{1,4}[\\s\\.:]*$)","(^bai\\s*\\d{1,4}[\\s\\.:]*$)","(^questions\\s*\\d{1,4}[\\s\\.:]*$)","(^question\\s*\\d{1,4}[\\s\\.:]*$)"],QUESTION_PATTERN2:["(^(\\d+\\s*\\.)\\s*[\\.0-9])","(^(\\d+\\s*\\.)\\s*\\(\\s*\\d+\\s*\\))","(^(\\d+\\s*\\.)\\s*[^\\s]\\s*[^\\s0-9])","(^\\d+\\s*\\.\\s*$)"],BREAK_LINE_PATTERN:["(^C\xe2u\\s*\\d+\\s*[:\\.]\\s*[Aa]\\s*\\.)","(^C\xa9u\\s*\\d+\\s*[:\\.]\\s*[Aa]\\s*\\.)","(^B\xe0i\\s*\\d+\\s*[:\\.]\\s*[Aa]\\s*\\.)","(^Cau\\s*\\d+\\s*[:\\.]\\s*[Aa]\\s*\\.)","(^Bai\\s*\\d+\\s*[:\\.]\\s*[Aa]\\s*\\.)","(^Question\\s*\\d+\\s*[:\\.]\\s*[Aa]\\s*\\.)","(^\\d+\\s*[:\\.]\\s*[Aa]\\s*\\.)"],SECTION_PATTERN_LOWER:["(^mark\\s*the\\s*letter)","(^read\\s*the\\s*follow)","(^reading\\s*the\\s*follow)","(^read\\s*the\\s*text)","(^read\\s*the\\s*passage)","(^read\\s*the\\s*paragraph)","(^read\\s*and\\s*choose)","(^put\\s*these\\s*word)","(^supply\\s*the\\s*correct)","(^make\\s*questions?\\s*for)","(^fill\\s*in\\s*the\\s*blank)","(^fill\\s*in\\s*each\\s*numbered)","(write\\s*the\\s*months\\s*in\\s*english)","(write\\s*the\\s*telephone\\s*numbers\\s*in\\s*english)","(^which\\s*of\\s*the\\s*following)","(^choose\\s*the\\s*suitable\\s*word)","(^choose\\s*the\\s*word)","(^choose\\s*the\\s*option)","(^choose\\s*the\\s*item\\s*among)","(^choose\\s*the\\s*underlined\\s*word)","(^combine\\s*two\\s*sentences)","(^each\\s*of\\s*the\\s*following)","(^finish\\s*the\\s*second\\s*sentence)","(^identify\\s*the\\s*underlined)","(^identify\\s*a\\s*mistake)","(^indicate\\s*the\\s*word)","(^indicate\\s*the\\s*correct)","(^indicate\\s*the\\s*sentence)","(^indicate\\s*the\\s*underlined)","(^circle\\s*the\\s*underlined)","(^circle\\s*the\\s*word\\s*whose\\s*underlined)","(^choose\\s*the\\s*underlined)","(^\\*?find\\s*the\\s*word)","(^find\\s*a\\s*mistake)","(^fill\\s*the\\s*circle)","(^listen\\s*to.*conversation)","(^there\\s*are.*blanks\\s*in\\s*the\\s*passage\\s*below)","(^listen\\s*to\\s*the\\s*recording)","(^listen\\s*and\\s*circle)","(^listen\\s*again\\s*and\\s*choose)","(^\\*?listen\\s*and\\s*complete)","(^\\*?choose\\s*the\\s*best)","(^choose\\s*the\\s*correct)","(^put\\s*in\\s*the\\s*correct)","(^complete\\s*the\\s*second\\s*sentence)","(^complete\\s*the\\s*sentences)","(^give\\s*the\\s*correct\\s*form)","(^mark\\s*a,\\s*b,)","(^circle\\s*the\\s*letter)","(^you\\s*will\\s*hear)","(^blacken\\s*the\\s*letter)","(^đọc\\s*đoạn\\s*tr\xedch)","(^dựa\\s*v\xe0o\\s*th\xf4ng\\s*tin\\s*dưới\\s*đ\xe2y)","(^dựa\\s*v\xe0o\\s*c\xe1c\\s*th\xf4ng\\s*tin\\s*được\\s*cung\\s*cấp\\s*dưới\\s*đ\xe2y)","(^section\\s*[0-9abcdefghivx]+)","(^part[^a-z]+[0-9abcdefghivx]+\\s*[\\.:\\-])","(^phần\\s*[0-9abcdefivx]+[\\.:])","(^nh\xf3m\\s*[0-9abcdefivx]+[\\.:])","(^chương\\s*[0-9abcdefivx]+[\\.:])","(^questions?\\s*\\d+\\s*[\\–\\-to]+\\s*\\d+)","(^passage\\s*[0-9abcdefghivx]+)","(^use\\s*the\\s*word\\s*given\\s*in\\s*capitals)","(^tự\\s*luận)"],SECTION_PATTERN_NORMAL:["(^[IVX]+\\s*[\\.\\-\\–]\\s*[A-Z\xc0Ả\xc3\xc1ẠĂẰẲẴẮẶ\xc2ẦẨẪẤẬĐ\xc8ẺẼ\xc9Ẹ\xcaỀỂỄẾỆ\xccỈĨ\xcdỊ\xd2Ỏ\xd5\xd3Ọ\xd4ỒỔỖỐỘƠỜỞỠỚỢ\xd9ỦŨ\xdaỤƯỪỬỮỨỰỲỶỸ\xddỴ]+)","(^[\\d]+\\.[\\d]+\\.[\\d]*\\.*\\s*[A-Z\xc0Ả\xc3\xc1ẠĂẰẲẴẮẶ\xc2ẦẨẪẤẬĐ\xc8ẺẼ\xc9Ẹ\xcaỀỂỄẾỆ\xccỈĨ\xcdỊ\xd2Ỏ\xd5\xd3Ọ\xd4ỒỔỖỐỘƠỜỞỠỚỢ\xd9ỦŨ\xdaỤƯỪỬỮỨỰỲỶỸ\xddỴ]+)","(^[IVX]+\\s*[\\.:]\\s*$)"],KICK_PATTERN:["(^Chọn\\s*[ABВCDEFGHIJK]+)","(^Chon\\s*[ABВCDEFGHIJK]+)"],TVCN_CHAR:[["Α","A"],["В","B"]],HET_PATTERN:["(HẾT)","(H\xcáT)","(HET)","(\\-\\-HT\\-\\-)","(THE\\s*END)","(The\\s*end[^a-z0-9]*$)","(^[^A-Za-z]*Hết[^A-Za-z]*)$"],DAPAN_PATTERN:["(\xc1P \xc1N)","(\xc1P \xc1)","(\xc1P\xc1N)","(ÁP ÁN)","(BẢNG\xc1\xc1)","(KHO\xc1\\s*C\xc2U\\s*TRẮC\\s*NGHIỆM)","(ÁPÁN)","(ANSWER KEYS)","(^KEYS$)","(Bảng\\s*đ\xe1p\\s*\xe1n)","(Đ\xe1p\\s*\xe1n\\s*v\xe0\\s*hướng)","(Dap\\s*an\\s*va\\s*huong)","(Đ\xe1p\\s*\xe1n\\s*[.:]\\s*$)","(Đ\xe1p\\s*\xe1n\\s*$)"],HUONGDAN_PATTERN:["(HƯỚNG\\s*DẪN)","(ƯỚNG\\s*DẪN\\s*GIẢI\\s*CHI)","(GIẢI\\s*TH\xcdCH\\s*CHI\\s*TIẾT)","(Hướng\\s*dẫn\\s*giải)","(Lời\\s*giải)","(LỜI\\s*GIẢI)","(GIẢI\\s*CHI\\s*TIẾT)","(HD:)","(GLOSSARY)","Lời\\sgiải"],MULTIPLE_ANS_PATTERN:["([ABCDEFGH]\\s*v\xe0\\s*[ABCDEFGH]\\s*đều)","(Cả\\s*[ABCDEFGH]\\s*v\xe0\\s*[ABCDEFGH])","(Cả\\s*[ABCDEFGH]\\s*,\\s*[ABCDEFGH])","(Cả\\s*3\\s*đ\xe1p\\s*\xe1n)","(Cả\\s*đ\xe1p\\s*\xe1n)","(Tất\\s*cả\\s*đ\xe1p\\s*\xe1n)","(Kết\\s*quả\\s*kh\xe1c)","(Đ\xe1p\\s*\xe1n\\s*kh\xe1c)","(Đ\xe1p\\s*\xe1n\\s*[ABCDEFGH]\\s*v\xe0\\s*[ABCDEFGH])","(Tất\\s*cả\\s*đều)"],DRAW_RESULT:"",SKIP_CHAR:["","√","p","(",")","[","]","{","}",""],FOOTER_PATTERN:["(trang\\s*\\d+)","(Page\\s*\\d+)","(Trang\\s*\\d+)","(TRANG\\s*\\d+)","(^\\d{1,4}$)","(^[\\-\\s]*\\d{1,4}[\\-\\s]*$)"],HELP_ANS_PATTERN:["([\\s\\.]*Chọn\\s*([A-K]))","([\\d\\s\\.:]*Đ\xe1p\\s*\xe1n\\s*([A-K]))","([\\d\\s\\.:]*Đ\xe1p\\s*\xe1n\\s*l\xe0\\s*([A-K]))","([\\d\\s\\.:]*Chọn\\s*đ\xe1p\\s*\xe1n\\s*([A-K]))"],RES_ANS_PATTERN:["(\\d+[.-][^|0-9])"],STRANS_SPLIT:"|/\\"}}}},9716:function(t,n,s){"use strict";Object.defineProperty(n,"__esModule",{value:!0});let i=s(1117);class r{on(){this.isOn=!0}off(){this.isOn=!1}process(t,n,s,i,r,l){return this.isOn?this.parse(t,n,s,i,r,l):[]}constructor(){this.isOn=!0,this.TYPE="default"}}class l extends r{parse(t,n,s,i,r,l){var a=this.matchPos(n.strLine);if(a.value){let t=null;for(let n=a.value.length-1;n>=0;n--)if(a.value[n]){t=a.value[n];break}if(null==t)return[];let i=t.matchAll(/\d+/g).next(),c=t.length;i.done||t.trim().endsWith(".")||t.trim().endsWith(":")||(c=i.value.index+i.value[0].length);let h=n.strLine.replace(/\|/g,"").toLowerCase().indexOf(t)+c-1;return[{str:this.getNumberFromStr(t),pageIndex:n.pageIndex,lineIndex:s,transform:n.transform,startLeft:v.calIndexPos2(n.textObjs,r,l,h,!0),type:this.TYPE}]}return[]}matchPos(t){let n=t.replace(/\|/g,"").toLowerCase().trim();if(0==this.questType){let t=i.PdfConst.QUESTION_PATTERN.join("|");return n.matchAll(t).next()}{let t=i.PdfConst.QUESTION_PATTERN2.join("|");return n.matchAll(t).next()}}getNumberFromStr(t){var n=t.match(/(\d+)/);return n?n[0]:""}static getRemoveBox(t,n){let s=t.startLeft?t.startLeft[5]:n[t.lineIndex].top,r=t.transform[4]-i.PdfConst.MARGIN_LEFT,l=t.startLeft?t.startLeft[5]+t.startLeft[3]:n[t.lineIndex].bottom;return{pageIndex:t.pageIndex,top:s||20,left:r,heigh:l&&s?l-s:0,width:(t.startLeft?t.startLeft[4]:0)-r}}static getBoxes(t,n,s,r){let l=r;for(let s=t.lineIndex;s<n.length;s++)if(v.isLastLineOfPage(s,n)){let t=n[s].isFooter?n[s-1]:n[s];l=t.transform[5]+t.height+20;break}let a=[],c=t.pageIndex,h=s?s.lineIndex:n.length-1,d=n[t.lineIndex].transform[4]-i.PdfConst.MARGIN_LEFT,u=n[t.lineIndex].top;if(!u)return[];let x=i.PdfConst.CROP_FULL_WIDTH?v.getMaxLineRight(-1,n)+2*i.PdfConst.MARGIN_LEFT:n[t.lineIndex].transform[4]+n[t.lineIndex].width+2*i.PdfConst.MARGIN_LEFT,p=l,f=c,g=t.lineIndex+1;for(;g<=h;g++){let t=n[g].top;if(g!=n.length-1||s||(t=n[g].bottom),!i.PdfConst.CROP_FULL_WIDTH){let t=n[g-1].transform[4]+n[g-1].width+2*i.PdfConst.MARGIN_LEFT;t>x&&(x=t)}let r=n[g-1].transform[4]-i.PdfConst.MARGIN_LEFT;r<d&&(d=r),n[g].isFooter&&t?p=t:(n[g].pageIndex>f&&(n[g-1].isFooter||(p=l),a.push({pageIndex:f,top:u,left:d,width:x-d,heigh:p-u}),u=20,d=v.getMinLineLeft(n[g].pageIndex,n)-i.PdfConst.MARGIN_LEFT),f=n[g].pageIndex,t&&(p=t))}if(g-=1,!s&&v.isLastLineOfPage(g,n)){let t=n[g].isFooter?n[g-1]:n[g];p=t.transform[5]+t.height+20}return v.isFirstLineOfPage(g,n)||a.push({pageIndex:f,top:u,left:d,width:x-d,heigh:p-u}),a}constructor(t){super(),this.TYPE=l.TYPE_NAME,this.questType=t}}l.TYPE_NAME="question";class a extends r{parse(t,n,s,r,a,c){let h=n.strLine.replace(/\|/g,"").toLowerCase().trim().match(i.PdfConst.SECTION_PATTERN_LOWER.join("|")),d=null!=h&&h.length>0;if(d||(d=null!=(h=n.strLine.replace(/\|/g,"").trim().match(i.PdfConst.SECTION_PATTERN_NORMAL.join("|")))&&h.length>0),d&&h){let i=n.strLine.indexOf(h[0])+h[0].length+1,r=[h[0][0]];for(let n=t.length-1;n>=0;n--){if(t[n].type==l.TYPE_NAME){r.push(".Q");break}r.push(t[n].str[0])}return"HGFEDCBA.Q".endsWith(r.join(""))?[]:[{str:h[0],pageIndex:n.pageIndex,lineIndex:s,transform:n.transform,startLeft:v.calIndexPos(n.textObjs,a,c,i,!0),type:this.TYPE}]}return[]}static getRemoveBox(t,n){let s=n[t.lineIndex].top,r=t.transform[4]-i.PdfConst.MARGIN_LEFT,l=n[t.lineIndex].bottom;return{pageIndex:t.pageIndex,top:s||20,left:r,heigh:l&&s?l-s:0,width:r-r}}static getBoxes(t,n,s,r){let l=[],a=t.pageIndex,c=s?s.lineIndex:n.length-1,h=v.getMinLineLeft(-1,n)-i.PdfConst.MARGIN_LEFT,d=n[t.lineIndex].top;if(!d)return[];let u=v.getMaxLineRight(-1,n)+2*i.PdfConst.MARGIN_LEFT,x=r,p=a,f=t.lineIndex+1;for(;f<=c;f++){let t=n[f].top;if(n[f].isFooter&&t)x=t;else if(n[f].pageIndex>p&&(l.push({pageIndex:p,top:d,left:h,width:u-h,heigh:x-d}),d=20),p=n[f].pageIndex,t){x=t;break}}return f>=n.length&&(f=n.length-1),v.isFirstLineOfPage(f,n)||l.push({pageIndex:p,top:d,left:h,width:u-h,heigh:x-d}),l}constructor(){super(),this.TYPE=a.TYPE_NAME}}a.TYPE_NAME="section";class c extends r{parse(t,n,s,i,r,l){var a=[],c=this.matchPos(n.strLine,!1);if(0==c.length&&(c=this.matchPos(n.strLine,!0)),c.length>0)for(let t of c)a.push({str:t.value,pageIndex:n.pageIndex,lineIndex:s,transform:v.calIndexPos(n.textObjs,r,l,t.index),startLeft:v.calIndexPos2(n.textObjs,r,l,t.index+1),type:this.TYPE});return a}static getRemoveBox(t,n){let s=t.startLeft?t.startLeft[5]-2:n[t.lineIndex].top,r=t.transform[4]-i.PdfConst.MARGIN_LEFT,l=t.startLeft?t.startLeft[5]+t.startLeft[3]:n[t.lineIndex].bottom;return{pageIndex:t.pageIndex,top:s||20,left:r,heigh:l&&s?l-s:0,width:(t.startLeft?t.startLeft[4]:0)-r}}static getBoxes(t,n,s,r){let l=i.PdfConst.MARGIN_LEFT,a=[],h=n[t.lineIndex].top,d=n[t.lineIndex].bottom;if(!h||!d)return[];let u=d,x=t.transform[4]-l,p=s&&t.lineIndex==s.lineIndex?s.transform[4]-l:n[t.lineIndex].transform[4]+n[t.lineIndex].width+l;if(a.push({pageIndex:t.pageIndex,top:h,left:x,width:p-x,heigh:d-h}),s&&s.lineIndex==t.lineIndex)return a;h=d,d=r,p=0;let f=t.pageIndex,g=0;for(g=t.lineIndex+1;g<n.length;g++){if(d==r&&v.isLastLineOfPage(g,n)){let t=n[g].isFooter?n[g-1]:n[g];d=t.transform[5]+t.height+20}let s=n[g].top;if(g>t.lineIndex+1&&!n[g-1].isFooter){let t=n[g-1].transform[4]+n[g-1].width+l;t>p&&(p=t);let s=n[g-1].transform[4]-l;s<x&&(x=s)}if(n[g].isFooter&&s)g-t.lineIndex>1?(d=n[g-1].transform[5]+n[g-1].height+i.PdfConst.LINE_MAGIN,x=n[t.lineIndex+1].transform[4]-l):d=n[t.lineIndex].bottom;else if(n[g].pageIndex>f&&(d&&d-h>i.PdfConst.LINE_SMALL_HEIGHT&&g-t.lineIndex>1&&a.push({pageIndex:f,top:h,left:x,width:p-x,heigh:d-h}),u=h=20),f=n[g].pageIndex,s){d=s;break}}if(g>=n.length&&(g=n.length-1),g-t.lineIndex>1&&n[g-1].transform[5]>u&&!v.isFirstLineOfPage(g,n)){let s=20==h?n[g].transform[4]:n[t.lineIndex+1].transform[4];d&&d-h>i.PdfConst.LINE_SMALL_HEIGHT&&a.push({pageIndex:f,top:h,left:s,width:p-s,heigh:d-h})}s&&s.type==c.TYPE_NAME&&s.transform[4]>n[s.lineIndex].transform[4]+25*i.PdfConst.RENDER_SCALE&&(p=s.transform[4]-l,h=n[s.lineIndex].top,x=n[s.lineIndex].transform[4]-l,d=n[s.lineIndex].bottom,h&&d&&d-h>i.PdfConst.LINE_SMALL_HEIGHT&&a.push({pageIndex:f,top:h,left:x,width:p-x,heigh:d-h}));for(let t=a.length-1;t>=1;t--)a[t].left-(a[t-1].left+a[t-1].width)>=20*i.PdfConst.RENDER_SCALE&&a.splice(t,1);return a}matchPos(t,n){for(var s=n?t.toUpperCase():t,r=i.PdfConst.ANS_PATTERN,l=RegExp("[\\s\\|\\.]"),a=s.matchAll(r),c=[];;){var h=a.next();if(h.done)break;for(var d=0,u=h.value.index;u<s.length&&l.test(s[u]);u++)d++;let t=h.value[0].substr(d,1);("A"!=t||s.replace(/\|/g,"").trim().startsWith("A"))&&c.push({value:t,index:h.value.index+d})}return c}constructor(){super(),this.TYPE=c.TYPE_NAME}}c.TYPE_NAME="answer";class h extends r{parse(t,n,s,r,l,a){let c=n.strLine.replace(/\|/g,"").trim().match(i.PdfConst.HET_PATTERN.join("|"));return null!=c&&c.length>0?[{str:n.strLine,pageIndex:n.pageIndex,lineIndex:s,transform:n.transform,type:this.TYPE}]:[]}static getBoxes(t,n,s,i){return[]}strContains(t,n){for(let s of n)if(t.indexOf(s)>=0)return!0;return!1}constructor(t){super(),null!=t&&(this.isOn=t),this.TYPE=h.TYPE_NAME}}h.TYPE_NAME="het";class d extends r{parse(t,n,s,r,l,a){let c=n.strLine.replace(/\|/g,"").trim().match(i.PdfConst.DAPAN_PATTERN.join("|"));return null!=c&&c.length>0?[{str:n.strLine,pageIndex:n.pageIndex,lineIndex:s,transform:n.transform,type:this.TYPE}]:[]}static getBoxes(t,n,s,i){return[]}static getAnsFromHelp(t){for(let n of t){let t=n.strLine.replace(/\|/g,"").trim().match(i.PdfConst.HELP_ANS_PATTERN.join("|"));if(null!=t){for(let n=0;n<t.length;n++)if(null!=t[n]&&1==t[n].length)return t[n]}}return""}strContains(t,n){for(let s of n)if(t.indexOf(s)>=0)return!0;return!1}constructor(t){super(),null!=t&&(this.isOn=t),this.TYPE=d.TYPE_NAME}}d.TYPE_NAME="dapan";class u extends r{parse(t,n,s,r,l,a){let c=n.strLine.replace(/\|/g,"").trim().match(i.PdfConst.HUONGDAN_PATTERN.join("|"));return null!=c&&c.length>0?[{str:n.strLine,pageIndex:n.pageIndex,lineIndex:s,transform:n.transform,type:this.TYPE}]:[]}static getBoxes(t,n,s,i){return D.QuestionParser.getBoxes(t,n,s,i)}strContains(t,n){for(let s of n)if(t.indexOf(s)>=0)return!0;return!1}constructor(){super(),this.TYPE=u.TYPE_NAME}}u.TYPE_NAME="huongdan";class x extends r{parse(t,n,s,i,r,l){var a=n.strLine.replace(/\|/g,"").replace(/\s*\.*\-*:*,*;*/g,"");return a=(a=(a=(a=(a=a.replace(/C\xe2u/g,"")).replace(/\u0110\xe1p\xe1n/g,"")).replace(/\u0110\xe1p/g,"")).replace(/\xe1n/g,"")).replace(/\u0110\/A/g,""),/^[0-9ABCDEFGHabcdefgh]+$/g.test(a)&&a.length>=2&&(null==this.firstLine&&(this.firstLine=n,this.lineIdx=s),this.str+=a),[]}static getBoxes(t,n,s,i){return[]}getResult(t){let n=[],s="",i=[],r=!1;for(let n=0;n<t.length;n++){let l=t.charCodeAt(n),a=l>=65&&l<=72;if(a&&""==s)return[];a!=r&&(i.push(s),s=""),r=a,s+=t[n]}""!=s&&i.push(s);for(let t=1;t<i.length;t+=2){let s=0,r=Math.floor(i[t-1].length/i[t].length),l=+i[t-1].substr(s,r),a=l;for(let c=0;c<i[t].length;c++){if(c>=i[t-1].length||(l=+i[t-1].substr(s,r))!=a)return[];n.push({num:l,str:i[t][c]}),s+=r,r=(a=l+1).toString().length}}return n}on(){super.on(),this.firstLine=null,this.lineIdx=0,this.str=""}off(){if(super.off(),this.offCalback&&this.firstLine){var t=this.getResult(this.str.toUpperCase());if(t.length>0){let n=JSON.stringify({main:t,sub:[]});this.offCalback([{str:n,pageIndex:this.firstLine.pageIndex,lineIndex:this.lineIdx,transform:this.firstLine.transform,type:this.TYPE}])}}this.firstLine=null,this.str=""}constructor(t,n){super(),this.firstLine=null,this.lineIdx=0,this.str="",this.TYPE=x.TYPE_NAME,null!=t&&(this.isOn=t),this.offCalback=n}}x.TYPE_NAME="dapanchitiet";class p extends r{parse(t,n,s,r,l,a){if(!n.isLastLine||r&&n.transform[5]<r.transform[5]+r.height)return[];var c=n.strLine.replace(/\|/g,"").trim().match(i.PdfConst.FOOTER_PATTERN.join("|"));return null!=c&&c.length>0?[{str:c[0],pageIndex:n.pageIndex,lineIndex:s,transform:n.transform,type:this.TYPE}]:[]}static getBoxes(t,n,s,i){return[]}constructor(){super(),this.TYPE=p.TYPE_NAME}}p.TYPE_NAME="footer";class f extends r{parse(t,n,s,i,r,l){for(let a of[new p,new u])if(a.parse(t,n,s,i,r,l).length>0)return[];var a=n.strLine;return null==this.firstLine&&(this.firstLine=n,this.lineIdx=s),this.str+=a+"\n",[]}static getBoxes(t,n,s,i){return[]}getResult(t){let n=[],s=t.replace(/\n/g,"\n|"),r=i.PdfConst.QUESTION_PATTERN.join("|").replace(/\(\^/g,"(\\|"),l=s.matchAll(RegExp(r,"ig"));for(;;){let t=l.next();if(t.done)break;let n=t.value[0],i=this.getNumberFromStr(n);s=s.replace(n,i+".")}let a,c=s.matchAll(/\d+[\.\-]/g),h=-1;for(;;){let t=c.next();if(t.done)break;if(-1==h)h=t.value.index,a=t;else{let i=s.substr(h,t.value.index-h);n.push(this.toAns(i,a)),h=t.value.index,a=t}}if(h>=0&&a){let t=s.substr(h);n.push(this.toAns(t,a))}return n}toAns(t,n){let s=n.value[0].length;return{num:+n.value[0].substr(0,s-1),str:t.substr(s).replace(/\|/g," ").replace(/ +/g," ").trim()}}getNumberFromStr(t){var n=t.match(/(\d+)/);return n?n[0]:""}on(){super.on(),this.firstLine=null,this.lineIdx=0,this.str=""}off(){if(super.off(),this.offCalback&&this.firstLine){var t=this.getResult(this.str);if(t.length>0){let n=JSON.stringify({main:[],sub:t});this.offCalback([{str:n,pageIndex:this.firstLine.pageIndex,lineIndex:this.lineIdx,transform:this.firstLine.transform,type:this.TYPE}])}}this.firstLine=null,this.str=""}constructor(t,n){super(),this.firstLine=null,this.lineIdx=0,this.str="",this.TYPE=f.TYPE_NAME,null!=t&&(this.isOn=t),this.offCalback=n}}f.TYPE_NAME="dapandientu";class g{getErrorQtns(t){var n=[];for(let s=0;s<t.length;s++)!t[s].isGroup&&0==t[s].answers.length&&(t[s].strAns&&void 0!==t[s].strAns||n.push(t[s].num));return n}sumHighTo(t,n){let s=0,i=n.filter(t=>!t.inactive);for(let n=0;n<t;n++)s+=Math.round(i[n].heigh);return s}maxWidthTo(t,n){let s=[],i=n.filter(t=>!t.inactive);for(let n=0;n<t;n++)s.push(i[n].width);return Math.round(Math.max(...s))}constructor(t){this.commonService=t,this.fillColor=(t,n,s,i,r,l)=>{n.fillStyle=t,n.fillRect(Math.round(s),Math.round(i),Math.round(r),Math.round(l))},this.drawRect=(t,n,s,i,r,l)=>{n.beginPath(),n.lineWidth=1,n.strokeStyle=t,n.rect(Math.round(s),Math.round(i),Math.round(r),Math.round(l)),n.stroke()},this.getSingleImgData=(t,n)=>{var s,i;if(t.inactive){let t=null!==(s=this.commonService.myTranslateInstant("lang_auto_khong_xac_dinh_duoc_vung_thong_tin"))&&void 0!==s?s:"";throw this.commonService.snackError(t),Error(t)}try{let s=document.createElement("canvas");return s.width=0==t.width?2:Math.round(t.width),s.height=0==t.heigh?2:Math.round(t.heigh),null===(i=s.getContext("2d"))||void 0===i||i.drawImage(n[t.pageIndex].canvas,Math.round(t.left),Math.round(t.top),s.width,s.height,0,0,s.width,s.height),s.toDataURL("image/png")}catch(t){return console.log(t),"https://via.placeholder.com/300"}},this.getScatteredImgData=(t,n)=>{let s=t.filter(t=>!t.inactive);if(t.filter(t=>t.inactive).length==t.length){var i;let t=null!==(i=this.commonService.myTranslateInstant("lang_auto_khong_xac_dinh_duoc_vung_thong_tin"))&&void 0!==i?i:"";throw this.commonService.snackError(t),Error(t)}try{let t=document.createElement("canvas"),i=s.map(t=>t.width);t.width=Math.round(Math.max(...i));let r=0;for(let t=0;t<s.length;t++)r+=s[t].heigh;t.height=Math.round(r);let l=t.getContext("2d");for(let t=0;t<s.length;t++)null==l||l.drawImage(n[s[t].pageIndex].canvas,Math.round(s[t].left),Math.round(s[t].top),Math.round(s[t].width),Math.round(s[t].heigh),0,0==t?0:this.sumHighTo(t,s),Math.round(s[t].width),Math.round(s[t].heigh));return t.toDataURL("image/png")}catch(t){return console.log(t),"https://via.placeholder.com/300"}}}}class v{static drawPoint(t,n,s){null!=t&&(t.fillStyle=n,t.beginPath(),t.arc(s.left,s.top,5,0,2*Math.PI),t.fill())}static drawBox(t,n,s,i){null!=t&&(i?(t.fillStyle=n,t.beginPath(),t.rect(s.left,s.top,s.width,s.heigh),t.fill()):(t.strokeStyle=n,t.beginPath(),t.rect(s.left,s.top,s.width,s.heigh),t.stroke()))}static drawBox2(t,n,s,i,r){null!=t&&(t.strokeStyle=n,t.beginPath(),t.rect(r[4],r[5],s,i),t.stroke())}static drawLine(t,n,s,i){null!=t&&(t.strokeStyle=n,t.beginPath(),t.moveTo(s,i),t.lineTo(t.canvas.width-10,i),t.stroke())}static drawText(t,n,s,i){null!=t&&(t.font="11px Arial",t.fillStyle=n,t.fillText(i,s[4],s[5]))}static isLineIntersec(t,n){let s=t.transform[5]<=n.transform[5]&&n.transform[5]<=t.transform[5]+t.height,r=n.transform[5]<=t.transform[5]&&t.transform[5]<=n.transform[5]+n.height,l=t.transform[4]<=n.transform[4]&&n.transform[4]<=t.transform[4]+t.width+i.PdfConst.INTERSEC_MARGIN,a=n.transform[4]<=t.transform[4]&&t.transform[4]<=n.transform[4]+n.width+i.PdfConst.INTERSEC_MARGIN,c=this.isSameLine(t,n);return(s||r)&&(l||a)&&!c}static isLineVIntersec(t,n){return(t.transform[5]<=n.transform[5]&&n.transform[5]<=t.transform[5]+t.height||n.transform[5]<=t.transform[5]&&t.transform[5]<=n.transform[5]+n.height)&&(t.transform[4]<=n.transform[4]&&n.transform[4]<=t.transform[4]+t.width+i.PdfConst.INTERSEC_MARGIN||n.transform[4]<=t.transform[4]&&t.transform[4]<=n.transform[4]+n.width+i.PdfConst.INTERSEC_MARGIN)&&Math.abs(n.transform[4]-t.transform[4])>i.PdfConst.INTERSEC_MARGIN/2}static isSameLine(t,n){return Math.abs(t.transform[5]+t.height-(n.transform[5]+n.height))<=i.PdfConst.LINE_MAGIN}static isObjIntersec(t,n){return t.transform[5]<=n.transform[5]&&n.transform[5]<=t.transform[5]+t.height||n.transform[5]<=t.transform[5]&&t.transform[5]<=n.transform[5]+n.height}static isObjFullIntersec(t,n){return(t.transform[5]<=n.transform[5]&&n.transform[5]<=t.transform[5]+t.height||n.transform[5]<=t.transform[5]&&t.transform[5]<=n.transform[5]+n.height)&&(t.transform[4]<=n.transform[4]&&n.transform[4]<=t.transform[4]+t.width||n.transform[4]<=t.transform[4]&&t.transform[4]<=n.transform[4]+n.width)}static isFirstLineOfPage(t,n){return!(t<0||t>=n.length||0!=t&&n[t-1].pageIndex==n[t].pageIndex)}static isLastLineOfPage(t,n){return!(t<0||t>=n.length||t!=n.length-1&&n[t+1].pageIndex==n[t].pageIndex)}static getTopLine(t,n,s){let r=s[n];for(let l of[[i.PdfConst.STEP_SIZE,i.PdfConst.OVERLAP],[1,i.PdfConst.OVERLAP],[1,.3]]){let a=l[0],c=l[1],h=r.transform[5],d=0,u=3*a;if(!v.isFirstLineOfPage(n,s)){let t=v.isSameLine(s[n-1],r);v.isLineIntersec(s[n-1],r)?(h=s[n-1].transform[5]+s[n-1].height,d=s[n-1].transform[5],s[n-1].transform[4]>s[n].transform[4]+2*i.PdfConst.MARGIN_LEFT?d-=2*i.PdfConst.MARGIN_LEFT:d+=s[n-1].height*c,a=1,u=s[n].transform[5]+s[n].height/2-h):(d=t&&n-2>=0?s[n-2].transform[5]+s[n-2].height*c:s[n-1].transform[5]+s[n-1].height*c,t&&v.isFirstLineOfPage(n-1,s)&&(d=0))}if(!i.PdfConst.ENABLE_IMAGE_PROCESS)return[h,0];let x=!1;for(;h>d;){if(!v.hasColor(t,r.transform[4],h,r.width,a))return[h,0];x||(x=!0,h+=u),h-=a}}return[r.transform[5],1]}static arrContains(t,n){for(let s of n)if(s==t)return!0;return!1}static getBottomLine(t,n,s){let r=s[n];for(let l of[[i.PdfConst.STEP_SIZE,i.PdfConst.OVERLAP],[1,i.PdfConst.OVERLAP],[1,.3]]){let a=l[0],c=l[1],h=r.transform[5]+r.height,d=9999,u=3*a;if(!v.isLastLineOfPage(n,s)){let t=v.isSameLine(s[n+1],r);v.isLineIntersec(s[n+1],r)?(h=s[n+1].transform[5],d=s[n+1].transform[5]+s[n+1].height,s[n+1].transform[4]>s[n].transform[4]+2*i.PdfConst.MARGIN_LEFT?d+=2*i.PdfConst.MARGIN_LEFT:d-=s[n+1].height*c,u=s[n].transform[5]+s[n].height/2-h):(d=t&&n+2<s.length?s[n+2].transform[5]+s[n+2].height-s[n+2].height*c:s[n+1].transform[5]+s[n+1].height-s[n+1].height*c,t&&v.isLastLineOfPage(n+1,s)&&(d=9999));let l=s[n+1].top;if(l&&h>=l&&!t)return[l,0]}if(!i.PdfConst.ENABLE_IMAGE_PROCESS)return[h,0];let x=!1;for(;h<d;){if(!v.hasColor(t,r.transform[4],h,r.width,a))return[h,0];x||(x=!0,h-=u),h+=a}}return[r.transform[5]+r.height,1]}static hasColor(t,n,s,i,r){let l=Math.round(n),a=Math.round(l+i),c=Math.round(s),h=Math.round(c+r);for(let n=c;n<h;n++)for(let s=l;s<a;s++){let i=4*(n*t.width+s);if((t.data[i]+t.data[i+1]+t.data[i+2])/3<150)return!0}return!1}static calIndexPos2(t,n,s,r,l){let a=[],c=0,h=0,d=0,u=0,x=0,p=0,f=!0,g=!0;for(let j of t){g=this.isObjIntersec(t[0],j),u=j.transform[4],l||(c+=u-d>i.PdfConst.SPLIT_MARGIN&&""!=j.str.trim()||x!=j.transform[5]?1:0),f=u+2*i.PdfConst.MARGIN_LEFT>=d;let y=j.transform[4]+j.width;if(g&&(d=y),y>h&&g&&(h=y),(c+=j.str.length)>r&&f&&g){j.transform.forEach(t=>{a.push(t)}),a[3]=j.height,a[2]=p,a[1]=j.str.length-c+r;let t=j.str.substr(0,j.str.length-c+r+1);if(t.length==j.str.length){a[4]=a[4]+j.width;break}var v=n[j.fontName].fontFamily,b=Math.hypot(j.transform[2],j.transform[3]);s.font="".concat(b,"px ").concat(v);let i=s.measureText(t).width,l=s.measureText(j.str).width;a[4]=a[4]+j.width*i/l;break}g&&(x=j.transform[5]),p++}return 0==a.length&&(a=[0,t[t.length-1].length-1,t.length-1,t[0].height,h,t[0].transform[5]]),a}static calIndexPos(t,n,s,r,l){let a=[],c=0,h=0,d=0,u=0,x=0,p=0,f=!0,g=!0;for(let j of t){g=this.isObjIntersec(t[0],j),u=j.transform[4],l||(c+=u-d>i.PdfConst.SPLIT_MARGIN&&""!=j.str.trim()||x!=j.transform[5]?1:0,u-d>i.PdfConst.SPLIT_MARGIN&&""!=j.str.trim()||j.transform[5],j.str),f=u+2*i.PdfConst.MARGIN_LEFT>=d;let y=j.transform[4]+j.width;if(g&&(d=y),y>h&&g&&(h=y),(c+=j.str.length)>r&&f&&g){let t=j.str.substr(0,j.str.length-c+r);var v=n[j.fontName].fontFamily,b=Math.hypot(j.transform[2],j.transform[3]);s.font="".concat(b,"px ").concat(v);let i=s.measureText(t).width,l=s.measureText(j.str).width;j.transform.forEach(t=>{a.push(t)}),a[4]=a[4]+j.width*i/l,a[3]=j.height,a[2]=p,a[1]=j.str.length-c+r;break}g&&(x=j.transform[5]),p++}return 0==a.length&&(a=[0,t[t.length-1].length-1,t.length-1,t[0].height,h,t[0].transform[5]]),a}static getTextBottom(t,n,s,i){let r=Math.atan2(t[1],t[0]);n.vertical&&(r+=Math.PI/2);let l=Math.hypot(t[2],t[3]),a=l*v.getAscent(n.fontFamily,s,i);t[5];let c=0,h=0*(c=0===r?a:a*Math.cos(r));return[t[5]-c-h,l+h]}static getAscent(t,n,s){let i=s.get(t);if(i)return i;n.save(),n.font="30px ".concat(t);let r=n.measureText(""),l=r.fontBoundingBoxAscent,a=Math.abs(r.fontBoundingBoxDescent);if(l){n.restore();let i=l/(l+a);return s.set(t,i),i}n.strokeStyle="red",n.clearRect(0,0,30,30),n.strokeText("g",0,0);let c=n.getImageData(0,0,30,30).data;a=0;for(let t=c.length-1-3;t>=0;t-=4)if(c[t]>0){a=Math.ceil(t/4/30);break}n.clearRect(0,0,30,30),n.strokeText("A",0,30),c=n.getImageData(0,0,30,30).data,l=0;for(let t=0,n=c.length;t<n;t+=4)if(c[t]>0){l=30-Math.floor(t/4/30);break}if(n.restore(),l){let n=l/(l+a);return s.set(t,n),n}return s.set(t,.8),.8}static getMaxLineRight(t,n){let s=0;for(let i of n)if(i.pageIndex==t||-1==t){let t=i.transform[4]+i.width;t>s&&(s=t)}return s}static getMinLineLeft(t,n){let s=99999;for(let i of n)if(i.pageIndex==t||-1==t){let t=i.transform[4];t<s&&(s=t)}return s}}class b{loadPdf(t,n){var s=URL.createObjectURL(t);let i=pdfjsLib.getDocument({url:s,cMapPacked:!0,cMapUrl:"/assets/js/pdf-js-v2/cmaps/",disableAutoFetch:!1,disableFontFace:!1,disableRange:!1,disableStream:!1,docBaseUrl:"",enableXfa:!0,fontExtraProperties:!1,isEvalSupported:!0,maxImageSize:-1,pdfBug:!1,standardFontDataUrl:"/assets/js/pdf-js-v2/standard_fonts/",verbosity:1});var r=[];let l=this;i.promise.then(function(t){l.optionalContentConfigPromise=t.getOptionalContentConfig();for(var s=t._pdfInfo.numPages,i=1;i<=s;i++)t.getPage(i).then(t=>{r.push(t),r.length==s&&n(r=r.sort((t,n)=>t._pageIndex>n._pageIndex?1:-1))})},function(t){console.error(t)})}getImages(t,n){let s=[];if("function"!=typeof t.objs.getAll)return console.log("Unable to read img"),s;let i=t.objs.getAll();for(let t of Object.keys(i))i[t].data.pageIndex=n,s.push(i[t].data);return s}isImageObj(t){return -999==t.transform[0]&&"img"==t.str}getLines(t,n,s,r){let l=r.scale,a=t.items.length;for(let n=0;n<a;n++){let i=t.items[n];this.isImageObj(i)||(i.transform=b.transform(r.transform,i.transform),i.width=i.width*l),i.transform[4]+i.width>s.canvas.width&&(i.width=s.canvas.width-i.transform[4]-20);let a=this.isImageObj(i)?[i.transform[5],i.height]:v.getTextBottom(i.transform,t.styles[i.fontName],this.tempCanvas,this.ascentCache);i.height=a[1];let c=Math.ceil(a[0]);i.transform[5]=c}t.items.sort((t,n)=>1e6*Math.floor(t.transform[5])-t.transform[4]<1e6*Math.floor(n.transform[5])-n.transform[4]?-1:1);let c,h=[],d=0;this.imageCache[n]?c=this.imageCache[n]:(c=s.getImageData(0,0,s.canvas.width,s.canvas.height),this.imageCache[n]=c);var u={strLine:"",transform:[],textObjs:[],pageIndex:n,width:0,height:0,txtLength:0};for(let s=0;s<a;s++){let r=t.items[s];if(this.isImageObj(r)){for(let n=0;n<a;n++)if(s!=n&&v.isObjIntersec(r,t.items[n])){r.str="";break}}if(v.arrContains(r.str.trim(),i.PdfConst.SKIP_CHAR))continue;let l=Math.floor(r.transform[5]+r.height);0!=d?d-l>=-i.PdfConst.LINE_MAGIN?this.addTxtToLine(u,r):0!=u.textObjs.length&&(h.push(u),d=Math.floor((u=this.newLine(r,n)).transform[5]+u.height)):d=Math.floor((u=this.newLine(r,n)).transform[5]+u.height)}for(let t of(h.push(u),h))this.calculateSize(t);for(let t of(this.findAndMergeAnsQuestBlock(h,"ans"),this.findAndMergeAnsQuestBlock(h,"quest"),this.findAndMergeBlock(h),this.mergeIntersecLine(h),this.mergeSmallLine(h,c),h))this.calculateSize(t);return h}mergeIntersecLine(t){let n=0;for(;n<t.length;){let s=t[n];++n<t.length&&v.isLineVIntersec(s,t[n])&&(this.mergeLine(s,t[n]),t.splice(n,1),n--)}}findAndSplitQuestAnsLine(t,n,s){let r=0,l=[],a=i.PdfConst.BREAK_LINE_PATTERN.join("|");for(let n of t){n.top=void 0,n.bottom=void 0;var c=n.strLine.replace(/\|/g,"").trim().match(a);if(null!=c&&c.length>0){let t=/[\s\|\.]+[B\u0412][\s\|]*\./g,s=n.strLine.trim().toUpperCase().match(t);if(null!=s&&s.length>0){let t=c[0].toUpperCase().indexOf("A");l.push({lineIndex:r,strIndex:t})}}r++}for(let i=l.length-1;i>=0;i--){let r=l[i].lineIndex;this.splitLine(r,n[t[r].pageIndex],s[t[r].pageIndex],l[i].strIndex,t)}}mergeSmallLine(t,n){let s=0,r=1.2*i.PdfConst.LINE_SMALL_HEIGHT;for(;s<t.length;){let i=t[s];if(!i||!this.isSmallLine(i)){s++;continue}s-1>=0&&!t[s-1].bottom&&(t[s-1].bottom=v.getBottomLine(n,s-1,t)[0]),s+1<t.length&&!t[s+1].top&&(t[s+1].top=v.getTopLine(n,s+1,t)[0]);let l=s-1<0?-9999:this.getLineTop(i)-this.getLineBot(t[s-1]),a=s+1>=t.length?-9999:this.getLineTop(t[s+1])-this.getLineBot(i),c=s-1>=0&&t[s-1].transform[4]<=i.transform[4]&&i.transform[4]<=t[s-1].transform[4]+t[s-1].width,h=s+1<t.length&&t[s+1].transform[4]<=i.transform[4]&&i.transform[4]<=t[s+1].transform[4]+t[s+1].width;if(0==s&&a<=r&&h){this.mergeLine(t[s+1],i),t.splice(s,1),s--;continue}if(s==t.length-1&&l<=r&&c){this.mergeLine(t[s-1],i),t.splice(s,1),s--;continue}let d=-1;l>a&&h&&a<=r?d=s+1:l<=a&&c&&l<=r?d=s-1:l<=a&&h&&a<=r?d=s+1:l>a&&c&&l<=r&&(d=s-1),d>=0?(this.mergeLine(t[d],i),t.splice(s,1),s--):s++}}isSmallLine(t){return t.height<i.PdfConst.LINE_SMALL_HEIGHT}mergeLine(t,n){for(let s of n.textObjs)this.addTxtToLine(t,s)}findAndMergeAnsQuestBlock(t,n){let s=0;for(;s<t.length;){if("ans"==n&&this.isAnsLine(t[s])||"quest"==n&&this.isQuestLine(t[s])){let i=s,r=-1,l=1,a=[];for(;l<=10;){if((i=s+r*l)<0){r=1,l=1;continue}if(i>=t.length)break;let c=this.isAnsLine(t[i]),h=c||this.isQuestLine(t[i]),d="ans"==n&&c&&v.isSameLine(t[s],t[i]),u=!h&&v.isLineIntersec(t[s],t[i])&&t[i].transform[4]>t[s].transform[4];if((d||u)&&a.push(i),l++,h&&1==r)break;(l>10||h)&&-1==r&&(r=1,l=1)}for(let n of(a.sort((t,n)=>t<n?1:-1),a))for(let i of t[n].textObjs)this.addTxtToLine(t[s],i);for(let n of a)t.splice(n,1),n<s&&s--}s++}}findAndMergeBlock(t){let n=0;for(;n<t.length;){if(this.isAnsLine(t[n])||this.isQuestLine(t[n])){n++;continue}let s=n+1;for(;s<t.length&&t[n].pageIndex==t[s].pageIndex;){let i=this.isAnsLine(t[s])||this.isQuestLine(t[s]);if(v.isLineIntersec(t[n],t[s])&&!i||v.isSameLine(t[n],t[s])){for(let i of t[s].textObjs)this.addTxtToLine(t[n],i);t.splice(s,1),s=n}s++}n++}}isAnsLine(t){let n=t.strLine.trim().match(/[\s\|\.]+[AB\u0412CDEFGHIJK]\s*\./g);return null!=n&&n.length>0}isQuestLine(t){let n=i.PdfConst.QUESTION_PATTERN.join("|"),s=t.strLine.replace(/\|/g,"").toLowerCase().trim().match(n);return null!=s&&s.length>0}encodeLines(t,n){let s="",r=0;for(let l of n){if(l.height<i.PdfConst.LINE_SMALL_HEIGHT){r-1>=0&&!n[r-1].bottom&&(n[r-1].bottom=v.getBottomLine(t,r-1,n)[0]),r+1<n.length&&!n[r+1].top&&(n[r+1].top=v.getTopLine(t,r+1,n)[0]);let a=r-1<0?-9999:this.getLineTop(l)-this.getLineBot(n[r-1]),c=r+1>=n.length?-9999:this.getLineTop(n[r+1])-this.getLineBot(l),h=r-1>=0&&n[r-1].transform[4]<=l.transform[4]&&l.transform[4]+l.width<=n[r-1].transform[4]+n[r-1].width,d=r+1<n.length&&n[r+1].transform[4]<=l.transform[4]&&l.transform[4]+l.width<=n[r+1].transform[4]+n[r+1].width,u=1.2*i.PdfConst.LINE_SMALL_HEIGHT;Math.abs(a)>=u&&Math.abs(c)>=u?s+="L":s+=-9999==a?"3":-9999==c?"4":a>c&&d?"2":a<=c&&h?"1":a<=c&&d?"2":a>c&&h?"1":"L"}else s+="L";r++}return s}getLineTop(t){return t.top?t.top:t.transform[5]}getLineBot(t){return t.bottom?t.bottom:t.transform[5]+t.height}splitLine(t,n,s,i,r){let l=r[t],a=v.calIndexPos(l.textObjs,n,s,i,!0),c=this.newLine(l.textObjs[0],l.pageIndex),h=a[2],d=a[1],u=l.textObjs[h],x=u.transform,p={str:u.str.substr(0,d),width:a[4]-x[4],height:u.height,fontName:u.fontName,transform:[x[0],x[1],x[2],x[3],x[4],x[5]]},f={str:u.str.substr(d),width:u.width-p.width,height:u.height,fontName:u.fontName,transform:[x[0],x[1],x[2],x[3],a[4],x[5]]},g=l.textObjs;l.textObjs=[],c.textObjs=[];for(let t=0;t<g.length;t++)t<h?this.addTxtToLine(l,g[t]):t>h?this.addTxtToLine(c,g[t]):(this.addTxtToLine(l,p),this.addTxtToLine(c,f));return this.calculateSize(l),this.calculateSize(c),t==r.length-1?r.push(c):r.splice(t+1,0,c),c}findAndMergeSmallLine(t,n,s){let i=0,r=t.matchAll(s),l=[];for(;;){let t=r.next();if(t.done)break;let s=t.value[0],a=t.value.index,c=0,h=[];for(let t=0;t<s.length;t++)"L"==s[t]?c=a+t:h.push(a+t);for(let t of h){for(let s of n[t].textObjs)this.addTxtToLine(n[c],s);n[c].top=void 0,n[c].bottom=void 0,l.push(t)}i++}for(let t of(l.sort((t,n)=>t<n?1:-1),l))n.splice(t,1);return i}newLine(t,n){let s={strLine:"",transform:[],textObjs:[],pageIndex:n,width:0,height:0,txtLength:0};return s.transform[4]=t.transform[4],s.transform[5]=t.transform[5],s.height=t.height,s.width=t.width,s.txtLength=t.str.length,s.textObjs.push(t),s}addTxtToLine(t,n){n.transform[4]<t.transform[4]&&(t.transform[4]=n.transform[4]),n.transform[5]<t.transform[5]&&(t.transform[5]=n.transform[5]),n.transform[5]+n.height>t.transform[5]+t.height&&(t.height=n.transform[5]+n.height-t.transform[5]),n.transform[4]+n.width>t.transform[4]+t.width&&(t.width=n.transform[4]+n.width-t.transform[4]),t.txtLength+=n.str.length,t.textObjs.push(n);let s=t.transform[4]+t.width,i=t.height;for(let n of t.textObjs)n.transform[4]+n.width>s&&(s=n.transform[4]+n.width),n.transform[5]+n.height>t.transform[5]+i&&(i=n.transform[5]+n.height-t.transform[5]);t.width=s-t.transform[4],t.height=i}static transform(t,n){return pdfjsLib.Util.transform(t,n)}render(t,n,s,i){for(var r,l=t.length,a=0;a<l;a++){var c=document.createElement("div");c.className="pdf-page",c.id="page-"+a,null===(r=document.getElementById(n))||void 0===r||r.appendChild(c),this.renderPage(t[a],s,i)}}calculateSize(t){if(0==t.textObjs.length)return;t.textObjs.sort((t,n)=>1e6*Math.floor(t.transform[4])+t.transform[5]>1e6*Math.floor(n.transform[4])+n.transform[5]?1:-1),t.strLine="";let n=0,s=0,r=0,l=0,a=9999,c=0,h=9999;for(let d of t.textObjs){let u=v.isObjIntersec(t.textObjs[0],d),x=(r=d.transform[4])-s>i.PdfConst.SPLIT_MARGIN&&""!=d.str.trim()||l!=d.transform[5]?"|":"";t.strLine+=x+d.str,r<h&&(h=r);let p=d.transform[4]+d.width;u&&(s=p),p>n&&u&&(n=p),u&&(l=d.transform[5]),d.transform[5]<a&&(a=d.transform[5]),d.transform[5]+d.height>c&&(c=d.transform[5]+d.height)}t.transform[4]=h,t.transform[5]=a,t.width=n-h,t.height=c-a,t.transform[0]=a,t.transform[1]=c;let d=i.PdfConst.TVCN_CHAR,u=t.strLine;for(let t of d)u=u.replace(RegExp(t[0],"g"),t[1]);t.strLine=u}renderPage(t,n,s){var i=t._pageIndex,r=t.getViewport({scale:n});let l=.8*r.width;var a=document.createElement("canvas"),c=document.getElementById("page-"+i);null==c||c.appendChild(a),a.id="canvas"+i;var h=a.getContext("2d",{alpha:!1});a.height=r.height,a.width=r.width,a.style.height=r.height*l/r.width+"px",a.style.width=l+"px",c&&(c.style.width=a.style.width,c.style.height=a.style.height);let d={canvasContext:h,transform:[1,0,0,1,0,0],viewport:r,annotationMode:pdfjsLib.AnnotationMode.ENABLE_FORMS,optionalContentConfigPromise:this.optionalContentConfigPromise,annotationCanvasMap:new Map,pageColors:{background:"Canvas",foreground:"CanvasText"}};t.render(d).promise.then(function(){s&&s(h,t._pageIndex,r)})}constructor(){let t=document.createElement("canvas");this.tempCanvas=t.getContext("2d"),this.ascentCache=new Map,this.imageCache=[]}}t.exports=class{get totalNumberQuestion(){return this.questionList.filter(t=>t.tempData.isSelect&&t.answers.length).length}updateStatusCallback(t){}onCompleteCallback(t,n){t.length>0?(this.startQuestion=t[0].num,this.labelHolderSize.width=2*n[0].canvas.width,this.rootQuestionInfo=t,this.rootCanvases=n.map(t=>t.canvas),this.rootHeaderPosition={pageIndex:0,top:1,left:t[0].positions[0].left,width:t[0].positions[0].left+t[0].positions[0].width<n[0].canvas.width?t[0].positions[0].width:n[0].canvas.width-t[0].positions[0].left,heigh:t[0].positions[0].top-1},this.processData()):(this.errAnalyzingPdf=!0,this.isShowLoadingFileExam=!1)}cloneCanvas(){let t=this.rootCanvases;for(let n=0;n<t.length;n++){let s=t[n],i=document.createElement("canvas");i.width=s.width,i.height=s.height;let r=document.createElement("canvas");r.width=s.width,r.height=s.height;let l=i.getContext("2d");null==l||l.drawImage(s,0,0,s.width,s.height,0,0,s.width,s.height);let a=r.getContext("2d");null==a||a.drawImage(s,0,0,s.width,s.height,0,0,s.width,s.height),l&&a&&this.clonedCtxForCreate.push(a)}}processData(){this.questionList=[],this.abcdLabelPos={},this.groupImages={},this.totalInGroupTracking=0,this.questionLabelMap=[],this.groupLengths=[],this.countGroup=0,this.labelsUrls=[],this.labelsBase64s=[],this.firstInGroupIndexes=[],this.clonedCtxForCreate=[],this.cloneCanvas();let t=this.clonedCtxForCreate[0].canvas.width;this.rootQuestionInfo.forEach(n=>{n.positions.forEach(n=>{n.width+n.left>t&&(n.width=t-n.left)})});let n=this.rootQuestionInfo,s=this.clonedCtxForCreate;n.forEach(t=>{t.remove.heigh=Math.round(t.remove.heigh),t.remove.width=Math.round(t.remove.width),t.remove.top=Math.round(t.remove.top),t.remove.left=Math.round(t.remove.left),t.positions.forEach(t=>{t.heigh=Math.round(t.heigh),t.width=Math.round(t.width),t.top=Math.round(t.top),t.left=Math.round(t.left)}),t.help&&(t.help.remove&&(t.help.remove.heigh=Math.round(t.help.remove.heigh),t.help.remove.width=Math.round(t.help.remove.width),t.help.remove.left=Math.round(t.help.remove.left),t.help.remove.top=Math.round(t.help.remove.top)),t.help.positions.forEach(t=>{t.heigh=Math.round(t.heigh),t.width=Math.round(t.width),t.top=Math.round(t.top),t.left=Math.round(t.left)})),t.answers.length>0&&t.answers.forEach(t=>{t.remove.heigh=Math.round(t.remove.heigh),t.remove.width=Math.round(t.remove.width),t.remove.top=Math.round(t.remove.top),t.remove.left=Math.round(t.remove.left),t.positions.forEach(t=>{t.heigh=Math.round(t.heigh),t.width=Math.round(t.width),t.top=Math.round(t.top),t.left=Math.round(t.left)})})});let i=document.createElement("canvas");i.width=this.labelHolderSize.width,i.height=this.labelHolderSize.height;let r=i.getContext("2d"),l=0,a=()=>{r&&(this.labelsBase64s[l]=r.canvas.toDataURL("image/png"),l++,r.clearRect(0,0,r.canvas.width,r.canvas.height)),h.left=0,h.top=0},c=0,h={left:0,top:0,locate:0},d=[],u=t=>{let n=!0;for(let s=0;s<t.length;s++)if(1==t[s].remove.width||1==t[s].remove.heigh){n=!1;break}return n};n.forEach(t=>{d.push(t.answers.length)});for(let t=0;t<n.length;t++)if(u(n[t].answers)&&n[t].answers.length==Math.max(...d)){n[t].answers.forEach(t=>{null==r||r.drawImage(s[t.remove.pageIndex].canvas,t.remove.left,t.remove.top,t.remove.width,t.remove.heigh,h.left,h.top,t.remove.width,t.remove.heigh),this.abcdLabelPos[t.label]={left:h.left,top:h.top},h.left=h.left+t.remove.width+5});break}this.examHeader=this.cropperService.getSingleImgData(this.rootHeaderPosition,s);for(let t=0;t<n.length;t++){let i={isFixAns:n[t].isFixAns?1:0,forcedFixAns:!!n[t].isFixAns,groupType:0,original:"",debugView:"",group:n[t].group,groupUrl:this.groupImages["image_group_".concat(n[t].group)]?this.groupImages["image_group_".concat(n[t].group)]:"",question:{label:n[t].num,posit:{top:0,left:0,locate:0},url:"",urlExcludeLabelOnly:"",width:1,height:1,remove:{x:1,y:1,width:1,height:1,url:this.cropperService.getSingleImgData(n[t].remove,s),left:0,top:0}},answers:[],help:{num:n[t].num,url:""},tempData:{sort:t,point:0,answerType:1,answerConfig:{},answerResult:[],isShowAttach:!1,questionMedia:[],isSelect:!0,isShowHelp:!1},rootIndex:t},d=n[t].positions;if(i.original=this.cropperService.getScatteredImgData(d,s),n[t].isGroup){this.groupLengths.push(this.totalInGroupTracking),this.totalInGroupTracking=0,this.countGroup++,i.isGroup=!0;var x=this.cropperService.getScatteredImgData(n[t].positions,s);this.groupImages["image_group_".concat(n[t].num)]=x}else{c++,this.totalInGroupTracking++,r&&0!=c&&h.left+n[t].remove.width>r.canvas.width?(h.left=0,h.top=h.top+this.maxQuestionLabelHeight+5,this.maxQuestionLabelHeight=0,r&&h.top+n[t].remove.heigh>r.canvas.height&&a(),null==r||r.drawImage(s[n[t].remove.pageIndex].canvas,n[t].remove.left,n[t].remove.top,n[t].remove.width,n[t].remove.heigh,h.left,h.top,n[t].remove.width,n[t].remove.heigh),i.question.remove.left=h.left,i.question.remove.top=h.top,this.questionLabelMap.push({locate:l,left:h.left,top:h.top,width:n[t].remove.width,height:n[t].remove.heigh}),h.left=h.left+n[t].remove.width+5):(r&&h.top+n[t].remove.heigh>r.canvas.height&&a(),null==r||r.drawImage(s[n[t].remove.pageIndex].canvas,n[t].remove.left,n[t].remove.top,n[t].remove.width,n[t].remove.heigh,h.left,h.top,n[t].remove.width,n[t].remove.heigh),i.question.remove.left=h.left,i.question.remove.top=h.top,this.questionLabelMap.push({locate:l,left:h.left,top:h.top,width:n[t].remove.width,height:n[t].remove.heigh}),h.left=h.left+n[t].remove.width+5,n[t].remove.heigh>this.maxQuestionLabelHeight&&(this.maxQuestionLabelHeight=n[t].remove.heigh)),this.cropperService.fillColor("#ffffff",s[n[t].remove.pageIndex],n[t].remove.left,n[t].remove.top,n[t].remove.width,n[t].remove.heigh),i.question.urlExcludeLabelOnly=1==d.length?this.cropperService.getSingleImgData(d[0],s):this.cropperService.getScatteredImgData(d,s),i.question.remove.x=n[t].remove.left-d[0].left,i.question.remove.y=n[t].remove.top-d[0].top,i.question.remove.width=n[t].remove.width,i.question.remove.height=n[t].remove.heigh,n[t].answers.length>0?n[t].answers.forEach(t=>{let n={label:t.label,posit:{left:0,top:0,locate:0},url:"",x:t.positions[0].left-d[0].left,y:t.positions[0].top-d[0].top,width:1,height:1,remove:{x:t.remove.left-d[0].left,y:t.remove.top-d[0].top,xAns:t.remove.left-t.positions[0].left,yAns:t.remove.top-t.positions[0].top,width:t.remove.width,height:t.remove.heigh,url:this.cropperService.getSingleImgData(t.remove,s),left:0,top:0}};if(d.length>1&&d[0].pageIndex!==t.remove.pageIndex&&(n.remove.y=t.remove.top-d[1].top+d[0].heigh),this.cropperService.fillColor("#ffffff",s[t.remove.pageIndex],t.remove.left,t.remove.top,t.remove.width,t.remove.heigh),d.length>1){for(let s=0;s<d.length;s++)if(d[s].pageIndex==t.positions[0].pageIndex){n.y=0==s?t.positions[0].top-d[s].top:t.positions[0].top-d[s].top+d[0].heigh;break}}if(t.isCorrect&&(i.tempData.answerResult=[t.label]),1==t.positions.length)n.url=this.cropperService.getSingleImgData(t.positions[0],s),n.width=t.positions[0].width,n.height=t.positions[0].heigh;else{n.url=this.cropperService.getScatteredImgData(t.positions,s);let i=t.positions.filter(t=>!t.inactive);n.width=this.cropperService.maxWidthTo(i.length,t.positions),n.height=this.cropperService.sumHighTo(i.length,t.positions)}i.answers.push(n),t.positions.forEach(t=>{this.cropperService.fillColor("#ffffff",s[t.pageIndex],t.left,t.top,t.width,t.heigh)})}):n[t].strAns&&void 0!==n[t].strAns?(i.tempData.answerType=4,i.tempData.answerResult.push(n[t].strAns||"")):i.tempData.answerType=3;let u=n[t].help;if(u&&(u.remove&&this.cropperService.fillColor("#ffffff",s[u.remove.pageIndex],u.remove.left,u.remove.top,u.remove.width,u.remove.heigh),u.positions&&u.positions.length>0&&(i.help.url=this.cropperService.getScatteredImgData(u.positions,s))),1==d.length){var p=d[0];if(i.answers.length){var[f]=i.answers;p.heigh=f.y}i.question.url=this.cropperService.getSingleImgData(p,s),i.question.width=p.width,i.question.height=p.heigh}else{i.question.url=this.cropperService.getScatteredImgData(d,s);let t=d.filter(t=>!t.inactive);i.question.width=this.cropperService.maxWidthTo(t.length,d),i.question.height=this.cropperService.sumHighTo(t.length,d)}this.questionList.push(i)}}for(let t=0;t<this.questionList.length;t++)this.questionList[t].tempData.point=this.totalNumberQuestion?Number(this.totalPoint/this.totalNumberQuestion):0,this.questionList[t].index=t;let g=0;for(let t=0;t<this.groupLengths.length;t++)this.firstInGroupIndexes.push(g+this.groupLengths[t]),g+=this.groupLengths[t];this.completeCropper()}generateIdRequired(t){let n="z",s="abcdefghijklmnopqrstuvwxyz0123456789",i=s.length;for(let r=0;r<t;r++)n+=s.charAt(Math.floor(Math.random()*i));return n}createElementImage(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;var s="";return n&&(s=' style="width:'.concat((100*n[1].width/n[0].width).toFixed(2),'%"')),t?'<p><img class="quill-image" src="'.concat(t,'"').concat(s,"/></p>"):""}completeCropper(){let t=[],n=[],s=this.quizId,i=(10/this.questionList.filter(t=>t.tempData.isSelect&&t.answers.length).length).toFixed(2);console.log({groups:t,questions:n=this.questionList.map(n=>{(!n.group||t.length+1!=n.group)&&(t.length||n.group)||t.push({id:this.generateIdRequired(7),quizId:s,questions:[],content:this.createElementImage(n.groupUrl),title:"",audios:[]});let r=t[t.length-1],l={id:this.generateIdRequired(7),content:this.createElementImage(n.question.url),quizId:s,groupId:r.id,point:n.tempData.isSelect&&n.answers.length?i:0,label:"C\xe2u",number:n.question.label,type:n.answers.length?"TN":"TL",options:n.answers.map(t=>({text:this.createElementImage(t.url,[n.question,t]),label:t.label})),explain:"",keys:n.tempData.answerResult||[],level:"",shuffle:!!n.isFixAns};return r.questions.push(l.id),l})}),this.callback({status:"done",data:{groups:t,questions:n,quizId:this.quizId}})}parsePdf(t){let n=new b;n.loadPdf(t,t=>{let s=t.length,r=[],l=[],a=document.createElement("div");a.id="hiddenWrapper",a.style.width="1px",a.style.height="1px",a.style.overflow="hidden",a.style.opacity="0",a.style.zIndex="-9999",a.style.position="fixed",a.style.top="0",a.style.left="0",document.body.appendChild(a);let c=document.createElement("div"),h="canvasWrapper";c.id=h,a.appendChild(c);let d=new Date().getTime(),u=[];n.render(t,h,i.PdfConst.RENDER_SCALE,(n,i,a)=>{if(null!=n&&(r[i]=n,l[i]=a),u.push(1),this.updateStatusCallback&&this.updateStatusCallback("Rendering: ".concat(u.length,"/").concat(s)),u.length==s){let n=new Date().getTime();this.updateStatusCallback&&this.updateStatusCallback("Render done: "+(n-d)/1e3+" secs"),this.startAnalyze(r,l,t)}})})}startAnalyze(t,n,s){let r=s.length,a=[],c=[],h=[],u=[],p=new b,f=new Date().getTime();for(let g=0;g<r;g++){let v=g,b=p.getImages(s[g],v);for(let t of b)u.push(t);s[g].getTextContent().then(s=>{for(let t of b)s.items.push(this.imgToTextObj(t,s.items.length>0?s.items[0].fontName:""));var g,j=p.getLines(s,v,t[v],n[v]);if(c=c.concat(j),h[v]=s.styles,a.push(1),a.length==r){c.sort((t,n)=>1e7*t.pageIndex+(t.transform.length>0?t.transform[5]:0)-(1e7*n.pageIndex+(n.transform.length>0?n.transform[5]:0))),p.findAndSplitQuestAnsLine(c,h,t),""!=i.PdfConst.DRAW_RESULT&&console.log(c);let n=this.findEntityPos(c,h,t,p.imageCache,0),s=!1;for(let t of n)if(t.type==l.TYPE_NAME){s=!0;break}if(s||(n=this.findEntityPos(c,h,t,p.imageCache,1)),0==n.length)return void(this.onCompleteCallback&&this.onCompleteCallback([],t));let r=n[0].type==x.TYPE_NAME,a=r?JSON.parse(n[0].str):null,v=new Map,b=new Map;if(r){for(let t of a.main)v.set(t.num,t.str);for(let t of a.sub)b.set(t.num,t.str)}let j=this.getQuestionInfo(n,c,t,v);for(let t of(j.forEach(t=>{if(!v.has(t.num)&&!b.has(t.num)&&t.help&&t.help.text){let n=d.getAnsFromHelp(t.help.text);""!=n&&b.set(t.num,n)}}),j)){if(!t.isGroup&&0==t.answers.length&&v.has(t.num)){let n={pageIndex:t.remove.pageIndex,top:t.remove.top-1,left:t.remove.left-1,width:1,heigh:1};for(let s of["A","B","C","D"]){let i={label:s,remove:n,positions:[n]};v.get(t.num)==s&&(i.isCorrect=!0),t.answers.push(i)}t.isFixAns=!0}if(!t.isGroup&&0==t.answers.length&&!v.has(t.num)&&b.has(t.num)&&(t.strAns=b.get(t.num)),!t.isGroup&&t.answers.length>0&&!v.has(t.num)&&b.has(t.num))for(let n of t.answers)n.label==(null===(g=b.get(t.num))||void 0===g?void 0:g.toUpperCase().substring(0,1))&&(n.isCorrect=!0)}let y=new Date().getTime();this.updateStatusCallback&&this.updateStatusCallback("Analyze done: "+(y-f)/1e3+" secs"),this.showOnCanvas(j,n,c,t,u,i.PdfConst.DRAW_RESULT),this.onCompleteCallback&&this.onCompleteCallback(j,t)}})}}imgToTextObj(t,n){return{str:"img",fontName:n,width:t.paintWidth,height:t.paintHeight,transform:[-999,0,0,0,-t.left,-t.top-t.paintHeight]}}findEntityPos(t,n,s,i,r){let g=[],b=!1;var j=[{parser:new a,on:[],off:[]},{parser:new l(r),on:[3,4],off:[6]},{parser:new c,on:[3,6],off:[]},{parser:new h(!1),on:[6,8],off:[0,2]},{parser:new d(!1),on:[6,8],off:[0,2,4]},{parser:new u,on:[],off:[8]},{parser:new x(!1,t=>{for(let n of t)g.unshift(n)}),on:[],off:[2]},{parser:new p,on:[],off:[]},{parser:new f(!1,t=>{if(0!=t.length){if(g.length>0&&g[0].type==x.TYPE_NAME){let n=JSON.parse(t[0].str),s=JSON.parse(g[0].str);s.sub=n.sub,g[0].str=JSON.stringify(s)}else t[0].type=x.TYPE_NAME,g.unshift(t[0])}}),on:[],off:[2]}],y=[8,0,1,2,3,4,5,6,7],C=null;let w=0,T="";for(let i of t){for(let r of((w==t.length-1||i.pageIndex<t[w+1].pageIndex)&&(i.isLastLine=!0),y)){let t=j[r];var I=t.parser.process(g,i,w,C,n[i.pageIndex],s[i.pageIndex]);if(I.length>0){for(let t of I){if(t.type!=c.TYPE_NAME&&t.type!=p.TYPE_NAME&&(T=""),t.type==c.TYPE_NAME){if(!"ABCDEFGH".startsWith(T+t.str))continue;T+=t.str;for(let t=g.length-1;t>=0&&g[t].type==a.TYPE_NAME;t--)g.splice(t,1)}t.type==p.TYPE_NAME&&(i.isFooter=!0),t.type==d.TYPE_NAME&&(b=!0),t.type==u.TYPE_NAME&&b&&j[5].parser.off(),g.push(t)}for(let n of t.on)j[n].parser.on();for(let n of t.off)j[n].parser.off();break}}C=i,w++}for(let t of j)t.parser.off();return g.forEach(n=>{if(!t[n.lineIndex].top){let s=v.getTopLine(i[n.pageIndex],n.lineIndex,t);t[n.lineIndex].top=s[0],1!=n.isIntersec&&(n.isIntersec=s[1])}}),g.forEach(n=>{if(!t[n.lineIndex].bottom){let s=v.getBottomLine(i[n.pageIndex],n.lineIndex,t);t[n.lineIndex].bottom=s[0],1!=n.isIntersec&&(n.isIntersec=s[0])}}),g}showOnCanvas(t,n,s,r,f,g){let b=new Date().getTime(),j=new Map([["A","rgba(18, 0, 255, 0.4)"],["B","rgba(0, 158, 34, 0.4)"],["C","rgba(50, 50, 50, 0.4)"],["D","rgba(132, 0, 137, 0.4)"],["E","rgba(132, 0, 137, 0.4)"],["F","rgba(132, 0, 137, 0.4)"],["G","rgba(132, 0, 137, 0.4)"],["H","rgba(132, 0, 137, 0.4)"]]),y=new Map([[l.TYPE_NAME,"red"],[c.TYPE_NAME,"blue"],[h.TYPE_NAME,"gray"],[x.TYPE_NAME,"green"],[d.TYPE_NAME,"orange"],[u.TYPE_NAME,"pink"],[p.TYPE_NAME,"yellow"],[a.TYPE_NAME,"black"]]);if(g.indexOf("quest")>=0)for(let n of t){for(let t of n.positions)v.drawBox(r[t.pageIndex],n.isGroup?"black":"red",t);for(let t of(v.drawBox(r[n.remove.pageIndex],"yellow",n.remove),n.answers)){for(let n of t.positions)v.drawBox(r[n.pageIndex],j.get(t.label)+"",n,!0);v.drawBox(r[t.remove.pageIndex],"yellow",t.remove),t.isCorrect&&v.drawPoint(r[t.positions[0].pageIndex],"green",t.positions[0])}if(n.help){for(let t of n.help.positions)v.drawBox(r[t.pageIndex],"orange",t);n.help.remove&&v.drawBox(r[n.help.remove.pageIndex],"yellow",n.help.remove)}}if(g.indexOf("line")>=0)for(let t of s)v.drawBox2(r[t.pageIndex],t.height<i.PdfConst.LINE_SMALL_HEIGHT?"red":"rgba(50, 58, 168, 0.4)",t.width,t.height,t.transform);if(g.indexOf("txt")>=0)for(let t of s)for(let n of t.textObjs)""!=n.str.trim()&&v.drawBox2(r[t.pageIndex],t.height<i.PdfConst.LINE_SMALL_HEIGHT?"red":"rgba(132, 0, 137, 0.2)",n.width,n.height,n.transform);if(g.indexOf("img")>=0)for(let t of f)v.drawBox2(r[t.pageIndex],"green",t.paintWidth,t.paintHeight,[0,0,0,0,-t.left,-t.top-t.paintHeight]);if(g.indexOf("pos")>=0)for(let t of n){let n={top:t.transform[5],left:t.transform[4],width:0,heigh:0,pageIndex:t.pageIndex};v.drawPoint(r[t.pageIndex],y.get(t.type)+"",n)}let C=new Date().getTime();this.updateStatusCallback&&this.updateStatusCallback("Draw done: "+(C-b)/1e3+" secs")}getQuestionInfo(t,n,s,r){if(0==t.length)return[];let x=0,f=[],g=new Map,v="",b=!1,j=!1,y=0;for(let C of(t.forEach((s,i)=>{i>0&&null==t[i-1].text&&(t[i-1].text=n.slice(t[i-1].lineIndex,s.lineIndex)),i==t.length-1&&(t[i].text=n.slice(t[i].lineIndex,n.length))}),t.forEach(C=>{let w=":"+C.type;b||C.type!=h.TYPE_NAME&&C.type!=d.TYPE_NAME||(b=!0);let T=null;for(let n=x+1;n<t.length;n++)if((C.type!=l.TYPE_NAME||t[n].type!=c.TYPE_NAME)&&t[n].type!=p.TYPE_NAME){T=t[n];break}let I=s[C.pageIndex].canvas.height-20;if(b||C.type!=a.TYPE_NAME||(y++,f.push({num:y,answers:[],remove:a.getRemoveBox(C,n),positions:a.getBoxes(C,n,T,I),isGroup:!0,text:C.text})),b||C.type!=l.TYPE_NAME||f.push({num:+C.str,answers:[],remove:l.getRemoveBox(C,n),positions:l.getBoxes(C,n,T,I),group:y,text:C.text}),!b&&C.type==c.TYPE_NAME&&f.length>0){let t=f[f.length-1].num,s={label:C.str,remove:c.getRemoveBox(C,n),positions:c.getBoxes(C,n,T,I)};r.size>0&&r.get(t)==s.label&&(s.isCorrect=!0),f[f.length-1].answers.push(s);let l=n[C.lineIndex].strLine.replace(/\|/g,"").trim().match(i.PdfConst.MULTIPLE_ANS_PATTERN.join("|"));null!=l&&l.length>0&&(f[f.length-1].isFixAns=!0),1==C.isIntersec&&(f[f.length-1].isFixAns=!0)}if(!j&&C.type==u.TYPE_NAME&&1==f.length&&v.endsWith(":".concat(l.TYPE_NAME,":").concat(c.TYPE_NAME))&&(j=!0),C.type==u.TYPE_NAME&&j){let t=f[f.length-1].num;g.set(t,{num:t,positions:u.getBoxes(C,n,T,I),text:C.text})}if(C.type!=u.TYPE_NAME||j||(g.clear(),b=!0),b&&C.type==l.TYPE_NAME){let t=+C.str;g.get(t)||g.set(t,{num:t,positions:l.getBoxes(C,n,T,I),remove:l.getRemoveBox(C,n),text:C.text})}v.endsWith(w)||C.type==p.TYPE_NAME||(v+=w),x++}),f))C.isGroup||(C.help=g.get(C.num),1==C.answers.length&&(C.answers=[]));return f}constructor(t,n){var s,r,l;this.cropperService=new g,this.labelHolderSize={width:3500,height:3500},this.totalPoint=10,this.quizId=t,this.callback=n;let a={RENDER_SCALE:2,LINE_SMALL_HEIGHT:8,SPLIT_MARGIN:3,INTERSEC_MARGIN:10,LINE_MAGIN:2,MARGIN_LEFT:2,ENABLE_IMAGE_PROCESS:!0,STEP_SIZE:3,CROP_FULL_WIDTH:!0,OVERLAP:.5,QUESTION_PATTERN:["(^c\xe2u\\s*\\d{1,4}[^0-9])","(^câu\\s*\\d{1,4}[^0-9])","(^c\xa9u\\s*\\d{1,4}[^0-9])","(^ca‚u\\s*\\d{1,4}[^0-9])","(^b\xe0i\\s*\\d{1,4}[^0-9])","(^bài\\s*\\d{1,4}[^0-9])","(^cau\\s*\\d{1,4}[^0-9])","(^bai\\s*\\d{1,4}[^0-9])","(^question\\s*\\d{1,4}[^0-9])","(^questions\\s*\\d{1,4}[^0-9])","(^\\[\\d{1,4}\\][^0-9])","(^\\d+\\s*\\(nb\\))","(^\\d+\\s*\\(th\\))","(^\\d+\\s*\\(vd\\))","(^\\d+\\s*\\(vdc\\))","(^c\xe2u\\s*\\d{1,4}[\\s\\.:]*$)","(^câu\\s*\\d{1,4}[\\s\\.:]*$)","(^c\xa9u\\s*\\d{1,4}[\\s\\.:]*$)","(^ca‚u\\s*\\d{1,4}[\\s\\.:]*$)","(^b\xe0i\\s*\\d{1,4}[\\s\\.:]*$)","(^bài\\s*\\d{1,4}[\\s\\.:]*$)","(^cau\\s*\\d{1,4}[\\s\\.:]*$)","(^bai\\s*\\d{1,4}[\\s\\.:]*$)","(^questions\\s*\\d{1,4}[\\s\\.:]*$)","(^question\\s*\\d{1,4}[\\s\\.:]*$)"],QUESTION_PATTERN2:["(^(\\d+\\s*\\.)\\s*[\\.0-9])","(^(\\d+\\s*\\.)\\s*\\(\\s*\\d+\\s*\\))","(^(\\d+\\s*\\.)\\s*[^\\s]\\s*[^\\s0-9])","(^\\d+\\s*\\.\\s*$)"],BREAK_LINE_PATTERN:["(^C\xe2u\\s*\\d+\\s*[:\\.]\\s*[Aa]\\s*\\.)","(^C\xa9u\\s*\\d+\\s*[:\\.]\\s*[Aa]\\s*\\.)","(^B\xe0i\\s*\\d+\\s*[:\\.]\\s*[Aa]\\s*\\.)","(^Cau\\s*\\d+\\s*[:\\.]\\s*[Aa]\\s*\\.)","(^Bai\\s*\\d+\\s*[:\\.]\\s*[Aa]\\s*\\.)","(^Question\\s*\\d+\\s*[:\\.]\\s*[Aa]\\s*\\.)","(^\\d+\\s*[:\\.]\\s*[Aa]\\s*\\.)"],SECTION_PATTERN_LOWER:["(^mark\\s*the\\s*letter)","(^read\\s*the\\s*follow)","(^reading\\s*the\\s*follow)","(^read\\s*the\\s*text)","(^read\\s*the\\s*passage)","(^read\\s*the\\s*paragraph)","(^read\\s*and\\s*choose)","(^put\\s*these\\s*word)","(^supply\\s*the\\s*correct)","(^make\\s*questions?\\s*for)","(^fill\\s*in\\s*the\\s*blank)","(^fill\\s*in\\s*each\\s*numbered)","(write\\s*the\\s*months\\s*in\\s*english)","(write\\s*the\\s*telephone\\s*numbers\\s*in\\s*english)","(^which\\s*of\\s*the\\s*following)","(^choose\\s*the\\s*suitable\\s*word)","(^choose\\s*the\\s*word)","(^choose\\s*the\\s*option)","(^choose\\s*the\\s*item\\s*among)","(^choose\\s*the\\s*underlined\\s*word)","(^combine\\s*two\\s*sentences)","(^each\\s*of\\s*the\\s*following)","(^finish\\s*the\\s*second\\s*sentence)","(^identify\\s*the\\s*underlined)","(^identify\\s*a\\s*mistake)","(^indicate\\s*the\\s*word)","(^indicate\\s*the\\s*correct)","(^indicate\\s*the\\s*sentence)","(^indicate\\s*the\\s*underlined)","(^circle\\s*the\\s*underlined)","(^circle\\s*the\\s*word\\s*whose\\s*underlined)","(^choose\\s*the\\s*underlined)","(^\\*?find\\s*the\\s*word)","(^find\\s*a\\s*mistake)","(^fill\\s*the\\s*circle)","(^listen\\s*to.*conversation)","(^there\\s*are.*blanks\\s*in\\s*the\\s*passage\\s*below)","(^listen\\s*to\\s*the\\s*recording)","(^listen\\s*and\\s*circle)","(^listen\\s*again\\s*and\\s*choose)","(^\\*?listen\\s*and\\s*complete)","(^\\*?choose\\s*the\\s*best)","(^choose\\s*the\\s*correct)","(^put\\s*in\\s*the\\s*correct)","(^complete\\s*the\\s*second\\s*sentence)","(^complete\\s*the\\s*sentences)","(^give\\s*the\\s*correct\\s*form)","(^mark\\s*a,\\s*b,)","(^circle\\s*the\\s*letter)","(^you\\s*will\\s*hear)","(^blacken\\s*the\\s*letter)","(^đọc\\s*đoạn\\s*tr\xedch)","(^dựa\\s*v\xe0o\\s*th\xf4ng\\s*tin\\s*dưới\\s*đ\xe2y)","(^dựa\\s*v\xe0o\\s*c\xe1c\\s*th\xf4ng\\s*tin\\s*được\\s*cung\\s*cấp\\s*dưới\\s*đ\xe2y)","(^section\\s*[0-9abcdefghivx]+)","(^part[^a-z]+[0-9abcdefghivx]+\\s*[\\.:\\-])","(^phần\\s*[0-9abcdefivx]+[\\.:])","(^nh\xf3m\\s*[0-9abcdefivx]+[\\.:])","(^chương\\s*[0-9abcdefivx]+[\\.:])","(^questions?\\s*\\d+\\s*[\\–\\-to]+\\s*\\d+)","(^passage\\s*[0-9abcdefghivx]+)","(^use\\s*the\\s*word\\s*given\\s*in\\s*capitals)","(^tự\\s*luận)"],SECTION_PATTERN_NORMAL:["(^[IVX]+\\s*[\\.\\-\\–]\\s*[A-Z\xc0Ả\xc3\xc1ẠĂẰẲẴẮẶ\xc2ẦẨẪẤẬĐ\xc8ẺẼ\xc9Ẹ\xcaỀỂỄẾỆ\xccỈĨ\xcdỊ\xd2Ỏ\xd5\xd3Ọ\xd4ỒỔỖỐỘƠỜỞỠỚỢ\xd9ỦŨ\xdaỤƯỪỬỮỨỰỲỶỸ\xddỴ]+)","(^[\\d]+\\.[\\d]+\\.[\\d]*\\.*\\s*[A-Z\xc0Ả\xc3\xc1ẠĂẰẲẴẮẶ\xc2ẦẨẪẤẬĐ\xc8ẺẼ\xc9Ẹ\xcaỀỂỄẾỆ\xccỈĨ\xcdỊ\xd2Ỏ\xd5\xd3Ọ\xd4ỒỔỖỐỘƠỜỞỠỚỢ\xd9ỦŨ\xdaỤƯỪỬỮỨỰỲỶỸ\xddỴ]+)","(^[IVX]+\\s*[\\.:]\\s*$)"],KICK_PATTERN:["(^Chọn\\s*[ABВCDEFGHIJK]+)","(^Chon\\s*[ABВCDEFGHIJK]+)"],TVCN_CHAR:[["Α","A"],["В","B"]],HET_PATTERN:["(HẾT)","(H\xcáT)","(HET)","(\\-\\-HT\\-\\-)","(THE\\s*END)","(The\\s*end[^a-z0-9]*$)","(^[^A-Za-z]*Hết[^A-Za-z]*)$"],DAPAN_PATTERN:["(\xc1P \xc1N)","(\xc1P \xc1)","(\xc1P\xc1N)","(ÁP ÁN)","(BẢNG\xc1\xc1)","(KHO\xc1\\s*C\xc2U\\s*TRẮC\\s*NGHIỆM)","(ÁPÁN)","(ANSWER KEYS)","(^KEYS$)","(Bảng\\s*đ\xe1p\\s*\xe1n)","(Đ\xe1p\\s*\xe1n\\s*v\xe0\\s*hướng)","(Dap\\s*an\\s*va\\s*huong)","(Đ\xe1p\\s*\xe1n\\s*[.:]\\s*$)","(Đ\xe1p\\s*\xe1n\\s*$)"],HUONGDAN_PATTERN:["(HƯỚNG\\s*DẪN)","(ƯỚNG\\s*DẪN\\s*GIẢI\\s*CHI)","(GIẢI\\s*TH\xcdCH\\s*CHI\\s*TIẾT)","(Hướng\\s*dẫn\\s*giải)","(Lời\\s*giải)","(LỜI\\s*GIẢI)","(GIẢI\\s*CHI\\s*TIẾT)","(HD:)","(GLOSSARY)"],MULTIPLE_ANS_PATTERN:["([ABCDEFGH]\\s*v\xe0\\s*[ABCDEFGH]\\s*đều)","(Cả\\s*[ABCDEFGH]\\s*v\xe0\\s*[ABCDEFGH])","(Cả\\s*[ABCDEFGH]\\s*,\\s*[ABCDEFGH])","(Cả\\s*3\\s*đ\xe1p\\s*\xe1n)","(Cả\\s*đ\xe1p\\s*\xe1n)","(Tất\\s*cả\\s*đ\xe1p\\s*\xe1n)","(Kết\\s*quả\\s*kh\xe1c)","(Đ\xe1p\\s*\xe1n\\s*kh\xe1c)","(Đ\xe1p\\s*\xe1n\\s*[ABCDEFGH]\\s*v\xe0\\s*[ABCDEFGH])","(Tất\\s*cả\\s*đều)"],DRAW_RESULT:"",SKIP_CHAR:["","√","p","(",")","[","]","{","}",""],FOOTER_PATTERN:["(trang\\s*\\d+)","(Page\\s*\\d+)","(Trang\\s*\\d+)","(TRANG\\s*\\d+)","(^\\d{1,4}$)","(^[\\-\\s]*\\d{1,4}[\\-\\s]*$)"],HELP_ANS_PATTERN:["([\\s\\.]*Chọn\\s*([A-K]))","([\\d\\s\\.:]*Đ\xe1p\\s*\xe1n\\s*([A-K]))","([\\d\\s\\.:]*Đ\xe1p\\s*\xe1n\\s*l\xe0\\s*([A-K]))","([\\d\\s\\.:]*Chọn\\s*đ\xe1p\\s*\xe1n\\s*([A-K]))"],RES_ANS_PATTERN:["(\\d+[.-][^|0-9])"],STRANS_SPLIT:"|/\\"};i.PdfConst.RENDER_SCALE=a.RENDER_SCALE,i.PdfConst.LINE_SMALL_HEIGHT=a.LINE_SMALL_HEIGHT*i.PdfConst.RENDER_SCALE,i.PdfConst.SPLIT_MARGIN=a.SPLIT_MARGIN*i.PdfConst.RENDER_SCALE,i.PdfConst.INTERSEC_MARGIN=a.INTERSEC_MARGIN*i.PdfConst.RENDER_SCALE,i.PdfConst.LINE_MAGIN=a.LINE_MAGIN*i.PdfConst.RENDER_SCALE,i.PdfConst.MARGIN_LEFT=a.MARGIN_LEFT*i.PdfConst.RENDER_SCALE,i.PdfConst.ENABLE_IMAGE_PROCESS=a.ENABLE_IMAGE_PROCESS,i.PdfConst.STEP_SIZE=a.STEP_SIZE,i.PdfConst.CROP_FULL_WIDTH=a.CROP_FULL_WIDTH,i.PdfConst.OVERLAP=a.OVERLAP,i.PdfConst.QUESTION_PATTERN=a.QUESTION_PATTERN,i.PdfConst.QUESTION_PATTERN2=a.QUESTION_PATTERN2,i.PdfConst.BREAK_LINE_PATTERN=a.BREAK_LINE_PATTERN,i.PdfConst.SECTION_PATTERN_LOWER=a.SECTION_PATTERN_LOWER,i.PdfConst.SECTION_PATTERN_NORMAL=a.SECTION_PATTERN_NORMAL,i.PdfConst.KICK_PATTERN=a.KICK_PATTERN,i.PdfConst.TVCN_CHAR=a.TVCN_CHAR,i.PdfConst.HET_PATTERN=a.HET_PATTERN,i.PdfConst.DAPAN_PATTERN=a.DAPAN_PATTERN,i.PdfConst.HUONGDAN_PATTERN=a.HUONGDAN_PATTERN,i.PdfConst.MULTIPLE_ANS_PATTERN=a.MULTIPLE_ANS_PATTERN,i.PdfConst.DRAW_RESULT=a.DRAW_RESULT,i.PdfConst.SKIP_CHAR=a.SKIP_CHAR,i.PdfConst.FOOTER_PATTERN=null!==(s=a.FOOTER_PATTERN)&&void 0!==s?s:["(trang\\s*\\d+)","(Page\\s*\\d+)","(Trang\\s*\\d+)","(TRANG\\s*\\d+)","(^\\d{1,4}$)"],i.PdfConst.HELP_ANS_PATTERN=null!==(r=a.HELP_ANS_PATTERN)&&void 0!==r?r:["([\\s\\.]*Chọn\\s*([ABCDEFGH]))"],i.PdfConst.ANS_PATTERN=null!==(l=a.ANS_PATTERN)&&void 0!==l?l:["([\\s\\|\\.]+[ABCDEFGHIJK][\\s\\|]*[\\.\\)])"]}}},6591:function(t,n,s){"use strict";Object.defineProperty(n,"__esModule",{value:!0});let i=s(8754),r=i._(s(6781)),l=i._(s(9716)),a=i._(s(1674)),c=(t,n)=>{var s=document.createElement("script");s.type="text/javascript",s.src=t,s.onload=n,s.onerror=t=>{console.log(t)},document.head.appendChild(s)},h=(t,n)=>{var s=0;!function i(){if(s<t.length){var r=t[s];c(a.default.assetPrefix+r,function(){s++,i()})}else"function"==typeof n&&n()}()},d=(t,n)=>{let s=document.createElement("input");s.setAttribute("type","file"),s.setAttribute("accept",".pdf,.docx"),s.click(),s.onchange=async()=>{let[i]=s.files;if(i){n({status:"loading",data:{status:"Đang xử l\xfd tệp tin"}});try{i.name.endsWith(".docx")?h(["/scripts/docx_v3.js","/scripts/sprintf.min.js","/scripts/bundle.js","/scripts/wmf.v1.js","/scripts/FromEMF.f1.js","/scripts/ToContext2D.f1.js","/scripts/UDOC.f1.js","/scripts/mathml2latex.js"],function(){let s=new r.default(t,n);s.parseDocx(i)}):i.name.endsWith(".pdf")?h(["/scripts/pdf.js","/scripts/pdf.worker.js"],function(){let s=new l.default(t,n);s.parsePdf(i)}):n({error:"Định dạng kh\xf4ng hỗ trợ. Vui l\xf2ng sử dụng tập tin định dạng .pdf hoặc .docx"})}catch(t){console.error("Error uploading image:",t),n({error:"Error uploading image:"})}}}};t.exports={ImportFile:d}}},function(t){t.O(0,[265,756,968,774,888,179],function(){return t(t.s=5603)}),_N_E=t.O()}]);