(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[582],{3933:function(e,t,l){(window.__NEXT_P=window.__NEXT_P||[]).push(["/p/leaderboard.html",function(){return l(4974)}])},4974:function(e,t,l){"use strict";l.r(t),l.d(t,{default:function(){return eZ}});var i=l(5893),n=l(6822),r=l(7294),o=l(6242),s=l(8445),a=l(4267),d=l(5152),c=l.n(d);let x=c()(()=>Promise.all([l.e(814),l.e(229)]).then(l.bind(l,7229)),{loadableGenerated:{webpack:()=>[7229]},ssr:!1}),u=(e,t)=>{let l={};return e.forEach(e=>{l[e.number]||(l[e.number]=Array(21).fill(0)),l.total||(l.total=Array(21).fill(0));var i=Math.floor(e.point/t*20);l[e.number][i]++,l.total[i]++}),Object.keys(l).map((e,t)=>({name:"total"==e?"Tất cả":"Đề số ".concat(t+1),data:l[e]}))},h=e=>{let{results:t,maxPoint:l=10}=e,r=u(t,l),d={chart:{height:300,type:"area"},dataLabels:{enabled:!1},stroke:{curve:"smooth"},xaxis:{categories:Array.from({length:21},(e,t)=>">="+parseFloat(t*(l/20)).toFixed(2))},yaxis:{title:{text:"Số b\xe0i l\xe0m"}},scales:{x:{beginAtZero:!0}}};return(0,i.jsxs)(o.Z,{sx:{mb:5},children:[(0,i.jsx)(s.Z,{title:"Phổ điểm",sx:{flexDirection:["column","row"],alignItems:["flex-start","center"],"& .MuiCardHeader-action":{mb:0},"& .MuiCardHeader-content":{mb:[2,0]}},action:(0,i.jsx)(n.Z,{sx:{display:"flex",alignItems:"center"}})}),(0,i.jsx)(a.Z,{children:(0,i.jsx)(x,{height:450,options:d,series:r})})]})};var m=r.memo(h),p=l(5861),v=l(4531);l(6476);var g=l(9878),f=l(7484),j=l.n(f),y=l(178),b=l.n(y),Z=l(9387),C=l.n(Z);j().extend(b()),j().extend(C()),j().tz.setDefault("Asia/Ho_Chi_Minh");var S=j(),k=l(4386),w=l(3946);let I=e=>Math.floor(e/36e5).toString().padStart(2,"0")+":"+Math.floor((e%=36e5)/6e4).toString().padStart(2,"0")+":"+Math.floor((e%=6e4)/1e3).toString().padStart(2,"0"),T=e=>{let{results:t,labelColumn:l,handleClick:a}=e,[d,c]=(0,r.useState)([]),[x,u]=(0,r.useState)(""),[h,m]=(0,r.useState)({page:0,pageSize:25}),[f,j]=(0,r.useState)([]);(0,r.useEffect)(()=>{c(t)},[t]),(0,r.useEffect)(()=>{j(Object.keys(l))},[l]);let y=e=>{u(e)},b=[{flex:.1,minWidth:160,sortable:!1,field:"actions",headerName:"",renderCell:e=>{let{row:t}=e;return(0,i.jsxs)(n.Z,{sx:{display:"flex",alignItems:"center"},children:[(0,i.jsx)(k.Z,{title:"Xem b\xe0i l\xe0m",children:(0,i.jsx)(w.Z,{size:"small",sx:{color:"primary.main"},onClick:a(t.id,"view"),children:(0,i.jsx)(g.Z,{icon:"tabler:eye"})})}),(0,i.jsx)(k.Z,{title:"Lịch sử b\xe0i l\xe0m",children:(0,i.jsx)(w.Z,{size:"small",sx:{color:"success.main"},onClick:a(t.id,"history"),children:(0,i.jsx)(g.Z,{icon:"tabler:mist"})})}),(0,i.jsx)(k.Z,{title:"X\xf3a b\xe0i l\xe0m",children:(0,i.jsx)(w.Z,{size:"small",sx:{color:"error.main"},onClick:a(t,"remove"),children:(0,i.jsx)(g.Z,{icon:"tabler:circle-x"})})})]})}},{flex:.175,minWidth:110,field:"rank",headerName:"Xếp hạng",renderCell:e=>(0,i.jsx)(p.Z,{variant:"body2",sx:{color:"text.primary"},children:e.row.rank})},{flex:.175,minWidth:110,field:"point",headerName:"Điểm",renderCell:e=>(0,i.jsx)(p.Z,{variant:"body2",sx:{color:"text.primary"},children:parseFloat(e.row.point).toFixed(2)})},...f.map(e=>({flex:1,minWidth:250,field:e,headerName:e,renderCell:t=>(0,i.jsx)(p.Z,{variant:"body2",sx:{color:"text.primary"},children:t.row[e]})})),{flex:.175,minWidth:110,field:"right",headerName:"Số c\xe2u đ\xfang",renderCell:e=>(0,i.jsx)(p.Z,{variant:"body2",sx:{color:"text.primary"},children:e.row.right})},{flex:.175,minWidth:110,field:"number",headerName:"Đề số",renderCell:e=>(0,i.jsx)(p.Z,{variant:"body2",sx:{color:"text.primary"},children:e.row.number})},{flex:.175,minWidth:110,field:"retake",headerName:"Lần l\xe0m",renderCell:e=>(0,i.jsx)(p.Z,{variant:"body2",sx:{color:"text.primary"},children:e.row.retake})},{flex:.175,minWidth:110,field:"time",headerName:"Thời gian l\xe0m b\xe0i",renderCell:e=>(0,i.jsx)(p.Z,{variant:"body",sx:{color:"text.primary"},children:I(e.row.time)})},{flex:.175,minWidth:180,field:"startAt",headerName:"Bắt đầu l\xfac",renderCell:e=>(0,i.jsx)(p.Z,{variant:"body2",sx:{color:"text.primary"},children:S(e.row.startAt).format("HH:mm:ss DD/MM/YYYY")})},{flex:.175,minWidth:180,field:"submitAt",headerName:"Nộp b\xe0i l\xfac",renderCell:e=>(0,i.jsx)(p.Z,{variant:"body2",sx:{color:"text.primary"},children:S(e.row.submitAt).format("HH:mm:ss DD/MM/YYYY")})},{flex:.175,minWidth:350,field:"link",headerName:"Link b\xe0i l\xe0m",renderCell:e=>(0,i.jsx)(p.Z,{variant:"body2",sx:{color:"text.primary"},children:(0,i.jsx)("a",{href:e.row.link,target:"_blank",style:{textDecoration:"none"},children:e.row.link})})},{flex:.175,minWidth:150,field:"hidden",headerName:"Số lần chuyển tabs",renderCell:e=>(0,i.jsx)(p.Z,{variant:"body2",sx:{color:"text.primary"},children:e.row.hidden})},{flex:.175,minWidth:150,field:"left",headerName:"Số lần chuột tr\xe1i",renderCell:e=>(0,i.jsx)(p.Z,{variant:"body2",sx:{color:"text.primary"},children:e.row.left})},{flex:.175,minWidth:150,field:"menu",headerName:"Số lần chuột phải",renderCell:e=>(0,i.jsx)(p.Z,{variant:"body2",sx:{color:"text.primary"},children:e.row.menu})},{flex:.175,minWidth:150,field:"offline",headerName:"Số lần Offline",renderCell:e=>(0,i.jsx)(p.Z,{variant:"body2",sx:{color:"text.primary"},children:e.row.offline})},{flex:.175,minWidth:150,field:"devices",headerName:"Thiết bị",renderCell:e=>(0,i.jsx)(p.Z,{variant:"body2",sx:{color:"text.primary"},children:e.row.devices.join(", ")})},{flex:.175,minWidth:150,field:"ip",headerName:"Địa chỉ IP",renderCell:e=>(0,i.jsx)(p.Z,{variant:"body2",sx:{color:"text.primary"},children:e.row.ip.join(", ")})}];return(0,i.jsxs)(o.Z,{children:[(0,i.jsx)(s.Z,{title:"Bảng điểm"}),(0,i.jsx)(v._,{autoHeight:!0,pagination:!0,rows:d,disableColumnFilter:!0,disableColumnMenu:!0,columns:b,pageSizeOptions:[25,50,100],paginationModel:h,onPaginationModelChange:m,slotProps:{baseButton:{size:"medium",variant:"tonal"},toolbar:{value:x,clearSearch:()=>y(""),onChange:e=>y(e.target.value)}}})]})};var P=r.memo(T),M=l(948),W=l(1664),N=l.n(W),_=l(6886);let z=e=>{let{title:t,subtitle:l}=e;return(0,i.jsxs)(_.ZP,{item:!0,xs:12,children:[t,l||null]})};var H=l(1163),O=l(7274),F=l(7533),L=l(7494),B=l(7413),D=l(2162),Y=l(9601),A=l(1221),E=l(6599),R=l(3321);let q=(0,M.ZP)(E.Z)({"& .MuiTimelineItem-root":{width:"100%","&:before":{display:"none"}}}),V=(0,M.ZP)(n.Z)(e=>{let{theme:t}=e;return{display:"flex",alignItems:"center",padding:t.spacing(3),justifyContent:"space-between",backgroundColor:"#F8F8F8"}}),J=e=>{var t,l,r,o;let{details:s,handleClose:a,handleClick:d}=e;return(0,i.jsxs)(F.ZP,{open:!0,anchor:"right",variant:"temporary",onClose:a,ModalProps:{keepMounted:!0},sx:{"& .MuiDrawer-paper":{width:{md:"50%",xs:"95%"}}},children:[(0,i.jsxs)(V,{children:[(0,i.jsxs)(p.Z,{variant:"h5",children:["Lịch sử l\xe0m b\xe0i của: ",null==s?void 0:null===(t=s.payload)||void 0===t?void 0:t.student]}),(0,i.jsx)(w.Z,{size:"small",onClick:a,sx:{p:"0.438rem",borderRadius:1,color:"text.primary",backgroundColor:"action.selected","&:hover":{backgroundColor:e=>"rgba(".concat(e.palette.customColors.main,", 0.16)")}},children:(0,i.jsx)(g.Z,{icon:"tabler:x",fontSize:"1.125rem"})})]}),(0,i.jsx)(n.Z,{sx:{mt:3,px:3},children:(0,i.jsx)(q,{children:null==s?void 0:null===(l=s.payload)||void 0===l?void 0:null===(r=l.logs)||void 0===r?void 0:r.map((e,t)=>(0,i.jsxs)(B.Z,{children:[(0,i.jsxs)(Y.Z,{children:[(0,i.jsx)(L.Z,{color:"error"}),(0,i.jsx)(A.Z,{})]}),(0,i.jsxs)(D.Z,{sx:{"& svg":{verticalAlign:"bottom",mx:4}},children:[(0,i.jsx)(n.Z,{sx:{mb:2,display:"flex",flexWrap:"wrap",alignItems:"center",justifyContent:"space-between"},children:(0,i.jsx)(p.Z,{sx:{mr:2},variant:"h5",dangerouslySetInnerHTML:{__html:e.text}})}),(0,i.jsx)(n.Z,{children:(0,i.jsx)(p.Z,{variant:"body",sx:{color:"text.disabled"},children:j()(e.t).format("HH:mm:ss DD/MM/YYYY")})})]})]},t))})}),(0,i.jsx)(V,{sx:{justifyContent:"flex-end"},children:(0,i.jsx)(R.Z,{onClick:d(null==s?void 0:null===(o=s.payload)||void 0===o?void 0:o.id,"view"),variant:"contained",startIcon:(0,i.jsx)(g.Z,{icon:"tabler:eye"}),children:"Chi tiết b\xe0i l\xe0m"})})]})};var X=r.memo(J),G=l(7720),U=l(8462),K=l(8885),Q=l(9294),$=l(410),ee=l(1008);l(8594);var et=l(5600),el=l(8232),ei=l(7109);let en=()=>{let e=document.querySelectorAll(".quill-image");e.forEach(e=>{try{let{link:t,data:l}=JSON.parse(e.getAttribute("data-value")),i=document.createElement("canvas"),n=i.getContext("2d"),r=new Image;r.src=t,r.crossOrigin="anonymous",r.onload=function(){i.width=l.width,i.height=l.height,n.drawImage(r,l.x,l.y,l.width,l.height,0,0,l.width,l.height),e.setAttribute("src",i.toDataURL("image/png"))}}catch(e){console.log(e.message)}})},er=()=>{let e=document.querySelectorAll(".ql-formula");e.forEach(e=>{try{let t=e.getAttribute("data-value");t&&(e.innerHTML=ee.Z.renderToString(t,{throwOnError:!1}))}catch(e){console.log(e.message)}})},eo=e=>{var t,l,d;let{details:c,updatePoint:x}=e;return(0,r.useEffect)(()=>{c&&(en(),er())},[c]),null==c?void 0:null===(t=c.payload)||void 0===t?void 0:null===(l=t.details)||void 0===l?void 0:null===(d=l.groups)||void 0===d?void 0:d.map(e=>{var t,l,r,d;return(0,i.jsxs)(o.Z,{sx:{mt:10,background:"unset"},children:[e.content&&(null==c?void 0:null===(t=c.payload)||void 0===t?void 0:null===(l=t.details)||void 0===l?void 0:l.groups.length)>1?(0,i.jsx)(a.Z,{dangerouslySetInnerHTML:{__html:e.content}}):null,(0,i.jsx)(a.Z,{sx:{padding:0,":last-of-type":{pb:0}},children:null==c?void 0:null===(r=c.payload)||void 0===r?void 0:null===(d=r.details)||void 0===d?void 0:d.questions.filter(t=>t.groupId==e.id).map((e,t)=>{var l,r;return(0,i.jsxs)(o.Z,{sx:{mb:5,":last-of-type":{mb:0}},id:e.id,children:[(0,i.jsx)(s.Z,{title:(0,i.jsxs)(p.Z,{variant:"body",sx:{fontWeight:700,color:"primary.main",fontSize:"1.3rem"},children:[e.label||"C\xe2u"," ",e.numberUser," (",e.label||"C\xe2u"," ",e.number,")."]}),action:(0,i.jsxs)(n.Z,{sx:{display:"flex",alignItems:"center"},children:[["TN","HK"].includes(e.type)?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(et.Z,{rounded:!0,label:"Đ\xe1p \xe1n đ\xfang: "+(null==e?void 0:null===(l=e.options)||void 0===l?void 0:l.map((e,t)=>(null==e?void 0:e.keys)?"".concat(String.fromCharCode(65+t)," (").concat(String.fromCharCode(65+e.postion),")"):"").filter(e=>e).join(", ")),skin:"light",color:"success"}),(0,i.jsx)(et.Z,{rounded:!0,label:"Đ\xe3 chọn: "+((null==e?void 0:e.answers)?null==e?void 0:null===(r=e.answers)||void 0===r?void 0:r.map(t=>{var l=null==e?void 0:e.options[t];return"".concat(String.fromCharCode(65+t)," (").concat(String.fromCharCode(65+l.postion),")")}).join(", "):""),skin:"light",color:e.isTrue?"success":"error",sx:{mx:1}})]}):null,["TL"].includes(e.type)?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(et.Z,{rounded:!0,label:"GV chấm:",skin:"light",color:"info"}),(0,i.jsx)(el.Z,{type:"number",size:"small",sx:{width:"auto",maxWidth:"8rem",mx:2},value:e.teacher||0,InputProps:{inputProps:{min:0,max:parseFloat(e.maxPoint),step:.01},endAdornment:(0,i.jsx)(ei.Z,{position:"end",children:"điểm"})},onChange:t=>x(e.id,{teacher:t}),timeout:300}),(0,i.jsx)(et.Z,{rounded:!0,label:"Tối đa: ".concat(parseFloat(e.maxPoint).toFixed(2)," điểm"),skin:"light",color:"success"})]}):(0,i.jsx)(p.Z,{variant:"body",sx:{fontWeight:700,color:e.isTrue?"success.main":"error.main"},children:-1==e.point?"":parseFloat(e.point).toFixed(2)+" điểm"})]}),sx:{paddingY:3}}),(0,i.jsx)(a.Z,{dangerouslySetInnerHTML:{__html:e.content},sx:{" p":{m:0},py:0}}),(0,i.jsx)(a.Z,{sx:{px:1,mt:3},children:(0,i.jsxs)(U.Z,{disablePadding:!0,children:[["TN","HK"].includes(e.type)?e.options.map((e,t)=>(0,i.jsxs)(Q.ZP,{sx:{borderRadius:1,mb:1,border:"1px solid #b2b2b299"},user:e.user||"",children:[(0,i.jsx)(K.Z,{children:(0,i.jsxs)($.Z,{skin:(null==e?void 0:e.user)?"static":"light",sx:{fontWeight:600},children:[String.fromCharCode(65+t)," (",String.fromCharCode(65+e.postion),")"]})}),(0,i.jsx)(n.Z,{dangerouslySetInnerHTML:{__html:e.text},sx:{" p":{m:0},flexGrow:1}})]},t)):null,"TF"==e.type?e.options.map((e,t)=>(0,i.jsxs)(Q.ZP,{divider:!0,sx:{gap:1,cursor:"default",paddingX:2},children:[(0,i.jsx)($.Z,{skin:"light",user:(null==e?void 0:e.user[0])||"",children:"Đ"}),(0,i.jsx)($.Z,{skin:"light",user:(null==e?void 0:e.user[1])||"",children:"S"}),(0,i.jsxs)($.Z,{skin:"light",color:"secondary",sx:{fontWeight:600},children:[String.fromCharCode(97+t)," (",String.fromCharCode(97+(null==e?void 0:e.postion)),")"]}),(0,i.jsx)(n.Z,{dangerouslySetInnerHTML:{__html:e.text},sx:{" p":{m:0},flexGrow:1}})]},t)):null]})}),"TL"==e.type?(0,i.jsxs)(a.Z,{sx:{px:2},children:[(0,i.jsx)(G.Z,{sx:{fontWeight:600},children:"B\xe0i l\xe0m của học sinh"}),(0,i.jsx)(n.Z,{dangerouslySetInnerHTML:{__html:((null==e?void 0:e.answers)||[])[0]||""},sx:{" p":{m:0}}})]}):null,"DT"==e.type?(0,i.jsx)(a.Z,{sx:{px:2},children:(0,i.jsxs)(_.ZP,{container:!0,spacing:3,children:[(0,i.jsxs)(_.ZP,{item:!0,xs:12,md:6,children:[(0,i.jsx)(G.Z,{sx:{fontWeight:600},children:"Đ\xe1p \xe1n của học sinh"}),(0,i.jsx)(n.Z,{dangerouslySetInnerHTML:{__html:((null==e?void 0:e.answers)||[])[0]||""},sx:{" p":{m:0}}})]}),(0,i.jsx)(_.ZP,{item:!0,xs:12,md:6,sx:{color:"success.main"},children:e.options.length?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(G.Z,{sx:{fontWeight:600},children:"Đ\xe1p \xe1n đ\xfang"}),e.options.map((e,t)=>(0,i.jsxs)(p.Z,{variant:"body",children:[e.text," |"," "]},t))]}):null})]})}):null]},e.id)})})]},e.id)})};var es=r.memo(eo),ea=l(3395),ed=l(9334);let ec=e=>Math.floor(e/36e5).toString().padStart(2,"0")+":"+Math.floor((e%=36e5)/6e4).toString().padStart(2,"0")+":"+Math.floor((e%=6e4)/1e3).toString().padStart(2,"0"),ex=e=>{var t,l,n;let{details:o}=e,{points:s}=null==o?void 0:null===(t=o.payload)||void 0===t?void 0:t.overview,{overview:a}=null==o?void 0:o.payload,{collects:d=[]}=null==o?void 0:null===(l=o.payload)||void 0===l?void 0:l.details,c=null==o?void 0:null===(n=o.payload)||void 0===n?void 0:n.Username,[u,h]=(0,r.useState)(0);return(0,r.useEffect)(()=>{var e,t,l;let i=null==o?void 0:null===(e=o.payload)||void 0===e?void 0:null===(t=e.details)||void 0===t?void 0:null===(l=t.questions)||void 0===l?void 0:l.reduce((e,t)=>e+=parseFloat(t.teacher||t.point),0);h(i||0)},[o]),(0,i.jsxs)(_.ZP,{container:!0,spacing:3,sx:{px:3},children:[(0,i.jsxs)(_.ZP,{item:!0,xs:12,md:4,children:[(0,i.jsx)(G.Z,{children:"ĐIỂM"}),(0,i.jsx)(x,{series:[parseFloat(100*u/s||0).toFixed(2)],options:{chart:{height:300,type:"radialBar",sparkline:{enabled:!0}},colors:["#51e5a8"],plotOptions:{radialBar:{offsetY:-10,startAngle:-150,endAngle:150,hollow:{margin:0,size:"75%"},track:{background:"#ebe9f1",strokeWidth:"50%",margin:0},dataLabels:{show:!0,name:{show:!1,color:"#5e5873",fontSize:"2.86rem"},value:{formatter:e=>parseFloat(e*s/100||0).toFixed(2),color:"#5e5873",fontSize:"2.86rem",show:!0}}}},fill:{type:"gradient",gradient:{shade:"dark",type:"horizontal",shadeIntensity:.5,gradientToColors:["#51e5a8"],inverseColors:!0,opacityFrom:1,opacityTo:1,stops:[0,100]}},stroke:{lineCap:"round"},labels:[""],grid:{padding:{bottom:30}}},type:"radialBar",height:300})]}),(0,i.jsxs)(_.ZP,{item:!0,xs:12,md:4,children:[c?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(G.Z,{sx:{mt:2},children:"TH\xd4NG TIN TH\xcd SINH"}),(0,i.jsxs)(U.Z,{children:[(0,i.jsx)(Q.ZP,{disablePadding:!0,children:(0,i.jsxs)(K.Z,{sx:{alignItems:"center",color:"primary.main"},children:[(0,i.jsx)(g.Z,{icon:"tabler:user-bolt",fontSize:20}),(0,i.jsxs)(ed.Z,{sx:{fontWeight:600,ml:1},disableTypography:!0,children:["Họ v\xe0 t\xean: ",null==c?void 0:c.fullname]})]})}),(0,i.jsx)(Q.ZP,{disablePadding:!0,children:(0,i.jsxs)(K.Z,{sx:{alignItems:"center",color:"primary.main"},children:[(0,i.jsx)(g.Z,{icon:"tabler:cash-banknote",fontSize:20}),(0,i.jsxs)(ed.Z,{sx:{fontWeight:600,ml:1},disableTypography:!0,children:["Lớp: ",null==c?void 0:c.classes]})]})}),(0,i.jsx)(Q.ZP,{disablePadding:!0,children:(0,i.jsxs)(K.Z,{sx:{alignItems:"center",color:"primary.main"},children:[(0,i.jsx)(g.Z,{icon:"tabler:school",fontSize:20}),(0,i.jsxs)(ed.Z,{sx:{fontWeight:600,ml:1},disableTypography:!0,children:["Trường: ",null==c?void 0:c.school]})]})})]})]}):null,d.length?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(G.Z,{children:"TH\xd4NG TIN THU THẬP"}),(0,i.jsx)(U.Z,{children:d.map((e,t)=>(0,i.jsx)(Q.ZP,{disablePadding:!0,children:(0,i.jsxs)(K.Z,{sx:{alignItems:"center",color:"primary.main"},children:[(0,i.jsx)(g.Z,{icon:"tabler:point",fontSize:20}),(0,i.jsxs)(ed.Z,{sx:{fontWeight:600,ml:1},disableTypography:!0,children:[null==e?void 0:e.label,": ",null==e?void 0:e.value]})]})},t))})]}):null]}),(0,i.jsxs)(_.ZP,{item:!0,xs:12,md:4,children:[(0,i.jsx)(G.Z,{children:"TH\xd4NG TIN B\xc0I THI"}),(0,i.jsxs)(U.Z,{children:[(0,i.jsx)(Q.ZP,{disablePadding:!0,children:(0,i.jsxs)(K.Z,{sx:{alignItems:"center",color:"warning.main"},children:[(0,i.jsx)(g.Z,{icon:"tabler:clock",fontSize:20}),(0,i.jsx)(ed.Z,{sx:{fontWeight:600,ml:1},disableTypography:!0,children:"Thời gian l\xe0m b\xe0i:"}),(0,i.jsx)(ea.Z,{sx:{fontWeight:600,fontSize:"1.2rem"},children:ec(a.time)})]})}),(0,i.jsx)(Q.ZP,{disablePadding:!0,children:(0,i.jsxs)(K.Z,{sx:{alignItems:"center"},children:[(0,i.jsx)(g.Z,{icon:"tabler:clock",fontSize:20}),(0,i.jsx)(ed.Z,{sx:{fontWeight:600,ml:1},disableTypography:!0,children:"Bắt đầu l\xfac:"}),(0,i.jsx)(ea.Z,{sx:{fontWeight:600,fontSize:"1.2rem"},children:j()(a.startAt).format("HH:mm:ss DD/MM/YYYY")})]})}),(0,i.jsx)(Q.ZP,{disablePadding:!0,children:(0,i.jsxs)(K.Z,{sx:{alignItems:"center"},children:[(0,i.jsx)(g.Z,{icon:"tabler:clock",fontSize:20}),(0,i.jsx)(ed.Z,{sx:{fontWeight:600,ml:1},disableTypography:!0,children:"Nộp b\xe0i l\xfac:"}),(0,i.jsx)(ea.Z,{sx:{fontWeight:600,fontSize:"1.2rem"},children:j()(a.submitAt).format("HH:mm:ss DD/MM/YYYY")})]})}),(0,i.jsx)(Q.ZP,{disablePadding:!0,children:(0,i.jsxs)(K.Z,{sx:{alignItems:"center",color:"success.main"},children:[(0,i.jsx)(g.Z,{icon:"tabler:circle-check",fontSize:20}),(0,i.jsx)(ed.Z,{sx:{fontWeight:600,ml:1},disableTypography:!0,children:"Số c\xe2u trắc nghiệm đ\xfang"}),(0,i.jsx)(ea.Z,{sx:{fontWeight:600,fontSize:"1.2rem"},children:a.right})]})}),(0,i.jsx)(Q.ZP,{disablePadding:!0,children:(0,i.jsxs)(K.Z,{sx:{alignItems:"center",color:"error.main"},children:[(0,i.jsx)(g.Z,{icon:"tabler:circle-x",fontSize:20}),(0,i.jsx)(ed.Z,{sx:{fontWeight:600,ml:1},disableTypography:!0,children:"Số c\xe2u trắc nghiệm sai"}),(0,i.jsx)(ea.Z,{sx:{fontWeight:600,fontSize:"1.2rem"},children:a.error})]})}),(0,i.jsx)(Q.ZP,{disablePadding:!0,children:(0,i.jsxs)(K.Z,{sx:{alignItems:"center"},children:[(0,i.jsx)(g.Z,{icon:"tabler:sum",fontSize:20}),(0,i.jsx)(ed.Z,{sx:{fontWeight:600,ml:1},disableTypography:!0,children:"Tổng số c\xe2u hỏi trong đề"}),(0,i.jsx)(ea.Z,{sx:{fontWeight:600,fontSize:"1.2rem"},children:a.total})]})}),(0,i.jsx)(Q.ZP,{disablePadding:!0,children:(0,i.jsxs)(K.Z,{sx:{alignItems:"center"},children:[(0,i.jsx)(g.Z,{icon:"tabler:sum",fontSize:20}),(0,i.jsx)(ed.Z,{sx:{fontWeight:600,ml:1},disableTypography:!0,children:"Đề số"}),(0,i.jsx)(ea.Z,{sx:{fontWeight:600,fontSize:"1.2rem"},children:a.number})]})}),(0,i.jsx)(Q.ZP,{disablePadding:!0,children:(0,i.jsxs)(K.Z,{sx:{alignItems:"center"},children:[(0,i.jsx)(g.Z,{icon:"tabler:sum",fontSize:20}),(0,i.jsx)(ed.Z,{sx:{fontWeight:600,ml:1,a:{textDecoration:"none"}},disableTypography:!0,children:"Link b\xe0i l\xe0m:"}),(0,i.jsx)(ea.Z,{sx:{fontWeight:600,fontSize:"1.2rem",a:{textDecoration:"none"}},children:(0,i.jsx)("a",{href:a.link,target:"_blank",children:"Click để xem"})})]})})]})]})]})};var eu=l(6455),eh=l.n(eu);let em=(0,M.ZP)(n.Z)(e=>{let{theme:t}=e;return{display:"flex",alignItems:"center",padding:t.spacing(3),justifyContent:"space-between",backgroundColor:"#F8F8F8"}}),ep=e=>{var t,l,o,s;let{details:a,handleClose:d,handleClick:c,saveResults:x}=e,[u,h]=(0,r.useState)(a);(0,r.useEffect)(()=>{var e;h(a),sessionStorage.removeItem("results_"+(null==a?void 0:null===(e=a.payload)||void 0===e?void 0:e.id))},[a]);let m=(e,t)=>{var l,i;let n=JSON.parse(sessionStorage.getItem("results_"+(null==u?void 0:null===(l=u.payload)||void 0===l?void 0:l.id))||"{}");sessionStorage.setItem("results_"+(null==u?void 0:null===(i=u.payload)||void 0===i?void 0:i.id),JSON.stringify({...n,comments:{...(null==n?void 0:n.comments)||{},[e]:t}})),h(l=>{var i,n,r;return{...l,payload:{...l.payload,details:{...null==l?void 0:null===(i=l.payload)||void 0===i?void 0:i.details,comments:{...null==l?void 0:null===(n=l.payload)||void 0===n?void 0:null===(r=n.details)||void 0===r?void 0:r.comments,[e]:t}}}}})},v=(e,t)=>{var l;let{teacher:i}=t,n=JSON.parse(sessionStorage.getItem("results_"+(null==u?void 0:null===(l=u.payload)||void 0===l?void 0:l.id))||"{}");h(t=>{var l,r,o,s;return{...t,payload:{...t.payload,details:{...null==t?void 0:null===(l=t.payload)||void 0===l?void 0:l.details,questions:null==t?void 0:null===(r=t.payload)||void 0===r?void 0:null===(o=r.details)||void 0===o?void 0:null===(s=o.questions)||void 0===s?void 0:s.map(t=>{if(t.id==e){var l;return sessionStorage.setItem("results_"+(null==u?void 0:null===(l=u.payload)||void 0===l?void 0:l.id),JSON.stringify({...n,points:{...(null==n?void 0:n.points)||{},[e]:Math.min(i,t.maxPoint)}})),{...t,teacher:Math.min(i,t.maxPoint)}}return t})}}}})},f=()=>{try{var e,t;let{comments:l={},points:i={}}=JSON.parse(sessionStorage.getItem("results_"+(null==u?void 0:null===(e=u.payload)||void 0===e?void 0:e.id))||"{}");Object.keys(l).length||Object.keys(i).length?x(null==u?void 0:null===(t=u.payload)||void 0===t?void 0:t.id):eh().fire("Bạn chưa chỉnh sửa g\xec","","info")}catch(e){}},j=()=>{var e;let{comments:t={},points:l={}}=JSON.parse(sessionStorage.getItem("results_"+(null==u?void 0:null===(e=u.payload)||void 0===e?void 0:e.id))||"{}");Object.keys(t).length||Object.keys(l).length?eh().fire({icon:"warning",title:"Ch\xfa \xfd",html:'Bạn chưa lưu kết quả chấm điểm của b\xe0i l\xe0m n\xe0y. Vui l\xf2ng nhấn <b style="color:red">Lưu b\xe0i l\xe0m</b> trước khi tho\xe1t.',showCancelButton:!0,cancelButtonText:"Đ\xe3 hiểu",cancelButtonColor:"#d33",confirmButtonText:"Kh\xf4ng lưu"}).then(e=>{if(e.isConfirmed){var t;sessionStorage.removeItem("results_"+(null==u?void 0:null===(t=u.payload)||void 0===t?void 0:t.id)),d()}}):d()},y=()=>{var e,t;let{comments:l={},points:i={}}=JSON.parse(sessionStorage.getItem("results_"+(null==u?void 0:null===(e=u.payload)||void 0===e?void 0:e.id))||"{}");Object.keys(l).length||Object.keys(i).length?eh().fire({icon:"warning",title:"Ch\xfa \xfd",html:'Bạn chưa lưu kết quả chấm điểm của b\xe0i l\xe0m n\xe0y. Vui l\xf2ng nhấn <b style="color:red">Lưu b\xe0i l\xe0m</b> trước khi tho\xe1t.',showCancelButton:!0,cancelButtonText:"Đ\xe3 hiểu",cancelButtonColor:"#d33",confirmButtonText:"Kh\xf4ng lưu"}).then(e=>{if(e.isConfirmed){var t,l;sessionStorage.removeItem("results_"+(null==u?void 0:null===(t=u.payload)||void 0===t?void 0:t.id)),c(null==u?void 0:null===(l=u.payload)||void 0===l?void 0:l.id,"history")}}):(console.log("handleClick"),c(null==u?void 0:null===(t=u.payload)||void 0===t?void 0:t.id,"history")())};return(0,i.jsxs)(F.ZP,{open:!0,anchor:"right",variant:"temporary",onClose:j,ModalProps:{keepMounted:!0},sx:{"& .MuiDrawer-paper":{width:"80%"}},children:[(0,i.jsxs)(em,{children:[(0,i.jsxs)(p.Z,{variant:"h5",children:["B\xe0i l\xe0m của: ",null==u?void 0:null===(t=u.payload)||void 0===t?void 0:t.student]}),(0,i.jsx)(w.Z,{size:"small",onClick:j,sx:{p:"0.438rem",borderRadius:1,color:"text.primary",backgroundColor:"action.selected","&:hover":{backgroundColor:e=>"rgba(".concat(e.palette.customColors.main,", 0.16)")}},children:(0,i.jsx)(g.Z,{icon:"tabler:x",fontSize:"1.125rem"})})]}),(0,i.jsxs)(n.Z,{sx:{mt:3},children:[(0,i.jsx)(ex,{details:u}),(0,i.jsxs)(n.Z,{sx:{px:3},children:[(0,i.jsx)(G.Z,{children:"NHẬN X\xc9T CỦA GI\xc1O VI\xcaN"}),(0,i.jsx)(el.Z,{fullWidth:!0,multiline:!0,minRows:3,value:((null==u?void 0:null===(l=u.payload)||void 0===l?void 0:null===(o=l.details)||void 0===o?void 0:o.comments)||{})[null==u?void 0:null===(s=u.payload)||void 0===s?void 0:s.id]||"",onChange:e=>{var t;return m(null==u?void 0:null===(t=u.payload)||void 0===t?void 0:t.id,e)}})]}),(0,i.jsxs)(n.Z,{sx:{px:3},children:[(0,i.jsx)(G.Z,{children:"CHI TIẾT B\xc0I L\xc0M"}),(0,i.jsx)(es,{details:u,updatePoint:v})]})]}),(0,i.jsxs)(em,{sx:{justifyContent:"flex-end"},children:[(0,i.jsx)(R.Z,{onClick:y,variant:"contained",color:"success",startIcon:(0,i.jsx)(g.Z,{icon:"tabler:mist"}),children:"Lịch sử b\xe0i l\xe0m"}),(0,i.jsx)(R.Z,{onClick:f,variant:"contained",startIcon:(0,i.jsx)(g.Z,{icon:"tabler:device-floppy"}),sx:{ml:2},children:"Lưu b\xe0i l\xe0m"})]})]})},ev=e=>{let{details:t,handleClose:l,handleClick:n,saveResults:r}=e;return"history"==t.open?(0,i.jsx)(X,{details:t,handleClose:l,handleClick:n}):"view"==t.open?(0,i.jsx)(ep,{details:t,handleClose:l,handleClick:n,saveResults:r}):null};var eg=r.memo(ev),ef=l(1649),ej=l(7052);let ey=(0,M.ZP)(N())(e=>{let{theme:t}=e;return{textDecoration:"none",color:t.palette.primary.main}}),eb=()=>{var e,t;let l=(0,H.useRouter)(),o=(0,ef.I0)(),[s,a]=(0,r.useState)({exams:null,results:[],labels:[],time:null}),[d,c]=(0,r.useState)({open:!1,payload:{}}),x=(0,r.useRef)(null);(0,r.useEffect)(()=>{o((0,ej.V)({status:"Đang tải..."})),x.current&&x.current.terminate(),x.current=new Worker("/scripts/worker.js"),x.current.onmessage=async e=>{let{action:t="",payload:l=null}=e.data;switch(console.log(l),t){case"fetchLeaderboard":a(l),o((0,ej.V)({status:""}));break;case"viewDetails":c({open:"view",payload:l});break;case"historyDetails":c({open:"history",payload:l});break;case"updateRealtime":a(e=>({...e,...l}))}};let e=async()=>{try{let{parent:e="",id:t=""}=l.query;if(!t)return l.push("/");await O.default.get("/leaderboard/".concat(t,"/timeout"));let{data:i}=await O.default.get("/quizs/".concat(t,"/details?parent=").concat(e)),{data:n}=await O.default.get("/leaderboard/".concat(t,"?parent=").concat(e));if((null==i?void 0:i.error)||(null==n?void 0:n.error))return eh().fire({icon:"error",title:"Oops...",text:(null==i?void 0:i.error)||(null==n?void 0:n.error),footer:'<a href="#">Tại sao t\xf4i gặp th\xf4ng b\xe1o n\xe0y?</a>'}),l.push("/");x.current.postMessage({action:"fetchLeaderboard",payload:{response:i,results:n}})}catch(e){console.log("fetchData",e.message)}};return l.isReady&&e(),()=>{x.current&&x.current.terminate()}},[l,o]);let u=(e,t)=>()=>{switch(t){case"remove":eh().fire({title:"Bạn chắc chứ?",html:'<p>Bạn đang muốn xo\xe1 b\xe0i l\xe0m của th\xed sinh: <b style="color:red">'.concat((null==e?void 0:e.student)||(null==e?void 0:e.id),"</b>?</p>"),icon:"warning",showCancelButton:!0,confirmButtonText:"V\xe2ng. X\xf3a đi!",cancelButtonText:"Hủy"}).then(async t=>{if(t.isConfirmed){var i;o((0,ej.V)({status:"Vui l\xf2ng đợi..."}));let{data:{error:t,text:n,time:r}}=await O.default.delete("/leaderboard/".concat(null===(i=l.query)||void 0===i?void 0:i.id,"?resultId=").concat(null==e?void 0:e.id));if(o((0,ej.V)({status:""})),t)return eh().fire(t,"","error");eh().fire(n,"","success"),x.current.postMessage({action:"currentRealtime",payload:{...s,results:s.results.filter(t=>t.ResultId!=(null==e?void 0:e.id)),time:r}})}});break;case"view":x.current.postMessage({action:"viewDetails",payload:{id:e,leaderboard:s}});break;case"download":break;case"history":x.current.postMessage({action:"historyDetails",payload:{id:e,leaderboard:s}})}},h=async e=>{try{let{comments:t={},points:i={}}=JSON.parse(sessionStorage.getItem("results_"+e)||"{}");if(Object.keys(t).length||Object.keys(i).length){let{id:n=""}=l.query;o((0,ej.V)({status:"Đang lưu"}));let{data:r}=await O.default.post("/leaderboard/".concat(n,"?resultId=").concat(e),{comments:t,points:i});if(o((0,ej.V)({status:""})),r.error)return eh().fire("Xảy ra lỗi!",r.error,"error");eh().fire({icon:"success",title:"Đ\xe3 lưu",timer:1500}),sessionStorage.removeItem("results_"+e),x.current.postMessage({action:"updateResult",payload:{results:{...r,id:e},leaderboard:s}}),c({open:!1})}}catch(e){console.log("saveResults",e.message)}};return(0,i.jsxs)(n.Z,{children:[(0,i.jsx)(z,{title:(0,i.jsx)(p.Z,{variant:"h4",children:(0,i.jsx)(ey,{href:"/p/create.html?parent=".concat(l.query.parent,"&id=").concat(l.query.id),children:(null==s?void 0:null===(e=s.exams)||void 0===e?void 0:null===(t=e.settings)||void 0===t?void 0:t.title)||"..."})}),subtitle:(0,i.jsxs)(p.Z,{sx:{color:"text.secondary",mb:5},children:["(Cập nhật l\xfac ",S(null==s?void 0:s.time).format("HH:mm:ss DD/MM/YYYY"),")"]})}),(0,i.jsx)(m,{results:s.results.map(e=>{var t,l;return{point:null==e?void 0:null===(t=e.overview)||void 0===t?void 0:t.point,number:null==e?void 0:null===(l=e.overview)||void 0===l?void 0:l.number}}),maxPoint:10}),(0,i.jsx)(P,{results:s.results.map(e=>({...e.overview,id:e.ResultId})).sort((e,t)=>t.point!==e.point?t.point-e.point:t.time!==e.time?e.time-t.time:e.startAt-t.startAt).map((e,t)=>({...e,rank:t+1})),labelColumn:s.labels,handleClick:u}),(0,i.jsx)(eg,{details:d,handleClose:()=>{c({open:!1})},handleClick:u,saveResults:h})]})};var eZ=()=>(0,i.jsx)(eb,{})},8232:function(e,t,l){"use strict";var i=l(5893),n=l(7294),r=l(1903);let o=e=>(e||"").toLowerCase().split(" ").map(function(e){return e.replace(e.charAt(0),e.charAt(0).toUpperCase())}).join(" "),s=e=>{let t=Object.fromEntries(Object.entries(e).filter(e=>{let[t]=e;return!["onSearch","capitalize","uppercase","timeout"].includes(t)})),[l,s]=(0,n.useState)(e.value||""),a=(0,n.useRef)(null),d=t=>{var{value:l}=t.target;l=e.uppercase?(l||"").toLocaleUpperCase():l||"",s(l=e.capitalize?o(l||""):l||""),clearTimeout(a.current),a.current=setTimeout(()=>{e.onChange&&e.onChange(l)},e.timeout||500)};return(0,n.useEffect)(()=>()=>{clearTimeout(a.current)},[]),(0,n.useEffect)(()=>{e.value!=l&&s(e.value||"")},[e.value]),(0,i.jsx)(r.Z,{...t,onChange:d,value:l})};t.Z=s}},function(e){e.O(0,[265,125,336,850,560,774,888,179],function(){return e(e.s=3933)}),_N_E=e.O()}]);