"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[73],{6316:function(e,t,n){var r=n(7294),i=n(6485),l=n.n(i);let a=e=>e&&("TEXTAREA"===e.nodeName||"INPUT"===e.nodeName);t.Z=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=(0,r.useRef)(null),n=()=>{e.onSuccess&&e.onSuccess(),e.selectOnCopy&&a(t.current)&&t.current.select()},i=()=>{e.onError&&e.onError();let n=!1!==e.selectOnError;n&&a(t.current)&&t.current.select()},s=e=>{l()(e).then(n).catch(i)},o=(0,r.useCallback)(e=>{"string"==typeof e?s(e):t.current&&s(t.current.value)},[]);return{copy:o,target:t}}},8232:function(e,t,n){var r=n(5893),i=n(7294),l=n(1903);let a=e=>(e||"").toLowerCase().split(" ").map(function(e){return e.replace(e.charAt(0),e.charAt(0).toUpperCase())}).join(" "),s=e=>{let t=Object.fromEntries(Object.entries(e).filter(e=>{let[t]=e;return!["onSearch","capitalize","uppercase","timeout"].includes(t)})),[n,s]=(0,i.useState)(e.value||""),o=(0,i.useRef)(null),c=t=>{var{value:n}=t.target;n=e.uppercase?(n||"").toLocaleUpperCase():n||"",s(n=e.capitalize?a(n||""):n||""),clearTimeout(o.current),o.current=setTimeout(()=>{e.onChange&&e.onChange(n)},e.timeout||500)};return(0,i.useEffect)(()=>()=>{clearTimeout(o.current)},[]),(0,i.useEffect)(()=>{e.value!=n&&s(e.value||"")},[e.value]),(0,r.jsx)(l.Z,{...t,onChange:c,value:n})};t.Z=s},1073:function(e,t,n){n.r(t),n.d(t,{default:function(){return tv}});var r=n(5893),i=n(1163),l=n(7294),a=n(9770),s=n(7274),o=n(6822),c=n(4267),d=n(8445),x=n(5861),h=n(3321),u=n(9878),m=n(8232),p=n(7109);let f=e=>{let{parent:t="",goBack:n,onSearch:i,onChange:l}=e,a=()=>{l({title:"Th\xeam Nh\xf3m/Khối mới",parent:t,text:"",type:"classes"})},s=()=>{l({title:"Th\xeam Lớp mới",parent:t,text:"",type:"class",year:new Date().getFullYear()})};return(0,r.jsxs)("div",{children:[(0,r.jsx)(d.Z,{title:(0,r.jsx)(x.Z,{variant:"h4",children:"QUẢN L\xdd NH\xd3M/LỚP HỌC"})}),(0,r.jsx)(c.Z,{children:(0,r.jsxs)(o.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap"},children:[(0,r.jsx)(o.Z,{children:(0,r.jsx)(h.Z,{variant:"text",startIcon:(0,r.jsx)(u.Z,{icon:"tabler:chevron-left"}),color:"success",onClick:n,children:"Quay lại"})}),(0,r.jsxs)(o.Z,{children:[(0,r.jsx)(m.Z,{size:"small",sx:{mr:1},placeholder:"Nhập t\xean lớp...",InputProps:{startAdornment:(0,r.jsx)(p.Z,{position:"start",children:(0,r.jsx)(u.Z,{icon:"tabler:search"})})},onChange:i}),(0,r.jsx)(h.Z,{variant:"tonal",endIcon:(0,r.jsx)(u.Z,{icon:"tabler:folder-plus"}),sx:{mr:1},onClick:a,children:"TẠO NH\xd3M/KHỐI MỚI"}),(0,r.jsx)(h.Z,{variant:"contained",endIcon:(0,r.jsx)(u.Z,{icon:"tabler:clipboard-plus"}),onClick:s,children:"TẠO LỚP MỚI"})]})]})})]})};var g=l.memo(f),v=n(4531),j=n(410),b=n(8885),y=n(9334),Z=n(8333),C=n(8972),w=n(6455),k=n.n(w),S=n(5591);let I=[{flex:.25,minWidth:290,field:"title",headerName:"KHỐI/LỚP",renderCell:e=>{let{row:t}=e;return(0,r.jsxs)(o.Z,{sx:{display:"flex",alignItems:"center"},children:["class"==t.type?(0,r.jsx)(j.Z,{sx:{mr:3,fontSize:".8rem",width:"2rem",height:"2rem"},src:t.cover,children:(0,r.jsx)(u.Z,{icon:"tabler:list-check"})}):(0,r.jsx)(j.Z,{skin:"light",sx:{mr:3,fontSize:".8rem",width:"2rem",height:"2rem"},src:t.cover,children:(0,r.jsx)(u.Z,{icon:"tabler:users-group"})}),(0,r.jsx)(x.Z,{noWrap:!0,variant:"body1",sx:{color:"text.primary",fontWeight:600},children:t.title})]})}},{flex:.25,minWidth:290,field:"updateAt",headerName:"CẬP NHẬT L\xdaC",renderCell:e=>{let{row:t}=e;return(0,r.jsx)(x.Z,{noWrap:!0,variant:"body2",sx:{color:"text.primary"},children:t.updateAt||t.createAt})}}],T=e=>{let{rows:t,onChange:n,onLoading:a}=e,o=(0,i.useRouter)(),[c,d]=(0,l.useState)({}),[x,h]=(0,l.useState)(null),m=e=>{"classes"==e.type?o.push("?parent="+e.id):o.push("/p/view-classes.html?classes="+e.id)},p=e=>()=>{switch(h(null),e){case"rename":n({...c,title:"Chỉnh sửa th\xf4ng tin",text:c.title});break;case"remove":k().fire({title:"X\xf3a Nh\xf3m/Khối ".concat(c.title,"?"),text:"Sau khi x\xf3a nh\xf3m/khối n\xe0y c\xe1c nh\xf3m/khối/lớp b\xean trong nh\xf3m/khối sẽ được di chuyển th\xe0nh nh\xf3m/khối c\xf9ng cấp với nh\xf3m/khối hiện tại.",icon:"warning",showCancelButton:!0,confirmButtonText:"Đ\xfang. X\xf3a đi.",cancelButtonText:"Hủy"}).then(async e=>{if(e.isConfirmed){a(!0);let e=(await s.default.delete("/classes/"+c.id)).data;a(!1);let{error:t,message:n}=e||{};if(t)return k().fire({position:"top-end",icon:"error",title:t,showConfirmButton:!1,timer:1500});n&&((0,S.JG)(c.parent?"/classes/".concat(c.parent):"/classes",c,{revalidate:!1,populateCache:(e,t)=>{let n=t.filter(t=>t.id!==e.id);return[...n]}}),k().fire({position:"top-end",icon:"success",title:n,showConfirmButton:!1,timer:1500}))}})}},f={classes:[{text:"Chia sẻ",icon:"tabler:user-plus",onClick:p("share"),divider:!0},{text:"Đổi t\xean",icon:"tabler:pencil",onClick:p("rename")},{text:"X\xf3a",icon:"tabler:trash-filled",onClick:p("remove")}],class:[{text:"Đổi t\xean",icon:"tabler:pencil",onClick:p("rename")},{text:"X\xf3a",icon:"tabler:trash-filled",onClick:p("remove")}]},g=e=>{e.preventDefault();var[n]=t.filter(t=>t.id==e.currentTarget.getAttribute("data-id"));d(n),h(null===x?{mouseX:e.clientX-2,mouseY:e.clientY-4}:null)};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(v._,{autoHeight:!0,rows:t,columns:I,initialState:{pagination:{paginationModel:{pageSize:15}}},pageSizeOptions:[15,25,50],slotProps:{row:{onContextMenu:g,style:{cursor:"context-menu"}}},disableRowSelectionOnClick:!0,onRowClick:e=>m(e.row)}),(0,r.jsx)(Z.Z,{open:null!==x,onClose:e=>h(null),anchorReference:"anchorPosition",anchorPosition:null!==x?{top:x.mouseY,left:x.mouseX}:void 0,slotProps:{root:{onContextMenu:e=>{e.preventDefault(),h(null)}}},children:(f[c.type]||[]).map((e,t)=>(0,r.jsxs)(C.Z,{onClick:e.onClick,divider:e.divider,children:[(0,r.jsx)(b.Z,{children:(0,r.jsx)(u.Z,{icon:e.icon,fontSize:16})}),(0,r.jsx)(y.Z,{primary:e.text})]},t))})]})};var P=n(948),W=n(9581),M=n(1425),N=n(3946),z=n(8262),H=n(6628);let B=(0,P.ZP)(N.Z)(e=>{let{theme:t}=e;return{top:0,right:0,color:"grey.500",position:"absolute",boxShadow:t.shadows[2],transform:"translate(10px, -10px)",borderRadius:t.shape.borderRadius,backgroundColor:"".concat(t.palette.background.paper," !important"),transition:"transform 0.25s ease-in-out, box-shadow 0.25s ease-in-out","&:hover":{transform:"translate(7px, -5px)"}}}),R=()=>{let e=new Date().getFullYear();return Array(10).fill(0).map((t,n)=>n+e-3)},D=(0,l.forwardRef)(function(e,t){return(0,r.jsx)(H.Z,{ref:t,...e})}),O=e=>{let{popup:t,onChange:n,onLoading:i}=e,[a,c]=(0,l.useState)(t||{}),d=()=>{n(null)},p=async()=>{let{title:e,...n}=a;if(!n.text.trim()||n.text.trim()===t.text.trim())return;i(!0);let r=(await s.default.post("/classes",n)).data;if(i(!1),r.error)return k().fire({icon:"error",title:"Oops...",text:r.error});(0,S.JG)(r.parent?"/classes/".concat(r.parent):"/classes",r,{revalidate:!1,populateCache:(e,t)=>{let n=[...t],r=t.findIndex(t=>t.id===e.id);return r>=0?n[r]=e:n.push(e),[...n]}}),d()};return(0,l.useEffect)(()=>{c(t||{})},[t]),(0,r.jsxs)(z.Z,{fullWidth:!0,open:!!t,maxWidth:"sm",scroll:"body",TransitionComponent:D,sx:{"& .MuiDialog-paper":{overflow:"visible"}},children:[(0,r.jsxs)(W.Z,{sx:{pb:e=>"".concat(e.spacing(2)," !important"),px:e=>["".concat(e.spacing(5)," !important"),"".concat(e.spacing(5)," !important")]},children:[(0,r.jsx)(B,{onClick:d,children:(0,r.jsx)(u.Z,{icon:"tabler:x",fontSize:"1.25rem"})}),(0,r.jsxs)(o.Z,{sx:{mb:2,textAlign:"left"},children:[(0,r.jsx)(x.Z,{variant:"h4",sx:{mb:3},children:a.title}),(0,r.jsx)(x.Z,{variant:"body",sx:{mb:3},children:"Bạn c\xf3 thể dễ d\xe0ng quản l\xfd c\xe1c lớp học của m\xecnh theo từng khối hoặc nh\xf3m một c\xe1ch dễ d\xe0ng hơn."})]}),(0,r.jsxs)(W.Z,{sx:{paddingX:"0!important"},children:["classes"===a.type?(0,r.jsx)(m.Z,{value:a.text,onChange:e=>c({...a,text:e}),fullWidth:!0,placeholder:"Vui l\xf2ng nhập t\xean Nh\xf3m/Kh\xf4i",label:"T\xean Nh\xf3m/Khối"}):null,"class"===a.type?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(m.Z,{value:a.text,onChange:e=>c({...a,text:e}),fullWidth:!0,placeholder:"Vui l\xf2ng nhập t\xean lớp",label:"T\xean lớp"}),(0,r.jsx)(m.Z,{select:!0,fullWidth:!0,label:"Năm học",sx:{mt:5},value:a.year||new Date().getFullYear(),onChange:e=>c({...a,year:e}),children:R().map(e=>(0,r.jsxs)(C.Z,{value:e,children:[e," - ",e+1]},e))})]}):null]})]}),(0,r.jsxs)(M.Z,{sx:{justifyContent:"center",px:e=>["".concat(e.spacing(5)," !important"),"".concat(e.spacing(5)," !important")],pb:e=>["".concat(e.spacing(5)," !important"),"".concat(e.spacing(5)," !important")]},children:[(0,r.jsx)(h.Z,{variant:"tonal",color:"secondary",onClick:d,children:"Hủy"}),(0,r.jsx)(h.Z,{variant:"contained",sx:{mr:1},onClick:p,children:"Lưu"})]})]})};var A=n(4808),L=n(8456);let Y=e=>{let{open:t}=e;return(0,r.jsxs)(A.Z,{sx:{color:"#fff",zIndex:1301,display:"flex",flexDirection:"column"},open:t,children:[(0,r.jsx)(L.Z,{color:"inherit"}),(0,r.jsx)(x.Z,{variant:"h5",sx:{color:"#fff",zIndex:e=>e.zIndex.drawer+1,mt:3},children:"VUI L\xd2NG ĐỢI"})]})},_=async e=>{try{return(await s.default.get(e)).data}catch(e){throw e}},F=()=>{var e;let t=(0,i.useRouter)(),[n,s]=(0,l.useState)(""),[c,d]=(0,l.useState)(!1),[x,h]=(0,l.useState)(null),{parent:u}=t.query,{data:m,isLoading:p}=(0,a.Z)(t.isReady?u?"/classes/".concat(u):"/classes":null,_);return(0,r.jsxs)(o.Z,{children:[(0,r.jsx)(g,{parent:u||"",goBack:()=>t.back(),onSearch:e=>s(e),onChange:e=>h(e)}),(0,r.jsx)(T,{rows:null===(e=m||[])||void 0===e?void 0:e.filter(e=>null==e?void 0:e.title.includes(n)),onLoading:e=>d(e),onChange:e=>h(e)}),(0,r.jsx)(Y,{open:p||c}),(0,r.jsx)(O,{popup:x,onChange:e=>h(e),onLoading:e=>d(e)})]})};var E=n(1664),q=n.n(E);let X=e=>{let{parent:t="",goBack:n,onSearch:i,onChange:l}=e,a=()=>{l({title:"Th\xeam thư mục mới",parent:t,text:""})};return(0,r.jsxs)("div",{children:[(0,r.jsx)(d.Z,{title:(0,r.jsx)(x.Z,{variant:"h4",children:"QUẢN L\xdd ĐỀ THI"})}),(0,r.jsx)(c.Z,{children:(0,r.jsxs)(o.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap"},children:[(0,r.jsx)(o.Z,{children:(0,r.jsx)(h.Z,{variant:"text",startIcon:(0,r.jsx)(u.Z,{icon:"tabler:chevron-left"}),color:"success",onClick:n,children:"Quay lại"})}),(0,r.jsxs)(o.Z,{children:[(0,r.jsx)(m.Z,{size:"small",sx:{mr:1},placeholder:"Nhập t\xean đề thi...",InputProps:{startAdornment:(0,r.jsx)(p.Z,{position:"start",children:(0,r.jsx)(u.Z,{icon:"tabler:search"})})},onChange:i}),(0,r.jsx)(h.Z,{variant:"tonal",endIcon:(0,r.jsx)(u.Z,{icon:"tabler:folder-plus"}),sx:{mr:1},onClick:a,children:"Tạo thư mục mới"}),(0,r.jsx)(h.Z,{variant:"contained",endIcon:(0,r.jsx)(u.Z,{icon:"tabler:clipboard-plus"}),component:q(),href:"/p/create.html?parent="+t,children:"TẠO ĐỀ MỚI"})]})]})}),(0,r.jsx)(o.Z,{sx:{position:"fixed",bottom:"2.5rem",right:"4.5rem",zIndex:1031},children:(0,r.jsx)(h.Z,{variant:"contained",startIcon:(0,r.jsx)(u.Z,{icon:"tabler:plus"}),component:q(),href:"/p/create.html?parent="+t,color:"error",sx:{boxShadow:"0 1px 20px 1px #EA5455!important",":hover":{boxShadow:"none!important"}},children:"TẠO ĐỀ MỚI"})})]})};var G=l.memo(X),V=n(6316),J=n(6501),K=n(7484),U=n.n(K);let Q=[{flex:.25,minWidth:290,field:"title",headerName:"T\xcaN ĐỀ THI/THƯ MỤC",renderCell:e=>{let{row:t}=e;return(0,r.jsxs)(o.Z,{sx:{display:"flex",alignItems:"center"},children:["folder"==t.type?(0,r.jsx)(j.Z,{sx:{mr:3,fontSize:".8rem",width:"2rem",height:"2rem"},src:t.cover,children:(0,r.jsx)(u.Z,{icon:"tabler:folder-filled"})}):(0,r.jsx)(j.Z,{skin:"light",sx:{mr:3,fontSize:".8rem",width:"2rem",height:"2rem"},src:t.cover,children:(0,r.jsx)(u.Z,{icon:"tabler:clipboard"})}),(0,r.jsx)(x.Z,{noWrap:!0,variant:"body1",sx:{color:"text.primary",fontWeight:600},children:t.title})]})}},{flex:.25,minWidth:290,field:"updateAt",headerName:"CẬP NHẬT L\xdaC",renderCell:e=>{let{row:t}=e;return(0,r.jsx)(x.Z,{noWrap:!0,variant:"body2",sx:{color:"text.primary"},children:U()(t.updateAt||t.createAt).format("HH:mm DD/MM/YYYY")})}}],$=e=>{let{rows:t,onChange:n,onLoading:a}=e,o=(0,i.useRouter)(),c=(0,V.Z)(),[d,x]=(0,l.useState)({}),[h,m]=(0,l.useState)(null),p=e=>"folder"==e.type?o.push("?parent="+e.id):o.push("/p/create.html?parent=".concat(e.parent,"&id=").concat(e.id)),f=e=>()=>{switch(m(null),e){case"rename":n({...d,title:"Đổi t\xean thư mục",text:d.title});break;case"remove":k().fire({title:"X\xf3a thư mục ".concat(d.title,"?"),text:"Sau khi x\xf3a thư mục n\xe0y c\xe1c thư mục, đề thi b\xean trong thư mục sẽ được di chuyển th\xe0nh thư mục c\xf9ng cấp với thư mục hiện tại.",icon:"warning",showCancelButton:!0,confirmButtonText:"Đ\xfang. X\xf3a đi.",cancelButtonText:"Hủy"}).then(async e=>{if(e.isConfirmed){a(!0);let e=(await s.default.delete("/exams/"+d.id)).data;a(!1);let{error:t,message:n}=e||{};if(t)return k().fire({position:"top-end",icon:"error",title:t,showConfirmButton:!1,timer:1500});n&&((0,S.JG)(d.parent?"/exams/".concat(d.parent):"/exams",d,{revalidate:!1,populateCache:(e,t)=>{let n=t.filter(t=>t.id!==e.id);return[...n]}}),J.ZP.success(n,{duration:2e3}))}});break;case"copy":c.copy(d.url),J.ZP.success("Đ\xe3 sao ch\xe9p th\xe0nh c\xf4ng!",{duration:2e3});break;case"delete":k().fire({title:"X\xf3a đề thi ".concat(d.title,"?"),text:"Sau khi xo\xe1 đề thi n\xe0y. Bạn sẽ kh\xf4ng thể kh\xf4i phục n\xf3. H\xe3y c\xe2n nhắc lựa chọn n\xe0y.",icon:"warning",showCancelButton:!0,confirmButtonText:"Đ\xfang. X\xf3a đi.",cancelButtonText:"Hủy"}).then(async e=>{if(e.isConfirmed){a(!0);let e=(await s.default.delete("/quizs/".concat(d.id,"?parent=").concat(d.parent))).data;a(!1);let{error:t,message:n}=e||{};if(t)return k().fire({position:"top-end",icon:"error",title:t,showConfirmButton:!1,timer:1500});n&&((0,S.JG)(d.parent?"/exams/".concat(d.parent):"/exams",d,{revalidate:!1,populateCache:(e,t)=>{let n=t.filter(t=>t.id!==e.id);return[...n]}}),J.ZP.success(n,{duration:2e3}))}});break;case"leaderboard":case"statistic":case"realtime":case"create":o.push("/p/".concat(e,".html?parent=").concat(d.parent,"&id=").concat(d.id));break;case"view":let t=window.open(d.url,"_blank");t.focus()}},g={folder:[{text:"Chia sẻ",icon:"tabler:user-plus",onClick:f("share"),divider:!0},{text:"Đổi t\xean",icon:"tabler:pencil",onClick:f("rename")},{text:"X\xf3a",icon:"tabler:trash-filled",onClick:f("remove")}],quiz:[{text:"Xem đề thi",icon:"tabler:eye",onClick:f("view")},{text:"Sao ch\xe9p link",icon:"tabler:link",onClick:f("copy")},{text:"Chỉnh sửa",icon:"tabler:pencil-minus",onClick:f("create"),divider:!0},{text:"Bảng điểm",icon:"tabler:report-analytics",onClick:f("leaderboard")},{text:"Thống k\xea",icon:"tabler:chart-histogram",onClick:f("statistic")},{text:"Gi\xe1m s\xe1t thi",icon:"tabler:user-scan",onClick:f("realtime"),divider:!0},{text:"X\xf3a",icon:"tabler:trash-filled",onClick:f("delete")}]},j=e=>{e.preventDefault();var[n]=t.filter(t=>t.id==e.currentTarget.getAttribute("data-id"));x(n),m(null===h?{mouseX:e.clientX-2,mouseY:e.clientY-4}:null)};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(v._,{autoHeight:!0,rows:t,columns:Q,initialState:{pagination:{paginationModel:{pageSize:15}}},pageSizeOptions:[15,25,50],slotProps:{row:{onContextMenu:j,style:{cursor:"context-menu"}}},disableRowSelectionOnClick:!0,onRowClick:e=>p(e.row)}),(0,r.jsx)(Z.Z,{open:null!==h,onClose:e=>m(null),anchorReference:"anchorPosition",anchorPosition:null!==h?{top:h.mouseY,left:h.mouseX}:void 0,slotProps:{root:{onContextMenu:e=>{e.preventDefault(),m(null)}}},children:(g[d.type]||[]).map((e,t)=>(0,r.jsxs)(C.Z,{onClick:e.onClick,divider:e.divider,children:[(0,r.jsx)(b.Z,{children:(0,r.jsx)(u.Z,{icon:e.icon,fontSize:16})}),(0,r.jsx)(y.Z,{primary:e.text})]},t))})]})},ee=(0,P.ZP)(N.Z)(e=>{let{theme:t}=e;return{top:0,right:0,color:"grey.500",position:"absolute",boxShadow:t.shadows[2],transform:"translate(10px, -10px)",borderRadius:t.shape.borderRadius,backgroundColor:"".concat(t.palette.background.paper," !important"),transition:"transform 0.25s ease-in-out, box-shadow 0.25s ease-in-out","&:hover":{transform:"translate(7px, -5px)"}}}),et=(0,l.forwardRef)(function(e,t){return(0,r.jsx)(H.Z,{ref:t,...e})}),en=e=>{let{popup:t,onChange:n,onLoading:i}=e,[a,c]=(0,l.useState)(t||{}),d=()=>{n(null)},p=async()=>{let{title:e,...n}=a;if(!n.text.trim()||n.text.trim()===t.text.trim())return;i(!0);let r=(await s.default.post("/exams",n)).data;if(i(!1),r.error)return k().fire({icon:"error",title:"Oops...",text:r.error});J.ZP.success("Cập nhật th\xe0nh c\xf4ng!",{duration:2e3}),(0,S.JG)(r.parent?"/exams/".concat(r.parent):"/exams",r,{revalidate:!1,populateCache:(e,t)=>{let n=[...t],r=t.findIndex(t=>t.id===e.id);return r>=0?n[r]=e:n.push(e),[...n]}}),d()};return(0,l.useEffect)(()=>{c(t||{})},[t]),(0,r.jsxs)(z.Z,{fullWidth:!0,open:!!t,maxWidth:"sm",scroll:"body",TransitionComponent:et,sx:{"& .MuiDialog-paper":{overflow:"visible"}},children:[(0,r.jsxs)(W.Z,{sx:{pb:e=>"".concat(e.spacing(2)," !important"),px:e=>["".concat(e.spacing(5)," !important"),"".concat(e.spacing(5)," !important")]},children:[(0,r.jsx)(ee,{onClick:d,children:(0,r.jsx)(u.Z,{icon:"tabler:x",fontSize:"1.25rem"})}),(0,r.jsxs)(o.Z,{sx:{mb:3,textAlign:"left"},children:[(0,r.jsx)(x.Z,{variant:"h4",sx:{mb:3},children:null==a?void 0:a.title}),(0,r.jsx)(x.Z,{variant:"body",sx:{mb:3},children:"Bạn c\xf3 thể dễ d\xe0ng quản l\xfd đề thi, b\xe0i tập của m\xecnh theo từng thư mục, chuy\xean đề một c\xe1ch dễ d\xe0ng hơn."})]}),(0,r.jsx)(W.Z,{sx:{paddingX:"0!important"},children:(0,r.jsx)(m.Z,{value:(null==a?void 0:a.text)||"",onChange:e=>c({...a,text:e}),fullWidth:!0,placeholder:"Vui l\xf2ng nhập t\xean thư mục",label:"T\xean thư mục"})})]}),(0,r.jsxs)(M.Z,{sx:{justifyContent:"center",px:e=>["".concat(e.spacing(5)," !important"),"".concat(e.spacing(5)," !important")],pb:e=>["".concat(e.spacing(5)," !important"),"".concat(e.spacing(5)," !important")]},children:[(0,r.jsx)(h.Z,{variant:"tonal",color:"secondary",onClick:d,children:"Hủy"}),(0,r.jsx)(h.Z,{variant:"contained",sx:{mr:1},onClick:p,children:"Lưu"})]})]})};var er=n(9008),ei=n.n(er);let el=async e=>{try{return(await s.default.get(e)).data}catch(e){throw e}},ea=()=>{var e;let t=(0,i.useRouter)(),[n,s]=(0,l.useState)(""),[c,d]=(0,l.useState)(!1),[x,h]=(0,l.useState)(null),{parent:u}=t.query,{data:m,isLoading:p}=(0,a.Z)(t.isReady?u?"/exams/".concat(u):"/exams":null,el);return m&&m.error?(0,r.jsx)(r.Fragment,{}):(0,r.jsxs)(o.Z,{children:[(0,r.jsx)(ei(),{children:(0,r.jsx)("title",{children:"Quản l\xfd đề thi - C\xf4ng cụ tạo đề thi online miễn ph\xed"})}),(0,r.jsx)(G,{parent:u||"",goBack:()=>t.back(),onSearch:e=>s(e),onChange:e=>h(e)}),(0,r.jsx)($,{rows:null===(e=m||[])||void 0===e?void 0:e.filter(e=>null==e?void 0:e.title.includes(n)),onLoading:e=>d(e),onChange:e=>h(e)}),(0,r.jsx)(Y,{open:p||c}),(0,r.jsx)(en,{popup:x,onChange:e=>h(e),onLoading:e=>d(e)})]})};var es=n(6242),eo=n(5152),ec=n.n(eo);let ed=ec()(()=>Promise.all([n.e(814),n.e(229)]).then(n.bind(n,7229)),{loadableGenerated:{webpack:()=>[7229]},ssr:!1}),ex=(e,t)=>{let n={};return e.forEach(e=>{n[e.number]||(n[e.number]=Array(21).fill(0)),n.total||(n.total=Array(21).fill(0));var r=Math.floor(e.point/t*20);n[e.number][r]++,n.total[r]++}),Object.keys(n).map((e,t)=>({name:"total"==e?"Tất cả":"Đề số ".concat(t+1),data:n[e]}))},eh=e=>{let{results:t,maxPoint:n=10}=e,i=ex(t,n),l={chart:{height:300,type:"area"},dataLabels:{enabled:!1},stroke:{curve:"smooth"},xaxis:{categories:Array.from({length:21},(e,t)=>">="+parseFloat(t*(n/20)).toFixed(2))},yaxis:{title:{text:"Số b\xe0i l\xe0m"}},scales:{x:{beginAtZero:!0}}};return(0,r.jsxs)(es.Z,{sx:{mb:5},children:[(0,r.jsx)(d.Z,{title:"Phổ điểm",sx:{flexDirection:["column","row"],alignItems:["flex-start","center"],"& .MuiCardHeader-action":{mb:0},"& .MuiCardHeader-content":{mb:[2,0]}},action:(0,r.jsx)(o.Z,{sx:{display:"flex",alignItems:"center"}})}),(0,r.jsx)(c.Z,{children:(0,r.jsx)(ed,{height:450,options:l,series:i})})]})};var eu=l.memo(eh),em=n(6476),ep=n(178),ef=n.n(ep),eg=n(9387),ev=n.n(eg);U().extend(ef()),U().extend(ev()),U().tz.setDefault("Asia/Ho_Chi_Minh");var ej=U(),eb=n(4386);let ey=e=>Math.floor(e/36e5).toString().padStart(2,"0")+":"+Math.floor((e%=36e5)/6e4).toString().padStart(2,"0")+":"+Math.floor((e%=6e4)/1e3).toString().padStart(2,"0"),eZ=e=>{let{results:t,labelColumn:n,handleClick:i}=e,[a,s]=(0,l.useState)([]),[c,h]=(0,l.useState)(""),[m,p]=(0,l.useState)({page:0,pageSize:25}),[f,g]=(0,l.useState)([]);(0,l.useEffect)(()=>{s(t)},[t]),(0,l.useEffect)(()=>{g(Object.keys(n))},[n]);let j=e=>{h(e)},b=[{flex:.1,minWidth:160,sortable:!1,field:"actions",headerName:"",renderCell:e=>{let{row:t}=e;return(0,r.jsxs)(o.Z,{sx:{display:"flex",alignItems:"center"},children:[(0,r.jsx)(eb.Z,{title:"Xem b\xe0i l\xe0m",children:(0,r.jsx)(N.Z,{size:"small",sx:{color:"primary.main"},onClick:i(t.id,"view"),children:(0,r.jsx)(u.Z,{icon:"tabler:eye"})})}),(0,r.jsx)(eb.Z,{title:"Lịch sử b\xe0i l\xe0m",children:(0,r.jsx)(N.Z,{size:"small",sx:{color:"success.main"},onClick:i(t.id,"history"),children:(0,r.jsx)(u.Z,{icon:"tabler:mist"})})}),(0,r.jsx)(eb.Z,{title:"X\xf3a b\xe0i l\xe0m",children:(0,r.jsx)(N.Z,{size:"small",sx:{color:"error.main"},onClick:i(t,"remove"),children:(0,r.jsx)(u.Z,{icon:"tabler:circle-x"})})})]})}},{flex:.175,minWidth:110,field:"rank",headerName:"Xếp hạng",renderCell:e=>(0,r.jsx)(x.Z,{variant:"body2",sx:{color:"text.primary"},children:e.row.rank})},{flex:.175,minWidth:110,field:"point",headerName:"Điểm",renderCell:e=>(0,r.jsx)(x.Z,{variant:"body2",sx:{color:"text.primary"},children:parseFloat(e.row.point).toFixed(2)})},...f.map(e=>({flex:1,minWidth:250,field:e,headerName:e,renderCell:t=>(0,r.jsx)(x.Z,{variant:"body2",sx:{color:"text.primary"},children:t.row[e]})})),{flex:.175,minWidth:110,field:"right",headerName:"Số c\xe2u đ\xfang",renderCell:e=>(0,r.jsx)(x.Z,{variant:"body2",sx:{color:"text.primary"},children:e.row.right})},{flex:.175,minWidth:110,field:"number",headerName:"Đề số",renderCell:e=>(0,r.jsx)(x.Z,{variant:"body2",sx:{color:"text.primary"},children:e.row.number})},{flex:.175,minWidth:110,field:"retake",headerName:"Lần l\xe0m",renderCell:e=>(0,r.jsx)(x.Z,{variant:"body2",sx:{color:"text.primary"},children:e.row.retake})},{flex:.175,minWidth:110,field:"time",headerName:"Thời gian l\xe0m b\xe0i",renderCell:e=>(0,r.jsx)(x.Z,{variant:"body",sx:{color:"text.primary"},children:ey(e.row.time)})},{flex:.175,minWidth:180,field:"startAt",headerName:"Bắt đầu l\xfac",renderCell:e=>(0,r.jsx)(x.Z,{variant:"body2",sx:{color:"text.primary"},children:ej(e.row.startAt).format("HH:mm:ss DD/MM/YYYY")})},{flex:.175,minWidth:180,field:"submitAt",headerName:"Nộp b\xe0i l\xfac",renderCell:e=>(0,r.jsx)(x.Z,{variant:"body2",sx:{color:"text.primary"},children:ej(e.row.submitAt).format("HH:mm:ss DD/MM/YYYY")})},{flex:.175,minWidth:350,field:"link",headerName:"Link b\xe0i l\xe0m",renderCell:e=>(0,r.jsx)(x.Z,{variant:"body2",sx:{color:"text.primary"},children:(0,r.jsx)("a",{href:e.row.link,target:"_blank",style:{textDecoration:"none"},children:e.row.link})})},{flex:.175,minWidth:150,field:"hidden",headerName:"Số lần chuyển tabs",renderCell:e=>(0,r.jsx)(x.Z,{variant:"body2",sx:{color:"text.primary"},children:e.row.hidden})},{flex:.175,minWidth:150,field:"left",headerName:"Số lần chuột tr\xe1i",renderCell:e=>(0,r.jsx)(x.Z,{variant:"body2",sx:{color:"text.primary"},children:e.row.left})},{flex:.175,minWidth:150,field:"menu",headerName:"Số lần chuột phải",renderCell:e=>(0,r.jsx)(x.Z,{variant:"body2",sx:{color:"text.primary"},children:e.row.menu})},{flex:.175,minWidth:150,field:"offline",headerName:"Số lần Offline",renderCell:e=>(0,r.jsx)(x.Z,{variant:"body2",sx:{color:"text.primary"},children:e.row.offline})},{flex:.175,minWidth:150,field:"devices",headerName:"Thiết bị",renderCell:e=>(0,r.jsx)(x.Z,{variant:"body2",sx:{color:"text.primary"},children:e.row.devices.join(", ")})},{flex:.175,minWidth:150,field:"ip",headerName:"Địa chỉ IP",renderCell:e=>(0,r.jsx)(x.Z,{variant:"body2",sx:{color:"text.primary"},children:e.row.ip.join(", ")})}];return(0,r.jsxs)(es.Z,{children:[(0,r.jsx)(d.Z,{title:"Bảng điểm"}),(0,r.jsx)(v._,{autoHeight:!0,pagination:!0,rows:a,disableColumnFilter:!0,disableColumnMenu:!0,columns:b,pageSizeOptions:[25,50,100],paginationModel:m,onPaginationModelChange:p,slotProps:{baseButton:{size:"medium",variant:"tonal"},toolbar:{value:c,clearSearch:()=>j(""),onChange:e=>j(e.target.value)}}})]})};var eC=l.memo(eZ),ew=n(6886);let ek=e=>{let{title:t,subtitle:n}=e;return(0,r.jsxs)(ew.ZP,{item:!0,xs:12,children:[t,n||null]})};var eS=n(7533),eI=n(7494),eT=n(7413),eP=n(2162),eW=n(9601),eM=n(1221),eN=n(6599);let ez=(0,P.ZP)(eN.Z)({"& .MuiTimelineItem-root":{width:"100%","&:before":{display:"none"}}}),eH=(0,P.ZP)(o.Z)(e=>{let{theme:t}=e;return{display:"flex",alignItems:"center",padding:t.spacing(3),justifyContent:"space-between",backgroundColor:"#F8F8F8"}}),eB=e=>{var t,n,i,l;let{details:a,handleClose:s,handleClick:c}=e;return(0,r.jsxs)(eS.ZP,{open:!0,anchor:"right",variant:"temporary",onClose:s,ModalProps:{keepMounted:!0},sx:{"& .MuiDrawer-paper":{width:{md:"50%",xs:"95%"}}},children:[(0,r.jsxs)(eH,{children:[(0,r.jsxs)(x.Z,{variant:"h5",children:["Lịch sử l\xe0m b\xe0i của: ",null==a?void 0:null===(t=a.payload)||void 0===t?void 0:t.student]}),(0,r.jsx)(N.Z,{size:"small",onClick:s,sx:{p:"0.438rem",borderRadius:1,color:"text.primary",backgroundColor:"action.selected","&:hover":{backgroundColor:e=>"rgba(".concat(e.palette.customColors.main,", 0.16)")}},children:(0,r.jsx)(u.Z,{icon:"tabler:x",fontSize:"1.125rem"})})]}),(0,r.jsx)(o.Z,{sx:{mt:3,px:3},children:(0,r.jsx)(ez,{children:null==a?void 0:null===(n=a.payload)||void 0===n?void 0:null===(i=n.logs)||void 0===i?void 0:i.map((e,t)=>(0,r.jsxs)(eT.Z,{children:[(0,r.jsxs)(eW.Z,{children:[(0,r.jsx)(eI.Z,{color:"error"}),(0,r.jsx)(eM.Z,{})]}),(0,r.jsxs)(eP.Z,{sx:{"& svg":{verticalAlign:"bottom",mx:4}},children:[(0,r.jsx)(o.Z,{sx:{mb:2,display:"flex",flexWrap:"wrap",alignItems:"center",justifyContent:"space-between"},children:(0,r.jsx)(x.Z,{sx:{mr:2},variant:"h5",dangerouslySetInnerHTML:{__html:e.text}})}),(0,r.jsx)(o.Z,{children:(0,r.jsx)(x.Z,{variant:"body",sx:{color:"text.disabled"},children:U()(e.t).format("HH:mm:ss DD/MM/YYYY")})})]})]},t))})}),(0,r.jsx)(eH,{sx:{justifyContent:"flex-end"},children:(0,r.jsx)(h.Z,{onClick:c(null==a?void 0:null===(l=a.payload)||void 0===l?void 0:l.id,"view"),variant:"contained",startIcon:(0,r.jsx)(u.Z,{icon:"tabler:eye"}),children:"Chi tiết b\xe0i l\xe0m"})})]})};var eR=l.memo(eB),eD=n(7720),eO=n(8462),eA=n(9294),eL=n(1008);n(8594);var eY=n(5600);let e_=()=>{let e=document.querySelectorAll(".quill-image");e.forEach(e=>{try{let{link:t,data:n}=JSON.parse(e.getAttribute("data-value")),r=document.createElement("canvas"),i=r.getContext("2d"),l=new Image;l.src=t,l.crossOrigin="anonymous",l.onload=function(){r.width=n.width,r.height=n.height,i.drawImage(l,n.x,n.y,n.width,n.height,0,0,n.width,n.height),e.setAttribute("src",r.toDataURL("image/png"))}}catch(e){console.log(e.message)}})},eF=()=>{let e=document.querySelectorAll(".ql-formula");e.forEach(e=>{try{let t=e.getAttribute("data-value");t&&(e.innerHTML=eL.Z.renderToString(t,{throwOnError:!1}))}catch(e){console.log(e.message)}})},eE=e=>{var t,n,i;let{details:a,updatePoint:s}=e;return(0,l.useEffect)(()=>{a&&(e_(),eF())},[a]),null==a?void 0:null===(t=a.payload)||void 0===t?void 0:null===(n=t.details)||void 0===n?void 0:null===(i=n.groups)||void 0===i?void 0:i.map(e=>{var t,n,i,l;return(0,r.jsxs)(es.Z,{sx:{mt:10,background:"unset"},children:[e.content&&(null==a?void 0:null===(t=a.payload)||void 0===t?void 0:null===(n=t.details)||void 0===n?void 0:n.groups.length)>1?(0,r.jsx)(c.Z,{dangerouslySetInnerHTML:{__html:e.content}}):null,(0,r.jsx)(c.Z,{sx:{padding:0,":last-of-type":{pb:0}},children:null==a?void 0:null===(i=a.payload)||void 0===i?void 0:null===(l=i.details)||void 0===l?void 0:l.questions.filter(t=>t.groupId==e.id).map((e,t)=>{var n,i;return(0,r.jsxs)(es.Z,{sx:{mb:5,":last-of-type":{mb:0}},id:e.id,children:[(0,r.jsx)(d.Z,{title:(0,r.jsxs)(x.Z,{variant:"body",sx:{fontWeight:700,color:"primary.main",fontSize:"1.3rem"},children:[e.label||"C\xe2u"," ",e.numberUser," (",e.label||"C\xe2u"," ",e.number,")."]}),action:(0,r.jsxs)(o.Z,{sx:{display:"flex",alignItems:"center"},children:[["TN","HK"].includes(e.type)?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(eY.Z,{rounded:!0,label:"Đ\xe1p \xe1n đ\xfang: "+(null==e?void 0:null===(n=e.options)||void 0===n?void 0:n.map((e,t)=>(null==e?void 0:e.keys)?"".concat(String.fromCharCode(65+t)," (").concat(String.fromCharCode(65+e.postion),")"):"").filter(e=>e).join(", ")),skin:"light",color:"success"}),(0,r.jsx)(eY.Z,{rounded:!0,label:"Đ\xe3 chọn: "+((null==e?void 0:e.answers)?null==e?void 0:null===(i=e.answers)||void 0===i?void 0:i.map(t=>{var n=null==e?void 0:e.options[t];return"".concat(String.fromCharCode(65+t)," (").concat(String.fromCharCode(65+n.postion),")")}).join(", "):""),skin:"light",color:e.isTrue?"success":"error",sx:{mx:1}})]}):null,["TL"].includes(e.type)?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(eY.Z,{rounded:!0,label:"GV chấm:",skin:"light",color:"info"}),(0,r.jsx)(m.Z,{type:"number",size:"small",sx:{width:"auto",maxWidth:"8rem",mx:2},value:e.teacher||0,InputProps:{inputProps:{min:0,max:parseFloat(e.maxPoint),step:.01},endAdornment:(0,r.jsx)(p.Z,{position:"end",children:"điểm"})},onChange:t=>s(e.id,{teacher:t}),timeout:300}),(0,r.jsx)(eY.Z,{rounded:!0,label:"Tối đa: ".concat(parseFloat(e.maxPoint).toFixed(2)," điểm"),skin:"light",color:"success"})]}):(0,r.jsx)(x.Z,{variant:"body",sx:{fontWeight:700,color:e.isTrue?"success.main":"error.main"},children:-1==e.point?"":parseFloat(e.point).toFixed(2)+" điểm"})]}),sx:{paddingY:3}}),(0,r.jsx)(c.Z,{dangerouslySetInnerHTML:{__html:e.content},sx:{" p":{m:0},py:0}}),(0,r.jsx)(c.Z,{sx:{px:1,mt:3},children:(0,r.jsxs)(eO.Z,{disablePadding:!0,children:[["TN","HK"].includes(e.type)?e.options.map((e,t)=>(0,r.jsxs)(eA.ZP,{sx:{borderRadius:1,mb:1,border:"1px solid #b2b2b299"},user:e.user||"",children:[(0,r.jsx)(b.Z,{children:(0,r.jsxs)(j.Z,{skin:(null==e?void 0:e.user)?"static":"light",sx:{fontWeight:600},children:[String.fromCharCode(65+t)," (",String.fromCharCode(65+e.postion),")"]})}),(0,r.jsx)(o.Z,{dangerouslySetInnerHTML:{__html:e.text},sx:{" p":{m:0},flexGrow:1}})]},t)):null,"TF"==e.type?e.options.map((e,t)=>(0,r.jsxs)(eA.ZP,{divider:!0,sx:{gap:1,cursor:"default",paddingX:2},children:[(0,r.jsx)(j.Z,{skin:"light",user:(null==e?void 0:e.user[0])||"",children:"Đ"}),(0,r.jsx)(j.Z,{skin:"light",user:(null==e?void 0:e.user[1])||"",children:"S"}),(0,r.jsxs)(j.Z,{skin:"light",color:"secondary",sx:{fontWeight:600},children:[String.fromCharCode(97+t)," (",String.fromCharCode(97+(null==e?void 0:e.postion)),")"]}),(0,r.jsx)(o.Z,{dangerouslySetInnerHTML:{__html:e.text},sx:{" p":{m:0},flexGrow:1}})]},t)):null]})}),"TL"==e.type?(0,r.jsxs)(c.Z,{sx:{px:2},children:[(0,r.jsx)(eD.Z,{sx:{fontWeight:600},children:"B\xe0i l\xe0m của học sinh"}),(0,r.jsx)(o.Z,{dangerouslySetInnerHTML:{__html:((null==e?void 0:e.answers)||[])[0]||""},sx:{" p":{m:0}}})]}):null,"DT"==e.type?(0,r.jsx)(c.Z,{sx:{px:2},children:(0,r.jsxs)(ew.ZP,{container:!0,spacing:3,children:[(0,r.jsxs)(ew.ZP,{item:!0,xs:12,md:6,children:[(0,r.jsx)(eD.Z,{sx:{fontWeight:600},children:"Đ\xe1p \xe1n của học sinh"}),(0,r.jsx)(o.Z,{dangerouslySetInnerHTML:{__html:((null==e?void 0:e.answers)||[])[0]||""},sx:{" p":{m:0}}})]}),(0,r.jsx)(ew.ZP,{item:!0,xs:12,md:6,sx:{color:"success.main"},children:e.options.length?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(eD.Z,{sx:{fontWeight:600},children:"Đ\xe1p \xe1n đ\xfang"}),e.options.map((e,t)=>(0,r.jsxs)(x.Z,{variant:"body",children:[e.text," |"," "]},t))]}):null})]})}):null]},e.id)})})]},e.id)})};var eq=l.memo(eE),eX=n(3395);let eG=e=>Math.floor(e/36e5).toString().padStart(2,"0")+":"+Math.floor((e%=36e5)/6e4).toString().padStart(2,"0")+":"+Math.floor((e%=6e4)/1e3).toString().padStart(2,"0"),eV=e=>{var t,n,i;let{details:a}=e,{points:s}=null==a?void 0:null===(t=a.payload)||void 0===t?void 0:t.overview,{overview:o}=null==a?void 0:a.payload,{collects:c=[]}=null==a?void 0:null===(n=a.payload)||void 0===n?void 0:n.details,d=null==a?void 0:null===(i=a.payload)||void 0===i?void 0:i.Username,[x,h]=(0,l.useState)(0);return(0,l.useEffect)(()=>{var e,t,n;let r=null==a?void 0:null===(e=a.payload)||void 0===e?void 0:null===(t=e.details)||void 0===t?void 0:null===(n=t.questions)||void 0===n?void 0:n.reduce((e,t)=>e+=parseFloat(t.teacher||t.point),0);h(r||0)},[a]),(0,r.jsxs)(ew.ZP,{container:!0,spacing:3,sx:{px:3},children:[(0,r.jsxs)(ew.ZP,{item:!0,xs:12,md:4,children:[(0,r.jsx)(eD.Z,{children:"ĐIỂM"}),(0,r.jsx)(ed,{series:[parseFloat(100*x/s||0).toFixed(2)],options:{chart:{height:300,type:"radialBar",sparkline:{enabled:!0}},colors:["#51e5a8"],plotOptions:{radialBar:{offsetY:-10,startAngle:-150,endAngle:150,hollow:{margin:0,size:"75%"},track:{background:"#ebe9f1",strokeWidth:"50%",margin:0},dataLabels:{show:!0,name:{show:!1,color:"#5e5873",fontSize:"2.86rem"},value:{formatter:e=>parseFloat(e*s/100||0).toFixed(2),color:"#5e5873",fontSize:"2.86rem",show:!0}}}},fill:{type:"gradient",gradient:{shade:"dark",type:"horizontal",shadeIntensity:.5,gradientToColors:["#51e5a8"],inverseColors:!0,opacityFrom:1,opacityTo:1,stops:[0,100]}},stroke:{lineCap:"round"},labels:[""],grid:{padding:{bottom:30}}},type:"radialBar",height:300})]}),(0,r.jsxs)(ew.ZP,{item:!0,xs:12,md:4,children:[d?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(eD.Z,{sx:{mt:2},children:"TH\xd4NG TIN TH\xcd SINH"}),(0,r.jsxs)(eO.Z,{children:[(0,r.jsx)(eA.ZP,{disablePadding:!0,children:(0,r.jsxs)(b.Z,{sx:{alignItems:"center",color:"primary.main"},children:[(0,r.jsx)(u.Z,{icon:"tabler:user-bolt",fontSize:20}),(0,r.jsxs)(y.Z,{sx:{fontWeight:600,ml:1},disableTypography:!0,children:["Họ v\xe0 t\xean: ",null==d?void 0:d.fullname]})]})}),(0,r.jsx)(eA.ZP,{disablePadding:!0,children:(0,r.jsxs)(b.Z,{sx:{alignItems:"center",color:"primary.main"},children:[(0,r.jsx)(u.Z,{icon:"tabler:cash-banknote",fontSize:20}),(0,r.jsxs)(y.Z,{sx:{fontWeight:600,ml:1},disableTypography:!0,children:["Lớp: ",null==d?void 0:d.classes]})]})}),(0,r.jsx)(eA.ZP,{disablePadding:!0,children:(0,r.jsxs)(b.Z,{sx:{alignItems:"center",color:"primary.main"},children:[(0,r.jsx)(u.Z,{icon:"tabler:school",fontSize:20}),(0,r.jsxs)(y.Z,{sx:{fontWeight:600,ml:1},disableTypography:!0,children:["Trường: ",null==d?void 0:d.school]})]})})]})]}):null,c.length?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(eD.Z,{children:"TH\xd4NG TIN THU THẬP"}),(0,r.jsx)(eO.Z,{children:c.map((e,t)=>(0,r.jsx)(eA.ZP,{disablePadding:!0,children:(0,r.jsxs)(b.Z,{sx:{alignItems:"center",color:"primary.main"},children:[(0,r.jsx)(u.Z,{icon:"tabler:point",fontSize:20}),(0,r.jsxs)(y.Z,{sx:{fontWeight:600,ml:1},disableTypography:!0,children:[null==e?void 0:e.label,": ",null==e?void 0:e.value]})]})},t))})]}):null]}),(0,r.jsxs)(ew.ZP,{item:!0,xs:12,md:4,children:[(0,r.jsx)(eD.Z,{children:"TH\xd4NG TIN B\xc0I THI"}),(0,r.jsxs)(eO.Z,{children:[(0,r.jsx)(eA.ZP,{disablePadding:!0,children:(0,r.jsxs)(b.Z,{sx:{alignItems:"center",color:"warning.main"},children:[(0,r.jsx)(u.Z,{icon:"tabler:clock",fontSize:20}),(0,r.jsx)(y.Z,{sx:{fontWeight:600,ml:1},disableTypography:!0,children:"Thời gian l\xe0m b\xe0i:"}),(0,r.jsx)(eX.Z,{sx:{fontWeight:600,fontSize:"1.2rem"},children:eG(o.time)})]})}),(0,r.jsx)(eA.ZP,{disablePadding:!0,children:(0,r.jsxs)(b.Z,{sx:{alignItems:"center"},children:[(0,r.jsx)(u.Z,{icon:"tabler:clock",fontSize:20}),(0,r.jsx)(y.Z,{sx:{fontWeight:600,ml:1},disableTypography:!0,children:"Bắt đầu l\xfac:"}),(0,r.jsx)(eX.Z,{sx:{fontWeight:600,fontSize:"1.2rem"},children:U()(o.startAt).format("HH:mm:ss DD/MM/YYYY")})]})}),(0,r.jsx)(eA.ZP,{disablePadding:!0,children:(0,r.jsxs)(b.Z,{sx:{alignItems:"center"},children:[(0,r.jsx)(u.Z,{icon:"tabler:clock",fontSize:20}),(0,r.jsx)(y.Z,{sx:{fontWeight:600,ml:1},disableTypography:!0,children:"Nộp b\xe0i l\xfac:"}),(0,r.jsx)(eX.Z,{sx:{fontWeight:600,fontSize:"1.2rem"},children:U()(o.submitAt).format("HH:mm:ss DD/MM/YYYY")})]})}),(0,r.jsx)(eA.ZP,{disablePadding:!0,children:(0,r.jsxs)(b.Z,{sx:{alignItems:"center",color:"success.main"},children:[(0,r.jsx)(u.Z,{icon:"tabler:circle-check",fontSize:20}),(0,r.jsx)(y.Z,{sx:{fontWeight:600,ml:1},disableTypography:!0,children:"Số c\xe2u trắc nghiệm đ\xfang"}),(0,r.jsx)(eX.Z,{sx:{fontWeight:600,fontSize:"1.2rem"},children:o.right})]})}),(0,r.jsx)(eA.ZP,{disablePadding:!0,children:(0,r.jsxs)(b.Z,{sx:{alignItems:"center",color:"error.main"},children:[(0,r.jsx)(u.Z,{icon:"tabler:circle-x",fontSize:20}),(0,r.jsx)(y.Z,{sx:{fontWeight:600,ml:1},disableTypography:!0,children:"Số c\xe2u trắc nghiệm sai"}),(0,r.jsx)(eX.Z,{sx:{fontWeight:600,fontSize:"1.2rem"},children:o.error})]})}),(0,r.jsx)(eA.ZP,{disablePadding:!0,children:(0,r.jsxs)(b.Z,{sx:{alignItems:"center"},children:[(0,r.jsx)(u.Z,{icon:"tabler:sum",fontSize:20}),(0,r.jsx)(y.Z,{sx:{fontWeight:600,ml:1},disableTypography:!0,children:"Tổng số c\xe2u hỏi trong đề"}),(0,r.jsx)(eX.Z,{sx:{fontWeight:600,fontSize:"1.2rem"},children:o.total})]})}),(0,r.jsx)(eA.ZP,{disablePadding:!0,children:(0,r.jsxs)(b.Z,{sx:{alignItems:"center"},children:[(0,r.jsx)(u.Z,{icon:"tabler:sum",fontSize:20}),(0,r.jsx)(y.Z,{sx:{fontWeight:600,ml:1},disableTypography:!0,children:"Đề số"}),(0,r.jsx)(eX.Z,{sx:{fontWeight:600,fontSize:"1.2rem"},children:o.number})]})}),(0,r.jsx)(eA.ZP,{disablePadding:!0,children:(0,r.jsxs)(b.Z,{sx:{alignItems:"center"},children:[(0,r.jsx)(u.Z,{icon:"tabler:sum",fontSize:20}),(0,r.jsx)(y.Z,{sx:{fontWeight:600,ml:1,a:{textDecoration:"none"}},disableTypography:!0,children:"Link b\xe0i l\xe0m:"}),(0,r.jsx)(eX.Z,{sx:{fontWeight:600,fontSize:"1.2rem",a:{textDecoration:"none"}},children:(0,r.jsx)("a",{href:o.link,target:"_blank",children:"Click để xem"})})]})})]})]})]})},eJ=(0,P.ZP)(o.Z)(e=>{let{theme:t}=e;return{display:"flex",alignItems:"center",padding:t.spacing(3),justifyContent:"space-between",backgroundColor:"#F8F8F8"}}),eK=e=>{var t,n,i,a;let{details:s,handleClose:c,handleClick:d,saveResults:p}=e,[f,g]=(0,l.useState)(s);(0,l.useEffect)(()=>{var e;g(s),sessionStorage.removeItem("results_"+(null==s?void 0:null===(e=s.payload)||void 0===e?void 0:e.id))},[s]);let v=(e,t)=>{var n,r;let i=JSON.parse(sessionStorage.getItem("results_"+(null==f?void 0:null===(n=f.payload)||void 0===n?void 0:n.id))||"{}");sessionStorage.setItem("results_"+(null==f?void 0:null===(r=f.payload)||void 0===r?void 0:r.id),JSON.stringify({...i,comments:{...(null==i?void 0:i.comments)||{},[e]:t}})),g(n=>{var r,i,l;return{...n,payload:{...n.payload,details:{...null==n?void 0:null===(r=n.payload)||void 0===r?void 0:r.details,comments:{...null==n?void 0:null===(i=n.payload)||void 0===i?void 0:null===(l=i.details)||void 0===l?void 0:l.comments,[e]:t}}}}})},j=(e,t)=>{var n;let{teacher:r}=t,i=JSON.parse(sessionStorage.getItem("results_"+(null==f?void 0:null===(n=f.payload)||void 0===n?void 0:n.id))||"{}");g(t=>{var n,l,a,s;return{...t,payload:{...t.payload,details:{...null==t?void 0:null===(n=t.payload)||void 0===n?void 0:n.details,questions:null==t?void 0:null===(l=t.payload)||void 0===l?void 0:null===(a=l.details)||void 0===a?void 0:null===(s=a.questions)||void 0===s?void 0:s.map(t=>{if(t.id==e){var n;return sessionStorage.setItem("results_"+(null==f?void 0:null===(n=f.payload)||void 0===n?void 0:n.id),JSON.stringify({...i,points:{...(null==i?void 0:i.points)||{},[e]:Math.min(r,t.maxPoint)}})),{...t,teacher:Math.min(r,t.maxPoint)}}return t})}}}})},b=()=>{try{var e,t;let{comments:n={},points:r={}}=JSON.parse(sessionStorage.getItem("results_"+(null==f?void 0:null===(e=f.payload)||void 0===e?void 0:e.id))||"{}");Object.keys(n).length||Object.keys(r).length?p(null==f?void 0:null===(t=f.payload)||void 0===t?void 0:t.id):k().fire("Bạn chưa chỉnh sửa g\xec","","info")}catch(e){}},y=()=>{var e;let{comments:t={},points:n={}}=JSON.parse(sessionStorage.getItem("results_"+(null==f?void 0:null===(e=f.payload)||void 0===e?void 0:e.id))||"{}");Object.keys(t).length||Object.keys(n).length?k().fire({icon:"warning",title:"Ch\xfa \xfd",html:'Bạn chưa lưu kết quả chấm điểm của b\xe0i l\xe0m n\xe0y. Vui l\xf2ng nhấn <b style="color:red">Lưu b\xe0i l\xe0m</b> trước khi tho\xe1t.',showCancelButton:!0,cancelButtonText:"Đ\xe3 hiểu",cancelButtonColor:"#d33",confirmButtonText:"Kh\xf4ng lưu"}).then(e=>{if(e.isConfirmed){var t;sessionStorage.removeItem("results_"+(null==f?void 0:null===(t=f.payload)||void 0===t?void 0:t.id)),c()}}):c()},Z=()=>{var e,t;let{comments:n={},points:r={}}=JSON.parse(sessionStorage.getItem("results_"+(null==f?void 0:null===(e=f.payload)||void 0===e?void 0:e.id))||"{}");Object.keys(n).length||Object.keys(r).length?k().fire({icon:"warning",title:"Ch\xfa \xfd",html:'Bạn chưa lưu kết quả chấm điểm của b\xe0i l\xe0m n\xe0y. Vui l\xf2ng nhấn <b style="color:red">Lưu b\xe0i l\xe0m</b> trước khi tho\xe1t.',showCancelButton:!0,cancelButtonText:"Đ\xe3 hiểu",cancelButtonColor:"#d33",confirmButtonText:"Kh\xf4ng lưu"}).then(e=>{if(e.isConfirmed){var t,n;sessionStorage.removeItem("results_"+(null==f?void 0:null===(t=f.payload)||void 0===t?void 0:t.id)),d(null==f?void 0:null===(n=f.payload)||void 0===n?void 0:n.id,"history")}}):(console.log("handleClick"),d(null==f?void 0:null===(t=f.payload)||void 0===t?void 0:t.id,"history")())};return(0,r.jsxs)(eS.ZP,{open:!0,anchor:"right",variant:"temporary",onClose:y,ModalProps:{keepMounted:!0},sx:{"& .MuiDrawer-paper":{width:"80%"}},children:[(0,r.jsxs)(eJ,{children:[(0,r.jsxs)(x.Z,{variant:"h5",children:["B\xe0i l\xe0m của: ",null==f?void 0:null===(t=f.payload)||void 0===t?void 0:t.student]}),(0,r.jsx)(N.Z,{size:"small",onClick:y,sx:{p:"0.438rem",borderRadius:1,color:"text.primary",backgroundColor:"action.selected","&:hover":{backgroundColor:e=>"rgba(".concat(e.palette.customColors.main,", 0.16)")}},children:(0,r.jsx)(u.Z,{icon:"tabler:x",fontSize:"1.125rem"})})]}),(0,r.jsxs)(o.Z,{sx:{mt:3},children:[(0,r.jsx)(eV,{details:f}),(0,r.jsxs)(o.Z,{sx:{px:3},children:[(0,r.jsx)(eD.Z,{children:"NHẬN X\xc9T CỦA GI\xc1O VI\xcaN"}),(0,r.jsx)(m.Z,{fullWidth:!0,multiline:!0,minRows:3,value:((null==f?void 0:null===(n=f.payload)||void 0===n?void 0:null===(i=n.details)||void 0===i?void 0:i.comments)||{})[null==f?void 0:null===(a=f.payload)||void 0===a?void 0:a.id]||"",onChange:e=>{var t;return v(null==f?void 0:null===(t=f.payload)||void 0===t?void 0:t.id,e)}})]}),(0,r.jsxs)(o.Z,{sx:{px:3},children:[(0,r.jsx)(eD.Z,{children:"CHI TIẾT B\xc0I L\xc0M"}),(0,r.jsx)(eq,{details:f,updatePoint:j})]})]}),(0,r.jsxs)(eJ,{sx:{justifyContent:"flex-end"},children:[(0,r.jsx)(h.Z,{onClick:Z,variant:"contained",color:"success",startIcon:(0,r.jsx)(u.Z,{icon:"tabler:mist"}),children:"Lịch sử b\xe0i l\xe0m"}),(0,r.jsx)(h.Z,{onClick:b,variant:"contained",startIcon:(0,r.jsx)(u.Z,{icon:"tabler:device-floppy"}),sx:{ml:2},children:"Lưu b\xe0i l\xe0m"})]})]})},eU=e=>{let{details:t,handleClose:n,handleClick:i,saveResults:l}=e;return"history"==t.open?(0,r.jsx)(eR,{details:t,handleClose:n,handleClick:i}):"view"==t.open?(0,r.jsx)(eK,{details:t,handleClose:n,handleClick:i,saveResults:l}):null};var eQ=l.memo(eU),e$=n(1649),e0=n(7052);let e1=(0,P.ZP)(q())(e=>{let{theme:t}=e;return{textDecoration:"none",color:t.palette.primary.main}}),e2=()=>{var e,t;let n=(0,i.useRouter)(),a=(0,e$.I0)(),[c,d]=(0,l.useState)({exams:null,results:[],labels:[],time:null}),[h,u]=(0,l.useState)({open:!1,payload:{}}),m=(0,l.useRef)(null);(0,l.useEffect)(()=>{a((0,e0.V)({status:"Đang tải..."})),m.current&&m.current.terminate(),m.current=new Worker("/scripts/worker.js"),m.current.onmessage=async e=>{let{action:t="",payload:n=null}=e.data;switch(console.log(n),t){case"fetchLeaderboard":d(n),a((0,e0.V)({status:""}));break;case"viewDetails":u({open:"view",payload:n});break;case"historyDetails":u({open:"history",payload:n});break;case"updateRealtime":d(e=>({...e,...n}))}};let e=async()=>{try{let{parent:e="",id:t=""}=n.query;if(!t)return n.push("/");await s.default.get("/leaderboard/".concat(t,"/timeout"));let{data:r}=await s.default.get("/quizs/".concat(t,"/details?parent=").concat(e)),{data:i}=await s.default.get("/leaderboard/".concat(t,"?parent=").concat(e));if((null==r?void 0:r.error)||(null==i?void 0:i.error))return k().fire({icon:"error",title:"Oops...",text:(null==r?void 0:r.error)||(null==i?void 0:i.error),footer:'<a href="#">Tại sao t\xf4i gặp th\xf4ng b\xe1o n\xe0y?</a>'}),n.push("/");m.current.postMessage({action:"fetchLeaderboard",payload:{response:r,results:i}})}catch(e){console.log("fetchData",e.message)}};return n.isReady&&e(),()=>{m.current&&m.current.terminate()}},[n,a]);let p=(e,t)=>()=>{switch(t){case"remove":k().fire({title:"Bạn chắc chứ?",html:'<p>Bạn đang muốn xo\xe1 b\xe0i l\xe0m của th\xed sinh: <b style="color:red">'.concat((null==e?void 0:e.student)||(null==e?void 0:e.id),"</b>?</p>"),icon:"warning",showCancelButton:!0,confirmButtonText:"V\xe2ng. X\xf3a đi!",cancelButtonText:"Hủy"}).then(async t=>{if(t.isConfirmed){var r;a((0,e0.V)({status:"Vui l\xf2ng đợi..."}));let{data:{error:t,text:i,time:l}}=await s.default.delete("/leaderboard/".concat(null===(r=n.query)||void 0===r?void 0:r.id,"?resultId=").concat(null==e?void 0:e.id));if(a((0,e0.V)({status:""})),t)return k().fire(t,"","error");k().fire(i,"","success"),m.current.postMessage({action:"currentRealtime",payload:{...c,results:c.results.filter(t=>t.ResultId!=(null==e?void 0:e.id)),time:l}})}});break;case"view":m.current.postMessage({action:"viewDetails",payload:{id:e,leaderboard:c}});break;case"download":break;case"history":m.current.postMessage({action:"historyDetails",payload:{id:e,leaderboard:c}})}},f=async e=>{try{let{comments:t={},points:r={}}=JSON.parse(sessionStorage.getItem("results_"+e)||"{}");if(Object.keys(t).length||Object.keys(r).length){let{id:i=""}=n.query;a((0,e0.V)({status:"Đang lưu"}));let{data:l}=await s.default.post("/leaderboard/".concat(i,"?resultId=").concat(e),{comments:t,points:r});if(a((0,e0.V)({status:""})),l.error)return k().fire("Xảy ra lỗi!",l.error,"error");k().fire({icon:"success",title:"Đ\xe3 lưu",timer:1500}),sessionStorage.removeItem("results_"+e),m.current.postMessage({action:"updateResult",payload:{results:{...l,id:e},leaderboard:c}}),u({open:!1})}}catch(e){console.log("saveResults",e.message)}};return(0,r.jsxs)(o.Z,{children:[(0,r.jsx)(ek,{title:(0,r.jsx)(x.Z,{variant:"h4",children:(0,r.jsx)(e1,{href:"/p/create.html?parent=".concat(n.query.parent,"&id=").concat(n.query.id),children:(null==c?void 0:null===(e=c.exams)||void 0===e?void 0:null===(t=e.settings)||void 0===t?void 0:t.title)||"..."})}),subtitle:(0,r.jsxs)(x.Z,{sx:{color:"text.secondary",mb:5},children:["(Cập nhật l\xfac ",ej(null==c?void 0:c.time).format("HH:mm:ss DD/MM/YYYY"),")"]})}),(0,r.jsx)(eu,{results:c.results.map(e=>{var t,n;return{point:null==e?void 0:null===(t=e.overview)||void 0===t?void 0:t.point,number:null==e?void 0:null===(n=e.overview)||void 0===n?void 0:n.number}}),maxPoint:10}),(0,r.jsx)(eC,{results:c.results.map(e=>({...e.overview,id:e.ResultId})).sort((e,t)=>t.point!==e.point?t.point-e.point:t.time!==e.time?e.time-t.time:e.startAt-t.startAt).map((e,t)=>({...e,rank:t+1})),labelColumn:c.labels,handleClick:p}),(0,r.jsx)(eQ,{details:h,handleClose:()=>{u({open:!1})},handleClick:p,saveResults:f})]})},e5=e=>{let{sx:t,icon:n,stats:i,title:l,avatarSize:a=42,iconSize:s="1.625rem",avatarColor:d="primary"}=e;return(0,r.jsx)(es.Z,{sx:{...t},children:(0,r.jsxs)(c.Z,{sx:{gap:3,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,r.jsxs)(o.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-start"},children:[(0,r.jsx)(x.Z,{variant:"h5",sx:{mb:.5},children:i}),(0,r.jsx)(x.Z,{variant:"body2",children:l})]}),(0,r.jsx)(j.Z,{skin:"light",color:d,sx:{width:a,height:a},children:(0,r.jsx)(u.Z,{icon:n,fontSize:s})})]})})},e3=e=>{let{statistic:t}=e,n=[{stats:null==t?void 0:t.total,icon:"tabler:list-check",title:"Số b\xe0i l\xe0m"},{stats:null==t?void 0:t.students,icon:"tabler:users",title:"Số học sinh",avatarColor:"success"},{stats:null==t?void 0:t.points,avatarColor:"error",title:"Điểm trung b\xecnh",icon:"tabler:circle-check"},{stats:null==t?void 0:t.times,title:"Thời gian trung b\xecnh",avatarColor:"warning",icon:"tabler:clock"}];return(0,r.jsx)(ew.ZP,{container:!0,spacing:6,children:n.map((e,t)=>(0,r.jsx)(ew.ZP,{item:!0,xs:12,md:3,children:(0,r.jsx)(e5,{...e})},t))})};var e6=n(6901),e4=n(1964),e8=n.n(e4);let e7=(0,P.ZP)(o.Z)(e=>{let{theme:t}=e;return{display:"flex",alignItems:"center",padding:t.spacing(2.5),boxShadow:t.shadows[1],justifyContent:"space-between",borderRadius:t.shape.borderRadius,backgroundColor:t.palette.background.paper}}),e9=(0,P.ZP)(o.Z)(e=>{let{theme:t}=e;return{padding:t.spacing(0,5,5),marginTop:5}}),te=(0,P.ZP)(e8())(e=>{let{theme:t}=e;return{padding:t.spacing(5)}}),tt=e=>{let{logs:t}=e,[n,i]=(0,l.useState)();(0,l.useEffect)(()=>{let e=setInterval(()=>{i(U()().format("HH:mm:ss DD/MM/YYYY"))},1e3);return()=>{clearInterval(e)}},[]),(0,l.useEffect)(()=>{s()},[t]);let a=(0,l.useRef)(null),s=()=>{a.current&&(a.current._container.scrollTop=a.current._container.scrollHeight)},c=(0,l.useMemo)(()=>t.map((e,t)=>(0,r.jsxs)(o.Z,{sx:{display:"flex",flexDirection:e.admin?"row-reverse":"row",alignItems:"center",mb:2},children:[(0,r.jsx)(j.Z,{children:e.admin?"GV":e.label}),(0,r.jsxs)(e6.Z,{severity:"success",icon:!1,sx:{mr:e.admin?2:void 0,ml:e.admin?void 0:2},children:[(0,r.jsx)(x.Z,{variant:"h6",sx:{fontWeight:600},dangerouslySetInnerHTML:{__html:e.text}}),(0,r.jsx)("div",{style:{textAlign:e.admin?"right":"left"},children:(0,r.jsx)(x.Z,{variant:"body",sx:{fontSize:"0.75rem"},children:U()(e.t).format("HH:mm:ss DD/MM/YYYY")})})]})]},e.id+t)),[t]);return(0,r.jsxs)(es.Z,{children:[(0,r.jsx)(d.Z,{title:(0,r.jsx)(x.Z,{variant:"h4",children:"Nhật k\xfd hoạt động"}),action:(0,r.jsxs)(h.Z,{variant:"tonal",children:["Cập nhật l\xfac ",n]})}),(0,r.jsxs)(o.Z,{sx:{flexGrow:1,height:"100%",backgroundColor:"action.hover"},children:[(0,r.jsx)(te,{ref:a,children:(0,r.jsx)(o.Z,{sx:{height:"50vh"},children:c})}),(0,r.jsx)(e9,{children:(0,r.jsxs)(e7,{children:[(0,r.jsx)(o.Z,{sx:{flexGrow:1,display:"flex",alignItems:"center"},children:(0,r.jsx)(em.Z,{fullWidth:!0,placeholder:"Type your message here…",sx:{"& .Mui-focused":{boxShadow:"none !important"},"& .MuiInputBase-input:not(textarea).MuiInputBase-inputSizeSmall":{p:e=>e.spacing(1.875,2.5)},"& .MuiInputBase-root":{border:"0 !important"}}})}),(0,r.jsx)(o.Z,{sx:{display:"flex",alignItems:"center"},children:(0,r.jsx)(h.Z,{type:"submit",variant:"contained",startIcon:(0,r.jsx)(u.Z,{icon:"tabler:send"}),children:"Gửi"})})]})})]})]})};var tn=n(8987),tr=n(8619);let ti=e=>Math.floor(e/36e5).toString().padStart(2,"0")+":"+Math.floor((e%=36e5)/6e4).toString().padStart(2,"0")+":"+Math.floor((e%=6e4)/1e3).toString().padStart(2,"0"),tl=(0,P.ZP)(e8())(e=>{let{theme:t}=e;return{padding:t.spacing(5)}}),ta=e=>{let{students:t,handleClick:n}=e,[i,a]=(0,l.useState)(null),[s,c]=(0,l.useState)(null),[h,m]=(0,l.useState)(new Date().getTime()),p=()=>{a(null)},f=e=>t=>{a(t.currentTarget),c(e)},g=e=>t=>{n(s.id,e),a(null),c(null)};(0,l.useEffect)(()=>{let e=setInterval(()=>{m(new Date().getTime())},1e3);return()=>{clearInterval(e)}},[t]);let v=(0,l.useRef)(null);return(0,r.jsxs)(es.Z,{children:[(0,r.jsx)(d.Z,{title:(0,r.jsxs)(x.Z,{variant:"h4",children:["Học sinh đang l\xe0m (",t.length,")"]})}),(0,r.jsx)(o.Z,{sx:{flexGrow:1,height:"100%",backgroundColor:"action.hover"},children:(0,r.jsx)(tl,{ref:v,children:(0,r.jsx)(o.Z,{sx:{height:"62vh"},children:(0,r.jsx)(eO.Z,{children:t.map(e=>(0,r.jsx)(eA.ZP,{disablePadding:!0,divider:!0,onClick:f(e),children:(0,r.jsxs)(tr.Z,{children:[(0,r.jsx)(tn.Z,{children:(0,r.jsx)(j.Z,{color:null==e?void 0:e.color,children:e.label})}),(0,r.jsx)(y.Z,{children:e.student}),(0,r.jsxs)(eX.Z,{sx:{textAlign:"center"},children:[(0,r.jsxs)(x.Z,{children:["Đ\xe3 l\xe0m ",e.taked]}),(0,r.jsx)(x.Z,{color:"error",fontWeight:600,children:ti(h-e.startAt)})]})]})},e.id))})})})}),(null==t?void 0:t.length)?(0,r.jsx)(Z.Z,{anchorEl:i,keepMounted:!0,open:!!i,onClose:p,children:[{action:"alert",title:"Nhắc nhở quay lại b\xe0i thi",icon:"tabler:bell-plus",show:!1},{action:"message",title:"Gửi lời nhắn ri\xeang",icon:"tabler:message-chatbot",show:!1},{action:"cancel",title:"Buộc dừng b\xe0i thi",icon:"tabler:user-cancel",show:!0}].map(e=>!e.show&&(null==s?void 0:s.status)!="offline"||e.show?(0,r.jsxs)(C.Z,{onClick:g(e.action),children:[(0,r.jsx)(b.Z,{children:(0,r.jsx)(u.Z,{icon:e.icon,fontSize:20})}),(0,r.jsx)(y.Z,{children:e.title})]},e.action):null)}):null]})},ts=()=>{let e=(0,i.useRouter)(),t=(0,e$.I0)(),n=(0,l.useRef)(null),a=(0,l.useRef)(null),[c,d]=(0,l.useState)({exams:null,results:[],labels:[],time:null}),[x,h]=(0,l.useState)({}),[u,m]=(0,l.useState)([]),[p,f]=(0,l.useState)([]);(0,l.useEffect)(()=>{(null==c?void 0:c.currents)&&n.current.postMessage({action:"currentRealtime",payload:c}),(null==c?void 0:c.logs)&&n.current.postMessage({action:"logsRealtime",payload:c}),(null==c?void 0:c.events)&&n.current.postMessage({action:"eventsRealtime",payload:c})},[c]),(0,l.useEffect)(()=>{t((0,e0.V)({status:"Đang tải..."}));let r=async()=>{try{let{parent:t="",id:r=""}=e.query;if(!r)return e.push("/");await s.default.get("/leaderboard/".concat(r,"/timeout"));let{data:i}=await s.default.get("/quizs/".concat(r,"/details?parent=").concat(t)),{data:l}=await s.default.get("/leaderboard/".concat(r,"?parent=").concat(t));if((null==i?void 0:i.error)||(null==l?void 0:l.error))return k().fire({icon:"error",title:"Oops...",text:(null==i?void 0:i.error)||(null==l?void 0:l.error),footer:'<a href="#">Tại sao t\xf4i gặp th\xf4ng b\xe1o n\xe0y?</a>'}),e.push("/");n.current.postMessage({action:"fetchRealtime",payload:{response:i,results:l}})}catch(e){console.log("fetchData",e.message)}},i=()=>{a.current&&a.current.close();let{parent:t="",id:n=""}=e.query,r="".concat("wss://cloud.taodethi.xyz","/socket?id=").concat(n,"&accessToken=").concat(localStorage.getItem("accessToken")||"");a.current=new WebSocket(r),a.current.onopen=()=>{console.log("Connected Socket")},a.current.onclose=e=>{console.log("Disconnected from server",e)},a.current.onerror=e=>{console.error("WebSocket error:",e)},a.current.onmessage=e=>{try{let{action:t,payload:n,ResultId:r,time:i}=JSON.parse(e.data);switch(t){case"current":d(e=>({...e,currents:n}));break;case"visible":case"hidden":case"online":case"offline":d(e=>({...e,logs:{payload:n,ResultId:r,time:i,action:t}}));break;case"submit":case"start":case"answers":d(e=>({...e,events:{payload:n,ResultId:r,time:i,action:t}}))}}catch(e){console.log("onmessage",e.message)}}};return e.isReady&&(n.current&&n.current.terminate(),n.current=new Worker("/scripts/worker.js"),n.current.onmessage=async e=>{let{action:n="",payload:r=null}=e.data;switch(console.log("onmessage",e.data),n){case"fetchLeaderboard":d(r),i(),t((0,e0.V)({status:""}));break;case"logsRealtime":m(r);break;case"statistic":h(r);break;case"studentsRealtime":f(r);break;case"updateRealtime":d(e=>({...e,...r,currents:void 0,logs:void 0,events:void 0}))}},r()),()=>{n.current&&n.current.terminate(),a.current&&a.current.close()}},[e]);let g=(e,t)=>{let n=p.find(t=>e==t.id);if(!n)return k().fire({icon:"error",title:"Oppss...",html:"Kh\xf4ng t\xecm thấy th\xf4ng tin"});switch(t){case"alert":k().fire({icon:"warning",title:"Ch\xfa \xfd",html:'Bạn muốn nhắc nhở bạn <b style="color:red">'.concat(n.student,"</b> quay lại l\xe0m b\xe0i thi ngay?"),showCancelButton:!0,cancelButtonText:"Hủy",cancelButtonColor:"#d33",confirmButtonText:"Đ\xfang vậy"}).then(e=>{if(e.isConfirmed){var t,r;(null==a?void 0:null===(t=a.current)||void 0===t?void 0:t.readyState)===WebSocket.OPEN?(null==a||null===(r=a.current)||void 0===r||r.send(JSON.stringify({action:"alert",payload:{clientId:n.clientId,resultId:n.id}})),k().fire("Đ\xe3 gửi!","","success")):k().fire("Vui l\xf2ng kết nối mạng","","error")}});break;case"message":k().fire({html:'Gửi lời nhắn đến bạn <b style="color:red">'.concat(n.student,"</b>"),input:"text",inputAttributes:{autocapitalize:"off"},showCancelButton:!0,confirmButtonText:"Gửi ngay",showLoaderOnConfirm:!0,preConfirm:async e=>{if(!e.toString().trim())return k().showValidationMessage("Vui l\xf2ng nhập nội dung")},allowOutsideClick:()=>!k().isLoading()}).then(e=>{if(e.isConfirmed){var t,r;(null==a?void 0:null===(t=a.current)||void 0===t?void 0:t.readyState)===WebSocket.OPEN?(null==a||null===(r=a.current)||void 0===r||r.send(JSON.stringify({action:"cancel",payload:{clientId:n.clientId,resultId:n.id,message:e.value.login}})),k().fire("Đ\xe3 gửi!","","success")):k().fire("Vui l\xf2ng kết nối mạng","","error")}});break;case"cancel":k().fire({icon:"warning",title:"Kết th\xfac b\xe0i thi",html:'Bạn muốn Kết th\xfac b\xe0i thi của th\xed sinh <b style="color:red">'.concat(n.student,"</b>?"),showCancelButton:!0,cancelButtonText:"Hủy",cancelButtonColor:"#d33",confirmButtonText:"Đ\xfang vậy"}).then(e=>{if(e.isConfirmed){var t,r;(null==a?void 0:null===(t=a.current)||void 0===t?void 0:t.readyState)===WebSocket.OPEN?(null==a||null===(r=a.current)||void 0===r||r.send(JSON.stringify({action:"cancel",payload:{clientId:n.clientId,resultId:n.id}})),k().fire("Đ\xe3 gửi!","","success")):k().fire("Vui l\xf2ng kết nối mạng","","error")}})}};return(0,r.jsxs)(o.Z,{children:[(0,r.jsx)(e3,{statistic:x}),(0,r.jsxs)(ew.ZP,{container:!0,spacing:3,sx:{mt:3},children:[(0,r.jsx)(ew.ZP,{item:!0,xs:12,md:6,children:(0,r.jsx)(tt,{logs:u})}),(0,r.jsx)(ew.ZP,{item:!0,xs:12,md:6,children:(0,r.jsx)(ta,{students:p,handleClick:g})})]})]})},to=()=>{},tc=(0,P.ZP)(o.Z)(e=>{let{theme:t}=e;return{display:"flex",alignItems:"center",padding:t.spacing(6),justifyContent:"space-between"}}),td=e=>{let{open:t,toggle:n}=e;return(0,r.jsxs)(eS.ZP,{open:t,anchor:"right",variant:"temporary",ModalProps:{keepMounted:!0},sx:{"& .MuiDrawer-paper":{width:{xs:300,sm:400}}},children:[(0,r.jsxs)(tc,{children:[(0,r.jsx)(x.Z,{variant:"h5",children:"Add User"}),(0,r.jsx)(N.Z,{size:"small",sx:{p:"0.438rem",borderRadius:1,color:"text.primary",backgroundColor:"action.selected","&:hover":{backgroundColor:e=>"rgba(".concat(e.palette.customColors.main,", 0.16)")}},children:(0,r.jsx)(u.Z,{icon:"tabler:x",fontSize:"1.125rem"})})]}),(0,r.jsx)(o.Z,{sx:{p:e=>e.spacing(0,6,6)}})]})},tx=e=>{let{handleFilter:t,toggle:n,value:i}=e;return(0,r.jsxs)(o.Z,{sx:{py:4,px:6,rowGap:2,columnGap:4,display:"flex",flexWrap:"wrap",alignItems:"center",justifyContent:"space-between"},children:[(0,r.jsx)(h.Z,{color:"secondary",variant:"tonal",startIcon:(0,r.jsx)(u.Z,{icon:"tabler:upload"}),children:"Export"}),(0,r.jsxs)(o.Z,{sx:{rowGap:2,display:"flex",flexWrap:"wrap",alignItems:"center"},children:[(0,r.jsx)(em.Z,{value:i,sx:{mr:4},placeholder:"Search User",onChange:e=>t(e.target.value)}),(0,r.jsxs)(h.Z,{onClick:n,variant:"contained",sx:{"& svg":{mr:2}},children:[(0,r.jsx)(u.Z,{fontSize:"1.125rem",icon:"tabler:plus"}),"Add New User"]})]})]})};var th=n(2470);let tu=async e=>{try{return(await s.default.get(e)).data}catch(e){throw e}},tm=e=>e.avatar?(0,r.jsx)(j.Z,{src:e.avatar,sx:{mr:2.5,width:38,height:38}}):(0,r.jsx)(j.Z,{skin:"light",color:e.avatarColor,sx:{mr:2.5,width:38,height:38,fontWeight:500,fontSize:e=>e.typography.body1.fontSize},children:(0,th.Q)(e.name?e.name:"John Doe").substr(-3)}),tp=[{flex:.25,minWidth:280,field:"name",headerName:"Họ v\xe0 t\xean",renderCell:e=>{let{row:t}=e,{name:n,phone:i}=t;return(0,r.jsxs)(o.Z,{sx:{display:"flex",alignItems:"center"},children:[tm(t),(0,r.jsxs)(o.Z,{sx:{display:"flex",alignItems:"flex-start",flexDirection:"column"},children:[(0,r.jsx)(x.Z,{noWrap:!0,component:q(),href:"#",sx:{fontWeight:500,textDecoration:"none",color:"text.secondary","&:hover":{color:"primary.main"}},children:n}),(0,r.jsx)(x.Z,{noWrap:!0,variant:"body2",sx:{color:"text.disabled"},children:i})]})]})}},{flex:.15,minWidth:120,headerName:"Số b\xe1o danh",field:"sbd",renderCell:e=>{let{row:t}=e;return(0,r.jsx)(x.Z,{noWrap:!0,sx:{fontWeight:500,color:"text.secondary",textTransform:"capitalize"},children:t.sbd})}},{flex:.15,minWidth:120,headerName:"Giới t\xednh",field:"sex",renderCell:e=>{let{row:t}=e;return(0,r.jsx)(x.Z,{noWrap:!0,sx:{fontWeight:500,color:"text.secondary",textTransform:"capitalize"},children:t.sex})}},{flex:.15,minWidth:120,headerName:"Ng\xe0y sinh",field:"birthday",renderCell:e=>{let{row:t}=e;return(0,r.jsx)(x.Z,{noWrap:!0,sx:{fontWeight:500,color:"text.secondary",textTransform:"capitalize"},children:t.birthday})}},{flex:.1,minWidth:100,sortable:!1,field:"id",headerName:"",renderCell:e=>{let{row:t}=e;return(0,r.jsxs)(o.Z,{children:[(0,r.jsx)(eb.Z,{title:"Sửa",children:(0,r.jsx)(N.Z,{children:(0,r.jsx)(u.Z,{icon:"tabler:pencil-minus"})})}),(0,r.jsx)(eb.Z,{title:"Xo\xe1",children:(0,r.jsx)(N.Z,{color:"error",children:(0,r.jsx)(u.Z,{icon:"tabler:trash-filled"})})})]})}}],tf=()=>{let e=(0,i.useRouter)(),[t,n]=(0,l.useState)(""),{classes:s}=e.query,{data:o,error:c,isLoading:d}=(0,a.Z)(e.isReady&&s?"/classes/class/".concat(s,"/view"):null,tu);e.isReady&&!s&&e.push("/p/classes.html");let[x,h]=(0,l.useState)(!1),[u,m]=(0,l.useState)(""),p=()=>h(!x),f=(0,l.useCallback)(e=>{m(e)},[]);return d?(0,r.jsx)(r.Fragment,{children:"Đảng tải"}):(0,r.jsxs)(ew.ZP,{container:!0,spacing:6.5,children:[(0,r.jsxs)(ew.ZP,{item:!0,xs:12,children:[(0,r.jsx)(tx,{value:u,handleFilter:f,toggle:p}),(0,r.jsx)(v._,{autoHeight:!0,rows:o||[],columns:tp,initialState:{pagination:{paginationModel:{pageSize:15}}},pageSizeOptions:[15,25,50],disableRowSelectionOnClick:!0})]}),(0,r.jsx)(td,{open:x,toggle:p})]})},tg=()=>{let e=(0,i.useRouter)(),[t,n]=(0,l.useState)("");return(console.log(e),(0,l.useEffect)(()=>{n(e.query.slug)},[e.query]),"classes.html"==t)?(0,r.jsx)(F,{}):"exams.html"==t?(0,r.jsx)(ea,{}):"leaderboard.html"==t?(0,r.jsx)(e2,{}):"realtime.html"==t?(0,r.jsx)(ts,{}):"statistic.html"==t?(0,r.jsx)(to,{}):"view-classes.html"==t?(0,r.jsx)(tf,{}):(0,r.jsx)(r.Fragment,{})};var tv=tg}}]);